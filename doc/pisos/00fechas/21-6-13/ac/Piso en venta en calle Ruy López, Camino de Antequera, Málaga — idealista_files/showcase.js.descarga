/*! For license information please see showcase.js.LICENSE.txt */
(()=>{var e,t,i,s,n={87207:(e,t,i)=>{"use strict";e.exports=i.p+"images/chrome.png"},75673:(e,t,i)=>{"use strict";e.exports=i.p+"images/edge.png"},68472:(e,t,i)=>{"use strict";e.exports=i.p+"images/firefox.png"},81826:(e,t,i)=>{"use strict";e.exports=i.p+"images/safari.png"},24877:(e,t,i)=>{"use strict";e.exports=i.p+"images/showcase-password-background.jpg"},90831:(e,t,i)=>{"use strict";e.exports=i.p+"images/matterport-logo-light.svg"},99612:(e,t,i)=>{"use strict";e.exports=i.p+"images/puck_256_red.png"},408:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAAK3RSTlMAswpHBJ4d+GmsJHYX2zYTkGDwT4Prp4kPWjvMP6Ms5uFvMJZVfsPSe7i+UNMvaAAAD+NJREFUeNrs2Yd2okAUBuB/CsPM0AXFXrDL+7/fuutKMclmKSLJyfcAOvdyy3DAjx8/umW7u020VZejsx4OzKvBcO0cD8qIrYBpju9r7Er/7JjpP5nrg3FiAt/MmO3JOq1gcNgGGt+DCIxjWsuQWFOKL40y30kbMYn8spUg5MVM2+D47OvNRmEd0k9cx//KuVpdl8Gn3bCd4wsZy8PHocyUv9mxRFAUcHs5D+XeuHy8JVa+i6+BLcz3Izj7gUvxCS6YtZi9/wtHOUbfedb6vWq/RKGHMu55QugrITyPo4wvA8N574eMKfpsaZhvz3y2Eo47KlwWWJFvKFKiDD+yAuYWO8Nj8TsLdLbr7URkl7dFGzOKG6qZjBbkU4tIMp2lwQ4Ww/TBetPL20E4e/OsLI0bwaRPKvFldh/mbLtKywZR74bB7vgY/UbgD5udRqSW0YnZuJn7w4cU7HtVBewh/KG/xG/clQZpxJAux298d374D6s3KXAfev8cclxR11KkBcr6uzzFySnv1QB9oEfl2vQ1rngWfUs54LcyOJT77PVLkUalxedsxn/fAEnLjEDcym1U+sORwEsxpxR+wAHweUyeIp5zXInSZcO0OF5GkNLO3+GK7gzyNMaO4kqXUjBL8CJB8RjrCa5sqchTKWnfUlAsgpjiBTxVPMOe/gmfdOCWguRS7D0XnWOrNLcQnYWfpyB00oy5QbeoX2xCF8BYKtIZJccAuDVIM8RDh5bHNLOaAODhiHRqFPKHKbx20ZmNmddeRAG4Bumc4eJqtyosRHRDnAurLwFgR+QlIhuAZ3TdBklh+vkU4KEiL6JCDiAc5m0wxdOFZt79DID2yQv5GoB97nAbbNKM8gA+IS824QCkmRclnon7ea4lAOGTl/MFgMTJ7yQcT0NJvvs1AKZIDygGwMuPdqZ4EjHLC40D1CI9YVEA+/zheHiKZFUuf4P0hiEAsOxe6Ai0rfT7AwZg3ovyv1NzAMt1tp+WaB0zs2WbAFySnpEcsLMeHUzRsrmZdZgA6J70zp4Wp7TJ0Co3q39CARqTHoopgG2WgSlalAyK9wxvS3pp6wGIsy5YojXL7Lbdt/FfZojiOlwJtERn+y8AoEekt0a6eFt3PLRCr4vxu71af4+UC0Bm85qiBcIpxs9aKdVIhmyaaGGPOR/bQidTFsqoldZixRo4czQ2LsUfNg3dmsw1xQeonk+spmkIi3NggcZIcf4x0sDCYgL/QTBr0bQG4rbejvNcRgBcUpc6hQIViPCkSF1u8T5goRGW/rUFoOueKWYUlVEW1822BkBauRDp+wVIARCjem0/sVGTPTHqbUMB0Fl6s/ZQGz2mNwcKeLUOs9FoRG9qJd0D7Pv2JqhtdE+iDdBtvS+ZjdT+3rqlwHLQbAzk69RMar3/qMBDK7xA1XozYvfzuw3fgHcA31fuwwlFa+ik8vzZc2DfaAyIYWEBSlKRpGgVrX4CAKTJGDinNxcA8+rfK9pV5wvMHPCc+mNApjdDGxCqWvUzPAWr1gdKAIlZdwzo+wBgADWqbb4xnmRcbScaNH+ODkU1h/QmBmCRChYJnij5Rd25LScLBEG4WVjkpKIQxROJ0eTX+P7v91+IswHRnbUquvvdJVWpCM70dA+IRikh/dXJ88cm4CowTEDlGH/KuDTMRdkbzXIDwkvrJIYCsMCfszCUgUK9l3xiJZ5BblD+NZ5AbdAGeQBI80ng00kzOuFlhadQlUYlOX5vyjkEEzFs/qIGEhPn8RzMfFkC7E9nZqZLkC8gyG1qf8XCpAnIEC7ZCkijszAQ3Kfim+wIw2nT0uBAolEAWcyV2yWezJL90jIgpb2ugQc8Aii5/6TG06ljrjYDQaNq7wJ6PGUBRvwl3AtIYv6StOCPwqWyjoG09/03qQEZAD9NtBPcEDCt+Aq4xItY8nXwkyabhvXpzAGoZlbq/wOzYFYBkt7Y+xxVqUQWzv8H/UCktL3EPahStkAW2+b/HveEcaZKQHAW4R/sAijxYkrTEtjiDsmvAuAJ7Ms/xFzxRpUqgY8At9lRmTALoMbLqZklQBZ/j5uIKQlFZr8AmglhRv290m6CBxkQOSEABjIQASNtKGyuhUpAcEbAZgwrGG84g0CQyZM6F5wAe4/BJyzh02Owp83IoLo/A7+ZKWALa9iyEgGFwgi9VI1KLniXwmYvn4AEz7WvgUPzWTf0MlEzcG53BHgsFMyB8HRmhGsoMeZA6OnJYRW5pyekqJOjh+x0pgYmnh7LHnKXeHomJIPvvUJC/RFI6zPQNRFPBpsLZWtcs6JFwIihgNY8wuaCmLF2Yznd9dclVCYgdcQDGzvilBY+b8EtG7xiucDYugJgv+zmOpl/axmcsjrAjicYdZiwemB3Yw6IgUEHxJaEgDbj2KAHhujg0++D2L0RwB0EsZoDCdqoyhhxsrWVZKwe2PTngSFpQ+RSCjLNRBE5fq/XBg4EIF0zgSZ2ULYOlSCLeOTUkYS1SE73/uvbC+U0BH0XTRDfDPnAnI6V+H1WDq5KIE8GD4DfIwKV6ouZPlZbzFwbYoBx44Z7XMA3ELq1CDFfjIQ08RIoUronwHcxBpgEAp8uEU2u16EFwwUcYDUHvhPYXWtgCOw8DQWspvA07ICaGr6ThKaA8HRY/v0neg0TCC6HS4zolGi91AaWs2H42BUVfINqCl8fKC0nZajgprsUmVNAipwegqxBGNHQU3oekw8sHZcAhgiUZHtkdyGcARt3g9AFqVexsDsG3s5GGBDOSwBDBARwHgMfnSQwBEKHk+CFBd8MB+17446MdZgD3/azZqzFftppoCBN8J1dBikSfhrw2zYgZazWrU5CZwTjosZXOw6l9GPq/hAApF7Io/ZSaE5ZsHTjtrB7sA6iaH+aVJIPyt28IvKfvTNoTRgIovCAm4gxEhOwFMHqQYL9/3+wl5mJUyis1EOSb/fW3lyym5l57315TR85ujxURVmwEamW3QvndcSVN8S7mJFoRXZL7wRyuoGdawNjHIckSbPNhrw1R5IkRbfYwSrhbjHWyH/ZJjuRbZCIbzYgaVdQB2VUQq3IEJqBk83J68U3wyJ5v+IUpIHBrGP1gkWhabUZG3ANU0E9EBkPz4zcsX+vz4yDrNfeyxsw2289Pq9UNiB7A8oRKJdgeQ2GQqhjFEKdF0KlFC7NUGmHn5SxL+xApNIUBXYkhh+K7lUdx47Fe+WLYIWRDV0aaxQfixVHE1Qe33p3f9O/KQaJ5AaJWArWWIuM3QlYk9RDX4swm9z+t1v+gjVK1hqbxVplZdDXANUsLaM3xMe12+WP0S4fc6M9NjCh/6qwkZlGi2FsaEo0Ut1RY3Pmk9pQg5Oem8NGZ886KMeGp42g0VLj83YJ9FSAgs1JL1iERmOAISpExSEia8foOC4nrgmyRQUp2c5csSgtB81RYWr+bFBxetPeUIGKdjruVKSmPR3fVKiqo7drKlbX2qQHFaxs/cAhQdHazta+U+HqNi4dqXh9OdsdQf3AgolmH9RPbPyQd2+7jcJAGID/MbY54zSkkIQcSbpq1+//fqvdBJterFRzCEh8l71oizszNrHU3zSJXGjICvjFdElCP3GcfC/cHoeM2cG1ydpbaNCSCdoRS43awqYpgYWGrWHblMBS4/ZM5m690MBFsHf9z++lRm6aiNp8oaGrYOfmpXChsbt4a1ZrocHL5o1gLRcavW1eCmmh4etAoR/uC43fN+9NZ+Wy1rTZ4iW2G3KpS3U277g/ZIeGcGoCEie8wEmQUwMIhy2wwSt7GJAh0ZwGwY5+LpT2CFBxOKifTfCeAB452CiMSm3IgQck788GqOGk1OaeCDE5ONYYUX0kB7HNEtcl3LBUPwQAE+TiusVItldyIRgQ6IeUwVHm29KRIbkoPIzCK8hFKG0r+xmcxc3aKeBAblYRBhetyM0BUKnNEndH9kCIgBwFDINi7r/Bt0foQl3shwj8gxwVO4bBsF1Bjj64/XDnomB0GQPaA1hJrsI3hUGot5BclQzw9PcB0H0MrE8Au5GzMEjQWxKE5OzGgNPaHAE7o6aGEkAJ6uAaoZfoSh0IBSSX7wOg3xioGCAL6kLsEnSU7AR1UUiAVXYA9LD3W8sYhdRN6TE4Y15J3YRRq3j9PXq56qcbgIy6Cj9zCQcy/wypqwzATT9d0dNKtw7THvVwjD2JH5BefKQePAClflqht6Nu3Snk1I+Id4eI4T9YdNjFgvrJW7c7+oj++Fe7mjwagNgEubevI5lsOd8mMqr3Xh5sBA3Aa/ftF0d/dp7qAEAW0oyFGYBA271rECpt10BU0GwVUfvvnyoMRJ710ycAKWimhATwqZ/OEoM5rdt7gbrRLN1Ue/6vTxjQ3m+fB1hJM1Sy9v7v7zEoz6wAMYB90Ox8MICReX4PA9ubLqgSgAc0MwEHksrU/x6DO5lJeDkBOMxqOwwPAE4XM/9OGIFMzfp6M9sMhATgmRpNJUahKt0+FrOYZiJm7eOvrhRGwr50gxQAbxZtEHoAFOnGF8No+FE30hqAXNHkVhJAnerGkWNMK93wAwB8RxPbcQCBrxsrjCz2ba0l5r5iAvYGJrGd6ccY3f6iG+85AJ6HNJEw5wDyd9247PECirQhFIBkQ5PYJACU0AYpOOrfBuc7AGSCXk5kAHA/v7D8reyiDZIAeF7QSxU5ByBJG5cMDoZsg3XMAWyDkF4mDLYAeLyeoPxbbWCk+eMOi17kceOWp3qC8reyVFu/69csgX38+re20gwTYKWvLRF1uMnsfN8aCW35JcM06kpb/mMJ2F3QaMSdPR7f11ZVYzI89r8tgQQAfihpFOWBA4AU335ozDElWegWv8geX30TNDDxJvFXVvi6pZj+n7zuK932684BgGdxSIMJ4+zxXe+/dFs1j9ibP+3d626CMBQAYKGUVkqRdlSNomCQi573f7+xsBFuytAtlsTvbxOS9hzaENpTEUETL6qomPUYPN17s8qrgkNTpE09J5MpaLmUaVDlAcVPZj71vh91vkCLYjqV8jFTCS3KDxcVFxVr4yHrArmLSugraJGpTt3/sg0ktEVJaNW//GliTJLQejOBFSYRtMng5Ye2B5inGDrUQbh1s4NocDBGHQKKnDq8rjgo6IhPukX/h3XeQ0++QavGKNkeEizw8bIz02E/YAJ5dqNvK7TJoWd/1vreyx0m0MexOFrd0Vq5tu2UbNtd9RqPAnPoI1iPhe+eLc1hCNljhuxfbRHCewJDcqrjqz/A8yO4gfArTulHeHStVsTdY/hBU3zlBG6IfG8xI2GiYASRKuKlSEkCI1QygxuOOizkc/gT3Edaz3t3ONQg8BRiUM0K901l7pih4CHKYDtdV/yJHJFkEiaQWSJmHvk+GxU4i2FEnOECvf4j//9YDhJsg5dZzmMlSUmqmOfZEm+YQM5cZ7u3t7n6BCyj3BOxzBQ1AAAAAElFTkSuQmCC"},89992:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyMzAuMDUgNDkuNzUiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6I2Y1ZjRmM30uc3Qye2ZpbGw6I2ZmZn0uc3Qze2ZpbGw6Izk5OX08L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik02MS4yOCAzNi4xNHYtOC44MmwtLjI0LTUuMDkuMTktLjA0IDIuMDUgNC41NCA0LjgyIDguODYgNC44Mi04Ljg2IDIuMDYtNC41NC4xOC4wNC0uMjQgNS4wOXY4LjgyaDUuMTRWMTQuNGgtNS44MWwtNi4xMSAxMS43N2gtLjA3TDYxLjk1IDE0LjRoLTUuODF2MjEuNzR6TTIxMi42OSAzMC42M2MwIDMuNiAxLjk0IDUuNSA1LjYxIDUuNWgzLjE3di00LjQ1aC0zLjQ1di05LjQ5aDMuNzR2LTQuMzZoLTQuMTV2LTQuMjFoLTQuOTF2MTcuMDF6TTIxMS4yNiAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzSDIwMHYxOC4zMWg1LjMyVjI1LjcyYzAtMS4wOC40MS0xLjg0LjkzLTIuMzMuODktLjg2IDIuNzktMS4xMSA1LjAxLTEuMTF2LTQuNDV6TTE1OC42MyAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzaC01LjMydjE4LjMxaDUuMzJWMjUuNzJjMC0xLjA4LjQxLTEuODQuOTMtMi4zMy44OS0uODYgMi43OS0xLjExIDUuMDEtMS4xMXYtNC40NXpNMTI3LjQ4IDI3LjI1YzAtNS45NyAzLjE3LTkuODYgOC44NS05Ljg2IDYuMjYgMCA4Ljc4IDQuNTMgOC43OCA5LjY0djEuNThoLTEyLjEydi4xOGMwIDIuMTIgMS4xNCAzLjYgNC4xNyAzLjYgMi4yMyAwIDMuNDUtMS4wNCA0LjY0LTIuMjdsMi42NiAzLjMxYy0xLjY5IDEuOTQtNC40NiAzLjEzLTcuOTEgMy4xMy01LjguMDEtOS4wNy0zLjI3LTkuMDctOS4zMXptNS41LTIuMDV2LjI5aDYuNjJ2LS4zMmMwLTIuMy0xLjA0LTMuODUtMy4xNy0zLjg1cy0zLjQ1IDEuNTQtMy40NSAzLjg4ek0xODAuMDQgMjcuMjVjMC02LjA4IDMuMzEtOS44NiA4Ljg1LTkuODYgNS41NCAwIDguODUgMy43OCA4Ljg1IDkuODZzLTMuMzEgOS4zMi04Ljg1IDkuMzJjLTUuNTUgMC04Ljg1LTMuMjQtOC44NS05LjMyem0xMi4xNSAxLjM3di0zLjI3YzAtMi4zNy0xLjIyLTMuNzQtMy4zMS0zLjc0cy0zLjMxIDEuMzctMy4zMSAzLjc0djMuMjdjMCAyLjM3IDEuMjIgMy43NCAzLjMxIDMuNzRzMy4zMS0xLjM3IDMuMzEtMy43NHpNMTIyLjQyIDEzLjYyaC00Ljc4djIuMTljMCAxLjMtLjQzIDIuMDEtMS44NyAyLjAxaC0xLjMzdjQuMzZoMi42NnY4LjQ0YzAgMy42IDEuOTQgNS41IDUuNjEgNS41aDMuMTd2LTQuNDVoLTMuNDV2LTkuNDloMy43NHYtNC4zNmgtMy43NHYtNC4yek0xMDkuMTcgMTMuNjJoLTQuNzh2Mi4xOWMwIDEuMy0uNDMgMi4wMS0xLjg3IDIuMDFoLTEuMzN2NC4zNmgyLjY2djguNDRjMCAzLjYgMS45NCA1LjUgNS42MSA1LjVoMy4xN3YtNC40NWgtMy40NXYtOS40OWgzLjc0di00LjM2aC0zLjc0di00LjJ6TTE3MC45IDE3LjM5Yy0yLjQ1IDAtNC41MyAxLjUxLTUuMDcgMy42aC0uMTh2LTMuMTdoLTUuMzJ2MjMuODJoNS4zMnYtOC42N2guMThjLjU0IDIuMDUgMi42MyAzLjYgNS4wNyAzLjYgNC43OCAwIDcuMjctMi45MSA3LjI3LTkuMzItLjAxLTYuNC0yLjQ5LTkuODYtNy4yNy05Ljg2em0xLjcyIDExLjUyYzAgMi4zNy0xLjQ4IDMuMzUtMy40OSAzLjM1LTIuMDEgMC0zLjQ5LTEuMDQtMy40OS0yLjc3di01YzAtMS43MyAxLjQ4LTIuNzcgMy40OS0yLjc3IDIuMDEgMCAzLjQ5IDEuNTUgMy40OSAzLjkydjMuMjd6TTk3LjgzIDM2LjE0Yy0xLjkxIDAtMy4yNy0xLjMtMy42LTMuMzFoLS4yMmMtLjU4IDIuNDUtMi42NiAzLjc0LTUuNTQgMy43NC0zLjc4IDAtNS44Ni0yLjIzLTUuODYtNS41IDAtMy45OSAzLjA5LTUuOSA4LjA5LTUuOWgyLjk5di0uNjFjMC0xLjgzLS45LTIuOTktMy4xMy0yLjk5LTIuMTIgMC0zLjI0IDEuMDgtNC4wNiAyLjIzbC0zLjE3LTIuODFjMS41MS0yLjIzIDMuNjctMy42IDcuNjMtMy42IDUuMzIgMCA4LjA2IDIuNDUgOC4wNiA2LjkxdjcuMzhoMS43NnY0LjQ1aC0yLjk1em0tNC4xMy01Ljcydi0yLjIzaC0yLjU5Yy0yLjA1IDAtMy4xMy43Ni0zLjEzIDIuMTJ2LjU0YzAgMS4zNy45IDIuMDEgMi40OCAyLjAxIDEuNzYgMCAzLjI0LS43MiAzLjI0LTIuNDR6Ii8+PGc+PHBhdGggZD0iTTM5LjA1IDYuOTFMMjYuMjQgMTAuNSAxMy40MiA2LjkxIDguMyA4LjM1djMzLjA2bDUuMTMgMS40NCAxMi44Mi0zLjU5IDEyLjgyIDMuNTkgNS4xMy0xLjQ0VjguMzVsLTUuMTUtMS40NHptLTUuMTIgMjQuNjdsLTcuNjktMi4xNS03LjY5IDIuMTV2LTEzLjRsNy42OSAyLjE1IDcuNjktMi4xNXYxMy40eiIgZmlsbD0iI2I3YmFiYiIvPjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0yNi4yNCAxMy4zN3Y2Ljk2bC0xMi44Mi0zLjU5djI2LjFMOC4zIDQxLjQxVjguMzV6TTMzLjkzIDM0LjQ1bC03LjY5LTIuMTZ2Ni45NmwxMi44MSAzLjU5di0yNi4xbC01LjEyIDEuNDR6Ii8+PGc+PHBhdGggY2xhc3M9InN0MyIgZD0iTTM5LjA1IDYuOTFsNS4xMyAxLjQ0LTE3Ljk0IDUuMDJMOC4zIDguMzVsNS4xMi0xLjQ0IDEyLjgyIDMuNTl6TTI2LjI0IDI5LjQybDcuNjkgMi4xNnYyLjg3bC03LjY5LTIuMTYtNy42OSAyLjE2di0yLjg3eiIvPjwvZz48L2c+PC9zdmc+"},31896:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODQiIGhlaWdodD0iODQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNNDIgMEMxOC43OSAwIDAgMTguNzkgMCA0MnMxOC43OSA0MiA0MiA0MiA0Mi0xOC43OSA0Mi00MlM2NS4yMSAwIDQyIDB6IiBmaWxsLW9wYWNpdHk9Ii4yNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTUxLjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6TTM0LjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6IiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg=="},78899:(e,t,i)=>{"use strict";e.exports=i.p+"images/escape.png"},7560:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-cardboard.png"},63931:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-quest.png"},31891:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-play-button.svg"},71002:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-spacebar.png"},14653:(e,t,i)=>{"use strict";e.exports=i.p+"images/mattertag-disc-128-free.v1.png"},94874:(e,t,i)=>{"use strict";e.exports=i.p+"images/mobile-help-play-button.svg"},86533:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_360.png"},70626:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_click_inside.png"},72145:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag.png"},12742:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag_two_finger.png"},5435:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_pinch.png"},67649:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position.png"},2433:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position_two_finger.png"},24367:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_tap.png"},64549:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_inside_key.png"},76064:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_all.png"},81202:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_left_right.png"},42135:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_up_down.png"},41891:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_click.png"},73993:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_left.png"},26668:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_right.png"},82906:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_left.png"},64991:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_right.png"},12136:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_zoom.png"},90619:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_tap_inside.png"},26407:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_zoom_keys.png"},2116:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o,A:()=>r});var s=i(26605),n=i(46162);function o(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,d));e.prototype.shouldComponentUpdate=c}function r(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,n.NK));e.prototype.shouldComponentUpdate=h}function a(e,t){class i extends l{}return i.prototype.renderChild=e,i.prototype.diffFunc=t,i}class l extends s.Component{shouldComponentUpdate(e){return this.diffFunc(e,this.props)}render(e,t,i){return this.renderChild(e,i)}}function c(e,t){return d(e,this.props)||d(t,this.state)}function h(e,t){return d(e,this.props)||(0,n.NK)(t,this.state)}function d(e,t){for(let i in e)if(e[i]!==t[i])return!0;for(let i in t)if(!(i in e))return!0;return!1}},91975:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="},40886:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="},71370:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"},88296:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII="},64366:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},78947:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},1089:(e,t,i)=>{"use strict";e.exports=i.p+"images/scope.svg"},3220:(e,t,i)=>{"use strict";e.exports=i.p+"images/surface_grid_planar_256.png"},57721:(e,t,i)=>{"use strict";e.exports=i.p+"images/vert_arrows.png"},28636:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteColor.png"},27314:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteIcon.png"},30749:(e,t,i)=>{"use strict";e.exports=i.p+"images/pinAnchor.png"},27273:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineBasic1024.png"},15278:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineBasic2048.png"},92787:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineBasic4096.png"},67929:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineBasic512.png"},53896:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineEnhanced1024.png"},38343:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineEnhanced2048.png"},73965:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineEnhanced4096.png"},33967:(e,t,i)=>{"use strict";e.exports=i.p+"images/outlineEnhanced512.png"},48072:(e,t,i)=>{"use strict";e.exports=i.p+"images/360_placement_pin_mask.png"},68444:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior.png"},85089:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior_hover.png"},45545:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior.png"},64293:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior_hover.png"},29480:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAP1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////9Du/pqAAAAFXRSTlMAmYWNk1l7bCJCEQpjKHQ0GE9HHToMZFdDAAAHfklEQVR42uzcC3LcIAwAUAnxMT//73/WTmcnnWw7za6xMMLJO0HsCEkI1vDjx49rhbz7xaTRKkWkETWRUnZMZvF7DnBjIa9pVPiCGtN6v/cw72YkPIBGs89wD8PqCIuQWwfoW/BO4yna+W7XQzYKWSiToTvZEDKivt7BZgjZkdmgC9FbrMT6CNINSWNFOsmuC5PF6uwEUnmFl1AeBIoL4WVoEZcMFsJL0QKSrISXoxWk2AmboB0kGCw2Y9sXxZCwqRSgqVVjY3qFdjaLAtgNGllQiAVaGBSKoRokQ9989X+mPVwrOhTGRfjSfcP/rWVw6/B/vQxuH/6vlsH9w//LZfAtwv+6ZWBQOANVJRQvQUVi099nDmqJIvY+r9kIVQTB6f+ZClDB3M3zI6oZ2A2EHaEBmGXR5f9fOgOrobPnR9QDMJq7iv8Hmr9j/q9TC2KXz4+oIvCwWIUmZUfnRqtIYxVWZv+rnPE5RHgSQ/bGKUQU1xUn5GPNtMGXtslYWTsjg0yUmSK8JU5Gidkde+Sg3RTgkDA5jRy8gAbI+lh43ax5Q8RQANUyQ7F5UW2LocOTxgwn5bFhKVjxHDcAg8HhOWujBJA2YLIl9jRQPwGkGRjNqUEacKIu7wz26jTgsRh5qMDTpd3AoMVdXArpyjSgsJDKUE0u/6vgoEXo0ZS56B7RhmVogsomwjLbFTMQO0N1s71gOrKKDP8PpnpDGDQW0BNcZCr7+wK8K8k4jOE+pkrwpkHKcRz3QeUA77FiDmT/L6h6eXDH48YIF4sjHrfDO0jSpQzezRrBG9ZOnr/oDaxVAmCERsYaIbCUjBsaiYp/SxBJev4/VwsocgcAzdDQTNwhQNcMHNtdXSHmOVjzn3JPvNMxJXP/x7k3VJyv04IAljFobU8J8MNMbP+1obcE8DCxbQpTdwngwTDNBaI+mE3EUHiEjjw1UNCnjTJPJbRyfplR9yaX5TgLIFHfOAuER2wMqUTYp2w8Q/qm7lqg4vVL5xNJ+493/GU4ncBNtxmwIA+asytARA/8bD65BnLnAXAwBPK5FSDy04bbuTWg5I/BX3Fn+vjQdQkoKAQBnvkezgFeGU80cq7PXdCzfGIZ6y63wScSmYYng/jvNr1lKU5ka99N0Ie5+JzUdbwN+syWJgHqdh9cXMyoMHS0uO+5fhZ12VLeu+8CP7iy+zKmu7MAhjMCU9ZCiRoF/iuUNbR0hy7oQZVkwdDhadD/mJJgzrdJAYeSQC7pA0UXwd9iSS+Y7tEGPtiCwd54nxQAYArKgLpPCgCYCipa59PQ4tloQRWEDiAerYMZb9MGHVvQGR52vMlO6MEd3g55vFEROFIGPDwseIthyPGhyPLnlXU/EP/F3pkjAQzCMBDGDBXh/8/NpMmQUunslZ/gHPiQljMu+YVevUgvrB5q6y0Ey3QCWjewz3OjTBkgFAJTTcBoKWIIZY2WgGgpItQERKlC8McDjULTgCemmoCRXhjwja3+03qpVkBpBpwAfwL+CfoYdCHkUrjNDm+G8O0wfiCCH4nhh6L4sTh+MYJfjeGXo/j1uAUSeIkMXiSFl8nhhZJ4qSxeLG25PN4wgbfM4E1TeNucjZN46yzePI23zxuggEdo4CEqeIyOQUp4lBYepmacHh6oiEdqGqqKx+riwcpGa+Ph6ni8vi9YwF+xcbN3pzkOwjAUgJ9DFrLQQLn/XUfzZzSbWjBOa5bvBBEimx3pXSErp4/ZuYKWTh+1dYWtnT5u7/SBi1fk5hW6evrY3St4+fTR21f4+unj95EsMdiKF6m88SV8WboV6rwbOmK5YwVPLH5EcyN3bCtbzTxdRWO1I5559XsrldPAEdPEqDTzmAHNDPxRcSoNXCWhiVSIgV23icTWRTQQO2KLYAjE53sI6z3xBXa5ga+MEDQW2sBkdsFxizJDyFyIQaBwG2mb0ENAH2ibCLZAG90GbDTcaKMgUXXkM9MItnESGEAW6jvw+ZjBkKMnBuHOTSQJNtSEVVINliRE4cM3n3E1Y5FcnSEhDpsVkuNdnfHQXJ0nOQUCAskywcUhZfyQ0xBdMCQrQISnJmxn/C2EmzedpSa8XAtul+SalmmXX0CyVTF2tDt/Hy68/UC0nIID0G/Dzr6AHfDp7c0YCVraVOOOVsKfjcrz7QWtWtXZ0y74jP9oPBV/UXj+/V8h9Qr+UNGaekbR/fexqPpAYCOa6xVvBqbHC2S1S2HIeI27ymlg73jg+NPgye9/+Gmw4Pc/8m6wbPU/7jQwPd5hIiUmvMms4nbkZ6xxtA2Ru/kpeLj0nboHWYzHO2yqniJ9tHN3OwiDMBSA1x7KxgQU5P2f1QtvTIxubox1Zt8btOEnJOUsUkC7QOm0yKDmkDtNEqgpqIt1vLRsAZLKbFvH1AQri/B5cbW0Obv7h/WvBm9oQ8bruPimhrs2Yp3Krf/uLqDqICpjHD8JgrrVK4ptmisIUxV8xOqfRtebtSOWbv/nzjpD7kGLoM/6z/x5bkUi6AeIUlSkNNU0huwj0wSOPoejr/qJPhSXxEfLDBgiAzDb6CW58t+Vn04aPQDVw5SJCNPsmgAAAABJRU5ErkJggg=="},80517:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},89411:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},33757:(e,t,i)=>{"use strict";e.exports=i.p+"images/selected_sweep_glow.png"},94085:(e,t,i)=>{"use strict";e.exports=i.p+"images/roboto-700-42_0.png"},62634:(e,t,i)=>{"use strict";i.d(t,{h4:()=>Oe,ab:()=>ce});var s=function(){return Object.create(null)},n=Array.prototype,o=n.forEach,r=n.slice,a=function(){function e(e,t){void 0===e&&(e=!0),void 0===t&&(t=s),this.weakness=e,this.makeData=t}return e.prototype.lookup=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.lookupArray(e)},e.prototype.lookupArray=function(e){var t=this;return o.call(e,(function(e){return t=t.getChildTrie(e)})),t.data||(t.data=this.makeData(r.call(e)))},e.prototype.getChildTrie=function(t){var i=this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),s=i.get(t);return s||i.set(t,s=new e(this.weakness,this.makeData)),s},e}(),l=null,c={},h=1,d="@wry/context:Slot",u=Array,p=u[d]||function(){var e=function(){function e(){this.id=["slot",h++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return e.prototype.hasValue=function(){for(var e=l;e;e=e.parent)if(this.id in e.slots){var t=e.slots[this.id];if(t===c)break;return e!==l&&(l.slots[this.id]=t),!0}return l&&(l.slots[this.id]=c),!1},e.prototype.getValue=function(){if(this.hasValue())return l.slots[this.id]},e.prototype.withValue=function(e,t,i,s){var n,o=((n={__proto__:null})[this.id]=e,n),r=l;l={parent:r,slots:o};try{return t.apply(s,i)}finally{l=r}},e.bind=function(e){var t=l;return function(){var i=l;try{return l=t,e.apply(this,arguments)}finally{l=i}}},e.noContext=function(e,t,i){if(!l)return e.apply(i,t);var s=l;try{return l=null,e.apply(i,t)}finally{l=s}},e}();try{Object.defineProperty(u,d,{value:u[d]=e,enumerable:!1,writable:!1,configurable:!1})}finally{return e}}();function m(){}p.bind,p.noContext;var g=function(){function e(e,t){void 0===e&&(e=1/0),void 0===t&&(t=m),this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},e.prototype.getEntry=function(e){var t=this.map.get(e);if(t&&t!==this.newest){var i=t.older,s=t.newer;s&&(s.older=i),i&&(i.newer=s),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=s)}return t},e.prototype.set=function(e,t){var i=this.getEntry(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(e,i),i.value)},e.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},e.prototype.delete=function(e){var t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)},e}(),f=new p;function v(e){var t=e.unsubscribe;"function"==typeof t&&(e.unsubscribe=void 0,t())}var y=[];function b(e,t){if(!e)throw new Error(t||"assertion failure")}function w(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}var S=function(){function e(t){this.fn=t,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++e.count}return e.prototype.peek=function(){if(1===this.value.length&&!E(this))return this.value[0]},e.prototype.recompute=function(e){return b(!this.recomputing,"already recomputing"),t=this,(i=f.getValue())&&(t.parents.add(i),i.childValues.has(t)||i.childValues.set(t,[]),E(t)?M(i,t):P(i,t)),E(this)?function(e,t){return O(e),f.withValue(e,T,[e,t]),function(e,t){if("function"==typeof e.subscribe)try{v(e),e.unsubscribe=e.subscribe.apply(null,t)}catch(t){return e.setDirty(),!1}return!0}(e,t)&&function(e){e.dirty=!1,E(e)||x(e)}(e),w(e.value)}(this,e):w(this.value);var t,i},e.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,_(this),O(this),v(this))},e.prototype.dispose=function(){var e=this;O(this),v(this),this.parents.forEach((function(t){t.setDirty(),D(t,e)}))},e.prototype.dependOn=function(e){e.add(this),this.deps||(this.deps=y.pop()||new Set),this.deps.add(e)},e.prototype.forgetDeps=function(){var e=this;this.deps&&(this.deps.forEach((function(t){return t.delete(e)})),this.deps.clear(),y.push(this.deps),this.deps=null)},e.count=0,e}();function T(e,t){e.recomputing=!0,e.value.length=0;try{e.value[0]=e.fn.apply(null,t)}catch(t){e.value[1]=t}e.recomputing=!1}function E(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function _(e){e.parents.forEach((function(t){return M(t,e)}))}function x(e){e.parents.forEach((function(t){return P(t,e)}))}function M(e,t){if(b(e.childValues.has(t)),b(E(t)),e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=y.pop()||new Set;e.dirtyChildren.add(t),_(e)}function P(e,t){b(e.childValues.has(t)),b(!E(t));var i,s,n,o=e.childValues.get(t);0===o.length?e.childValues.set(t,t.value.slice(0)):(i=o,s=t.value,(n=i.length)>0&&n===s.length&&i[n-1]===s[n-1]||e.setDirty()),A(e,t),E(e)||x(e)}function A(e,t){var i=e.dirtyChildren;i&&(i.delete(t),0===i.size&&(y.length<100&&y.push(i),e.dirtyChildren=null))}function O(e){e.childValues.size>0&&e.childValues.forEach((function(t,i){D(e,i)})),e.forgetDeps(),b(null===e.dirtyChildren)}function D(e,t){t.parents.delete(e),e.childValues.delete(t),A(e,t)}function I(e){var t=new Map,i=e&&e.subscribe;function s(e){var s=f.getValue();if(s){var n=t.get(e);n||t.set(e,n=new Set),s.dependOn(n),"function"==typeof i&&(v(n),n.unsubscribe=i(e))}}return s.dirty=function(e){var i=t.get(e);i&&(i.forEach((function(e){return e.setDirty()})),t.delete(e),v(i))},s}var C=new a("function"==typeof WeakMap);function R(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return C.lookupArray(e)}var L=new Set;function N(e,t){void 0===t&&(t=Object.create(null));var i=new g(t.max||Math.pow(2,16),(function(e){return e.dispose()})),s=t.keyArgs||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},n=t.makeCacheKey||R;function o(){var o=n.apply(null,s.apply(null,arguments));if(void 0===o)return e.apply(null,arguments);var r=i.get(o);r||(i.set(o,r=new S(e)),r.subscribe=t.subscribe);var a=r.recompute(Array.prototype.slice.call(arguments));return i.set(o,r),L.add(i),f.hasValue()||(L.forEach((function(e){return e.clean()})),L.clear()),a}function r(){var e=n.apply(null,arguments);if(void 0!==e)return i.get(e)}return o.dirty=function(){var e=r.apply(null,arguments);e&&e.setDirty()},o.peek=function(){var e=r.apply(null,arguments);if(e)return e.peek()},o.forget=function(){var e=n.apply(null,arguments);return void 0!==e&&i.delete(e)},o}var k,F=i(80496),B=function(){function e(){this.getFragmentDoc=N(F.Yk)}return e.prototype.recordOptimisticTransaction=function(e,t){this.performTransaction(e,t)},e.prototype.transformDocument=function(e){return e},e.prototype.identify=function(e){},e.prototype.gc=function(){return[]},e.prototype.modify=function(e){return!1},e.prototype.transformForLink=function(e){return e},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({query:this.getFragmentDoc(e.fragment,e.fragmentName),variables:e.variables,rootId:e.id,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.writeQuery=function(e){return this.write({dataId:e.id||"ROOT_QUERY",result:e.data,query:e.query,variables:e.variables,broadcast:e.broadcast})},e.prototype.writeFragment=function(e){return this.write({dataId:e.id,result:e.data,variables:e.variables,query:this.getFragmentDoc(e.fragment,e.fragmentName),broadcast:e.broadcast})},e}();k||(k={});var U=function(e,t,i,s,n){this.message=e,this.path=t,this.query=i,this.clientOnly=s,this.variables=n},H=i(70655),G=i(92924),V=i(82152),z=Object.prototype.hasOwnProperty,j=/^[_a-z][_0-9a-z]*/i;function W(e){var t=e.match(j);return t?t[0]:e}function Z(e,t,i){return!(!t||"object"!=typeof t)&&(Array.isArray(t)?t.every((function(t){return Z(e,t,i)})):e.selections.every((function(e){if((0,F.My)(e)&&(0,F.LZ)(e,i)){var s=(0,F.u2)(e);return z.call(t,s)&&(!e.selectionSet||Z(e.selectionSet,t[s],i))}return!0})))}function q(e){return null!==e&&"object"==typeof e&&!(0,F.hh)(e)&&!Array.isArray(e)}var K=Object.create(null),Y=function(){return K},$=Object.create(null),Q=function(){function e(e,t){var i=this;this.policies=e,this.group=t,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(e,t){return(0,F.Jv)((0,F.hh)(e)?i.get(e.__ref,t):e&&e[t])},this.canRead=function(e){return(0,F.hh)(e)?i.has(e.__ref):"object"==typeof e},this.toReference=function(e,t){if("string"==typeof e)return(0,F.kQ)(e);if((0,F.hh)(e))return e;var s=i.policies.identify(e)[0];if(s){var n=(0,F.kQ)(s);return t&&i.merge(s,e),n}}}return e.prototype.toObject=function(){return(0,H.pi)({},this.data)},e.prototype.has=function(e){return void 0!==this.lookup(e,!0)},e.prototype.get=function(e,t){if(this.group.depend(e,t),z.call(this.data,e)){var i=this.data[e];if(i&&z.call(i,t))return i[t]}return"__typename"===t&&z.call(this.policies.rootTypenamesById,e)?this.policies.rootTypenamesById[e]:this instanceof ee?this.parent.get(e,t):void 0},e.prototype.lookup=function(e,t){return t&&this.group.depend(e,"__exists"),z.call(this.data,e)?this.data[e]:this instanceof ee?this.parent.lookup(e,t):this.policies.rootTypenamesById[e]?Object.create(null):void 0},e.prototype.merge=function(e,t){var i=this,s=this.lookup(e),n=new F.w0(te).merge(s,t);if(this.data[e]=n,n!==s&&(delete this.refs[e],this.group.caching)){var o=Object.create(null);s||(o.__exists=1),Object.keys(t).forEach((function(e){if(!s||s[e]!==n[e]){o[e]=1;var t=W(e);t===e||i.policies.hasKeyArgs(n.__typename,t)||(o[t]=1),void 0!==n[e]||i instanceof ee||delete n[e]}})),Object.keys(o).forEach((function(t){return i.group.dirty(e,t)}))}},e.prototype.modify=function(e,t){var i=this,s=this.lookup(e);if(s){var n=Object.create(null),o=!1,r=!0,a={DELETE:K,INVALIDATE:$,isReference:F.hh,toReference:this.toReference,canRead:this.canRead,readField:function(t,s){return i.policies.readField("string"==typeof t?{fieldName:t,from:s||(0,F.kQ)(e)}:t,{store:i})}};if(Object.keys(s).forEach((function(l){var c=W(l),h=s[l];if(void 0!==h){var d="function"==typeof t?t:t[l]||t[c];if(d){var u=d===Y?K:d((0,F.Jv)(h),(0,H.pi)((0,H.pi)({},a),{fieldName:c,storeFieldName:l,storage:i.getStorage(e,l)}));u===$?i.group.dirty(e,l):(u===K&&(u=void 0),u!==h&&(n[l]=u,o=!0,h=u))}void 0!==h&&(r=!1)}})),o)return this.merge(e,n),r&&(this instanceof ee?this.data[e]=void 0:delete this.data[e],this.group.dirty(e,"__exists")),!0}return!1},e.prototype.delete=function(e,t,i){var s,n=this.lookup(e);if(n){var o=this.getFieldValue(n,"__typename"),r=t&&i?this.policies.getStoreFieldName({typename:o,fieldName:t,args:i}):t;return this.modify(e,r?((s={})[r]=Y,s):Y)}return!1},e.prototype.evict=function(e){var t=!1;return e.id&&(z.call(this.data,e.id)&&(t=this.delete(e.id,e.fieldName,e.args)),this instanceof ee&&(t=this.parent.evict(e)||t),(e.fieldName||t)&&this.group.dirty(e.id,e.fieldName||"__exists")),t},e.prototype.clear=function(){this.replace(null)},e.prototype.extract=function(){var e=this,t=this.toObject(),i=[];return this.getRootIdSet().forEach((function(t){z.call(e.policies.rootTypenamesById,t)||i.push(t)})),i.length&&(t.__META={extraRootIds:i.sort()}),t},e.prototype.replace=function(e){var t=this;if(Object.keys(this.data).forEach((function(i){e&&z.call(e,i)||t.delete(i)})),e){var i=e.__META,s=(0,H._T)(e,["__META"]);Object.keys(s).forEach((function(e){t.merge(e,s[e])})),i&&i.extraRootIds.forEach(this.retain,this)}},e.prototype.retain=function(e){return this.rootIds[e]=(this.rootIds[e]||0)+1},e.prototype.release=function(e){if(this.rootIds[e]>0){var t=--this.rootIds[e];return t||delete this.rootIds[e],t}return 0},e.prototype.getRootIdSet=function(e){return void 0===e&&(e=new Set),Object.keys(this.rootIds).forEach(e.add,e),this instanceof ee?this.parent.getRootIdSet(e):Object.keys(this.policies.rootTypenamesById).forEach(e.add,e),e},e.prototype.gc=function(){var e=this,t=this.getRootIdSet(),i=this.toObject();t.forEach((function(s){z.call(i,s)&&(Object.keys(e.findChildRefIds(s)).forEach(t.add,t),delete i[s])}));var s=Object.keys(i);if(s.length){for(var n=this;n instanceof ee;)n=n.parent;s.forEach((function(e){return n.delete(e)}))}return s},e.prototype.findChildRefIds=function(e){if(!z.call(this.refs,e)){var t=this.refs[e]=Object.create(null),i=new Set([this.data[e]]),s=function(e){return null!==e&&"object"==typeof e};i.forEach((function(e){(0,F.hh)(e)?t[e.__ref]=!0:s(e)&&Object.values(e).filter(s).forEach(i.add,i)}))}return this.refs[e]},e.prototype.makeCacheKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.group.keyMaker.lookupArray(e)},e}(),X=function(){function e(e){this.caching=e,this.d=null,this.keyMaker=new a(F.mr),this.d=e?I():null}return e.prototype.depend=function(e,t){if(this.d){this.d(J(e,t));var i=W(t);i!==t&&this.d(J(e,i))}},e.prototype.dirty=function(e,t){this.d&&this.d.dirty(J(e,t))},e}();function J(e,t){return t+"#"+e}!function(e){var t=function(e){function t(t){var i=t.policies,s=t.resultCaching,n=void 0===s||s,o=t.seed,r=e.call(this,i,new X(n))||this;return r.storageTrie=new a(F.mr),r.sharedLayerGroup=new X(n),o&&r.replace(o),r}return(0,H.ZT)(t,e),t.prototype.addLayer=function(e,t){return new ee(e,this,t,this.sharedLayerGroup)},t.prototype.removeLayer=function(){return this},t.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},t}(e);e.Root=t}(Q||(Q={}));var ee=function(e){function t(t,i,s,n){var o=e.call(this,i.policies,n)||this;return o.id=t,o.parent=i,o.replay=s,o.group=n,s(o),o}return(0,H.ZT)(t,e),t.prototype.addLayer=function(e,i){return new t(e,this,i,this.group)},t.prototype.removeLayer=function(e){var t=this,i=this.parent.removeLayer(e);return e===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(e){t.data[e]!==i.lookup(e)&&t.delete(e)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},t.prototype.toObject=function(){return(0,H.pi)((0,H.pi)({},this.parent.toObject()),this.data)},t.prototype.findChildRefIds=function(t){var i=this.parent.findChildRefIds(t);return z.call(this.data,t)?(0,H.pi)((0,H.pi)({},i),e.prototype.findChildRefIds.call(this,t)):i},t.prototype.getStorage=function(){for(var e=this.parent;e.parent;)e=e.parent;return e.getStorage.apply(e,arguments)},t}(Q);function te(e,t,i){var s=e[i],n=t[i];return(0,V.D)(s,n)?s:n}function ie(e){return!!(e instanceof Q&&e.group.caching)}function se(e,t){return new U(e.message,t.path.slice(),t.query,t.clientOnly,t.variables)}var ne=function(){function e(e){var t=this;this.config=e,this.executeSelectionSet=N((function(e){return t.execSelectionSetImpl(e)}),{keyArgs:function(e){return[e.selectionSet,e.objectOrReference,e.context]},makeCacheKey:function(e,t,i){if(ie(i.store))return i.store.makeCacheKey(e,(0,F.hh)(t)?t.__ref:t,i.varString)}}),this.knownResults=new WeakMap,this.executeSubSelectedArray=N((function(e){return t.execSubSelectedArrayImpl(e)}),{makeCacheKey:function(e){var t=e.field,i=e.array,s=e.context;if(ie(s.store))return s.store.makeCacheKey(t,i,s.varString)}}),this.config=(0,H.pi)({addTypename:!0},e)}return e.prototype.diffQueryAgainstStore=function(e){var t=e.store,i=e.query,s=e.rootId,n=void 0===s?"ROOT_QUERY":s,o=e.variables,r=e.returnPartialData,a=void 0===r||r,l=this.config.cache.policies;o=(0,H.pi)((0,H.pi)({},(0,F.O4)((0,F.iW)(i))),o);var c=this.executeSelectionSet({selectionSet:(0,F.p$)(i).selectionSet,objectOrReference:(0,F.kQ)(n),context:{store:t,query:i,policies:l,variables:o,varString:JSON.stringify(o),fragmentMap:(0,F.F)((0,F.kU)(i)),path:[],clientOnly:!1}}),h=c.missing&&c.missing.length>0;if(h&&!a)throw c.missing[0];return{result:c.result,missing:c.missing,complete:!h}},e.prototype.isFresh=function(e,t,i,s){if(ie(s.store)&&this.knownResults.get(e)===i){var n=this.executeSelectionSet.peek(i,t,s);if(n&&e===n.result)return!0}return!1},e.prototype.execSelectionSetImpl=function(e){var t=this,i=e.selectionSet,s=e.objectOrReference,n=e.context;if((0,F.hh)(s)&&!n.policies.rootTypenamesById[s.__ref]&&!n.store.has(s.__ref))return{result:{},missing:[se(new G.ej(4),n)]};var o=n.variables,r=n.policies,a=n.store,l=[],c={result:null},h=a.getFieldValue(s,"__typename");function d(){return c.missing||(c.missing=[])}function u(e){var t;return e.missing&&(t=d()).push.apply(t,e.missing),e.result}this.config.addTypename&&"string"==typeof h&&!r.rootIdsByTypename[h]&&l.push({__typename:h});var p=new Set(i.selections);return p.forEach((function(e){var i;if((0,F.LZ)(e,o))if((0,F.My)(e)){var a=r.readField({fieldName:e.name.value,field:e,variables:n.variables,from:s},n),c=(0,F.u2)(e);n.path.push(c);var m=n.clientOnly;n.clientOnly=m||!(!e.directives||!e.directives.some((function(e){return"client"===e.name.value}))),void 0===a?F.Gw.added(e)||d().push(se(new G.ej(5),n)):Array.isArray(a)?a=u(t.executeSubSelectedArray({field:e,array:a,context:n})):e.selectionSet&&null!=a&&(a=u(t.executeSelectionSet({selectionSet:e.selectionSet,objectOrReference:a,context:n}))),void 0!==a&&l.push(((i={})[c]=a,i)),n.clientOnly=m,(0,G.kG)(n.path.pop()===c)}else{var g=(0,F.hi)(e,n.fragmentMap);g&&r.fragmentMatches(g,h)&&g.selectionSet.selections.forEach(p.add,p)}})),c.result=(0,F.bw)(l),this.knownResults.set(c.result,i),c},e.prototype.execSubSelectedArrayImpl=function(e){var t,i=this,s=e.field,n=e.array,o=e.context;function r(e,i){return e.missing&&(t=t||[]).push.apply(t,e.missing),(0,G.kG)(o.path.pop()===i),e.result}return s.selectionSet&&(n=n.filter(o.store.canRead)),{result:n=n.map((function(e,t){return null===e?null:(o.path.push(t),Array.isArray(e)?r(i.executeSubSelectedArray({field:s,array:e,context:o}),t):s.selectionSet?r(i.executeSelectionSet({selectionSet:s.selectionSet,objectOrReference:e,context:o}),t):((0,G.kG)(o.path.pop()===t),e))})),missing:t}},e}(),oe=function(){function e(e,t){this.cache=e,this.reader=t}return e.prototype.writeToStore=function(e){var t=e.query,i=e.result,s=e.dataId,n=e.store,o=e.variables,r=(0,F.$H)(t),a=new F.w0;o=(0,H.pi)((0,H.pi)({},(0,F.O4)(r)),o);var l=this.processSelectionSet({result:i||Object.create(null),dataId:s,selectionSet:r.selectionSet,mergeTree:{map:new Map},context:{store:n,written:Object.create(null),merge:function(e,t){return a.merge(e,t)},variables:o,varString:JSON.stringify(o),fragmentMap:(0,F.F)((0,F.kU)(t))}});if(!(0,F.hh)(l))throw new G.ej(7);return n.retain(l.__ref),l},e.prototype.processSelectionSet=function(e){var t=this,i=e.dataId,s=e.result,n=e.selectionSet,o=e.context,r=e.mergeTree,a=this.cache.policies,l=a.identify(s,n,o.fragmentMap),c=l[0],h=l[1];if("string"==typeof(i=i||c)){var d=o.written[i]||(o.written[i]=[]),u=(0,F.kQ)(i);if(d.indexOf(n)>=0)return u;if(d.push(n),this.reader&&this.reader.isFresh(s,u,n,o))return u}var p=Object.create(null);h&&(p=o.merge(p,h));var m=i&&a.rootTypenamesById[i]||(0,F.qw)(s,n,o.fragmentMap)||i&&o.store.get(i,"__typename");"string"==typeof m&&(p.__typename=m);var g=new Set(n.selections);if(g.forEach((function(e){var i;if((0,F.LZ)(e,o.variables))if((0,F.My)(e)){var n=(0,F.u2)(e),l=s[n];if(void 0!==l){var c=a.getStoreFieldName({typename:m,fieldName:e.name.value,field:e,variables:o.variables}),h=ae(r,c),d=t.processFieldValue(l,e,o,h),u=e.selectionSet&&o.store.getFieldValue(d,"__typename")||void 0,f=a.getMergeFunction(m,e.name.value,u);f?h.info={field:e,typename:m,merge:f}:le(r,c),p=o.merge(p,((i={})[c]=d,i))}else if(a.usingPossibleTypes&&!(0,F.FS)(["defer","client"],e))throw new G.ej(8)}else{var v=(0,F.hi)(e,o.fragmentMap);v&&a.fragmentMatches(v,m,s,o.variables)&&v.selectionSet.selections.forEach(g.add,g)}})),"string"==typeof i){var f=(0,F.kQ)(i);return r.map.size&&(p=this.applyMerges(r,f,p,o)),o.store.merge(i,p),f}return p},e.prototype.processFieldValue=function(e,t,i,s){var n=this;return t.selectionSet&&null!==e?Array.isArray(e)?e.map((function(e,o){var r=n.processFieldValue(e,t,i,ae(s,o));return le(s,o),r})):this.processSelectionSet({result:e,selectionSet:t.selectionSet,context:i,mergeTree:s}):e},e.prototype.applyMerges=function(e,t,i,s,n){var o,r=this;if(e.map.size&&!(0,F.hh)(i)){var a,l=Array.isArray(i)||!(0,F.hh)(t)&&!q(t)?void 0:t,c=i;l&&!n&&(n=[(0,F.hh)(l)?l.__ref:l]);var h=function(e,t){return Array.isArray(e)?"number"==typeof t?e[t]:void 0:s.store.getFieldValue(e,String(t))};e.map.forEach((function(e,t){n&&n.push(t);var i=h(l,t),o=h(c,t),d=r.applyMerges(e,i,o,s,n);d!==o&&(a=a||new Map).set(t,d),n&&(0,G.kG)(n.pop()===t)})),a&&(i=Array.isArray(c)?c.slice(0):(0,H.pi)({},c),a.forEach((function(e,t){i[t]=e})))}return e.info?this.cache.policies.runMergeFunction(t,i,e.info,s,n&&(o=s.store).getStorage.apply(o,n)):i},e}(),re=[];function ae(e,t){var i=e.map;return i.has(t)||i.set(t,re.pop()||{map:new Map}),i.get(t)}function le(e,t){var i=e.map,s=i.get(t);!s||s.info||s.map.size||(re.push(s),i.delete(t))}new Set;var ce=new p;function he(e,t){if(e.size){var i=[];e.forEach((function(e){return i.push(e)})),e.clear(),i.forEach(t)}}var de=new WeakMap;function ue(e){var t=de.get(e);return t||de.set(e,t={vars:new Set,dep:I()}),t}function pe(e){var t=new Set,i=new Set,s=function(o){if(arguments.length>0)e!==o&&(e=o,t.forEach((function(e){ue(e).dep.dirty(s),me(e)})),he(i,(function(t){return t(e)})));else{var r=ce.getValue();r&&(n(r),ue(r).dep(s))}return e};s.onNextChange=function(e){return i.add(e),function(){i.delete(e)}};var n=s.attachCache=function(e){return t.add(e),ue(e).vars.add(s),s};return s.forgetCache=function(e){return t.delete(e)},s}function me(e){e.broadcastWatches&&e.broadcastWatches()}function ge(e){return void 0!==e.args?e.args:e.field?(0,F.NC)(e.field,e.variables):null}var fe=function(e,t){var i=e.__typename,s=e.id,n=e._id;if("string"==typeof i&&(t&&(t.keyObject=void 0!==s?{id:s}:void 0!==n?{_id:n}:void 0),void 0===s&&(s=n),void 0!==s))return i+":"+("number"==typeof s||"string"==typeof s?s:JSON.stringify(s))},ve=function(){},ye=function(e,t){return t.fieldName},be=function(e,t,i){return(0,i.mergeObjects)(e,t)},we=function(e,t){return t},Se=function(){function e(e){this.config=e,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=(0,H.pi)({dataIdFromObject:fe},e),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),e.possibleTypes&&this.addPossibleTypes(e.possibleTypes),e.typePolicies&&this.addTypePolicies(e.typePolicies)}return e.prototype.identify=function(e,t,i){var s=t&&i?(0,F.qw)(e,t,i):e.__typename;if(s===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var n,o={typename:s,selectionSet:t,fragmentMap:i},r=s&&this.getTypePolicy(s),a=r&&r.keyFn||this.config.dataIdFromObject;a;){var l=a(e,o);if(!Array.isArray(l)){n=l;break}a=xe(l)}return n=n&&String(n),o.keyObject?[n,o.keyObject]:[n]},e.prototype.addTypePolicies=function(e){var t=this;Object.keys(e).forEach((function(i){var s=e[i],n=s.queryType,o=s.mutationType,r=s.subscriptionType,a=(0,H._T)(s,["queryType","mutationType","subscriptionType"]);n&&t.setRootTypename("Query",i),o&&t.setRootTypename("Mutation",i),r&&t.setRootTypename("Subscription",i),z.call(t.toBeAdded,i)?t.toBeAdded[i].push(a):t.toBeAdded[i]=[a]}))},e.prototype.updateTypePolicy=function(e,t){var i=this,s=this.getTypePolicy(e),n=t.keyFields,o=t.fields;function r(e,t){e.merge="function"==typeof t?t:!0===t?be:!1===t?we:e.merge}r(s,t.merge),s.keyFn=!1===n?ve:Array.isArray(n)?xe(n):"function"==typeof n?n:s.keyFn,o&&Object.keys(o).forEach((function(t){var s=i.getFieldPolicy(e,t,!0),n=o[t];if("function"==typeof n)s.read=n;else{var a=n.keyArgs,l=n.read,c=n.merge;s.keyFn=!1===a?ye:Array.isArray(a)?_e(a):"function"==typeof a?a:s.keyFn,"function"==typeof l&&(s.read=l),r(s,c)}s.read&&s.merge&&(s.keyFn=s.keyFn||ye)}))},e.prototype.setRootTypename=function(e,t){void 0===t&&(t=e);var i="ROOT_"+e.toUpperCase(),s=this.rootTypenamesById[i];t!==s&&((0,G.kG)(!s||s===e,1),s&&delete this.rootIdsByTypename[s],this.rootIdsByTypename[t]=i,this.rootTypenamesById[i]=t)},e.prototype.addPossibleTypes=function(e){var t=this;this.usingPossibleTypes=!0,Object.keys(e).forEach((function(i){t.getSupertypeSet(i,!0),e[i].forEach((function(e){t.getSupertypeSet(e,!0).add(i);var s=e.match(j);s&&s[0]===e||t.fuzzySubtypes.set(e,new RegExp(e))}))}))},e.prototype.getTypePolicy=function(e){var t=this;if(!z.call(this.typePolicies,e)){var i=this.typePolicies[e]=Object.create(null);i.fields=Object.create(null);var s=this.supertypeMap.get(e);s&&s.size&&s.forEach((function(e){var s=t.getTypePolicy(e),n=s.fields,o=(0,H._T)(s,["fields"]);Object.assign(i,o),Object.assign(i.fields,n)}))}var n=this.toBeAdded[e];return n&&n.length&&this.updateTypePolicy(e,F.oA.apply(void 0,n.splice(0))),this.typePolicies[e]},e.prototype.getFieldPolicy=function(e,t,i){if(e){var s=this.getTypePolicy(e).fields;return s[t]||i&&(s[t]=Object.create(null))}},e.prototype.getSupertypeSet=function(e,t){var i=this.supertypeMap.get(e);return!i&&t&&this.supertypeMap.set(e,i=new Set),i},e.prototype.fragmentMatches=function(e,t,i,s){var n=this;if(!e.typeCondition)return!0;if(!t)return!1;var o=e.typeCondition.name.value;if(t===o)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(o))for(var r=this.getSupertypeSet(t,!0),a=[r],l=function(e){var t=n.getSupertypeSet(e,!1);t&&t.size&&a.indexOf(t)<0&&a.push(t)},c=!(!i||!this.fuzzySubtypes.size),h=0;h<a.length;++h){var d=a[h];if(d.has(o))return r.has(o)||r.add(o),!0;d.forEach(l),c&&h===a.length-1&&Z(e.selectionSet,i,s)&&(c=!1,this.fuzzySubtypes.forEach((function(e,i){var s=t.match(e);s&&s[0]===t&&l(i)})))}return!1},e.prototype.hasKeyArgs=function(e,t){var i=this.getFieldPolicy(e,t,!1);return!(!i||!i.keyFn)},e.prototype.getStoreFieldName=function(e){var t,i=e.typename,s=e.fieldName,n=this.getFieldPolicy(i,s,!1),o=n&&n.keyFn;if(o&&i)for(var r={typename:i,fieldName:s,field:e.field||null,variables:e.variables},a=ge(e);o;){var l=o(a,r);if(!Array.isArray(l)){t=l||s;break}o=_e(l)}return void 0===t&&(t=e.field?(0,F.vf)(e.field,e.variables):(0,F.PT)(s,ge(e))),s===W(t)?t:s+":"+t},e.prototype.readField=function(e,t){var i=e.from;if(i&&(e.field||e.fieldName)){if(void 0===e.typename){var s=t.store.getFieldValue(i,"__typename");s&&(e.typename=s)}var n=this.getStoreFieldName(e),o=W(n),r=t.store.getFieldValue(i,n),a=this.getFieldPolicy(e.typename,o,!1),l=a&&a.read;if(l){var c=Te(this,i,e,t,t.store.getStorage((0,F.hh)(i)?i.__ref:i,n));return ce.withValue(this.cache,l,[r,c])}return r}},e.prototype.getMergeFunction=function(e,t,i){var s=this.getFieldPolicy(e,t,!1),n=s&&s.merge;return!n&&i&&(n=(s=this.getTypePolicy(i))&&s.merge),n},e.prototype.runMergeFunction=function(e,t,i,s,n){var o=i.field,r=i.typename,a=i.merge;return a===be?Ee(s.store.getFieldValue)(e,t):a===we?t:a(e,t,Te(this,void 0,{typename:r,fieldName:o.name.value,field:o,variables:s.variables},s,n||Object.create(null)))},e}();function Te(e,t,i,s,n){var o=e.getStoreFieldName(i),r=W(o),a=i.variables||s.variables,l=s.store,c=l.getFieldValue,h=l.toReference,d=l.canRead;return{args:ge(i),field:i.field||null,fieldName:r,storeFieldName:o,variables:a,isReference:F.hh,toReference:h,storage:n,cache:e.cache,canRead:d,readField:function(i,n){var o="string"==typeof i?{fieldName:i,from:n}:(0,H.pi)({},i);return void 0===o.from&&(o.from=t),void 0===o.variables&&(o.variables=a),e.readField(o,s)},mergeObjects:Ee(c)}}function Ee(e){return function(t,i){if(Array.isArray(t)||Array.isArray(i))throw new G.ej(2);if(t&&"object"==typeof t&&i&&"object"==typeof i){var s=e(t,"__typename"),n=e(i,"__typename");return s&&n&&s!==n||!q(t)||!q(i)?i:(0,H.pi)((0,H.pi)({},t),i)}return i}}function _e(e){return function(t,i){return t?i.fieldName+":"+JSON.stringify(Pe(t,e,!1)):i.fieldName}}function xe(e){var t=new a(F.mr);return function(i,s){var n;if(s.selectionSet&&s.fragmentMap){var o=t.lookupArray([s.selectionSet,s.fragmentMap]);n=o.aliasMap||(o.aliasMap=Me(s.selectionSet,s.fragmentMap))}var r=s.keyObject=Pe(i,e,!0,n);return s.typename+":"+JSON.stringify(r)}}function Me(e,t){var i=Object.create(null),s=new Set([e]);return s.forEach((function(e){e.selections.forEach((function(e){if((0,F.My)(e)){if(e.alias){var n=e.alias.value,o=e.name.value;o!==n&&((i.aliases||(i.aliases=Object.create(null)))[o]=n)}e.selectionSet&&((i.subsets||(i.subsets=Object.create(null)))[e.name.value]=Me(e.selectionSet,t))}else{var r=(0,F.hi)(e,t);r&&s.add(r.selectionSet)}}))})),i}function Pe(e,t,i,s){var n,o=Object.create(null);return t.forEach((function(t){if(Array.isArray(t)){if("string"==typeof n){var r=s&&s.subsets,a=r&&r[n];o[n]=Pe(e[n],t,i,a)}}else{var l=s&&s.aliases,c=l&&l[t]||t;z.call(e,c)?o[n=t]=e[c]:((0,G.kG)(!i,3),n=void 0)}})),o}var Ae={dataIdFromObject:fe,addTypename:!0,resultCaching:!0,typePolicies:{}},Oe=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.watches=new Set,i.typenameDocumentCache=new Map,i.makeVar=pe,i.txCount=0,i.maybeBroadcastWatch=N((function(e,t){return i.broadcastWatch.call(i,e,!!t)}),{makeCacheKey:function(e){var t=e.optimistic?i.optimisticData:i.data;if(ie(t)){var s=e.optimistic,n=e.rootId,o=e.variables;return t.makeCacheKey(e.query,e.callback,JSON.stringify({optimistic:s,rootId:n,variables:o}))}}}),i.watchDep=I(),i.config=(0,H.pi)((0,H.pi)({},Ae),t),i.addTypename=!!i.config.addTypename,i.policies=new Se({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.data=new Q.Root({policies:i.policies,resultCaching:i.config.resultCaching}),i.optimisticData=i.data,i.storeWriter=new oe(i,i.storeReader=new ne({cache:i,addTypename:i.addTypename})),i}return(0,H.ZT)(t,e),t.prototype.restore=function(e){return e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).extract()},t.prototype.read=function(e){var t=e.returnPartialData,i=void 0!==t&&t;try{return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,query:e.query,variables:e.variables,rootId:e.rootId,config:this.config,returnPartialData:i}).result||null}catch(e){if(e instanceof U)return null;throw e}},t.prototype.write=function(e){try{return++this.txCount,this.storeWriter.writeToStore({store:this.data,query:e.query,result:e.result,dataId:e.dataId,variables:e.variables})}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.modify=function(e){if(z.call(e,"id")&&!e.id)return!1;var t=e.optimistic?this.optimisticData:this.data;try{return++this.txCount,t.modify(e.id||"ROOT_QUERY",e.fields)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.diff=function(e){return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,config:this.config})},t.prototype.watch=function(e){var t,i=this;return this.watches.size||ue(t=this).vars.forEach((function(e){return e.attachCache(t)})),this.watches.add(e),e.immediate&&this.maybeBroadcastWatch(e),function(){i.watches.delete(e)&&!i.watches.size&&function(e){ue(e).vars.forEach((function(t){return t.forgetCache(e)}))}(i),i.watchDep.dirty(e),i.maybeBroadcastWatch.forget(e)}},t.prototype.gc=function(){return this.optimisticData.gc()},t.prototype.retain=function(e,t){return(t?this.optimisticData:this.data).retain(e)},t.prototype.release=function(e,t){return(t?this.optimisticData:this.data).release(e)},t.prototype.identify=function(e){return(0,F.hh)(e)?e.__ref:this.policies.identify(e)[0]},t.prototype.evict=function(e){if(!e.id){if(z.call(e,"id"))return!1;e=(0,H.pi)((0,H.pi)({},e),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(e)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.reset=function(){return this.data.clear(),this.optimisticData=this.data,this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){var t=this.optimisticData.removeLayer(e);t!==this.optimisticData&&(this.optimisticData=t,this.broadcastWatches())},t.prototype.performTransaction=function(e,t){var i=this,s=function(t){var s=i,n=s.data,o=s.optimisticData;++i.txCount,t&&(i.data=i.optimisticData=t);try{e(i)}finally{--i.txCount,i.data=n,i.optimisticData=o}},n=!1;"string"==typeof t?(this.optimisticData=this.optimisticData.addLayer(t,s),n=!0):null===t?s(this.data):s(),this.broadcastWatches(n)},t.prototype.transformDocument=function(e){if(this.addTypename){var t=this.typenameDocumentCache.get(e);return t||(t=(0,F.Gw)(e),this.typenameDocumentCache.set(e,t),this.typenameDocumentCache.set(t,t)),t}return e},t.prototype.broadcastWatches=function(e){var t=this;this.txCount||this.watches.forEach((function(i){return t.maybeBroadcastWatch(i,e)}))},t.prototype.broadcastWatch=function(e,t){this.watchDep.dirty(e),this.watchDep(e);var i=this.diff({query:e.query,variables:e.variables,optimistic:e.optimistic});e.optimistic&&t&&(i.fromOptimisticTransaction=!0),e.callback(i)},t}(B)},35367:()=>{},55765:(e,t,i)=>{"use strict";i.d(t,{f:()=>E});var s=i(70655),n=i(92924),o=i(81707),r=i(80496),a=i(96593),l=i(82152),c=i(21498),h=i(66282),d=i(85942),u=i(27636),p=i(62634),m=function(){function e(e){var t=e.cache,i=e.client,s=e.resolvers,n=e.fragmentMatcher;this.cache=t,i&&(this.client=i),s&&this.addResolvers(s),n&&this.setFragmentMatcher(n)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach((function(e){t.resolvers=(0,r.Ee)(t.resolvers,e)})):this.resolvers=(0,r.Ee)(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){var t=e.document,i=e.remoteResult,n=e.context,o=e.variables,r=e.onlyRunForcedResolvers,a=void 0!==r&&r;return(0,s.mG)(this,void 0,void 0,(function(){return(0,s.Jh)(this,(function(e){return t?[2,this.resolveDocument(t,i.data,n,o,this.fragmentMatcher,a).then((function(e){return(0,s.pi)((0,s.pi)({},i),{data:e.result})}))]:[2,i]}))}))},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return(0,r.FS)(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return(0,r.ob)(e)},e.prototype.prepareContext=function(e){var t=this.cache;return(0,s.pi)((0,s.pi)({},e),{cache:t,getCacheKey:function(e){return t.identify(e)}})},e.prototype.addExportedVariables=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),(0,s.mG)(this,void 0,void 0,(function(){return(0,s.Jh)(this,(function(n){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(i),t).then((function(e){return(0,s.pi)((0,s.pi)({},t),e.exportedVariables)}))]:[2,(0,s.pi)({},t)]}))}))},e.prototype.shouldForceResolvers=function(e){var t=!1;return(0,u.Vn)(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some((function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value}))))return u.$_}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:(0,r.aL)(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t,i,n,o,a){return void 0===i&&(i={}),void 0===n&&(n={}),void 0===o&&(o=function(){return!0}),void 0===a&&(a=!1),(0,s.mG)(this,void 0,void 0,(function(){var l,c,h,d,u,p,m,g,f;return(0,s.Jh)(this,(function(v){return l=(0,r.p$)(e),c=(0,r.kU)(e),h=(0,r.F)(c),d=l.operation,u=d?d.charAt(0).toUpperCase()+d.slice(1):"Query",m=(p=this).cache,g=p.client,f={fragmentMap:h,context:(0,s.pi)((0,s.pi)({},i),{cache:m,client:g}),variables:n,fragmentMatcher:o,defaultOperationType:u,exportedVariables:{},onlyRunForcedResolvers:a},[2,this.resolveSelectionSet(l.selectionSet,t,f).then((function(e){return{result:e,exportedVariables:f.exportedVariables}}))]}))}))},e.prototype.resolveSelectionSet=function(e,t,i){return(0,s.mG)(this,void 0,void 0,(function(){var o,a,l,c,h,d=this;return(0,s.Jh)(this,(function(u){return o=i.fragmentMap,a=i.context,l=i.variables,c=[t],h=function(e){return(0,s.mG)(d,void 0,void 0,(function(){var h,d;return(0,s.Jh)(this,(function(s){return(0,r.LZ)(e,l)?(0,r.My)(e)?[2,this.resolveField(e,t,i).then((function(t){var i;void 0!==t&&c.push(((i={})[(0,r.u2)(e)]=t,i))}))]:((0,r.Ao)(e)?h=e:(h=o[e.name.value],(0,n.kG)(h,11)),h&&h.typeCondition&&(d=h.typeCondition.name.value,i.fragmentMatcher(t,d,a))?[2,this.resolveSelectionSet(h.selectionSet,t,i).then((function(e){c.push(e)}))]:[2]):[2]}))}))},[2,Promise.all(e.selections.map(h)).then((function(){return(0,r.bw)(c)}))]}))}))},e.prototype.resolveField=function(e,t,i){return(0,s.mG)(this,void 0,void 0,(function(){var n,o,a,l,c,h,d,u,m,g=this;return(0,s.Jh)(this,(function(s){return n=i.variables,o=e.name.value,a=(0,r.u2)(e),l=o!==a,c=t[a]||t[o],h=Promise.resolve(c),i.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(d=t.__typename||i.defaultOperationType,(u=this.resolvers&&this.resolvers[d])&&(m=u[l?o:a])&&(h=Promise.resolve(p.ab.withValue(this.cache,m,[t,(0,r.NC)(e,n),i.context,{field:e,fragmentMap:i.fragmentMap}])))),[2,h.then((function(t){return void 0===t&&(t=c),e.directives&&e.directives.forEach((function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach((function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(i.exportedVariables[e.value.value]=t)}))})),e.selectionSet?null==t?t:Array.isArray(t)?g.resolveSubSelectedArray(e,t,i):e.selectionSet?g.resolveSelectionSet(e.selectionSet,t,i):void 0:t}))]}))}))},e.prototype.resolveSubSelectedArray=function(e,t,i){var s=this;return Promise.all(t.map((function(t){return null===t?null:Array.isArray(t)?s.resolveSubSelectedArray(e,t,i):e.selectionSet?s.resolveSelectionSet(e.selectionSet,t,i):void 0})))},e}(),g=new(r.mr?WeakMap:Map);function f(e,t){var i=e[t];"function"==typeof i&&(e[t]=function(){return g.set(e,(g.get(e)+1)%1e15),i.apply(this,arguments)})}function v(e){e.notifyTimeout&&(clearTimeout(e.notifyTimeout),e.notifyTimeout=void 0)}var y=function(){function e(e){this.cache=e,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.subscriptions=new Set,this.stopped=!1,this.dirty=!1,this.diff=null,this.observableQuery=null,g.has(e)||(g.set(e,0),f(e,"evict"),f(e,"modify"),f(e,"reset"))}return e.prototype.init=function(e){var t=e.networkStatus||d.I.loading;return this.variables&&this.networkStatus!==d.I.loading&&!(0,l.D)(this.variables,e.variables)&&(t=d.I.setVariables),(0,l.D)(e.variables,this.variables)||(this.diff=null),Object.assign(this,{document:e.document,variables:e.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:t}),e.observableQuery&&this.setObservableQuery(e.observableQuery),e.lastRequestId&&(this.lastRequestId=e.lastRequestId),this},e.prototype.reset=function(){v(this),this.diff=null,this.dirty=!1},e.prototype.getDiff=function(e){return void 0===e&&(e=this.variables),this.diff&&(0,l.D)(e,this.variables)?this.diff:(this.updateWatch(this.variables=e),this.diff=this.cache.diff({query:this.document,variables:e,returnPartialData:!0,optimistic:!0}))},e.prototype.setDiff=function(e){var t=this,i=this.diff;this.diff=e,this.dirty||(e&&e.result)===(i&&i.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return t.notify()}),0)))},e.prototype.setObservableQuery=function(e){var t=this;e!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=e,e?(e.queryInfo=this,this.listeners.add(this.oqListener=function(){t.getDiff().fromOptimisticTransaction?e.observe():e.reobserve()})):delete this.oqListener)},e.prototype.notify=function(){var e=this;v(this),this.shouldNotify()&&this.listeners.forEach((function(t){return t(e)})),this.dirty=!1},e.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if((0,d.O)(this.networkStatus)&&this.observableQuery){var e=this.observableQuery.options.fetchPolicy;if("cache-only"!==e&&"cache-and-network"!==e)return!1}return!0},e.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.cancel(),delete this.cancel,this.subscriptions.forEach((function(e){return e.unsubscribe()}));var e=this.observableQuery;e&&e.stopPolling()}},e.prototype.cancel=function(){},e.prototype.updateWatch=function(e){var t=this;void 0===e&&(e=this.variables);var i=this.observableQuery;i&&"no-cache"===i.options.fetchPolicy||this.lastWatch&&this.lastWatch.query===this.document&&(0,l.D)(e,this.lastWatch.variables)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch={query:this.document,variables:e,optimistic:!0,callback:function(e){return t.setDiff(e)}}))},e.prototype.shouldWrite=function(e,t){var i=this.lastWrite;return!(i&&i.dmCount===g.get(this.cache)&&(0,l.D)(t,i.variables)&&(0,l.D)(e.data,i.result.data))},e.prototype.markResult=function(e,t,i){var s=this;this.graphQLErrors=(0,r.Of)(e.errors)?e.errors:[],this.reset(),"no-cache"===t.fetchPolicy?this.diff={result:e.data,complete:!0}:!this.stopped&&i&&(b(e,t.errorPolicy)?this.cache.performTransaction((function(i){if(s.shouldWrite(e,t.variables))i.writeQuery({query:s.document,data:e.data,variables:t.variables}),s.lastWrite={result:e,variables:t.variables,dmCount:g.get(s.cache)};else if(s.diff&&s.diff.complete)return void(e.data=s.diff.result);var n=i.diff({query:s.document,variables:t.variables,returnPartialData:!0,optimistic:!0});s.stopped||s.updateWatch(t.variables),s.diff=n,n.complete&&(e.data=n.result)})):this.lastWrite=void 0)},e.prototype.markReady=function(){return this.networkError=null,this.networkStatus=d.I.ready},e.prototype.markError=function(e){return this.networkStatus=d.I.error,this.lastWrite=void 0,this.reset(),e.graphQLErrors&&(this.graphQLErrors=e.graphQLErrors),e.networkError&&(this.networkError=e.networkError),e},e}();function b(e,t){void 0===t&&(t="none");var i="ignore"===t||"all"===t,s=!(0,r.d2)(e);return!s&&i&&e.data&&(s=!0),s}var w=Object.prototype.hasOwnProperty,S=function(){function e(e){var t=e.cache,i=e.link,s=e.queryDeduplication,n=void 0!==s&&s,o=e.onBroadcast,a=e.ssrMode,l=void 0!==a&&a,c=e.clientAwareness,h=void 0===c?{}:c,d=e.localState,u=e.assumeImmutableResults;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new(r.mr?WeakMap:Map),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Map,this.cache=t,this.link=i,this.queryDeduplication=n,this.clientAwareness=h,this.localState=d||new m({cache:t}),this.ssrMode=l,this.assumeImmutableResults=!!u,(this.onBroadcast=o)&&(this.mutationStore=Object.create(null))}return e.prototype.stop=function(){var e=this;this.queries.forEach((function(t,i){e.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(new n.ej(12))},e.prototype.cancelPendingFetches=function(e){this.fetchCancelFns.forEach((function(t){return t(e)})),this.fetchCancelFns.clear()},e.prototype.mutate=function(e){var t=e.mutation,i=e.variables,o=e.optimisticResponse,a=e.updateQueries,l=e.refetchQueries,h=void 0===l?[]:l,d=e.awaitRefetchQueries,u=void 0!==d&&d,p=e.update,m=e.errorPolicy,g=void 0===m?"none":m,f=e.fetchPolicy,v=e.context,y=void 0===v?{}:v;return(0,s.mG)(this,void 0,void 0,(function(){var e,l,d;return(0,s.Jh)(this,(function(m){switch(m.label){case 0:return(0,n.kG)(t,13),(0,n.kG)(!f||"no-cache"===f,14),e=this.generateMutationId(),t=this.transform(t).document,i=this.getVariables(t,i),this.transform(t).hasClientExports?[4,this.localState.addExportedVariables(t,i,y)]:[3,2];case 1:i=m.sent(),m.label=2;case 2:return l=this.mutationStore&&(this.mutationStore[e]={mutation:t,variables:i,loading:!0,error:null}),o&&this.markMutationOptimistic(o,{mutationId:e,document:t,variables:i,errorPolicy:g,updateQueries:a,update:p}),this.broadcastQueries(),d=this,[2,new Promise((function(n,m){var v,b;d.getObservableFromLink(t,(0,s.pi)((0,s.pi)({},y),{optimisticResponse:o}),i,!1).subscribe({next:function(s){if((0,r.d2)(s)&&"none"===g)b=new c.c({graphQLErrors:s.errors});else{if(l&&(l.loading=!1,l.error=null),"no-cache"!==f)try{d.markMutationResult({mutationId:e,result:s,document:t,variables:i,errorPolicy:g,updateQueries:a,update:p})}catch(e){return void(b=new c.c({networkError:e}))}v=s}},error:function(t){l&&(l.loading=!1,l.error=t),o&&d.cache.removeOptimistic(e),d.broadcastQueries(),m(new c.c({networkError:t}))},complete:function(){if(b&&l&&(l.loading=!1,l.error=b),o&&d.cache.removeOptimistic(e),d.broadcastQueries(),b)m(b);else{"function"==typeof h&&(h=h(v));var t=[];(0,r.Of)(h)&&h.forEach((function(e){if("string"==typeof e)d.queries.forEach((function(i){var s=i.observableQuery;s&&s.queryName===e&&t.push(s.refetch())}));else{var i={query:e.query,variables:e.variables,fetchPolicy:"network-only"};e.context&&(i.context=e.context),t.push(d.query(i))}})),Promise.all(u?t:[]).then((function(){"ignore"===g&&v&&(0,r.d2)(v)&&delete v.errors,n(v)}),m)}}})}))]}}))}))},e.prototype.markMutationResult=function(e,t){var i=this;if(void 0===t&&(t=this.cache),b(e.result,e.errorPolicy)){var s=[{result:e.result.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}],n=e.updateQueries;n&&this.queries.forEach((function(o,a){var l=o.observableQuery,c=l&&l.queryName;if(c&&w.call(n,c)){var h=n[c],d=i.queries.get(a),u=d.document,p=d.variables,m=t.diff({query:u,variables:p,returnPartialData:!0,optimistic:!1}),g=m.result;if(m.complete&&g){var f=h(g,{mutationResult:e.result,queryName:u&&(0,r.rY)(u)||void 0,queryVariables:p});f&&s.push({result:f,dataId:"ROOT_QUERY",query:u,variables:p})}}})),t.performTransaction((function(t){s.forEach((function(e){return t.write(e)}));var i=e.update;i&&i(t,e.result)}),null)}},e.prototype.markMutationOptimistic=function(e,t){var i=this,n="function"==typeof e?e(t.variables):e;return this.cache.recordOptimisticTransaction((function(e){try{i.markMutationResult((0,s.pi)((0,s.pi)({},t),{result:{data:n}}),e)}catch(e){}}),t.mutationId)},e.prototype.fetchQuery=function(e,t,i){return this.fetchQueryObservable(e,t,i).promise},e.prototype.getQueryStore=function(){var e=Object.create(null);return this.queries.forEach((function(t,i){e[i]={variables:t.variables,networkStatus:t.networkStatus,networkError:t.networkError,graphQLErrors:t.graphQLErrors}})),e},e.prototype.resetErrors=function(e){var t=this.queries.get(e);t&&(t.networkError=void 0,t.graphQLErrors=[])},e.prototype.transform=function(e){var t=this.transformCache;if(!t.has(e)){var i=this.cache.transformDocument(e),s=(0,r.Fo)(this.cache.transformForLink(i)),n=this.localState.clientQuery(i),o=s&&this.localState.serverQuery(s),a={document:i,hasClientExports:(0,r.mj)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:n,serverQuery:o,defaultVars:(0,r.O4)((0,r.$H)(i))},l=function(e){e&&!t.has(e)&&t.set(e,a)};l(e),l(i),l(n),l(o)}return t.get(e)},e.prototype.getVariables=function(e,t){return(0,s.pi)((0,s.pi)({},this.transform(e).defaultVars),t)},e.prototype.watchQuery=function(e){void 0===(e=(0,s.pi)((0,s.pi)({},e),{variables:this.getVariables(e.query,e.variables)})).notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var t=new y(this.cache),i=new h.u({queryManager:this,queryInfo:t,options:e});return this.queries.set(i.queryId,t),t.init({document:e.query,observableQuery:i,variables:e.variables}),i},e.prototype.query=function(e){var t=this;(0,n.kG)(e.query,15),(0,n.kG)("Document"===e.query.kind,16),(0,n.kG)(!e.returnPartialData,17),(0,n.kG)(!e.pollInterval,18);var i=this.generateQueryId();return this.fetchQuery(i,e).finally((function(){return t.stopQuery(i)}))},e.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},e.prototype.generateRequestId=function(){return this.requestIdCounter++},e.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){var t=this.queries.get(e);t&&t.stop()},e.prototype.clearStore=function(){return this.cancelPendingFetches(new n.ej(19)),this.queries.forEach((function(e){e.observableQuery?e.networkStatus=d.I.loading:e.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset()},e.prototype.resetStore=function(){var e=this;return this.clearStore().then((function(){return e.reFetchObservableQueries()}))},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var i=[];return this.queries.forEach((function(s,n){var o=s.observableQuery;if(o&&o.hasObservers()){var r=o.options.fetchPolicy;o.resetLastResults(),"cache-only"===r||!e&&"standby"===r||i.push(o.refetch()),t.getQuery(n).setDiff(null)}})),this.broadcastQueries(),Promise.all(i)},e.prototype.setObservableQuery=function(e){this.getQuery(e.queryId).setObservableQuery(e)},e.prototype.startGraphQLSubscription=function(e){var t=this,i=e.query,s=e.fetchPolicy,n=e.errorPolicy,o=e.variables,a=e.context,l=void 0===a?{}:a;i=this.transform(i).document,o=this.getVariables(i,o);var h=function(e){return t.getObservableFromLink(i,l,e,!1).map((function(o){if("no-cache"!==s&&(b(o,n)&&t.cache.write({query:i,result:o.data,dataId:"ROOT_SUBSCRIPTION",variables:e}),t.broadcastQueries()),(0,r.d2)(o))throw new c.c({graphQLErrors:o.errors});return o}))};if(this.transform(i).hasClientExports){var d=this.localState.addExportedVariables(i,o,l).then(h);return new r.y$((function(e){var t=null;return d.then((function(i){return t=i.subscribe(e)}),e.error),function(){return t&&t.unsubscribe()}}))}return h(o)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchCancelFns.delete(e),this.getQuery(e).stop(),this.queries.delete(e)},e.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(e){return e.notify()}))},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,i,n){var a,l,c=this;void 0===n&&(n=null!==(a=null==t?void 0:t.queryDeduplication)&&void 0!==a?a:this.queryDeduplication);var h=this.transform(e).serverQuery;if(h){var d=this.inFlightLinkObservables,u=this.link,p={query:h,variables:i,operationName:(0,r.rY)(h)||void 0,context:this.prepareContext((0,s.pi)((0,s.pi)({},t),{forceFetch:!n}))};if(t=p.context,n){var m=d.get(h)||new Map;d.set(h,m);var g=JSON.stringify(i);if(!(l=m.get(g))){var f=new r.X_([(0,o.ht)(u,p)]);m.set(g,l=f),f.cleanup((function(){m.delete(g)&&m.size<1&&d.delete(h)}))}}else l=new r.X_([(0,o.ht)(u,p)])}else l=new r.X_([r.y$.of({data:{}})]),t=this.prepareContext(t);var v=this.transform(e).clientQuery;return v&&(l=(0,r.sz)(l,(function(e){return c.localState.runResolvers({document:v,remoteResult:e,context:t,variables:i})}))),l},e.prototype.getResultsFromLink=function(e,t,i){var s=e.lastRequestId;return(0,r.sz)(this.getObservableFromLink(e.document,i.context,i.variables),(function(n){var o=(0,r.Of)(n.errors);if(s>=e.lastRequestId){if(o&&"none"===i.errorPolicy)throw e.markError(new c.c({graphQLErrors:n.errors}));e.markResult(n,i,t),e.markReady()}var a={data:n.data,loading:!1,networkStatus:e.networkStatus||d.I.ready};return o&&"ignore"!==i.errorPolicy&&(a.errors=n.errors),a}),(function(t){var i=(0,c.M)(t)?t:new c.c({networkError:t});throw s>=e.lastRequestId&&e.markError(i),i}))},e.prototype.fetchQueryObservable=function(e,t,i){var s=this;void 0===i&&(i=d.I.loading);var n=this.transform(t.query).document,o=this.getVariables(n,t.variables),a=this.getQuery(e),l=a.networkStatus,c=t.fetchPolicy,h=void 0===c?"cache-first":c,u=t.errorPolicy,p=void 0===u?"none":u,m=t.returnPartialData,g=void 0!==m&&m,f=t.notifyOnNetworkStatusChange,v=void 0!==f&&f,y=t.context,b=void 0===y?{}:y;("cache-first"===h||"cache-and-network"===h||"network-only"===h||"no-cache"===h)&&v&&"number"==typeof l&&l!==i&&(0,d.O)(i)&&("cache-first"!==h&&(h="cache-and-network"),g=!0);var w=Object.assign({},t,{query:n,variables:o,fetchPolicy:h,errorPolicy:p,returnPartialData:g,notifyOnNetworkStatusChange:v,context:b}),S=function(e){return w.variables=e,s.fetchQueryByPolicy(a,w,i)};this.fetchCancelFns.set(e,(function(e){Promise.resolve().then((function(){return T.cancel(e)}))}));var T=new r.X_(this.transform(w.query).hasClientExports?this.localState.addExportedVariables(w.query,w.variables,w.context).then(S):S(w.variables));return T.cleanup((function(){s.fetchCancelFns.delete(e);var i=t.nextFetchPolicy;i&&(t.nextFetchPolicy=void 0,t.fetchPolicy="function"==typeof i?i.call(t,t.fetchPolicy||"cache-first"):i)})),T},e.prototype.fetchQueryByPolicy=function(e,t,i){var n=this,o=t.query,a=t.variables,l=t.fetchPolicy,c=t.errorPolicy,h=t.returnPartialData,u=t.context;e.init({document:o,variables:a,lastRequestId:this.generateRequestId(),networkStatus:i});var p=function(){return e.getDiff(a)},m=function(t,i){void 0===i&&(i=e.networkStatus||d.I.loading);var l=t.result,c=function(e){return r.y$.of((0,s.pi)({data:e,loading:(0,d.O)(i),networkStatus:i},t.complete?null:{partial:!0}))};return n.transform(o).hasForcedResolvers?n.localState.runResolvers({document:o,remoteResult:{data:l},context:u,variables:a,onlyRunForcedResolvers:!0}).then((function(e){return c(e.data)})):c(l)},g=function(t){return n.getResultsFromLink(e,t,{variables:a,context:u,fetchPolicy:l,errorPolicy:c})};switch(l){default:case"cache-first":return(f=p()).complete?[m(f,e.markReady())]:h?[m(f),g(!0)]:[g(!0)];case"cache-and-network":var f;return(f=p()).complete||h?[m(f),g(!0)]:[g(!0)];case"cache-only":return[m(p(),e.markReady())];case"network-only":return[g(!0)];case"no-cache":return[g(!1)];case"standby":return[]}},e.prototype.getQuery=function(e){return e&&!this.queries.has(e)&&this.queries.set(e,new y(this.cache)),this.queries.get(e)},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return(0,s.pi)((0,s.pi)({},t),{clientAwareness:this.clientAwareness})},e}();function T(e,t){return(0,r.oA)(e,t,t.variables&&{variables:(0,s.pi)((0,s.pi)({},e.variables),t.variables)})}var E=function(){function e(e){var t=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var i=e.uri,s=e.credentials,r=e.headers,l=e.cache,c=e.ssrMode,h=void 0!==c&&c,d=e.ssrForceFetchDelay,u=void 0===d?0:d,p=e.connectToDevTools,g=void 0===p?"object"==typeof window&&!window.__APOLLO_CLIENT__&&!1:p,f=e.queryDeduplication,v=void 0===f||f,y=e.defaultOptions,b=e.assumeImmutableResults,w=void 0!==b&&b,T=e.resolvers,E=e.typeDefs,_=e.fragmentMatcher,x=e.name,M=e.version,P=e.link;if(P||(P=i?new a.uG({uri:i,credentials:s,headers:r}):o.i0.empty()),!l)throw new n.ej(9);this.link=P,this.cache=l,this.disableNetworkFetches=h||u>0,this.queryDeduplication=v,this.defaultOptions=y||{},this.typeDefs=E,u&&setTimeout((function(){return t.disableNetworkFetches=!1}),u),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),g&&"object"==typeof window&&(window.__APOLLO_CLIENT__=this),this.version="3.3.11",this.localState=new m({cache:l,client:this,resolvers:T,fragmentMatcher:_}),this.queryManager=new S({cache:this.cache,link:this.link,queryDeduplication:v,ssrMode:h,clientAwareness:{name:x,version:M},localState:this.localState,assumeImmutableResults:w,onBroadcast:g?function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.getQueryStore(),mutations:t.queryManager.mutationStore||{}},dataWithOptimisticResults:t.cache.extract(!0)})}:void 0})}return e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=T(this.defaultOptions.watchQuery,e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=(0,s.pi)((0,s.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=T(this.defaultOptions.query,e)),(0,n.kG)("cache-and-network"!==e.fetchPolicy,10),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=(0,s.pi)((0,s.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=T(this.defaultOptions.mutate,e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){this.cache.writeQuery(e),this.queryManager.broadcastQueries()},e.prototype.writeFragment=function(e){this.cache.writeFragment(e),this.queryManager.broadcastQueries()},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return(0,o.ht)(this.link,e)},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.resetStoreCallbacks.map((function(e){return e()})))})).then((function(){return e.reFetchObservableQueries()}))},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.clearStoreCallbacks.map((function(e){return e()})))}))},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e.prototype.setLink=function(e){this.link=this.queryManager.link=e},e}()},66282:(e,t,i)=>{"use strict";i.d(t,{u:()=>c});var s=i(70655),n=i(92924),o=i(82152),r=i(85942),a=i(80496),l=function(){function e(e,t,i,s){this.observer=e,this.options=t,this.fetch=i,this.shouldFetch=s}return e.prototype.reobserve=function(e,t){e?this.updateOptions(e):this.updatePolling();var i=this.fetch(this.options,t);return this.concast&&this.concast.removeObserver(this.observer,!0),i.addObserver(this.observer),(this.concast=i).promise},e.prototype.updateOptions=function(e){return Object.assign(this.options,(0,a.oA)(e)),this.updatePolling(),this},e.prototype.stop=function(){this.concast&&(this.concast.removeObserver(this.observer),delete this.concast),this.pollingInfo&&(clearTimeout(this.pollingInfo.timeout),this.options.pollInterval=0,this.updatePolling())},e.prototype.updatePolling=function(){var e=this,t=this.pollingInfo,i=this.options.pollInterval;if(i){if((!t||t.interval!==i)&&((0,n.kG)(i,20),!1!==this.shouldFetch)){(t||(this.pollingInfo={})).interval=i;var s=function(){e.pollingInfo&&(e.shouldFetch&&e.shouldFetch()?e.reobserve({fetchPolicy:"network-only",nextFetchPolicy:e.options.fetchPolicy||"cache-first"},r.I.poll).then(o,o):o())},o=function(){var t=e.pollingInfo;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(s,t.interval))};o()}}else t&&(clearTimeout(t.timeout),delete this.pollingInfo)},e}(),c=function(e){function t(t){var i=t.queryManager,n=t.queryInfo,o=t.options,l=e.call(this,(function(e){return l.onSubscribe(e)}))||this;l.observers=new Set,l.subscriptions=new Set,l.observer={next:function(e){(l.lastError||l.isDifferentFromLastResult(e))&&(l.updateLastResult(e),(0,a.pM)(l.observers,"next",e))},error:function(e){l.updateLastResult((0,s.pi)((0,s.pi)({},l.lastResult),{error:e,errors:e.graphQLErrors,networkStatus:r.I.error,loading:!1})),(0,a.pM)(l.observers,"error",l.lastError=e)}},l.isTornDown=!1,l.options=o,l.queryId=i.generateQueryId();var c=(0,a.$H)(o.query);return l.queryName=c&&c.name&&c.name.value,l.queryManager=i,l.queryInfo=n,l}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),t.prototype.result=function(){var e=this;return new Promise((function(t,i){var s={next:function(i){t(i),e.observers.delete(s),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout((function(){n.unsubscribe()}),0)},error:i},n=e.subscribe(s)}))},t.prototype.getCurrentResult=function(e){void 0===e&&(e=!0);var t=this.lastResult,i=this.queryInfo.networkStatus||t&&t.networkStatus||r.I.ready,n=(0,s.pi)((0,s.pi)({},t),{loading:(0,r.O)(i),networkStatus:i});if(this.isTornDown)return n;var o=this.options.fetchPolicy,a=void 0===o?"cache-first":o;if("no-cache"===a||"network-only"===a)delete n.partial;else if(!n.data||!this.queryManager.transform(this.options.query).hasForcedResolvers){var l=this.queryInfo.getDiff();n.data=l.complete||this.options.returnPartialData?l.result:void 0,l.complete?(n.networkStatus!==r.I.loading||"cache-first"!==a&&"cache-only"!==a||(n.networkStatus=r.I.ready,n.loading=!1),delete n.partial):n.partial=!0}return e&&this.updateLastResult(n),n},t.prototype.isDifferentFromLastResult=function(e){return!(0,o.D)(this.lastResultSnapshot,e)},t.prototype.getLastResult=function(){return this.lastResult},t.prototype.getLastError=function(){return this.lastError},t.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastResultSnapshot,delete this.lastError,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},t.prototype.refetch=function(e){var t={pollInterval:0},i=this.options.fetchPolicy;return"no-cache"!==i&&"cache-and-network"!==i&&(t.fetchPolicy="network-only",t.nextFetchPolicy=i||"cache-first"),e&&!(0,o.D)(this.options.variables,e)&&(t.variables=this.options.variables=(0,s.pi)((0,s.pi)({},this.options.variables),e)),this.newReobserver(!1).reobserve(t,r.I.refetch)},t.prototype.fetchMore=function(e){var t=this,i=(0,s.pi)((0,s.pi)({},e.query?e:(0,s.pi)((0,s.pi)((0,s.pi)({},this.options),e),{variables:(0,s.pi)((0,s.pi)({},this.options.variables),e.variables)})),{fetchPolicy:"no-cache"}),n=this.queryManager.generateQueryId();return i.notifyOnNetworkStatusChange&&(this.queryInfo.networkStatus=r.I.fetchMore,this.observe()),this.queryManager.fetchQuery(n,i,r.I.fetchMore).then((function(s){var n=s.data,o=e.updateQuery;return o?t.updateQuery((function(e){return o(e,{fetchMoreResult:n,variables:i.variables})})):t.queryManager.cache.writeQuery({query:i.query,variables:i.variables,data:n}),s})).finally((function(){t.queryManager.stopQuery(n),t.reobserve()}))},t.prototype.subscribeToMore=function(e){var t=this,i=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables,context:e.context}).subscribe({next:function(i){var s=e.updateQuery;s&&t.updateQuery((function(e,t){var n=t.variables;return s(e,{subscriptionData:i,variables:n})}))},error:function(t){e.onError&&e.onError(t)}});return this.subscriptions.add(i),function(){t.subscriptions.delete(i)&&i.unsubscribe()}},t.prototype.setOptions=function(e){return this.reobserve(e)},t.prototype.setVariables=function(e){if((0,o.D)(this.variables,e))return this.observers.size?this.result():Promise.resolve();if(this.options.variables=e,!this.observers.size)return Promise.resolve();var t=this.options.fetchPolicy,i=void 0===t?"cache-first":t,s={fetchPolicy:i,variables:e};return"cache-first"!==i&&"no-cache"!==i&&"network-only"!==i&&(s.fetchPolicy="cache-and-network",s.nextFetchPolicy=i),this.reobserve(s,r.I.setVariables)},t.prototype.updateQuery=function(e){var t,i=this.queryManager,s=e(i.cache.diff({query:this.options.query,variables:this.variables,previousResult:null===(t=this.lastResult)||void 0===t?void 0:t.data,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});s&&(i.cache.writeQuery({query:this.options.query,data:s,variables:this.variables}),i.broadcastQueries())},t.prototype.startPolling=function(e){this.getReobserver().updateOptions({pollInterval:e})},t.prototype.stopPolling=function(){this.reobserver&&this.reobserver.updateOptions({pollInterval:0})},t.prototype.updateLastResult=function(e){var t=this.lastResult;return this.lastResult=e,this.lastResultSnapshot=this.queryManager.assumeImmutableResults?e:(0,a.Xh)(e),(0,a.Of)(e.errors)||delete this.lastError,t},t.prototype.onSubscribe=function(e){var t=this;if(e===this.observer)return function(){};try{var i=e._subscription._observer;i&&!i.error&&(i.error=h)}catch(e){}var s=!this.observers.size;return this.observers.add(e),this.lastError?e.error&&e.error(this.lastError):this.lastResult&&e.next&&e.next(this.lastResult),s&&this.reobserve().catch((function(e){})),function(){t.observers.delete(e)&&!t.observers.size&&t.tearDownQuery()}},t.prototype.getReobserver=function(){return this.reobserver||(this.reobserver=this.newReobserver(!0))},t.prototype.newReobserver=function(e){var t=this,i=this.queryManager,n=this.queryId;return i.setObservableQuery(this),new l(this.observer,e?this.options:(0,s.pi)({},this.options),(function(e,s){return i.setObservableQuery(t),i.fetchQueryObservable(n,e,s)}),!i.ssrMode&&function(){return!(0,r.O)(t.queryInfo.networkStatus)})},t.prototype.reobserve=function(e,t){return this.isTornDown=!1,this.getReobserver().reobserve(e,t)},t.prototype.observe=function(){this.observer.next(this.getCurrentResult(!1))},t.prototype.hasObservers=function(){return this.observers.size>0},t.prototype.tearDownQuery=function(){this.isTornDown||(this.reobserver&&(this.reobserver.stop(),delete this.reobserver),this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},t}(a.y$);function h(e){}(0,a.Dy)(c)},71439:(e,t,i)=>{"use strict";i.d(t,{fe:()=>s.f,h4:()=>o.h4,createHttpLink:()=>l.LQ,Ps:()=>h.ZP});var s=i(55765),n=(i(66282),i(85942),i(72191));i.o(n,"createHttpLink")&&i.d(t,{createHttpLink:function(){return n.createHttpLink}}),i(21498);var o=i(62634),r=i(35367);i.o(r,"createHttpLink")&&i.d(t,{createHttpLink:function(){return r.createHttpLink}});var a=i(81707);i.o(a,"createHttpLink")&&i.d(t,{createHttpLink:function(){return a.createHttpLink}});var l=i(96593),c=(i(84913),i(80496),i(92924)),h=i(91466);(0,c.U6)("log"),h.ZP.resetCaches,h.ZP.disableFragmentWarnings,h.ZP.enableExperimentalFragmentVariables,h.ZP.disableExperimentalFragmentVariables},85942:(e,t,i)=>{"use strict";var s;function n(e){return!!e&&e<7}i.d(t,{I:()=>s,O:()=>n}),function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(s||(s={}))},72191:()=>{},21498:(e,t,i)=>{"use strict";i.d(t,{M:()=>o,c:()=>r});var s=i(70655),n=i(80496);function o(e){return e.hasOwnProperty("graphQLErrors")}var r=function(e){function t(i){var s,o,r=i.graphQLErrors,a=i.networkError,l=i.errorMessage,c=i.extraInfo,h=e.call(this,l)||this;return h.graphQLErrors=r||[],h.networkError=a||null,h.message=l||(s=h,o="",(0,n.Of)(s.graphQLErrors)&&s.graphQLErrors.forEach((function(e){var t=e?e.message:"Error message not found.";o+=t+"\n"})),s.networkError&&(o+=s.networkError.message+"\n"),o=o.replace(/\n$/,"")),h.extraInfo=c,h.__proto__=t.prototype,h}return(0,s.ZT)(t,e),t}(Error)},97222:(e,t,i)=>{"use strict";i.d(t,{i:()=>d});var s,n=i(70655),o=i(92924),r=i(80496),a=i(84913);function l(e,t){return t?t(e):r.y$.of()}function c(e){return"function"==typeof e?new d(e):e}function h(e){return e.request.length<=1}s=Error,(0,n.ZT)((function(e,t){var i=s.call(this,e)||this;return i.link=t,i}),s);var d=function(){function e(e){e&&(this.request=e)}return e.empty=function(){return new e((function(){return r.y$.of()}))},e.from=function(t){return 0===t.length?e.empty():t.map(c).reduce((function(e,t){return e.concat(t)}))},e.split=function(t,i,s){var n=c(i),o=c(s||new e(l));return h(n)&&h(o)?new e((function(e){return t(e)?n.request(e)||r.y$.of():o.request(e)||r.y$.of()})):new e((function(e,i){return t(e)?n.request(e,i)||r.y$.of():o.request(e,i)||r.y$.of()}))},e.execute=function(e,t){return e.request((0,a.zi)(t.context,(0,a.DQ)((0,a.Ak)(t))))||r.y$.of()},e.concat=function(t,i){var s=c(t);if(h(s))return s;var n=c(i);return h(n)?new e((function(e){return s.request(e,(function(e){return n.request(e)||r.y$.of()}))||r.y$.of()})):new e((function(e,t){return s.request(e,(function(e){return n.request(e,t)||r.y$.of()}))||r.y$.of()}))},e.prototype.split=function(t,i,s){return this.concat(e.split(t,i,s||new e(l)))},e.prototype.concat=function(t){return e.concat(this,t)},e.prototype.request=function(e,t){throw new o.ej(21)},e.prototype.onError=function(e,t){if(t&&t.error)return t.error(e),!1;throw e},e.prototype.setOnError=function(e){return this.onError=e,this},e}()},24957:(e,t,i)=>{"use strict";i(97222).i.concat},67325:(e,t,i)=>{"use strict";i(97222).i.empty},2550:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});var s=i(97222).i.execute},34674:(e,t,i)=>{"use strict";i(97222).i.from},81707:(e,t,i)=>{"use strict";i.d(t,{ht:()=>s.h,i0:()=>n.i}),i(67325),i(34674),i(64738),i(24957);var s=i(2550),n=i(97222),o=i(79875);i.o(o,"createHttpLink")&&i.d(t,{createHttpLink:function(){return o.createHttpLink}})},64738:(e,t,i)=>{"use strict";i(97222).i.split},79875:()=>{},96593:(e,t,i)=>{"use strict";i.d(t,{uG:()=>m,LQ:()=>p});var s=i(84913),n=Object.prototype.hasOwnProperty,o=i(92924),r=function(e,t){var i;try{i=JSON.stringify(e)}catch(e){var s=new o.ej(23);throw s.parseError=e,s}return i},a=i(70655),l=i(90778),c={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},h=i(80285),d=i(81707),u=i(80496),p=function(e){void 0===e&&(e={});var t=e.uri,i=void 0===t?"/graphql":t,p=e.fetch,m=e.includeExtensions,g=e.useGETForQueries,f=e.includeUnusedVariables,v=void 0!==f&&f,y=(0,a._T)(e,["uri","fetch","includeExtensions","useGETForQueries","includeUnusedVariables"]);!function(e){if(!e&&"undefined"==typeof fetch)throw new o.ej(22)}(p),p||(p=fetch);var b={http:{includeExtensions:m},options:y.fetchOptions,credentials:y.credentials,headers:y.headers};return new d.i0((function(e){var t=function(e,t){return e.getContext().uri||("function"==typeof t?t(e):t||"/graphql")}(e,i),o=e.getContext(),d={};if(o.clientAwareness){var m=o.clientAwareness,f=m.name,y=m.version;f&&(d["apollographql-client-name"]=f),y&&(d["apollographql-client-version"]=y)}var w,S=(0,a.pi)((0,a.pi)({},d),o.headers),T={http:o.http,options:o.fetchOptions,credentials:o.credentials,headers:S},E=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var n=(0,a.pi)((0,a.pi)({},t.options),{headers:t.headers,credentials:t.credentials}),o=t.http||{};i.forEach((function(e){n=(0,a.pi)((0,a.pi)((0,a.pi)({},n),e.options),{headers:(0,a.pi)((0,a.pi)({},n.headers),e.headers)}),e.credentials&&(n.credentials=e.credentials),o=(0,a.pi)((0,a.pi)({},o),e.http)}));var r=e.operationName,c=e.extensions,h=e.variables,d=e.query,u={operationName:r,variables:h};return o.includeExtensions&&(u.extensions=c),o.includeQuery&&(u.query=(0,l.S)(d)),{options:n,body:u}}(e,c,b,T),_=E.options,x=E.body;if(x.variables&&!v){var M=new Set(Object.keys(x.variables));(0,h.Vn)(e.query,{Variable:function(e,t,i){i&&"VariableDefinition"!==i.kind&&M.delete(e.name.value)}}),M.size&&(x.variables=(0,a.pi)({},x.variables),M.forEach((function(e){delete x.variables[e]})))}if(!_.signal){var P=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var e=new AbortController;return{controller:e,signal:e.signal}}(),A=P.controller,O=P.signal;(w=A)&&(_.signal=O)}if(g&&!e.query.definitions.some((function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation}))&&(_.method="GET"),"GET"===_.method){var D=function(e,t){var i=[],s=function(e,t){i.push(e+"="+encodeURIComponent(t))};if("query"in t&&s("query",t.query),t.operationName&&s("operationName",t.operationName),t.variables){var n=void 0;try{n=r(t.variables)}catch(e){return{parseError:e}}s("variables",n)}if(t.extensions){var o=void 0;try{o=r(t.extensions)}catch(e){return{parseError:e}}s("extensions",o)}var a="",l=e,c=e.indexOf("#");-1!==c&&(a=e.substr(c),l=e.substr(0,c));var h=-1===l.indexOf("?")?"?":"&";return{newURI:l+h+i.join("&")+a}}(t,x),I=D.newURI,C=D.parseError;if(C)return(0,s.Qc)(C);t=I}else try{_.body=r(x)}catch(C){return(0,s.Qc)(C)}return new u.y$((function(i){var o;return p(t,_).then((function(t){return e.setContext({response:t}),t})).then((o=e,function(e){return e.text().then((function(t){try{return JSON.parse(t)}catch(s){var i=s;throw i.name="ServerParseError",i.response=e,i.statusCode=e.status,i.bodyText=t,i}})).then((function(t){return e.status>=300&&(0,s.PW)(e,t,"Response not successful: Received status code "+e.status),Array.isArray(t)||n.call(t,"data")||n.call(t,"errors")||(0,s.PW)(e,t,"Server response was missing for query '"+(Array.isArray(o)?o.map((function(e){return e.operationName})):o.operationName)+"'."),t}))})).then((function(e){return i.next(e),i.complete(),e})).catch((function(e){"AbortError"!==e.name&&(e.result&&e.result.errors&&e.result.data&&i.next(e.result),i.error(e))})),function(){w&&w.abort()}}))}))},m=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,p(t).request)||this;return i.options=t,i}return(0,a.ZT)(t,e),t}(d.i0)},84913:(e,t,i)=>{"use strict";i.d(t,{zi:()=>c,Qc:()=>n,PW:()=>r,DQ:()=>h,Ak:()=>a});var s=i(80496);function n(e){return new s.y$((function(t){t.error(e)}))}var o=i(92924),r=function(e,t,i){var s=new Error(i);throw s.name="ServerError",s.response=e,s.statusCode=e.status,s.result=t,s};function a(e){for(var t=["query","operationName","variables","extensions","context"],i=0,s=Object.keys(e);i<s.length;i++){var n=s[i];if(t.indexOf(n)<0)throw new o.ej(26)}return e}var l=i(70655);function c(e,t){var i=(0,l.pi)({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){i="function"==typeof e?(0,l.pi)((0,l.pi)({},i),e(i)):(0,l.pi)((0,l.pi)({},i),e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return(0,l.pi)({},i)}}),t}function h(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?(0,s.rY)(t.query)||void 0:""),t}},91466:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>X});var s=i(70655);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var o="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag";function r(e,t){for(var i,s=/\r\n|[\n\r]/g,n=1,o=t+1;(i=s.exec(e.body))&&i.index<t;)n+=1,o=t+1-(i.index+i[0].length);return{line:n,column:o}}function a(e){return l(e.source,r(e.source,e.start))}function l(e,t){var i=e.locationOffset.column-1,s=h(i)+e.body,n=t.line-1,o=e.locationOffset.line-1,r=t.line+o,a=1===t.line?i:0,l=t.column+a,d="".concat(e.name,":").concat(r,":").concat(l,"\n"),u=s.split(/\r\n|[\n\r]/g),p=u[n];if(p.length>120){for(var m=Math.floor(l/80),g=l%80,f=[],v=0;v<p.length;v+=80)f.push(p.slice(v,v+80));return d+c([["".concat(r),f[0]]].concat(f.slice(1,m+1).map((function(e){return["",e]})),[[" ",h(g-1)+"^"],["",f[m+1]]]))}return d+c([["".concat(r-1),u[n-1]],["".concat(r),p],["",h(l-1)+"^"],["".concat(r+1),u[n+1]]])}function c(e){var t=e.filter((function(e){return e[0],void 0!==e[1]})),i=Math.max.apply(Math,t.map((function(e){return e[0].length})));return t.map((function(e){var t,s=e[0],n=e[1];return h(i-(t=s).length)+t+(n?" | "+n:" |")})).join("\n")}function h(e){return Array(e+1).join(" ")}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function p(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return f(e,arguments,b(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),y(s,e)})(e)}function f(e,t,i){return(f=v()?Reflect.construct:function(e,t,i){var s=[null];s.push.apply(s,t);var n=new(Function.bind.apply(e,s));return i&&y(n,i.prototype),n}).apply(null,arguments)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(d,e);var t,i,s,c,h=(t=d,i=v(),function(){var e,s=b(t);if(i){var n=b(this).constructor;e=Reflect.construct(s,arguments,n)}else e=s.apply(this,arguments);return p(this,e)});function d(e,t,i,s,o,a,l){var c,u,g,f,v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),v=h.call(this,e);var y,b=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,w=i;!w&&b&&(w=null===(y=b[0].loc)||void 0===y?void 0:y.source);var S,T=s;!T&&b&&(T=b.reduce((function(e,t){return t.loc&&e.push(t.loc.start),e}),[])),T&&0===T.length&&(T=void 0),s&&i?S=s.map((function(e){return r(i,e)})):b&&(S=b.reduce((function(e,t){return t.loc&&e.push(r(t.loc.source,t.loc.start)),e}),[]));var E,_=l;if(null==_&&null!=a){var x=a.extensions;"object"==n(E=x)&&null!==E&&(_=x)}return Object.defineProperties(m(v),{name:{value:"GraphQLError"},message:{value:e,enumerable:!0,writable:!0},locations:{value:null!==(c=S)&&void 0!==c?c:void 0,enumerable:null!=S},path:{value:null!=o?o:void 0,enumerable:null!=o},nodes:{value:null!=b?b:void 0},source:{value:null!==(u=w)&&void 0!==u?u:void 0},positions:{value:null!==(g=T)&&void 0!==g?g:void 0},originalError:{value:a},extensions:{value:null!==(f=_)&&void 0!==f?f:void 0,enumerable:null!=_}}),null!=a&&a.stack?(Object.defineProperty(m(v),"stack",{value:a.stack,writable:!0,configurable:!0}),p(v)):(Error.captureStackTrace?Error.captureStackTrace(m(v),d):Object.defineProperty(m(v),"stack",{value:Error().stack,writable:!0,configurable:!0}),v)}return s=d,(c=[{key:"toString",value:function(){return function(e){var t=e.message;if(e.nodes)for(var i=0,s=e.nodes;i<s.length;i++){var n=s[i];n.loc&&(t+="\n\n"+a(n.loc))}else if(e.source&&e.locations)for(var o=0,r=e.locations;o<r.length;o++){var c=r[o];t+="\n\n"+l(e.source,c)}return t}(this)}},{key:o,get:function(){return"Object"}}])&&u(s.prototype,c),d}(g(Error));function S(e,t,i){return new w("Syntax Error: ".concat(i),void 0,e,[t])}var T=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"}),E=i(83059),_=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"}),x=i(6589);function M(e,t){if(!Boolean(e))throw new Error(t)}function P(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var A=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof e||M(0,"Body must be a string. Received: ".concat((0,x.Z)(e),".")),this.body=e,this.name=t,this.locationOffset=i,this.locationOffset.line>0||M(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||M(0,"column in locationOffset is 1-indexed and must be positive.")}var t,i;return t=e,(i=[{key:o,get:function(){return"Source"}}])&&P(t.prototype,i),e}(),O=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}),D=i(7420),I=function(){function e(e){var t=new E.WU(_.SOF,0,0,0,0,null);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function(){var e=this.token;if(e.kind!==_.EOF)do{var t;e=null!==(t=e.next)&&void 0!==t?t:e.next=R(this,e)}while(e.kind===_.COMMENT);return e},e}();function C(e){return isNaN(e)?_.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function R(e,t){for(var i=e.source,s=i.body,n=s.length,o=t.end;o<n;){var r=s.charCodeAt(o),a=e.line,l=1+o-e.lineStart;switch(r){case 65279:case 9:case 32:case 44:++o;continue;case 10:++o,++e.line,e.lineStart=o;continue;case 13:10===s.charCodeAt(o+1)?o+=2:++o,++e.line,e.lineStart=o;continue;case 33:return new E.WU(_.BANG,o,o+1,a,l,t);case 35:return N(i,o,a,l,t);case 36:return new E.WU(_.DOLLAR,o,o+1,a,l,t);case 38:return new E.WU(_.AMP,o,o+1,a,l,t);case 40:return new E.WU(_.PAREN_L,o,o+1,a,l,t);case 41:return new E.WU(_.PAREN_R,o,o+1,a,l,t);case 46:if(46===s.charCodeAt(o+1)&&46===s.charCodeAt(o+2))return new E.WU(_.SPREAD,o,o+3,a,l,t);break;case 58:return new E.WU(_.COLON,o,o+1,a,l,t);case 61:return new E.WU(_.EQUALS,o,o+1,a,l,t);case 64:return new E.WU(_.AT,o,o+1,a,l,t);case 91:return new E.WU(_.BRACKET_L,o,o+1,a,l,t);case 93:return new E.WU(_.BRACKET_R,o,o+1,a,l,t);case 123:return new E.WU(_.BRACE_L,o,o+1,a,l,t);case 124:return new E.WU(_.PIPE,o,o+1,a,l,t);case 125:return new E.WU(_.BRACE_R,o,o+1,a,l,t);case 34:return 34===s.charCodeAt(o+1)&&34===s.charCodeAt(o+2)?U(i,o,a,l,t,e):B(i,o,a,l,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return k(i,o,r,a,l,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return G(i,o,a,l,t)}throw S(i,o,L(r))}var c=e.line,h=1+o-e.lineStart;return new E.WU(_.EOF,n,n,c,h,t)}function L(e){return e<32&&9!==e&&10!==e&&13!==e?"Cannot contain the invalid character ".concat(C(e),"."):39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(C(e),".")}function N(e,t,i,s,n){var o,r=e.body,a=t;do{o=r.charCodeAt(++a)}while(!isNaN(o)&&(o>31||9===o));return new E.WU(_.COMMENT,t,a,i,s,n,r.slice(t+1,a))}function k(e,t,i,s,n,o){var r=e.body,a=i,l=t,c=!1;if(45===a&&(a=r.charCodeAt(++l)),48===a){if((a=r.charCodeAt(++l))>=48&&a<=57)throw S(e,l,"Invalid number, unexpected digit after 0: ".concat(C(a),"."))}else l=F(e,l,a),a=r.charCodeAt(l);if(46===a&&(c=!0,a=r.charCodeAt(++l),l=F(e,l,a),a=r.charCodeAt(l)),69!==a&&101!==a||(c=!0,43!==(a=r.charCodeAt(++l))&&45!==a||(a=r.charCodeAt(++l)),l=F(e,l,a),a=r.charCodeAt(l)),46===a||function(e){return 95===e||e>=65&&e<=90||e>=97&&e<=122}(a))throw S(e,l,"Invalid number, expected digit but got: ".concat(C(a),"."));return new E.WU(c?_.FLOAT:_.INT,t,l,s,n,o,r.slice(t,l))}function F(e,t,i){var s=e.body,n=t,o=i;if(o>=48&&o<=57){do{o=s.charCodeAt(++n)}while(o>=48&&o<=57);return n}throw S(e,n,"Invalid number, expected digit but got: ".concat(C(o),"."))}function B(e,t,i,s,n){for(var o,r,a,l,c=e.body,h=t+1,d=h,u=0,p="";h<c.length&&!isNaN(u=c.charCodeAt(h))&&10!==u&&13!==u;){if(34===u)return p+=c.slice(d,h),new E.WU(_.STRING,t,h+1,i,s,n,p);if(u<32&&9!==u)throw S(e,h,"Invalid character within String: ".concat(C(u),"."));if(++h,92===u){switch(p+=c.slice(d,h-1),u=c.charCodeAt(h)){case 34:p+='"';break;case 47:p+="/";break;case 92:p+="\\";break;case 98:p+="\b";break;case 102:p+="\f";break;case 110:p+="\n";break;case 114:p+="\r";break;case 116:p+="\t";break;case 117:var m=(o=c.charCodeAt(h+1),r=c.charCodeAt(h+2),a=c.charCodeAt(h+3),l=c.charCodeAt(h+4),H(o)<<12|H(r)<<8|H(a)<<4|H(l));if(m<0){var g=c.slice(h+1,h+5);throw S(e,h,"Invalid character escape sequence: \\u".concat(g,"."))}p+=String.fromCharCode(m),h+=4;break;default:throw S(e,h,"Invalid character escape sequence: \\".concat(String.fromCharCode(u),"."))}d=++h}}throw S(e,h,"Unterminated string.")}function U(e,t,i,s,n,o){for(var r=e.body,a=t+3,l=a,c=0,h="";a<r.length&&!isNaN(c=r.charCodeAt(a));){if(34===c&&34===r.charCodeAt(a+1)&&34===r.charCodeAt(a+2))return h+=r.slice(l,a),new E.WU(_.BLOCK_STRING,t,a+3,i,s,n,(0,D.W7)(h));if(c<32&&9!==c&&10!==c&&13!==c)throw S(e,a,"Invalid character within String: ".concat(C(c),"."));10===c?(++a,++o.line,o.lineStart=a):13===c?(10===r.charCodeAt(a+1)?a+=2:++a,++o.line,o.lineStart=a):92===c&&34===r.charCodeAt(a+1)&&34===r.charCodeAt(a+2)&&34===r.charCodeAt(a+3)?(h+=r.slice(l,a)+'"""',l=a+=4):++a}throw S(e,a,"Unterminated string.")}function H(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function G(e,t,i,s,n){for(var o=e.body,r=o.length,a=t+1,l=0;a!==r&&!isNaN(l=o.charCodeAt(a))&&(95===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122);)++a;return new E.WU(_.NAME,t,a,i,s,n,o.slice(t,a))}var V=function(){function e(e,t){var i=function(e){return e instanceof A}(e)?e:new A(e);this._lexer=new I(i),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(_.NAME);return{kind:T.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:T.DOCUMENT,definitions:this.many(_.SOF,this.parseDefinition,_.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(_.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(_.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var e=this._lexer.token;if(this.peek(_.BRACE_L))return{kind:T.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(e)};var t,i=this.parseOperationType();return this.peek(_.NAME)&&(t=this.parseName()),{kind:T.OPERATION_DEFINITION,operation:i,name:t,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseOperationType=function(){var e=this.expectToken(_.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(_.PAREN_L,this.parseVariableDefinition,_.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:T.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(_.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(_.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(_.DOLLAR),{kind:T.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:T.SELECTION_SET,selections:this.many(_.BRACE_L,this.parseSelection,_.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(_.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,i=this._lexer.token,s=this.parseName();return this.expectOptionalToken(_.COLON)?(e=s,t=this.parseName()):t=s,{kind:T.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(_.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(_.PAREN_L,t,_.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(_.COLON),{kind:T.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:T.ARGUMENT,name:this.parseName(),value:(this.expectToken(_.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(_.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(_.NAME)?{kind:T.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:T.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(e=this._options)||void 0===e?void 0:e.experimentalFragmentVariables)?{kind:T.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:T.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case _.BRACKET_L:return this.parseList(e);case _.BRACE_L:return this.parseObject(e);case _.INT:return this._lexer.advance(),{kind:T.INT,value:t.value,loc:this.loc(t)};case _.FLOAT:return this._lexer.advance(),{kind:T.FLOAT,value:t.value,loc:this.loc(t)};case _.STRING:case _.BLOCK_STRING:return this.parseStringLiteral();case _.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:T.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:T.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:T.NULL,loc:this.loc(t)};default:return{kind:T.ENUM,value:t.value,loc:this.loc(t)}}case _.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:T.STRING,value:e.value,block:e.kind===_.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,i=this._lexer.token;return{kind:T.LIST,values:this.any(_.BRACKET_L,(function(){return t.parseValueLiteral(e)}),_.BRACKET_R),loc:this.loc(i)}},t.parseObject=function(e){var t=this,i=this._lexer.token;return{kind:T.OBJECT,fields:this.any(_.BRACE_L,(function(){return t.parseObjectField(e)}),_.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function(e){var t=this._lexer.token,i=this.parseName();return this.expectToken(_.COLON),{kind:T.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(_.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(_.AT),{kind:T.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return this.expectOptionalToken(_.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(_.BRACKET_R),e={kind:T.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(_.BANG)?{kind:T.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:T.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===_.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(_.STRING)||this.peek(_.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),s=this.many(_.BRACE_L,this.parseOperationTypeDefinition,_.BRACE_R);return{kind:T.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:s,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(_.COLON);var i=this.parseNamedType();return{kind:T.OPERATION_TYPE_DEFINITION,operation:t,type:i,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),s=this.parseDirectives(!0);return{kind:T.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:s,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),s=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:T.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:s,directives:n,fields:o,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLImplementsInterfaces)){var t=[];this.expectOptionalToken(_.AMP);do{t.push(this.parseNamedType())}while(this.expectOptionalToken(_.AMP)||this.peek(_.NAME));return t}return this.delimitedMany(_.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLEmptyFields)&&this.peek(_.BRACE_L)&&this._lexer.lookahead().kind===_.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(_.BRACE_L,this.parseFieldDefinition,_.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),s=this.parseArgumentDefs();this.expectToken(_.COLON);var n=this.parseTypeReference(),o=this.parseDirectives(!0);return{kind:T.FIELD_DEFINITION,description:t,name:i,arguments:s,type:n,directives:o,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(_.PAREN_L,this.parseInputValueDef,_.PAREN_R)},t.parseInputValueDef=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName();this.expectToken(_.COLON);var s,n=this.parseTypeReference();this.expectOptionalToken(_.EQUALS)&&(s=this.parseValueLiteral(!0));var o=this.parseDirectives(!0);return{kind:T.INPUT_VALUE_DEFINITION,description:t,name:i,type:n,defaultValue:s,directives:o,loc:this.loc(e)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),s=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:T.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:s,directives:n,fields:o,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),s=this.parseDirectives(!0),n=this.parseUnionMemberTypes();return{kind:T.UNION_TYPE_DEFINITION,description:t,name:i,directives:s,types:n,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(_.EQUALS)?this.delimitedMany(_.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),s=this.parseDirectives(!0),n=this.parseEnumValuesDefinition();return{kind:T.ENUM_TYPE_DEFINITION,description:t,name:i,directives:s,values:n,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(_.BRACE_L,this.parseEnumValueDefinition,_.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),s=this.parseDirectives(!0);return{kind:T.ENUM_VALUE_DEFINITION,description:t,name:i,directives:s,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),s=this.parseDirectives(!0),n=this.parseInputFieldsDefinition();return{kind:T.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:s,fields:n,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(_.BRACE_L,this.parseInputValueDef,_.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===_.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),i=this.optionalMany(_.BRACE_L,this.parseOperationTypeDefinition,_.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return{kind:T.SCHEMA_EXTENSION,directives:t,operationTypes:i,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:T.SCALAR_TYPE_EXTENSION,name:t,directives:i,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),n=this.parseFieldsDefinition();if(0===i.length&&0===s.length&&0===n.length)throw this.unexpected();return{kind:T.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:s,fields:n,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),n=this.parseFieldsDefinition();if(0===i.length&&0===s.length&&0===n.length)throw this.unexpected();return{kind:T.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:s,fields:n,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),i=this.parseDirectives(!0),s=this.parseUnionMemberTypes();if(0===i.length&&0===s.length)throw this.unexpected();return{kind:T.UNION_TYPE_EXTENSION,name:t,directives:i,types:s,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),i=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();if(0===i.length&&0===s.length)throw this.unexpected();return{kind:T.ENUM_TYPE_EXTENSION,name:t,directives:i,values:s,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),i=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();if(0===i.length&&0===s.length)throw this.unexpected();return{kind:T.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:s,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(_.AT);var i=this.parseName(),s=this.parseArgumentDefs(),n=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var o=this.parseDirectiveLocations();return{kind:T.DIRECTIVE_DEFINITION,description:t,name:i,arguments:s,repeatable:n,locations:o,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(_.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==O[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if(!0!==(null===(t=this._options)||void 0===t?void 0:t.noLocation))return new E.Ye(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw S(this._lexer.source,t.start,"Expected ".concat(j(e),", found ").concat(z(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind!==_.NAME||t.value!==e)throw S(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(z(t),"."));this._lexer.advance()},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===_.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return S(this._lexer.source,t.start,"Unexpected ".concat(z(t),"."))},t.any=function(e,t,i){this.expectToken(e);for(var s=[];!this.expectOptionalToken(i);)s.push(t.call(this));return s},t.optionalMany=function(e,t,i){if(this.expectOptionalToken(e)){var s=[];do{s.push(t.call(this))}while(!this.expectOptionalToken(i));return s}return[]},t.many=function(e,t,i){this.expectToken(e);var s=[];do{s.push(t.call(this))}while(!this.expectOptionalToken(i));return s},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var i=[];do{i.push(t.call(this))}while(this.expectOptionalToken(e));return i},e}();function z(e){var t=e.value;return j(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function j(e){return function(e){return e===_.BANG||e===_.DOLLAR||e===_.AMP||e===_.PAREN_L||e===_.PAREN_R||e===_.SPREAD||e===_.COLON||e===_.EQUALS||e===_.AT||e===_.BRACKET_L||e===_.BRACKET_R||e===_.BRACE_L||e===_.PIPE||e===_.BRACE_R}(e)?'"'.concat(e,'"'):e}var W=new Map,Z=new Map,q=!0,K=!1;function Y(e){return e.replace(/[\s,]+/g," ").trim()}function $(e){var t=Y(e);if(!W.has(t)){var i=function(e,t){return new V(e,t).parseDocument()}(e,{experimentalFragmentVariables:K});if(!i||"Document"!==i.kind)throw new Error("Not a valid GraphQL document.");W.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(i){var s=e[i];s&&"object"==typeof s&&t.add(s)}))}));var i=e.loc;return i&&(delete i.startToken,delete i.endToken),e}(function(e){var t=new Set,i=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var s=e.name.value,n=Y((r=e.loc).source.body.substring(r.start,r.end)),o=Z.get(s);o&&!o.has(n)?q&&console.warn("Warning: fragment with name "+s+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):o||Z.set(s,o=new Set),o.add(n),t.has(n)||(t.add(n),i.push(e))}else i.push(e);var r})),(0,s.pi)((0,s.pi)({},e),{definitions:i})}(i)))}return W.get(t)}function Q(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"string"==typeof e&&(e=[e]);var s=e[0];return t.forEach((function(t,i){t&&"Document"===t.kind?s+=t.loc.source.body:s+=t,s+=e[i+1]})),$(s)}const X=Object.assign(Q,{gql:Q,default:Q,resetCaches:function(){W.clear(),Z.clear()},disableFragmentWarnings:function(){q=!1},enableExperimentalFragmentVariables:function(){K=!0},disableExperimentalFragmentVariables:function(){K=!1}})},80496:(e,t,i)=>{"use strict";i.d(t,{X_:()=>re,w0:()=>Y,y$:()=>Q(),Gw:()=>B,NC:()=>w,sz:()=>se,aL:()=>V,mr:()=>ce,Xh:()=>J,oA:()=>he,F:()=>h,Dy:()=>ne,O4:()=>I,kU:()=>A,hi:()=>d,Yk:()=>c,p$:()=>D,$H:()=>M,rY:()=>P,iW:()=>O,PT:()=>b,qw:()=>T,d2:()=>le,mj:()=>a,FS:()=>r,My:()=>E,Ao:()=>_,Of:()=>ae,hh:()=>g,pM:()=>ie,kQ:()=>m,Jv:()=>te,Ee:()=>W,bw:()=>Z,ob:()=>z,Fo:()=>H,u2:()=>S,LZ:()=>o,vf:()=>v});var s=i(27636),n=i(92924);function o(e,t){var i=e.directives;return!i||!i.length||function(e){var t=[];return e&&e.length&&e.forEach((function(e){if(function(e){var t=e.name.value;return"skip"===t||"include"===t}(e)){var i=e.arguments;e.name.value,(0,n.kG)(i&&1===i.length,39);var s=i[0];(0,n.kG)(s.name&&"if"===s.name.value,40);var o=s.value;(0,n.kG)(o&&("Variable"===o.kind||"BooleanValue"===o.kind),41),t.push({directive:e,ifArgument:s})}})),t}(i).every((function(e){var i=e.directive,s=e.ifArgument,o=!1;return"Variable"===s.value.kind?(o=t&&t[s.value.name.value],(0,n.kG)(void 0!==o,38)):o=s.value.value,"skip"===i.name.value?!o:o}))}function r(e,t){return function(e){var t=[];return(0,s.Vn)(e,{Directive:function(e){t.push(e.name.value)}}),t}(t).some((function(t){return e.indexOf(t)>-1}))}function a(e){return e&&r(["client"],e)&&r(["export"],e)}var l=i(70655);function c(e,t){var i=t,s=[];return e.definitions.forEach((function(e){if("OperationDefinition"===e.kind)throw new n.ej(42);"FragmentDefinition"===e.kind&&s.push(e)})),void 0===i&&((0,n.kG)(1===s.length,43),i=s[0].name.value),(0,l.pi)((0,l.pi)({},e),{definitions:(0,l.pr)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],e.definitions)})}function h(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.name.value]=e})),t}function d(e,t){switch(e.kind){case"InlineFragment":return e;case"FragmentSpread":var i=t&&t[e.name.value];return(0,n.kG)(i,44),i;default:return null}}var u=i(35035),p=i.n(u);function m(e){return{__ref:String(e)}}function g(e){return Boolean(e&&"object"==typeof e&&"string"==typeof e.__ref)}function f(e,t,i,s){if(function(e){return"IntValue"===e.kind}(i)||function(e){return"FloatValue"===e.kind}(i))e[t.value]=Number(i.value);else if(function(e){return"BooleanValue"===e.kind}(i)||function(e){return"StringValue"===e.kind}(i))e[t.value]=i.value;else if(function(e){return"ObjectValue"===e.kind}(i)){var o={};i.fields.map((function(e){return f(o,e.name,e.value,s)})),e[t.value]=o}else if(function(e){return"Variable"===e.kind}(i)){var r=(s||{})[i.name.value];e[t.value]=r}else if(function(e){return"ListValue"===e.kind}(i))e[t.value]=i.values.map((function(e){var i={};return f(i,t,e,s),i[t.value]}));else if(function(e){return"EnumValue"===e.kind}(i))e[t.value]=i.value;else{if(!function(e){return"NullValue"===e.kind}(i))throw new n.ej(53);e[t.value]=null}}function v(e,t){var i=null;e.directives&&(i={},e.directives.forEach((function(e){i[e.name.value]={},e.arguments&&e.arguments.forEach((function(s){var n=s.name,o=s.value;return f(i[e.name.value],n,o,t)}))})));var s=null;return e.arguments&&e.arguments.length&&(s={},e.arguments.forEach((function(e){var i=e.name,n=e.value;return f(s,i,n,t)}))),b(e.name.value,s,i)}var y=["connection","include","skip","client","rest","export"];function b(e,t,i){if(t&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var s=i.connection.filter?i.connection.filter:[];s.sort();var n={};return s.forEach((function(e){n[e]=t[e]})),i.connection.key+"("+JSON.stringify(n)+")"}return i.connection.key}var o=e;if(t){var r=p()(t);o+="("+r+")"}return i&&Object.keys(i).forEach((function(e){-1===y.indexOf(e)&&(i[e]&&Object.keys(i[e]).length?o+="@"+e+"("+JSON.stringify(i[e])+")":o+="@"+e)})),o}function w(e,t){if(e.arguments&&e.arguments.length){var i={};return e.arguments.forEach((function(e){var s=e.name,n=e.value;return f(i,s,n,t)})),i}return null}function S(e){return e.alias?e.alias.value:e.name.value}function T(e,t,i){if("string"==typeof e.__typename)return e.__typename;for(var s=0,n=t.selections;s<n.length;s++){var o=n[s];if(E(o)){if("__typename"===o.name.value)return e[S(o)]}else{var r=T(e,d(o,i).selectionSet,i);if("string"==typeof r)return r}}}function E(e){return"Field"===e.kind}function _(e){return"InlineFragment"===e.kind}function x(e){(0,n.kG)(e&&"Document"===e.kind,45);var t=e.definitions.filter((function(e){return"FragmentDefinition"!==e.kind})).map((function(e){if("OperationDefinition"!==e.kind)throw new n.ej(46);return e}));return(0,n.kG)(t.length<=1,47),e}function M(e){return x(e),e.definitions.filter((function(e){return"OperationDefinition"===e.kind}))[0]}function P(e){return e.definitions.filter((function(e){return"OperationDefinition"===e.kind&&e.name})).map((function(e){return e.name.value}))[0]||null}function A(e){return e.definitions.filter((function(e){return"FragmentDefinition"===e.kind}))}function O(e){var t=M(e);return(0,n.kG)(t&&"query"===t.operation,48),t}function D(e){var t;x(e);for(var i=0,s=e.definitions;i<s.length;i++){var o=s[i];if("OperationDefinition"===o.kind){var r=o.operation;if("query"===r||"mutation"===r||"subscription"===r)return o}"FragmentDefinition"!==o.kind||t||(t=o)}if(t)return t;throw new n.ej(52)}function I(e){var t=Object.create(null),i=e&&e.variableDefinitions;return i&&i.length&&i.forEach((function(e){e.defaultValue&&f(t,e.variable.name,e.defaultValue)})),t}function C(e,t,i){var s=0;return e.forEach((function(i,n){t.call(this,i,n,e)&&(e[s++]=i)}),i),e.length=s,e}var R={kind:"Field",name:{kind:"Name",value:"__typename"}};function L(e,t){return e.selectionSet.selections.every((function(e){return"FragmentSpread"===e.kind&&L(t[e.name.value],t)}))}function N(e){return L(M(e)||function(e){(0,n.kG)("Document"===e.kind,49),(0,n.kG)(e.definitions.length<=1,50);var t=e.definitions[0];return(0,n.kG)("FragmentDefinition"===t.kind,51),t}(e),h(A(e)))?null:e}function k(e){return function(t){return e.some((function(e){return e.name&&e.name===t.name.value||e.test&&e.test(t)}))}}function F(e,t){var i=Object.create(null),n=[],o=Object.create(null),r=[],a=N((0,s.Vn)(t,{Variable:{enter:function(e,t,s){"VariableDefinition"!==s.kind&&(i[e.name.value]=!0)}},Field:{enter:function(t){if(e&&t.directives&&e.some((function(e){return e.remove}))&&t.directives&&t.directives.some(k(e)))return t.arguments&&t.arguments.forEach((function(e){"Variable"===e.value.kind&&n.push({name:e.value.name.value})})),t.selectionSet&&G(t.selectionSet).forEach((function(e){r.push({name:e.name.value})})),null}},FragmentSpread:{enter:function(e){o[e.name.value]=!0}},Directive:{enter:function(t){if(k(e)(t))return null}}}));return a&&C(n,(function(e){return!!e.name&&!i[e.name]})).length&&(a=function(e,t){var i=function(e){return function(t){return e.some((function(e){return t.value&&"Variable"===t.value.kind&&t.value.name&&(e.name===t.value.name.value||e.test&&e.test(t))}))}}(e);return N((0,s.Vn)(t,{OperationDefinition:{enter:function(t){return(0,l.pi)((0,l.pi)({},t),{variableDefinitions:t.variableDefinitions?t.variableDefinitions.filter((function(t){return!e.some((function(e){return e.name===t.variable.name.value}))})):[]})}},Field:{enter:function(t){if(e.some((function(e){return e.remove}))){var s=0;if(t.arguments&&t.arguments.forEach((function(e){i(e)&&(s+=1)})),1===s)return null}}},Argument:{enter:function(e){if(i(e))return null}}}))}(n,a)),a&&C(r,(function(e){return!!e.name&&!o[e.name]})).length&&(a=function(e,t){function i(t){if(e.some((function(e){return e.name===t.name.value})))return null}return N((0,s.Vn)(t,{FragmentSpread:{enter:i},FragmentDefinition:{enter:i}}))}(r,a)),a}function B(e){return(0,s.Vn)(x(e),{SelectionSet:{enter:function(e,t,i){if(!i||"OperationDefinition"!==i.kind){var s=e.selections;if(s&&!s.some((function(e){return E(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))}))){var n=i;if(!(E(n)&&n.directives&&n.directives.some((function(e){return"export"===e.name.value}))))return(0,l.pi)((0,l.pi)({},e),{selections:(0,l.pr)(s,[R])})}}}}})}B.added=function(e){return e===R};var U={test:function(e){var t="connection"===e.name.value;return t&&(!e.arguments||e.arguments.some((function(e){return"key"===e.name.value}))),t}};function H(e){return F([U],x(e))}function G(e){var t=[];return e.selections.forEach((function(e){(E(e)||_(e))&&e.selectionSet?G(e.selectionSet).forEach((function(e){return t.push(e)})):"FragmentSpread"===e.kind&&t.push(e)})),t}function V(e){return"query"===D(e).operation?e:(0,s.Vn)(e,{OperationDefinition:{enter:function(e){return(0,l.pi)((0,l.pi)({},e),{operation:"query"})}}})}function z(e){x(e);var t=F([{test:function(e){return"client"===e.name.value},remove:!0}],e);return t&&(t=(0,s.Vn)(t,{FragmentDefinition:{enter:function(e){if(e.selectionSet&&e.selectionSet.selections.every((function(e){return E(e)&&"__typename"===e.name.value})))return null}}})),t}var j=Object.prototype.hasOwnProperty;function W(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Z(e)}function Z(e){var t=e[0]||{},i=e.length;if(i>1)for(var s=new Y,n=1;n<i;++n)t=s.merge(t,e[n]);return t}function q(e){return null!==e&&"object"==typeof e}var K=function(e,t,i){return this.merge(e[i],t[i])},Y=function(){function e(e){void 0===e&&(e=K),this.reconciler=e,this.isObject=q,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];return q(t)&&q(e)?(Object.keys(t).forEach((function(n){if(j.call(e,n)){var o=e[n];if(t[n]!==o){var r=i.reconciler.apply(i,(0,l.pr)([e,t,n],s));r!==o&&((e=i.shallowCopyForMerge(e))[n]=r)}}else(e=i.shallowCopyForMerge(e))[n]=t[n]})),e):t},e.prototype.shallowCopyForMerge=function(e){return q(e)&&!this.pastCopies.has(e)&&(e=Array.isArray(e)?e.slice(0):(0,l.pi)({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e)),e},e}(),$=i(49329),Q=i.n($);i(67121),Q().prototype["@@observable"]=function(){return this};var X=Object.prototype.toString;function J(e){return ee(e)}function ee(e,t){switch(X.call(e)){case"[object Array]":if((t=t||new Map).has(e))return t.get(e);var i=e.slice(0);return t.set(e,i),i.forEach((function(e,s){i[s]=ee(e,t)})),i;case"[object Object]":if((t=t||new Map).has(e))return t.get(e);var s=Object.create(Object.getPrototypeOf(e));return t.set(e,s),Object.keys(e).forEach((function(i){s[i]=ee(e[i],t)})),s;default:return e}}function te(e){return e}function ie(e,t,i){var s=[];e.forEach((function(e){return e[t]&&s.push(e)})),s.forEach((function(e){return e[t](i)}))}function se(e,t,i){return new(Q())((function(s){var n=s.next,o=s.error,r=s.complete,a=0,l=!1;function c(e,t){return e?function(t){++a,new Promise((function(i){return i(e(t))})).then((function(e){--a,n&&n.call(s,e),l&&h.complete()}),(function(e){--a,o&&o.call(s,e)}))}:function(e){return t&&t.call(s,e)}}var h={next:c(t,n),error:c(i,o),complete:function(){l=!0,a||r&&r.call(s)}},d=e.subscribe(h);return function(){return d.unsubscribe()}}))}function ne(e){function t(t){Object.defineProperty(e,t,{value:Q()})}return"function"==typeof Symbol&&Symbol.species&&t(Symbol.species),t("@@species"),e}function oe(e){return e&&"function"==typeof e.then}var re=function(e){function t(t){var i=e.call(this,(function(e){return i.addObserver(e),function(){return i.removeObserver(e)}}))||this;return i.observers=new Set,i.addCount=0,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.handlers={next:function(e){null!==i.sub&&(i.latest=["next",e],ie(i.observers,"next",e))},error:function(e){var t=i.sub;null!==t&&(t&&Promise.resolve().then((function(){return t.unsubscribe()})),i.sub=null,i.latest=["error",e],i.reject(e),ie(i.observers,"error",e))},complete:function(){if(null!==i.sub){var e=i.sources.shift();e?oe(e)?e.then((function(e){return i.sub=e.subscribe(i.handlers)})):i.sub=e.subscribe(i.handlers):(i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),ie(i.observers,"complete"))}}},i.cancel=function(e){i.reject(e),i.sources=[],i.handlers.complete()},i.promise.catch((function(e){})),"function"==typeof t&&(t=[new(Q())(t)]),oe(t)?t.then((function(e){return i.start(e)}),i.handlers.error):i.start(t),i}return(0,l.ZT)(t,e),t.prototype.start=function(e){void 0===this.sub&&(this.sources=Array.from(e),this.handlers.complete())},t.prototype.deliverLastMessage=function(e){if(this.latest){var t=this.latest[0],i=e[t];i&&i.call(e,this.latest[1]),null===this.sub&&"next"===t&&e.complete&&e.complete()}},t.prototype.addObserver=function(e){this.observers.has(e)||(this.deliverLastMessage(e),this.observers.add(e),++this.addCount)},t.prototype.removeObserver=function(e,t){this.observers.delete(e)&&--this.addCount<1&&!t&&this.handlers.error(new Error("Observable cancelled prematurely"))},t.prototype.cleanup=function(e){var t=this,i=!1,s=function(){i||(i=!0,t.observers.delete(n),e())},n={next:s,error:s,complete:s},o=this.addCount;this.addObserver(n),this.addCount=o},t}(Q());function ae(e){return Array.isArray(e)&&e.length>0}function le(e){return e.errors&&e.errors.length>0||!1}ne(re);var ce="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product);function he(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach((function(e){e&&Object.keys(e).forEach((function(t){var s=e[t];void 0!==s&&(i[t]=s)}))})),i}},81506:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},34575:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},93913:e=>{function t(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}},16525:(e,t,i)=>{var s=i(58331);function n(t,i,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=n=Reflect.get:e.exports=n=function(e,t,i){var n=s(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}},n(t,i,o||t)}e.exports=n},29754:e=>{function t(i){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(i)}e.exports=t},2205:(e,t,i)=>{var s=i(99489);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},78585:(e,t,i)=>{var s=i(50008),n=i(81506);e.exports=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?n(e):t}},99489:e=>{function t(i,s){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(i,s)}e.exports=t},58331:(e,t,i)=>{var s=i(29754);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}},50008:e=>{function t(i){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(i)}e.exports=t},25179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(6308);class n{static attachTo(e){return new n(e,new s.Z)}constructor(e,t,...i){this.root_=e,this.initialize(...i),this.foundation_=void 0===t?this.getDefaultFoundation():t,this.foundation_.init(),this.initialSyncWithDOM()}initialize(){}getDefaultFoundation(){throw new Error("Subclasses must override getDefaultFoundation to return a properly configured foundation class")}initialSyncWithDOM(){}destroy(){this.foundation_.destroy()}listen(e,t){this.root_.addEventListener(e,t)}unlisten(e,t){this.root_.removeEventListener(e,t)}emit(e,t,i=!1){let s;"function"==typeof CustomEvent?s=new CustomEvent(e,{detail:t,bubbles:i}):(s=document.createEvent("CustomEvent"),s.initCustomEvent(e,i,!1,t)),this.root_.dispatchEvent(s)}}const o=n},6308:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s=class{static get cssClasses(){return{}}static get strings(){return{}}static get numbers(){return{}}static get defaultAdapter(){return{}}constructor(e={}){this.adapter_=e}init(){}destroy(){}}},30888:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCRipple:()=>w,MDCRippleFoundation:()=>b,RippleCapableSurface:()=>S,util:()=>s});var s={};i.r(s),i.d(s,{applyPassive:()=>u,getMatchesProperty:()=>p,getNormalizedEventCoords:()=>m,supportsCssVariables:()=>d});var n=i(25179),o=i(6308);const r={ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded",BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation"},a={VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end"},l={PADDING:10,INITIAL_ORIGIN_SCALE:.6,DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,TAP_DELAY_MS:300};let c,h;function d(e,t=!1){let i=c;if("boolean"==typeof c&&!t)return i;if(!e.CSS||"function"!=typeof e.CSS.supports)return;const s=e.CSS.supports("--css-vars","yes"),n=e.CSS.supports("(--css-vars: yes)")&&e.CSS.supports("color","#00000000");return i=!(!s&&!n||function(e){const t=e.document,i=t.createElement("div");i.className="mdc-ripple-surface--test-edge-var-bug",t.body.appendChild(i);const s=e.getComputedStyle(i),n=null!==s&&"solid"===s.borderTopStyle;return i.remove(),n}(e)),t||(c=i),i}function u(e=window,t=!1){if(void 0===h||t){let t=!1;try{e.document.addEventListener("test",null,{get passive(){t=!0}})}catch(e){}h=t}return!!h&&{passive:!0}}function p(e){return["webkitMatchesSelector","msMatchesSelector","matches"].filter((t=>t in e)).pop()}function m(e,t,i){const{x:s,y:n}=t,o=s+i.left,r=n+i.top;let a,l;return"touchstart"===e.type?(a=e.changedTouches[0].pageX-o,l=e.changedTouches[0].pageY-r):(a=e.pageX-o,l=e.pageY-r),{x:a,y:l}}const g=["touchstart","pointerdown","mousedown","keydown"],f=["touchend","pointerup","mouseup"];let v=[];class y extends o.Z{static get cssClasses(){return r}static get strings(){return a}static get numbers(){return l}static get defaultAdapter(){return{browserSupportsCssVars:()=>{},isUnbounded:()=>{},isSurfaceActive:()=>{},isSurfaceDisabled:()=>{},addClass:()=>{},removeClass:()=>{},containsEventTarget:()=>{},registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerDocumentInteractionHandler:()=>{},deregisterDocumentInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},updateCssVariable:()=>{},computeBoundingRect:()=>{},getWindowPageOffset:()=>{}}}constructor(e){super(Object.assign(y.defaultAdapter,e)),this.layoutFrame_=0,this.frame_={width:0,height:0},this.activationState_=this.defaultActivationState_(),this.initialSize_=0,this.maxRadius_=0,this.activateHandler_=e=>this.activate_(e),this.deactivateHandler_=e=>this.deactivate_(e),this.focusHandler_=()=>this.handleFocus(),this.blurHandler_=()=>this.handleBlur(),this.resizeHandler_=()=>this.layout(),this.unboundedCoords_={left:0,top:0},this.fgScale_=0,this.activationTimer_=0,this.fgDeactivationRemovalTimer_=0,this.activationAnimationHasEnded_=!1,this.activationTimerCallback_=()=>{this.activationAnimationHasEnded_=!0,this.runDeactivationUXLogicIfReady_()},this.previousActivationEvent_=null}supportsPressRipple_(){return this.adapter_.browserSupportsCssVars()}defaultActivationState_(){return{isActivated:!1,hasDeactivationUXRun:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1,activationEvent:null,isProgrammatic:!1}}init(){const e=this.supportsPressRipple_();if(this.registerRootHandlers_(e),e){const{ROOT:e,UNBOUNDED:t}=y.cssClasses;requestAnimationFrame((()=>{this.adapter_.addClass(e),this.adapter_.isUnbounded()&&(this.adapter_.addClass(t),this.layoutInternal_())}))}}destroy(){if(this.supportsPressRipple_()){this.activationTimer_&&(clearTimeout(this.activationTimer_),this.activationTimer_=0,this.adapter_.removeClass(y.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer_&&(clearTimeout(this.fgDeactivationRemovalTimer_),this.fgDeactivationRemovalTimer_=0,this.adapter_.removeClass(y.cssClasses.FG_DEACTIVATION));const{ROOT:e,UNBOUNDED:t}=y.cssClasses;requestAnimationFrame((()=>{this.adapter_.removeClass(e),this.adapter_.removeClass(t),this.removeCssVars_()}))}this.deregisterRootHandlers_(),this.deregisterDeactivationHandlers_()}registerRootHandlers_(e){e&&(g.forEach((e=>{this.adapter_.registerInteractionHandler(e,this.activateHandler_)})),this.adapter_.isUnbounded()&&this.adapter_.registerResizeHandler(this.resizeHandler_)),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_)}registerDeactivationHandlers_(e){"keydown"===e.type?this.adapter_.registerInteractionHandler("keyup",this.deactivateHandler_):f.forEach((e=>{this.adapter_.registerDocumentInteractionHandler(e,this.deactivateHandler_)}))}deregisterRootHandlers_(){g.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.activateHandler_)})),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),this.adapter_.isUnbounded()&&this.adapter_.deregisterResizeHandler(this.resizeHandler_)}deregisterDeactivationHandlers_(){this.adapter_.deregisterInteractionHandler("keyup",this.deactivateHandler_),f.forEach((e=>{this.adapter_.deregisterDocumentInteractionHandler(e,this.deactivateHandler_)}))}removeCssVars_(){const{strings:e}=y;Object.keys(e).forEach((t=>{0===t.indexOf("VAR_")&&this.adapter_.updateCssVariable(e[t],null)}))}activate_(e){if(this.adapter_.isSurfaceDisabled())return;const t=this.activationState_;if(t.isActivated)return;const i=this.previousActivationEvent_;i&&e&&i.type!==e.type||(t.isActivated=!0,t.isProgrammatic=null===e,t.activationEvent=e,t.wasActivatedByPointer=!t.isProgrammatic&&("mousedown"===e.type||"touchstart"===e.type||"pointerdown"===e.type),e&&v.length>0&&v.some((e=>this.adapter_.containsEventTarget(e)))?this.resetActivationState_():(e&&(v.push(e.target),this.registerDeactivationHandlers_(e)),t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_(),requestAnimationFrame((()=>{v=[],t.wasElementMadeActive||" "!==e.key&&32!==e.keyCode||(t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_()),t.wasElementMadeActive||(this.activationState_=this.defaultActivationState_())}))))}checkElementMadeActive_(e){return!e||"keydown"!==e.type||this.adapter_.isSurfaceActive()}activate(e=null){this.activate_(e)}animateActivation_(){const{VAR_FG_TRANSLATE_START:e,VAR_FG_TRANSLATE_END:t}=y.strings,{FG_DEACTIVATION:i,FG_ACTIVATION:s}=y.cssClasses,{DEACTIVATION_TIMEOUT_MS:n}=y.numbers;this.layoutInternal_();let o="",r="";if(!this.adapter_.isUnbounded()){const{startPoint:e,endPoint:t}=this.getFgTranslationCoordinates_();o=`${e.x}px, ${e.y}px`,r=`${t.x}px, ${t.y}px`}this.adapter_.updateCssVariable(e,o),this.adapter_.updateCssVariable(t,r),clearTimeout(this.activationTimer_),clearTimeout(this.fgDeactivationRemovalTimer_),this.rmBoundedActivationClasses_(),this.adapter_.removeClass(i),this.adapter_.computeBoundingRect(),this.adapter_.addClass(s),this.activationTimer_=setTimeout((()=>this.activationTimerCallback_()),n)}getFgTranslationCoordinates_(){const{activationEvent:e,wasActivatedByPointer:t}=this.activationState_;let i;return i=t?m(e,this.adapter_.getWindowPageOffset(),this.adapter_.computeBoundingRect()):{x:this.frame_.width/2,y:this.frame_.height/2},i={x:i.x-this.initialSize_/2,y:i.y-this.initialSize_/2},{startPoint:i,endPoint:{x:this.frame_.width/2-this.initialSize_/2,y:this.frame_.height/2-this.initialSize_/2}}}runDeactivationUXLogicIfReady_(){const{FG_DEACTIVATION:e}=y.cssClasses,{hasDeactivationUXRun:t,isActivated:i}=this.activationState_;(t||!i)&&this.activationAnimationHasEnded_&&(this.rmBoundedActivationClasses_(),this.adapter_.addClass(e),this.fgDeactivationRemovalTimer_=setTimeout((()=>{this.adapter_.removeClass(e)}),l.FG_DEACTIVATION_MS))}rmBoundedActivationClasses_(){const{FG_ACTIVATION:e}=y.cssClasses;this.adapter_.removeClass(e),this.activationAnimationHasEnded_=!1,this.adapter_.computeBoundingRect()}resetActivationState_(){this.previousActivationEvent_=this.activationState_.activationEvent,this.activationState_=this.defaultActivationState_(),setTimeout((()=>this.previousActivationEvent_=null),y.numbers.TAP_DELAY_MS)}deactivate_(e){const t=this.activationState_;if(!t.isActivated)return;const i=Object.assign({},t);if(t.isProgrammatic){const e=null;requestAnimationFrame((()=>this.animateDeactivation_(e,i))),this.resetActivationState_()}else this.deregisterDeactivationHandlers_(),requestAnimationFrame((()=>{this.activationState_.hasDeactivationUXRun=!0,this.animateDeactivation_(e,i),this.resetActivationState_()}))}deactivate(e=null){this.deactivate_(e)}animateDeactivation_(e,{wasActivatedByPointer:t,wasElementMadeActive:i}){(t||i)&&this.runDeactivationUXLogicIfReady_()}layout(){this.layoutFrame_&&cancelAnimationFrame(this.layoutFrame_),this.layoutFrame_=requestAnimationFrame((()=>{this.layoutInternal_(),this.layoutFrame_=0}))}layoutInternal_(){this.frame_=this.adapter_.computeBoundingRect();const e=Math.max(this.frame_.height,this.frame_.width);this.maxRadius_=this.adapter_.isUnbounded()?e:(()=>Math.sqrt(Math.pow(this.frame_.width,2)+Math.pow(this.frame_.height,2))+y.numbers.PADDING)(),this.initialSize_=e*y.numbers.INITIAL_ORIGIN_SCALE,this.fgScale_=this.maxRadius_/this.initialSize_,this.updateLayoutCssVars_()}updateLayoutCssVars_(){const{VAR_FG_SIZE:e,VAR_LEFT:t,VAR_TOP:i,VAR_FG_SCALE:s}=y.strings;this.adapter_.updateCssVariable(e,`${this.initialSize_}px`),this.adapter_.updateCssVariable(s,this.fgScale_),this.adapter_.isUnbounded()&&(this.unboundedCoords_={left:Math.round(this.frame_.width/2-this.initialSize_/2),top:Math.round(this.frame_.height/2-this.initialSize_/2)},this.adapter_.updateCssVariable(t,`${this.unboundedCoords_.left}px`),this.adapter_.updateCssVariable(i,`${this.unboundedCoords_.top}px`))}setUnbounded(e){const{UNBOUNDED:t}=y.cssClasses;e?this.adapter_.addClass(t):this.adapter_.removeClass(t)}handleFocus(){requestAnimationFrame((()=>this.adapter_.addClass(y.cssClasses.BG_FOCUSED)))}handleBlur(){requestAnimationFrame((()=>this.adapter_.removeClass(y.cssClasses.BG_FOCUSED)))}}const b=y;class w extends n.Z{constructor(...e){super(...e),this.disabled=!1,this.unbounded_}static attachTo(e,{isUnbounded:t}={}){const i=new w(e);return void 0!==t&&(i.unbounded=t),i}static createAdapter(e){const t=p(HTMLElement.prototype);return{browserSupportsCssVars:()=>d(window),isUnbounded:()=>e.unbounded,isSurfaceActive:()=>e.root_[t](":active"),isSurfaceDisabled:()=>e.disabled,addClass:t=>e.root_.classList.add(t),removeClass:t=>e.root_.classList.remove(t),containsEventTarget:t=>e.root_.contains(t),registerInteractionHandler:(t,i)=>e.root_.addEventListener(t,i,u()),deregisterInteractionHandler:(t,i)=>e.root_.removeEventListener(t,i,u()),registerDocumentInteractionHandler:(e,t)=>document.documentElement.addEventListener(e,t,u()),deregisterDocumentInteractionHandler:(e,t)=>document.documentElement.removeEventListener(e,t,u()),registerResizeHandler:e=>window.addEventListener("resize",e),deregisterResizeHandler:e=>window.removeEventListener("resize",e),updateCssVariable:(t,i)=>e.root_.style.setProperty(t,i),computeBoundingRect:()=>e.root_.getBoundingClientRect(),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset})}}get unbounded(){return this.unbounded_}set unbounded(e){this.unbounded_=Boolean(e),this.setUnbounded_()}setUnbounded_(){this.foundation_.setUnbounded(this.unbounded_)}activate(){this.foundation_.activate()}deactivate(){this.foundation_.deactivate()}layout(){this.foundation_.layout()}getDefaultFoundation(){return new b(w.createAdapter(this))}initialSyncWithDOM(){this.unbounded="mdcRippleIsUnbounded"in this.root_.dataset}}class S{}S.prototype.root_,S.prototype.unbounded,S.prototype.disabled},69826:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCSlider:()=>x,MDCSliderFoundation:()=>_});var s=i(25179);const n={ACTIVE:"mdc-slider--active",DISABLED:"mdc-slider--disabled",DISCRETE:"mdc-slider--discrete",FOCUS:"mdc-slider--focus",IN_TRANSIT:"mdc-slider--in-transit",IS_DISCRETE:"mdc-slider--discrete",HAS_TRACK_MARKER:"mdc-slider--display-markers"},o={TRACK_SELECTOR:".mdc-slider__track",TRACK_MARKER_CONTAINER_SELECTOR:".mdc-slider__track-marker-container",LAST_TRACK_MARKER_SELECTOR:".mdc-slider__track-marker:last-child",THUMB_CONTAINER_SELECTOR:".mdc-slider__thumb-container",PIN_VALUE_MARKER_SELECTOR:".mdc-slider__pin-value-marker",ARIA_VALUEMIN:"aria-valuemin",ARIA_VALUEMAX:"aria-valuemax",ARIA_VALUENOW:"aria-valuenow",ARIA_DISABLED:"aria-disabled",STEP_DATA_ATTR:"data-step",CHANGE_EVENT:"MDCSlider:change",INPUT_EVENT:"MDCSlider:input"},r={PAGE_FACTOR:4},a={animationstart:{noPrefix:"animationstart",webkitPrefix:"webkitAnimationStart",styleProperty:"animation"},animationend:{noPrefix:"animationend",webkitPrefix:"webkitAnimationEnd",styleProperty:"animation"},animationiteration:{noPrefix:"animationiteration",webkitPrefix:"webkitAnimationIteration",styleProperty:"animation"},transitionend:{noPrefix:"transitionend",webkitPrefix:"webkitTransitionEnd",styleProperty:"transition"}},l={animation:{noPrefix:"animation",webkitPrefix:"-webkit-animation"},transform:{noPrefix:"transform",webkitPrefix:"-webkit-transform"},transition:{noPrefix:"transition",webkitPrefix:"-webkit-transition"}};function c(e,t){if(!function(e){return void 0!==e.document&&"function"==typeof e.document.createElement}(e)||!function(e){return e in a||e in l}(t))return t;const i=t in a?a:l,s=e.document.createElement("div");let n="";return n=i===a?function(e,t,i){return t[e].styleProperty in i.style?t[e].noPrefix:t[e].webkitPrefix}(t,i,s):i[t].noPrefix in s.style?i[t].noPrefix:i[t].webkitPrefix,n}function h(e,t){return c(e,t)}var d=i(6308);const u="ArrowLeft",p="ArrowRight",m="ArrowUp",g="ArrowDown",f="Home",v="End",y="PageUp",b="PageDown",w={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"pointermove"},S=["mousedown","pointerdown","touchstart"],T=["mouseup","pointerup","touchend"];class E extends d.Z{static get cssClasses(){return n}static get strings(){return o}static get numbers(){return r}static get defaultAdapter(){return{hasClass:()=>!1,addClass:()=>{},removeClass:()=>{},getAttribute:()=>null,setAttribute:()=>{},removeAttribute:()=>{},computeBoundingRect:()=>({top:0,right:0,bottom:0,left:0,width:0,height:0}),getTabIndex:()=>0,registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerThumbContainerInteractionHandler:()=>{},deregisterThumbContainerInteractionHandler:()=>{},registerBodyInteractionHandler:()=>{},deregisterBodyInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},notifyInput:()=>{},notifyChange:()=>{},setThumbContainerStyleProperty:()=>{},setTrackStyleProperty:()=>{},setMarkerValue:()=>{},appendTrackMarkers:()=>{},removeTrackMarkers:()=>{},setLastTrackMarkersStyleProperty:()=>{},isRTL:()=>!1}}constructor(e){super(Object.assign(E.defaultAdapter,e)),this.rect_=null,this.savedTabIndex_=NaN,this.active_=!1,this.inTransit_=!1,this.isDiscrete_=!1,this.hasTrackMarker_=!1,this.handlingThumbTargetEvt_=!1,this.min_=0,this.max_=100,this.step_=0,this.value_=0,this.disabled_=!1,this.preventFocusState_=!1,this.updateUIFrame_=0,this.thumbContainerPointerHandler_=()=>{this.handlingThumbTargetEvt_=!0},this.interactionStartHandler_=e=>this.handleDown_(e),this.keydownHandler_=e=>this.handleKeydown_(e),this.focusHandler_=()=>this.handleFocus_(),this.blurHandler_=()=>this.handleBlur_(),this.resizeHandler_=()=>this.layout()}init(){this.isDiscrete_=this.adapter_.hasClass(n.IS_DISCRETE),this.hasTrackMarker_=this.adapter_.hasClass(n.HAS_TRACK_MARKER),S.forEach((e=>this.adapter_.registerInteractionHandler(e,this.interactionStartHandler_))),this.adapter_.registerInteractionHandler("keydown",this.keydownHandler_),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_),S.forEach((e=>{this.adapter_.registerThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.registerResizeHandler(this.resizeHandler_),this.layout(),this.isDiscrete_&&0==this.getStep()&&(this.step_=1)}destroy(){S.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.interactionStartHandler_)})),this.adapter_.deregisterInteractionHandler("keydown",this.keydownHandler_),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),S.forEach((e=>{this.adapter_.deregisterThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.deregisterResizeHandler(this.resizeHandler_)}setupTrackMarker(){if(this.isDiscrete_&&this.hasTrackMarker_&&0!=this.getStep()){const e=this.getMin(),t=this.getMax(),i=this.getStep();let s=(t-e)/i;const n=Math.ceil(s)!==s;if(n&&(s=Math.ceil(s)),this.adapter_.removeTrackMarkers(),this.adapter_.appendTrackMarkers(s),n){const e=(t-s*i)/i+1,n=h(window,"flex");this.adapter_.setLastTrackMarkersStyleProperty(n,String(e))}}}layout(){this.rect_=this.adapter_.computeBoundingRect(),this.updateUIForCurrentValue_()}getValue(){return this.value_}setValue(e){this.setValue_(e,!1)}getMax(){return this.max_}setMax(e){if(e<this.min_)throw new Error("Cannot set max to be less than the slider's minimum value");this.max_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(o.ARIA_VALUEMAX,String(this.max_)),this.setupTrackMarker()}getMin(){return this.min_}setMin(e){if(e>this.max_)throw new Error("Cannot set min to be greater than the slider's maximum value");this.min_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(o.ARIA_VALUEMIN,String(this.min_)),this.setupTrackMarker()}getStep(){return this.step_}setStep(e){if(e<0)throw new Error("Step cannot be set to a negative number");this.isDiscrete_&&("number"!=typeof e||e<1)&&(e=1),this.step_=e,this.setValue_(this.value_,!1,!0),this.setupTrackMarker()}isDisabled(){return this.disabled_}setDisabled(e){this.disabled_=e,this.toggleClass_(n.DISABLED,this.disabled_),this.disabled_?(this.savedTabIndex_=this.adapter_.getTabIndex(),this.adapter_.setAttribute(o.ARIA_DISABLED,"true"),this.adapter_.removeAttribute("tabindex")):(this.adapter_.removeAttribute(o.ARIA_DISABLED),isNaN(this.savedTabIndex_)||this.adapter_.setAttribute("tabindex",String(this.savedTabIndex_)))}handleDown_(e){if(this.disabled_)return;this.preventFocusState_=!0,this.setInTransit_(!this.handlingThumbTargetEvt_),this.handlingThumbTargetEvt_=!1,this.setActive_(!0);const t=e=>{this.handleMove_(e)},i=()=>{this.handleUp_(),this.adapter_.deregisterBodyInteractionHandler(w[e.type],t),T.forEach((e=>this.adapter_.deregisterBodyInteractionHandler(e,i)))};this.adapter_.registerBodyInteractionHandler(w[e.type],t),T.forEach((e=>this.adapter_.registerBodyInteractionHandler(e,i))),this.setValueFromEvt_(e)}handleMove_(e){e.preventDefault(),this.setValueFromEvt_(e)}handleUp_(){this.setActive_(!1),this.adapter_.notifyChange()}getPageX_(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX}setValueFromEvt_(e){const t=this.getPageX_(e),i=this.computeValueFromPageX_(t);this.setValue_(i,!0)}computeValueFromPageX_(e){const{max_:t,min_:i}=this;let s=(e-this.rect_.left)/this.rect_.width;return this.adapter_.isRTL()&&(s=1-s),i+s*(t-i)}handleKeydown_(e){const t=this.getKeyId_(e),i=this.getValueForKeyId_(t);isNaN(i)||(e.preventDefault(),this.adapter_.addClass(n.FOCUS),this.setValue_(i,!0),this.adapter_.notifyChange())}getKeyId_(e){return e.key===u||37===e.keyCode?u:e.key===p||39===e.keyCode?p:e.key===m||38===e.keyCode?m:e.key===g||40===e.keyCode?g:e.key===f||36===e.keyCode?f:e.key===v||35===e.keyCode?v:e.key===y||33===e.keyCode?y:e.key===b||34===e.keyCode?b:""}getValueForKeyId_(e){const{max_:t,min_:i,step_:s}=this;let n=s||(t-i)/100;switch(this.adapter_.isRTL()&&(e===u||e===p)&&(n=-n),e){case u:case g:return this.value_-n;case p:case m:return this.value_+n;case f:return this.min_;case v:return this.max_;case y:return this.value_+n*r.PAGE_FACTOR;case b:return this.value_-n*r.PAGE_FACTOR;default:return NaN}}handleFocus_(){this.preventFocusState_||this.adapter_.addClass(n.FOCUS)}handleBlur_(){this.preventFocusState_=!1,this.adapter_.removeClass(n.FOCUS)}setValue_(e,t,i=!1){if(e===this.value_&&!i)return;const{min_:s,max_:n}=this,r=e===s||e===n;this.step_&&!r&&(e=this.quantize_(e)),e<s?e=s:e>n&&(e=n),this.value_=e,this.adapter_.setAttribute(o.ARIA_VALUENOW,String(this.value_)),this.updateUIForCurrentValue_(),t&&(this.adapter_.notifyInput(),this.isDiscrete_&&this.adapter_.setMarkerValue(e))}quantize_(e){return Math.round(e/this.step_)*this.step_}updateUIForCurrentValue_(){const{max_:e,min_:t,value_:i}=this,s=(i-t)/(e-t);let n=s*this.rect_.width;this.adapter_.isRTL()&&(n=this.rect_.width-n);const o=h(window,"transform"),r=c(window,"transitionend");if(this.inTransit_){const e=()=>{this.setInTransit_(!1),this.adapter_.deregisterThumbContainerInteractionHandler(r,e)};this.adapter_.registerThumbContainerInteractionHandler(r,e)}this.updateUIFrame_=requestAnimationFrame((()=>{this.adapter_.setThumbContainerStyleProperty(o,`translateX(${n}px) translateX(-50%)`),this.adapter_.setTrackStyleProperty(o,`scaleX(${s})`)}))}setActive_(e){this.active_=e,this.toggleClass_(n.ACTIVE,this.active_)}setInTransit_(e){this.inTransit_=e,this.toggleClass_(n.IN_TRANSIT,this.inTransit_)}toggleClass_(e,t){t?this.adapter_.addClass(e):this.adapter_.removeClass(e)}}const _=E;class x extends s.Z{static attachTo(e){return new x(e)}constructor(...e){super(...e),this.thumbContainer_,this.track_,this.pinValueMarker_,this.trackMarkerContainer_}get value(){return this.foundation_.getValue()}set value(e){this.foundation_.setValue(e)}get min(){return this.foundation_.getMin()}set min(e){this.foundation_.setMin(e)}get max(){return this.foundation_.getMax()}set max(e){this.foundation_.setMax(e)}get step(){return this.foundation_.getStep()}set step(e){this.foundation_.setStep(e)}get disabled(){return this.foundation_.isDisabled()}set disabled(e){this.foundation_.setDisabled(e)}initialize(){this.thumbContainer_=this.root_.querySelector(o.THUMB_CONTAINER_SELECTOR),this.track_=this.root_.querySelector(o.TRACK_SELECTOR),this.pinValueMarker_=this.root_.querySelector(o.PIN_VALUE_MARKER_SELECTOR),this.trackMarkerContainer_=this.root_.querySelector(o.TRACK_MARKER_CONTAINER_SELECTOR)}getDefaultFoundation(){return new _({hasClass:e=>this.root_.classList.contains(e),addClass:e=>this.root_.classList.add(e),removeClass:e=>this.root_.classList.remove(e),getAttribute:e=>this.root_.getAttribute(e),setAttribute:(e,t)=>this.root_.setAttribute(e,t),removeAttribute:e=>this.root_.removeAttribute(e),computeBoundingRect:()=>this.root_.getBoundingClientRect(),getTabIndex:()=>this.root_.tabIndex,registerInteractionHandler:(e,t)=>{this.root_.addEventListener(e,t)},deregisterInteractionHandler:(e,t)=>{this.root_.removeEventListener(e,t)},registerThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.addEventListener(e,t)},deregisterThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.removeEventListener(e,t)},registerBodyInteractionHandler:(e,t)=>{document.body.addEventListener(e,t)},deregisterBodyInteractionHandler:(e,t)=>{document.body.removeEventListener(e,t)},registerResizeHandler:e=>{window.addEventListener("resize",e)},deregisterResizeHandler:e=>{window.removeEventListener("resize",e)},notifyInput:()=>{this.emit(o.INPUT_EVENT,this)},notifyChange:()=>{this.emit(o.CHANGE_EVENT,this)},setThumbContainerStyleProperty:(e,t)=>{this.thumbContainer_.style.setProperty(e,t)},setTrackStyleProperty:(e,t)=>{this.track_.style.setProperty(e,t)},setMarkerValue:e=>{this.pinValueMarker_.innerText=e},appendTrackMarkers:e=>{const t=document.createDocumentFragment();for(let i=0;i<e;i++){const e=document.createElement("div");e.classList.add("mdc-slider__track-marker"),t.appendChild(e)}this.trackMarkerContainer_.appendChild(t)},removeTrackMarkers:()=>{for(;this.trackMarkerContainer_.firstChild;)this.trackMarkerContainer_.removeChild(this.trackMarkerContainer_.firstChild)},setLastTrackMarkersStyleProperty:(e,t)=>{this.root_.querySelector(o.LAST_TRACK_MARKER_SELECTOR).style.setProperty(e,t)},isRTL:()=>"rtl"===getComputedStyle(this.root_).direction})}initialSyncWithDOM(){const e=parseFloat(this.root_.getAttribute(o.ARIA_VALUENOW));this.min=parseFloat(this.root_.getAttribute(o.ARIA_VALUEMIN))||this.min,this.max=parseFloat(this.root_.getAttribute(o.ARIA_VALUEMAX))||this.max,this.step=parseFloat(this.root_.getAttribute(o.STEP_DATA_ATTR))||this.step,this.value=e||this.value,this.disabled=this.root_.hasAttribute(o.ARIA_DISABLED)&&"false"!==this.root_.getAttribute(o.ARIA_DISABLED),this.foundation_.setupTrackMarker()}layout(){this.foundation_.layout()}stepUp(e=this.step||1){this.value+=e}stepDown(e=this.step||1){this.value-=e}}},82152:(e,t,i)=>{"use strict";i.d(t,{D:()=>l});var s=Object.prototype,n=s.toString,o=s.hasOwnProperty,r=Function.prototype.toString,a=new Map;function l(e,t){try{return c(e,t)}finally{a.clear()}}function c(e,t){if(e===t)return!0;var i,s,a,l=n.call(e);if(l!==n.call(t))return!1;switch(l){case"[object Array]":if(e.length!==t.length)return!1;case"[object Object]":if(p(e,t))return!0;var d=h(e),m=h(t),g=d.length;if(g!==m.length)return!1;for(var f=0;f<g;++f)if(!o.call(t,d[f]))return!1;for(f=0;f<g;++f){var v=d[f];if(!c(e[v],t[v]))return!1}return!0;case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==""+t;case"[object Map]":case"[object Set]":if(e.size!==t.size)return!1;if(p(e,t))return!0;for(var y=e.entries(),b="[object Map]"===l;;){var w=y.next();if(w.done)break;var S=w.value,T=S[0],E=S[1];if(!t.has(T))return!1;if(b&&!c(E,t.get(T)))return!1}return!0;case"[object Function]":var _=r.call(e);return _===r.call(t)&&(s=u,!((a=(i=_).length-s.length)>=0&&i.indexOf(s,a)===a))}return!1}function h(e){return Object.keys(e).filter(d,e)}function d(e){return void 0!==this[e]}var u="{ [native code] }";function p(e,t){var i=a.get(e);if(i){if(i.has(t))return!0}else a.set(e,i=new Set);return i.add(t),!1}},34515:e=>{var t=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===t.call(e.buffer)||Array.isArray(e)}},14176:e=>{e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},47056:(e,t)=>{"use strict";var i;function s(e,t,s){if(!s||typeof s.value!==i.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+t+"> is not a method!");return{configurable:i.boolTrue,get:function(){var e=s.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:i.boolTrue,writable:i.boolTrue}),e}}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.typeOfFunction="function",e.boolTrue=!0}(i||(i={})),t.bind=s,t.default=s},21924:(e,t,i)=>{"use strict";var s=i(40210),n=i(55559),o=n(s("String.prototype.indexOf"));e.exports=function(e,t){var i=s(e,!!t);return"function"==typeof i&&o(e,".prototype.")>-1?n(i):i}},55559:(e,t,i)=>{"use strict";var s=i(58612),n=i(40210),o=n("%Function.prototype.apply%"),r=n("%Function.prototype.call%"),a=n("%Reflect.apply%",!0)||s.call(r,o),l=n("%Object.getOwnPropertyDescriptor%",!0),c=n("%Object.defineProperty%",!0),h=n("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(s,r,arguments);if(l&&c){var i=l(t,"length");i.configurable&&c(t,"length",{value:1+h(0,e.length-(arguments.length-1))})}return t};var d=function(){return a(s,o,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},94184:(e,t)=>{var i;!function(){"use strict";var s={}.hasOwnProperty;function n(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var r=n.apply(null,i);r&&e.push(r)}else if("object"===o)for(var a in i)s.call(i,a)&&i[a]&&e.push(a)}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):void 0===(i=function(){return n}.apply(t,[]))||(e.exports=i)}()},4289:(e,t,i)=>{"use strict";var s=i(82215),n="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,r=Array.prototype.concat,a=Object.defineProperty,l=a&&function(){var e={};try{for(var t in a(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,i,s){var n;(!(t in e)||"function"==typeof(n=s)&&"[object Function]"===o.call(n)&&s())&&(l?a(e,t,{configurable:!0,enumerable:!1,value:i,writable:!0}):e[t]=i)},h=function(e,t){var i=arguments.length>2?arguments[2]:{},o=s(t);n&&(o=r.call(o,Object.getOwnPropertySymbols(t)));for(var a=0;a<o.length;a+=1)c(e,o[a],t[o[a]],i[o[a]])};h.supportsDescriptors=!!l,e.exports=h},2823:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},13733:(e,t,i)=>{"use strict";e.exports=i(28631)},27308:(e,t,i)=>{"use strict";var s=i(40210),n=s("%String%"),o=s("%TypeError%");e.exports=function(e){if("symbol"==typeof e)throw new o("Cannot convert a Symbol value to a string");return n(e)}},28631:(e,t,i)=>{"use strict";var s=i(40210)("%TypeError%");e.exports=function(e,t){if(null==e)throw new s(t||"Cannot call method on "+e);return e}},17187:e=>{function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}function n(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,o,r,a,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n(o=this._events[e]))return!1;if(i(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),o.apply(this,a)}else if(s(o))for(a=Array.prototype.slice.call(arguments,1),r=(c=o.slice()).length,l=0;l<r;l++)c[l].apply(this,a);return!0},t.prototype.addListener=function(e,o){var r;if(!i(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(o.listener)?o.listener:o),this._events[e]?s(this._events[e])?this._events[e].push(o):this._events[e]=[this._events[e],o]:this._events[e]=o,s(this._events[e])&&!this._events[e].warned&&(r=n(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var s=!1;function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},t.prototype.removeListener=function(e,t){var n,o,r,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(n=this._events[e]).length,o=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=r;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(s=this._events[e]))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},35035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i,s="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&(i=t.cmp,function(e){return function(t,s){var n={key:t,value:e[t]},o={key:s,value:e[s]};return i(n,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,r;if(Array.isArray(t)){for(r="[",i=0;i<t.length;i++)i&&(r+=","),r+=e(t[i])||"null";return r+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(s)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(t)-1,l=Object.keys(t).sort(n&&n(t));for(r="",i=0;i<l.length;i++){var c=l[i],h=e(t[c]);h&&(r&&(r+=","),r+=JSON.stringify(c)+":"+h)}return o.splice(a,1),"{"+r+"}"}}(e)}},94029:(e,t,i)=>{"use strict";var s=i(95320),n=Object.prototype.toString,o=Object.prototype.hasOwnProperty,r=function(e,t,i){for(var s=0,n=e.length;s<n;s++)o.call(e,s)&&(null==i?t(e[s],s,e):t.call(i,e[s],s,e))},a=function(e,t,i){for(var s=0,n=e.length;s<n;s++)null==i?t(e.charAt(s),s,e):t.call(i,e.charAt(s),s,e)},l=function(e,t,i){for(var s in e)o.call(e,s)&&(null==i?t(e[s],s,e):t.call(i,e[s],s,e))};e.exports=function(e,t,i){if(!s(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=i),"[object Array]"===n.call(e)?r(e,t,o):"string"==typeof e?a(e,t,o):l(e,t,o)}},17648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,s=Object.prototype.toString,n="[object Function]";e.exports=function(e){var o=this;if("function"!=typeof o||s.call(o)!==n)throw new TypeError(t+o);for(var r,a=i.call(arguments,1),l=function(){if(this instanceof r){var t=o.apply(this,a.concat(i.call(arguments)));return Object(t)===t?t:this}return o.apply(e,a.concat(i.call(arguments)))},c=Math.max(0,o.length-a.length),h=[],d=0;d<c;d++)h.push("$"+d);if(r=Function("binder","return function ("+h.join(",")+"){ return binder.apply(this,arguments); }")(l),o.prototype){var u=function(){};u.prototype=o.prototype,r.prototype=new u,u.prototype=null}return r}},58612:(e,t,i)=>{"use strict";var s=i(17648);e.exports=Function.prototype.bind||s},40210:(e,t,i)=>{"use strict";var s,n=SyntaxError,o=Function,r=TypeError,a=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new r},h=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,d=i(41405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p=a("async function* () {}"),m=p?p.prototype:s,g=m?m.prototype:s,f="undefined"==typeof Uint8Array?s:u(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?s:ArrayBuffer,"%ArrayIteratorPrototype%":d?u([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":a("async function () {}"),"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":g?u(g):s,"%Atomics%":"undefined"==typeof Atomics?s:Atomics,"%BigInt%":"undefined"==typeof BigInt?s:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?s:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?s:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?s:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":a("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?s:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?s:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?u(u([][Symbol.iterator]())):s,"%JSON%":"object"==typeof JSON?JSON:s,"%Map%":"undefined"==typeof Map?s:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?u((new Map)[Symbol.iterator]()):s,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?s:Promise,"%Proxy%":"undefined"==typeof Proxy?s:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?s:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?s:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?u((new Set)[Symbol.iterator]()):s,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?u(""[Symbol.iterator]()):s,"%Symbol%":d?Symbol:s,"%SyntaxError%":n,"%ThrowTypeError%":h,"%TypedArray%":f,"%TypeError%":r,"%Uint8Array%":"undefined"==typeof Uint8Array?s:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?s:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?s:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?s:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?s:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?s:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?s:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(58612),w=i(17642),S=b.call(Function.call,Array.prototype.concat),T=b.call(Function.apply,Array.prototype.splice),E=b.call(Function.call,String.prototype.replace),_=b.call(Function.call,String.prototype.slice),x=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,P=function(e){var t=_(e,0,1),i=_(e,-1);if("%"===t&&"%"!==i)throw new n("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new n("invalid intrinsic syntax, expected opening `%`");var s=[];return E(e,x,(function(e,t,i,n){s[s.length]=i?E(n,M,"$1"):t||e})),s},A=function(e,t){var i,s=e;if(w(y,s)&&(s="%"+(i=y[s])[0]+"%"),w(v,s)){var o=v[s];if(void 0===o&&!t)throw new r("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:o}}throw new n("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new r("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new r('"allowMissing" argument must be a boolean');var i=P(e),s=i.length>0?i[0]:"",o=A("%"+s+"%",t),a=o.name,c=o.value,h=!1,d=o.alias;d&&(s=d[0],T(i,S([0,1],d)));for(var u=1,p=!0;u<i.length;u+=1){var m=i[u],g=_(m,0,1),f=_(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===f||"'"===f||"`"===f)&&g!==f)throw new n("property names with quotes must have matching quotes");if("constructor"!==m&&p||(h=!0),w(v,a="%"+(s+="."+m)+"%"))c=v[a];else if(null!=c){if(!(m in c)){if(!t)throw new r("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=w(c,m),c=c[m];p&&!h&&(v[a]=c)}}return c}},6875:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetFloors"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FloorDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelFloor"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchFloor"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"floorId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FloorPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchFloor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"floorId"},value:{kind:"Variable",name:{kind:"Name",value:"floorId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:380}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"query GetFloors($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    floors { ...FloorDetails }\n  }\n}\n\nfragment FloorDetails on ModelFloor {\n  id\n  meshId\n  classification\n  label\n  sequence\n  dimensions {\n    areaFloor\n  }\n}\n\nmutation PatchFloor($modelId: ID!, $floorId: ID!, $data: FloorPatch!) {\n  patchFloor(modelId: $modelId, , floorId: $floorId, patch: $data) {\n    id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetFloors=o(t,"GetFloors"),e.exports.FloorDetails=o(t,"FloorDetails"),e.exports.PatchFloor=o(t,"PatchFloor")},74054:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetHighlightReel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeHighlightReel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"HighlightReelDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PutActiveReel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elements"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ReelElementInput"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"putActiveReel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"elements"},value:{kind:"Variable",name:{kind:"Name",value:"elements"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"HighlightReelDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"HighlightReel"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"overrides"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"transitionType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"panDirection"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"panAngle"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"asset"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:489}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"query GetHighlightReel($modelId: ID!) {\n  model(id: $modelId) {\n    activeHighlightReel {\n      ...HighlightReelDetails\n    }\n  }\n}\n\nmutation PutActiveReel($modelId: ID!, $elements: [ReelElementInput!]) {\n  putActiveReel(modelId: $modelId, elements: $elements) {\n    id\n  }\n}\n\nfragment HighlightReelDetails on HighlightReel {\n  id\n  label\n  reel {\n    overrides {\n      transitionType\n      panDirection\n      panAngle\n    }\n    asset {\n      ... on Photo {\n        id\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetHighlightReel=o(t,"GetHighlightReel"),e.exports.PutActiveReel=o(t,"PutActiveReel"),e.exports.HighlightReelDetails=o(t,"HighlightReelDetails")},23637:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLabels"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LabelDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Label"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:921}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"# Read all labels for the given model\nquery GetLabels($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    labels (includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n  }\n}\n\n# Create a new label\nmutation AddLabel ($modelId: ID!, $labelId: ID, $data: LabelDetails!) {\n  addLabel(modelId: $modelId, labelId: $labelId, label: $data) {\n    ...LabelDetails\n  }\n}\n\n# Update a single label\nmutation PatchLabel ($modelId: ID!, $labelId: ID!, $data: LabelPatch!) {\n  patchLabel(modelId: $modelId, , labelId: $labelId, patch: $data) {\n    ...LabelDetails\n  }\n}\n\n# Deletes a single label\nmutation DeleteLabel ($modelId: ID!, ,$labelId: ID!) {\n  deleteLabel(modelId: $modelId, ,labelId: $labelId)\n}\n\n# Default Label properties used by Showcase and Workshop\nfragment LabelDetails on Label {\n  id\n  position { x y z }\n  floor { id meshId }\n  room { id meshId }\n  label\n  enabled\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetLabels=o(t,"GetLabels"),e.exports.AddLabel=o(t,"AddLabel"),e.exports.PatchLabel=o(t,"PatchLabel"),e.exports.DeleteLabel=o(t,"DeleteLabel"),e.exports.LabelDetails=o(t,"LabelDetails")},55482:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMattertags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MattertagDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertag"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MattertagDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mattertag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:922}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"# read all mattertags for the specified model\nquery GetMattertags($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n  }\n}\n\n# add a new mattertag\nmutation AddMattertag($modelId:ID!, $mattertagId: ID, $data: MattertagDetails!) {\n  addMattertag(modelId: $modelId, mattertagId: $mattertagId, mattertag: $data) {\n    id\n    created\n    modified\n  }\n}\n\n# delete an existing tag by id\nmutation DeleteMattertag($modelId: ID!, $mattertagId: ID!) {\n  deleteMattertag(modelId: $modelId, mattertagId: $mattertagId)\n}\n\n# common Mattertag properties used by Showcase and Workshop\nfragment MattertagDetails on Mattertag {\n  id\n  label\n  description\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x y z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  media\n  mediaType\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetMattertags=o(t,"GetMattertags"),e.exports.AddMattertag=o(t,"AddMattertag"),e.exports.DeleteMattertag=o(t,"DeleteMattertag"),e.exports.MattertagDetails=o(t,"MattertagDetails")},64341:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMeasurements"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"path"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeasurementDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPath"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lineType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"points"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:827}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"\nquery GetMeasurements($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    measurementPaths(includeDisabled: $includeDisabled) {\n      ...MeasurementDetails\n    }\n  }\n}\n\nmutation AddMeasurement($modelId: ID!, $data: MeasurementPathDetails!) {\n  addMeasurementPath(modelId: $modelId, , path: $data) {\n    id\n  }\n}\n\nmutation PatchMeasurement($modelId: ID!, $pathId: ID!, $data: MeasurementPathPatch!) {\n  patchMeasurementPath(modelId: $modelId, , pathId: $pathId, patch: $data) {\n    id\n  }\n}\n\nmutation DeleteMeasurement($modelId: ID!, $pathId: ID!) {\n  deleteMeasurementPath(modelId: $modelId, , pathId: $pathId)\n}\n\nfragment MeasurementDetails on MeasurementPath {\n  id\n  lineType\n  label\n  enabled\n  points {\n    position { x y z }\n    floor { id meshId }\n    room { id meshId }\n  }\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetMeasurements=o(t,"GetMeasurements"),e.exports.AddMeasurement=o(t,"AddMeasurement"),e.exports.PatchMeasurement=o(t,"PatchMeasurement"),e.exports.DeleteMeasurement=o(t,"DeleteMeasurement"),e.exports.MeasurementDetails=o(t,"MeasurementDetails")},52227:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelOptions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AddressDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"patch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ModelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"patch"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeshDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mesh"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"TextureDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Texture"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationDetails"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"published"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastPublished"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contact"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"phoneNumber"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AddressDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Address"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"streetAddressLines"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"administrativeArea"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dependentLocality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"postalCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sortingCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"countryCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"countryName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lines"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tourButtonsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseLabelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorplanEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorSelectEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"highlightReelEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourFastTransitionsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"socialSharingEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanAngle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanDirection"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourZoomDuration"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourDollhousePanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unitType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurements"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vrEnabled"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactEmail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactPhone"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelImage"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}}],loc:{start:0,end:2042}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:'query GetModelOptions($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    publication {\n      options { ...PublicationOptions }\n    }\n    options { ...ModelOptions }\n  }\n}\n\nquery GetModelDetails($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    name\n    organization\n    visibility\n    image { ...ModelImage }\n    address { ...AddressDetails }\n    publication { ...PublicationDetails }\n    options { ...ModelOptions }\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n    }\n  }\n}\n\nmutation PatchModel($modelId: ID!, $patch: ModelPatch!) {\n  patchModel(id: $modelId, , patch: $patch) {\n    id\n  }\n}\n\nfragment MeshDetails on Mesh {\n  id\n  status\n  filename\n  format\n  resolution\n  url\n  validUntil\n}\n\nfragment TextureDetails on Texture {\n  id\n  status\n  format\n  resolution\n  quality\n  urlTemplate\n  validUntil\n}\n\nfragment PublicationDetails on ModelPublicationDetails {\n  published\n  lastPublished\n  presentedBy\n  summary\n  externalUrl\n  contact {\n    name\n    email\n    phoneNumber\n  }\n}\n\nfragment AddressDetails on Address {\n  streetAddressLines\n  administrativeArea\n  locality\n  dependentLocality\n  postalCode\n  sortingCode\n  countryCode\n  countryName\n  lines\n  address\n  status\n}\n\nfragment ModelOptions on ModelOptions {\n  tourButtonsEnabled\n  dollhouseEnabled\n  dollhouseLabelsEnabled\n  floorplanEnabled\n  floorSelectEnabled\n  labelsEnabled\n  highlightReelEnabled\n  tourFastTransitionsEnabled\n  backgroundColor\n  socialSharingEnabled\n  tourPanAngle\n  tourPanSpeed\n  tourPanDirection\n  tourTransitionSpeed\n  tourTransitionTime\n  tourZoomDuration\n  tourDollhousePanSpeed\n  unitType\n  measurements\n  vrEnabled\n}\n\nfragment PublicationOptions on ModelPublicationOptions {\n  contactEmail\n  contactName\n  contactPhone\n  modelName\n  modelSummary\n  presentedBy\n  address\n  externalUrl\n}\n\nfragment ModelImage on Photo {\n  id\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  width\n  height\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetModelOptions=o(t,"GetModelOptions"),e.exports.GetModelDetails=o(t,"GetModelDetails"),e.exports.PatchModel=o(t,"PatchModel"),e.exports.MeshDetails=o(t,"MeshDetails"),e.exports.TextureDetails=o(t,"TextureDetails"),e.exports.PublicationDetails=o(t,"PublicationDetails"),e.exports.AddressDetails=o(t,"AddressDetails"),e.exports.ModelOptions=o(t,"ModelOptions"),e.exports.PublicationOptions=o(t,"PublicationOptions"),e.exports.ModelImage=o(t,"ModelImage")},24411:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"snapshotLocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"zoom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorVisibility"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:1540}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"query GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      photos { ...PhotoDetails }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n\nfragment PhotoDetails on Photo {\n  id\n  label\n  classification\n  category\n  height\n  width\n  created\n  modified\n  status\n  filename\n  format\n  url\n  resolutions\n  type\n  origin\n  validUntil\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  snapshotLocation {\n    viewMode\n    position { x y z }\n    rotation { x y z w }\n    zoom\n    floorVisibility {\n      id\n      meshId\n      sequence\n    }\n    anchor {\n      id\n      pano {\n        placement\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetSnapshots=o(t,"GetSnapshots"),e.exports.PatchPhoto=o(t,"PatchPhoto"),e.exports.DeletePhoto=o(t,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=o(t,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=o(t,"UploadModelSnapshot"),e.exports.PhotoDetails=o(t,"PhotoDetails")},52050:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRooms"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"RoomDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelRoom"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]}]}}],loc:{start:0,end:259}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"\nquery GetRooms ($modelId: ID!) {\n  model(id: $modelId) {\n    rooms {\n      ...RoomDetails\n    }\n  }\n}\n\nfragment RoomDetails on ModelRoom {\n  id\n  meshId\n  floor {\n    id\n    meshId\n  }\n  dimensions {\n    height\n    width\n    depth\n    areaFloor\n  }\n  tags\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetRooms=o(t,"GetRooms"),e.exports.RoomDetails=o(t,"RoomDetails")},12757:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetScans"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"scans"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ScanDetails"},directives:[]}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ScanDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Scan"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"index"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"alignment"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"timeOfDay"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"camera"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vendor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"captureMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depthCameraType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cameraTypes"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sensorSerialNumbers"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"serialNumber"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mountCalibrationVersion"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"softwareVersion"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:445}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"query GetScans($modelId: ID!) {\n  model(id: $modelId) {\n    assets {\n      scans {\n        ...ScanDetails\n      }\n    }\n  }\n}\n\nfragment ScanDetails on Scan {\n  id\n  index\n  name\n  created\n  alignment\n  options\n  url\n  timeOfDay\n  anchor {\n    id\n  }\n  camera {\n    id\n    name\n    vendor\n    model\n    captureMode\n    depthCameraType\n    cameraTypes\n    sensorSerialNumbers\n    serialNumber\n    mountCalibrationVersion\n    softwareVersion\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetScans=o(t,"GetScans"),e.exports.ScanDetails=o(t,"ScanDetails")},36690:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShowcaseSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SkyboxPanorama"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileResolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileUrlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxUrlDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PanoramicImageLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"skyboxes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AnchorLocationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnchorLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"index"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"neighbors"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sweepUuid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxUrlDetails"},directives:[]}]}}]}}],loc:{start:0,end:814}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:'\nquery GetSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nquery GetShowcaseSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations(tags: "showcase") {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nfragment SkyboxDetails on SkyboxPanorama {\n  resolution\n  status\n  urlTemplate\n  tileResolution\n  tileCount\n  tileUrlTemplate\n  validUntil\n}\n\nfragment SkyboxUrlDetails on PanoramicImageLocation {\n  resolutions\n  skyboxes { ...SkyboxDetails }\n}\n\nfragment AnchorLocationDetails on AnchorLocation {\n  id\n  index\n  floor { id, meshId }\n  room { id, meshId }\n  neighbors\n  tags\n  position { x y z }\n  pano {\n    id\n    sweepUuid\n    label\n    placement\n    source\n    position { x y z }\n    rotation { x y z w }\n    ...SkyboxUrlDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetSweeps=o(t,"GetSweeps"),e.exports.GetShowcaseSweeps=o(t,"GetShowcaseSweeps"),e.exports.SkyboxDetails=o(t,"SkyboxDetails"),e.exports.SkyboxUrlDetails=o(t,"SkyboxUrlDetails"),e.exports.AnchorLocationDetails=o(t,"AnchorLocationDetails")},20517:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMergeDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeDiff"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"src"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dest"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"typesModified"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"views"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PublishView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"merge"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RevertView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MergeableType"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"revert"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:707}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}t.loc.source={body:"\n# Gets the data types that have changed between a view and the base model\nquery GetMergeDiff($viewId: ID!) {\n  model(id: $viewId) {\n    mergeDiff {\n      src\n      dest\n      typesModified\n    }\n  }\n}\n\n# Get available views for a model\nquery GetViews($modelId: ID!) {\n  model(id: $modelId) {\n    views {\n      id\n      type\n    }\n  }\n}\n\n# Merges the given view into the base model view\nmutation PublishView($viewId: ID!) {\n  mergeMutator(src: $viewId) {\n    merge {\n      id\n    }\n  }\n}\n\n# Resets the provided view to be the same as the base model view\nmutation RevertView($viewId: ID!, $mergeTypes: [MergeableType!]) {\n  mergeMutator(src: $viewId) {\n    revert(types: $mergeTypes ) {\n      id\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function n(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(s[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var s=n(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetMergeDiff=o(t,"GetMergeDiff"),e.exports.GetViews=o(t,"GetViews"),e.exports.PublishView=o(t,"PublishView"),e.exports.RevertView=o(t,"RevertView")},50972:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.prototype.toJSON;"function"==typeof t||(0,s.default)(0),e.prototype.inspect=t,n.default&&(e.prototype[n.default]=t)};var s=o(i(7706)),n=o(i(18554));function o(e){return e&&e.__esModule?e:{default:e}}},8002:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(e,[])};var s,n=(s=i(18554))&&s.__esModule?s:{default:s};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){switch(o(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),s=function(e){var t=e[String(n.default)];return"function"==typeof t?t:"function"==typeof e.inspect?e.inspect:void 0}(e);if(void 0!==s){var o=s.call(e);if(o!==e)return"string"==typeof o?o:r(o,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),s=e.length-i,n=[],o=0;o<i;++o)n.push(r(e[o],t));return 1===s?n.push("... 1 more item"):s>1&&n.push("... ".concat(s," more items")),"["+n.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);return 0===i.length?"{}":t.length>2?"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]":"{ "+i.map((function(i){return i+": "+r(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},6589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(97986);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return r(e,[])}function r(e,t){switch(n(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),n=function(e){var t=e[String(s.Z)];return"function"==typeof t?t:"function"==typeof e.inspect?e.inspect:void 0}(e);if(void 0!==n){var o=n.call(e);if(o!==e)return"string"==typeof o?o:r(o,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),s=e.length-i,n=[],o=0;o<i;++o)n.push(r(e[o],t));return 1===s?n.push("... 1 more item"):s>1&&n.push("... ".concat(s," more items")),"["+n.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);return 0===i.length?"{}":t.length>2?"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]":"{ "+i.map((function(i){return i+": "+r(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},7706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}},18554:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;t.default=i},97986:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0},91807:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=function(e){return null!=e&&"string"==typeof e.kind},t.Token=t.Location=void 0;var s,n=(s=i(50972))&&s.__esModule?s:{default:s},o=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();t.Location=o,(0,n.default)(o);var r=function(){function e(e,t,i,s,n,o,r){this.kind=e,this.start=t,this.end=i,this.line=s,this.column=n,this.value=r,this.prev=o,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();t.Token=r,(0,n.default)(r)},83059:(e,t,i)=>{"use strict";i.d(t,{Ye:()=>o,WU:()=>r,UG:()=>a});var s=i(97986);function n(e){var t=e.prototype.toJSON;"function"==typeof t||function(e,t){if(!Boolean(0))throw new Error("Unexpected invariant triggered.")}(),e.prototype.inspect=t,s.Z&&(e.prototype[s.Z]=t)}var o=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();n(o);var r=function(){function e(e,t,i,s,n,o,r){this.kind=e,this.start=t,this.end=i,this.line=s,this.column=n,this.value=r,this.prev=o,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();function a(e){return null!=e&&"string"==typeof e.kind}n(r)},7420:(e,t,i)=>{"use strict";function s(e){var t=e.split(/\r\n|[\n\r]/g),i=function(e){for(var t,i=!0,s=!0,n=0,o=null,r=0;r<e.length;++r)switch(e.charCodeAt(r)){case 13:10===e.charCodeAt(r+1)&&++r;case 10:i=!1,s=!0,n=0;break;case 9:case 32:++n;break;default:s&&!i&&(null===o||n<o)&&(o=n),s=!1}return null!==(t=o)&&void 0!==t?t:0}(e);if(0!==i)for(var s=1;s<t.length;s++)t[s]=t[s].slice(i);for(var o=0;o<t.length&&n(t[o]);)++o;for(var r=t.length;r>o&&n(t[r-1]);)--r;return t.slice(o,r).join("\n")}function n(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"\t"!==e[t])return!1;return!0}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=-1===e.indexOf("\n"),n=" "===e[0]||"\t"===e[0],o='"'===e[e.length-1],r="\\"===e[e.length-1],a=!s||o||r||i,l="";return!a||s&&n||(l+="\n"+t),l+=t?e.replace(/\n/g,"\n"+t):e,a&&(l+="\n"),'"""'+l.replace(/"""/g,'\\"""')+'"""'}i.d(t,{W7:()=>s,LZ:()=>o})},90778:(e,t,i)=>{"use strict";i.d(t,{S:()=>o});var s=i(27636),n=i(7420);function o(e){return(0,s.Vn)(e,{leave:r})}var r={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return l(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,i=e.name,s=h("(",l(e.variableDefinitions,", "),")"),n=l(e.directives," "),o=e.selectionSet;return i||n||s||"query"!==t?l([t,l([i,s]),n,o]," "):o},VariableDefinition:function(e){var t=e.variable,i=e.type,s=e.defaultValue,n=e.directives;return t+": "+i+h(" = ",s)+h(" ",l(n," "))},SelectionSet:function(e){return c(e.selections)},Field:function(e){var t=e.alias,i=e.name,s=e.arguments,n=e.directives,o=e.selectionSet,r=h("",t,": ")+i,a=r+h("(",l(s,", "),")");return a.length>80&&(a=r+h("(\n",d(l(s,"\n")),"\n)")),l([a,l(n," "),o]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+h(" ",l(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,i=e.directives,s=e.selectionSet;return l(["...",h("on ",t),l(i," "),s]," ")},FragmentDefinition:function(e){var t=e.name,i=e.typeCondition,s=e.variableDefinitions,n=e.directives,o=e.selectionSet;return"fragment ".concat(t).concat(h("(",l(s,", "),")")," ")+"on ".concat(i," ").concat(h("",l(n," ")," "))+o},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var i=e.value;return e.block?(0,n.LZ)(i,"description"===t?"":"  "):JSON.stringify(i)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+l(e.values,", ")+"]"},ObjectValue:function(e){return"{"+l(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+h("(",l(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:a((function(e){var t=e.directives,i=e.operationTypes;return l(["schema",l(t," "),c(i)]," ")})),OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:a((function(e){return l(["scalar",e.name,l(e.directives," ")]," ")})),ObjectTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,s=e.directives,n=e.fields;return l(["type",t,h("implements ",l(i," & ")),l(s," "),c(n)]," ")})),FieldDefinition:a((function(e){var t=e.name,i=e.arguments,s=e.type,n=e.directives;return t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+": "+s+h(" ",l(n," "))})),InputValueDefinition:a((function(e){var t=e.name,i=e.type,s=e.defaultValue,n=e.directives;return l([t+": "+i,h("= ",s),l(n," ")]," ")})),InterfaceTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,s=e.directives,n=e.fields;return l(["interface",t,h("implements ",l(i," & ")),l(s," "),c(n)]," ")})),UnionTypeDefinition:a((function(e){var t=e.name,i=e.directives,s=e.types;return l(["union",t,l(i," "),s&&0!==s.length?"= "+l(s," | "):""]," ")})),EnumTypeDefinition:a((function(e){var t=e.name,i=e.directives,s=e.values;return l(["enum",t,l(i," "),c(s)]," ")})),EnumValueDefinition:a((function(e){return l([e.name,l(e.directives," ")]," ")})),InputObjectTypeDefinition:a((function(e){var t=e.name,i=e.directives,s=e.fields;return l(["input",t,l(i," "),c(s)]," ")})),DirectiveDefinition:a((function(e){var t=e.name,i=e.arguments,s=e.repeatable,n=e.locations;return"directive @"+t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+(s?" repeatable":"")+" on "+l(n," | ")})),SchemaExtension:function(e){var t=e.directives,i=e.operationTypes;return l(["extend schema",l(t," "),c(i)]," ")},ScalarTypeExtension:function(e){return l(["extend scalar",e.name,l(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,i=e.interfaces,s=e.directives,n=e.fields;return l(["extend type",t,h("implements ",l(i," & ")),l(s," "),c(n)]," ")},InterfaceTypeExtension:function(e){var t=e.name,i=e.interfaces,s=e.directives,n=e.fields;return l(["extend interface",t,h("implements ",l(i," & ")),l(s," "),c(n)]," ")},UnionTypeExtension:function(e){var t=e.name,i=e.directives,s=e.types;return l(["extend union",t,l(i," "),s&&0!==s.length?"= "+l(s," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,i=e.directives,s=e.values;return l(["extend enum",t,l(i," "),c(s)]," ")},InputObjectTypeExtension:function(e){var t=e.name,i=e.directives,s=e.fields;return l(["extend input",t,l(i," "),c(s)]," ")}};function a(e){return function(t){return l([t.description,e(t)],"\n")}}function l(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(t=null==e?void 0:e.filter((function(e){return e})).join(i))&&void 0!==t?t:""}function c(e){return h("{\n",d(l(e,"\n")),"\n}")}function h(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return null!=t&&""!==t?e+t+i:""}function d(e){return h("  ",e.replace(/\n/g,"\n  "))}function u(e){return-1!==e.indexOf("\n")}function p(e){return null!=e&&e.some(u)}},80285:(e,t,i)=>{"use strict";t.Vn=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,s=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,w=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),w){if(c)p=p.slice();else{for(var S={},T=0,E=Object.keys(p);T<E.length;T++){var _=E[T];S[_]=p[_]}p=S}for(var x=0,M=0;M<u.length;M++){var P=u[M][0],A=u[M][1];c&&(P-=x),c&&null===A?(p.splice(P,1),x++):p[P]=A}}d=s.index,h=s.keys,u=s.edits,c=s.inArray,s=s.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var O,D=void 0;if(!Array.isArray(p)){if(!(0,o.isNode)(p))throw new Error("Invalid AST Node: ".concat((0,n.default)(p),"."));var I=l(t,p.kind,b);if(I){if((D=I.call(t,p,m,g,f,v))===a)break;if(!1===D){if(!b){f.pop();continue}}else if(void 0!==D&&(u.push([m,D]),!b)){if(!(0,o.isNode)(D)){f.pop();continue}p=D}}}void 0===D&&w&&u.push([m,p]),b?f.pop():(s={inArray:c,index:d,keys:h,edits:u,prev:s},h=(c=Array.isArray(p))?p:null!==(O=i[p.kind])&&void 0!==O?O:[],d=-1,u=[],g&&v.push(g),g=p)}while(void 0!==s);return 0!==u.length&&(y=u[u.length-1][1]),y};var s,n=(s=i(8002))&&s.__esModule?s:{default:s},o=i(91807),r={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},a=Object.freeze({});function l(e,t,i){var s=e[t];if(s){if(!i&&"function"==typeof s)return s;var n=i?s.leave:s.enter;if("function"==typeof n)return n}else{var o=i?e.leave:e.enter;if(o){if("function"==typeof o)return o;var r=o[t];if("function"==typeof r)return r}}}},27636:(e,t,i)=>{"use strict";i.d(t,{$_:()=>r,Vn:()=>a});var s=i(6589),n=i(83059),o={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},r=Object.freeze({});function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,a=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,w=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),w){if(c)p=p.slice();else{for(var S={},T=0,E=Object.keys(p);T<E.length;T++){var _=E[T];S[_]=p[_]}p=S}for(var x=0,M=0;M<u.length;M++){var P=u[M][0],A=u[M][1];c&&(P-=x),c&&null===A?(p.splice(P,1),x++):p[P]=A}}d=a.index,h=a.keys,u=a.edits,c=a.inArray,a=a.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var O,D=void 0;if(!Array.isArray(p)){if(!(0,n.UG)(p))throw new Error("Invalid AST Node: ".concat((0,s.Z)(p),"."));var I=l(t,p.kind,b);if(I){if((D=I.call(t,p,m,g,f,v))===r)break;if(!1===D){if(!b){f.pop();continue}}else if(void 0!==D&&(u.push([m,D]),!b)){if(!(0,n.UG)(D)){f.pop();continue}p=D}}}void 0===D&&w&&u.push([m,p]),b?f.pop():(a={inArray:c,index:d,keys:h,edits:u,prev:a},h=(c=Array.isArray(p))?p:null!==(O=i[p.kind])&&void 0!==O?O:[],d=-1,u=[],g&&v.push(g),g=p)}while(void 0!==a);return 0!==u.length&&(y=u[u.length-1][1]),y}function l(e,t,i){var s=e[t];if(s){if(!i&&"function"==typeof s)return s;var n=i?s.leave:s.enter;if("function"==typeof n)return n}else{var o=i?e.leave:e.enter;if(o){if("function"==typeof o)return o;var r=o[t];if("function"==typeof r)return r}}}},41405:(e,t,i)=>{"use strict";var s=i.g.Symbol,n=i(55419);e.exports=function(){return"function"==typeof s&&"function"==typeof Symbol&&"symbol"==typeof s("foo")&&"symbol"==typeof Symbol("bar")&&n()}},55419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var s=Object.getOwnPropertySymbols(e);if(1!==s.length||s[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},17642:(e,t,i)=>{"use strict";var s=i(58612);e.exports=s.call(Function.call,Object.prototype.hasOwnProperty)},80645:(e,t)=>{t.read=function(e,t,i,s,n){var o,r,a=8*n-s-1,l=(1<<a)-1,c=l>>1,h=-7,d=i?n-1:0,u=i?-1:1,p=e[t+d];for(d+=u,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+e[t+d],d+=u,h-=8);for(r=o&(1<<-h)-1,o>>=-h,h+=s;h>0;r=256*r+e[t+d],d+=u,h-=8);if(0===o)o=1-c;else{if(o===l)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,s),o-=c}return(p?-1:1)*r*Math.pow(2,o-s)},t.write=function(e,t,i,s,n,o){var r,a,l,c=8*o-n-1,h=(1<<c)-1,d=h>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=s?0:o-1,m=s?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=h):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),(t+=r+d>=1?u/l:u*Math.pow(2,1-d))*l>=2&&(r++,l/=2),r+d>=h?(a=0,r=h):r+d>=1?(a=(t*l-1)*Math.pow(2,n),r+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,n),r=0));n>=8;e[i+p]=255&a,p+=m,a/=256,n-=8);for(r=r<<n|a,c+=n;c>0;e[i+p]=255&r,p+=m,r/=256,c-=8);e[i+p-m]|=128*g}},35717:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},48738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},95320:e=>{"use strict";var t,i,s=Function.prototype.toString,n="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof n&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw i}}),i={},n((function(){throw 42}),null,t)}catch(e){e!==i&&(n=null)}else n=null;var o=/^\s*class\b/,r=function(e){try{var t=s.call(e);return o.test(t)}catch(e){return!1}},a=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=n?function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;try{n(e,null,t)}catch(e){if(e!==i)return!1}return!r(e)}:function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(l)return function(e){try{return!r(e)&&(s.call(e),!0)}catch(e){return!1}}(e);if(r(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},73134:(e,t,i)=>{var s=i(12739),n=i(47529),o=i(14176),r=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0);function d(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function u(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var i=g(e.chars,t);return i>=0?e.chars[i]:null}function m(e,t,i){if(!e.kernings||0===e.kernings.length)return 0;for(var s=e.kernings,n=0;n<s.length;n++){var o=s[n];if(o.first===t&&o.second===i)return o.amount}return 0}function g(e,t,i){for(var s=i=i||0;s<e.length;s++)if(e[s].id===t)return s;return-1}e.exports=function(e){return new d(e)},d.prototype.update=function(e){if(e=n({measure:this._measure},e),this._opt=e,this._opt.tabSize=o(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,i=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=s.lines(i,e);t.length=0;var h=c.reduce((function(e,t){return Math.max(e,t.width,0)}),0),d=0,u=0,p=o(e.lineHeight,a.common.lineHeight),f=a.common.base,v=p-f,y=e.letterSpacing||0,b=p*c.length-v,w=function(e){return"center"===e?1:"right"===e?2:0}(this._opt.align);u-=b,this._width=h,this._height=b,this._descender=p-f,this._baseline=f,this._xHeight=function(e){for(var t=0;t<r.length;t++){var i=r[t].charCodeAt(0),s=g(e.chars,i);if(s>=0)return e.chars[s].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<l.length;t++){var i=l[t].charCodeAt(0),s=g(e.chars,i);if(s>=0)return e.chars[s].height}return 0}(a),this._lineHeight=p,this._ascender=p-v-this._xHeight;var S=this;c.forEach((function(e,s){for(var n,o=e.start,r=e.end,l=e.width,c=o;c<r;c++){var g=i.charCodeAt(c),f=S.getGlyph(a,g);if(f){n&&(d+=m(a,n.id,f.id));var v=d;1===w?v+=(h-l)/2:2===w&&(v+=h-l),t.push({position:[v,u],data:f,index:c,line:s}),d+=f.xadvance+y,n=f}}u+=p,d=0})),this._linesTotal=c.length},d.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,h)||function(e){for(var t=0;t<a.length;t++){var i=a[t].charCodeAt(0),s=g(e.chars,i);if(s>=0)return e.chars[s]}return 0}(e)||e.chars[0],i=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=n(t,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},d.prototype.getGlyph=function(e,t){return p(e,t)||(t===c?this._fallbackTabGlyph:t===h?this._fallbackSpaceGlyph:null)},d.prototype.computeMetrics=function(e,t,i,s){var n,o=this._opt.letterSpacing||0,r=this._opt.font,a=0,l=0,c=0;if(!r.chars||0===r.chars.length)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(var h=t;h<i;h++){var d,u=e.charCodeAt(h);if(d=this.getGlyph(r,u)){d.xoffset;var p=(a+=n?m(r,n.id,d.id):0)+d.xadvance+o,g=a+d.width;if(g>=s||p>=s)break;a=p,l=g,n=d}c++}return n&&(l+=n.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(d.prototype,e,{get:u(e),configurable:!0})}))},6225:()=>{},54078:(e,t,i)=>{"use strict";var s=i(94029),n=i(42473),o=i(17642),r=i(46057),a=function(e){n(!1,e)},l=String.prototype.replace,c=String.prototype.split,h="||||",d=function(e){var t=e%100,i=t%10;return 11!==t&&1===i?0:2<=i&&i<=4&&!(t>=12&&t<=14)?1:2},u={pluralTypes:{arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:d,chinese:function(){return 0},croatian:d,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:d,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}};function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var m=/%\{(.*?)\}/g;function g(e,t,i,n,a){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var d=e,p=n||m,g=a||u,f="number"==typeof t?{smart_count:t}:t;if(null!=f.smart_count&&d){var v=c.call(d,h);d=r(v[function(e,t,i){return e.pluralTypes[function(e,t){var i,n,o=(i=e.pluralTypeToLanguages,n={},s(i,(function(e,t){s(e,(function(e){n[e]=t}))})),n);return o[t]||o[c.call(t,/-/,1)[0]]||o.en}(e,t)](i)}(g,i||"en",f.smart_count)]||v[0])}return l.call(d,p,(function(e,t){return o(f,t)&&null!=f[t]?f[t]:e}))}function f(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?g:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||a,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if(t===h||i===h)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(p(t)+"(.*?)"+p(i),"g")}(t.interpolation),this.pluralRules=t.pluralRules||u}f.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},f.prototype.extend=function(e,t){s(e,(function(e,i){var s=t?t+"."+i:i;"object"==typeof e?this.extend(e,s):this.phrases[s]=e}),this)},f.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:s(e,(function(e,i){var s=t?t+"."+i:i;"object"==typeof e?this.unset(e,s):delete this.phrases[s]}),this)},f.prototype.clear=function(){this.phrases={}},f.prototype.replace=function(e){this.clear(),this.extend(e)},f.prototype.t=function(e,t){var i,s,n=null==t?{}:t;return"string"==typeof this.phrases[e]?i=this.phrases[e]:"string"==typeof n._?i=n._:this.onMissingKey?s=(0,this.onMissingKey)(e,n,this.currentLocale,this.tokenRegex,this.pluralRules):(this.warn('Missing translation for key: "'+e+'"'),s=e),"string"==typeof i&&(s=g(i,n,this.currentLocale,this.tokenRegex,this.pluralRules)),s},f.prototype.has=function(e){return o(this.phrases,e)},f.transformPhrase=function(e,t,i){return g(e,t,i)},e.exports=f},18987:(e,t,i)=>{"use strict";var s;if(!Object.keys){var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString,r=i(21414),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&n.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();s=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===o.call(e),s=r(e),a=t&&"[object String]"===o.call(e),u=[];if(!t&&!i&&!s)throw new TypeError("Object.keys called on a non-object");var m=c&&i;if(a&&e.length>0&&!n.call(e,0))for(var g=0;g<e.length;++g)u.push(String(g));if(s&&e.length>0)for(var f=0;f<e.length;++f)u.push(String(f));else for(var v in e)m&&"prototype"===v||!n.call(e,v)||u.push(String(v));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return d(e);try{return d(e)}catch(e){return!1}}(e),b=0;b<h.length;++b)y&&"constructor"===h[b]||!n.call(e,h[b])||u.push(h[b]);return u}}e.exports=s},82215:(e,t,i)=>{"use strict";var s=Array.prototype.slice,n=i(21414),o=Object.keys,r=o?function(e){return o(e)}:i(18987),a=Object.keys;r.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return n(e)?a(s.call(e)):a(e)}):Object.keys=r,Object.keys||r},e.exports=r},21414:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var i=t.call(e),s="[object Arguments]"===i;return s||(s="[object Array]"!==i&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),s}},16801:(e,t)=>{"use strict";var i=t.uO={};i.read=function(e,t){return e.readFields(i._readField,{chunk:[],quantized_chunk:[]},t)},i._readField=function(e,t,i){1===e?t.chunk.push(o.read(i,i.readVarint()+i.pos)):2===e&&t.quantized_chunk.push(l.read(i,i.readVarint()+i.pos))},i.write=function(e,t){if(e.chunk)for(var i=0;i<e.chunk.length;i++)t.writeMessage(1,o.write,e.chunk[i]);if(e.quantized_chunk)for(i=0;i<e.quantized_chunk.length;i++)t.writeMessage(2,l.write,e.quantized_chunk[i])};var s={read:function(e,t){return e.readFields(s._readField,{xyz:[],uv:[]},t)},_readField:function(e,t,i){1===e?i.readPackedFloat(t.xyz):2===e&&i.readPackedFloat(t.uv)},write:function(e,t){e.xyz&&t.writePackedFloat(1,e.xyz),e.uv&&t.writePackedFloat(2,e.uv)}},n={read:function(e,t){return e.readFields(n._readField,{faces:[]},t)},_readField:function(e,t,i){1===e&&i.readPackedVarint(t.faces)},write:function(e,t){e.faces&&t.writePackedVarint(1,e.faces)}},o={read:function(e,t){return e.readFields(o._readField,{vertices:null,faces:null,chunk_name:"",material_name:""},t)},_readField:function(e,t,i){1===e?t.vertices=s.read(i,i.readVarint()+i.pos):2===e?t.faces=n.read(i,i.readVarint()+i.pos):3===e?t.chunk_name=i.readString():4===e&&(t.material_name=i.readString())},write:function(e,t){e.vertices&&t.writeMessage(1,s.write,e.vertices),e.faces&&t.writeMessage(2,n.write,e.faces),e.chunk_name&&t.writeStringField(3,e.chunk_name),e.material_name&&t.writeStringField(4,e.material_name)}},r={read:function(e,t){return e.readFields(r._readField,{quantization:0,translation:[],x:[],y:[],z:[]},t)},_readField:function(e,t,i){1===e?t.quantization=i.readFloat():2===e?i.readPackedFloat(t.translation):3===e?i.readPackedSVarint(t.x):4===e?i.readPackedSVarint(t.y):5===e&&i.readPackedSVarint(t.z)},write:function(e,t){e.quantization&&t.writeFloatField(1,e.quantization),e.translation&&t.writePackedFloat(2,e.translation),e.x&&t.writePackedSVarint(3,e.x),e.y&&t.writePackedSVarint(4,e.y),e.z&&t.writePackedSVarint(5,e.z)}},a={read:function(e,t){return e.readFields(a._readField,{name:"",quantization:0,u:[],v:[]},t)},_readField:function(e,t,i){1===e?t.name=i.readString():2===e?t.quantization=i.readFloat():3===e?i.readPackedSVarint(t.u):4===e&&i.readPackedSVarint(t.v)},write:function(e,t){e.name&&t.writeStringField(1,e.name),e.quantization&&t.writeFloatField(2,e.quantization),e.u&&t.writePackedSVarint(3,e.u),e.v&&t.writePackedSVarint(4,e.v)}},l={read:function(e,t){return e.readFields(l._readField,{chunk_name:"",material_name:"",vertices:null,uvs:[],faces:null},t)},_readField:function(e,t,i){1===e?t.chunk_name=i.readString():2===e?t.material_name=i.readString():3===e?t.vertices=r.read(i,i.readVarint()+i.pos):4===e?t.uvs.push(a.read(i,i.readVarint()+i.pos)):5===e&&(t.faces=n.read(i,i.readVarint()+i.pos))},write:function(e,t){if(e.chunk_name&&t.writeStringField(1,e.chunk_name),e.material_name&&t.writeStringField(2,e.material_name),e.vertices&&t.writeMessage(3,r.write,e.vertices),e.uvs)for(var i=0;i<e.uvs.length;i++)t.writeMessage(4,a.write,e.uvs[i]);e.faces&&t.writeMessage(5,n.write,e.faces)}}},3614:(e,t,i)=>{"use strict";e.exports=n;var s=i(80645);function n(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var o=4294967296,r=1/o;function a(e){return e.type===n.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,i){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));i.realloc(s);for(var n=i.pos-1;n>=e;n--)i.buf[n+s]=i.buf[n]}function h(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function v(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function y(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function b(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function w(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}n.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),n=s>>3,o=this.pos;this.type=7&s,e(n,t,this),this.pos===o&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=b(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=S(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=b(this.buf,this.pos)+S(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,s=this.buf;return t=127&(i=s[this.pos++]),i<128?t:(t|=(127&(i=s[this.pos++]))<<7,i<128?t:(t|=(127&(i=s[this.pos++]))<<14,i<128?t:(t|=(127&(i=s[this.pos++]))<<21,i<128?t:function(e,t,i){var s,n,o=i.buf;if(s=(112&(n=o[i.pos++]))>>4,n<128)return l(e,s,t);if(s|=(127&(n=o[i.pos++]))<<3,n<128)return l(e,s,t);if(s|=(127&(n=o[i.pos++]))<<10,n<128)return l(e,s,t);if(s|=(127&(n=o[i.pos++]))<<17,n<128)return l(e,s,t);if(s|=(127&(n=o[i.pos++]))<<24,n<128)return l(e,s,t);if(s|=(1&(n=o[i.pos++]))<<31,n<128)return l(e,s,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,i){for(var s="",n=t;n<i;){var o,r,a,l=e[n],c=null,h=l>239?4:l>223?3:l>191?2:1;if(n+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===h?(o=e[n+1],r=e[n+2],128==(192&o)&&128==(192&r)&&((c=(15&l)<<12|(63&o)<<6|63&r)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(o=e[n+1],r=e[n+2],a=e[n+3],128==(192&o)&&128==(192&r)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&r)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,s+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),s+=String.fromCharCode(c),n+=h}return s}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var i=a(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===n.Varint)for(;this.buf[this.pos++]>127;);else if(t===n.Bytes)this.pos=this.readVarint()+this.pos;else if(t===n.Fixed32)this.pos+=4;else{if(t!==n.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),w(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),w(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),w(this.buf,-1&e,this.pos),w(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),w(this.buf,-1&e,this.pos),w(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,s;if(e>=0?(i=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,s=s+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(s,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var s,n,o=0;o<t.length;o++){if((s=t.charCodeAt(o))>55295&&s<57344){if(!n){s>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=s;continue}if(s<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=s;continue}s=n-55296<<10|s-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);s<128?e[i++]=s:(s<2048?e[i++]=s>>6|192:(s<65536?e[i++]=s>>12|224:(e[i++]=s>>18|240,e[i++]=s>>12&63|128),e[i++]=s>>6&63|128),e[i++]=63&s|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&c(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),s.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),s.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var s=this.pos-i;s>=128&&c(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,i){this.writeTag(e,n.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,h,t)},writePackedSVarint:function(e,t){this.writeMessage(e,d,t)},writePackedBoolean:function(e,t){this.writeMessage(e,m,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,p,t)},writePackedFixed32:function(e,t){this.writeMessage(e,g,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){this.writeMessage(e,v,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,y,t)},writeBytesField:function(e,t){this.writeTag(e,n.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,n.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,n.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,n.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},17141:(e,t,i)=>{var s;!function(n,o){var r={};function a(e){return function(){var t={method:e},i=Array.prototype.slice.call(arguments);/^get/.test(e)?(r.assert(i.length>0,"Get methods require a callback."),i.unshift(t)):(/^set/.test(e)&&(r.assert(0!==i.length,"Set methods require a value."),t.value=i[0]),i=[t]),this.send.apply(this,i)}}r.DEBUG=!1,r.VERSION="0.0.11",r.CONTEXT="player.js",r.POST_MESSAGE=!!n.postMessage,r.origin=function(e){return"//"===e.substr(0,2)&&(e=n.location.protocol+e),e.split("/").slice(0,3).join("/")},r.addEvent=function(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},r.log=function(){r.log.history=r.log.history||[],r.log.history.push(arguments),n.console&&r.DEBUG&&n.console.log(Array.prototype.slice.call(arguments))},r.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isNone=function(e){return null==e},r.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.indexOf=function(e,t){if(null==e)return-1;var i=0,s=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;i<s;i++)if(e[i]===t)return i;return-1},r.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},r.Keeper=function(){this.init()},r.Keeper.prototype.init=function(){this.data={}},r.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},r.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(r.isNone(t))return!0;for(var i=this.data[e],s=0;s<i.length;s++)if(i[s].id===t)return!0;return!1},r.Keeper.prototype.add=function(e,t,i,s,n){var o={id:e,event:t,cb:i,ctx:s,one:n};this.has(t)?this.data[t].push(o):this.data[t]=[o]},r.Keeper.prototype.execute=function(e,t,i,s){if(!this.has(e,t))return!1;for(var n=[],o=[],a=0;a<this.data[e].length;a++){var l=this.data[e][a];r.isNone(t)||!r.isNone(t)&&l.id===t?(o.push({cb:l.cb,ctx:l.ctx?l.ctx:s,data:i}),!1===l.one&&n.push(l)):n.push(l)}0===n.length?delete this.data[e]:this.data[e]=n;for(var c=0;c<o.length;c++){var h=o[c];h.cb.call(h.ctx,h.data)}},r.Keeper.prototype.on=function(e,t,i,s){this.add(e,t,i,s,!1)},r.Keeper.prototype.one=function(e,t,i,s){this.add(e,t,i,s,!0)},r.Keeper.prototype.off=function(e,t){var i=[];if(!this.data.hasOwnProperty(e))return i;for(var s=[],n=0;n<this.data[e].length;n++){var o=this.data[e][n];r.isNone(t)||o.cb===t?r.isNone(o.id)||i.push(o.id):s.push(o)}return 0===s.length?delete this.data[e]:this.data[e]=s,i},r.Player=function(e,t){if(!(this instanceof r.Player))return new r.Player(e,t);this.init(e,t)},r.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},r.EVENTS.all=function(){var e=[];for(var t in r.EVENTS)r.has(r.EVENTS,t)&&r.isString(r.EVENTS[t])&&e.push(r.EVENTS[t]);return e},r.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},r.METHODS.all=function(){var e=[];for(var t in r.METHODS)r.has(r.METHODS,t)&&r.isString(r.METHODS[t])&&e.push(r.METHODS[t]);return e},r.READIED=[],r.Player.prototype.init=function(e,t){var i=this;r.isString(e)&&(e=o.getElementById(e)),this.elem=e,r.assert("IFRAME"===e.nodeName,'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),r.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=r.origin(e.src),this.keeper=new r.Keeper,this.isReady=!1,this.queue=[],this.events=r.EVENTS.all(),this.methods=r.METHODS.all(),r.POST_MESSAGE?r.addEvent(n,"message",(function(e){i.receive(e)})):r.log("Post Message is not Available."),r.indexOf(r.READIED,e.src)>-1?i.loaded=!0:this.elem.onload=function(){i.loaded=!0}},r.Player.prototype.send=function(e,t,i){if(e.context=r.CONTEXT,e.version=r.VERSION,t){var s=this.keeper.getUUID();e.listener=s,this.keeper.one(s,e.method,t,i)}return this.isReady||"ready"===e.value?(r.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(r.log("Player.queue",e),this.queue.push(e),!1)},r.Player.prototype.receive=function(e){if(r.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==r.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},r.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var i=this.queue[t];r.log("Player.dequeue",i),"ready"===e.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},r.Player.prototype.on=function(e,t,i){var s=this.keeper.getUUID();return"ready"===e?this.keeper.one(s,e,t,i):this.keeper.on(s,e,t,i),this.send({method:"addEventListener",value:e,listener:s}),!0},r.Player.prototype.off=function(e,t){var i=this.keeper.off(e,t);if(r.log("Player.off",i),i.length>0)for(var s in i)return this.send({method:"removeEventListener",value:e,listener:i[s]}),!0;return!1},r.Player.prototype.supports=function(e,t){r.assert(r.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=r.isArray(t)?t:[t];for(var i="event"===e?this.events:this.methods,s=0;s<t.length;s++)if(-1===r.indexOf(i,t[s]))return!1;return!0};for(var l=0,c=r.METHODS.all().length;l<c;l++){var h=r.METHODS.all()[l];r.Player.prototype.hasOwnProperty(h)||(r.Player.prototype[h]=a(h))}r.addEvent(n,"message",(function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==r.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&r.READIED.push(t.value.src)})),r.Receiver=function(e,t){this.init(e,t)},r.Receiver.prototype.init=function(e,t){var i=this;this.isReady=!1,this.origin=r.origin(o.referrer),this.methods={},this.supported={events:e||r.EVENTS.all(),methods:t||r.METHODS.all()},this.eventListeners={},this.reject=!(n.self!==n.top&&r.POST_MESSAGE),this.reject||r.addEvent(n,"message",(function(e){i.receive(e)}))},r.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t={};if(r.isObject(e.data))t=e.data;else try{t=n.JSON.parse(e.data)}catch(e){r.log("JSON Parse Error",e)}if(r.log("Receiver.receive",e,t),!t.method)return!1;if(t.context!==r.CONTEXT)return!1;if(-1===r.indexOf(r.METHODS.all(),t.method))return this.emit("error",{code:2,msg:'Invalid Method "'+t.method+'"'}),!1;var i=r.isNone(t.listener)?null:t.listener;if("addEventListener"===t.method)this.eventListeners.hasOwnProperty(t.value)?-1===r.indexOf(this.eventListeners[t.value],i)&&this.eventListeners[t.value].push(i):this.eventListeners[t.value]=[i],"ready"===t.value&&this.isReady&&this.ready();else if("removeEventListener"===t.method){if(this.eventListeners.hasOwnProperty(t.value)){var s=r.indexOf(this.eventListeners[t.value],i);s>-1&&this.eventListeners[t.value].splice(s,1),0===this.eventListeners[t.value].length&&delete this.eventListeners[t.value]}}else this.get(t.method,t.value,i)},r.Receiver.prototype.get=function(e,t,i){var s=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var n=this.methods[e];"get"===e.substr(0,3)?n.call(this,(function(t){s.send(e,t,i)})):n.call(this,t)},r.Receiver.prototype.on=function(e,t){this.methods[e]=t},r.Receiver.prototype.send=function(e,t,i){if(r.log("Receiver.send",e,t,i),this.reject)return r.log("Receiver.send.reject",e,t,i),!1;var s={context:r.CONTEXT,version:r.VERSION,event:e};r.isNone(t)||(s.value=t),r.isNone(i)||(s.listener=i);var o=JSON.stringify(s);n.parent.postMessage(o,""===this.origin?"*":this.origin)},r.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;r.log("Instance.emit",e,t,this.eventListeners[e]);for(var i=0;i<this.eventListeners[e].length;i++){var s=this.eventListeners[e][i];this.send(e,t,s)}return!0},r.Receiver.prototype.ready=function(){r.log("Receiver.ready"),this.isReady=!0;var e={src:n.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},r.HTML5Adapter=function(e){if(!(this instanceof r.HTML5Adapter))return new r.HTML5Adapter(e);this.init(e)},r.HTML5Adapter.prototype.init=function(e){r.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new r.Receiver;e.addEventListener("playing",(function(){t.emit("play")})),e.addEventListener("pause",(function(){t.emit("pause")})),e.addEventListener("ended",(function(){t.emit("ended")})),e.addEventListener("timeupdate",(function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})})),e.addEventListener("progress",(function(){t.emit("buffered",{percent:e.buffered.length})})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(100*e.volume)})),t.on("setVolume",(function(t){e.volume=t/100})),t.on("mute",(function(){e.muted=!0})),t.on("unmute",(function(){e.muted=!1})),t.on("getMuted",(function(t){t(e.muted)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},r.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},r.JWPlayerAdapter=function(e){if(!(this instanceof r.JWPlayerAdapter))return new r.JWPlayerAdapter(e);this.init(e)},r.JWPlayerAdapter.prototype.init=function(e){r.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new r.Receiver;this.looped=!1,e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("time",(function(e){var i=e.position,s=e.duration;if(!i||!s)return!1;var n={seconds:i,duration:s};t.emit("timeupdate",n)}));var i=this;e.on("complete",(function(){!0===i.looped?e.seek(0):t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play(!0)})),t.on("pause",(function(){e.pause(!0)})),t.on("getPaused",(function(t){t(e.getState().toLowerCase()!=="PLAYING".toLowerCase())})),t.on("getCurrentTime",(function(t){t(e.getPosition())})),t.on("setCurrentTime",(function(t){e.seek(t)})),t.on("getDuration",(function(t){t(e.getDuration())})),t.on("getVolume",(function(t){t(e.getVolume())})),t.on("setVolume",(function(t){e.setVolume(t)})),t.on("mute",(function(){e.setMute(!0)})),t.on("unmute",(function(){e.setMute(!1)})),t.on("getMuted",(function(t){t(!0===e.getMute())})),t.on("getLoop",(function(e){e(this.looped)}),this),t.on("setLoop",(function(e){this.looped=e}),this)},r.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},r.MockAdapter=function(){if(!(this instanceof r.MockAdapter))return new r.MockAdapter;this.init()},r.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval((function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})}),250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new r.Receiver;t.on("play",(function(){var t=this;e.play(),this.emit("play"),e.timeupdate=function(e){t.emit("timeupdate",e)}})),t.on("pause",(function(){e.pause(),this.emit("pause")})),t.on("getPaused",(function(t){t(!e.playing)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(e.volume)})),t.on("setVolume",(function(t){e.volume=t})),t.on("mute",(function(){e.mute=!0})),t.on("unmute",(function(){e.mute=!1})),t.on("getMuted",(function(t){t(e.mute)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},r.MockAdapter.prototype.ready=function(){this.receiver.ready()},r.VideoJSAdapter=function(e){if(!(this instanceof r.VideoJSAdapter))return new r.VideoJSAdapter(e);this.init(e)},r.VideoJSAdapter.prototype.init=function(e){r.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new r.Receiver;e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("timeupdate",(function(i){var s=e.currentTime(),n=e.duration();if(!s||!n)return!1;var o={seconds:s,duration:n};t.emit("timeupdate",o)})),e.on("ended",(function(){t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused())})),t.on("getCurrentTime",(function(t){t(e.currentTime())})),t.on("setCurrentTime",(function(t){e.currentTime(t)})),t.on("getDuration",(function(t){t(e.duration())})),t.on("getVolume",(function(t){t(100*e.volume())})),t.on("setVolume",(function(t){e.volume(t/100)})),t.on("mute",(function(){e.volume(0)})),t.on("unmute",(function(){e.volume(1)})),t.on("getMuted",(function(t){t(0===e.volume())})),t.on("getLoop",(function(t){t(e.loop())})),t.on("setLoop",(function(t){e.loop(t)}))},r.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},void 0===(s=function(){return r}.call(t,i,t,e))||(e.exports=s)}(window,document)},49613:(e,t,i)=>{"use strict";var s=i(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MaterialComponent=void 0;var n=s(i(34575)),o=s(i(93913)),r=s(i(78585)),a=s(i(29754)),l=s(i(2205)),c=s(i(50008)),h=i(30888),d=i(47056),u=i(26605),p=["disabled"],m=function(e){function t(){return(0,n.default)(this,t),(0,r.default)(this,(0,a.default)(t).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"render",value:function(e){this.classText||(this.classText=this.buildClassName(e));var t=e,i=t.className||t.class||"";t.class&&delete t.class,t.className&&delete t.className;var s=this.materialDom(t),n="attributes";return"props"in s?(n="props",s.props=s.props||{}):s.attributes=s.attributes||{},s[n].className="".concat(i," ").concat(this.getClassName(s)).split(" ").filter((function(e,t,i){return i.indexOf(e)===t&&""!==e})).join(" "),this.mdcProps.forEach((function(e){e in p||delete s[n][e]})),s}},{key:"componentDidMount",value:function(){this.props.ripple&&this.control&&(this.ripple=new h.MDCRipple(this.control))}},{key:"componentWillReceiveProps",value:function(e){if(this.MDComponent&&this.mdcNotifyProps){var t=!0,i=!1,s=void 0;try{for(var n,o=this.mdcNotifyProps[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;this.props[r]!==e[r]&&(this.MDComponent[r]=e[r])}}catch(e){i=!0,s=e}finally{try{t||null==o.return||o.return()}finally{if(i)throw s}}}var a=!0,l=!1,c=void 0;try{for(var h,d=this.mdcProps[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){var u=h.value;if(this.props[u]!==e[u]){this.classText=this.buildClassName(e);break}}}catch(e){l=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(l)throw c}}}},{key:"componentWillUnmount",value:function(){this.ripple&&this.ripple.destroy()}},{key:"afterComponentDidMount",value:function(){if(this.MDComponent&&this.mdcNotifyProps){var e=!0,t=!1,i=void 0;try{for(var s,n=this.mdcNotifyProps[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var o=s.value;this.MDComponent[o]=this.props[o]}}catch(e){t=!0,i=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw i}}}}},{key:"setControlRef",value:function(e){this.control=e}},{key:"buildClassName",value:function(e){var t="mdc-"+this.componentName;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];"boolean"==typeof s&&s&&-1!==this.mdcProps.indexOf(i)&&(t+=" mdc-".concat(this.componentName,"--").concat(i))}return t}},{key:"getClassName",value:function(e){if(!e)return"";var t="attributes";"props"in e?(t="props",e.props=e.props||{}):e.attributes=e.attributes||{};var i=e[t]=e[t]||{},s=this.classText;return i.class&&(s+=" "+i.class),i.className&&i.className!==i.class&&(s+=" "+i.className),s}}]),t}(u.Component);t.MaterialComponent=m,function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"===("undefined"==typeof Reflect?"undefined":(0,c.default)(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);o>3&&r&&Object.defineProperty(t,i,r)}([d.bind],m.prototype,"setControlRef",null);var g=m;t.default=g},28276:(e,t,i)=>{"use strict";var s=i(95318);t.ZP=void 0;var n=s(i(34575)),o=s(i(93913)),r=s(i(78585)),a=s(i(29754)),l=s(i(16525)),c=s(i(2205)),h=s(i(50008)),d=i(69826),u=i(47056),p=i(26605),m=s(i(49613)),g=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"===("undefined"==typeof Reflect?"undefined":(0,h.default)(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},f=function(e){function t(){var e;return(0,n.default)(this,t),(e=(0,r.default)(this,(0,a.default)(t).apply(this,arguments))).componentName="slider",e.mdcProps=["discrete"],e}return(0,c.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentDidMount",this).call(this),this.control&&(this.MDComponent=new d.MDCSlider(this.control),this.MDComponent.listen("MDCSlider:change",this.onChange),this.MDComponent.listen("MDCSlider:input",this.onInput)),this.setValue(this.props.value)}},{key:"componentWillUnmount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentWillUnmount",this).call(this),this.MDComponent&&(this.MDComponent.unlisten("MDCSlider:change",this.onChange),this.MDComponent.unlisten("MDCSlider:input",this.onInput),this.MDComponent.destroy())}},{key:"getValue",value:function(){if(this.MDComponent)return this.MDComponent.value}},{key:"setValue",value:function(e){var t=this.props,i=t.disabled,s=void 0!==i&&i,n=t.min,o=void 0===n?0:n,r=t.max,a=void 0===r?100:r,l=t.step;this.MDComponent&&(o>this.MDComponent.max?(this.MDComponent.max=a,this.MDComponent.min=o):(this.MDComponent.min=o,this.MDComponent.max=a),e&&(this.MDComponent.value=e),this.MDComponent.disabled=s,l&&(this.MDComponent.step=l))}},{key:"onChange",value:function(e){this.props.onChange&&this.props.onChange(e)}},{key:"onInput",value:function(e){this.props.onInput&&this.props.onInput(e)}},{key:"materialDom",value:function(e){var t=e.tabindex,i=void 0===t?0:t,s=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(e,["tabindex"]);return this.setValue(e),(0,p.h)("div",Object.assign({tabIndex:i,role:"slider","aria-label":"Select Value",ref:this.setControlRef},s),(0,p.h)("div",{class:"mdc-slider__track-container"},(0,p.h)("div",{class:"mdc-slider__track"})),(0,p.h)("div",{class:"mdc-slider__thumb-container"},s.discrete&&(0,p.h)("div",{class:"mdc-slider__pin"},(0,p.h)("span",{class:"mdc-slider__pin-value-marker"})),(0,p.h)("svg",{class:"mdc-slider__thumb",width:"21",height:"21"},(0,p.h)("circle",{cx:"10.5",cy:"10.5",r:"7.875"})),(0,p.h)("div",{class:"mdc-slider__focus-ring"})))}}]),t}(m.default);g([u.bind],f.prototype,"onChange",null),g([u.bind],f.prototype,"onInput",null);var v=f;t.ZP=v},26605:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>H,h:()=>a,createElement:()=>a,cloneElement:()=>d,createRef:()=>U,Component:()=>F,render:()=>B,rerender:()=>g,options:()=>n});var s=function(){},n={},o=[],r=[];function a(e,t){var i,a,l,c,h=r;for(c=arguments.length;c-- >2;)o.push(arguments[c]);for(t&&null!=t.children&&(o.length||o.push(t.children),delete t.children);o.length;)if((a=o.pop())&&void 0!==a.pop)for(c=a.length;c--;)o.push(a[c]);else"boolean"==typeof a&&(a=null),(l="function"!=typeof e)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(l=!1)),l&&i?h[h.length-1]+=a:h===r?h=[a]:h.push(a),i=l;var d=new s;return d.nodeName=e,d.children=h,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==n.vnode&&n.vnode(d),d}function l(e,t){for(var i in t)e[i]=t[i];return e}function c(e,t){e&&("function"==typeof e?e(t):e.current=t)}var h="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function d(e,t){return a(e.nodeName,l(l({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var u=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function m(e){!e._dirty&&(e._dirty=!0)&&1==p.push(e)&&(n.debounceRendering||h)(g)}function g(){for(var e;e=p.pop();)e._dirty&&N(e)}function f(e,t,i){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&v(e,t.nodeName):i||e._componentConstructor===t.nodeName}function v(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function y(e){var t=l({},e.attributes);t.children=e.children;var i=e.nodeName.defaultProps;if(void 0!==i)for(var s in i)void 0===t[s]&&(t[s]=i[s]);return t}function b(e){var t=e.parentNode;t&&t.removeChild(e)}function w(e,t,i,s,n){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)c(i,null),c(s,e);else if("class"!==t||n)if("style"===t){if(s&&"string"!=typeof s&&"string"!=typeof i||(e.style.cssText=s||""),s&&"object"==typeof s){if("string"!=typeof i)for(var o in i)o in s||(e.style[o]="");for(var o in s)e.style[o]="number"==typeof s[o]&&!1===u.test(o)?s[o]+"px":s[o]}}else if("dangerouslySetInnerHTML"===t)s&&(e.innerHTML=s.__html||"");else if("o"==t[0]&&"n"==t[1]){var r=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),s?i||e.addEventListener(t,S,r):e.removeEventListener(t,S,r),(e._listeners||(e._listeners={}))[t]=s}else if("list"!==t&&"type"!==t&&!n&&t in e){try{e[t]=null==s?"":s}catch(e){}null!=s&&!1!==s||"spellcheck"==t||e.removeAttribute(t)}else{var a=n&&t!==(t=t.replace(/^xlink:?/,""));null==s||!1===s?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof s&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),s):e.setAttribute(t,s))}else e.className=s||""}function S(e){return this._listeners[e.type](n.event&&n.event(e)||e)}var T=[],E=0,_=!1,x=!1;function M(){for(var e;e=T.shift();)n.afterMount&&n.afterMount(e),e.componentDidMount&&e.componentDidMount()}function P(e,t,i,s,n,o){E++||(_=null!=n&&void 0!==n.ownerSVGElement,x=null!=e&&!("__preactattr_"in e));var r=A(e,t,i,s,o);return n&&r.parentNode!==n&&n.appendChild(r),--E||(x=!1,o||M()),r}function A(e,t,i,s,n){var o=e,r=_;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||n)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),O(e,!0))),o.__preactattr_=!0,o;var a,l,c=t.nodeName;if("function"==typeof c)return function(e,t,i,s){for(var n=e&&e._component,o=n,r=e,a=n&&e._componentConstructor===t.nodeName,l=a,c=y(t);n&&!l&&(n=n._parentComponent);)l=n.constructor===t.nodeName;return n&&l&&(!s||n._component)?(L(n,c,3,i,s),e=n.base):(o&&!a&&(k(o),e=r=null),n=C(t.nodeName,c,i),e&&!n.nextBase&&(n.nextBase=e,r=null),L(n,c,1,i,s),e=n.base,r&&e!==r&&(r._component=null,O(r,!1))),e}(e,t,i,s);if(_="svg"===c||"foreignObject"!==c&&_,c=String(c),(!e||!v(e,c))&&(a=c,(l=_?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,o=l,e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),O(e,!0)}var h=o.firstChild,d=o.__preactattr_,u=t.children;if(null==d){d=o.__preactattr_={};for(var p=o.attributes,m=p.length;m--;)d[p[m].name]=p[m].value}return!x&&u&&1===u.length&&"string"==typeof u[0]&&null!=h&&void 0!==h.splitText&&null==h.nextSibling?h.nodeValue!=u[0]&&(h.nodeValue=u[0]):(u&&u.length||null!=h)&&function(e,t,i,s,n){var o,r,a,l,c,h=e.childNodes,d=[],u={},p=0,m=0,g=h.length,v=0,y=t?t.length:0;if(0!==g)for(var w=0;w<g;w++){var S=h[w],T=S.__preactattr_;null!=(E=y&&T?S._component?S._component.__key:T.key:null)?(p++,u[E]=S):(T||(void 0!==S.splitText?!n||S.nodeValue.trim():n))&&(d[v++]=S)}if(0!==y)for(w=0;w<y;w++){var E;if(c=null,null!=(E=(l=t[w]).key))p&&void 0!==u[E]&&(c=u[E],u[E]=void 0,p--);else if(m<v)for(o=m;o<v;o++)if(void 0!==d[o]&&f(r=d[o],l,n)){c=r,d[o]=void 0,o===v-1&&v--,o===m&&m++;break}c=A(c,l,i,s),a=h[w],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?b(a):e.insertBefore(c,a))}if(p)for(var w in u)void 0!==u[w]&&O(u[w],!1);for(;m<=v;)void 0!==(c=d[v--])&&O(c,!1)}(o,u,i,s,x||null!=d.dangerouslySetInnerHTML),function(e,t,i){var s;for(s in i)t&&null!=t[s]||null==i[s]||w(e,s,i[s],i[s]=void 0,_);for(s in t)"children"===s||"innerHTML"===s||s in i&&t[s]===("value"===s||"checked"===s?e[s]:i[s])||w(e,s,i[s],i[s]=t[s],_)}(o,t.attributes,d),_=r,o}function O(e,t){var i=e._component;i?k(i):(null!=e.__preactattr_&&c(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||b(e),D(e))}function D(e){for(e=e.lastChild;e;){var t=e.previousSibling;O(e,!0),e=t}}var I=[];function C(e,t,i){var s,n=I.length;for(e.prototype&&e.prototype.render?(s=new e(t,i),F.call(s,t,i)):((s=new F(t,i)).constructor=e,s.render=R);n--;)if(I[n].constructor===e)return s.nextBase=I[n].nextBase,I.splice(n,1),s;return s}function R(e,t,i){return this.constructor(e,i)}function L(e,t,i,s,o){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,s)),s&&s!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=s),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==i&&(1!==i&&!1===n.syncComponentUpdates&&e.base?m(e):N(e,1,o)),c(e.__ref,e))}function N(e,t,i,s){if(!e._disable){var o,r,a,c=e.props,h=e.state,d=e.context,u=e.prevProps||c,p=e.prevState||h,m=e.prevContext||d,g=e.base,f=e.nextBase,v=g||f,b=e._component,w=!1,S=m;if(e.constructor.getDerivedStateFromProps&&(h=l(l({},h),e.constructor.getDerivedStateFromProps(c,h)),e.state=h),g&&(e.props=u,e.state=p,e.context=m,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,h,d)?w=!0:e.componentWillUpdate&&e.componentWillUpdate(c,h,d),e.props=c,e.state=h,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!w){o=e.render(c,h,d),e.getChildContext&&(d=l(l({},d),e.getChildContext())),g&&e.getSnapshotBeforeUpdate&&(S=e.getSnapshotBeforeUpdate(u,p));var _,x,A=o&&o.nodeName;if("function"==typeof A){var D=y(o);(r=b)&&r.constructor===A&&D.key==r.__key?L(r,D,1,d,!1):(_=r,e._component=r=C(A,D,d),r.nextBase=r.nextBase||f,r._parentComponent=e,L(r,D,0,d,!1),N(r,1,i,!0)),x=r.base}else a=v,(_=b)&&(a=e._component=null),(v||1===t)&&(a&&(a._component=null),x=P(a,o,d,i||!g,v&&v.parentNode,!0));if(v&&x!==v&&r!==b){var I=v.parentNode;I&&x!==I&&(I.replaceChild(x,v),_||(v._component=null,O(v,!1)))}if(_&&k(_),e.base=x,x&&!s){for(var R=e,F=e;F=F._parentComponent;)(R=F).base=x;x._component=R,x._componentConstructor=R.constructor}}for(!g||i?T.push(e):w||(e.componentDidUpdate&&e.componentDidUpdate(u,p,S),n.afterUpdate&&n.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);E||s||M()}}function k(e){n.beforeUnmount&&n.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var i=e._component;i?k(i):t&&(null!=t.__preactattr_&&c(t.__preactattr_.ref,null),e.nextBase=t,b(t),I.push(e),D(t)),c(e.__ref,null)}function F(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function B(e,t,i){return P(i,e,{},!1,t,!1)}function U(){return{}}l(F.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=l(l({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),m(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),N(this,2)},render:function(){}});const H={h:a,createElement:a,cloneElement:d,createRef:U,Component:F,render:B,rerender:g,options:n}},77824:(e,t,i)=>{var s=i(2823),n=i(34515),o=i(48738),r=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(n(e)||o(e))||(t=e||{},e=null);for(var i="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,h=!1!==t.clockwise?r:a,d=h[0],u=h[1],p=h[2],m=6*l,g=e||new(s(i))(m),f=0,v=0;f<m;f+=6,v+=4){var y=f+c;g[y+0]=v+0,g[y+1]=v+1,g[y+2]=v+2,g[y+3]=v+d,g[y+4]=v+u,g[y+5]=v+p}return g}},62587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,s,n){i=i||"&",s=s||"=";var o={};if("string"!=typeof e||0===e.length)return o;var r=/\+/g;e=e.split(i);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var h,d,u,p,m=e[c].replace(r,"%20"),g=m.indexOf(s);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),u=decodeURIComponent(h),p=decodeURIComponent(d),t(o,u)?Array.isArray(o[u])?o[u].push(p):o[u]=[o[u],p]:o[u]=p}return o}},12361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,s,n){return i=i||"&",s=s||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var o=encodeURIComponent(t(n))+s;return Array.isArray(e[n])?e[n].map((function(e){return o+encodeURIComponent(t(e))})).join(i):o+encodeURIComponent(t(e[n]))})).join(i):n?encodeURIComponent(t(n))+s+encodeURIComponent(t(e)):""}},17673:(e,t,i)=>{"use strict";t.decode=t.parse=i(62587),t.encode=t.stringify=i(12361)},82582:function(e){e.exports=function(){"use strict";function e(e,s,n,o,r){!function e(i,s,n,o,r){for(;o>n;){if(o-n>600){var a=o-n+1,l=s-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,s,Math.max(n,Math.floor(s-l*h/a+d)),Math.min(o,Math.floor(s+(a-l)*h/a+d)),r)}var u=i[s],p=n,m=o;for(t(i,n,s),r(i[o],u)>0&&t(i,n,o);p<m;){for(t(i,p,m),p++,m--;r(i[p],u)<0;)p++;for(;r(i[m],u)>0;)m--}0===r(i[n],u)?t(i,n,m):t(i,++m,o),m<=s&&(n=m+1),s<=m&&(o=m-1)}}(e,s,n||0,o||e.length-1,r||i)}function t(e,t,i){var s=e[t];e[t]=e[i],e[i]=s}function i(e,t){return e<t?-1:e>t?1:0}var s=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,t,i){if(!i)return t.indexOf(e);for(var s=0;s<t.length;s++)if(i(e,t[s]))return s;return-1}function o(e,t){r(e,0,e.children.length,t,e)}function r(e,t,i,s,n){n||(n=m(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o=t;o<i;o++){var r=e.children[o];a(n,e.leaf?s(r):r)}return n}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,i,s,n,o){for(var r=[i,s];r.length;)if(!((s=r.pop())-(i=r.pop())<=n)){var a=i+Math.ceil((s-i)/n/2)*n;e(t,a,i,s,o),r.push(i,a,a,s)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var s=this.toBBox,n=[];t;){for(var o=0;o<t.children.length;o++){var r=t.children[o],a=t.leaf?s(r):r;p(e,a)&&(t.leaf?i.push(r):u(e,a)?this._all(r,i):n.push(r))}t=n.pop()}return i},s.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var i=[];t;){for(var s=0;s<t.children.length;s++){var n=t.children[s],o=t.leaf?this.toBBox(n):n;if(p(e,o)){if(t.leaf||u(e,o))return!0;i.push(n)}}t=i.pop()}return!1},s.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},s.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},s.prototype.clear=function(){return this.data=m([]),this},s.prototype.remove=function(e,t){if(!e)return this;for(var i,s,o,r=this.data,a=this.toBBox(e),l=[],c=[];r||l.length;){if(r||(r=l.pop(),s=l[l.length-1],i=c.pop(),o=!0),r.leaf){var h=n(e,r.children,t);if(-1!==h)return r.children.splice(h,1),l.push(r),this._condense(l),this}o||r.leaf||!u(r,a)?s?(i++,r=s.children[i],o=!1):r=null:(l.push(r),c.push(i),i=0,s=r,r=r.children[0])}return this},s.prototype.toBBox=function(e){return e},s.prototype.compareMinX=function(e,t){return e.minX-t.minX},s.prototype.compareMinY=function(e,t){return e.minY-t.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(e){return this.data=e,this},s.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},s.prototype._build=function(e,t,i,s){var n,r=i-t+1,a=this._maxEntries;if(r<=a)return o(n=m(e.slice(t,i+1)),this.toBBox),n;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),(n=m([])).leaf=!1,n.height=s;var l=Math.ceil(r/a),c=l*Math.ceil(Math.sqrt(a));g(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);g(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var p=Math.min(u+l-1,d);n.children.push(this._build(e,u,p,s-1))}}return o(n,this.toBBox),n},s.prototype._chooseSubtree=function(e,t,i,s){for(;s.push(t),!t.leaf&&s.length-1!==i;){for(var n=1/0,o=1/0,r=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,p=l,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-c);d<o?(o=d,n=c<n?c:n,r=l):d===o&&c<n&&(n=c,r=l)}t=r||t.children[0]}var u,p;return t},s.prototype._insert=function(e,t,i){var s=i?e:this.toBBox(e),n=[],o=this._chooseSubtree(s,this.data,t,n);for(o.children.push(e),a(o,s);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(s,n,t)},s.prototype._split=function(e,t){var i=e[t],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);var r=this._chooseSplitIndex(i,n,s),a=m(i.children.splice(r,i.children.length-r));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},s.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(e,t,i){for(var s,n,o,a,l,c,d,u=1/0,p=1/0,m=t;m<=i-t;m++){var g=r(e,0,m,this.toBBox),f=r(e,m,i,this.toBBox),v=(n=g,o=f,void 0,void 0,void 0,void 0,a=Math.max(n.minX,o.minX),l=Math.max(n.minY,o.minY),c=Math.min(n.maxX,o.maxX),d=Math.min(n.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,d-l)),y=h(g)+h(f);v<u?(u=v,s=m,p=y<p?y:p):v===u&&y<p&&(p=y,s=m)}return s||i-t},s.prototype._chooseSplitAxis=function(e,t,i){var s=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,s)<this._allDistMargin(e,t,i,n)&&e.children.sort(s)},s.prototype._allDistMargin=function(e,t,i,s){e.children.sort(s);for(var n=this.toBBox,o=r(e,0,t,n),l=r(e,i-t,i,n),c=d(o)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(o,e.leaf?n(u):u),c+=d(o)}for(var p=i-t-1;p>=t;p--){var m=e.children[p];a(l,e.leaf?n(m):m),c+=d(l)}return c},s.prototype._adjustParentBBoxes=function(e,t,i){for(var s=i;s>=0;s--)a(t[s],e)},s.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},s}()},91033:(e,t,i)=>{"use strict";i.d(t,{Z:()=>E});var s=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,s){return e[0]===t&&(i=s,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),s=this.__entries__[i];return s&&s[1]},t.prototype.set=function(t,i){var s=e(this.__entries__,t);~s?this.__entries__[s][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,s=e(i,t);~s&&i.splice(s,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,s=this.__entries__;i<s.length;i++){var n=s[i];e.call(t,n[1],n[0])}},t}()}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==i.g&&i.g.Math===Math?i.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),r="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)},a=["top","right","bottom","left","width","height","size","weight"],l="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,s=!1,n=0;function o(){i&&(i=!1,e()),s&&l()}function a(){r(o)}function l(){var e=Date.now();if(i){if(e-n<2)return;s=!0}else i=!0,s=!1,setTimeout(a,20);n=e}return l}(this.refresh.bind(this))}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),l?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;a.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),h=function(e,t){for(var i=0,s=Object.keys(t);i<s.length;i++){var n=s[i];Object.defineProperty(e,n,{value:t[n],enumerable:!1,writable:!1,configurable:!0})}return e},d=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||o},u=v(0,0,0,0);function p(e){return parseFloat(e)||0}function m(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+p(e["border-"+i+"-width"])}),0)}var g="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof d(e).SVGGraphicsElement}:function(e){return e instanceof d(e).SVGElement&&"function"==typeof e.getBBox};function f(e){return n?g(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):function(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return u;var s=d(e).getComputedStyle(e),n=function(e){for(var t={},i=0,s=["top","right","bottom","left"];i<s.length;i++){var n=s[i],o=e["padding-"+n];t[n]=p(o)}return t}(s),o=n.left+n.right,r=n.top+n.bottom,a=p(s.width),l=p(s.height);if("border-box"===s.boxSizing&&(Math.round(a+o)!==t&&(a-=m(s,"left","right")+o),Math.round(l+r)!==i&&(l-=m(s,"top","bottom")+r)),!function(e){return e===d(e).document.documentElement}(e)){var c=Math.round(a+o)-t,h=Math.round(l+r)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(h)&&(l-=h)}return v(n.left,n.top,a,l)}(e):u}function v(e,t,i,s){return{x:e,y:t,width:i,height:s}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=f(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),b=function(e,t){var i,s,n,o,r,a,l,c=(s=(i=t).x,n=i.y,o=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),h(l,{x:s,y:n,width:o,height:r,top:n,right:s+o,bottom:r+n,left:s}),l);h(this,{target:e,contentRect:c})},w=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new s,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new b(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),S="undefined"!=typeof WeakMap?new WeakMap:new s,T=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=c.getInstance(),s=new w(t,i,this);S.set(this,s)};["observe","unobserve","disconnect"].forEach((function(e){T.prototype[e]=function(){var t;return(t=S.get(this))[e].apply(t,arguments)}}));const E=void 0!==o.ResizeObserver?o.ResizeObserver:T},5277:(e,t,i)=>{var s,n,o;o=function(){var e,t,i=document,s=i.getElementsByTagName("head")[0],n={},o={},r={},a={};function l(e,t){for(var i=0,s=e.length;i<s;++i)if(!t(e[i]))return!1;return 1}function c(e,t){l(e,(function(e){return t(e),1}))}function h(t,i,s){t=t.push?t:[t];var u=i&&i.call,p=u?i:s,m=u?t.join(""):i,g=t.length;function f(e){return e.call?e():n[e]}function v(){if(!--g)for(var e in n[m]=1,p&&p(),r)l(e.split("|"),f)&&!c(r[e],f)&&(r[e]=[])}return setTimeout((function(){c(t,(function t(i,s){return null===i?v():(s||/^https?:\/\//.test(i)||!e||(i=-1===i.indexOf(".js")?e+i+".js":e+i),a[i]?(m&&(o[m]=1),2==a[i]?v():setTimeout((function(){t(i,!0)}),0)):(a[i]=1,m&&(o[m]=1),void d(i,v)))}))}),0),h}function d(e,n){var o,r=i.createElement("script");r.onload=r.onerror=r.onreadystatechange=function(){r.readyState&&!/^c|loade/.test(r.readyState)||o||(r.onload=r.onreadystatechange=null,o=1,a[e]=2,n())},r.async=1,r.src=t?e+(-1===e.indexOf("?")?"?":"&")+t:e,s.insertBefore(r,s.lastChild)}return h.get=d,h.order=function(e,t,i){!function s(n){n=e.shift(),e.length?h(n,s):h(n,t,i)}()},h.path=function(t){e=t},h.urlArgs=function(e){t=e},h.ready=function(e,t,i){e=e.push?e:[e];var s,o=[];return!c(e,(function(e){n[e]||o.push(e)}))&&l(e,(function(e){return n[e]}))?t():(s=e.join("|"),r[s]=r[s]||[],r[s].push(t),i&&i(o)),h},h.done=function(e){h([null],e)},h},e.exports?e.exports=o():void 0===(n="function"==typeof(s=o)?s.call(t,i,t,e):s)||(e.exports=n)},61040:(e,t,i)=>{"use strict";var s=i(13733),n=i(27308),o=i(21924)("String.prototype.replace"),r=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,a=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=n(s(this));return o(o(e,r,""),a,"")}},46057:(e,t,i)=>{"use strict";var s=i(55559),n=i(4289),o=i(61040),r=i(30254),a=i(60029),l=s(r());n(l,{getPolyfill:r,implementation:o,shim:a}),e.exports=l},30254:(e,t,i)=>{"use strict";var s=i(61040);e.exports=function(){return String.prototype.trim&&"​"==="​".trim()?String.prototype.trim:s}},60029:(e,t,i)=>{"use strict";var s=i(4289),n=i(30254);e.exports=function(){var e=n();return s(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},67121:(e,t,i)=>{"use strict";e=i.hmd(e),function(e){var t,i=e.Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t=i.for("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable"}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:e)},11385:(e,t,i)=>{var s=i(73134),n=i(35717),o=i(77824),r=i(82910),a=i(70162),l=THREE.BufferGeometry;function c(e){l.call(this),"string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}e.exports=function(e){return new c(e)},n(c,l),c.prototype.update=function(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=s(e);var t=!1!==e.flipY,i=e.font,n=i.common.scaleW,a=i.common.scaleH,l=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=l;var c=r.positions(l),h=r.uvs(l,n,a,t),d=o([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(d),this.setAttribute("position",new THREE.BufferAttribute(c,2)),this.setAttribute("uv",new THREE.BufferAttribute(h,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var u=r.pages(l);this.setAttribute("page",new THREE.BufferAttribute(u,1))}},c.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);a.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},c.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,t=this.attributes.position.array,i=this.attributes.position.itemSize;!t||!i||t.length<2?e.makeEmpty():a.computeBox(t,e)}},70162:e=>{var t={min:[0,0],max:[0,0]};function i(e){var i=e.length/2;t.min[0]=e[0],t.min[1]=e[1],t.max[0]=e[0],t.max[1]=e[1];for(var s=0;s<i;s++){var n=e[2*s+0],o=e[2*s+1];t.min[0]=Math.min(n,t.min[0]),t.min[1]=Math.min(o,t.min[1]),t.max[0]=Math.max(n,t.max[0]),t.max[1]=Math.max(o,t.max[1])}}e.exports.computeBox=function(e,s){i(e),s.min.set(t.min[0],t.min[1],0),s.max.set(t.max[0],t.max[1],0)},e.exports.computeSphere=function(e,s){i(e);var n=t.min[0],o=t.min[1],r=t.max[0]-n,a=t.max[1]-o,l=Math.sqrt(r*r+a*a);s.center.set(n+r/2,o+a/2,0),s.radius=l/2}},82910:e=>{e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach((function(e){var s=e.data.page||0;t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s})),t},e.exports.uvs=function(e,t,i,s){var n=new Float32Array(4*e.length*2),o=0;return e.forEach((function(e){var r=e.data,a=r.x+r.width,l=r.y+r.height,c=r.x/t,h=r.y/i,d=a/t,u=l/i;s&&(h=(i-r.y)/i,u=(i-l)/i),n[o++]=c,n[o++]=h,n[o++]=c,n[o++]=u,n[o++]=d,n[o++]=u,n[o++]=d,n[o++]=h})),n},e.exports.positions=function(e){var t=new Float32Array(4*e.length*2),i=0;return e.forEach((function(e){var s=e.data,n=e.position[0]+s.xoffset,o=e.position[1]+s.yoffset,r=s.width,a=s.height;t[i++]=n,t[i++]=o,t[i++]=n,t[i++]=o+a,t[i++]=n+r,t[i++]=o+a,t[i++]=n+r,t[i++]=o})),t}},2212:(e,t,i)=>{"use strict";i.d(t,{bGH:()=>l,OTo:()=>Y,cum:()=>Me,m7l:()=>ol,Xcj:()=>Cc,HkE:()=>Mo,tGC:()=>ih,_Li:()=>n,N$j:()=>lr,ZzF:()=>Ke,GQ:()=>Xc,nvb:()=>ls,DvJ:()=>jr,TlE:()=>bi,u9r:()=>Gi,T95:()=>B,V1s:()=>ps,Rki:()=>$c,ROQ:()=>Fr,YT8:()=>Ml,uWy:()=>x,SUY:()=>vc,Ilk:()=>ui,_am:()=>fs,BtG:()=>vs,m_w:()=>Wr,IEO:()=>bs,Ox3:()=>$l,ehD:()=>o,fSK:()=>b,Vdb:()=>S,dj0:()=>Ae,TOt:()=>$r,USm:()=>Pt,pBf:()=>De,G_f:()=>pi,hH6:()=>dl,a$l:()=>Ai,VzW:()=>z,Wl3:()=>s,iWj:()=>Ts,ZXM:()=>zr,OAl:()=>xe,ZAu:()=>Po,cLu:()=>j,QRU:()=>rc,lb7:()=>nc,L5s:()=>sc,$TI:()=>Lc,SPe:()=>fr,Kz5:()=>G,vpT:()=>Lo,kB5:()=>ko,_C8:()=>qa,Syv:()=>ue,NMF:()=>pe,pIN:()=>me,x5V:()=>Ee,x12:()=>Er,Zzh:()=>Vc,nls:()=>vr,blk:()=>Pr,ejS:()=>Mr,wem:()=>C,FDw:()=>k,lRj:()=>L,D1R:()=>N,qyh:()=>R,aNw:()=>cl,Zp0:()=>ic,jAl:()=>de,cRx:()=>J,Y8D:()=>X,F5T:()=>gi,M8C:()=>Re,yGw:()=>bt,Sm8:()=>u,Kj0:()=>os,vBJ:()=>fi,EJi:()=>Ba,Wid:()=>Fa,r_:()=>d,OoA:()=>M,TyD:()=>P,vZf:()=>I,HTd:()=>O,aH4:()=>D,YLQ:()=>A,jFi:()=>r,bdR:()=>a,dUE:()=>el,Tme:()=>jt,ghN:()=>m,Hy8:()=>w,Wpd:()=>T,LgZ:()=>y,iWC:()=>f,iKG:()=>Kl,cPb:()=>ms,JOQ:()=>Kt,BKK:()=>xs,_12:()=>Oa,cek:()=>ql,woe:()=>Rr,UY4:()=>Ar,iUV:()=>Dc,mXe:()=>Nl,_fP:()=>je,iLg:()=>il,wk1:()=>Q,CaW:()=>ce,eaV:()=>le,BFQ:()=>se,v3W:()=>ne,ILR:()=>oe,UCm:()=>$,fto:()=>he,vCx:()=>ae,_AM:()=>re,wuA:()=>ie,FIo:()=>ka,zHn:()=>yt,iMs:()=>kc,rpg:()=>_,ce8:()=>_e,rOj:()=>h,xsS:()=>Ro,jyz:()=>us,iAb:()=>U,OdW:()=>dr,TUv:()=>ar,aLr:()=>ht,Aip:()=>Ca,xo$:()=>Ra,PMe:()=>Wl,k74:()=>v,RlZ:()=>E,KhW:()=>g,Wbm:()=>c,IOt:()=>Te,xEZ:()=>Ue,dpR:()=>vl,CJI:()=>oi,z$h:()=>be,UlW:()=>ye,rBU:()=>Ps,rDY:()=>ds,ywz:()=>F,wJv:()=>K,JQ4:()=>V,k0A:()=>W,irR:()=>Z,XNv:()=>q,LsT:()=>H,FM8:()=>Le,Pa4:()=>We,Ltg:()=>Ge,yC1:()=>nl,b5g:()=>Co,oAp:()=>ys,dd2:()=>Ve,CP7:()=>Io,Uk6:()=>La,c8b:()=>p,knz:()=>Se});const s=0,n=1,o=2,r=0,a=1,l=100,c=101,h=102,d=103,u=104,p=200,m=201,g=202,f=203,v=204,y=205,b=206,w=207,S=208,T=209,E=210,_=1e3,x=1001,M=1002,P=1003,A=1004,O=1004,D=1005,I=1005,C=1006,R=1007,L=1007,N=1008,k=1008,F=1009,B=1010,U=1011,H=1012,G=1013,V=1014,z=1015,j=1016,W=1017,Z=1018,q=1019,K=1020,Y=1021,$=1022,Q=1023,X=1024,J=1025,ee=1026,te=1027,ie=33776,se=33777,ne=33778,oe=33779,re=35840,ae=35841,le=35842,ce=35843,he=36196,de=2200,ue=2300,pe=2301,me=2302,ge=2400,fe=2401,ve=2402,ye=1,be=2,we=3e3,Se=3001,Te=0,Ee=7680,_e=7681,xe=516,Me=519,Pe=35044,Ae=35048,Oe="300 es";function De(){}Object.assign(De.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,s=i.length;t<s;t++)i[t].call(this,e)}}});const Ie=[];for(let e=0;e<256;e++)Ie[e]=(e<16?"0":"")+e.toString(16);let Ce=1234567;const Re={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(Ie[255&e]+Ie[e>>8&255]+Ie[e>>16&255]+Ie[e>>24&255]+"-"+Ie[255&t]+Ie[t>>8&255]+"-"+Ie[t>>16&15|64]+Ie[t>>24&255]+"-"+Ie[63&i|128]+Ie[i>>8&255]+"-"+Ie[i>>16&255]+Ie[i>>24&255]+Ie[255&s]+Ie[s>>8&255]+Ie[s>>16&255]+Ie[s>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,s,n){return s+(e-t)*(n-s)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Ce=e%2147483647),Ce=16807*Ce%2147483647,(Ce-1)/2147483646},degToRad:function(e){return e*Re.DEG2RAD},radToDeg:function(e){return e*Re.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,s,n){const o=Math.cos,r=Math.sin,a=o(i/2),l=r(i/2),c=o((t+s)/2),h=r((t+s)/2),d=o((t-s)/2),u=r((t-s)/2),p=o((s-t)/2),m=r((s-t)/2);switch(n){case"XYX":e.set(a*h,l*d,l*u,a*c);break;case"YZY":e.set(l*u,a*h,l*d,a*c);break;case"ZXZ":e.set(l*d,l*u,a*h,a*c);break;case"XZX":e.set(a*h,l*m,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*m,a*c);break;case"ZYZ":e.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}};class Le{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*s+e.x,this.y=n*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Ne{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,n,o,r,a,l){const c=this.elements;return c[0]=e,c[1]=s,c[2]=r,c[3]=t,c[4]=n,c[5]=a,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,n=this.elements,o=i[0],r=i[3],a=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],m=s[0],g=s[3],f=s[6],v=s[1],y=s[4],b=s[7],w=s[2],S=s[5],T=s[8];return n[0]=o*m+r*v+a*w,n[3]=o*g+r*y+a*S,n[6]=o*f+r*b+a*T,n[1]=l*m+c*v+h*w,n[4]=l*g+c*y+h*S,n[7]=l*f+c*b+h*T,n[2]=d*m+u*v+p*w,n[5]=d*g+u*y+p*S,n[8]=d*f+u*b+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],n=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*r*l-i*n*c+i*r*a+s*n*l-s*o*a}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],n=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=c*o-r*l,d=r*a-c*n,u=l*n-o*a,p=t*h+i*d+s*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(s*l-c*i)*m,e[2]=(r*i-s*o)*m,e[3]=d*m,e[4]=(c*t-s*a)*m,e[5]=(s*n-r*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(o*t-i*n)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,n,o,r){const a=Math.cos(n),l=Math.sin(n);return this.set(i*a,i*l,-i*(a*o+l*r)+o+e,-s*l,s*a,-s*(-l*o+a*r)+r+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.elements,n=s[0],o=s[3],r=s[6],a=s[1],l=s[4],c=s[7];return s[0]=t*n+i*a,s[3]=t*o+i*l,s[6]=t*r+i*c,s[1]=-i*n+t*a,s[4]=-i*o+t*l,s[7]=-i*r+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}}let ke;const Fe={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ke&&(ke=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ke.width=e.width,ke.height=e.height;const i=ke.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=ke}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let Be=0;function Ue(e=Ue.DEFAULT_IMAGE,t=Ue.DEFAULT_MAPPING,i=x,s=x,n=C,o=N,r=Q,a=F,l=1,c=3e3){Object.defineProperty(this,"id",{value:Be++}),this.uuid=Re.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=s,this.magFilter=n,this.minFilter=o,this.anisotropy=l,this.format=r,this.internalFormat=null,this.type=a,this.offset=new Le(0,0),this.repeat=new Le(1,1),this.center=new Le(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ne,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}function He(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Fe.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ue.DEFAULT_IMAGE=void 0,Ue.DEFAULT_MAPPING=300,Ue.prototype=Object.assign(Object.create(De.prototype),{constructor:Ue,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const s=this.image;if(void 0===s.uuid&&(s.uuid=Re.generateUUID()),!t&&void 0===e.images[s.uuid]){let t;if(Array.isArray(s)){t=[];for(let e=0,i=s.length;e<i;e++)s[e].isDataTexture?t.push(He(s[e].image)):t.push(He(s[e]))}else t=He(s);e.images[s.uuid]={uuid:s.uuid,url:t}}i.image=s.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _:e.x=e.x-Math.floor(e.x);break;case x:e.x=e.x<0?0:1;break;case M:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case _:e.y=e.y-Math.floor(e.y);break;case x:e.y=e.y<0?0:1;break;case M:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Ue.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class Ge{constructor(e=0,t=0,i=0,s=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,n;const o=.01,r=.1,a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],m=a[2],g=a[6],f=a[10];if(Math.abs(c-d)<o&&Math.abs(h-m)<o&&Math.abs(p-g)<o){if(Math.abs(c+d)<r&&Math.abs(h+m)<r&&Math.abs(p+g)<r&&Math.abs(l+u+f-3)<r)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(u+1)/2,v=(f+1)/2,y=(c+d)/4,b=(h+m)/4,w=(p+g)/4;return e>a&&e>v?e<o?(i=0,s=.707106781,n=.707106781):(i=Math.sqrt(e),s=y/i,n=b/i):a>v?a<o?(i=.707106781,s=0,n=.707106781):(s=Math.sqrt(a),i=y/s,n=w/s):v<o?(i=.707106781,s=.707106781,n=0):(n=Math.sqrt(v),i=b/n,s=w/n),this.set(i,s,n,t),this}let v=Math.sqrt((g-p)*(g-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(h-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function Ve(e,t,i){this.width=e,this.height=t,this.scissor=new Ge(0,0,e,t),this.scissorTest=!1,this.viewport=new Ge(0,0,e,t),i=i||{},this.texture=new Ue(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:C,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function ze(e,t,i){Ve.call(this,e,t,i),this.samples=4}Ve.prototype=Object.assign(Object.create(De.prototype),{constructor:Ve,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ze.prototype=Object.assign(Object.create(Ve.prototype),{constructor:ze,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Ve.prototype.copy.call(this,e),this.samples=e.samples,this}});class je{constructor(e=0,t=0,i=0,s=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=s}static slerp(e,t,i,s){return i.copy(e).slerp(t,s)}static slerpFlat(e,t,i,s,n,o,r){let a=i[s+0],l=i[s+1],c=i[s+2],h=i[s+3];const d=n[o+0],u=n[o+1],p=n[o+2],m=n[o+3];if(h!==m||a!==d||l!==u||c!==p){let e=1-r;const t=a*d+l*u+c*p+h*m,i=t>=0?1:-1,s=1-t*t;if(s>Number.EPSILON){const n=Math.sqrt(s),o=Math.atan2(n,t*i);e=Math.sin(e*o)/n,r=Math.sin(r*o)/n}const n=r*i;if(a=a*e+d*n,l=l*e+u*n,c=c*e+p*n,h=h*e+m*n,e===1-r){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,s,n,o){const r=i[s],a=i[s+1],l=i[s+2],c=i[s+3],h=n[o],d=n[o+1],u=n[o+2],p=n[o+3];return e[t]=r*p+c*h+a*u-l*d,e[t+1]=a*p+c*d+l*h-r*u,e[t+2]=l*p+c*u+r*d-a*h,e[t+3]=c*p-r*h-a*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,s=e._y,n=e._z,o=e._order,r=Math.cos,a=Math.sin,l=r(i/2),c=r(s/2),h=r(n/2),d=a(i/2),u=a(s/2),p=a(n/2);switch(o){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],n=t[8],o=t[1],r=t[5],a=t[9],l=t[2],c=t[6],h=t[10],d=i+r+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(n-l)*e,this._z=(o-s)*e}else if(i>r&&i>h){const e=2*Math.sqrt(1+i-r-h);this._w=(c-a)/e,this._x=.25*e,this._y=(s+o)/e,this._z=(n+l)/e}else if(r>h){const e=2*Math.sqrt(1+r-i-h);this._w=(n-l)/e,this._x=(s+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-r);this._w=(o-s)/e,this._x=(n+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Re.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,n=e._z,o=e._w,r=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+o*r+s*l-n*a,this._y=s*c+o*a+n*r-i*l,this._z=n*c+o*l+i*a-s*r,this._w=o*c-i*r-s*a-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,s=this._y,n=this._z,o=this._w;let r=o*e._w+i*e._x+s*e._y+n*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=o,this._x=i,this._y=s,this._z=n,this;const a=1-r*r;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*s+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,r),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=s*h+this._y*d,this._z=n*h+this._z*d,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class We{constructor(e=0,t=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*s,this.y=n[1]*t+n[4]*i+n[7]*s,this.z=n[2]*t+n[5]*i+n[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*s+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*s+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*s+n[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,n=e.x,o=e.y,r=e.z,a=e.w,l=a*t+o*s-r*i,c=a*i+r*t-n*s,h=a*s+n*i-o*t,d=-n*t-o*i-r*s;return this.x=l*a+d*-n+c*-r-h*-o,this.y=c*a+d*-o+h*-n-l*-r,this.z=h*a+d*-r+l*-o-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*s,this.y=n[1]*t+n[5]*i+n[9]*s,this.z=n[2]*t+n[6]*i+n[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,n=e.z,o=t.x,r=t.y,a=t.z;return this.x=s*a-n*r,this.y=n*o-i*a,this.z=i*r-s*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Ze.copy(this).projectOnVector(e),this.sub(Ze)}reflect(e){return this.sub(Ze.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Re.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Ze=new We,qe=new je;class Ke{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new We(1/0,1/0,1/0),this.max=void 0!==t?t:new We(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,s=1/0,n=-1/0,o=-1/0,r=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<i&&(i=c),h<s&&(s=h),l>n&&(n=l),c>o&&(o=c),h>r&&(r=h)}return this.min.set(t,i,s),this.max.set(n,o,r),this}setFromBufferAttribute(e){let t=1/0,i=1/0,s=1/0,n=-1/0,o=-1/0,r=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<i&&(i=c),h<s&&(s=h),l>n&&(n=l),c>o&&(o=c),h>r&&(r=h)}return this.min.set(t,i,s),this.max.set(n,o,r),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Qe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new We),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new We),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Xe.copy(t.boundingBox),Xe.applyMatrix4(e.matrixWorld),this.union(Xe));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new We),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Qe),Qe.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ot),rt.subVectors(this.max,ot),Je.subVectors(e.a,ot),et.subVectors(e.b,ot),tt.subVectors(e.c,ot),it.subVectors(et,Je),st.subVectors(tt,et),nt.subVectors(Je,tt);let t=[0,-it.z,it.y,0,-st.z,st.y,0,-nt.z,nt.y,it.z,0,-it.x,st.z,0,-st.x,nt.z,0,-nt.x,-it.y,it.x,0,-st.y,st.x,0,-nt.y,nt.x,0];return!!Ye(t,Je,et,tt,rt)&&(t=[1,0,0,0,1,0,0,0,1],!!Ye(t,Je,et,tt,rt)&&(at.crossVectors(it,st),t=[at.x,at.y,at.z],Ye(t,Je,et,tt,rt)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new We),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Qe.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Qe).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||($e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),$e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),$e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),$e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),$e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),$e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),$e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),$e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints($e)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function Ye(e,t,i,s,n){for(let o=0,r=e.length-3;o<=r;o+=3){lt.fromArray(e,o);const r=n.x*Math.abs(lt.x)+n.y*Math.abs(lt.y)+n.z*Math.abs(lt.z),a=t.dot(lt),l=i.dot(lt),c=s.dot(lt);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>r)return!1}return!0}const $e=[new We,new We,new We,new We,new We,new We,new We,new We],Qe=new We,Xe=new Ke,Je=new We,et=new We,tt=new We,it=new We,st=new We,nt=new We,ot=new We,rt=new We,at=new We,lt=new We,ct=new Ke;class ht{constructor(e,t){this.center=void 0!==e?e:new We,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):ct.setFromPoints(e).getCenter(i);let s=0;for(let t=0,n=e.length;t<n;t++)s=Math.max(s,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(s),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new We),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ke),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const dt=new We,ut=new We,pt=new We,mt=new We,gt=new We,ft=new We,vt=new We;class yt{constructor(e,t){this.origin=void 0!==e?e:new We,this.direction=void 0!==t?t:new We(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new We),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dt)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new We),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dt.copy(this.direction).multiplyScalar(t).add(this.origin),dt.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){ut.copy(e).add(t).multiplyScalar(.5),pt.copy(t).sub(e).normalize(),mt.copy(this.origin).sub(ut);const n=.5*e.distanceTo(t),o=-this.direction.dot(pt),r=mt.dot(this.direction),a=-mt.dot(pt),l=mt.lengthSq(),c=Math.abs(1-o*o);let h,d,u,p;if(c>0)if(h=o*a-r,d=o*r-a,p=n*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+o*d+2*r)+d*(o*h+d+2*a)+l}else d=n,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;else d=-n,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;else d<=-p?(h=Math.max(0,-(-o*n+r)),d=h>0?-n:Math.min(Math.max(-n,-a),n),u=-h*h+d*(d+2*a)+l):d<=p?(h=0,d=Math.min(Math.max(-n,-a),n),u=d*(d+2*a)+l):(h=Math.max(0,-(o*n+r)),d=h>0?n:Math.min(Math.max(-n,-a),n),u=-h*h+d*(d+2*a)+l);else d=o>0?-n:n,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),s&&s.copy(pt).multiplyScalar(d).add(ut),u}intersectSphere(e,t){dt.subVectors(e.center,this.origin);const i=dt.dot(this.direction),s=dt.dot(dt)-i*i,n=e.radius*e.radius;if(s>n)return null;const o=Math.sqrt(n-s),r=i-o,a=i+o;return r<0&&a<0?null:r<0?this.at(a,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,n,o,r,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,s=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,s=(e.min.x-d.x)*l),c>=0?(n=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(n=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),i>o||n>s?null:((n>i||i!=i)&&(i=n),(o<s||s!=s)&&(s=o),h>=0?(r=(e.min.z-d.z)*h,a=(e.max.z-d.z)*h):(r=(e.max.z-d.z)*h,a=(e.min.z-d.z)*h),i>a||r>s?null:((r>i||i!=i)&&(i=r),(a<s||s!=s)&&(s=a),s<0?null:this.at(i>=0?i:s,t)))}intersectsBox(e){return null!==this.intersectBox(e,dt)}intersectTriangle(e,t,i,s,n){gt.subVectors(t,e),ft.subVectors(i,e),vt.crossVectors(gt,ft);let o,r=this.direction.dot(vt);if(r>0){if(s)return null;o=1}else{if(!(r<0))return null;o=-1,r=-r}mt.subVectors(this.origin,e);const a=o*this.direction.dot(ft.crossVectors(mt,ft));if(a<0)return null;const l=o*this.direction.dot(gt.cross(mt));if(l<0)return null;if(a+l>r)return null;const c=-o*mt.dot(vt);return c<0?null:this.at(c/r,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class bt{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,n,o,r,a,l,c,h,d,u,p,m,g){const f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=s,f[1]=n,f[5]=o,f[9]=r,f[13]=a,f[2]=l,f[6]=c,f[10]=h,f[14]=d,f[3]=u,f[7]=p,f[11]=m,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/wt.setFromMatrixColumn(e,0).length(),n=1/wt.setFromMatrixColumn(e,1).length(),o=1/wt.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,s=e.y,n=e.z,o=Math.cos(i),r=Math.sin(i),a=Math.cos(s),l=Math.sin(s),c=Math.cos(n),h=Math.sin(n);if("XYZ"===e.order){const e=o*c,i=o*h,s=r*c,n=r*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+s*l,t[5]=e-n*l,t[9]=-r*a,t[2]=n-e*l,t[6]=s+i*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,i=a*h,s=l*c,n=l*h;t[0]=e+n*r,t[4]=s*r-i,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-r,t[2]=i*r-s,t[6]=n+e*r,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,i=a*h,s=l*c,n=l*h;t[0]=e-n*r,t[4]=-o*h,t[8]=s+i*r,t[1]=i+s*r,t[5]=o*c,t[9]=n-e*r,t[2]=-o*l,t[6]=r,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,i=o*h,s=r*c,n=r*h;t[0]=a*c,t[4]=s*l-i,t[8]=e*l+n,t[1]=a*h,t[5]=n*l+e,t[9]=i*l-s,t[2]=-l,t[6]=r*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,i=o*l,s=r*a,n=r*l;t[0]=a*c,t[4]=n-e*h,t[8]=s*h+i,t[1]=h,t[5]=o*c,t[9]=-r*c,t[2]=-l*c,t[6]=i*h+s,t[10]=e-n*h}else if("XZY"===e.order){const e=o*a,i=o*l,s=r*a,n=r*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+n,t[5]=o*c,t[9]=i*h-s,t[2]=s*h-i,t[6]=r*c,t[10]=n*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Tt,e,Et)}lookAt(e,t,i){const s=this.elements;return Mt.subVectors(e,t),0===Mt.lengthSq()&&(Mt.z=1),Mt.normalize(),_t.crossVectors(i,Mt),0===_t.lengthSq()&&(1===Math.abs(i.z)?Mt.x+=1e-4:Mt.z+=1e-4,Mt.normalize(),_t.crossVectors(i,Mt)),_t.normalize(),xt.crossVectors(Mt,_t),s[0]=_t.x,s[4]=xt.x,s[8]=Mt.x,s[1]=_t.y,s[5]=xt.y,s[9]=Mt.y,s[2]=_t.z,s[6]=xt.z,s[10]=Mt.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,n=this.elements,o=i[0],r=i[4],a=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],y=i[7],b=i[11],w=i[15],S=s[0],T=s[4],E=s[8],_=s[12],x=s[1],M=s[5],P=s[9],A=s[13],O=s[2],D=s[6],I=s[10],C=s[14],R=s[3],L=s[7],N=s[11],k=s[15];return n[0]=o*S+r*x+a*O+l*R,n[4]=o*T+r*M+a*D+l*L,n[8]=o*E+r*P+a*I+l*N,n[12]=o*_+r*A+a*C+l*k,n[1]=c*S+h*x+d*O+u*R,n[5]=c*T+h*M+d*D+u*L,n[9]=c*E+h*P+d*I+u*N,n[13]=c*_+h*A+d*C+u*k,n[2]=p*S+m*x+g*O+f*R,n[6]=p*T+m*M+g*D+f*L,n[10]=p*E+m*P+g*I+f*N,n[14]=p*_+m*A+g*C+f*k,n[3]=v*S+y*x+b*O+w*R,n[7]=v*T+y*M+b*D+w*L,n[11]=v*E+y*P+b*I+w*N,n[15]=v*_+y*A+b*C+w*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],n=e[12],o=e[1],r=e[5],a=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+n*a*h-s*l*h-n*r*d+i*l*d+s*r*u-i*a*u)+e[7]*(+t*a*u-t*l*d+n*o*d-s*o*u+s*l*c-n*a*c)+e[11]*(+t*l*h-t*r*u-n*o*h+i*o*u+n*r*c-i*l*c)+e[15]*(-s*r*c-t*a*h+t*r*d+s*o*h-i*o*d+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],n=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],g=e[14],f=e[15],v=h*g*l-m*d*l+m*a*u-r*g*u-h*a*f+r*d*f,y=p*d*l-c*g*l-p*a*u+o*g*u+c*a*f-o*d*f,b=c*m*l-p*h*l+p*r*u-o*m*u-c*r*f+o*h*f,w=p*h*a-c*m*a-p*r*d+o*m*d+c*r*g-o*h*g,S=t*v+i*y+s*b+n*w;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return e[0]=v*T,e[1]=(m*d*n-h*g*n-m*s*u+i*g*u+h*s*f-i*d*f)*T,e[2]=(r*g*n-m*a*n+m*s*l-i*g*l-r*s*f+i*a*f)*T,e[3]=(h*a*n-r*d*n-h*s*l+i*d*l+r*s*u-i*a*u)*T,e[4]=y*T,e[5]=(c*g*n-p*d*n+p*s*u-t*g*u-c*s*f+t*d*f)*T,e[6]=(p*a*n-o*g*n-p*s*l+t*g*l+o*s*f-t*a*f)*T,e[7]=(o*d*n-c*a*n+c*s*l-t*d*l-o*s*u+t*a*u)*T,e[8]=b*T,e[9]=(p*h*n-c*m*n-p*i*u+t*m*u+c*i*f-t*h*f)*T,e[10]=(o*m*n-p*r*n+p*i*l-t*m*l-o*i*f+t*r*f)*T,e[11]=(c*r*n-o*h*n-c*i*l+t*h*l+o*i*u-t*r*u)*T,e[12]=w*T,e[13]=(c*m*s-p*h*s+p*i*d-t*m*d-c*i*g+t*h*g)*T,e[14]=(p*r*s-o*m*s-p*i*a+t*m*a+o*i*g-t*r*g)*T,e[15]=(o*h*s-c*r*s+c*i*a-t*h*a-o*i*d+t*r*d)*T,this}scale(e){const t=this.elements,i=e.x,s=e.y,n=e.z;return t[0]*=i,t[4]*=s,t[8]*=n,t[1]*=i,t[5]*=s,t[9]*=n,t[2]*=i,t[6]*=s,t[10]*=n,t[3]*=i,t[7]*=s,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),n=1-i,o=e.x,r=e.y,a=e.z,l=n*o,c=n*r;return this.set(l*o+i,l*r-s*a,l*a+s*r,0,l*r+s*a,c*r+i,c*a-s*o,0,l*a-s*r,c*a+s*o,n*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,n=t._x,o=t._y,r=t._z,a=t._w,l=n+n,c=o+o,h=r+r,d=n*l,u=n*c,p=n*h,m=o*c,g=o*h,f=r*h,v=a*l,y=a*c,b=a*h,w=i.x,S=i.y,T=i.z;return s[0]=(1-(m+f))*w,s[1]=(u+b)*w,s[2]=(p-y)*w,s[3]=0,s[4]=(u-b)*S,s[5]=(1-(d+f))*S,s[6]=(g+v)*S,s[7]=0,s[8]=(p+y)*T,s[9]=(g-v)*T,s[10]=(1-(d+m))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let n=wt.set(s[0],s[1],s[2]).length();const o=wt.set(s[4],s[5],s[6]).length(),r=wt.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),e.x=s[12],e.y=s[13],e.z=s[14],St.copy(this);const a=1/n,l=1/o,c=1/r;return St.elements[0]*=a,St.elements[1]*=a,St.elements[2]*=a,St.elements[4]*=l,St.elements[5]*=l,St.elements[6]*=l,St.elements[8]*=c,St.elements[9]*=c,St.elements[10]*=c,t.setFromRotationMatrix(St),i.x=n,i.y=o,i.z=r,this}makePerspective(e,t,i,s,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,a=2*n/(t-e),l=2*n/(i-s),c=(t+e)/(t-e),h=(i+s)/(i-s),d=-(o+n)/(o-n),u=-2*o*n/(o-n);return r[0]=a,r[4]=0,r[8]=c,r[12]=0,r[1]=0,r[5]=l,r[9]=h,r[13]=0,r[2]=0,r[6]=0,r[10]=d,r[14]=u,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(e,t,i,s,n,o){const r=this.elements,a=1/(t-e),l=1/(i-s),c=1/(o-n),h=(t+e)*a,d=(i+s)*l,u=(o+n)*c;return r[0]=2*a,r[4]=0,r[8]=0,r[12]=-h,r[1]=0,r[5]=2*l,r[9]=0,r[13]=-d,r[2]=0,r[6]=0,r[10]=-2*c,r[14]=-u,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const wt=new We,St=new bt,Tt=new We(0,0,0),Et=new We(1,1,1),_t=new We,xt=new We,Mt=new We;class Pt{constructor(e=0,t=0,i=0,s=Pt.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._order=s||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const s=Re.clamp,n=e.elements,o=n[0],r=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],u=n[6],p=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(s(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-s(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(s(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-s(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(s(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-s(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return At.makeRotationFromQuaternion(e),this.setFromRotationMatrix(At,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Ot.setFromEuler(this),this.setFromQuaternion(Ot,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new We(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Pt.DefaultOrder="XYZ",Pt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const At=new bt,Ot=new je;class Dt{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let It=0;const Ct=new We,Rt=new je,Lt=new bt,Nt=new We,kt=new We,Ft=new We,Bt=new je,Ut=new We(1,0,0),Ht=new We(0,1,0),Gt=new We(0,0,1),Vt={type:"added"},zt={type:"removed"};function jt(){Object.defineProperty(this,"id",{value:It++}),this.uuid=Re.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jt.DefaultUp.clone();const e=new We,t=new Pt,i=new je,s=new We(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new bt},normalMatrix:{value:new Ne}}),this.matrix=new bt,this.matrixWorld=new bt,this.matrixAutoUpdate=jt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Dt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}jt.DefaultUp=new We(0,1,0),jt.DefaultMatrixAutoUpdate=!0,jt.prototype=Object.assign(Object.create(De.prototype),{constructor:jt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Rt.setFromAxisAngle(e,t),this.quaternion.multiply(Rt),this},rotateOnWorldAxis:function(e,t){return Rt.setFromAxisAngle(e,t),this.quaternion.premultiply(Rt),this},rotateX:function(e){return this.rotateOnAxis(Ut,e)},rotateY:function(e){return this.rotateOnAxis(Ht,e)},rotateZ:function(e){return this.rotateOnAxis(Gt,e)},translateOnAxis:function(e,t){return Ct.copy(e).applyQuaternion(this.quaternion),this.position.add(Ct.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Ut,e)},translateY:function(e){return this.translateOnAxis(Ht,e)},translateZ:function(e){return this.translateOnAxis(Gt,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Lt.copy(this.matrixWorld).invert())},lookAt:function(e,t,i){e.isVector3?Nt.copy(e):Nt.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),kt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lt.lookAt(kt,Nt,this.up):Lt.lookAt(Nt,kt,this.up),this.quaternion.setFromRotationMatrix(Lt),s&&(Lt.extractRotation(s.matrixWorld),Rt.setFromRotationMatrix(Lt),this.quaternion.premultiply(Rt.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Vt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zt)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(zt)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),Lt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Lt.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lt),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(e,t);if(void 0!==s)return s}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new We),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new je),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kt,e,Ft),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new We),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kt,Bt,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new We),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){s.geometry=n(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,s=i.length;t<s;t++){const s=i[t];n(e.shapes,s)}else n(e.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,s=this.material.length;i<s;i++)t.push(n(e.materials,this.material[i]));s.material=t}else s.material=n(e.materials,this.material);if(this.children.length>0){s.children=[];for(let t=0;t<this.children.length;t++)s.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];s.animations.push(n(e.animations,i))}}if(t){const t=o(e.geometries),s=o(e.materials),n=o(e.textures),r=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(i.geometries=t),s.length>0&&(i.materials=s),n.length>0&&(i.textures=n),r.length>0&&(i.images=r),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=s,i;function o(e){const t=[];for(const i in e){const s=e[i];delete s.metadata,t.push(s)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}});const Wt=new We,Zt=new We,qt=new Ne;class Kt{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new We(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=Wt.subVectors(i,t).cross(Zt.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new We),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new We);const i=e.delta(Wt),s=this.normal.dot(i);if(0===s)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const n=-(e.start.dot(this.normal)+this.constant)/s;return n<0||n>1?void 0:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new We),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||qt.getNormalMatrix(e),s=this.coplanarPoint(Wt).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const Yt=new We,$t=new We,Qt=new We,Xt=new We,Jt=new We,ei=new We,ti=new We,ii=new We,si=new We,ni=new We;class oi{constructor(e,t,i){this.a=void 0!==e?e:new We,this.b=void 0!==t?t:new We,this.c=void 0!==i?i:new We}static getNormal(e,t,i,s){void 0===s&&(console.warn("THREE.Triangle: .getNormal() target is now required"),s=new We),s.subVectors(i,t),Yt.subVectors(e,t),s.cross(Yt);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(e,t,i,s,n){Yt.subVectors(s,t),$t.subVectors(i,t),Qt.subVectors(e,t);const o=Yt.dot(Yt),r=Yt.dot($t),a=Yt.dot(Qt),l=$t.dot($t),c=$t.dot(Qt),h=o*l-r*r;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new We),0===h)return n.set(-2,-1,-1);const d=1/h,u=(l*a-r*c)*d,p=(o*c-r*a)*d;return n.set(1-u-p,p,u)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Xt),Xt.x>=0&&Xt.y>=0&&Xt.x+Xt.y<=1}static getUV(e,t,i,s,n,o,r,a){return this.getBarycoord(e,t,i,s,Xt),a.set(0,0),a.addScaledVector(n,Xt.x),a.addScaledVector(o,Xt.y),a.addScaledVector(r,Xt.z),a}static isFrontFacing(e,t,i,s){return Yt.subVectors(i,t),$t.subVectors(e,t),Yt.cross($t).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yt.subVectors(this.c,this.b),$t.subVectors(this.a,this.b),.5*Yt.cross($t).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new We),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return oi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Kt),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return oi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,n){return oi.getUV(e,this.a,this.b,this.c,t,i,s,n)}containsPoint(e){return oi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return oi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new We);const i=this.a,s=this.b,n=this.c;let o,r;Jt.subVectors(s,i),ei.subVectors(n,i),ii.subVectors(e,i);const a=Jt.dot(ii),l=ei.dot(ii);if(a<=0&&l<=0)return t.copy(i);si.subVectors(e,s);const c=Jt.dot(si),h=ei.dot(si);if(c>=0&&h<=c)return t.copy(s);const d=a*h-c*l;if(d<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(i).addScaledVector(Jt,o);ni.subVectors(e,n);const u=Jt.dot(ni),p=ei.dot(ni);if(p>=0&&u<=p)return t.copy(n);const m=u*l-a*p;if(m<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(i).addScaledVector(ei,r);const g=c*p-u*h;if(g<=0&&h-c>=0&&u-p>=0)return ti.subVectors(n,s),r=(h-c)/(h-c+(u-p)),t.copy(s).addScaledVector(ti,r);const f=1/(g+m+d);return o=m*f,r=d*f,t.copy(i).addScaledVector(Jt,o).addScaledVector(ei,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ri={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ai={h:0,s:0,l:0},li={h:0,s:0,l:0};function ci(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function hi(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function di(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class ui{constructor(e,t,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Re.euclideanModulo(e,1),t=Re.clamp(t,0,1),i=Re.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,n=2*i-s;this.r=ci(n,s,e+1/3),this.g=ci(n,s,e),this.b=ci(n,s,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let e;const s=i[1],n=i[2];switch(s){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const i=parseFloat(e[1])/360,s=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,s,n)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=ri[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=hi(e.r),this.g=hi(e.g),this.b=hi(e.b),this}copyLinearToSRGB(e){return this.r=di(e.r),this.g=di(e.g),this.b=di(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,i=this.g,s=this.b,n=Math.max(t,i,s),o=Math.min(t,i,s);let r,a;const l=(o+n)/2;if(o===n)r=0,a=0;else{const e=n-o;switch(a=l<=.5?e/(n+o):e/(2-n-o),n){case t:r=(i-s)/e+(i<s?6:0);break;case i:r=(s-t)/e+2;break;case s:r=(t-i)/e+4}r/=6}return e.h=r,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(ai),ai.h+=e,ai.s+=t,ai.l+=i,this.setHSL(ai.h,ai.s,ai.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpHSL(e,t){this.getHSL(ai),e.getHSL(li);const i=Re.lerp(ai.h,li.h,t),s=Re.lerp(ai.s,li.s,t),n=Re.lerp(ai.l,li.l,t);return this.setHSL(i,s,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}ui.NAMES=ri,ui.prototype.r=1,ui.prototype.g=1,ui.prototype.b=1;class pi{constructor(e,t,i,s,n,o=0){this.a=e,this.b=t,this.c=i,this.normal=s&&s.isVector3?s:new We,this.vertexNormals=Array.isArray(s)?s:[],this.color=n&&n.isColor?n:new ui,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let mi=0;function gi(){Object.defineProperty(this,"id",{value:mi++}),this.uuid=Re.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=a,this.side=s,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=v,this.blendDst=y,this.blendEquation=l,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Me,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ee,this.stencilZFail=Ee,this.stencilZPass=Ee,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function fi(e){gi.call(this),this.type="MeshBasicMaterial",this.color=new ui(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}gi.prototype=Object.assign(Object.create(De.prototype),{constructor:gi,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const s=this[t];void 0!==s?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const s=e[i];delete s.metadata,t.push(s)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==a&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==s&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),s=n(e.images);t.length>0&&(i.textures=t),s.length>0&&(i.images=s)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let s=0;s!==e;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(gi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),fi.prototype=Object.create(gi.prototype),fi.prototype.constructor=fi,fi.prototype.isMeshBasicMaterial=!0,fi.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const vi=new We,yi=new Le;function bi(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Pe,this.updateRange={offset:0,count:-1},this.version=0}function wi(e,t,i){bi.call(this,new Int8Array(e),t,i)}function Si(e,t,i){bi.call(this,new Uint8Array(e),t,i)}function Ti(e,t,i){bi.call(this,new Uint8ClampedArray(e),t,i)}function Ei(e,t,i){bi.call(this,new Int16Array(e),t,i)}function _i(e,t,i){bi.call(this,new Uint16Array(e),t,i)}function xi(e,t,i){bi.call(this,new Int32Array(e),t,i)}function Mi(e,t,i){bi.call(this,new Uint32Array(e),t,i)}function Pi(e,t,i){bi.call(this,new Uint16Array(e),t,i)}function Ai(e,t,i){bi.call(this,new Float32Array(e),t,i)}function Oi(e,t,i){bi.call(this,new Float64Array(e),t,i)}Object.defineProperty(bi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(bi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[e+s]=t.array[i+s];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let i=0;for(let s=0,n=e.length;s<n;s++){let n=e[s];void 0===n&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),n=new ui),t[i++]=n.r,t[i++]=n.g,t[i++]=n.b}return this},copyVector2sArray:function(e){const t=this.array;let i=0;for(let s=0,n=e.length;s<n;s++){let n=e[s];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),n=new Le),t[i++]=n.x,t[i++]=n.y}return this},copyVector3sArray:function(e){const t=this.array;let i=0;for(let s=0,n=e.length;s<n;s++){let n=e[s];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),n=new We),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z}return this},copyVector4sArray:function(e){const t=this.array;let i=0;for(let s=0,n=e.length;s<n;s++){let n=e[s];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),n=new Ge),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)yi.fromBufferAttribute(this,t),yi.applyMatrix3(e),this.setXY(t,yi.x,yi.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)vi.fromBufferAttribute(this,t),vi.applyMatrix3(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this},applyMatrix4:function(e){for(let t=0,i=this.count;t<i;t++)vi.x=this.getX(t),vi.y=this.getY(t),vi.z=this.getZ(t),vi.applyMatrix4(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this},applyNormalMatrix:function(e){for(let t=0,i=this.count;t<i;t++)vi.x=this.getX(t),vi.y=this.getY(t),vi.z=this.getZ(t),vi.applyNormalMatrix(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this},transformDirection:function(e){for(let t=0,i=this.count;t<i;t++)vi.x=this.getX(t),vi.y=this.getY(t),vi.z=this.getZ(t),vi.transformDirection(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this},setXYZW:function(e,t,i,s,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),wi.prototype=Object.create(bi.prototype),wi.prototype.constructor=wi,Si.prototype=Object.create(bi.prototype),Si.prototype.constructor=Si,Ti.prototype=Object.create(bi.prototype),Ti.prototype.constructor=Ti,Ei.prototype=Object.create(bi.prototype),Ei.prototype.constructor=Ei,_i.prototype=Object.create(bi.prototype),_i.prototype.constructor=_i,xi.prototype=Object.create(bi.prototype),xi.prototype.constructor=xi,Mi.prototype=Object.create(bi.prototype),Mi.prototype.constructor=Mi,Pi.prototype=Object.create(bi.prototype),Pi.prototype.constructor=Pi,Pi.prototype.isFloat16BufferAttribute=!0,Ai.prototype=Object.create(bi.prototype),Ai.prototype.constructor=Ai,Oi.prototype=Object.create(bi.prototype),Oi.prototype.constructor=Oi;class Di{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let i,s,n;const o=e.faces;for(s=0;s<o.length;s++){const e=o[s];e.materialIndex!==n&&(n=e.materialIndex,void 0!==i&&(i.count=3*s-i.start,t.push(i)),i={start:3*s,materialIndex:n})}void 0!==i&&(i.count=3*s-i.start,t.push(i)),this.groups=t}fromGeometry(e){const t=e.faces,i=e.vertices,s=e.faceVertexUvs,n=s[0]&&s[0].length>0,o=s[1]&&s[1].length>0,r=e.morphTargets,a=r.length;let l;if(a>0){l=[];for(let e=0;e<a;e++)l[e]={name:r[e].name,data:[]};this.morphTargets.position=l}const c=e.morphNormals,h=c.length;let d;if(h>0){d=[];for(let e=0;e<h;e++)d[e]={name:c[e].name,data:[]};this.morphTargets.normal=d}const u=e.skinIndices,p=e.skinWeights,m=u.length===i.length,g=p.length===i.length;i.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<t.length;e++){const f=t[e];this.vertices.push(i[f.a],i[f.b],i[f.c]);const v=f.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=f.normal;this.normals.push(e,e,e)}const y=f.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=f.color;this.colors.push(e,e,e)}if(!0===n){const t=s[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new Le,new Le,new Le))}if(!0===o){const t=s[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new Le,new Le,new Le))}for(let e=0;e<a;e++){const t=r[e].vertices;l[e].data.push(t[f.a],t[f.b],t[f.c])}for(let t=0;t<h;t++){const i=c[t].vertexNormals[e];d[t].data.push(i.a,i.b,i.c)}m&&this.skinIndices.push(u[f.a],u[f.b],u[f.c]),g&&this.skinWeights.push(p[f.a],p[f.b],p[f.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}function Ii(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,s=e.length;i<s;++i)e[i]>t&&(t=e[i]);return t}const Ci={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ri(e,t){return new Ci[e](t)}let Li=1;const Ni=new bt,ki=new jt,Fi=new We,Bi=new Ke,Ui=new Ke,Hi=new We;function Gi(){Object.defineProperty(this,"id",{value:Li+=2}),this.uuid=Re.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Gi.prototype=Object.assign(Object.create(De.prototype),{constructor:Gi,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(Ii(e)>65535?Mi:_i)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Ne).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(e),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Ni.makeRotationX(e),this.applyMatrix4(Ni),this},rotateY:function(e){return Ni.makeRotationY(e),this.applyMatrix4(Ni),this},rotateZ:function(e){return Ni.makeRotationZ(e),this.applyMatrix4(Ni),this},translate:function(e,t,i){return Ni.makeTranslation(e,t,i),this.applyMatrix4(Ni),this},scale:function(e,t,i){return Ni.makeScale(e,t,i),this.applyMatrix4(Ni),this},lookAt:function(e){return ki.lookAt(e),ki.updateMatrix(),this.applyMatrix4(ki.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fi).negate(),this.translate(Fi.x,Fi.y,Fi.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const e=new Ai(3*t.vertices.length,3),i=new Ai(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new Ai(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let i=0,s=e.length;i<s;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ai(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Di).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new bi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new bi(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new bi(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new bi(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new bi(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const t in e.morphTargets){const i=[],s=e.morphTargets[t];for(let e=0,t=s.length;e<t;e++){const t=s[e],n=new Ai(3*t.data.length,3);n.name=t.name,i.push(n.copyVector3sArray(t.data))}this.morphAttributes[t]=i}if(e.skinIndices.length>0){const t=new Ai(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new Ai(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ke);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Bi.setFromBufferAttribute(i),this.morphTargetsRelative?(Hi.addVectors(this.boundingBox.min,Bi.min),this.boundingBox.expandByPoint(Hi),Hi.addVectors(this.boundingBox.max,Bi.max),this.boundingBox.expandByPoint(Hi)):(this.boundingBox.expandByPoint(Bi.min),this.boundingBox.expandByPoint(Bi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ht);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new We,1/0);if(e){const i=this.boundingSphere.center;if(Bi.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Ui.setFromBufferAttribute(i),this.morphTargetsRelative?(Hi.addVectors(Bi.min,Ui.min),Bi.expandByPoint(Hi),Hi.addVectors(Bi.max,Ui.max),Bi.expandByPoint(Hi)):(Bi.expandByPoint(Ui.min),Bi.expandByPoint(Ui.max))}Bi.getCenter(i);let s=0;for(let t=0,n=e.count;t<n;t++)Hi.fromBufferAttribute(e,t),s=Math.max(s,i.distanceToSquared(Hi));if(t)for(let n=0,o=t.length;n<o;n++){const o=t[n],r=this.morphTargetsRelative;for(let t=0,n=o.count;t<n;t++)Hi.fromBufferAttribute(o,t),r&&(Fi.fromBufferAttribute(e,t),Hi.add(Fi)),s=Math.max(s,i.distanceToSquared(Hi))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new bi(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const s=new We,n=new We,o=new We,r=new We,a=new We,l=new We,c=new We,h=new We;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,u),n.fromBufferAttribute(t,p),o.fromBufferAttribute(t,m),c.subVectors(o,n),h.subVectors(s,n),c.cross(h),r.fromBufferAttribute(i,u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),r.add(c),a.add(c),l.add(c),i.setXYZ(u,r.x,r.y,r.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,r=t.count;e<r;e+=3)s.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,n),h.subVectors(s,n),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const s in i){if(void 0===e.attributes[s])continue;const n=i[s].array,o=e.attributes[s],r=o.array,a=o.itemSize*t,l=Math.min(r.length,n.length-a);for(let e=0,t=a;e<l;e++,t++)n[t]=r[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Hi.fromBufferAttribute(e,t),Hi.normalize(),e.setXYZ(t,Hi.x,Hi.y,Hi.z)},toNonIndexed:function(){function e(e,t){const i=e.array,s=e.itemSize,n=e.normalized,o=new i.constructor(t.length*s);let r=0,a=0;for(let e=0,n=t.length;e<n;e++){r=t[e]*s;for(let e=0;e<s;e++)o[a++]=i[r++]}return new bi(o,s,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new Gi,i=this.index.array,s=this.attributes;for(const n in s){const o=e(s[n],i);t.setAttribute(n,o)}const n=this.morphAttributes;for(const s in n){const o=[],r=n[s];for(let t=0,s=r.length;t<s;t++){const s=e(r[t],i);o.push(s)}t.morphAttributes[s]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,i=o.length;e<i;e++){const i=o[e];t.addGroup(i.start,i.count,i.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const s=i[t],n=s.toJSON(e.data);""!==s.name&&(n.name=s.name),e.data.attributes[t]=n}const s={};let n=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],o=[];for(let t=0,s=i.length;t<s;t++){const s=i[t],n=s.toJSON(e.data);""!==s.name&&(n.name=s.name),o.push(n)}o.length>0&&(s[t]=o,n=!0)}n&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const r=this.boundingSphere;return null!==r&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){return(new Gi).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const s=e.attributes;for(const e in s){const i=s[e];this.setAttribute(e,i.clone(t))}const n=e.morphAttributes;for(const e in n){const i=[],s=n[e];for(let e=0,n=s.length;e<n;e++)i.push(s[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const r=e.boundingBox;null!==r&&(this.boundingBox=r.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Vi=new bt,zi=new yt,ji=new ht,Wi=new We,Zi=new We,qi=new We,Ki=new We,Yi=new We,$i=new We,Qi=new We,Xi=new We,Ji=new We,es=new Le,ts=new Le,is=new Le,ss=new We,ns=new We;function os(e=new Gi,t=new fi){jt.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function rs(e,t,i,s,r,a,l,c){let h;if(h=t.side===n?s.intersectTriangle(l,a,r,!0,c):s.intersectTriangle(r,a,l,t.side!==o,c),null===h)return null;ns.copy(c),ns.applyMatrix4(e.matrixWorld);const d=i.ray.origin.distanceTo(ns);return d<i.near||d>i.far?null:{distance:d,point:ns.clone(),object:e}}function as(e,t,i,s,n,o,r,a,l,c,h,d){Wi.fromBufferAttribute(n,c),Zi.fromBufferAttribute(n,h),qi.fromBufferAttribute(n,d);const u=e.morphTargetInfluences;if(t.morphTargets&&o&&u){Qi.set(0,0,0),Xi.set(0,0,0),Ji.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=u[e],i=o[e];0!==t&&(Ki.fromBufferAttribute(i,c),Yi.fromBufferAttribute(i,h),$i.fromBufferAttribute(i,d),r?(Qi.addScaledVector(Ki,t),Xi.addScaledVector(Yi,t),Ji.addScaledVector($i,t)):(Qi.addScaledVector(Ki.sub(Wi),t),Xi.addScaledVector(Yi.sub(Zi),t),Ji.addScaledVector($i.sub(qi),t)))}Wi.add(Qi),Zi.add(Xi),qi.add(Ji)}e.isSkinnedMesh&&(e.boneTransform(c,Wi),e.boneTransform(h,Zi),e.boneTransform(d,qi));const p=rs(e,t,i,s,Wi,Zi,qi,ss);if(p){a&&(es.fromBufferAttribute(a,c),ts.fromBufferAttribute(a,h),is.fromBufferAttribute(a,d),p.uv=oi.getUV(ss,Wi,Zi,qi,es,ts,is,new Le)),l&&(es.fromBufferAttribute(l,c),ts.fromBufferAttribute(l,h),is.fromBufferAttribute(l,d),p.uv2=oi.getUV(ss,Wi,Zi,qi,es,ts,is,new Le));const e=new pi(c,h,d);oi.getNormal(Wi,Zi,qi,e.normal),p.face=e}return p}os.prototype=Object.assign(Object.create(jt.prototype),{constructor:os,isMesh:!0,copy:function(e){return jt.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const i=this.geometry,s=this.material,n=this.matrixWorld;if(void 0===s)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ji.copy(i.boundingSphere),ji.applyMatrix4(n),!1===e.ray.intersectsSphere(ji))return;if(Vi.copy(n).invert(),zi.copy(e.ray).applyMatrix4(Vi),null!==i.boundingBox&&!1===zi.intersectsBox(i.boundingBox))return;let o;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,d=i.groups,u=i.drawRange;if(null!==n)if(Array.isArray(s))for(let i=0,p=d.length;i<p;i++){const p=d[i],m=s[p.materialIndex];for(let i=Math.max(p.start,u.start),s=Math.min(p.start+p.count,u.start+u.count);i<s;i+=3){const s=n.getX(i),d=n.getX(i+1),u=n.getX(i+2);o=as(this,m,e,zi,r,a,l,c,h,s,d,u),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let i=Math.max(0,u.start),d=Math.min(n.count,u.start+u.count);i<d;i+=3){const d=n.getX(i),u=n.getX(i+1),p=n.getX(i+2);o=as(this,s,e,zi,r,a,l,c,h,d,u,p),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}else if(void 0!==r)if(Array.isArray(s))for(let i=0,n=d.length;i<n;i++){const n=d[i],p=s[n.materialIndex];for(let i=Math.max(n.start,u.start),s=Math.min(n.start+n.count,u.start+u.count);i<s;i+=3)o=as(this,p,e,zi,r,a,l,c,h,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=n.materialIndex,t.push(o))}else for(let i=Math.max(0,u.start),n=Math.min(r.count,u.start+u.count);i<n;i+=3)o=as(this,s,e,zi,r,a,l,c,h,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}else if(i.isGeometry){const n=Array.isArray(s),r=i.vertices,a=i.faces;let l;const c=i.faceVertexUvs[0];c.length>0&&(l=c);for(let i=0,c=a.length;i<c;i++){const c=a[i],h=n?s[c.materialIndex]:s;if(void 0===h)continue;const d=r[c.a],u=r[c.b],p=r[c.c];if(o=rs(this,h,e,zi,d,u,p,ss),o){if(l&&l[i]){const e=l[i];es.copy(e[0]),ts.copy(e[1]),is.copy(e[2]),o.uv=oi.getUV(ss,d,u,p,es,ts,is,new Le)}o.face=c,o.faceIndex=i,t.push(o)}}}}});class ls extends Gi{constructor(e=1,t=1,i=1,s=1,n=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:n,depthSegments:o};const r=this;s=Math.floor(s),n=Math.floor(n),o=Math.floor(o);const a=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,i,s,n,o,p,m,g,f,v){const y=o/g,b=p/f,w=o/2,S=p/2,T=m/2,E=g+1,_=f+1;let x=0,M=0;const P=new We;for(let o=0;o<_;o++){const r=o*b-S;for(let a=0;a<E;a++){const d=a*y-w;P[e]=d*s,P[t]=r*n,P[i]=T,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[i]=m>0?1:-1,c.push(P.x,P.y,P.z),h.push(a/g),h.push(1-o/f),x+=1}}for(let e=0;e<f;e++)for(let t=0;t<g;t++){const i=d+t+E*e,s=d+t+E*(e+1),n=d+(t+1)+E*(e+1),o=d+(t+1)+E*e;a.push(i,s,o),a.push(s,n,o),M+=6}r.addGroup(u,M,v),u+=M,d+=x}p("z","y","x",-1,-1,i,t,e,o,n,0),p("z","y","x",1,-1,i,t,-e,o,n,1),p("x","z","y",1,1,e,i,t,s,o,2),p("x","z","y",1,-1,e,i,-t,s,o,3),p("x","y","z",1,-1,e,t,i,s,n,4),p("x","y","z",-1,-1,e,t,-i,s,n,5),this.setIndex(a),this.setAttribute("position",new Ai(l,3)),this.setAttribute("normal",new Ai(c,3)),this.setAttribute("uv",new Ai(h,2))}}function cs(e){const t={};for(const i in e){t[i]={};for(const s in e[i]){const n=e[i][s];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[i][s]=n.clone():Array.isArray(n)?t[i][s]=n.slice():t[i][s]=n}}return t}function hs(e){const t={};for(let i=0;i<e.length;i++){const s=cs(e[i]);for(const e in s)t[e]=s[e]}return t}const ds={clone:cs,merge:hs};function us(e){gi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function ps(){jt.call(this),this.type="Camera",this.matrixWorldInverse=new bt,this.projectionMatrix=new bt,this.projectionMatrixInverse=new bt}function ms(e=50,t=1,i=.1,s=2e3){ps.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}us.prototype=Object.create(gi.prototype),us.prototype.constructor=us,us.prototype.isShaderMaterial=!0,us.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cs(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},us.prototype.toJSON=function(e){const t=gi.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},ps.prototype=Object.assign(Object.create(jt.prototype),{constructor:ps,isCamera:!0,copy:function(e,t){return jt.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new We),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){jt.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){jt.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),ms.prototype=Object.assign(Object.create(ps.prototype),{constructor:ms,isPerspectiveCamera:!0,copy:function(e,t){return ps.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Re.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Re.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Re.RAD2DEG*Math.atan(Math.tan(.5*Re.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,s,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Re.DEG2RAD*this.fov)/this.zoom,i=2*t,s=this.aspect*i,n=-.5*s;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,r=o.fullHeight;n+=o.offsetX*s/e,t-=o.offsetY*i/r,s*=o.width/e,i*=o.height/r}const r=this.filmOffset;0!==r&&(n+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=jt.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const gs=90;function fs(e,t,i){if(jt.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const s=new ms(gs,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new We(1,0,0)),this.add(s);const n=new ms(gs,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new We(-1,0,0)),this.add(n);const o=new ms(gs,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new We(0,1,0)),this.add(o);const r=new ms(gs,1,e,t);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new We(0,-1,0)),this.add(r);const a=new ms(gs,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new We(0,0,1)),this.add(a);const l=new ms(gs,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new We(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,r),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}function vs(e,t,i,s,n,o,r,a,l,c){e=void 0!==e?e:[],t=void 0!==t?t:301,r=void 0!==r?r:$,Ue.call(this,e,t,i,s,n,o,r,a,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}function ys(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),Ve.call(this,e,e,t),t=t||{},this.texture=new vs(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function bs(e,t,i,s,n,o,r,a,l,c,h,d){Ue.call(this,null,o,r,a,l,c,s,n,h,d),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:P,this.minFilter=void 0!==c?c:P,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}fs.prototype=Object.create(jt.prototype),fs.prototype.constructor=fs,vs.prototype=Object.create(Ue.prototype),vs.prototype.constructor=vs,vs.prototype.isCubeTexture=!0,Object.defineProperty(vs.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ys.prototype=Object.create(Ve.prototype),ys.prototype.constructor=ys,ys.prototype.isWebGLCubeRenderTarget=!0,ys.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=Q,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={tEquirect:{value:null}},s="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",o="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",a=new ls(5,5,5),l=new us({name:"CubemapFromEquirect",uniforms:cs(i),vertexShader:s,fragmentShader:o,side:n,blending:r});l.uniforms.tEquirect.value=t;const c=new os(a,l),h=t.minFilter;return t.minFilter===N&&(t.minFilter=C),new fs(1,10,this).update(e,c),t.minFilter=h,c.geometry.dispose(),c.material.dispose(),this},ys.prototype.clear=function(e,t,i,s){const n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,i,s);e.setRenderTarget(n)},bs.prototype=Object.create(Ue.prototype),bs.prototype.constructor=bs,bs.prototype.isDataTexture=!0;const ws=new ht,Ss=new We;class Ts{constructor(e,t,i,s,n,o){this.planes=[void 0!==e?e:new Kt,void 0!==t?t:new Kt,void 0!==i?i:new Kt,void 0!==s?s:new Kt,void 0!==n?n:new Kt,void 0!==o?o:new Kt]}set(e,t,i,s,n,o){const r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(i),r[3].copy(s),r[4].copy(n),r[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],n=i[1],o=i[2],r=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],m=i[11],g=i[12],f=i[13],v=i[14],y=i[15];return t[0].setComponents(r-s,h-a,m-d,y-g).normalize(),t[1].setComponents(r+s,h+a,m+d,y+g).normalize(),t[2].setComponents(r+n,h+l,m+u,y+f).normalize(),t[3].setComponents(r-n,h-l,m-u,y-f).normalize(),t[4].setComponents(r-o,h-c,m-p,y-v).normalize(),t[5].setComponents(r+o,h+c,m+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ws.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ws)}intersectsSprite(e){return ws.center.set(0,0,0),ws.radius=.7071067811865476,ws.applyMatrix4(e.matrixWorld),this.intersectsSphere(ws)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(Ss.x=s.normal.x>0?e.max.x:e.min.x,Ss.y=s.normal.y>0?e.max.y:e.min.y,Ss.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Ss)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}function Es(){let e=null,t=!1,i=null,s=null;function n(t,o){i(t,o),s=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==i&&(s=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(s),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function _s(e,t){const i=t.isWebGL2,s=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),s.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=s.get(t);i&&(e.deleteBuffer(i.buffer),s.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){const e=s.get(t);return void((!e||e.version<t.version)&&s.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=s.get(t);void 0===o?s.set(t,function(t,s){const n=t.array,o=t.usage,r=e.createBuffer();e.bindBuffer(s,r),e.bufferData(s,n,o),t.onUploadCallback();let a=5126;return n instanceof Float32Array?a=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:n instanceof Int16Array?a=5122:n instanceof Uint32Array?a=5125:n instanceof Int32Array?a=5124:n instanceof Int8Array?a=5120:n instanceof Uint8Array&&(a=5121),{buffer:r,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n)):o.version<t.version&&(function(t,s,n){const o=s.array,r=s.updateRange;e.bindBuffer(n,t),-1===r.count?e.bufferSubData(n,0,o):(i?e.bufferSubData(n,r.offset*o.BYTES_PER_ELEMENT,o,r.offset,r.count):e.bufferSubData(n,r.offset*o.BYTES_PER_ELEMENT,o.subarray(r.offset,r.offset+r.count)),r.count=-1)}(o.buffer,t,n),o.version=t.version)}}}class xs extends Gi{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const n=e/2,o=t/2,r=Math.floor(i),a=Math.floor(s),l=r+1,c=a+1,h=e/r,d=t/a,u=[],p=[],m=[],g=[];for(let e=0;e<c;e++){const t=e*d-o;for(let i=0;i<l;i++){const s=i*h-n;p.push(s,-t,0),m.push(0,0,1),g.push(i/r),g.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<r;t++){const i=t+l*e,s=t+l*(e+1),n=t+1+l*(e+1),o=t+1+l*e;u.push(i,s,o),u.push(s,n,o)}this.setIndex(u),this.setAttribute("position",new Ai(p,3)),this.setAttribute("normal",new Ai(m,3)),this.setAttribute("uv",new Ai(g,2))}}const Ms={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Ps={common:{diffuse:{value:new ui(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ne},uv2Transform:{value:new Ne},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Le(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ui(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ui(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ne}},sprite:{diffuse:{value:new ui(15658734)},opacity:{value:1},center:{value:new Le(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ne}}},As={basic:{uniforms:hs([Ps.common,Ps.specularmap,Ps.envmap,Ps.aomap,Ps.lightmap,Ps.fog]),vertexShader:Ms.meshbasic_vert,fragmentShader:Ms.meshbasic_frag},lambert:{uniforms:hs([Ps.common,Ps.specularmap,Ps.envmap,Ps.aomap,Ps.lightmap,Ps.emissivemap,Ps.fog,Ps.lights,{emissive:{value:new ui(0)}}]),vertexShader:Ms.meshlambert_vert,fragmentShader:Ms.meshlambert_frag},phong:{uniforms:hs([Ps.common,Ps.specularmap,Ps.envmap,Ps.aomap,Ps.lightmap,Ps.emissivemap,Ps.bumpmap,Ps.normalmap,Ps.displacementmap,Ps.fog,Ps.lights,{emissive:{value:new ui(0)},specular:{value:new ui(1118481)},shininess:{value:30}}]),vertexShader:Ms.meshphong_vert,fragmentShader:Ms.meshphong_frag},standard:{uniforms:hs([Ps.common,Ps.envmap,Ps.aomap,Ps.lightmap,Ps.emissivemap,Ps.bumpmap,Ps.normalmap,Ps.displacementmap,Ps.roughnessmap,Ps.metalnessmap,Ps.fog,Ps.lights,{emissive:{value:new ui(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ms.meshphysical_vert,fragmentShader:Ms.meshphysical_frag},toon:{uniforms:hs([Ps.common,Ps.aomap,Ps.lightmap,Ps.emissivemap,Ps.bumpmap,Ps.normalmap,Ps.displacementmap,Ps.gradientmap,Ps.fog,Ps.lights,{emissive:{value:new ui(0)}}]),vertexShader:Ms.meshtoon_vert,fragmentShader:Ms.meshtoon_frag},matcap:{uniforms:hs([Ps.common,Ps.bumpmap,Ps.normalmap,Ps.displacementmap,Ps.fog,{matcap:{value:null}}]),vertexShader:Ms.meshmatcap_vert,fragmentShader:Ms.meshmatcap_frag},points:{uniforms:hs([Ps.points,Ps.fog]),vertexShader:Ms.points_vert,fragmentShader:Ms.points_frag},dashed:{uniforms:hs([Ps.common,Ps.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ms.linedashed_vert,fragmentShader:Ms.linedashed_frag},depth:{uniforms:hs([Ps.common,Ps.displacementmap]),vertexShader:Ms.depth_vert,fragmentShader:Ms.depth_frag},normal:{uniforms:hs([Ps.common,Ps.bumpmap,Ps.normalmap,Ps.displacementmap,{opacity:{value:1}}]),vertexShader:Ms.normal_vert,fragmentShader:Ms.normal_frag},sprite:{uniforms:hs([Ps.sprite,Ps.fog]),vertexShader:Ms.sprite_vert,fragmentShader:Ms.sprite_frag},background:{uniforms:{uvTransform:{value:new Ne},t2D:{value:null}},vertexShader:Ms.background_vert,fragmentShader:Ms.background_frag},cube:{uniforms:hs([Ps.envmap,{opacity:{value:1}}]),vertexShader:Ms.cube_vert,fragmentShader:Ms.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ms.equirect_vert,fragmentShader:Ms.equirect_frag},distanceRGBA:{uniforms:hs([Ps.common,Ps.displacementmap,{referencePosition:{value:new We},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ms.distanceRGBA_vert,fragmentShader:Ms.distanceRGBA_frag},shadow:{uniforms:hs([Ps.lights,Ps.fog,{color:{value:new ui(0)},opacity:{value:1}}]),vertexShader:Ms.shadow_vert,fragmentShader:Ms.shadow_frag}};function Os(e,t,i,o,r){const a=new ui(0);let l,c,h=0,d=null,u=0,p=null;function m(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),h=t,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,m(a,h)},render:function(i,r,g,f){let v=!0===r.isScene?r.background:null;v&&v.isTexture&&(v=t.get(v));const y=e.xr,b=y.getSession&&y.getSession();b&&"additive"===b.environmentBlendMode&&(v=null),null===v?m(a,h):v&&v.isColor&&(m(v,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||306===v.mapping)?(void 0===c&&(c=new os(new ls(1,1,1),new us({name:"BackgroundCubeMaterial",uniforms:cs(As.cube.uniforms),vertexShader:As.cube.vertexShader,fragmentShader:As.cube.fragmentShader,side:n,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(c)),v.isWebGLCubeRenderTarget&&(v=v.texture),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,d===v&&u===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=v,u=v.version,p=e.toneMapping),i.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new os(new xs(2,2),new us({name:"BackgroundMaterial",uniforms:cs(As.background.uniforms),vertexShader:As.background.vertexShader,fragmentShader:As.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(l)),l.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&u===v.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=v,u=v.version,p=e.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null))}}}function Ds(e,t,i,s){const n=e.getParameter(34921),o=s.isWebGL2?null:t.get("OES_vertex_array_object"),r=s.isWebGL2||null!==o,a={},l=u(null);let c=l;function h(t){return s.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function d(t){return s.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function u(e){const t=[],i=[],s=[];for(let e=0;e<n;e++)t[e]=0,i[e]=0,s[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:s,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,n){const o=c.newAttributes,r=c.enabledAttributes,a=c.attributeDivisors;o[i]=1,0===r[i]&&(e.enableVertexAttribArray(i),r[i]=1),a[i]!==n&&((s.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),a[i]=n)}function f(){const t=c.newAttributes,i=c.enabledAttributes;for(let s=0,n=i.length;s<n;s++)i[s]!==t[s]&&(e.disableVertexAttribArray(s),i[s]=0)}function v(t,i,n,o,r,a){!0!==s.isWebGL2||5124!==n&&5125!==n?e.vertexAttribPointer(t,i,n,o,r,a):e.vertexAttribIPointer(t,i,n,r,a)}function y(){b(),c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,d,y,b){let w=!1;if(r){const t=function(t,i,n){const r=!0===n.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[r];return void 0===h&&(h=u(s.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[r]=h),h}(y,d,l);c!==t&&(c=t,h(c.object)),w=function(e,t){const i=c.attributes,s=e.attributes;let n=0;for(const e in s){const t=i[e],o=s[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;n++}return c.attributesNum!==n||c.index!==t}(y,b),w&&function(e,t){const i={},s=e.attributes;let n=0;for(const e in s){const t=s[e],o={};o.attribute=t,t.data&&(o.data=t.data),i[e]=o,n++}c.attributes=i,c.attributesNum=n,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,w=!0)}!0===n.isInstancedMesh&&(w=!0),null!==b&&i.update(b,34963),w&&(function(n,o,r,a){if(!1===s.isWebGL2&&(n.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=r.getAttributes(),h=o.defaultAttributeValues;for(const t in c){const s=c[t];if(s>=0){const o=l[t];if(void 0!==o){const t=o.normalized,n=o.itemSize,r=i.get(o);if(void 0===r)continue;const l=r.buffer,c=r.type,h=r.bytesPerElement;if(o.isInterleavedBufferAttribute){const i=o.data,r=i.stride,d=o.offset;i&&i.isInstancedInterleavedBuffer?(g(s,i.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)):m(s),e.bindBuffer(34962,l),v(s,n,c,t,r*h,d*h)}else o.isInstancedBufferAttribute?(g(s,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):m(s),e.bindBuffer(34962,l),v(s,n,c,t,0,0)}else if("instanceMatrix"===t){const t=i.get(n.instanceMatrix);if(void 0===t)continue;const o=t.buffer,r=t.type;g(s+0,1),g(s+1,1),g(s+2,1),g(s+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(s+0,4,r,!1,64,0),e.vertexAttribPointer(s+1,4,r,!1,64,16),e.vertexAttribPointer(s+2,4,r,!1,64,32),e.vertexAttribPointer(s+3,4,r,!1,64,48)}else if("instanceColor"===t){const t=i.get(n.instanceColor);if(void 0===t)continue;const o=t.buffer,r=t.type;g(s,1),e.bindBuffer(34962,o),e.vertexAttribPointer(s,3,r,!1,12,0)}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(s,i);break;case 3:e.vertexAttrib3fv(s,i);break;case 4:e.vertexAttrib4fv(s,i);break;default:e.vertexAttrib1fv(s,i)}}}}f()}(n,l,d,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const s=i[e.id];for(const e in s)d(s[e].object),delete s[e];delete i[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:f}}function Is(e,t,i,s){const n=s.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,s){e.drawArrays(o,t,s),i.update(s,o,1)},this.renderInstances=function(s,r,a){if(0===a)return;let l,c;if(n)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,s,r,a),i.update(r,o,a)}}function Cs(e,t,i){let s;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let r=void 0!==i.precision?i.precision:"highp";const a=n(r);a!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",a,"instead."),r=a);const l=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),u=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),f=e.getParameter(36349),v=h>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==s)return s;const i=t.get("EXT_texture_filter_anisotropic");return s=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,s},getMaxPrecision:n,precision:r,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:u,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:f,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function Rs(e){const t=this;let i=null,s=0,n=!1,o=!1;const r=new Kt,a=new Ne,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=s>0),t.numPlanes=s,t.numIntersection=0}function h(e,i,s,n){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==n||null===c){const t=s+4*o,n=i.matrixWorldInverse;a.getNormalMatrix(n),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=s;t!==o;++t,i+=4)r.copy(e[t]).applyMatrix4(n,a),r.normal.toArray(c,i),c[i+3]=r.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const r=0!==e.length||t||0!==s||n;return n=t,i=h(e,o,0),s=e.length,r},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,r,a){const d=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(!n||null===d||0===d.length||o&&!p)o?h(null):c();else{const e=o?0:s,t=4*e;let n=m.clippingState||null;l.value=n,n=h(d,r,t,a);for(let e=0;e!==t;++e)n[e]=i[e];m.clippingState=n,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function Ls(e){let t=new WeakMap;function i(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function s(e){const i=e.target;i.removeEventListener("dispose",s);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture){const o=n.mapping;if(303===o||304===o){if(t.has(n))return i(t.get(n).texture,n.mapping);{const o=n.image;if(o&&o.height>0){const r=e.getRenderList(),a=e.getRenderTarget(),l=new ys(o.height/2);return l.fromEquirectangularTexture(e,n),t.set(n,l),e.setRenderTarget(a),e.setRenderList(r),n.addEventListener("dispose",s),i(l.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}function Ns(e){const t={};return{has:function(i){if(void 0!==t[i])return null!==t[i];let s;switch(i){case"WEBGL_depth_texture":s=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=e.getExtension(i)}return t[i]=s,null!==s},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function ks(e,t,i,s){const n=new WeakMap,o=new WeakMap;function r(e){const a=e.target,l=n.get(a);null!==l.index&&t.remove(l.index);for(const e in l.attributes)t.remove(l.attributes[e]);a.removeEventListener("dispose",r),n.delete(a);const c=o.get(l);c&&(t.remove(c),o.delete(l)),s.releaseStatesOfGeometry(l),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],s=e.index,n=e.attributes.position;let r=0;if(null!==s){const e=s.array;r=s.version;for(let t=0,s=e.length;t<s;t+=3){const s=e[t+0],n=e[t+1],o=e[t+2];i.push(s,n,n,o,o,s)}}else{const e=n.array;r=n.version;for(let t=0,s=e.length/3-1;t<s;t+=3){const e=t+0,s=t+1,n=t+2;i.push(e,s,s,n,n,e)}}const a=new(Ii(i)>65535?Mi:_i)(i,1);a.version=r;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){let s=n.get(t);return s||(t.addEventListener("dispose",r),t.isBufferGeometry?s=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Gi).setFromObject(e)),s=t._bufferGeometry),n.set(t,s),i.memory.geometries++,s)},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const s=e.morphAttributes;for(const e in s){const i=s[e];for(let e=0,s=i.length;e<s;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return o.get(e)}}}function Fs(e,t,i,s){const n=s.isWebGL2;let o,r,a;this.setMode=function(e){o=e},this.setIndex=function(e){r=e.type,a=e.bytesPerElement},this.render=function(t,s){e.drawElements(o,s,r,t*a),i.update(s,o,1)},this.renderInstances=function(s,l,c){if(0===c)return;let h,d;if(n)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](o,l,r,s*a,c),i.update(l,o,c)}}function Bs(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,s){switch(t.calls++,i){case 4:t.triangles+=s*(e/3);break;case 1:t.lines+=s*(e/2);break;case 3:t.lines+=s*(e-1);break;case 2:t.lines+=s*e;break;case 0:t.points+=s*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Us(e,t){return e[0]-t[0]}function Hs(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Gs(e){const t={},i=new Float32Array(8),s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(n,o,r,a){const l=n.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[o.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[o.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(Hs);for(let e=0;e<8;e++)e<c&&h[e][1]?(s[e][0]=h[e][0],s[e][1]=h[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(Us);const d=r.morphTargets&&o.morphAttributes.position,u=r.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=s[e],n=t[0],r=t[1];n!==Number.MAX_SAFE_INTEGER&&r?(d&&o.getAttribute("morphTarget"+e)!==d[n]&&o.setAttribute("morphTarget"+e,d[n]),u&&o.getAttribute("morphNormal"+e)!==u[n]&&o.setAttribute("morphNormal"+e,u[n]),i[e]=r,p+=r):(d&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),u&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),i[e]=0)}const m=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",m),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function Vs(e,t,i,s){let n=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const r=s.render.frame,a=e.geometry,l=t.get(e,a);return n.get(l)!==r&&(a.isGeometry&&l.updateFromObject(e),t.update(l),n.set(l,r)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}function zs(e=null,t=1,i=1,s=1){Ue.call(this,null),this.image={data:e,width:t,height:i,depth:s},this.magFilter=P,this.minFilter=P,this.wrapR=x,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function js(e=null,t=1,i=1,s=1){Ue.call(this,null),this.image={data:e,width:t,height:i,depth:s},this.magFilter=P,this.minFilter=P,this.wrapR=x,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}As.physical={uniforms:hs([As.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Le(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ui(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Ms.meshphysical_vert,fragmentShader:Ms.meshphysical_frag},zs.prototype=Object.create(Ue.prototype),zs.prototype.constructor=zs,zs.prototype.isDataTexture2DArray=!0,js.prototype=Object.create(Ue.prototype),js.prototype.constructor=js,js.prototype.isDataTexture3D=!0;const Ws=new Ue,Zs=new zs,qs=new js,Ks=new vs,Ys=[],$s=[],Qs=new Float32Array(16),Xs=new Float32Array(9),Js=new Float32Array(4);function en(e,t,i){const s=e[0];if(s<=0||s>0)return e;const n=t*i;let o=Ys[n];if(void 0===o&&(o=new Float32Array(n),Ys[n]=o),0!==t){s.toArray(o,0);for(let s=1,n=0;s!==t;++s)n+=i,e[s].toArray(o,n)}return o}function tn(e,t){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(e[i]!==t[i])return!1;return!0}function sn(e,t){for(let i=0,s=t.length;i<s;i++)e[i]=t[i]}function nn(e,t){let i=$s[t];void 0===i&&(i=new Int32Array(t),$s[t]=i);for(let s=0;s!==t;++s)i[s]=e.allocateTextureUnit();return i}function on(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function rn(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(tn(i,t))return;e.uniform2fv(this.addr,t),sn(i,t)}}function an(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(tn(i,t))return;e.uniform3fv(this.addr,t),sn(i,t)}}function ln(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(tn(i,t))return;e.uniform4fv(this.addr,t),sn(i,t)}}function cn(e,t){const i=this.cache,s=t.elements;if(void 0===s){if(tn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),sn(i,t)}else{if(tn(i,s))return;Js.set(s),e.uniformMatrix2fv(this.addr,!1,Js),sn(i,s)}}function hn(e,t){const i=this.cache,s=t.elements;if(void 0===s){if(tn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),sn(i,t)}else{if(tn(i,s))return;Xs.set(s),e.uniformMatrix3fv(this.addr,!1,Xs),sn(i,s)}}function dn(e,t){const i=this.cache,s=t.elements;if(void 0===s){if(tn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),sn(i,t)}else{if(tn(i,s))return;Qs.set(s),e.uniformMatrix4fv(this.addr,!1,Qs),sn(i,s)}}function un(e,t,i){const s=this.cache,n=i.allocateTextureUnit();s[0]!==n&&(e.uniform1i(this.addr,n),s[0]=n),i.safeSetTexture2D(t||Ws,n)}function pn(e,t,i){const s=this.cache,n=i.allocateTextureUnit();s[0]!==n&&(e.uniform1i(this.addr,n),s[0]=n),i.setTexture2DArray(t||Zs,n)}function mn(e,t,i){const s=this.cache,n=i.allocateTextureUnit();s[0]!==n&&(e.uniform1i(this.addr,n),s[0]=n),i.setTexture3D(t||qs,n)}function gn(e,t,i){const s=this.cache,n=i.allocateTextureUnit();s[0]!==n&&(e.uniform1i(this.addr,n),s[0]=n),i.safeSetTextureCube(t||Ks,n)}function fn(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function vn(e,t){const i=this.cache;tn(i,t)||(e.uniform2iv(this.addr,t),sn(i,t))}function yn(e,t){const i=this.cache;tn(i,t)||(e.uniform3iv(this.addr,t),sn(i,t))}function bn(e,t){const i=this.cache;tn(i,t)||(e.uniform4iv(this.addr,t),sn(i,t))}function wn(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Sn(e,t){e.uniform1fv(this.addr,t)}function Tn(e,t){e.uniform1iv(this.addr,t)}function En(e,t){e.uniform2iv(this.addr,t)}function _n(e,t){e.uniform3iv(this.addr,t)}function xn(e,t){e.uniform4iv(this.addr,t)}function Mn(e,t){const i=en(t,this.size,2);e.uniform2fv(this.addr,i)}function Pn(e,t){const i=en(t,this.size,3);e.uniform3fv(this.addr,i)}function An(e,t){const i=en(t,this.size,4);e.uniform4fv(this.addr,i)}function On(e,t){const i=en(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Dn(e,t){const i=en(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function In(e,t){const i=en(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Cn(e,t,i){const s=t.length,n=nn(i,s);e.uniform1iv(this.addr,n);for(let e=0;e!==s;++e)i.safeSetTexture2D(t[e]||Ws,n[e])}function Rn(e,t,i){const s=t.length,n=nn(i,s);e.uniform1iv(this.addr,n);for(let e=0;e!==s;++e)i.safeSetTextureCube(t[e]||Ks,n[e])}function Ln(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return on;case 35664:return rn;case 35665:return an;case 35666:return ln;case 35674:return cn;case 35675:return hn;case 35676:return dn;case 5124:case 35670:return fn;case 35667:case 35671:return vn;case 35668:case 35672:return yn;case 35669:case 35673:return bn;case 5125:return wn;case 35678:case 36198:case 36298:case 36306:case 35682:return un;case 35679:case 36299:case 36307:return mn;case 35680:case 36300:case 36308:case 36293:return gn;case 36289:case 36303:case 36311:case 36292:return pn}}(t.type)}function Nn(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Sn;case 35664:return Mn;case 35665:return Pn;case 35666:return An;case 35674:return On;case 35675:return Dn;case 35676:return In;case 5124:case 35670:return Tn;case 35667:case 35671:return En;case 35668:case 35672:return _n;case 35669:case 35673:return xn;case 35678:case 36198:case 36298:case 36306:case 35682:return Cn;case 35680:case 36300:case 36308:case 36293:return Rn}}(t.type)}function kn(e){this.id=e,this.seq=[],this.map={}}Nn.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),sn(t,e)},kn.prototype.setValue=function(e,t,i){const s=this.seq;for(let n=0,o=s.length;n!==o;++n){const o=s[n];o.setValue(e,t[o.id],i)}};const Fn=/(\w+)(\])?(\[|\.)?/g;function Bn(e,t){e.seq.push(t),e.map[t.id]=t}function Un(e,t,i){const s=e.name,n=s.length;for(Fn.lastIndex=0;;){const o=Fn.exec(s),r=Fn.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&r+2===n){Bn(i,void 0===c?new Ln(a,e,t):new Nn(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new kn(a),Bn(i,e)),i=e}}}function Hn(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let s=0;s<i;++s){const i=e.getActiveUniform(t,s);Un(i,e.getUniformLocation(t,i.name),this)}}function Gn(e,t,i){const s=e.createShader(t);return e.shaderSource(s,i),e.compileShader(s),s}Hn.prototype.setValue=function(e,t,i,s){const n=this.map[t];void 0!==n&&n.setValue(e,i,s)},Hn.prototype.setOptional=function(e,t,i){const s=t[i];void 0!==s&&this.setValue(e,i,s)},Hn.upload=function(e,t,i,s){for(let n=0,o=t.length;n!==o;++n){const o=t[n],r=i[o.id];!1!==r.needsUpdate&&o.setValue(e,r.value,s)}},Hn.seqWithValue=function(e,t){const i=[];for(let s=0,n=e.length;s!==n;++s){const n=e[s];n.id in t&&i.push(n)}return i};let Vn=0;function zn(e){switch(e){case we:return["Linear","( value )"];case Se:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function jn(e,t,i){const s=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return s&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Wn(e,t){const i=zn(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Zn(e,t){const i=zn(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function qn(e,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Kn(e){return""!==e}function Yn(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function $n(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Qn=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xn(e){return e.replace(Qn,Jn)}function Jn(e,t){const i=Ms[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Xn(i)}const eo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,to=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function io(e){return e.replace(to,no).replace(eo,so)}function so(e,t,i,s){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),no(0,t,i,s)}function no(e,t,i,s){let n="";for(let e=parseInt(t);e<parseInt(i);e++)n+=s.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function oo(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ro(e,t,i,s){const n=e.getContext(),o=i.defines;let r=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(i),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),u=e.gammaFactor>0?e.gammaFactor:1,p=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Kn).join("\n")}(i),m=function(e){const t=[];for(const i in e){const s=e[i];!1!==s&&t.push("#define "+i+" "+s)}return t.join("\n")}(o),g=n.createProgram();let f,v,y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(f=[m].filter(Kn).join("\n"),f.length>0&&(f+="\n"),v=[p,m].filter(Kn).join("\n"),v.length>0&&(v+="\n")):(f=[oo(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+u,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Kn).join("\n"),v=[p,oo(i),"#define SHADER_NAME "+i.shaderName,m,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+u,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Ms.tonemapping_pars_fragment:"",0!==i.toneMapping?qn("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Ms.encodings_pars_fragment,i.map?Wn("mapTexelToLinear",i.mapEncoding):"",i.matcap?Wn("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Wn("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Wn("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?Wn("lightMapTexelToLinear",i.lightMapEncoding):"",Zn("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Kn).join("\n")),r=Xn(r),r=Yn(r,i),r=$n(r,i),a=Xn(a),a=Yn(a,i),a=$n(a,i),r=io(r),a=io(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",f=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+f,v=["#define varying in",i.glslVersion===Oe?"":"out highp vec4 pc_fragColor;",i.glslVersion===Oe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+v+a,w=Gn(n,35633,y+f+r),S=Gn(n,35632,b);if(n.attachShader(g,w),n.attachShader(g,S),void 0!==i.index0AttributeName?n.bindAttribLocation(g,0,i.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),e.debug.checkShaderErrors){const e=n.getProgramInfoLog(g).trim(),t=n.getShaderInfoLog(w).trim(),i=n.getShaderInfoLog(S).trim();let s=!0,o=!0;if(!1===n.getProgramParameter(g,35714)){s=!1;const t=jn(n,w,"vertex"),i=jn(n,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",n.getError(),"35715",n.getProgramParameter(g,35715),"gl.getProgramInfoLog",e,t,i)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==i||(o=!1);o&&(this.diagnostics={runnable:s,programLog:e,vertexShader:{log:t,prefix:f},fragmentShader:{log:i,prefix:v}})}let T,E;return n.deleteShader(w),n.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new Hn(n,g)),T},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const i={},s=e.getProgramParameter(t,35721);for(let n=0;n<s;n++){const s=e.getActiveAttrib(t,n).name;i[s]=e.getAttribLocation(t,s)}return i}(n,g)),E},this.destroy=function(){s.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=Vn++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}function ao(e,t,i,s,r,a){const l=[],c=s.isWebGL2,h=s.logarithmicDepthBuffer,d=s.floatVertexTextures,u=s.maxVertexUniforms,p=s.vertexTextures;let m=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=we,t}return{getParameters:function(r,l,f,y,b){const w=y.fog,S=r.isMeshStandardMaterial?y.environment:null,T=t.get(r.envMap||S),E=g[r.type],_=b.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(d)return 1024;{const e=u,i=Math.floor((e-20)/4),s=Math.min(i,t.length);return s<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+s+"."),0):s}}(b):0;let x,M;if(null!==r.precision&&(m=s.getMaxPrecision(r.precision),m!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",m,"instead.")),E){const e=As[E];x=e.vertexShader,M=e.fragmentShader}else x=r.vertexShader,M=r.fragmentShader;const P=e.getRenderTarget();return{isWebGL2:c,shaderID:E,shaderName:r.type,vertexShader:x,fragmentShader:M,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:m,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:p,outputEncoding:null!==P?v(P.texture):e.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!T,envMapMode:T&&T.mapping,envMapEncoding:v(T),envMapCubeUV:!!T&&(306===T.mapping||307===T.mapping),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:r.normalMapType===Te,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!w,useFog:r.fog,fogExp2:w&&w.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:h,skinning:r.skinning&&_>0,maxBones:_,useVertexTexture:d,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===o,flipSided:r.side===n,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)i.push(t[f[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=g[e.type];let i;if(t){const e=As[t];i=ds.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let s;for(let e=0,t=l.length;e<t;e++){const t=l[e];if(t.cacheKey===i){s=t,++s.usedTimes;break}}return void 0===s&&(s=new ro(e,i,t,r),l.push(s)),s},releaseProgram:function(e){if(0==--e.usedTimes){const t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},programs:l}}function lo(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,s){e.get(t)[i]=s},dispose:function(){e=new WeakMap}}}function co(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ho(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function uo(e){const t=[];let i=0;const s=[],n=[],o={id:-1};function r(s,n,r,a,l,c){let h=t[i];const d=e.get(r);return void 0===h?(h={id:s.id,object:s,geometry:n,material:r,program:d.program||o,groupOrder:a,renderOrder:s.renderOrder,z:l,group:c},t[i]=h):(h.id=s.id,h.object=s,h.geometry=n,h.material=r,h.program=d.program||o,h.groupOrder=a,h.renderOrder=s.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:s,transparent:n,init:function(){i=0,s.length=0,n.length=0},push:function(e,t,i,o,a,l){const c=r(e,t,i,o,a,l);(!0===i.transparent?n:s).push(c)},unshift:function(e,t,i,o,a,l){const c=r(e,t,i,o,a,l);(!0===i.transparent?n:s).unshift(c)},finish:function(){for(let e=i,s=t.length;e<s;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){s.length>1&&s.sort(e||co),n.length>1&&n.sort(t||ho)}}}function po(e){let t=new WeakMap;return{get:function(i,s){const n=t.get(i);let o;return void 0===n?(o=new uo(e),t.set(i,new WeakMap),t.get(i).set(s,o)):(o=n.get(s),void 0===o&&(o=new uo(e),n.set(s,o))),o},dispose:function(){t=new WeakMap}}}function mo(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new We,color:new ui};break;case"SpotLight":i={position:new We,direction:new We,color:new ui,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new We,color:new ui,distance:0,decay:0};break;case"HemisphereLight":i={direction:new We,skyColor:new ui,groundColor:new ui};break;case"RectAreaLight":i={color:new ui,position:new We,halfWidth:new We,halfHeight:new We}}return e[t.id]=i,i}}}let go=0;function fo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function vo(e,t){const i=new mo,s=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Le};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Le,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)n.probe.push(new We);const o=new We,r=new bt,a=new bt;return{setup:function(o){let r=0,a=0,l=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let c=0,h=0,d=0,u=0,p=0,m=0,g=0,f=0;o.sort(fo);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,b=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)r+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=s.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[c]=i,n.directionalShadowMap[c]=w,n.directionalShadowMatrix[c]=t.shadow.matrix,m++}n.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=s.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.spotShadow[d]=i,n.spotShadowMap[d]=w,n.spotShadowMatrix[d]=t.shadow.matrix,f++}n.spot[d]=e,d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[u]=e,u++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=s.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[h]=i,n.pointShadowMap[h]=w,n.pointShadowMatrix[h]=t.shadow.matrix,g++}n.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),n.hemi[p]=e,p++}}u>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=Ps.LTC_FLOAT_1,n.rectAreaLTC2=Ps.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=Ps.LTC_HALF_1,n.rectAreaLTC2=Ps.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=r,n.ambient[1]=a,n.ambient[2]=l;const v=n.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===d&&v.rectAreaLength===u&&v.hemiLength===p&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===f||(n.directional.length=c,n.spot.length=d,n.rectArea.length=u,n.point.length=h,n.hemi.length=p,n.directionalShadow.length=m,n.directionalShadowMap.length=m,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=f,n.spotShadowMap.length=f,n.directionalShadowMatrix.length=m,n.pointShadowMatrix.length=g,n.spotShadowMatrix.length=f,v.directionalLength=c,v.pointLength=h,v.spotLength=d,v.rectAreaLength=u,v.hemiLength=p,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=f,n.version=go++)},setupView:function(e,t){let i=0,s=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){const u=e[t];if(u.isDirectionalLight){const e=n.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),i++}else if(u.isSpotLight){const e=n.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const e=n.rectArea[c];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),a.identity(),r.copy(u.matrixWorld),r.premultiply(d),a.extractRotation(r),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(u.isPointLight){const e=n.point[s];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),s++}else if(u.isHemisphereLight){const e=n.hemi[h];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(d),e.direction.normalize(),h++}}},state:n}}function yo(e,t){const i=new vo(e,t),s=[],n=[];return{init:function(){s.length=0,n.length=0},state:{lightsArray:s,shadowsArray:n,lights:i},setupLights:function(){i.setup(s)},setupLightsView:function(e){i.setupView(s,e)},pushLight:function(e){s.push(e)},pushShadow:function(e){n.push(e)}}}function bo(e,t){let i=new WeakMap;return{get:function(s,n=0){let o;return!1===i.has(s)?(o=new yo(e,t),i.set(s,[]),i.get(s).push(o)):n>=i.get(s).length?(o=new yo(e,t),i.get(s).push(o)):o=i.get(s)[n],o},dispose:function(){i=new WeakMap}}}function wo(e){gi.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function So(e){gi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new We,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function To(e,t,i){let a=new Ts;const l=new Le,c=new Le,h=new Ge,d=[],u=[],p={},m={0:n,1:s,2:o},g=new us({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Le},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=g.clone();f.defines.HORIZONTAL_PASS=1;const v=new Gi;v.setAttribute("position",new bi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new os(v,g),b=this;function w(i,s){const n=t.update(y);g.uniforms.shadow_pass.value=i.map.texture,g.uniforms.resolution.value=i.mapSize,g.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(s,null,n,g,y,null),f.uniforms.shadow_pass.value=i.mapPass.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(s,null,n,f,y,null)}function S(e,t,i){const s=e<<0|t<<1|i<<2;let n=d[s];return void 0===n&&(n=new wo({depthPacking:3201,morphTargets:e,skinning:t}),d[s]=n),n}function T(e,t,i){const s=e<<0|t<<1|i<<2;let n=u[s];return void 0===n&&(n=new So({morphTargets:e,skinning:t}),u[s]=n),n}function E(t,i,s,n,o,r,a){let l=null,c=S,h=t.customDepthMaterial;if(!0===n.isPointLight&&(c=T,h=t.customDistanceMaterial),void 0===h){let e=!1;!0===s.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let n=!1;!0===t.isSkinnedMesh&&(!0===s.skinning?n=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=c(e,n,!0===t.isInstancedMesh)}else l=h;if(e.localClippingEnabled&&!0===s.clipShadows&&0!==s.clippingPlanes.length){const e=l.uuid,t=s.uuid;let i=p[e];void 0===i&&(i={},p[e]=i);let n=i[t];void 0===n&&(n=l.clone(),i[t]=n),l=n}return l.visible=s.visible,l.wireframe=s.wireframe,l.side=3===a?null!==s.shadowSide?s.shadowSide:s.side:null!==s.shadowSide?s.shadowSide:m[s.side],l.clipShadows=s.clipShadows,l.clippingPlanes=s.clippingPlanes,l.clipIntersection=s.clipIntersection,l.wireframeLinewidth=s.wireframeLinewidth,l.linewidth=s.linewidth,!0===n.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(n.matrixWorld),l.nearDistance=o,l.farDistance=r),l}function _(i,s,n,o,r){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===r)&&(!i.frustumCulled||a.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld);const s=t.update(i),a=i.material;if(Array.isArray(a)){const t=s.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=a[c.materialIndex];if(h&&h.visible){const t=E(i,s,h,o,n.near,n.far,r);e.renderBufferDirect(n,null,s,t,i,c)}}}else if(a.visible){const t=E(i,s,a,o,n.near,n.far,r);e.renderBufferDirect(n,null,s,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)_(l[e],s,n,o,r)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,n){if(!1===b.enabled)return;if(!1===b.autoUpdate&&!1===b.needsUpdate)return;if(0===t.length)return;const o=e.getRenderTarget(),d=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),p=e.state;p.setBlending(r),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let o=0,r=t.length;o<r;o++){const r=t[o],d=r.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",r,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;l.copy(d.mapSize);const u=d.getFrameExtents();if(l.multiply(u),c.copy(d.mapSize),(l.x>i||l.y>i)&&(l.x>i&&(c.x=Math.floor(i/u.x),l.x=c.x*u.x,d.mapSize.x=c.x),l.y>i&&(c.y=Math.floor(i/u.y),l.y=c.y*u.y,d.mapSize.y=c.y)),null===d.map&&!d.isPointLightShadow&&3===this.type){const e={minFilter:C,magFilter:C,format:Q};d.map=new Ve(l.x,l.y,e),d.map.texture.name=r.name+".shadowMap",d.mapPass=new Ve(l.x,l.y,e),d.camera.updateProjectionMatrix()}if(null===d.map){const e={minFilter:P,magFilter:P,format:Q};d.map=new Ve(l.x,l.y,e),d.map.texture.name=r.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const m=d.getViewportCount();for(let e=0;e<m;e++){const t=d.getViewport(e);h.set(c.x*t.x,c.y*t.y,c.x*t.z,c.y*t.w),p.viewport(h),d.updateMatrices(r,e),a=d.getFrustum(),_(s,n,d.camera,r,this.type)}d.isPointLightShadow||3!==this.type||w(d,n),d.needsUpdate=!1}b.needsUpdate=!1,e.setRenderTarget(o,d,u)}}function Eo(e,t,i){const s=i.isWebGL2,_=new function(){let t=!1;const i=new Ge;let s=null;const n=new Ge(0,0,0,0);return{setMask:function(i){s===i||t||(e.colorMask(i,i,i,i),s=i)},setLocked:function(e){t=e},setClear:function(t,s,o,r,a){!0===a&&(t*=r,s*=r,o*=r),i.set(t,s,o,r),!1===n.equals(i)&&(e.clearColor(t,s,o,r),n.copy(i))},reset:function(){t=!1,s=null,n.set(-1,0,0,0)}}},x=new function(){let t=!1,i=null,s=null,n=null;return{setTest:function(e){e?J(2929):ee(2929)},setMask:function(s){i===s||t||(e.depthMask(s),i=s)},setFunc:function(t){if(s!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);s=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,s=null,n=null}}},M=new function(){let t=!1,i=null,s=null,n=null,o=null,r=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?J(2960):ee(2960))},setMask:function(s){i===s||t||(e.stencilMask(s),i=s)},setFunc:function(t,i,r){s===t&&n===i&&o===r||(e.stencilFunc(t,i,r),s=t,n=i,o=r)},setOp:function(t,i,s){r===t&&a===i&&l===s||(e.stencilOp(t,i,s),r=t,a=i,l=s)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,s=null,n=null,o=null,r=null,a=null,l=null,c=null}}};let P={},A=null,O=null,D=null,I=null,C=null,R=null,L=null,N=null,k=null,F=!1,B=null,U=null,H=null,G=null,V=null;const z=e.getParameter(35661);let j=!1,W=0;const Z=e.getParameter(7938);-1!==Z.indexOf("WebGL")?(W=parseFloat(/^WebGL (\d)/.exec(Z)[1]),j=W>=1):-1!==Z.indexOf("OpenGL ES")&&(W=parseFloat(/^OpenGL ES (\d)/.exec(Z)[1]),j=W>=2);let q=null,K={};const Y=new Ge,$=new Ge;function Q(t,i,s){const n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<s;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,n);return o}const X={};function J(t){!0!==P[t]&&(e.enable(t),P[t]=!0)}function ee(t){!1!==P[t]&&(e.disable(t),P[t]=!1)}X[3553]=Q(3553,3553,1),X[34067]=Q(34067,34069,6),_.setClear(0,0,0,1),x.setClear(1),M.setClear(0),J(2929),x.setFunc(3),ne(!1),oe(1),J(2884),se(r);const te={[l]:32774,[c]:32778,[h]:32779};if(s)te[d]=32775,te[u]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(te[d]=e.MIN_EXT,te[u]=e.MAX_EXT)}const ie={[p]:0,[m]:1,[g]:768,[v]:770,[E]:776,[S]:774,[b]:772,[f]:769,[y]:771,[T]:775,[w]:773};function se(t,i,s,n,o,c,h,d){if(t!==r){if(O||(J(3042),O=!0),5===t)o=o||i,c=c||s,h=h||n,i===I&&o===L||(e.blendEquationSeparate(te[i],te[o]),I=i,L=o),s===C&&n===R&&c===N&&h===k||(e.blendFuncSeparate(ie[s],ie[n],ie[c],ie[h]),C=s,R=n,N=c,k=h),D=t,F=null;else if(t!==D||d!==F){if(I===l&&L===l||(e.blendEquation(32774),I=l,L=l),d)switch(t){case a:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case a:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}C=null,R=null,N=null,k=null,D=t,F=d}}else O&&(ee(3042),O=!1)}function ne(t){B!==t&&(t?e.frontFace(2304):e.frontFace(2305),B=t)}function oe(t){0!==t?(J(2884),t!==U&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):ee(2884),U=t}function re(t,i,s){t?(J(32823),G===i&&V===s||(e.polygonOffset(i,s),G=i,V=s)):ee(32823)}function ae(t){void 0===t&&(t=33984+z-1),q!==t&&(e.activeTexture(t),q=t)}return{buffers:{color:_,depth:x,stencil:M},enable:J,disable:ee,useProgram:function(t){return A!==t&&(e.useProgram(t),A=t,!0)},setBlending:se,setMaterial:function(e,t){e.side===o?ee(2884):J(2884);let i=e.side===n;t&&(i=!i),ne(i),e.blending===a&&!1===e.transparent?se(r):se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),x.setFunc(e.depthFunc),x.setTest(e.depthTest),x.setMask(e.depthWrite),_.setMask(e.colorWrite);const s=e.stencilWrite;M.setTest(s),s&&(M.setMask(e.stencilWriteMask),M.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),M.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),re(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:ne,setCullFace:oe,setLineWidth:function(t){t!==H&&(j&&e.lineWidth(t),H=t)},setPolygonOffset:re,setScissorTest:function(e){e?J(3089):ee(3089)},activeTexture:ae,bindTexture:function(t,i){null===q&&ae();let s=K[q];void 0===s&&(s={type:void 0,texture:void 0},K[q]=s),s.type===t&&s.texture===i||(e.bindTexture(t,i||X[t]),s.type=t,s.texture=i)},unbindTexture:function(){const t=K[q];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===Y.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),Y.copy(t))},viewport:function(t){!1===$.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),$.copy(t))},reset:function(){P={},q=null,K={},A=null,O=null,D=null,I=null,C=null,R=null,L=null,N=null,k=null,F=!1,B=null,U=null,H=null,G=null,V=null,_.reset(),x.reset(),M.reset()}}}function _o(e,t,i,s,n,o,r){const a=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,d=n.maxSamples,u=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function f(e,t,i,s){let n=1;if((e.width>s||e.height>s)&&(n=s/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const s=t?Re.floorPowerOfTwo:Math.floor,o=s(n*e.width),r=s(n*e.height);void 0===p&&(p=g(o,r));const a=i?g(o,r):p;return a.width=o,a.height=r,a.getContext("2d").drawImage(e,0,0,o,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+r+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Re.isPowerOfTwo(e.width)&&Re.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==P&&e.minFilter!==C}function b(t,i,n,o){e.generateMipmap(t),s.get(i).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function w(i,s,n){if(!1===a)return s;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=s;return 6403===s&&(5126===n&&(o=33326),5131===n&&(o=33325),5121===n&&(o=33321)),6407===s&&(5126===n&&(o=34837),5131===n&&(o=34843),5121===n&&(o=32849)),6408===s&&(5126===n&&(o=34836),5131===n&&(o=34842),5121===n&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function S(e){return e===P||e===A||e===D?9728:9729}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=s.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),s.remove(t))}(i),i.isVideoTexture&&u.delete(i),r.memory.textures--}function E(t){const i=t.target;i.removeEventListener("dispose",E),function(t){const i=s.get(t),n=s.get(t.texture);if(t){if(void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);s.remove(t.texture),s.remove(t)}}(i),r.memory.textures--}let O=0;function I(e,t){const n=s.get(e);if(e.isVideoTexture&&function(e){const t=r.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(e),e.version>0&&n.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void G(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function L(t,n){const r=s.get(t);t.version>0&&r.__version!==t.version?function(t,s,n){if(6!==s.image.length)return;U(t,s),i.activeTexture(33984+n),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,s.flipY);const r=s&&(s.isCompressedTexture||s.image[0].isCompressedTexture),l=s.image[0]&&s.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=r||l?l?s.image[e].image:s.image[e]:f(s.image[e],!1,!0,c);const d=h[0],u=v(d)||a,p=o.convert(s.format),m=o.convert(s.type),g=w(s.internalFormat,p,m);let S;if(B(34067,s,u),r){for(let e=0;e<6;e++){S=h[e].mipmaps;for(let t=0;t<S.length;t++){const n=S[t];s.format!==Q&&s.format!==$?null!==p?i.compressedTexImage2D(34069+e,t,g,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,g,n.width,n.height,0,p,m,n.data)}}t.__maxMipLevel=S.length-1}else{S=s.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,g,h[e].width,h[e].height,0,p,m,h[e].data);for(let t=0;t<S.length;t++){const s=S[t].image[e].image;i.texImage2D(34069+e,t+1,g,s.width,s.height,0,p,m,s.data)}}else{i.texImage2D(34069+e,0,g,p,m,h[e]);for(let t=0;t<S.length;t++){const s=S[t];i.texImage2D(34069+e,t+1,g,p,m,s.image[e])}}t.__maxMipLevel=S.length}y(s,u)&&b(34067,s,d.width,d.height),t.__version=s.version,s.onUpdate&&s.onUpdate(s)}(r,t,n):(i.activeTexture(33984+n),i.bindTexture(34067,r.__webglTexture))}const k={[_]:10497,[x]:33071,[M]:33648},F={[P]:9728,[A]:9984,[D]:9986,[C]:9729,[R]:9985,[N]:9987};function B(i,o,r){r?(e.texParameteri(i,10242,k[o.wrapS]),e.texParameteri(i,10243,k[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,k[o.wrapR]),e.texParameteri(i,10240,F[o.magFilter]),e.texParameteri(i,10241,F[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),o.wrapS===x&&o.wrapT===x||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,S(o.magFilter)),e.texParameteri(i,10241,S(o.minFilter)),o.minFilter!==P&&o.minFilter!==C&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=t.get("EXT_texture_filter_anisotropic");if(l){if(o.type===z&&null===t.get("OES_texture_float_linear"))return;if(o.type===j&&null===(a||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||s.get(o).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),s.get(o).__currentAnisotropy=o.anisotropy)}}function U(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",T),t.__webglTexture=e.createTexture(),r.memory.textures++)}function G(t,s,n){let r=3553;s.isDataTexture2DArray&&(r=35866),s.isDataTexture3D&&(r=32879),U(t,s),i.activeTexture(33984+n),i.bindTexture(r,t.__webglTexture),e.pixelStorei(37440,s.flipY),e.pixelStorei(37441,s.premultiplyAlpha),e.pixelStorei(3317,s.unpackAlignment);const l=function(e){return!a&&(e.wrapS!==x||e.wrapT!==x||e.minFilter!==P&&e.minFilter!==C)}(s)&&!1===v(s.image),c=f(s.image,l,!1,h),d=v(c)||a,u=o.convert(s.format);let p,m=o.convert(s.type),g=w(s.internalFormat,u,m);B(r,s,d);const S=s.mipmaps;if(s.isDepthTexture)g=6402,a?g=s.type===z?36012:s.type===V?33190:s.type===K?35056:33189:s.type===z&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===ee&&6402===g&&s.type!==H&&s.type!==V&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=H,m=o.convert(s.type)),s.format===te&&6402===g&&(g=34041,s.type!==K&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=K,m=o.convert(s.type))),i.texImage2D(3553,0,g,c.width,c.height,0,u,m,null);else if(s.isDataTexture)if(S.length>0&&d){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);s.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,g,c.width,c.height,0,u,m,c.data),t.__maxMipLevel=0;else if(s.isCompressedTexture){for(let e=0,t=S.length;e<t;e++)p=S[e],s.format!==Q&&s.format!==$?null!==u?i.compressedTexImage2D(3553,e,g,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);t.__maxMipLevel=S.length-1}else if(s.isDataTexture2DArray)i.texImage3D(35866,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(s.isDataTexture3D)i.texImage3D(32879,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(S.length>0&&d){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,g,u,m,p);s.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,g,u,m,c),t.__maxMipLevel=0;y(s,d)&&b(r,s,c.width,c.height),t.__version=s.version,s.onUpdate&&s.onUpdate(s)}function W(t,n,r,a){const l=o.convert(n.texture.format),c=o.convert(n.texture.type),h=w(n.texture.internalFormat,l,c);i.texImage2D(a,0,h,n.width,n.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,r,a,s.get(n.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function Z(t,i,s){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let n=33189;if(s){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===z?n=36012:t.type===V&&(n=33190));const s=q(i);e.renderbufferStorageMultisample(36161,s,n,i.width,i.height)}else e.renderbufferStorage(36161,n,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(s){const t=q(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=o.convert(i.texture.format),n=o.convert(i.texture.type),r=w(i.texture.internalFormat,t,n);if(s){const t=q(i);e.renderbufferStorageMultisample(36161,t,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height)}e.bindRenderbuffer(36161,null)}function q(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}let Y=!1,X=!1;this.allocateTextureUnit=function(){const e=O;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),O+=1,e},this.resetTextureUnits=function(){O=0},this.setTexture2D=I,this.setTexture2DArray=function(e,t){const n=s.get(e);e.version>0&&n.__version!==e.version?G(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){const n=s.get(e);e.version>0&&n.__version!==e.version?G(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=L,this.setupRenderTarget=function(t){const n=s.get(t),l=s.get(t.texture);t.addEventListener("dispose",E),l.__webglTexture=e.createTexture(),r.memory.textures++;const c=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultisampleRenderTarget,d=v(t)||a;if(!a||t.texture.format!==$||t.texture.type!==z&&t.texture.type!==j||(t.texture.format=Q,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){n.__webglFramebuffer=[];for(let t=0;t<6;t++)n.__webglFramebuffer[t]=e.createFramebuffer()}else if(n.__webglFramebuffer=e.createFramebuffer(),h)if(a){n.__webglMultisampledFramebuffer=e.createFramebuffer(),n.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,n.__webglColorRenderbuffer);const i=o.convert(t.texture.format),s=o.convert(t.texture.type),r=w(t.texture.internalFormat,i,s),a=q(t);e.renderbufferStorageMultisample(36161,a,r,t.width,t.height),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(n.__webglDepthRenderbuffer=e.createRenderbuffer(),Z(n.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){i.bindTexture(34067,l.__webglTexture),B(34067,t.texture,d);for(let e=0;e<6;e++)W(n.__webglFramebuffer[e],t,36064,34069+e);y(t.texture,d)&&b(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,l.__webglTexture),B(3553,t.texture,d),W(n.__webglFramebuffer,t,36064,3553),y(t.texture,d)&&b(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);t.depthBuffer&&function(t){const i=s.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");s.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);const n=s.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===ee)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(i.depthTexture.format!==te)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(let s=0;s<6;s++)e.bindFramebuffer(36160,i.__webglFramebuffer[s]),i.__webglDepthbuffer[s]=e.createRenderbuffer(),Z(i.__webglDepthbuffer[s],t,!1)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),Z(i.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(y(t,v(e)||a)){const n=e.isWebGLCubeRenderTarget?34067:3553,o=s.get(t).__webglTexture;i.bindTexture(n,o),b(n,t,e.width,e.height),i.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const i=s.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);const n=t.width,o=t.height;let r=16384;t.depthBuffer&&(r|=256),t.stencilBuffer&&(r|=1024),e.blitFramebuffer(0,0,n,o,0,0,n,o,r,9728),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===Y&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Y=!0),e=e.texture),I(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===X&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),X=!0),e=e.texture),L(e,t)}}function xo(e,t,i){const s=i.isWebGL2;return{convert:function(e){let i;if(e===F)return 5121;if(e===W)return 32819;if(e===Z)return 32820;if(e===q)return 33635;if(e===B)return 5120;if(e===U)return 5122;if(e===H)return 5123;if(e===G)return 5124;if(e===V)return 5125;if(e===z)return 5126;if(e===j)return s?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===Y)return 6406;if(e===$)return 6407;if(e===Q)return 6408;if(e===X)return 6409;if(e===J)return 6410;if(e===ee)return 6402;if(e===te)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(e===ie||e===se||e===ne||e===oe){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===ie)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===se)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ne)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===oe)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===re||e===ae||e===le||e===ce){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===re)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ae)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===le)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ce)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===he)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(37492===e)return i.COMPRESSED_RGB8_ETC2;if(37496===e)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):36492===e?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===K?s?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Mo(e=[]){ms.call(this),this.cameras=e}function Po(){jt.call(this),this.type="Group"}function Ao(){this._targetRay=null,this._grip=null,this._hand=null}function Oo(e,t){const i=this;let s=null,n=1,o=null,r="local-floor",a=null;const l=[],c=new Map,h=new ms;h.layers.enable(1),h.viewport=new Ge;const d=new ms;d.layers.enable(2),d.viewport=new Ge;const u=[h,d],p=new Mo;p.layers.enable(1),p.layers.enable(2);let m=null,g=null;function f(e){const t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){c.forEach((function(e,t){e.disconnect(t)})),c.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function y(e){o=e,_.setContext(s),_.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function b(e){const t=s.inputSources;for(let e=0;e<l.length;e++)c.set(t[e],l[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],s=c.get(i);s&&(s.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],s=c.get(i);s&&s.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new Ao,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new Ao,l[e]=t),t.getGripSpace()},this.getHand=function(e){let t=l[e];return void 0===t&&(t=new Ao,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return s},this.setSession=function(e){if(s=e,null!==s){s.addEventListener("select",f),s.addEventListener("selectstart",f),s.addEventListener("selectend",f),s.addEventListener("squeeze",f),s.addEventListener("squeezestart",f),s.addEventListener("squeezeend",f),s.addEventListener("end",v);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:n},o=new XRWebGLLayer(s,t,i);s.updateRenderState({baseLayer:o}),s.requestReferenceSpace(r).then(y),s.addEventListener("inputsourceschange",b)}};const w=new We,S=new We;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=d.near=h.near=e.near,p.far=d.far=h.far=e.far,m===p.near&&g===p.far||(s.updateRenderState({depthNear:p.near,depthFar:p.far}),m=p.near,g=p.far);const t=e.parent,i=p.cameras;T(p,t);for(let e=0;e<i.length;e++)T(i[e],t);e.matrixWorld.copy(p.matrixWorld);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);return 2===i.length?function(e,t,i){w.setFromMatrixPosition(t.matrixWorld),S.setFromMatrixPosition(i.matrixWorld);const s=w.distanceTo(S),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,r=n[14]/(n[10]-1),a=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],d=(o[8]+1)/o[0],u=r*h,p=r*d,m=s/(-h+d),g=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const f=r+m,v=a+m,y=u-g,b=p+(s-g),T=l*a/v*f,E=c*a/v*f;e.projectionMatrix.makePerspective(y,b,T,E,f,v)}(p,h,d):p.projectionMatrix.copy(h.projectionMatrix),p};let E=null;const _=new Es;_.setAnimationLoop((function(t,i){if(a=i.getViewerPose(o),null!==a){const t=a.views,i=s.renderState.baseLayer;e.setFramebuffer(i.framebuffer);let n=!1;t.length!==p.cameras.length&&(p.cameras.length=0,n=!0);for(let e=0;e<t.length;e++){const s=t[e],o=i.getViewport(s),r=u[e];r.matrix.fromArray(s.transform.matrix),r.projectionMatrix.fromArray(s.projectionMatrix),r.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(r.matrix),!0===n&&p.cameras.push(r)}}const n=s.inputSources;for(let e=0;e<l.length;e++){const t=l[e],s=n[e];t.update(s,i,o)}E&&E(t,i)})),this.setAnimationLoop=function(e){E=e},this.dispose=function(){}}function Do(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const s=e.get(i).envMap;if(s){t.envMap.value=s,t.flipEnvMap.value=s.isCubeTexture&&s._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const n=e.get(s).__maxMipLevel;void 0!==n&&(t.maxMipLevel.value=n)}let n,o;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?n=i.map:i.specularMap?n=i.specularMap:i.displacementMap?n=i.displacementMap:i.normalMap?n=i.normalMap:i.bumpMap?n=i.bumpMap:i.roughnessMap?n=i.roughnessMap:i.metalnessMap?n=i.metalnessMap:i.alphaMap?n=i.alphaMap:i.emissiveMap?n=i.emissiveMap:i.clearcoatMap?n=i.clearcoatMap:i.clearcoatNormalMap?n=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(n=i.clearcoatRoughnessMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===n&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===n&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,s,o,r){s.isMeshBasicMaterial?t(e,s):s.isMeshLambertMaterial?(t(e,s),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,s)):s.isMeshToonMaterial?(t(e,s),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===n&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===n&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,s)):s.isMeshPhongMaterial?(t(e,s),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===n&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===n&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,s)):s.isMeshStandardMaterial?(t(e,s),s.isMeshPhysicalMaterial?function(e,t){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===n&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,s):i(e,s)):s.isMeshMatcapMaterial?(t(e,s),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===n&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===n&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,s)):s.isMeshDepthMaterial?(t(e,s),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,s)):s.isMeshDistanceMaterial?(t(e,s),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,s)):s.isMeshNormalMaterial?(t(e,s),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===n&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===n&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,s)):s.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,s),s.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,s)):s.isPointsMaterial?function(e,t,i,s){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*s,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,s,o,r):s.isSpriteMaterial?function(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,s):s.isShadowMaterial?(e.color.value.copy(s.color),e.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function Io(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,s=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,r=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d=null,u=null;const p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=we,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const m=this;let g=!1,f=null,v=0,y=0,b=null,w=null,S=-1,T=null;const E=new Ge,_=new Ge;let x=null,M=t.width,P=t.height,A=1,O=null,D=null;const I=new Ge(0,0,M,P),C=new Ge(0,0,M,P);let R=!1;const L=new Ts;let N=!1,k=!1;const B=new bt,U=new We,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return null===b?A:1}let V,W,Z,q,K,Y,$,X,J,ee,te,ie,se,ne,oe,re,ae,le,ce,he,de,ue=i;function pe(e,i){for(let s=0;s<e.length;s++){const n=e[s],o=t.getContext(n,i);if(null!==o)return o}return null}try{const e={alpha:s,depth:n,stencil:o,antialias:r,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",ve,!1),t.addEventListener("webglcontextrestored",ye,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ue=pe(t,e),null===ue)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function me(){V=new Ns(ue),W=new Cs(ue,V,e),!1===W.isWebGL2&&(V.get("WEBGL_depth_texture"),V.get("OES_texture_float"),V.get("OES_texture_half_float"),V.get("OES_texture_half_float_linear"),V.get("OES_standard_derivatives"),V.get("OES_element_index_uint"),V.get("OES_vertex_array_object"),V.get("ANGLE_instanced_arrays")),V.get("OES_texture_float_linear"),he=new xo(ue,V,W),Z=new Eo(ue,V,W),Z.scissor(_.copy(C).multiplyScalar(A).floor()),Z.viewport(E.copy(I).multiplyScalar(A).floor()),q=new Bs(ue),K=new lo,Y=new _o(ue,V,Z,K,W,he,q),$=new Ls(m),X=new _s(ue,W),de=new Ds(ue,V,X,W),J=new ks(ue,X,q,de),ee=new Vs(ue,J,X,q),ae=new Gs(ue),oe=new Rs(K),te=new ao(m,$,V,W,de,oe),ie=new Do(K),se=new po(K),ne=new bo(V,W),re=new Os(m,$,Z,ee,a),le=new Is(ue,V,q,W),ce=new Fs(ue,V,q,W),q.programs=te.programs,m.capabilities=W,m.extensions=V,m.properties=K,m.renderLists=se,m.state=Z,m.info=q}me();const ge=new Oo(m,ue);this.xr=ge;const fe=new To(m,ee,W.maxTextureSize);function ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1,me()}function be(e){const t=e.target;t.removeEventListener("dispose",be),function(e){Se(e),K.remove(e)}(t)}function Se(e){const t=K.get(e).program;void 0!==t&&te.releaseProgram(t)}this.shadowMap=fe,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(M,P,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Le),e.set(M,P)},this.setSize=function(e,i,s){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,P=i,t.width=Math.floor(e*A),t.height=Math.floor(i*A),!1!==s&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Le),e.set(M*A,P*A).floor()},this.setDrawingBufferSize=function(e,i,s){M=e,P=i,A=s,t.width=Math.floor(e*s),t.height=Math.floor(i*s),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Ge),e.copy(E)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,i,s){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,i,s),Z.viewport(E.copy(I).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(C)},this.setScissor=function(e,t,i,s){e.isVector4?C.set(e.x,e.y,e.z,e.w):C.set(e,t,i,s),Z.scissor(_.copy(C).multiplyScalar(A).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){Z.setScissorTest(R=e)},this.setOpaqueSort=function(e){O=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new ui),e.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(e,t,i){let s=0;(void 0===e||e)&&(s|=16384),(void 0===t||t)&&(s|=256),(void 0===i||i)&&(s|=1024),ue.clear(s)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ve,!1),t.removeEventListener("webglcontextrestored",ye,!1),se.dispose(),ne.dispose(),K.dispose(),$.dispose(),ee.dispose(),de.dispose(),ge.dispose(),Ee.stop()},this.renderBufferImmediate=function(e,t){de.initAttributes();const i=K.get(e);e.hasPositions&&!i.position&&(i.position=ue.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=ue.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=ue.createBuffer()),e.hasColors&&!i.color&&(i.color=ue.createBuffer());const s=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,i.position),ue.bufferData(34962,e.positionArray,35048),de.enableAttribute(s.position),ue.vertexAttribPointer(s.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,i.normal),ue.bufferData(34962,e.normalArray,35048),de.enableAttribute(s.normal),ue.vertexAttribPointer(s.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,i.uv),ue.bufferData(34962,e.uvArray,35048),de.enableAttribute(s.uv),ue.vertexAttribPointer(s.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,i.color),ue.bufferData(34962,e.colorArray,35048),de.enableAttribute(s.color),ue.vertexAttribPointer(s.color,3,5126,!1,0,0)),de.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,s,n,o){null===t&&(t=H);const r=n.isMesh&&n.matrixWorld.determinant()<0,a=Ae(e,t,s,n);Z.setMaterial(s,r);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,d=1;!0===s.wireframe&&(l=J.getWireframeAttribute(i),d=2),(s.morphTargets||s.morphNormals)&&ae.update(n,i,s,a),de.setup(n,s,a,i,l);let u=le;null!==l&&(h=X.get(l),u=ce,u.setIndex(h));const p=null!==l?l.count:c.count,m=i.drawRange.start*d,g=i.drawRange.count*d,f=null!==o?o.start*d:0,v=null!==o?o.count*d:1/0,y=Math.max(m,f),b=Math.min(p,m+g,f+v)-1,w=Math.max(0,b-y+1);if(0!==w){if(n.isMesh)!0===s.wireframe?(Z.setLineWidth(s.wireframeLinewidth*G()),u.setMode(1)):u.setMode(4);else if(n.isLine){let e=s.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*G()),n.isLineSegments?u.setMode(1):n.isLineLoop?u.setMode(2):u.setMode(3)}else n.isPoints?u.setMode(0):n.isSprite&&u.setMode(4);if(n.isInstancedMesh)u.renderInstances(y,w,n.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);u.renderInstances(y,w,e)}else u.render(y,w)}},this.compile=function(e,t){u=ne.get(e),u.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights();const i=new WeakMap;e.traverse((function(t){const s=t.material;if(s)if(Array.isArray(s))for(let n=0;n<s.length;n++){const o=s[n];!1===i.has(o)&&(Pe(o,e,t),i.set(o))}else!1===i.has(s)&&(Pe(s,e,t),i.set(s))}))};let Te=null;const Ee=new Es;function _e(e,t,i,s){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||L.intersectsSprite(e)){s&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=ee.update(e),n=e.material;n.visible&&d.push(e,t,n,i,U.z,null)}}else if(e.isImmediateRenderObject)s&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B),d.push(e,null,e.material,i,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||L.intersectsObject(e))){s&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=ee.update(e),n=e.material;if(Array.isArray(n)){const s=t.groups;for(let o=0,r=s.length;o<r;o++){const r=s[o],a=n[r.materialIndex];a&&a.visible&&d.push(e,t,a,i,U.z,r)}}else n.visible&&d.push(e,t,n,i,U.z,null)}const n=e.children;for(let e=0,o=n.length;e<o;e++)_e(n[e],t,i,s)}function xe(e,t,i){const s=!0===t.isScene?t.overrideMaterial:null;for(let n=0,o=e.length;n<o;n++){const o=e[n],r=o.object,a=o.geometry,l=null===s?o.material:s,c=o.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,s=e.length;i<s;i++){const s=e[i];r.layers.test(s.layers)&&(Z.viewport(E.copy(s.viewport)),u.setupLightsView(s),Me(r,t,s,a,l,c))}}else Me(r,t,i,a,l,c)}}function Me(e,t,i,s,n,o){if(e.onBeforeRender(m,t,i,s,n,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const s=Ae(i,t,n,e);Z.setMaterial(n),de.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,s)}else m.renderBufferDirect(i,t,s,n,e,o);e.onAfterRender(m,t,i,s,n,o)}function Pe(e,t,i){!0!==t.isScene&&(t=H);const s=K.get(e),n=u.state.lights,o=u.state.shadowsArray,r=n.state.version,a=te.getParameters(e,n.state,o,t,i),l=te.getProgramCacheKey(a);let c=s.program,h=!0;if(void 0===c)e.addEventListener("dispose",be);else if(c.cacheKey!==l)Se(e);else if(s.lightsStateVersion!==r)h=!1;else{if(void 0!==a.shaderID){const i=e.isMeshStandardMaterial?t.environment:null;return void(s.envMap=$.get(e.envMap||i))}h=!1}h&&(a.uniforms=te.getUniforms(e),e.onBeforeCompile(a,m),c=te.acquireProgram(a,l),s.program=c,s.uniforms=a.uniforms,s.outputEncoding=a.outputEncoding);const d=s.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(s.numClippingPlanes=oe.numPlanes,s.numIntersection=oe.numIntersection,d.clippingPlanes=oe.uniform),s.environment=e.isMeshStandardMaterial?t.environment:null,s.fog=t.fog,s.envMap=$.get(e.envMap||s.environment),s.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),s.lightsStateVersion=r,s.needsLights&&(d.ambientLightColor.value=n.state.ambient,d.lightProbe.value=n.state.probe,d.directionalLights.value=n.state.directional,d.directionalLightShadows.value=n.state.directionalShadow,d.spotLights.value=n.state.spot,d.spotLightShadows.value=n.state.spotShadow,d.rectAreaLights.value=n.state.rectArea,d.ltc_1.value=n.state.rectAreaLTC1,d.ltc_2.value=n.state.rectAreaLTC2,d.pointLights.value=n.state.point,d.pointLightShadows.value=n.state.pointShadow,d.hemisphereLights.value=n.state.hemi,d.directionalShadowMap.value=n.state.directionalShadowMap,d.directionalShadowMatrix.value=n.state.directionalShadowMatrix,d.spotShadowMap.value=n.state.spotShadowMap,d.spotShadowMatrix.value=n.state.spotShadowMatrix,d.pointShadowMap.value=n.state.pointShadowMap,d.pointShadowMatrix.value=n.state.pointShadowMatrix);const p=s.program.getUniforms(),g=Hn.seqWithValue(p.seq,d);s.uniformsList=g}function Ae(e,t,i,s){!0!==t.isScene&&(t=H),Y.resetTextureUnits();const n=t.fog,o=i.isMeshStandardMaterial?t.environment:null,r=null===b?m.outputEncoding:b.texture.encoding,a=$.get(i.envMap||o),l=K.get(i),c=u.state.lights;if(!0===N&&(!0===k||e!==T)){const t=e===T&&i.id===S;oe.setState(i,e,t)}i.version===l.__version?i.fog&&l.fog!==n||l.environment!==o||l.needsLights&&l.lightsStateVersion!==c.state.version?Pe(i,t,s):void 0===l.numClippingPlanes||l.numClippingPlanes===oe.numPlanes&&l.numIntersection===oe.numIntersection?(l.outputEncoding!==r||l.envMap!==a)&&Pe(i,t,s):Pe(i,t,s):(Pe(i,t,s),l.__version=i.version);let h=!1,d=!1,p=!1;const g=l.program,f=g.getUniforms(),v=l.uniforms;if(Z.useProgram(g.program)&&(h=!0,d=!0,p=!0),i.id!==S&&(S=i.id,d=!0),h||T!==e){if(f.setValue(ue,"projectionMatrix",e.projectionMatrix),W.logarithmicDepthBuffer&&f.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),T!==e&&(T=e,d=!0,p=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=f.map.cameraPosition;void 0!==t&&t.setValue(ue,U.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&f.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&f.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){f.setOptional(ue,s,"bindMatrix"),f.setOptional(ue,s,"bindMatrixInverse");const e=s.skeleton;if(e){const t=e.bones;if(W.floatVertexTextures){if(null===e.boneTexture){let i=Math.sqrt(4*t.length);i=Re.ceilPowerOfTwo(i),i=Math.max(i,4);const s=new Float32Array(i*i*4);s.set(e.boneMatrices);const n=new bs(s,i,i,Q,z);e.boneMatrices=s,e.boneTexture=n,e.boneTextureSize=i}f.setValue(ue,"boneTexture",e.boneTexture,Y),f.setValue(ue,"boneTextureSize",e.boneTextureSize)}else f.setOptional(ue,e,"boneMatrices")}}var y,w;return(d||l.receiveShadow!==s.receiveShadow)&&(l.receiveShadow=s.receiveShadow,f.setValue(ue,"receiveShadow",s.receiveShadow)),d&&(f.setValue(ue,"toneMappingExposure",m.toneMappingExposure),l.needsLights&&(w=p,(y=v).ambientLightColor.needsUpdate=w,y.lightProbe.needsUpdate=w,y.directionalLights.needsUpdate=w,y.directionalLightShadows.needsUpdate=w,y.pointLights.needsUpdate=w,y.pointLightShadows.needsUpdate=w,y.spotLights.needsUpdate=w,y.spotLightShadows.needsUpdate=w,y.rectAreaLights.needsUpdate=w,y.hemisphereLights.needsUpdate=w),n&&i.fog&&ie.refreshFogUniforms(v,n),ie.refreshMaterialUniforms(v,i,A,P),Hn.upload(ue,l.uniformsList,v,Y)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Hn.upload(ue,l.uniformsList,v,Y),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&f.setValue(ue,"center",s.center),f.setValue(ue,"modelViewMatrix",s.modelViewMatrix),f.setValue(ue,"normalMatrix",s.normalMatrix),f.setValue(ue,"modelMatrix",s.matrixWorld),g}Ee.setAnimationLoop((function(e){ge.isPresenting||Te&&Te(e)})),"undefined"!=typeof window&&Ee.setContext(window),this.setAnimationLoop=function(e){Te=e,ge.setAnimationLoop(e),null===e?Ee.stop():Ee.start()},this.render=function(e,t){let i,s;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),s=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;de.resetDefaultState(),S=-1,T=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(t=ge.getCamera(t)),!0===e.isScene&&e.onBeforeRender(m,e,t,i||b),u=ne.get(e,p.length),u.init(),p.push(u),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(B),k=this.localClippingEnabled,N=oe.init(this.clippingPlanes,k,t),d=se.get(e,t),d.init(),_e(e,t,0,m.sortObjects),d.finish(),!0===m.sortObjects&&d.sort(O,D),!0===N&&oe.beginShadows();const n=u.state.shadowsArray;fe.render(n,e,t),u.setupLights(),u.setupLightsView(t),!0===N&&oe.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),re.render(d,e,t,s);const o=d.opaque,r=d.transparent;o.length>0&&xe(o,e,t),r.length>0&&xe(r,e,t),!0===e.isScene&&e.onAfterRender(m,e,t),null!==b&&(Y.updateRenderTargetMipmap(b),Y.updateMultisampleRenderTarget(b)),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1),p.pop(),u=p.length>0?p[p.length-1]:null,d=null},this.setFramebuffer=function(e){f!==e&&null===b&&ue.bindFramebuffer(36160,e),f=e},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return d},this.setRenderList=function(e){d=e},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,i=0){b=e,v=t,y=i,e&&void 0===K.get(e).__webglFramebuffer&&Y.setupRenderTarget(e);let s=f,n=!1;if(e){const i=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(s=i[t],n=!0):s=e.isWebGLMultisampleRenderTarget?K.get(e).__webglMultisampledFramebuffer:i,E.copy(e.viewport),_.copy(e.scissor),x=e.scissorTest}else E.copy(I).multiplyScalar(A).floor(),_.copy(C).multiplyScalar(A).floor(),x=R;if(w!==s&&(ue.bindFramebuffer(36160,s),w=s),Z.viewport(E),Z.scissor(_),Z.setScissorTest(x),n){const s=K.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,s.__webglTexture,i)}},this.readRenderTargetPixels=function(e,t,i,s,n,o,r){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==r&&(a=a[r]),a){let r=!1;a!==w&&(ue.bindFramebuffer(36160,a),r=!0);try{const a=e.texture,l=a.format,c=a.type;if(l!==Q&&he.convert(l)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===F||he.convert(c)===ue.getParameter(35738)||c===z&&(W.isWebGL2||V.get("OES_texture_float")||V.get("WEBGL_color_buffer_float"))||c===j&&(W.isWebGL2?V.get("EXT_color_buffer_float"):V.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-s&&i>=0&&i<=e.height-n&&ue.readPixels(t,i,s,n,he.convert(l),he.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{r&&ue.bindFramebuffer(36160,w)}}},this.copyFramebufferToTexture=function(e,t,i=0){const s=Math.pow(2,-i),n=Math.floor(t.image.width*s),o=Math.floor(t.image.height*s),r=he.convert(t.format);Y.setTexture2D(t,0),ue.copyTexImage2D(3553,i,r,e.x,e.y,n,o,0),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,i,s=0){const n=t.image.width,o=t.image.height,r=he.convert(i.format),a=he.convert(i.type);Y.setTexture2D(i,0),ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,s,e.x,e.y,n,o,r,a,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,s,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,r,t.mipmaps[0].data):ue.texSubImage2D(3553,s,e.x,e.y,r,a,t.image),0===s&&i.generateMipmaps&&ue.generateMipmap(3553),Z.unbindTexture()},this.initTexture=function(e){Y.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){Z.reset(),de.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Co(e){Io.call(this,e)}wo.prototype=Object.create(gi.prototype),wo.prototype.constructor=wo,wo.prototype.isMeshDepthMaterial=!0,wo.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},So.prototype=Object.create(gi.prototype),So.prototype.constructor=So,So.prototype.isMeshDistanceMaterial=!0,So.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Mo.prototype=Object.assign(Object.create(ms.prototype),{constructor:Mo,isArrayCamera:!0}),Po.prototype=Object.assign(Object.create(jt.prototype),{constructor:Po,isGroup:!0}),Object.assign(Ao.prototype,{constructor:Ao,getHandSpace:function(){if(null===this._hand&&(this._hand=new Po,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){const e=new Po;e.matrixAutoUpdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Po,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Po,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,i){let s=null,n=null,o=null;const r=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){o=!0;for(let s=0;s<=window.XRHand.LITTLE_PHALANX_TIP;s++)if(e.hand[s]){const n=t.getJointPose(e.hand[s],i),o=l.joints[s];null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=n.radius),o.visible=null!==n;const r=l.joints[window.XRHand.INDEX_PHALANX_TIP],a=l.joints[window.XRHand.THUMB_PHALANX_TIP],c=r.position.distanceTo(a.position),h=.02,d=.005;l.inputState.pinching&&c>h+d?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&c<=h-d&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==r&&(s=t.getPose(e.targetRaySpace,i),null!==s&&(r.matrix.fromArray(s.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale))),null!==a&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==r&&(r.visible=null!==s),null!==a&&(a.visible=null!==n),null!==l&&(l.visible=null!==o),this}}),Object.assign(Oo.prototype,De.prototype),Co.prototype=Object.assign(Object.create(Io.prototype),{constructor:Co,isWebGL1Renderer:!0});class Ro extends jt{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function Lo(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Pe,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Re.generateUUID()}Object.defineProperty(Lo.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Lo.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,n=this.stride;s<n;s++)this.array[e+s]=t.array[i+s];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Re.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new Lo(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Re.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const No=new We;function ko(e,t,i,s){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===s}function Fo(e){gi.call(this),this.type="SpriteMaterial",this.color=new ui(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let Bo;Object.defineProperties(ko.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(ko.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,i=this.data.count;t<i;t++)No.x=this.getX(t),No.y=this.getY(t),No.z=this.getZ(t),No.applyMatrix4(e),this.setXYZ(t,No.x,No.y,No.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this},setXYZW:function(e,t,i,s,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=n,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new bi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ko(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Fo.prototype=Object.create(gi.prototype),Fo.prototype.constructor=Fo,Fo.prototype.isSpriteMaterial=!0,Fo.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const Uo=new We,Ho=new We,Go=new We,Vo=new Le,zo=new Le,jo=new bt,Wo=new We,Zo=new We,qo=new We,Ko=new Le,Yo=new Le,$o=new Le;function Qo(e){if(jt.call(this),this.type="Sprite",void 0===Bo){Bo=new Gi;const e=new Lo(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Bo.setIndex([0,1,2,0,2,3]),Bo.setAttribute("position",new ko(e,3,0,!1)),Bo.setAttribute("uv",new ko(e,2,3,!1))}this.geometry=Bo,this.material=void 0!==e?e:new Fo,this.center=new Le(.5,.5)}function Xo(e,t,i,s,n,o){Vo.subVectors(e,i).addScalar(.5).multiply(s),void 0!==n?(zo.x=o*Vo.x-n*Vo.y,zo.y=n*Vo.x+o*Vo.y):zo.copy(Vo),e.copy(t),e.x+=zo.x,e.y+=zo.y,e.applyMatrix4(jo)}Qo.prototype=Object.assign(Object.create(jt.prototype),{constructor:Qo,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ho.setFromMatrixScale(this.matrixWorld),jo.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Go.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ho.multiplyScalar(-Go.z);const i=this.material.rotation;let s,n;0!==i&&(n=Math.cos(i),s=Math.sin(i));const o=this.center;Xo(Wo.set(-.5,-.5,0),Go,o,Ho,s,n),Xo(Zo.set(.5,-.5,0),Go,o,Ho,s,n),Xo(qo.set(.5,.5,0),Go,o,Ho,s,n),Ko.set(0,0),Yo.set(1,0),$o.set(1,1);let r=e.ray.intersectTriangle(Wo,Zo,qo,!1,Uo);if(null===r&&(Xo(Zo.set(-.5,.5,0),Go,o,Ho,s,n),Yo.set(0,1),r=e.ray.intersectTriangle(Wo,qo,Zo,!1,Uo),null===r))return;const a=e.ray.origin.distanceTo(Uo);a<e.near||a>e.far||t.push({distance:a,point:Uo.clone(),uv:oi.getUV(Uo,Wo,Zo,qo,Ko,Yo,$o,new Le),face:null,object:this})},copy:function(e){return jt.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const Jo=new We,er=new We;function tr(){jt.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}tr.prototype=Object.assign(Object.create(jt.prototype),{constructor:tr,isLOD:!0,copy:function(e){jt.prototype.copy.call(this,e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Jo.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Jo);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){Jo.setFromMatrixPosition(e.matrixWorld),er.setFromMatrixPosition(this.matrixWorld);const i=Jo.distanceTo(er)/e.zoom;let s,n;for(t[0].object.visible=!0,s=1,n=t.length;s<n&&i>=t[s].distance;s++)t[s-1].object.visible=!1,t[s].object.visible=!0;for(this._currentLevel=s-1;s<n;s++)t[s].object.visible=!1}},toJSON:function(e){const t=jt.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,s=i.length;e<s;e++){const s=i[e];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t}});const ir=new We,sr=new Ge,nr=new Ge,or=new We,rr=new bt;function ar(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),os.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new bt,this.bindMatrixInverse=new bt}function lr(){jt.call(this),this.type="Bone"}ar.prototype=Object.assign(Object.create(os.prototype),{constructor:ar,isSkinnedMesh:!0,copy:function(e){return os.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new Ge,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){os.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const i=this.skeleton,s=this.geometry;sr.fromBufferAttribute(s.attributes.skinIndex,e),nr.fromBufferAttribute(s.attributes.skinWeight,e),ir.fromBufferAttribute(s.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const s=nr.getComponent(e);if(0!==s){const n=sr.getComponent(e);rr.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(or.copy(ir).applyMatrix4(rr),s)}}return t.applyMatrix4(this.bindMatrixInverse)}}),lr.prototype=Object.assign(Object.create(jt.prototype),{constructor:lr,isBone:!0});const cr=new bt,hr=new bt;function dr(e=[],t=[]){this.uuid=Re.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(dr.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bt)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new bt;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let s=0,n=e.length;s<n;s++){const n=e[s]?e[s].matrixWorld:hr;cr.multiplyMatrices(n,t[s]),cr.toArray(i,16*s)}null!==s&&(s.needsUpdate=!0)},clone:function(){return new dr(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const s=e.bones[i];let n=t[s];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),n=new lr),this.bones.push(n),this.boneInverses.push((new bt).fromArray(e.boneInverses[i]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,n=t.length;s<n;s++){const n=t[s];e.bones.push(n.uuid);const o=i[s];e.boneInverses.push(o.toArray())}return e}});const ur=new bt,pr=new bt,mr=[],gr=new os;function fr(e,t,i){os.call(this,e,t),this.instanceMatrix=new bi(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function vr(e){gi.call(this),this.type="LineBasicMaterial",this.color=new ui(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}fr.prototype=Object.assign(Object.create(os.prototype),{constructor:fr,isInstancedMesh:!0,copy:function(e){return os.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const i=this.matrixWorld,s=this.count;if(gr.geometry=this.geometry,gr.material=this.material,void 0!==gr.material)for(let n=0;n<s;n++){this.getMatrixAt(n,ur),pr.multiplyMatrices(i,ur),gr.matrixWorld=pr,gr.raycast(e,mr);for(let e=0,i=mr.length;e<i;e++){const i=mr[e];i.instanceId=n,i.object=this,t.push(i)}mr.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new bi(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),vr.prototype=Object.create(gi.prototype),vr.prototype.constructor=vr,vr.prototype.isLineBasicMaterial=!0,vr.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const yr=new We,br=new We,wr=new bt,Sr=new yt,Tr=new ht;function Er(e=new Gi,t=new vr){jt.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}Er.prototype=Object.assign(Object.create(jt.prototype),{constructor:Er,isLine:!0,copy:function(e){return jt.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,s=t.count;e<s;e++)yr.fromBufferAttribute(t,e-1),br.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=yr.distanceTo(br);e.setAttribute("lineDistance",new Ai(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;i[0]=0;for(let e=1,s=t.length;e<s;e++)i[e]=i[e-1],i[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const i=this.geometry,s=this.matrixWorld,n=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Tr.copy(i.boundingSphere),Tr.applyMatrix4(s),Tr.radius+=n,!1===e.ray.intersectsSphere(Tr))return;wr.copy(s).invert(),Sr.copy(e.ray).applyMatrix4(wr);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),r=o*o,a=new We,l=new We,c=new We,h=new We,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const s=i.index,n=i.attributes.position;if(null!==s){const i=s.array;for(let s=0,o=i.length-1;s<o;s+=d){const o=i[s],d=i[s+1];if(a.fromBufferAttribute(n,o),l.fromBufferAttribute(n,d),Sr.distanceSqToSegment(a,l,h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const u=e.ray.origin.distanceTo(h);u<e.near||u>e.far||t.push({distance:u,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}else for(let i=0,s=n.count-1;i<s;i+=d){if(a.fromBufferAttribute(n,i),l.fromBufferAttribute(n,i+1),Sr.distanceSqToSegment(a,l,h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const s=i.vertices,n=s.length;for(let i=0;i<n-1;i+=d){if(Sr.distanceSqToSegment(s[i],s[i+1],h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(h);n<e.near||n>e.far||t.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const _r=new We,xr=new We;function Mr(e,t){Er.call(this,e,t),this.type="LineSegments"}function Pr(e,t){Er.call(this,e,t),this.type="LineLoop"}function Ar(e){gi.call(this),this.type="PointsMaterial",this.color=new ui(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Mr.prototype=Object.assign(Object.create(Er.prototype),{constructor:Mr,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,s=t.count;e<s;e+=2)_r.fromBufferAttribute(t,e),xr.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+_r.distanceTo(xr);e.setAttribute("lineDistance",new Ai(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;for(let e=0,s=t.length;e<s;e+=2)_r.copy(t[e]),xr.copy(t[e+1]),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+_r.distanceTo(xr)}return this}}),Pr.prototype=Object.assign(Object.create(Er.prototype),{constructor:Pr,isLineLoop:!0}),Ar.prototype=Object.create(gi.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isPointsMaterial=!0,Ar.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const Or=new bt,Dr=new yt,Ir=new ht,Cr=new We;function Rr(e=new Gi,t=new Ar){jt.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function Lr(e,t,i,s,n,o,r){const a=Dr.distanceSqToPoint(e);if(a<i){const i=new We;Dr.closestPointToPoint(e,i),i.applyMatrix4(s);const l=n.ray.origin.distanceTo(i);if(l<n.near||l>n.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:r})}}function Nr(e,t,i,s,n,o,r,a,l){Ue.call(this,e,t,i,s,n,o,r,a,l),this.format=void 0!==r?r:$,this.minFilter=void 0!==o?o:C,this.magFilter=void 0!==n?n:C,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function kr(e,t,i,s,n,o,r,a,l,c,h,d){Ue.call(this,null,o,r,a,l,c,s,n,h,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Fr(e,t,i,s,n,o,r,a,l){Ue.call(this,e,t,i,s,n,o,r,a,l),this.needsUpdate=!0}function Br(e,t,i,s,n,o,r,a,l,c){if((c=void 0!==c?c:ee)!==ee&&c!==te)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===ee&&(i=H),void 0===i&&c===te&&(i=K),Ue.call(this,null,s,n,o,r,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==r?r:P,this.minFilter=void 0!==a?a:P,this.flipY=!1,this.generateMipmaps=!1}Rr.prototype=Object.assign(Object.create(jt.prototype),{constructor:Rr,isPoints:!0,copy:function(e){return jt.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const i=this.geometry,s=this.matrixWorld,n=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ir.copy(i.boundingSphere),Ir.applyMatrix4(s),Ir.radius+=n,!1===e.ray.intersectsSphere(Ir))return;Or.copy(s).invert(),Dr.copy(e.ray).applyMatrix4(Or);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),r=o*o;if(i.isBufferGeometry){const n=i.index,o=i.attributes.position;if(null!==n){const i=n.array;for(let n=0,a=i.length;n<a;n++){const a=i[n];Cr.fromBufferAttribute(o,a),Lr(Cr,a,r,s,e,t,this)}}else for(let i=0,n=o.count;i<n;i++)Cr.fromBufferAttribute(o,i),Lr(Cr,i,r,s,e,t,this)}else{const n=i.vertices;for(let i=0,o=n.length;i<o;i++)Lr(n[i],i,r,s,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Nr.prototype=Object.assign(Object.create(Ue.prototype),{constructor:Nr,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),kr.prototype=Object.create(Ue.prototype),kr.prototype.constructor=kr,kr.prototype.isCompressedTexture=!0,Fr.prototype=Object.create(Ue.prototype),Fr.prototype.constructor=Fr,Fr.prototype.isCanvasTexture=!0,Br.prototype=Object.create(Ue.prototype),Br.prototype.constructor=Br,Br.prototype.isDepthTexture=!0;let Ur=0;const Hr=new bt,Gr=new jt,Vr=new We;function zr(){Object.defineProperty(this,"id",{value:Ur+=2}),this.uuid=Re.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}zr.prototype=Object.assign(Object.create(De.prototype),{constructor:zr,isGeometry:!0,applyMatrix4:function(e){const t=(new Ne).getNormalMatrix(e);for(let t=0,i=this.vertices.length;t<i;t++)this.vertices[t].applyMatrix4(e);for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];i.normal.applyMatrix3(t).normalize();for(let e=0,s=i.vertexNormals.length;e<s;e++)i.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Hr.makeRotationX(e),this.applyMatrix4(Hr),this},rotateY:function(e){return Hr.makeRotationY(e),this.applyMatrix4(Hr),this},rotateZ:function(e){return Hr.makeRotationZ(e),this.applyMatrix4(Hr),this},translate:function(e,t,i){return Hr.makeTranslation(e,t,i),this.applyMatrix4(Hr),this},scale:function(e,t,i){return Hr.makeScale(e,t,i),this.applyMatrix4(Hr),this},lookAt:function(e){return Gr.lookAt(e),Gr.updateMatrix(),this.applyMatrix4(Gr.matrix),this},fromBufferGeometry:function(e){const t=this,i=null!==e.index?e.index:void 0,s=e.attributes;if(void 0===s.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const n=s.position,o=s.normal,r=s.color,a=s.uv,l=s.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let e=0;e<n.count;e++)t.vertices.push((new We).fromBufferAttribute(n,e)),void 0!==r&&t.colors.push((new ui).fromBufferAttribute(r,e));function c(e,i,s,n){const c=void 0===r?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[s].clone()],h=void 0===o?[]:[(new We).fromBufferAttribute(o,e),(new We).fromBufferAttribute(o,i),(new We).fromBufferAttribute(o,s)],d=new pi(e,i,s,h,c,n);t.faces.push(d),void 0!==a&&t.faceVertexUvs[0].push([(new Le).fromBufferAttribute(a,e),(new Le).fromBufferAttribute(a,i),(new Le).fromBufferAttribute(a,s)]),void 0!==l&&t.faceVertexUvs[1].push([(new Le).fromBufferAttribute(l,e),(new Le).fromBufferAttribute(l,i),(new Le).fromBufferAttribute(l,s)])}const h=e.groups;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e],s=t.start;for(let e=s,n=s+t.count;e<n;e+=3)void 0!==i?c(i.getX(e),i.getX(e+1),i.getX(e+2),t.materialIndex):c(e,e+1,e+2,t.materialIndex)}else if(void 0!==i)for(let e=0;e<i.count;e+=3)c(i.getX(e),i.getX(e+1),i.getX(e+2));else for(let e=0;e<n.count;e+=3)c(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vr).negate(),this.translate(Vr.x,Vr.y,Vr.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,s=new bt;return s.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(s),this},computeFaceNormals:function(){const e=new We,t=new We;for(let i=0,s=this.faces.length;i<s;i++){const s=this.faces[i],n=this.vertices[s.a],o=this.vertices[s.b],r=this.vertices[s.c];e.subVectors(r,o),t.subVectors(n,o),e.cross(t),e.normalize(),s.normal.copy(e)}},computeVertexNormals:function(e=!0){const t=new Array(this.vertices.length);for(let e=0,i=this.vertices.length;e<i;e++)t[e]=new We;if(e){const e=new We,i=new We;for(let s=0,n=this.faces.length;s<n;s++){const n=this.faces[s],o=this.vertices[n.a],r=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,r),i.subVectors(o,r),e.cross(i),t[n.a].add(e),t[n.b].add(e),t[n.c].add(e)}}else{this.computeFaceNormals();for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];t[i.a].add(i.normal),t[i.b].add(i.normal),t[i.c].add(i.normal)}}for(let e=0,i=this.vertices.length;e<i;e++)t[e].normalize();for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e],s=i.vertexNormals;3===s.length?(s[0].copy(t[i.a]),s[1].copy(t[i.b]),s[2].copy(t[i.c])):(s[0]=t[i.a].clone(),s[1]=t[i.b].clone(),s[2]=t[i.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],i=t.vertexNormals;3===i.length?(i[0].copy(t.normal),i[1].copy(t.normal),i[2].copy(t.normal)):(i[0]=t.normal.clone(),i[1]=t.normal.clone(),i[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,i=t.vertexNormals.length;e<i;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const e=new zr;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,i=this.morphNormals[t].vertexNormals;for(let t=0,s=this.faces.length;t<s;t++){const t=new We,s={a:new We,b:new We,c:new We};e.push(t),i.push(s)}}const i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],s=i.faceNormals[e],n=i.vertexNormals[e];s.copy(t.normal),n.a.copy(t.vertexNormals[0]),n.b.copy(t.vertexNormals[1]),n.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ke),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ht),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let s;const n=this.vertices.length,o=this.vertices,r=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(s=(new Ne).getNormalMatrix(t));for(let e=0,i=r.length;e<i;e++){const i=r[e].clone();void 0!==t&&i.applyMatrix4(t),o.push(i)}for(let e=0,t=h.length;e<t;e++)c.push(h[e].clone());for(let e=0,t=l.length;e<t;e++){const t=l[e];let o,r;const c=t.vertexNormals,h=t.vertexColors,d=new pi(t.a+n,t.b+n,t.c+n);d.normal.copy(t.normal),void 0!==s&&d.normal.applyMatrix3(s).normalize();for(let e=0,t=c.length;e<t;e++)o=c[e].clone(),void 0!==s&&o.applyMatrix3(s).normalize(),d.vertexNormals.push(o);d.color.copy(t.color);for(let e=0,t=h.length;e<t;e++)r=h[e],d.vertexColors.push(r.clone());d.materialIndex=t.materialIndex+i,a.push(d)}for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,s=i.length;e<s;e++){const s=i[e],n=[];for(let e=0,t=s.length;e<t;e++)n.push(s[e].clone());this.faceVertexUvs[t].push(n)}}},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(e=4){const t={},i=[],s=[],n=Math.pow(10,e);for(let e=0,o=this.vertices.length;e<o;e++){const o=this.vertices[e],r=Math.round(o.x*n)+"_"+Math.round(o.y*n)+"_"+Math.round(o.z*n);void 0===t[r]?(t[r]=e,i.push(this.vertices[e]),s[e]=i.length-1):s[e]=s[t[r]]}const o=[];for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.a=s[t.a],t.b=s[t.b],t.c=s[t.c];const i=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(i[t]===i[(t+1)%3]){o.push(e);break}}for(let e=o.length-1;e>=0;e--){const t=o[e];this.faces.splice(t,1);for(let e=0,i=this.faceVertexUvs.length;e<i;e++)this.faceVertexUvs[e].splice(t,1)}const r=this.vertices.length-i.length;return this.vertices=i,r},setFromPoints:function(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];this.vertices.push(new We(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const i=this.faceVertexUvs[0],s=this.faceVertexUvs[1];let n,o;i&&i.length===t&&(n=[]),s&&s.length===t&&(o=[]);for(let r=0;r<t;r++){const t=e[r]._id;n&&n.push(i[t]),o&&o.push(s[t])}n&&(this.faceVertexUvs[0]=n),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}const t=[];for(let e=0;e<this.vertices.length;e++){const i=this.vertices[e];t.push(i.x,i.y,i.z)}const i=[],s=[],n={},o=[],r={},a=[],l={};for(let e=0;e<this.faces.length;e++){const t=this.faces[e],s=!0,n=!1,o=void 0!==this.faceVertexUvs[0][e],r=t.normal.length()>0,a=t.vertexNormals.length>0,l=1!==t.color.r||1!==t.color.g||1!==t.color.b,p=t.vertexColors.length>0;let m=0;if(m=c(m,0,0),m=c(m,1,s),m=c(m,2,n),m=c(m,3,o),m=c(m,4,r),m=c(m,5,a),m=c(m,6,l),m=c(m,7,p),i.push(m),i.push(t.a,t.b,t.c),i.push(t.materialIndex),o){const t=this.faceVertexUvs[0][e];i.push(u(t[0]),u(t[1]),u(t[2]))}if(r&&i.push(h(t.normal)),a){const e=t.vertexNormals;i.push(h(e[0]),h(e[1]),h(e[2]))}if(l&&i.push(d(t.color)),p){const e=t.vertexColors;i.push(d(e[0]),d(e[1]),d(e[2]))}}function c(e,t,i){return i?e|1<<t:e&~(1<<t)}function h(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==n[t]||(n[t]=s.length/3,s.push(e.x,e.y,e.z)),n[t]}function d(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==r[t]||(r[t]=o.length,o.push(e.getHex())),r[t]}function u(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=a.length/2,a.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=s,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=i,e},clone:function(){return(new zr).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let e=0,i=t.length;e<i;e++)this.vertices.push(t[e].clone());const i=e.colors;for(let e=0,t=i.length;e<t;e++)this.colors.push(i[e].clone());const s=e.faces;for(let e=0,t=s.length;e<t;e++)this.faces.push(s[e].clone());for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,s=i.length;e<s;e++){const s=i[e],n=[];for(let e=0,t=s.length;e<t;e++){const t=s[e];n.push(t.clone())}this.faceVertexUvs[t].push(n)}}const n=e.morphTargets;for(let e=0,t=n.length;e<t;e++){const t={};if(t.name=n[e].name,void 0!==n[e].vertices){t.vertices=[];for(let i=0,s=n[e].vertices.length;i<s;i++)t.vertices.push(n[e].vertices[i].clone())}if(void 0!==n[e].normals){t.normals=[];for(let i=0,s=n[e].normals.length;i<s;i++)t.normals.push(n[e].normals[i].clone())}this.morphTargets.push(t)}const o=e.morphNormals;for(let e=0,t=o.length;e<t;e++){const t={};if(void 0!==o[e].vertexNormals){t.vertexNormals=[];for(let i=0,s=o[e].vertexNormals.length;i<s;i++){const s=o[e].vertexNormals[i],n={};n.a=s.a.clone(),n.b=s.b.clone(),n.c=s.c.clone(),t.vertexNormals.push(n)}}if(void 0!==o[e].faceNormals){t.faceNormals=[];for(let i=0,s=o[e].faceNormals.length;i<s;i++)t.faceNormals.push(o[e].faceNormals[i].clone())}this.morphNormals.push(t)}const r=e.skinWeights;for(let e=0,t=r.length;e<t;e++)this.skinWeights.push(r[e].clone());const a=e.skinIndices;for(let e=0,t=a.length;e<t;e++)this.skinIndices.push(a[e].clone());const l=e.lineDistances;for(let e=0,t=l.length;e<t;e++)this.lineDistances.push(l[e]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class jr extends zr{constructor(e,t,i,s,n,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new ls(e,t,i,s,n,o)),this.mergeVertices()}}class Wr extends Gi{constructor(e=1,t=1,i=1,s=8,n=1,o=!1,r=0,a=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:n,openEnded:o,thetaStart:r,thetaLength:a};const l=this;s=Math.floor(s),n=Math.floor(n);const c=[],h=[],d=[],u=[];let p=0;const m=[],g=i/2;let f=0;function v(i){const n=p,o=new Le,m=new We;let v=0;const y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=s;e++)h.push(0,g*b,0),d.push(0,b,0),u.push(.5,.5),p++;const w=p;for(let e=0;e<=s;e++){const t=e/s*a+r,i=Math.cos(t),n=Math.sin(t);m.x=y*n,m.y=g*b,m.z=y*i,h.push(m.x,m.y,m.z),d.push(0,b,0),o.x=.5*i+.5,o.y=.5*n*b+.5,u.push(o.x,o.y),p++}for(let e=0;e<s;e++){const t=n+e,s=w+e;!0===i?c.push(s,s+1,t):c.push(s+1,s,t),v+=3}l.addGroup(f,v,!0===i?1:2),f+=v}!function(){const o=new We,v=new We;let y=0;const b=(t-e)/i;for(let l=0;l<=n;l++){const c=[],f=l/n,y=f*(t-e)+e;for(let e=0;e<=s;e++){const t=e/s,n=t*a+r,l=Math.sin(n),m=Math.cos(n);v.x=y*l,v.y=-f*i+g,v.z=y*m,h.push(v.x,v.y,v.z),o.set(l,b,m).normalize(),d.push(o.x,o.y,o.z),u.push(t,1-f),c.push(p++)}m.push(c)}for(let e=0;e<s;e++)for(let t=0;t<n;t++){const i=m[t][e],s=m[t+1][e],n=m[t+1][e+1],o=m[t][e+1];c.push(i,s,o),c.push(s,n,o),y+=6}l.addGroup(f,y,0),f+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Ai(h,3)),this.setAttribute("normal",new Ai(d,3)),this.setAttribute("uv",new Ai(u,2))}}const Zr=new We,qr=new We,Kr=new We,Yr=new oi;class $r extends Gi{constructor(e,t){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,e.isGeometry&&(e=(new Gi).fromGeometry(e));const i=Math.pow(10,4),s=Math.cos(Re.DEG2RAD*t),n=e.getIndex(),o=e.getAttribute("position"),r=n?n.count:o.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),h={},d=[];for(let e=0;e<r;e+=3){n?(a[0]=n.getX(e),a[1]=n.getX(e+1),a[2]=n.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:r,c:u}=Yr;if(t.fromBufferAttribute(o,a[0]),r.fromBufferAttribute(o,a[1]),u.fromBufferAttribute(o,a[2]),Yr.getNormal(Kr),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(r.x*i)},${Math.round(r.y*i)},${Math.round(r.z*i)}`,c[2]=`${Math.round(u.x*i)},${Math.round(u.y*i)},${Math.round(u.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],n=c[t],o=Yr[l[e]],r=Yr[l[t]],u=`${i}_${n}`,p=`${n}_${i}`;p in h&&h[p]?(Kr.dot(h[p].normal)<=s&&(d.push(o.x,o.y,o.z),d.push(r.x,r.y,r.z)),h[p]=null):u in h||(h[u]={index0:a[e],index1:a[t],normal:Kr.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];Zr.fromBufferAttribute(o,t),qr.fromBufferAttribute(o,i),d.push(Zr.x,Zr.y,Zr.z),d.push(qr.x,qr.y,qr.z)}this.setAttribute("position",new Ai(d,3))}}function Qr(e,t,i,s,n){let o,r;if(n===function(e,t,i,s){let n=0;for(let o=t,r=i-s;o<i;o+=s)n+=(e[r]-e[o])*(e[o+1]+e[r+1]),r=o;return n}(e,t,i,s)>0)for(o=t;o<i;o+=s)r=ya(o,e[o],e[o+1],r);else for(o=i-s;o>=t;o-=s)r=ya(o,e[o],e[o+1],r);return r&&ua(r,r.next)&&(ba(r),r=r.next),r}function Xr(e,t){if(!e)return e;t||(t=e);let i,s=e;do{if(i=!1,s.steiner||!ua(s,s.next)&&0!==da(s.prev,s,s.next))s=s.next;else{if(ba(s),s=t=s.prev,s===s.next)break;i=!0}}while(i||s!==t);return t}function Jr(e,t,i,s,n,o,r){if(!e)return;!r&&o&&function(e,t,i,s){let n=e;do{null===n.z&&(n.z=aa(n.x,n.y,t,i,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i,s,n,o,r,a,l,c=1;do{for(i=e,e=null,o=null,r=0;i;){for(r++,s=i,a=0,t=0;t<c&&(a++,s=s.nextZ,s);t++);for(l=c;a>0||l>0&&s;)0!==a&&(0===l||!s||i.z<=s.z)?(n=i,i=i.nextZ,a--):(n=s,s=s.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=s}o.nextZ=null,c*=2}while(r>1)}(n)}(e,s,n,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?ta(e,s,n,o):ea(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),ba(e),e=l.next,c=l.next;else if((e=l)===c){r?1===r?Jr(e=ia(Xr(e),t,i),t,i,s,n,o,2):2===r&&sa(e,t,i,s,n,o):Jr(Xr(e),t,i,s,n,o,1);break}}function ea(e){const t=e.prev,i=e,s=e.next;if(da(t,i,s)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(ca(t.x,t.y,i.x,i.y,s.x,s.y,n.x,n.y)&&da(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ta(e,t,i,s){const n=e.prev,o=e,r=e.next;if(da(n,o,r)>=0)return!1;const a=n.x<o.x?n.x<r.x?n.x:r.x:o.x<r.x?o.x:r.x,l=n.y<o.y?n.y<r.y?n.y:r.y:o.y<r.y?o.y:r.y,c=n.x>o.x?n.x>r.x?n.x:r.x:o.x>r.x?o.x:r.x,h=n.y>o.y?n.y>r.y?n.y:r.y:o.y>r.y?o.y:r.y,d=aa(a,l,t,i,s),u=aa(c,h,t,i,s);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&ca(n.x,n.y,o.x,o.y,r.x,r.y,p.x,p.y)&&da(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&ca(n.x,n.y,o.x,o.y,r.x,r.y,m.x,m.y)&&da(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&ca(n.x,n.y,o.x,o.y,r.x,r.y,p.x,p.y)&&da(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&ca(n.x,n.y,o.x,o.y,r.x,r.y,m.x,m.y)&&da(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function ia(e,t,i){let s=e;do{const n=s.prev,o=s.next.next;!ua(n,o)&&pa(n,s,s.next,o)&&fa(n,o)&&fa(o,n)&&(t.push(n.i/i),t.push(s.i/i),t.push(o.i/i),ba(s),ba(s.next),s=e=o),s=s.next}while(s!==e);return Xr(s)}function sa(e,t,i,s,n,o){let r=e;do{let e=r.next.next;for(;e!==r.prev;){if(r.i!==e.i&&ha(r,e)){let a=va(r,e);return r=Xr(r,r.next),a=Xr(a,a.next),Jr(r,t,i,s,n,o),void Jr(a,t,i,s,n,o)}e=e.next}r=r.next}while(r!==e)}function na(e,t){return e.x-t.x}function oa(e,t){if(t=function(e,t){let i=t;const s=e.x,n=e.y;let o,r=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r){if(r=e,e===s){if(n===i.y)return i;if(n===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(s===r)return o;const a=o,l=o.x,c=o.y;let h,d=1/0;i=o;do{s>=i.x&&i.x>=l&&s!==i.x&&ca(n<c?s:r,n,l,c,n<c?r:s,n,i.x,i.y)&&(h=Math.abs(n-i.y)/(s-i.x),fa(i,e)&&(h<d||h===d&&(i.x>o.x||i.x===o.x&&ra(o,i)))&&(o=i,d=h)),i=i.next}while(i!==a);return o}(e,t)){const i=va(t,e);Xr(t,t.next),Xr(i,i.next)}}function ra(e,t){return da(e.prev,e,t.prev)<0&&da(t.next,e,e.next)<0}function aa(e,t,i,s,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function la(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function ca(e,t,i,s,n,o,r,a){return(n-r)*(t-a)-(e-r)*(o-a)>=0&&(e-r)*(s-a)-(i-r)*(t-a)>=0&&(i-r)*(o-a)-(n-r)*(s-a)>=0}function ha(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&pa(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(fa(e,t)&&fa(t,e)&&function(e,t){let i=e,s=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)&&(da(e.prev,e,t.prev)||da(e,t.prev,t))||ua(e,t)&&da(e.prev,e,e.next)>0&&da(t.prev,t,t.next)>0)}function da(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ua(e,t){return e.x===t.x&&e.y===t.y}function pa(e,t,i,s){const n=ga(da(e,t,i)),o=ga(da(e,t,s)),r=ga(da(i,s,e)),a=ga(da(i,s,t));return n!==o&&r!==a||!(0!==n||!ma(e,i,t))||!(0!==o||!ma(e,s,t))||!(0!==r||!ma(i,e,s))||!(0!==a||!ma(i,t,s))}function ma(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ga(e){return e>0?1:e<0?-1:0}function fa(e,t){return da(e.prev,e,e.next)<0?da(e,t,e.next)>=0&&da(e,e.prev,t)>=0:da(e,t,e.prev)<0||da(e,e.next,t)<0}function va(e,t){const i=new wa(e.i,e.x,e.y),s=new wa(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s}function ya(e,t,i,s){const n=new wa(e,t,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function ba(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wa(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Sa={area:function(e){const t=e.length;let i=0;for(let s=t-1,n=0;n<t;s=n++)i+=e[s].x*e[n].y-e[n].x*e[s].y;return.5*i},isClockWise:function(e){return Sa.area(e)<0},triangulateShape:function(e,t){const i=[],s=[],n=[];Ta(e),Ea(i,e);let o=e.length;t.forEach(Ta);for(let e=0;e<t.length;e++)s.push(o),o+=t[e].length,Ea(i,t[e]);const r=function(e,t,i){i=i||2;const s=t&&t.length,n=s?t[0]*i:e.length;let o=Qr(e,0,n,i,!0);const r=[];if(!o||o.next===o.prev)return r;let a,l,c,h,d,u,p;if(s&&(o=function(e,t,i,s){const n=[];let o,r,a,l,c;for(o=0,r=t.length;o<r;o++)a=t[o]*s,l=o<r-1?t[o+1]*s:e.length,c=Qr(e,a,l,s,!1),c===c.next&&(c.steiner=!0),n.push(la(c));for(n.sort(na),o=0;o<n.length;o++)oa(n[o],i),i=Xr(i,i.next);return i}(e,t,o,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let t=i;t<n;t+=i)d=e[t],u=e[t+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return Jr(o,r,i,a,l,p),r}(i,s);for(let e=0;e<r.length;e+=3)n.push(r.slice(e,e+3));return n}};function Ta(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ea(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class _a extends Gi{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],n=[];for(let t=0,i=e.length;t<i;t++)o(e[t]);function o(e){const o=[],r=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:xa;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let f,v,y,b,w,S=!1;m&&(f=m.getSpacedPoints(a),S=!0,c=!1,v=m.computeFrenetFrames(a,!1),y=new We,b=new We,w=new We),c||(p=0,h=0,d=0,u=0);const T=e.extractPoints(r);let E=T.shape;const _=T.holes;if(!Sa.isClockWise(E)){E=E.reverse();for(let e=0,t=_.length;e<t;e++){const t=_[e];Sa.isClockWise(t)&&(_[e]=t.reverse())}}const x=Sa.triangulateShape(E,_),M=E;for(let e=0,t=_.length;e<t;e++){const t=_[e];E=E.concat(t)}function P(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const A=E.length,O=x.length;function D(e,t,i){let s,n,o;const r=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=r*r+a*a,d=r*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),u=Math.sqrt(l*l+c*c),p=t.x-a/d,m=t.y+r/d,g=((i.x-c/u-p)*c-(i.y+l/u-m)*l)/(r*c-a*l);s=p+r*g-e.x,n=m+a*g-e.y;const f=s*s+n*n;if(f<=2)return new Le(s,n);o=Math.sqrt(f/2)}else{let e=!1;r>Number.EPSILON?l>Number.EPSILON&&(e=!0):r<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(s=-a,n=r,o=Math.sqrt(h)):(s=r,n=a,o=Math.sqrt(h/2))}return new Le(s/o,n/o)}const I=[];for(let e=0,t=M.length,i=t-1,s=e+1;e<t;e++,i++,s++)i===t&&(i=0),s===t&&(s=0),I[e]=D(M[e],M[i],M[s]);const C=[];let R,L=I.concat();for(let e=0,t=_.length;e<t;e++){const t=_[e];R=[];for(let e=0,i=t.length,s=i-1,n=e+1;e<i;e++,s++,n++)s===i&&(s=0),n===i&&(n=0),R[e]=D(t[e],t[s],t[n]);C.push(R),L=L.concat(R)}for(let e=0;e<p;e++){const t=e/p,i=h*Math.cos(t*Math.PI/2),s=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=M.length;e<t;e++){const t=P(M[e],I[e],s);F(t.x,t.y,-i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];R=C[e];for(let e=0,n=t.length;e<n;e++){const n=P(t[e],R[e],s);F(n.x,n.y,-i)}}}const N=d+u;for(let e=0;e<A;e++){const t=c?P(E[e],L[e],N):E[e];S?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),w.copy(f[0]).add(b).add(y),F(w.x,w.y,w.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const i=c?P(E[t],L[t],N):E[t];S?(b.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),w.copy(f[e]).add(b).add(y),F(w.x,w.y,w.z)):F(i.x,i.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=h*Math.cos(t*Math.PI/2),s=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=M.length;e<t;e++){const t=P(M[e],I[e],s);F(t.x,t.y,l+i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];R=C[e];for(let e=0,n=t.length;e<n;e++){const n=P(t[e],R[e],s);S?F(n.x,n.y+f[a-1].y,f[a-1].x+i):F(n.x,n.y,l+i)}}}function k(e,t){let i=e.length;for(;--i>=0;){const s=i;let n=i-1;n<0&&(n=e.length-1);for(let e=0,i=a+2*p;e<i;e++){const i=A*e,o=A*(e+1);U(t+s+i,t+n+i,t+n+o,t+s+o)}}}function F(e,t,i){o.push(e),o.push(t),o.push(i)}function B(e,t,n){H(e),H(t),H(n);const o=s.length/3,r=g.generateTopUV(i,s,o-3,o-2,o-1);G(r[0]),G(r[1]),G(r[2])}function U(e,t,n,o){H(e),H(t),H(o),H(t),H(n),H(o);const r=s.length/3,a=g.generateSideWallUV(i,s,r-6,r-3,r-2,r-1);G(a[0]),G(a[1]),G(a[3]),G(a[1]),G(a[2]),G(a[3])}function H(e){s.push(o[3*e+0]),s.push(o[3*e+1]),s.push(o[3*e+2])}function G(e){n.push(e.x),n.push(e.y)}!function(){const e=s.length/3;if(c){let e=0,t=A*e;for(let e=0;e<O;e++){const i=x[e];B(i[2]+t,i[1]+t,i[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<O;e++){const i=x[e];B(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<O;e++){const t=x[e];B(t[2],t[1],t[0])}for(let e=0;e<O;e++){const t=x[e];B(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}i.addGroup(e,s.length/3-e,0)}(),function(){const e=s.length/3;let t=0;k(M,t),t+=M.length;for(let e=0,i=_.length;e<i;e++){const i=_[e];k(i,t),t+=i.length}i.addGroup(e,s.length/3-e,1)}()}this.setAttribute("position",new Ai(s,3)),this.setAttribute("uv",new Ai(n,2)),this.computeVertexNormals()}toJSON(){const e=Gi.prototype.toJSON.call(this);return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,s=e.length;t<s;t++){const s=e[t];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}}const xa={generateTopUV:function(e,t,i,s,n){const o=t[3*i],r=t[3*i+1],a=t[3*s],l=t[3*s+1],c=t[3*n],h=t[3*n+1];return[new Le(o,r),new Le(a,l),new Le(c,h)]},generateSideWallUV:function(e,t,i,s,n,o){const r=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*s],h=t[3*s+1],d=t[3*s+2],u=t[3*n],p=t[3*n+1],m=t[3*n+2],g=t[3*o],f=t[3*o+1],v=t[3*o+2];return Math.abs(a-h)<.01?[new Le(r,1-l),new Le(c,1-d),new Le(u,1-m),new Le(g,1-v)]:[new Le(a,1-l),new Le(h,1-d),new Le(p,1-m),new Le(f,1-v)]}};class Ma extends zr{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new _a(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,s=e.length;t<s;t++){const s=e[t];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}}function Pa(e,t,i){Gi.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};const s=[],n=[],o=[],r=[],a=1e-5,l=new We,c=new We,h=new We,d=new We,u=new We;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let s=0;s<=i;s++){const p=s/i;for(let i=0;i<=t;i++){const s=i/t;e(s,p,c),n.push(c.x,c.y,c.z),s-a>=0?(e(s-a,p,h),d.subVectors(c,h)):(e(s+a,p,h),d.subVectors(h,c)),p-a>=0?(e(s,p-a,h),u.subVectors(c,h)):(e(s,p+a,h),u.subVectors(h,c)),l.crossVectors(d,u).normalize(),o.push(l.x,l.y,l.z),r.push(s,p)}}for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=e*p+i,n=e*p+i+1,o=(e+1)*p+i+1,r=(e+1)*p+i;s.push(t,n,r),s.push(n,o,r)}this.setIndex(s),this.setAttribute("position",new Ai(n,3)),this.setAttribute("normal",new Ai(o,3)),this.setAttribute("uv",new Ai(r,2))}function Aa(e,t,i){zr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Pa(e,t,i)),this.mergeVertices()}Pa.prototype=Object.create(Gi.prototype),Pa.prototype.constructor=Pa,Aa.prototype=Object.create(zr.prototype),Aa.prototype.constructor=Aa;class Oa extends zr{constructor(e,t,i,s){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s},this.fromBufferGeometry(new xs(e,t,i,s)),this.mergeVertices()}}class Da extends Gi{constructor(e,t=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],n=[],o=[];let r=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(r,a,t),r+=a,a=0;function l(e){const r=s.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===Sa.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===Sa.isClockWise(t)&&(h[e]=t.reverse())}const d=Sa.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];s.push(t.x,t.y,0),n.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],s=t[0]+r,n=t[1]+r,o=t[2]+r;i.push(s,n,o),a+=3}}this.setIndex(i),this.setAttribute("position",new Ai(s,3)),this.setAttribute("normal",new Ai(n,3)),this.setAttribute("uv",new Ai(o,2))}toJSON(){const e=Gi.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i];t.shapes.push(s.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class Ia extends zr{constructor(e,t){super(),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Da(e,t)),this.mergeVertices()}toJSON(){const e=zr.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i];t.shapes.push(s.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class Ca extends Gi{constructor(e=1,t=8,i=6,s=0,n=2*Math.PI,o=0,r=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:n,thetaStart:o,thetaLength:r},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(o+r,Math.PI);let l=0;const c=[],h=new We,d=new We,u=[],p=[],m=[],g=[];for(let u=0;u<=i;u++){const f=[],v=u/i;let y=0;0==u&&0==o?y=.5/t:u==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;h.x=-e*Math.cos(s+a*n)*Math.sin(o+v*r),h.y=e*Math.cos(o+v*r),h.z=e*Math.sin(s+a*n)*Math.sin(o+v*r),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),g.push(a+y,1-v),f.push(l++)}c.push(f)}for(let e=0;e<i;e++)for(let s=0;s<t;s++){const t=c[e][s+1],n=c[e][s],r=c[e+1][s],l=c[e+1][s+1];(0!==e||o>0)&&u.push(t,n,l),(e!==i-1||a<Math.PI)&&u.push(n,r,l)}this.setIndex(u),this.setAttribute("position",new Ai(p,3)),this.setAttribute("normal",new Ai(m,3)),this.setAttribute("uv",new Ai(g,2))}}class Ra extends zr{constructor(e,t,i,s,n,o,r){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:n,thetaStart:o,thetaLength:r},this.fromBufferGeometry(new Ca(e,t,i,s,n,o,r)),this.mergeVertices()}}class La extends Gi{constructor(e){super(),this.type="WireframeGeometry";const t=[],i=[0,0],s={},n=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0;e<3;e++){const o=t[n[e]],r=t[n[(e+1)%3]];i[0]=Math.min(o,r),i[1]=Math.max(o,r);const a=i[0]+","+i[1];void 0===s[a]&&(s[a]={index1:i[0],index2:i[1]})}}for(const i in s){const n=s[i];let o=e.vertices[n.index1];t.push(o.x,o.y,o.z),o=e.vertices[n.index2],t.push(o.x,o.y,o.z)}}else if(e&&e.isBufferGeometry){const n=new We;if(null!==e.index){const o=e.attributes.position,r=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:r.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],n=t.start;for(let e=n,o=n+t.count;e<o;e+=3)for(let t=0;t<3;t++){const n=r.getX(e+t),o=r.getX(e+(t+1)%3);i[0]=Math.min(n,o),i[1]=Math.max(n,o);const a=i[0]+","+i[1];void 0===s[a]&&(s[a]={index1:i[0],index2:i[1]})}}for(const e in s){const i=s[e];n.fromBufferAttribute(o,i.index1),t.push(n.x,n.y,n.z),n.fromBufferAttribute(o,i.index2),t.push(n.x,n.y,n.z)}}else{const i=e.attributes.position;for(let e=0,s=i.count/3;e<s;e++)for(let s=0;s<3;s++){const o=3*e+s;n.fromBufferAttribute(i,o),t.push(n.x,n.y,n.z);const r=3*e+(s+1)%3;n.fromBufferAttribute(i,r),t.push(n.x,n.y,n.z)}}}this.setAttribute("position",new Ai(t,3))}}function Na(e){gi.call(this),this.type="ShadowMaterial",this.color=new ui(0),this.transparent=!0,this.setValues(e)}function ka(e){us.call(this,e),this.type="RawShaderMaterial"}function Fa(e){gi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ui(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Te,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Ba(e){Fa.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Le(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Re.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Ua(e){gi.call(this),this.type="MeshPhongMaterial",this.color=new ui(16777215),this.specular=new ui(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Te,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ha(e){gi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ui(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Te,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ga(e){gi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Te,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Va(e){gi.call(this),this.type="MeshLambertMaterial",this.color=new ui(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function za(e){gi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ui(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Te,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ja(e){vr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Na.prototype=Object.create(gi.prototype),Na.prototype.constructor=Na,Na.prototype.isShadowMaterial=!0,Na.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this},ka.prototype=Object.create(us.prototype),ka.prototype.constructor=ka,ka.prototype.isRawShaderMaterial=!0,Fa.prototype=Object.create(gi.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isMeshStandardMaterial=!0,Fa.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Ba.prototype=Object.create(Fa.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isMeshPhysicalMaterial=!0,Ba.prototype.copy=function(e){return Fa.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ui).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Ua.prototype=Object.create(gi.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isMeshPhongMaterial=!0,Ua.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ha.prototype=Object.create(gi.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isMeshToonMaterial=!0,Ha.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ga.prototype=Object.create(gi.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isMeshNormalMaterial=!0,Ga.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Va.prototype=Object.create(gi.prototype),Va.prototype.constructor=Va,Va.prototype.isMeshLambertMaterial=!0,Va.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},za.prototype=Object.create(gi.prototype),za.prototype.constructor=za,za.prototype.isMeshMatcapMaterial=!0,za.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ja.prototype=Object.create(vr.prototype),ja.prototype.constructor=ja,ja.prototype.isLineDashedMaterial=!0,ja.prototype.copy=function(e){return vr.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Wa=Object.freeze({__proto__:null,ShadowMaterial:Na,SpriteMaterial:Fo,RawShaderMaterial:ka,ShaderMaterial:us,PointsMaterial:Ar,MeshPhysicalMaterial:Ba,MeshStandardMaterial:Fa,MeshPhongMaterial:Ua,MeshToonMaterial:Ha,MeshNormalMaterial:Ga,MeshLambertMaterial:Va,MeshDepthMaterial:wo,MeshDistanceMaterial:So,MeshBasicMaterial:fi,MeshMatcapMaterial:za,LineDashedMaterial:ja,LineBasicMaterial:vr,Material:gi});const Za={arraySlice:function(e,t,i){return Za.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const s=e.length,n=new e.constructor(s);for(let o=0,r=0;r!==s;++o){const s=i[o]*t;for(let i=0;i!==t;++i)n[r++]=e[s+i]}return n},flattenJSON:function(e,t,i,s){let n=1,o=e[0];for(;void 0!==o&&void 0===o[s];)o=e[n++];if(void 0===o)return;let r=o[s];if(void 0!==r)if(Array.isArray(r))do{r=o[s],void 0!==r&&(t.push(o.time),i.push.apply(i,r)),o=e[n++]}while(void 0!==o);else if(void 0!==r.toArray)do{r=o[s],void 0!==r&&(t.push(o.time),r.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{r=o[s],void 0!==r&&(t.push(o.time),i.push(r)),o=e[n++]}while(void 0!==o)},subclip:function(e,t,i,s,n=30){const o=e.clone();o.name=t;const r=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*n;if(!(o<i||o>=s)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=Za.convertArray(l,t.times.constructor),t.values=Za.convertArray(c,t.values.constructor),r.push(t))}o.tracks=r;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,i=e,s=30){s<=0&&(s=30);const n=i.tracks.length,o=t/s;for(let t=0;t<n;++t){const s=i.tracks[t],n=s.ValueTypeName;if("bool"===n||"string"===n)continue;const r=e.tracks.find((function(e){return e.name===s.name&&e.ValueTypeName===n}));if(void 0===r)continue;let a=0;const l=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const d=s.times.length-1;let u;if(o<=s.times[0]){const e=a,t=l-a;u=Za.arraySlice(s.values,e,t)}else if(o>=s.times[d]){const e=d*l+a,t=e+l-a;u=Za.arraySlice(s.values,e,t)}else{const e=s.createInterpolant(),t=a,i=l-a;e.evaluate(o),u=Za.arraySlice(e.resultBuffer,t,i)}"quaternion"===n&&(new je).fromArray(u).normalize().conjugate().toArray(u);const p=r.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===n)je.multiplyQuaternionsFlat(r.values,t,u,0,r.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)r.values[t+i]-=u[i]}}}return e.blendMode=2501,e}};function qa(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Ka(e,t,i,s){qa.call(this,e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Ya(e,t,i,s){qa.call(this,e,t,i,s)}function $a(e,t,i,s){qa.call(this,e,t,i,s)}function Qa(e,t,i,s){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Za.convertArray(t,this.TimeBufferType),this.values=Za.convertArray(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}function Xa(e,t,i){Qa.call(this,e,t,i)}function Ja(e,t,i,s){Qa.call(this,e,t,i,s)}function el(e,t,i,s){Qa.call(this,e,t,i,s)}function tl(e,t,i,s){qa.call(this,e,t,i,s)}function il(e,t,i,s){Qa.call(this,e,t,i,s)}function sl(e,t,i,s){Qa.call(this,e,t,i,s)}function nl(e,t,i,s){Qa.call(this,e,t,i,s)}function ol(e,t=-1,i,s=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Re.generateUUID(),this.duration<0&&this.resetDuration()}function rl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return el;case"vector":case"vector2":case"vector3":case"vector4":return nl;case"color":return Ja;case"quaternion":return il;case"bool":case"boolean":return Xa;case"string":return sl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];Za.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(qa.prototype,{evaluate:function(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],n=t[i-1];e:{t:{let o;i:{s:if(!(e<s)){for(let o=i+2;;){if(void 0===s){if(e<n)break s;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===o)break;if(n=s,s=t[++i],e<s)break t}o=t.length;break i}if(e>=n)break e;{const r=t[1];e<r&&(i=2,n=r);for(let o=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(i===o)break;if(s=n,n=t[--i-1],e>=n)break t}o=i,i=0}}for(;i<o;){const s=i+o>>>1;e<t[s]?o=s:i=s+1}if(s=t[i],n=t[i-1],void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(void 0===s)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,s)}return this.interpolate_(i,n,e,s)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s;for(let e=0;e!==s;++e)t[e]=i[n+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(qa.prototype,{beforeStart_:qa.prototype.copySampleValue_,afterEnd_:qa.prototype.copySampleValue_}),Ka.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ka,DefaultSettings_:{endingStart:ge,endingEnd:ge},intervalChanged_:function(e,t,i){const s=this.parameterPositions;let n=e-2,o=e+1,r=s[n],a=s[o];if(void 0===r)switch(this.getSettings_().endingStart){case fe:n=e,r=2*t-i;break;case ve:n=s.length-2,r=t+s[n]-s[n+1];break;default:n=e,r=i}if(void 0===a)switch(this.getSettings_().endingEnd){case fe:o=e,a=2*i-t;break;case ve:o=1,a=i+s[1]-s[0];break;default:o=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-r),this._weightNext=l/(a-i),this._offsetPrev=n*c,this._offsetNext=o*c},interpolate_:function(e,t,i,s){const n=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=e*r,l=a-r,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(s-t),m=p*p,g=m*p,f=-d*g+2*d*m-d*p,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,y=(-1-u)*g+(1.5+u)*m+.5*p,b=u*g-u*m;for(let e=0;e!==r;++e)n[e]=f*o[c+e]+v*o[l+e]+y*o[a+e]+b*o[h+e];return n}}),Ya.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ya,interpolate_:function(e,t,i,s){const n=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=e*r,l=a-r,c=(i-t)/(s-t),h=1-c;for(let e=0;e!==r;++e)n[e]=o[l+e]*h+o[a+e]*c;return n}}),$a.prototype=Object.assign(Object.create(qa.prototype),{constructor:$a,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Qa,{toJSON:function(e){const t=e.constructor;let i;if(void 0!==t.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Za.convertArray(e.times,Array),values:Za.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}}),Object.assign(Qa.prototype,{constructor:Qa,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:pe,InterpolantFactoryMethodDiscrete:function(e){return new $a(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Ya(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Ka(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case ue:t=this.InterpolantFactoryMethodDiscrete;break;case pe:t=this.InterpolantFactoryMethodLinear;break;case me:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ue;case this.InterpolantFactoryMethodLinear:return pe;case this.InterpolantFactoryMethodSmooth:return me}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this},trim:function(e,t){const i=this.times,s=i.length;let n=0,o=s-1;for(;n!==s&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==s){n>=o&&(o=Math.max(o,1),n=o-1);const e=this.getValueSize();this.times=Za.arraySlice(i,n,o),this.values=Za.arraySlice(this.values,n*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==n;t++){const s=i[t];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,s,o),e=!1;break}o=s}if(void 0!==s&&Za.isTypedArray(s))for(let t=0,i=s.length;t!==i;++t){const i=s[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e},optimize:function(){const e=Za.arraySlice(this.times),t=Za.arraySlice(this.values),i=this.getValueSize(),s=this.getInterpolation()===me,n=e.length-1;let o=1;for(let r=1;r<n;++r){let n=!1;const a=e[r];if(a!==e[r+1]&&(1!==r||a!==a[0]))if(s)n=!0;else{const e=r*i,s=e-i,o=e+i;for(let r=0;r!==i;++r){const i=t[e+r];if(i!==t[s+r]||i!==t[o+r]){n=!0;break}}}if(n){if(r!==o){e[o]=e[r];const s=r*i,n=o*i;for(let e=0;e!==i;++e)t[n+e]=t[s+e]}++o}}if(n>0){e[o]=e[n];for(let e=n*i,s=o*i,r=0;r!==i;++r)t[s+r]=t[e+r];++o}return o!==e.length?(this.times=Za.arraySlice(e,0,o),this.values=Za.arraySlice(t,0,o*i)):(this.times=e,this.values=t),this},clone:function(){const e=Za.arraySlice(this.times,0),t=Za.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),Xa.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Xa,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ue,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ja.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Ja,ValueTypeName:"color"}),el.prototype=Object.assign(Object.create(Qa.prototype),{constructor:el,ValueTypeName:"number"}),tl.prototype=Object.assign(Object.create(qa.prototype),{constructor:tl,interpolate_:function(e,t,i,s){const n=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=(i-t)/(s-t);let l=e*r;for(let e=l+r;l!==e;l+=4)je.slerpFlat(n,0,o,l-r,o,l,a);return n}}),il.prototype=Object.assign(Object.create(Qa.prototype),{constructor:il,ValueTypeName:"quaternion",DefaultInterpolation:pe,InterpolantFactoryMethodLinear:function(e){return new tl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),sl.prototype=Object.assign(Object.create(Qa.prototype),{constructor:sl,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ue,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),nl.prototype=Object.assign(Object.create(Qa.prototype),{constructor:nl,ValueTypeName:"vector"}),Object.assign(ol,{parse:function(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let e=0,n=i.length;e!==n;++e)t.push(rl(i[e]).scale(s));const n=new ol(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n},toJSON:function(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,s=i.length;e!==s;++e)t.push(Qa.toJSON(i[e]));return s},CreateFromMorphTargetSequence:function(e,t,i,s){const n=t.length,o=[];for(let e=0;e<n;e++){let r=[],a=[];r.push((e+n-1)%n,e,(e+1)%n),a.push(0,1,0);const l=Za.getKeyframeOrder(r);r=Za.sortedArray(r,1,l),a=Za.sortedArray(a,1,l),s||0!==r[0]||(r.push(n),a.push(a[0])),o.push(new el(".morphTargetInfluences["+t[e].name+"]",r,a).scale(1/i))}return new ol(e,-1,o)},findByName:function(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){const s={},n=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.name.match(n);if(o&&o.length>1){const e=o[1];let t=s[e];t||(s[e]=t=[]),t.push(i)}}const o=[];for(const e in s)o.push(ol.CreateFromMorphTargetSequence(e,s[e],t,i));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,s,n){if(0!==i.length){const o=[],r=[];Za.flattenJSON(i,o,r,s),0!==o.length&&n.push(new e(t,o,r))}},s=[],n=e.name||"default",o=e.fps||30,r=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const n=l[e].keys;if(n&&0!==n.length)if(n[0].morphTargets){const e={};let t;for(t=0;t<n.length;t++)if(n[t].morphTargets)for(let i=0;i<n[t].morphTargets.length;i++)e[n[t].morphTargets[i]]=-1;for(const i in e){const e=[],o=[];for(let s=0;s!==n[t].morphTargets.length;++s){const s=n[t];e.push(s.time),o.push(s.morphTarget===i?1:0)}s.push(new el(".morphTargetInfluence["+i+"]",e,o))}a=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";i(nl,o+".position",n,"pos",s),i(il,o+".quaternion",n,"rot",s),i(nl,o+".scale",n,"scl",s)}}return 0===s.length?null:new ol(n,a,s,r)}}),Object.assign(ol.prototype,{resetDuration:function(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new ol(this.name,this.duration,e,this.blendMode)},toJSON:function(){return ol.toJSON(this)}});const al={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};const ll=new function(e,t,i){const s=this;let n,o=!1,r=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===o&&void 0!==s.onStart&&s.onStart(e,r,a),o=!0},this.itemEnd=function(e){r++,void 0!==s.onProgress&&s.onProgress(e,r,a),r===a&&(o=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(e){void 0!==s.onError&&s.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],s=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return s}return null}};function cl(e){this.manager=void 0!==e?e:ll,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(cl.prototype,{load:function(){},loadAsync:function(e,t){const i=this;return new Promise((function(s,n){i.load(e,s,t,n)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const hl={};function dl(e){cl.call(this,e)}function ul(e){cl.call(this,e)}function pl(e){cl.call(this,e)}function ml(e){cl.call(this,e)}function gl(e){cl.call(this,e)}function fl(e){cl.call(this,e)}function vl(e){cl.call(this,e)}function yl(){this.type="Curve",this.arcLengthDivisions=200}function bl(e,t,i,s,n,o,r,a){yl.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=s||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=r||!1,this.aRotation=a||0}function wl(e,t,i,s,n,o){bl.call(this,e,t,i,i,s,n,o),this.type="ArcCurve"}function Sl(){let e=0,t=0,i=0,s=0;function n(n,o,r,a){e=n,t=r,i=-3*n+3*o-2*r-a,s=2*n-2*o+r+a}return{initCatmullRom:function(e,t,i,s,o){n(t,i,o*(i-e),o*(s-t))},initNonuniformCatmullRom:function(e,t,i,s,o,r,a){let l=(t-e)/o-(i-e)/(o+r)+(i-t)/r,c=(i-t)/r-(s-t)/(r+a)+(s-i)/a;l*=r,c*=r,n(t,i,l,c)},calc:function(n){const o=n*n;return e+t*n+i*o+s*(o*n)}}}dl.prototype=Object.assign(Object.create(cl.prototype),{constructor:dl,load:function(e,t,i,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=al.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;if(void 0!==hl[e])return void hl[e].push({onLoad:t,onProgress:i,onError:s});const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(r){const i=r[1],o=!!r[2];let a=r[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let s;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);s="blob"===o?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;s=t.parseFromString(a,i);break;case"json":s=JSON.parse(a);break;default:s=a}setTimeout((function(){t&&t(s),n.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){s&&s(t),n.manager.itemError(e),n.manager.itemEnd(e)}),0)}}else{hl[e]=[],hl[e].push({onLoad:t,onProgress:i,onError:s}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const i=this.response,s=hl[e];if(delete hl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),al.add(e,i);for(let e=0,t=s.length;e<t;e++){const t=s[e];t.onLoad&&t.onLoad(i)}n.manager.itemEnd(e)}else{for(let e=0,i=s.length;e<i;e++){const i=s[e];i.onError&&i.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const i=hl[e];for(let e=0,s=i.length;e<s;e++){const s=i[e];s.onProgress&&s.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const i=hl[e];delete hl[e];for(let e=0,s=i.length;e<s;e++){const s=i[e];s.onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const i=hl[e];delete hl[e];for(let e=0,s=i.length;e<s;e++){const s=i[e];s.onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return n.manager.itemStart(e),a},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),ul.prototype=Object.assign(Object.create(cl.prototype),{constructor:ul,load:function(e,t,i,s){const n=this,o=new dl(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){s?s(t):console.error(t),n.manager.itemError(e)}}),i,s)},parse:function(e){const t=[];for(let i=0;i<e.length;i++){const s=ol.parse(e[i]);t.push(s)}return t}}),pl.prototype=Object.assign(Object.create(cl.prototype),{constructor:pl,load:function(e,t,i,s){const n=this,o=[],r=new kr,a=new dl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(n.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=n.parse(e,!0);o[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(r.minFilter=C),r.image=o,r.format=i.format,r.needsUpdate=!0,t&&t(r))}),i,s)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=n.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)o[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),o[t].format=i.format,o[t].width=i.width,o[t].height=i.height}r.image=o}else r.image.width=i.width,r.image.height=i.height,r.mipmaps=i.mipmaps;1===i.mipmapCount&&(r.minFilter=C),r.format=i.format,r.needsUpdate=!0,t&&t(r)}),i,s);return r}}),ml.prototype=Object.assign(Object.create(cl.prototype),{constructor:ml,load:function(e,t,i,s){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=al.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;const r=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),al.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),s&&s(t),n.manager.itemError(e),n.manager.itemEnd(e)}return r.addEventListener("load",a,!1),r.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),n.manager.itemStart(e),r.src=e,r}}),gl.prototype=Object.assign(Object.create(cl.prototype),{constructor:gl,load:function(e,t,i,s){const n=new vs,o=new ml(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let r=0;function a(i){o.load(e[i],(function(e){n.images[i]=e,r++,6===r&&(n.needsUpdate=!0,t&&t(n))}),void 0,s)}for(let t=0;t<e.length;++t)a(t);return n}}),fl.prototype=Object.assign(Object.create(cl.prototype),{constructor:fl,load:function(e,t,i,s){const n=this,o=new bs,r=new dl(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(n.withCredentials),r.load(e,(function(e){const i=n.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:x,o.wrapT=void 0!==i.wrapT?i.wrapT:x,o.magFilter=void 0!==i.magFilter?i.magFilter:C,o.minFilter=void 0!==i.minFilter?i.minFilter:C,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=N),1===i.mipmapCount&&(o.minFilter=C),o.needsUpdate=!0,t&&t(o,i))}),i,s),o}}),vl.prototype=Object.assign(Object.create(cl.prototype),{constructor:vl,load:function(e,t,i,s){const n=new Ue,o=new ml(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){n.image=i;const s=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=s?$:Q,n.needsUpdate=!0,void 0!==t&&t(n)}),i,s),n}}),Object.assign(yl.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),n=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),n+=i.distanceTo(s),t.push(n),s=i;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const i=this.getLengths();let s=0;const n=i.length;let o;o=t||e*i[n-1];let r,a=0,l=n-1;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),r=i[s]-o,r<0)a=s+1;else{if(!(r>0)){l=s;break}l=s-1}if(s=l,i[s]===o)return s/(n-1);const c=i[s];return(s+(o-c)/(i[s+1]-c))/(n-1)},getTangent:function(e,t){const i=1e-4;let s=e-i,n=e+i;s<0&&(s=0),n>1&&(n=1);const o=this.getPoint(s),r=this.getPoint(n),a=t||(o.isVector2?new Le:new We);return a.copy(r).sub(o).normalize(),a},getTangentAt:function(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){const i=new We,s=[],n=[],o=[],r=new We,a=new bt;for(let t=0;t<=e;t++){const i=t/e;s[t]=this.getTangentAt(i,new We),s[t].normalize()}n[0]=new We,o[0]=new We;let l=Number.MAX_VALUE;const c=Math.abs(s[0].x),h=Math.abs(s[0].y),d=Math.abs(s[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),r.crossVectors(s[0],i).normalize(),n[0].crossVectors(s[0],r),o[0].crossVectors(s[0],n[0]);for(let t=1;t<=e;t++){if(n[t]=n[t-1].clone(),o[t]=o[t-1].clone(),r.crossVectors(s[t-1],s[t]),r.length()>Number.EPSILON){r.normalize();const e=Math.acos(Re.clamp(s[t-1].dot(s[t]),-1,1));n[t].applyMatrix4(a.makeRotationAxis(r,e))}o[t].crossVectors(s[t],n[t])}if(!0===t){let t=Math.acos(Re.clamp(n[0].dot(n[e]),-1,1));t/=e,s[0].dot(r.crossVectors(n[0],n[e]))>0&&(t=-t);for(let i=1;i<=e;i++)n[i].applyMatrix4(a.makeRotationAxis(s[i],t*i)),o[i].crossVectors(s[i],n[i])}return{tangents:s,normals:n,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),bl.prototype=Object.create(yl.prototype),bl.prototype.constructor=bl,bl.prototype.isEllipseCurve=!0,bl.prototype.getPoint=function(e,t){const i=t||new Le,s=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const o=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=s;for(;n>s;)n-=s;n<Number.EPSILON&&(n=o?0:s),!0!==this.aClockwise||o||(n===s?n=-s:n-=s);const r=this.aStartAngle+e*n;let a=this.aX+this.xRadius*Math.cos(r),l=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,s=l-this.aY;a=i*e-s*t+this.aX,l=i*t+s*e+this.aY}return i.set(a,l)},bl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},bl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},bl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},wl.prototype=Object.create(bl.prototype),wl.prototype.constructor=wl,wl.prototype.isArcCurve=!0;const Tl=new We,El=new Sl,_l=new Sl,xl=new Sl;function Ml(e=[],t=!1,i="centripetal",s=.5){yl.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}function Pl(e,t,i,s,n){const o=.5*(s-t),r=.5*(n-i),a=e*e;return(2*i-2*s+o+r)*(e*a)+(-3*i+3*s-2*o-r)*a+o*e+i}function Al(e,t,i,s){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,s)}function Ol(e,t,i,s,n){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,s)+function(e,t){return e*e*e*t}(e,n)}function Dl(e=new Le,t=new Le,i=new Le,s=new Le){yl.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}function Il(e=new We,t=new We,i=new We,s=new We){yl.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}function Cl(e=new Le,t=new Le){yl.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function Rl(e=new We,t=new We){yl.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function Ll(e=new Le,t=new Le,i=new Le){yl.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}function Nl(e=new We,t=new We,i=new We){yl.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}function kl(e=[]){yl.call(this),this.type="SplineCurve",this.points=e}Ml.prototype=Object.create(yl.prototype),Ml.prototype.constructor=Ml,Ml.prototype.isCatmullRomCurve3=!0,Ml.prototype.getPoint=function(e,t=new We){const i=t,s=this.points,n=s.length,o=(n-(this.closed?0:1))*e;let r,a,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/n)+1)*n:0===c&&l===n-1&&(l=n-2,c=1),this.closed||l>0?r=s[(l-1)%n]:(Tl.subVectors(s[0],s[1]).add(s[0]),r=Tl);const h=s[l%n],d=s[(l+1)%n];if(this.closed||l+2<n?a=s[(l+2)%n]:(Tl.subVectors(s[n-1],s[n-2]).add(s[n-1]),a=Tl),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(r.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),s=Math.pow(d.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),s<1e-4&&(s=i),El.initNonuniformCatmullRom(r.x,h.x,d.x,a.x,t,i,s),_l.initNonuniformCatmullRom(r.y,h.y,d.y,a.y,t,i,s),xl.initNonuniformCatmullRom(r.z,h.z,d.z,a.z,t,i,s)}else"catmullrom"===this.curveType&&(El.initCatmullRom(r.x,h.x,d.x,a.x,this.tension),_l.initCatmullRom(r.y,h.y,d.y,a.y,this.tension),xl.initCatmullRom(r.z,h.z,d.z,a.z,this.tension));return i.set(El.calc(c),_l.calc(c),xl.calc(c)),i},Ml.prototype.copy=function(e){yl.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ml.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ml.prototype.fromJSON=function(e){yl.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new We).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Dl.prototype=Object.create(yl.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isCubicBezierCurve=!0,Dl.prototype.getPoint=function(e,t=new Le){const i=t,s=this.v0,n=this.v1,o=this.v2,r=this.v3;return i.set(Ol(e,s.x,n.x,o.x,r.x),Ol(e,s.y,n.y,o.y,r.y)),i},Dl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Dl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Dl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Il.prototype=Object.create(yl.prototype),Il.prototype.constructor=Il,Il.prototype.isCubicBezierCurve3=!0,Il.prototype.getPoint=function(e,t=new We){const i=t,s=this.v0,n=this.v1,o=this.v2,r=this.v3;return i.set(Ol(e,s.x,n.x,o.x,r.x),Ol(e,s.y,n.y,o.y,r.y),Ol(e,s.z,n.z,o.z,r.z)),i},Il.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Il.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Il.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Cl.prototype=Object.create(yl.prototype),Cl.prototype.constructor=Cl,Cl.prototype.isLineCurve=!0,Cl.prototype.getPoint=function(e,t=new Le){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Cl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Cl.prototype.getTangent=function(e,t){const i=t||new Le;return i.copy(this.v2).sub(this.v1).normalize(),i},Cl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Cl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Cl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Rl.prototype=Object.create(yl.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isLineCurve3=!0,Rl.prototype.getPoint=function(e,t=new We){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Rl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Rl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Rl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Rl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ll.prototype=Object.create(yl.prototype),Ll.prototype.constructor=Ll,Ll.prototype.isQuadraticBezierCurve=!0,Ll.prototype.getPoint=function(e,t=new Le){const i=t,s=this.v0,n=this.v1,o=this.v2;return i.set(Al(e,s.x,n.x,o.x),Al(e,s.y,n.y,o.y)),i},Ll.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ll.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ll.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Nl.prototype=Object.create(yl.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isQuadraticBezierCurve3=!0,Nl.prototype.getPoint=function(e,t=new We){const i=t,s=this.v0,n=this.v1,o=this.v2;return i.set(Al(e,s.x,n.x,o.x),Al(e,s.y,n.y,o.y),Al(e,s.z,n.z,o.z)),i},Nl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Nl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Nl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},kl.prototype=Object.create(yl.prototype),kl.prototype.constructor=kl,kl.prototype.isSplineCurve=!0,kl.prototype.getPoint=function(e,t=new Le){const i=t,s=this.points,n=(s.length-1)*e,o=Math.floor(n),r=n-o,a=s[0===o?o:o-1],l=s[o],c=s[o>s.length-2?s.length-1:o+1],h=s[o>s.length-3?s.length-1:o+2];return i.set(Pl(r,a.x,l.x,c.x,h.x),Pl(r,a.y,l.y,c.y,h.y)),i},kl.prototype.copy=function(e){yl.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this},kl.prototype.toJSON=function(){const e=yl.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e},kl.prototype.fromJSON=function(e){yl.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Le).fromArray(i))}return this};var Fl=Object.freeze({__proto__:null,ArcCurve:wl,CatmullRomCurve3:Ml,CubicBezierCurve:Dl,CubicBezierCurve3:Il,EllipseCurve:bl,LineCurve:Cl,LineCurve3:Rl,QuadraticBezierCurve:Ll,QuadraticBezierCurve3:Nl,SplineCurve:kl});function Bl(){yl.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ul(e){Bl.call(this),this.type="Path",this.currentPoint=new Le,e&&this.setFromPoints(e)}function Hl(e){Ul.call(this,e),this.uuid=Re.generateUUID(),this.type="Shape",this.holes=[]}function Gl(e,t=1){jt.call(this),this.type="Light",this.color=new ui(e),this.intensity=t}function Vl(e,t,i){Gl.call(this,e,i),this.type="HemisphereLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.groundColor=new ui(t)}function zl(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Le(512,512),this.map=null,this.mapPass=null,this.matrix=new bt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ts,this._frameExtents=new Le(1,1),this._viewportCount=1,this._viewports=[new Ge(0,0,1,1)]}function jl(){zl.call(this,new ms(50,1,.5,500)),this.focus=1}function Wl(e,t,i,s,n,o){Gl.call(this,e,t),this.type="SpotLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.target=new jt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==s?s:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new jl}function Zl(){zl.call(this,new ms(90,1,.5,500)),this._frameExtents=new Le(4,2),this._viewportCount=6,this._viewports=[new Ge(2,1,1,1),new Ge(0,1,1,1),new Ge(3,1,1,1),new Ge(1,1,1,1),new Ge(3,0,1,1),new Ge(1,0,1,1)],this._cubeDirections=[new We(1,0,0),new We(-1,0,0),new We(0,0,1),new We(0,0,-1),new We(0,1,0),new We(0,-1,0)],this._cubeUps=[new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,0,1),new We(0,0,-1)]}function ql(e,t,i,s){Gl.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==s?s:1,this.shadow=new Zl}function Kl(e=-1,t=1,i=1,s=-1,n=.1,o=2e3){ps.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=n,this.far=o,this.updateProjectionMatrix()}function Yl(){zl.call(this,new Kl(-5,5,5,-5,.5,500))}function $l(e,t){Gl.call(this,e,t),this.type="DirectionalLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.target=new jt,this.shadow=new Yl}function Ql(e,t){Gl.call(this,e,t),this.type="AmbientLight"}function Xl(e,t,i,s){Gl.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==s?s:10}Bl.prototype=Object.assign(Object.create(yl.prototype),{constructor:Bl,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Cl(t,e))},getPoint:function(e){const t=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=t){const e=i[s]-t,n=this.curves[s],o=n.getLength(),r=0===o?0:1-e/o;return n.getPointAt(r)}s++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let i;for(let s=0,n=this.curves;s<n.length;s++){const o=n[s],r=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(r);for(let e=0;e<a.length;e++){const s=a[e];i&&i.equals(s)||(t.push(s),i=s)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){yl.prototype.copy.call(this,e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=yl.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){yl.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new Fl[i.type]).fromJSON(i))}return this}}),Ul.prototype=Object.assign(Object.create(Bl.prototype),{constructor:Ul,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const i=new Cl(this.currentPoint.clone(),new Le(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,s){const n=new Ll(this.currentPoint.clone(),new Le(e,t),new Le(i,s));return this.curves.push(n),this.currentPoint.set(i,s),this},bezierCurveTo:function(e,t,i,s,n,o){const r=new Dl(this.currentPoint.clone(),new Le(e,t),new Le(i,s),new Le(n,o));return this.curves.push(r),this.currentPoint.set(n,o),this},splineThru:function(e){const t=new kl([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,s,n,o){const r=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+r,t+a,i,s,n,o),this},absarc:function(e,t,i,s,n,o){return this.absellipse(e,t,i,i,s,n,o),this},ellipse:function(e,t,i,s,n,o,r,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,s,n,o,r,a),this},absellipse:function(e,t,i,s,n,o,r,a){const l=new bl(e,t,i,s,n,o,r,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Bl.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=Bl.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Bl.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Hl.prototype=Object.assign(Object.create(Ul.prototype),{constructor:Hl,getPointsHoles:function(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ul.prototype.copy.call(this,e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){const e=Ul.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Ul.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Ul).fromJSON(i))}return this}}),Gl.prototype=Object.assign(Object.create(jt.prototype),{constructor:Gl,isLight:!0,copy:function(e){return jt.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=jt.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Vl.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Vl,isHemisphereLight:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(zl.prototype,{_projScreenMatrix:new bt,_lightPositionWorld:new We,_lookTarget:new We,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,i=this.matrix,s=this._projScreenMatrix,n=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),n.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(n),t.updateMatrixWorld(),s.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),jl.prototype=Object.assign(Object.create(zl.prototype),{constructor:jl,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,i=2*Re.RAD2DEG*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&s===t.aspect&&n===t.far||(t.fov=i,t.aspect=s,t.far=n,t.updateProjectionMatrix()),zl.prototype.updateMatrices.call(this,e)}}),Wl.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Wl,isSpotLight:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Zl.prototype=Object.assign(Object.create(zl.prototype),{constructor:Zl,isPointLightShadow:!0,updateMatrices:function(e,t=0){const i=this.camera,s=this.matrix,n=this._lightPositionWorld,o=this._lookTarget,r=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),o.copy(i.position),o.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(o),i.updateMatrixWorld(),s.makeTranslation(-n.x,-n.y,-n.z),r.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r)}}),ql.prototype=Object.assign(Object.create(Gl.prototype),{constructor:ql,isPointLight:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Kl.prototype=Object.assign(Object.create(ps.prototype),{constructor:Kl,isOrthographicCamera:!0,copy:function(e,t){return ps.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,s,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let n=i-e,o=i+e,r=s+t,a=s-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,o=n+e*this.view.width,r-=t*this.view.offsetY,a=r-t*this.view.height}this.projectionMatrix.makeOrthographic(n,o,r,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=jt.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Yl.prototype=Object.assign(Object.create(zl.prototype),{constructor:Yl,isDirectionalLightShadow:!0,updateMatrices:function(e){zl.prototype.updateMatrices.call(this,e)}}),$l.prototype=Object.assign(Object.create(Gl.prototype),{constructor:$l,isDirectionalLight:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ql.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Ql,isAmbientLight:!0}),Xl.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Xl,isRectAreaLight:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=Gl.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class Jl{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new We)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*n),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],i*s*1.092548),t.addScaledVector(o[5],s*n*1.092548),t.addScaledVector(o[6],.315392*(3*n*n-1)),t.addScaledVector(o[7],i*n*1.092548),t.addScaledVector(o[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*s),t.addScaledVector(o[2],1.023328*n),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*s),t.addScaledVector(o[5],.858086*s*n),t.addScaledVector(o[6],.743125*n*n-.247708),t.addScaledVector(o[7],.858086*i*n),t.addScaledVector(o[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const i=e.x,s=e.y,n=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-s*s)}}function ec(e,t){Gl.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new Jl}function tc(e){cl.call(this,e),this.textures={}}ec.prototype=Object.assign(Object.create(Gl.prototype),{constructor:ec,isLightProbe:!0,copy:function(e){return Gl.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=Gl.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),tc.prototype=Object.assign(Object.create(cl.prototype),{constructor:tc,load:function(e,t,i,s){const n=this,o=new dl(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){s?s(t):console.error(t),n.manager.itemError(e)}}),i,s)},parse:function(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const s=new Wa[e.type];if(void 0!==e.uuid&&(s.uuid=e.uuid),void 0!==e.name&&(s.name=e.name),void 0!==e.color&&void 0!==s.color&&s.color.setHex(e.color),void 0!==e.roughness&&(s.roughness=e.roughness),void 0!==e.metalness&&(s.metalness=e.metalness),void 0!==e.sheen&&(s.sheen=(new ui).setHex(e.sheen)),void 0!==e.emissive&&void 0!==s.emissive&&s.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==s.specular&&s.specular.setHex(e.specular),void 0!==e.shininess&&(s.shininess=e.shininess),void 0!==e.clearcoat&&(s.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(s.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(s.fog=e.fog),void 0!==e.flatShading&&(s.flatShading=e.flatShading),void 0!==e.blending&&(s.blending=e.blending),void 0!==e.combine&&(s.combine=e.combine),void 0!==e.side&&(s.side=e.side),void 0!==e.opacity&&(s.opacity=e.opacity),void 0!==e.transparent&&(s.transparent=e.transparent),void 0!==e.alphaTest&&(s.alphaTest=e.alphaTest),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(s.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(s.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(s.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(s.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(s.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(s.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(s.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(s.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(s.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(s.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(s.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(s.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(s.rotation=e.rotation),1!==e.linewidth&&(s.linewidth=e.linewidth),void 0!==e.dashSize&&(s.dashSize=e.dashSize),void 0!==e.gapSize&&(s.gapSize=e.gapSize),void 0!==e.scale&&(s.scale=e.scale),void 0!==e.polygonOffset&&(s.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(s.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(s.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(s.skinning=e.skinning),void 0!==e.morphTargets&&(s.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(s.morphNormals=e.morphNormals),void 0!==e.dithering&&(s.dithering=e.dithering),void 0!==e.vertexTangents&&(s.vertexTangents=e.vertexTangents),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.toneMapped&&(s.toneMapped=e.toneMapped),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const n=e.uniforms[t];switch(s.uniforms[t]={},n.type){case"t":s.uniforms[t].value=i(n.value);break;case"c":s.uniforms[t].value=(new ui).setHex(n.value);break;case"v2":s.uniforms[t].value=(new Le).fromArray(n.value);break;case"v3":s.uniforms[t].value=(new We).fromArray(n.value);break;case"v4":s.uniforms[t].value=(new Ge).fromArray(n.value);break;case"m3":s.uniforms[t].value=(new Ne).fromArray(n.value);break;case"m4":s.uniforms[t].value=(new bt).fromArray(n.value);break;default:s.uniforms[t].value=n.value}}if(void 0!==e.defines&&(s.defines=e.defines),void 0!==e.vertexShader&&(s.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(s.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)s.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(s.flatShading=1===e.shading),void 0!==e.size&&(s.size=e.size),void 0!==e.sizeAttenuation&&(s.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(s.map=i(e.map)),void 0!==e.matcap&&(s.matcap=i(e.matcap)),void 0!==e.alphaMap&&(s.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(s.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(s.bumpScale=e.bumpScale),void 0!==e.normalMap&&(s.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(s.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),s.normalScale=(new Le).fromArray(t)}return void 0!==e.displacementMap&&(s.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(s.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(s.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(s.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(s.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(s.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(s.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(s.specularMap=i(e.specularMap)),void 0!==e.envMap&&(s.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(s.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(s.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(s.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(s.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(s.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(s.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(s.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(s.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(s.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(s.clearcoatNormalScale=(new Le).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(s.transmission=e.transmission),void 0!==e.transmissionMap&&(s.transmissionMap=i(e.transmissionMap)),s},setTextures:function(e){return this.textures=e,this}});const ic={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function sc(){Gi.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function nc(e,t,i,s){"number"==typeof i&&(s=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),bi.call(this,e,t,i),this.meshPerAttribute=s||1}function oc(e){cl.call(this,e)}function rc(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),cl.call(this,e),this.options={premultiplyAlpha:"none"}}function ac(){this.type="ShapePath",this.color=new ui,this.subPaths=[],this.currentPath=null}function lc(e){this.type="Font",this.data=e}function cc(e,t,i,s,n){const o=n.glyphs[e]||n.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");const r=new ac;let a,l,c,h,d,u,p,m;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let n=0,o=e.length;n<o;)switch(e[n++]){case"m":a=e[n++]*t+i,l=e[n++]*t+s,r.moveTo(a,l);break;case"l":a=e[n++]*t+i,l=e[n++]*t+s,r.lineTo(a,l);break;case"q":c=e[n++]*t+i,h=e[n++]*t+s,d=e[n++]*t+i,u=e[n++]*t+s,r.quadraticCurveTo(d,u,c,h);break;case"b":c=e[n++]*t+i,h=e[n++]*t+s,d=e[n++]*t+i,u=e[n++]*t+s,p=e[n++]*t+i,m=e[n++]*t+s,r.bezierCurveTo(d,u,p,m,c,h)}}return{offsetX:o.ha*t,path:r}}function hc(e){cl.call(this,e)}let dc;sc.prototype=Object.assign(Object.create(Gi.prototype),{constructor:sc,isInstancedBufferGeometry:!0,copy:function(e){return Gi.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=Gi.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),nc.prototype=Object.assign(Object.create(bi.prototype),{constructor:nc,isInstancedBufferAttribute:!0,copy:function(e){return bi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=bi.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),oc.prototype=Object.assign(Object.create(cl.prototype),{constructor:oc,load:function(e,t,i,s){const n=this,o=new dl(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){s?s(t):console.error(t),n.manager.itemError(e)}}),i,s)},parse:function(e){const t={},i={};function s(e,s){if(void 0!==t[s])return t[s];const n=e.interleavedBuffers[s],o=function(e,t){if(void 0!==i[t])return i[t];const s=e.arrayBuffers[t],n=new Uint32Array(s).buffer;return i[t]=n,n}(e,n.buffer),r=new Lo(Ri(n.type,o),n.stride);return r.uuid=n.uuid,t[s]=r,r}const n=e.isInstancedBufferGeometry?new sc:new Gi,o=e.data.index;if(void 0!==o){const e=Ri(o.type,o.array);n.setIndex(new bi(e,1))}const r=e.data.attributes;for(const t in r){const i=r[t];let o;if(i.isInterleavedBufferAttribute)o=new ko(s(e.data,i.data),i.itemSize,i.offset,i.normalized);else{const e=Ri(i.type,i.array);o=new(i.isInstancedBufferAttribute?nc:bi)(e,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),n.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],o=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];let r;r=n.isInterleavedBufferAttribute?new ko(s(e.data,n.data),n.itemSize,n.offset,n.normalized):new bi(Ri(n.type,n.array),n.itemSize,n.normalized),void 0!==n.name&&(r.name=n.name),o.push(r)}n.morphAttributes[t]=o}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];n.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new We;void 0!==c.center&&e.fromArray(c.center),n.boundingSphere=new ht(e,c.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}}),rc.prototype=Object.assign(Object.create(cl.prototype),{constructor:rc,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,i,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=al.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;const r={};r.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,r).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,n.options)})).then((function(i){al.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){s&&s(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}),Object.assign(ac.prototype,{moveTo:function(e,t){return this.currentPath=new Ul,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this},bezierCurveTo:function(e,t,i,s,n,o){return this.currentPath.bezierCurveTo(e,t,i,s,n,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){const t=[];for(let i=0,s=e.length;i<s;i++){const s=e[i],n=new Hl;n.curves=s.curves,t.push(n)}return t}function s(e,t){const i=t.length;let s=!1;for(let n=i-1,o=0;o<i;n=o++){let i=t[n],r=t[o],a=r.x-i.x,l=r.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[o],a=-a,r=t[n],l=-l),e.y<i.y||e.y>r.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;s=!s}}else{if(e.y!==i.y)continue;if(r.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=r.x)return!0}}return s}const n=Sa.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);let r,a,l;const c=[];if(1===o.length)return a=o[0],l=new Hl,l.curves=a.curves,c.push(l),c;let h=!n(o[0].getPoints());h=e?!h:h;const d=[],u=[];let p,m,g=[],f=0;u[f]=void 0,g[f]=[];for(let t=0,i=o.length;t<i;t++)a=o[t],p=a.getPoints(),r=n(p),r=e?!r:r,r?(!h&&u[f]&&f++,u[f]={s:new Hl,p},u[f].s.curves=a.curves,h&&f++,g[f]=[]):g[f].push({h:a,p:p[0]});if(!u[0])return i(o);if(u.length>1){let e=!1;const t=[];for(let e=0,t=u.length;e<t;e++)d[e]=[];for(let i=0,n=u.length;i<n;i++){const n=g[i];for(let o=0;o<n.length;o++){const r=n[o];let a=!0;for(let n=0;n<u.length;n++)s(r.p,u[n].p)&&(i!==n&&t.push({froms:i,tos:n,hole:o}),a?(a=!1,d[n].push(r)):e=!0);a&&d[i].push(r)}}t.length>0&&(e||(g=d))}for(let e=0,t=u.length;e<t;e++){l=u[e].s,c.push(l),m=g[e];for(let e=0,t=m.length;e<t;e++)l.holes.push(m[e].h)}return c}}),Object.assign(lc.prototype,{isFont:!0,generateShapes:function(e,t=100){const i=[],s=function(e,t,i){const s=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,r=[];let a=0,l=0;for(let e=0;e<s.length;e++){const t=s[e];if("\n"===t)a=0,l-=o;else{const e=cc(t,n,a,l,i);a+=e.offsetX,r.push(e.path)}}return r}(e,t,this.data);for(let e=0,t=s.length;e<t;e++)Array.prototype.push.apply(i,s[e].toShapes());return i}}),hc.prototype=Object.assign(Object.create(cl.prototype),{constructor:hc,load:function(e,t,i,s){const n=this,o=new dl(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(e){let i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}const s=n.parse(i);t&&t(s)}),i,s)},parse:function(e){return new lc(e)}});function uc(e){cl.call(this,e)}function pc(e,t,i){ec.call(this,void 0,i);const s=(new ui).set(e),n=(new ui).set(t),o=new We(s.r,s.g,s.b),r=new We(n.r,n.g,n.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(r).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(r).multiplyScalar(l)}function mc(e,t){ec.call(this,void 0,t);const i=(new ui).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}uc.prototype=Object.assign(Object.create(cl.prototype),{constructor:uc,load:function(e,t,i,s){const n=this,o=new dl(n.manager);o.setResponseType("arraybuffer"),o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{const e=i.slice(0);(void 0===dc&&(dc=new(window.AudioContext||window.webkitAudioContext)),dc).decodeAudioData(e,(function(e){t(e)}))}catch(t){s?s(t):console.error(t),n.manager.itemError(e)}}),i,s)}}),pc.prototype=Object.assign(Object.create(ec.prototype),{constructor:pc,isHemisphereLightProbe:!0,copy:function(e){return ec.prototype.copy.call(this,e),this},toJSON:function(e){return ec.prototype.toJSON.call(this,e)}}),mc.prototype=Object.assign(Object.create(ec.prototype),{constructor:mc,isAmbientLightProbe:!0,copy:function(e){return ec.prototype.copy.call(this,e),this},toJSON:function(e){return ec.prototype.toJSON.call(this,e)}});const gc=new bt,fc=new bt;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ms,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ms,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),s=t.eyeSep/2,n=s*t.near/t.focus,o=t.near*Math.tan(Re.DEG2RAD*t.fov*.5)/t.zoom;let r,a;fc.elements[12]=-s,gc.elements[12]=s,r=-o*t.aspect+n,a=o*t.aspect+n,i.elements[0]=2*t.near/(a-r),i.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(i),r=-o*t.aspect-n,a=o*t.aspect-n,i.elements[0]=2*t.near/(a-r),i.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(fc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(gc)}});class vc{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=yc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function yc(){return("undefined"==typeof performance?Date:performance).now()}function bc(e,t,i){let s,n,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":s=this._slerp,n=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":s=this._select,n=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:s=this._lerp,n=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=n,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(bc.prototype,{accumulate:function(e,t){const i=this.buffer,s=this.valueSize,n=e*s+s;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==s;++e)i[n+e]=i[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(i,n,0,e,s)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,i=this.buffer,s=e*t+t,n=this.cumulativeWeight,o=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const e=t*this._origIndex;this._mixBufferRegion(i,s,e,1-n,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let e=t,n=t+t;e!==n;++e)if(i[e]!==i[e+t]){r.setValue(i,s);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let e=i,n=s;e!==n;++e)t[e]=t[s+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,s,n){if(s>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]},_slerp:function(e,t,i,s){je.slerpFlat(e,t,e,t,e,i,s)},_slerpAdditive:function(e,t,i,s,n){const o=this._workIndex*n;je.multiplyQuaternionsFlat(e,o,e,t,e,i),je.slerpFlat(e,t,e,t,e,o,s)},_lerp:function(e,t,i,s,n){const o=1-s;for(let r=0;r!==n;++r){const n=t+r;e[n]=e[n]*o+e[i+r]*s}},_lerpAdditive:function(e,t,i,s,n){for(let o=0;o!==n;++o){const n=t+o;e[n]=e[n]+e[i+o]*s}}});const wc=new RegExp("[\\[\\]\\.:\\/]","g"),Sc="[^\\[\\]\\.:\\/]",Tc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ec=/((?:WC+[\/:])*)/.source.replace("WC",Sc),_c=/(WCOD+)?/.source.replace("WCOD",Tc),xc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Sc),Mc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Sc),Pc=new RegExp("^"+Ec+_c+xc+Mc+"$"),Ac=["material","materials","bones"];function Oc(e,t,i){const s=i||Dc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}function Dc(e,t,i){this.path=t,this.parsedPath=i||Dc.parseTrackName(t),this.node=Dc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Oc.prototype,{getValue:function(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];void 0!==s&&s.getValue(e,t)},setValue:function(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,n=i.length;s!==n;++s)i[s].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(Dc,{Composite:Oc,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new Dc.Composite(e,t,i):new Dc(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(wc,"")},parseTrackName:function(e){const t=Pc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const e=i.nodeName.substring(s+1);-1!==Ac.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let s=0;s<e.length;s++){const n=e[s];if(n.name===t||n.uuid===t)return n;const o=i(n.children);if(o)return o}return null},s=i(e.children);if(s)return s}return null}}),Object.assign(Dc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)e[t++]=i[s]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=e[t++]},function(e,t){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let n=t.propertyIndex;if(e||(e=Dc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let s=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===s){s=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==s){if(void 0===e[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[s]}}const o=e[s];if(void 0===o){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+s+" but it wasn't found.",e)}let r=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?r=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===s){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=n}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][r]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Dc.prototype,{_getValue_unbound:Dc.prototype.getValue,_setValue_unbound:Dc.prototype.setValue}),Object.assign(function(){this.uuid=Re.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,n=this._bindings,o=n.length;let r,a=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],d=h.uuid;let u=t[d];if(void 0===u){u=a++,t[d]=u,e.push(h);for(let e=0,t=o;e!==t;++e)n[e].push(new Dc(h,i[e],s[e]))}else if(u<l){r=e[u];const a=--l,c=e[a];t[c.uuid]=u,e[u]=c,t[d]=a,e[a]=h;for(let e=0,t=o;e!==t;++e){const t=n[e],o=t[a];let r=t[u];t[u]=o,void 0===r&&(r=new Dc(h,i[e],s[e])),t[a]=r}}else e[u]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let n=this.nCachedObjects_;for(let o=0,r=arguments.length;o!==r;++o){const r=arguments[o],a=r.uuid,l=t[a];if(void 0!==l&&l>=n){const o=n++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=r;for(let e=0,t=s;e!==t;++e){const t=i[e],s=t[o],n=t[l];t[l]=s,t[o]=n}}}this.nCachedObjects_=n},uncache:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let n=this.nCachedObjects_,o=e.length;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<n){const r=--n,a=e[r],c=--o,h=e[c];t[a.uuid]=l,e[l]=a,t[h.uuid]=r,e[r]=h,e.pop();for(let e=0,t=s;e!==t;++e){const t=i[e],s=t[r],n=t[c];t[l]=s,t[r]=n,t.pop()}}else{const n=--o,r=e[n];n>0&&(t[r.uuid]=l),e[l]=r,e.pop();for(let e=0,t=s;e!==t;++e){const t=i[e];t[l]=t[n],t.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const n=this._bindings;if(void 0!==s)return n[s];const o=this._paths,r=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);s=n.length,i[e]=s,o.push(e),r.push(t),n.push(h);for(let i=c,s=a.length;i!==s;++i){const s=a[i];h[i]=new Dc(s,e,t)}return h},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const s=this._paths,n=this._parsedPaths,o=this._bindings,r=o.length-1,a=o[r];t[e[r]]=i,o[i]=a,o.pop(),n[i]=n[r],n.pop(),s[i]=s[r],s.pop()}}});class Ic{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const n=t.tracks,o=n.length,r=new Array(o),a={endingStart:ge,endingEnd:ge};for(let e=0;e!==o;++e){const t=n[e].createInterpolant(null);r[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=r,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,s=e._clip.duration,n=s/i,o=i/s;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,n=s.time,o=this.timeScale;let r=this._timeScaleInterpolant;null===r&&(r=s._lendControlInterpolant(),this._timeScaleInterpolant=r);const a=r.parameterPositions,l=r.sampleValues;return a[0]=n,a[1]=n+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled)return void this._updateWeight(e);const n=this._startTime;if(null!==n){const s=(e-n)*i;if(s<0||0===i)return;this._startTime=null,t=i*s}t*=this._updateTimeScale(e);const o=this._updateTime(t),r=this._updateWeight(e);if(r>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case 2501:for(let i=0,s=e.length;i!==s;++i)e[i].evaluate(o),t[i].accumulateAdditive(r);break;case 2500:default:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulate(s,r)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),0===s&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,n=this._loopCount;const o=2202===i;if(0===e)return-1===n?s:o&&1==(1&n)?t-s:s;if(i===de){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),s>=t||s<0){const i=Math.floor(s/t);s-=t*i,n+=Math.abs(i);const r=this.repetitions-n;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===r){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=s;if(o&&1==(1&n))return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=fe,s.endingEnd=fe):(s.endingStart=e?this.zeroSlopeAtStart?fe:ge:ve,s.endingEnd=t?this.zeroSlopeAtEnd?fe:ge:ve)}_scheduleFading(e,t,i){const s=this._mixer,n=s.time;let o=this._weightInterpolant;null===o&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const r=o.parameterPositions,a=o.sampleValues;return r[0]=n,a[0]=t,r[1]=n+e,a[1]=i,this}}function Cc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Cc.prototype=Object.assign(Object.create(De.prototype),{constructor:Cc,_bindAction:function(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,n=s.length,o=e._propertyBindings,r=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==n;++e){const n=s[e],l=n.name;let h=c[l];if(void 0!==h)o[e]=h;else{if(h=o[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const s=t&&t._propertyBindings[e].binding.parsedPath;h=new bc(Dc.create(i,l,s),n.ValueTypeName,n.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),o[e]=h}r[e].resultBuffer=h.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){const s=this._actions,n=this._actionsByClip;let o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const n=e._clip.uuid,o=this._actionsByClip,r=o[n],a=r.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete r.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,n=t[s];e._cacheIndex=s,t[s]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,n=t[s];e._cacheIndex=s,t[s]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){const s=this._bindingsByRootAndName,n=this._bindings;let o=s[t];void 0===o&&(o={},s[t]=o),o[i]=e,e._cacheIndex=n.length,n.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,r=o[s],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete r[n],0===Object.keys(r).length&&delete o[s]},_lendBinding:function(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,n=t[s];e._cacheIndex=s,t[s]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,n=t[s];e._cacheIndex=s,t[s]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Ya(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,n=t[s];e.__cacheIndex=s,t[s]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){const s=t||this._root,n=s.uuid;let o="string"==typeof e?ol.findByName(s,e):e;const r=null!==o?o.uuid:e,a=this._actionsByClip[r];let l=null;if(void 0===i&&(i=null!==o?o.blendMode:2500),void 0!==a){const e=a.actionByRoot[n];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Ic(this,o,t,i);return this._bindAction(c,l),this._addInactiveAction(c,r,n),c},existingAction:function(e,t){const i=t||this._root,s=i.uuid,n="string"==typeof e?ol.findByName(i,e):e,o=n?n.uuid:e,r=this._actionsByClip[o];return void 0!==r&&r.actionByRoot[s]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1;for(let r=0;r!==i;++r)t[r]._update(s,e,n,o);const r=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)r[e].apply(o);return this},setTime:function(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,n=s[i];if(void 0!==n){const e=n.knownActions;for(let i=0,s=e.length;i!==s;++i){const s=e[i];this._deactivateAction(s);const n=s._cacheIndex,o=t[t.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,o._cacheIndex=n,t[n]=o,t.pop(),this._removeInactiveBindingsForAction(s)}delete s[i]}},uncacheRoot:function(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const s=i[e].actionByRoot[t];void 0!==s&&(this._deactivateAction(s),this._removeInactiveAction(s))}const s=this._bindingsByRootAndName[t];if(void 0!==s)for(const e in s){const t=s[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Rc{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rc(void 0===this.value.clone?this.value:this.value.clone())}}function Lc(e,t,i){Lo.call(this,e,t),this.meshPerAttribute=i||1}function Nc(e,t,i,s,n){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=n,this.version=0}function kc(e,t,i,s){this.ray=new yt(e,t),this.near=i||0,this.far=s||1/0,this.camera=null,this.layers=new Dt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Fc(e,t){return e.distance-t.distance}function Bc(e,t,i,s){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===s){const s=e.children;for(let e=0,n=s.length;e<n;e++)Bc(s[e],t,i,!0)}}Lc.prototype=Object.assign(Object.create(Lo.prototype),{constructor:Lc,isInstancedInterleavedBuffer:!0,copy:function(e){return Lo.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=Lo.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=Lo.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(Nc.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Nc.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(kc.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,i){const s=i||[];return Bc(e,this,s,t),s.sort(Fc),s},intersectObjects:function(e,t,i){const s=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),s;for(let i=0,n=e.length;i<n;i++)Bc(e[i],this,s,t);return s.sort(Fc),s}});const Uc=new Le,Hc=new We,Gc=new We;class Vc{constructor(e,t){this.start=void 0!==e?e:new We,this.end=void 0!==t?t:new We}set(e,t){return this.start.copy(e),this.end.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new We),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new We),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new We),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Hc.subVectors(e,this.start),Gc.subVectors(this.end,this.start);const i=Gc.dot(Gc);let s=Gc.dot(Hc)/i;return t&&(s=Re.clamp(s,0,1)),s}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new We),this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}function zc(e){jt.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}zc.prototype=Object.create(jt.prototype),zc.prototype.constructor=zc,zc.prototype.isImmediateRenderObject=!0;const jc=new We,Wc=new bt,Zc=new bt;function qc(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,qc(e.children[i]));return t}const Kc=new We,Yc=new ps;class $c extends Mr{constructor(e){const t=new Gi,i=new vr({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],n=[],o={},r=new ui(16755200),a=new ui(16711680),l=new ui(43775),c=new ui(16777215),h=new ui(3355443);function d(e,t,i){u(e,i),u(t,i)}function u(e,t){s.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(s.length/3-1)}d("n1","n2",r),d("n2","n4",r),d("n4","n3",r),d("n3","n1",r),d("f1","f2",r),d("f2","f4",r),d("f4","f3",r),d("f3","f1",r),d("n1","f1",r),d("n2","f2",r),d("n3","f3",r),d("n4","f4",r),d("p","n1",a),d("p","n2",a),d("p","n3",a),d("p","n4",a),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",c),d("p","c",h),d("cn1","cn2",h),d("cn3","cn4",h),d("cf1","cf2",h),d("cf3","cf4",h),t.setAttribute("position",new Ai(s,3)),t.setAttribute("color",new Ai(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Yc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qc("c",t,e,Yc,0,0,-1),Qc("t",t,e,Yc,0,0,1),Qc("n1",t,e,Yc,-1,-1,-1),Qc("n2",t,e,Yc,1,-1,-1),Qc("n3",t,e,Yc,-1,1,-1),Qc("n4",t,e,Yc,1,1,-1),Qc("f1",t,e,Yc,-1,-1,1),Qc("f2",t,e,Yc,1,-1,1),Qc("f3",t,e,Yc,-1,1,1),Qc("f4",t,e,Yc,1,1,1),Qc("u1",t,e,Yc,.7,1.1,-1),Qc("u2",t,e,Yc,-.7,1.1,-1),Qc("u3",t,e,Yc,0,2,-1),Qc("cf1",t,e,Yc,-1,0,1),Qc("cf2",t,e,Yc,1,0,1),Qc("cf3",t,e,Yc,0,-1,1),Qc("cf4",t,e,Yc,0,1,1),Qc("cn1",t,e,Yc,-1,0,-1),Qc("cn2",t,e,Yc,1,0,-1),Qc("cn3",t,e,Yc,0,-1,-1),Qc("cn4",t,e,Yc,0,1,-1),e.getAttribute("position").needsUpdate=!0}}function Qc(e,t,i,s,n,o,r){Kc.set(n,o,r).unproject(s);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],Kc.x,Kc.y,Kc.z)}}class Xc extends Mr{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Gi;s.setIndex(new bi(i,1)),s.setAttribute("position",new Ai([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new vr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}const Jc=new We;let eh,th;class ih extends jt{constructor(e,t,i,s,n,o){super(),this.type="ArrowHelper",void 0===e&&(e=new We(0,0,1)),void 0===t&&(t=new We(0,0,0)),void 0===i&&(i=1),void 0===s&&(s=16776960),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),void 0===eh&&(eh=new Gi,eh.setAttribute("position",new Ai([0,0,0,0,1,0],3)),th=new Wr(0,.5,1,5,1),th.translate(0,-.5,0)),this.position.copy(t),this.line=new Er(eh,new vr({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new os(th,new fi({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Jc.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Jc,t)}}setLength(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}const sh=new Float32Array(1),nh=(new Int32Array(sh.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),oh=5+nh.length,{_lodPlanes:rh,_sizeLods:ah,_sigmas:lh}=ch();function ch(){const e=[],t=[],i=[];let s=8;for(let n=0;n<oh;n++){const o=Math.pow(2,s);t.push(o);let r=1/o;n>4?r=nh[n-8+4-1]:0==n&&(r=0),i.push(r);const a=1/(o-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,u=6,p=3,m=2,g=1,f=new Float32Array(p*u*d),v=new Float32Array(m*u*d),y=new Float32Array(g*u*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,i=e>2?0:-1,s=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];f.set(s,p*u*e),v.set(h,m*u*e);const n=[e,e,e,e,e,e];y.set(n,g*u*e)}const b=new Gi;b.setAttribute("position",new bi(f,p)),b.setAttribute("uv",new bi(v,m)),b.setAttribute("faceIndex",new bi(y,g)),e.push(b),s>4&&s--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function hh(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ml.call(this,e),this.type="catmullrom"}Math.sqrt(5),yl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(yl.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Bl.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new zr;for(let i=0,s=e.length;i<s;i++){const s=e[i];t.vertices.push(new We(s.x,s.y,s.z||0))}return t}}),Object.assign(Ul.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(Ml.prototype),Object.create(Ml.prototype),hh.prototype=Object.create(Ml.prototype),Object.assign(hh.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class extends Mr{constructor(e=10,t=10,i=4473924,s=8947848){i=new ui(i),s=new ui(s);const n=t/2,o=e/t,r=e/2,a=[],l=[];for(let e=0,c=0,h=-r;e<=t;e++,h+=o){a.push(-r,0,h,r,0,h),a.push(h,0,-r,h,0,r);const t=e===n?i:s;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Gi;c.setAttribute("position",new Ai(a,3)),c.setAttribute("color",new Ai(l,3)),super(c,new vr({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Mr{constructor(e){const t=qc(e),i=new Gi,s=[],n=[],o=new ui(0,0,1),r=new ui(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),n.push(o.r,o.g,o.b),n.push(r.r,r.g,r.b))}i.setAttribute("position",new Ai(s,3)),i.setAttribute("color",new Ai(n,3)),super(i,new vr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");Zc.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(Wc.multiplyMatrices(Zc,n.matrixWorld),jc.setFromMatrixPosition(Wc),s.setXYZ(i,jc.x,jc.y,jc.z),Wc.multiplyMatrices(Zc,n.parent.matrixWorld),jc.setFromMatrixPosition(Wc),s.setXYZ(i+1,jc.x,jc.y,jc.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(cl.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ic.extractUrlBase(e)}}),cl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Le(1/0,1/0),this.max=void 0!==t?t:new Le(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Uc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Le),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Le),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Le),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Le),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Uc.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ke.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ht.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Ts.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Vc.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Re,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Re.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Re.ceilPowerOfTwo(e)}}),Object.assign(Ne.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(bt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new We).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,s,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,s,i,n,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Kt.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(je.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(yt.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(oi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(oi,{barycoordFromPoint:function(e,t,i,s,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),oi.getBarycoord(e,t,i,s,n)},normal:function(e,t,i,s){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),oi.getNormal(e,t,i,s)}}),Object.assign(Hl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ma(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ia(this,e)}}),Object.assign(Le.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(We.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ge.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(zr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(jt.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(jt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(os.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(os.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(tr.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(dr.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ar.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(yl.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ms.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Gl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(bi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ae},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ae)}}}),Object.assign(bi.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ae:Pe),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Gi.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new bi(arguments[1],arguments[2])))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Gi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(sc.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(kc.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(Lo.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Ae},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Lo.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ae:Pe),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_a.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Ro.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Rc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(gi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ui}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Ua.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ba.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(us.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Io.prototype,{clearTarget:function(e,t,i,s){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,s)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Io.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Se:we}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(To.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ve.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(class extends jt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new uc).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},fs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},fs.prototype.clear=function(e,t,i,s){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,s)},Fe.crossOrigin=void 0,Fe.loadTexture=function(e,t,i,s){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new vl;n.setCrossOrigin(this.crossOrigin);const o=n.load(e,i,void 0,s);return t&&(o.mapping=t),o},Fe.loadTextureCube=function(e,t,i,s){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new gl;n.setCrossOrigin(this.crossOrigin);const o=n.load(e,i,void 0,s);return t&&(o.mapping=t),o},Fe.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Fe.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"124"}}))},92924:(e,t,i)=>{"use strict";i.d(t,{ej:()=>l,kG:()=>c,U6:()=>p});var s=i(70655);!function(e){function t(){var t=this||self;t.globalThis=t,delete e.prototype._T_}"object"!=typeof globalThis&&(this?t():(e.defineProperty(e.prototype,"_T_",{configurable:!0,get:t}),_T_))}(Object);const n=globalThis;var o="Invariant Violation",r=Object.setPrototypeOf,a=void 0===r?function(e,t){return e.__proto__=t,e}:r,l=function(e){function t(i){void 0===i&&(i=o);var s=e.call(this,"number"==typeof i?o+": "+i+" (see https://github.com/apollographql/invariant-packages)":i)||this;return s.framesToPop=1,s.name=o,a(s,t.prototype),s}return(0,s.ZT)(t,e),t}(Error);function c(e,t){if(!e)throw new l(t)}var h=["log","warn","error","silent"],d=h.indexOf("log");function u(e){return function(){if(h.indexOf(e)>=d)return console[e].apply(console,arguments)}}function p(e){var t=h[d];return d=Math.max(0,h.indexOf(e)),t}!function(e){e.log=u("log"),e.warn=u("warn"),e.error=u("error")}(c||(c={}));var m=n.process||{env:{}};if(!n.process)try{Object.defineProperty(n,"process",{value:m})}catch(e){}},18739:(e,t,i)=>{"use strict";i.d(t,{CN:()=>s,LG:()=>n,DO:()=>o});const s=[],n=()=>null,o=async(e,t)=>Promise.resolve()},28134:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorType:()=>f,default:()=>v});var s=i(54122),n=i(79994),o=i(29359),r=i(21265),a=i(87207),l=i(68472),c=i(75673),h=i(81826);const d=e=>({problem:"",solution:e.t(o.Z.ERROR_BROWSER_SOLUTION),explanation:e.t(o.Z.ERROR_BROWSER_EXPLANATION),actions:(0,r.tq)()?"":["<div id='browser-tiles'>","<a href='https://www.google.com/chrome/browser/' target='_blank'>","<div class='tile'>",`<img src=${a}>`,"</div>","</a>","<a href='https://www.mozilla.org/en-US/firefox/new/' target='_blank'>","<div class='tile'>",`<img src=${l}>`,"</div>","</a>","<a href='https://www.microsoft.com/en-us/edge' target='_blank'>","<div class='tile'>",`<img src=${c}>`,"</div>","</a>","<a href='https://support.apple.com/en-us/HT204416' target='_blank'>","<div class='tile'>",`<img src=${h}>`,"</div>","</a>","</div>"].join("")}),u=e=>Object.assign(Object.assign({},d(e)),{problem:`${e.t(o.Z.ERROR_WEBGL_UNSUPPORTED_PROBLEM)}`}),p="https://support.matterport.com/hc/articles/208220058",m=e=>({problem:e.t(o.Z.ERROR_GENERIC_PROBLEM),solution:e.t(o.Z.ERROR_GENERIC_SOLUTION),explanation:"",actions:[`${e.t(o.Z.ERROR_GENERIC_ACTIONS_1)}`].concat((0,r.tq)()?[]:[`<a id='install-browser' href='#'>${e.t(o.Z.ERROR_GENERIC_ACTIONS_2)}</a>`,`${e.t(o.Z.ERROR_GENERIC_ACTIONS_3)}`]).concat([`<a href=${p} target='_blank'>${e.t(o.Z.ERROR_GENERIC_ACTIONS_4)}</a>`]).join("")}),g=e=>({problem:e.t(o.Z.ERROR_LOADING_FAILED_PROBLEM),solution:"",explanation:"",actions:[`${e.t(o.Z.ERROR_LOADING_FAILED_ACTIONS_1)}`,`<a href=${p} target='_blank'>${e.t(o.Z.ERROR_LOADING_FAILED_ACTIONS_2)}</a>`].join("")});var f;!function(e){e[e.UNSUPPORTED=1]="UNSUPPORTED",e[e.WEBGL=2]="WEBGL",e[e.GENERIC=3]="GENERIC"}(f||(f={}));class v extends s.Y{constructor(){super(...arguments),this.name="error-gui"}async init(e,t){this.container=document.querySelector("#error-container"),this.problem=document.querySelector("#error-problem"),this.solution=document.querySelector("#error-solution"),this.explanation=document.querySelector("#error-explanation"),this.actions=document.querySelector("#error-actions"),this.localeModule=await t.getModule(n.default)}showError(e){switch(e){case f.UNSUPPORTED:this.populateErrorScreen(u);break;case f.WEBGL:this.populateErrorScreen(m);const e=this.actions.querySelector("#install-browser");e&&e.addEventListener("click",(()=>this.populateErrorScreen(d)));break;case f.GENERIC:default:this.populateErrorScreen(g)}}populateErrorScreen(e){const t=e(this.localeModule);this.container.classList.remove("hidden"),this.problem.innerText=t.problem,this.solution.innerText=t.solution,this.explanation.innerText=t.explanation,this.actions.innerHTML=t.actions}}},81944:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ci});var s=i(26605),n=i(54122),o=i(3471),r=i(29675),a=i(90601),l=i(90039),c=i(94184),h=i(29359),d=i(8336),u=i(14900),p=i(979),m=i(47173),g=i(2116),f=i(21265),v=i(12856),y=i(71583),b=i(26265),w=i(80429);let S=class extends s.Component{constructor(e){super(e),this.handleClick=()=>{this.context.commandBinder.issueCommand(new y.Bz(v.P.VR_SELECT,!this.props.open))}}render(){return(0,s.h)(w.h,{appendClass:{"view-in-vr":!0},onClick:this.handleClick},(0,s.h)(b.oO,{content:this.context.locale.t(h.Z.VIEW_IN_VR),position:b.lZ.UP,tooltipTimeout:(0,f.Jm)()?1e3:void 0},(0,s.h)("span",{class:"icon icon-vr"})))}};S=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],S);var T=i(30593),E=i(24391),_=i(15100),x=i(35543),M=i(25799),P=i(19417);const A=new M.Z("pause-button");class O extends s.Component{constructor(e){super(e),this.justEnded=!1,this.stopTour=async e=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_stopped"}),e.preventDefault();try{this.context.commandBinder.issueCommand(new P.vy)}catch(e){A.debug(e)}},this.state={justPaused:!1}}componentDidUpdate(){this.state.justPaused&&this.setState({justPaused:!1}),this.justEnded=!1}componentWillReceiveProps(e){!this.props.tourPlaying||e.tourPlaying||this.justEnded||this.setState({justPaused:!0}),this.props.tourEnded&&(this.justEnded=!0)}render(){const{tourPlaying:e}=this.props,{justPaused:t}=this.state;return(0,s.h)("div",{id:"pause-button",onClick:this.stopTour,onTouchMove:this.stopTour,onTouchStart:this.stopTour},!e&&(0,s.h)("img",{src:i(31896),class:c({justPaused:t})}))}}var D,I=i(62431),C=i(72942),R=i(39990),L=i(78215),N=i(43711),k=i(75638),F=i(14600),B=i(86134);let U=D=class extends s.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(k.b,!1),t=this.context.settings.tryGetProperty(F.F.MeasurementUserNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),D.DISMISS_NUDGE_TIMEOUT)}),D.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{this.state.showNudge&&(this.context.analytics.track("showcase_gui",{gui_action:"mesasure_nudge"}),this.context.settings.setLocalStorageProperty(F.F.MeasurementUserNudgeSeen,!0),this.setState({showNudge:!1}))},this.openMeasurementsMode=()=>{this.context.analytics.track("showcase_gui",{gui_action:"measure_mode"}),this.context.commandBinder.issueCommand(new N.tT(a.w1.MEASUREMENTS,!0))},this.localized={measurement_mode:t.locale.t(h.Z.MEASUREMENT_MODE),nudgeTitleString:t.locale.t(h.Z.MEASUREMENT_NUDGE_TITLE),nudgeMessageString:t.locale.t(h.Z.MEASUREMENT_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e}=this.props,{showNudge:t}=this.state,{nudgeTitleString:i,nudgeMessageString:n}=this.localized;return(0,s.h)("div",{class:"measure-mode-button"},(0,s.h)(w.h,{onClick:this.openMeasurementsMode},(0,s.h)(b.oO,{content:this.localized.measurement_mode,position:b.lZ.UP,tooltipTimeout:e},(0,s.h)("span",{class:"icon icon-tape-measure"}))),(0,s.h)(B.u,{appendClass:{"tooltip-title-large":!0,"nudge-tooltip":!0},open:t,closeButton:!0,onClose:this.dismissNudge,title:i,message:(0,s.h)("div",{class:"nudge-message"},(0,s.h)("span",{class:"message"},n)),arrowPos:B.x.BOTTOM_CENTER}))}};U.SHOW_NUDGE_TIMEOUT=6e4,U.DISMISS_NUDGE_TIMEOUT=1e4,U=D=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],U);const H=U;var G=i(63985);let V=class extends s.Component{constructor(e){super(e),this.handleTermsClick=()=>{const e=this.props.openModal===v.P.TERMS;this.context.commandBinder.issueCommand(new y.Bz(v.P.TERMS,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_terms_button",interaction_source:"gui"})},this.handleHelpClick=()=>{const e=this.props.openModal===v.P.HELP;this.context.commandBinder.issueCommand(new y.Bz(v.P.HELP,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_help_button",interaction_source:"gui"})}}getFooterLogo(){const e="1"!==(0,f.hu)("mls"),t=i(89992),n=(0,s.h)("img",{class:"footer-logo",src:t});return e?(0,s.h)("a",{class:"link logo-link",href:"https://matterport.com",target:"_blank"},n):n}render(){return(0,s.h)("div",{id:"footer"},(0,s.h)("span",{onClick:this.handleHelpClick,class:"link"},this.context.locale.t(h.Z.HELP)),(0,s.h)("span",null," | "),(0,s.h)("span",{onClick:this.handleTermsClick,class:"link"},this.context.locale.t(h.Z.TERMS)),this.getFooterLogo())}};V=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],V);const z=V;class j extends s.Component{constructor(e){super(e),this.touchDevice=(0,f.Jm)(),this.viewmodeToClass={[C.BD.INSIDE]:"inside",[C.BD.OUTSIDE]:"outside",[C.BD.DOLLHOUSE]:"dollhouse",[C.BD.FLOORPLAN]:"floorplan",[C.BD.TRANSITIONING]:"transitioning"},this.onBriefHLR=()=>{this.setState((e=>({briefHlr:!e.briefHlr})))},this.updateViewportSize=()=>{const e=this.context&&this.context.mainDiv?this.context.mainDiv.offsetHeight:window.innerHeight;this.setState({viewportHeight:e})},this.isReelEnabled=()=>{const{settings:e}=this.context,{viewportHeight:t}=this.state,i=e.checkUrlParam("hr",1,1),s=e.tryGetProperty(I.gx.HighlightReel,!0);return t>=_.cR&&i&&s},this.isTourEnabled=()=>{const{settings:e}=this.context,t=!!e.tryGetProperty("gt",1),i=e.tryGetProperty(I.gx.TourButtons,!0);return t&&i},this.isFloorsEnabled=()=>{const{settings:e}=this.context,t=e.tryGetProperty(m.w,!0),i=e.tryGetProperty(I.gx.FloorSelect,!0);return t&&i},this.onToggleHLR=e=>{this.isReelEnabled()&&this.props.tourState.totalSteps>0&&this.setState({reelOpen:e})},this.toggleShareModal=()=>{const e=this.props.openModal===v.P.SHARE;this.context.analytics.track("showcase_gui",{gui_action:"click_share_button"}),this.context.commandBinder.issueCommand(new y.Bz(v.P.SHARE,!e))},this.renderHighlightReelControls=()=>{const{totalSteps:e,tourPlaying:t}=this.props.tourState,i=this.isReelEnabled()&&e>0,n=this.isTourEnabled()&&e>0;return(0,s.h)("div",{class:"highlight-tour-controls"},i&&(0,s.h)(E.Z,{reelOpen:this.state.reelOpen,onToggleHLR:this.onToggleHLR,reelEnabled:i}),n&&(0,s.h)(u.Z,{tourEmpty:!1,tourPlaying:t}))},this.renderModeControls=()=>(0,s.h)(d.Z,{unaligned:this.props.unaligned}),this.renderFloorPlanControls=()=>{const{viewmode:e}=this.props;return(0,s.h)(p.Z,{viewmode:e})},this.renderNotesModeButton=()=>(0,s.h)(L.Z,{tooltipTimeout:this.touchDevice?1e3:void 0}),this.renderMeasurementModeButton=()=>(0,s.h)(H,{tooltipTimeout:this.touchDevice?1e3:void 0}),this.renderHighlightReel=e=>{const{totalSteps:t,tourPlaying:i,highlights:n,activeStep:o,transition:r}=this.props.tourState,{reelOpen:a,briefHlr:l}=this.state;return(0,s.h)(_.ZP,{transition:r,activeStep:o,highlights:n,tourPlaying:i,totalSteps:t,reelOpen:a&&e,briefHlr:l,onBriefHLR:this.onBriefHLR,onToggleHLR:this.onToggleHLR})},this.renderFooter=()=>{const{reelOpen:e}=this.state,{openTool:t,openModal:i,tourState:n}=this.props,{totalSteps:o,tourPlaying:r,activeStep:l}=n,c=t===a.w1.NOTES||t===a.w1.TAGS;return(0,s.h)("div",{class:"footer-ui"},!t&&(0,s.h)(x.Z,{activeStep:l,tourPlaying:r,totalSteps:o,reelOpen:e,onToggleHLR:this.onToggleHLR}),!c&&(0,s.h)(z,{openModal:i}))},this.renderLeftControls=()=>{const e=[],{unaligned:t,measurementsModeEnabled:i,notesEnabled:s,openTool:n}=this.props,{totalSteps:o}=this.props.tourState,r=this.isReelEnabled()&&o>0;return(this.isTourEnabled()&&o>0||r)&&!n&&e.push(this.renderHighlightReelControls()),e.push(this.renderModeControls()),this.isFloorsEnabled()&&e.push(this.renderFloorPlanControls()),!s||n||t||e.push(this.renderNotesModeButton()),!i||n||t||e.push(this.renderMeasurementModeButton()),e},this.renderRightControls=()=>{const e=[],{vrEnabled:t,openModal:i,shareEnabled:n}=this.props,o=(0,f.O6)();return e.push((0,s.h)("span",{class:"divider"})),n&&e.push((0,s.h)(w.h,{onClick:this.toggleShareModal},(0,s.h)(b.oO,{content:this.context.locale.t(h.Z.SOCIAL_SHARING),position:b.lZ.UP_LEFT,tooltipTimeout:this.touchDevice?1e3:void 0},(0,s.h)("span",{class:"icon icon-share"})))),t&&e.push((0,s.h)(S,{open:i===v.P.VR_SELECT})),o&&e.push((0,s.h)(T.Z,null)),e},this.state={reelOpen:!1,briefHlr:!1,viewportHeight:0},this.onResize=(0,R.D)(this.updateViewportSize,250),this.updateViewportSize()}componentDidMount(){this.updateViewportSize(),this.onBriefHLR(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){window.removeEventListener("resize",this.onResize)}render(){const{tourState:e,viewmode:t,openModal:i,openTool:n}=this.props,{tourPlaying:o,tourEnded:r,totalSteps:a}=e,{reelOpen:l}=this.state,h=this.viewmodeToClass[t]||"",d=this.isReelEnabled()&&a>0,u=d&&!n&&!i,p=!n,m={"reel-open":u&&l,"modal-open":!!i,"tour-playing":o},g={"faded-out":!!i&&!n};return(0,s.h)("div",{id:"bottom-ui",class:c("bottom-ui",m,h)},(0,s.h)(O,{tourPlaying:o,tourEnded:r}),(0,s.h)("div",{class:c("bottom-controls",g)},(0,s.h)(G.i,{className:"controls"},this.renderLeftControls(),p&&this.renderRightControls())),d&&this.renderHighlightReel(u),this.renderFooter())}}let W=class extends s.Component{constructor(e){super(e)}render(){let e=this.props.mode===Q.Expanded;const t=this.props.mode===Q.Collapsed,i=this.props.formattedAddress?(0,s.h)("div",{class:"address"},(0,s.h)("i",{class:"icon-pin"}," "),this.props.formattedAddress):null,n=this.props.summary?(0,s.h)("div",{class:"summary-description"},this.props.summary):null,o=this.props.contactName?(0,s.h)("span",{id:"summary-name"},this.props.contactName,(0,s.h)("br",null)):null,r=this.props.formattedContactPhone?this.props.formattedContactPhone:this.props.phone;let a;a=r&&(0,f.tq)()?(0,s.h)("div",null,(0,s.h)("a",{id:"phone",class:"link",href:"tel:"+this.props.phone},r)):r?(0,s.h)("span",{id:"summary-phone"},r,(0,s.h)("br",null)):null;const l=this.props.contactEmail?(0,s.h)("a",{id:"email",class:"link",href:"mailto:"+this.props.contactEmail},this.props.contactEmail,(0,s.h)("br",null)):null,d=!!(o||a||l),u=d?(0,s.h)("i",{class:"icon-user"}," "):null,p=d?(0,s.h)("span",{class:"contact-block"},u,(0,s.h)("div",{class:"contact-data"},o,a,l)):null,m=this.props.externalUrl&&(0,s.h)("div",{id:"external-link"},(0,s.h)("hr",null),(0,s.h)("i",{class:"icon-ext-link"}),(0,s.h)("div",null,(0,s.h)("span",null,this.context.locale.t(h.Z.LEARN_MORE)+": "),(0,s.h)("a",{class:"link",onClick:this.props.onExternalLinkClicked,href:this.props.externalUrl,target:"_blank"},this.props.externalUrl)));e=!(!e||!(d||i||n));const g=c({"main-title":!0,expanded:e,collapsed:t}),v=c({"summary-details":!0,expanded:e,collapsed:t,hasExternalLink:!!m});return(0,s.h)("div",{id:"summary-wrapper",class:g},(0,s.h)("div",{class:v},n,p,i,m))}};W=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],W);const Z=W;let q=class extends s.Component{constructor(e){super(e)}render(){const e=this.props.mode===Q.Collapsed?"right":"left";return(0,s.h)("div",{id:"title-toggle",onClick:this.props.handleClick},(0,s.h)("span",{class:"icon icon-dpad-"+e}))}};q=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],q);const K=q;let Y=class extends s.Component{constructor(e){super(e)}collapsed(){return this.props.mode===Q.Collapsed}expanded(){return this.props.mode===Q.Expanded}render(){const e=this.props.presentedBy,t=this.expanded()?this.context.locale.t(h.Z.LESS):this.context.locale.t(h.Z.MORE),i=this.expanded()?"up":"down",n=c({"main-title":!0,collapsed:this.collapsed()}),o=c({"co-brand":!0,hidden:!e}),r=c({titleText:!0,noCoBrand:!e});return(0,s.h)("div",{type:"button","data-balloon":this.props.name,"data-balloon-pos":"down",class:c("main-title-row",this.collapsed()||this.expanded()?"tooltip-hidden":""),style:"display: inline-block",onClick:this.props.handleClick},(0,s.h)("div",{id:"main-title-wrapper"},(0,s.h)("div",{class:n},(0,s.h)("div",{class:o},this.context.locale.t(h.Z.PRESENTED_BY),(0,s.h)("span",{class:"title",id:"cobrandTitle"}," ",e)),this.props.showHint&&(0,s.h)("div",{class:"hint"},(0,s.h)("span",{class:"link-btn"},t+" ",(0,s.h)("span",{class:"icon icon-dpad-"+i}))),(0,s.h)("div",{id:"gui-name",class:r},this.props.name))))}};Y=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],Y);const $=Y;var Q;!function(e){e[e.Collapsed=0]="Collapsed",e[e.Normal=1]="Normal",e[e.Expanded=2]="Expanded"}(Q||(Q={}));let X=class extends s.Component{constructor(e){super(e),this.toggleTitleCollapse=()=>{this.setTitleBarMode(Q.Collapsed)},this.toggleTitleExpand=()=>{this.state.mode===Q.Expanded?this.setTitleBarMode(Q.Normal):this.setTitleBarMode(Q.Expanded)},this.onExternalLinkClicked=e=>{e.preventDefault(),this.context.analytics.track("showcase_share_origin_link_clicked"),window.open(this.props.modelDetails.externalUrl)},this.state={mode:Q.Normal,lastMode:Q.Normal,open:!0}}setTitleBarMode(e){this.setState((t=>({mode:t.mode===e?t.lastMode:e,lastMode:t.mode})))}getFilteredValue(e,t,i,s){return!this.context.settings.tryGetProperty(t,i)||s&&!this.props.brandingEnabled?"":e}render(){const{modelDetails:e,showExternalUrl:t}=this.props,{name:i,presentedBy:n,summary:o,formattedAddress:r,contact:a,externalUrl:l}=e,{mode:h}=this.state,d=t?l:"",u=this.getFilteredValue(i,I.gx.DetailsModelName,!0,!1),p=this.getFilteredValue(o,I.gx.DetailsSummary,!1,!1),m=this.getFilteredValue(r,I.gx.DetailsAddress,!1,!1),g=this.getFilteredValue(n,I.gx.PresentedBy,!1,!0),f=this.getFilteredValue(a.name,I.gx.DetailsName,!1,!0),v=this.getFilteredValue(a.email,I.gx.DetailsEmail,!1,!0),y=this.getFilteredValue(a.phone,I.gx.DetailsPhone,!1,!0),b=this.getFilteredValue(a.formattedPhone,I.gx.DetailsPhone,!1,!0),w=""!==p||""!==m||""!==v||""!==f||""!==b||""!==y;return(0,s.h)("div",{id:"model-title",className:c(Q[h])},(0,s.h)("div",{class:"title-row"},(0,s.h)(K,{mode:h,handleClick:this.toggleTitleCollapse}),(0,s.h)($,{name:u,mode:h,showHint:w,presentedBy:g,handleClick:this.toggleTitleExpand})),(0,s.h)("div",{class:"details-row"},(0,s.h)(Z,{mode:h,summary:p,formattedAddress:m,phone:y,formattedContactPhone:b,contactEmail:v,contactName:f,externalUrl:d,onExternalLinkClicked:this.onExternalLinkClicked})))}};X=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],X);const J=X;var ee=i(22729);class te extends s.Component{constructor(e){super(e),this.bindings=[],this.updateState=()=>{this.setState({titleActive:!this.floorsViewData.showFloorSelection})},this.state={titleActive:!0}}componentDidMount(){Promise.all([this.context.market.waitForData(ee.c)]).then((e=>{[this.floorsViewData]=e,this.bindings.push(this.floorsViewData.onShowFloorSelectionChanged(this.updateState)),this.updateState()}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{showing:e,tourState:t,modelDetails:i,showExternalUrl:n,brandingEnabled:o,titleBarEnabled:r}=this.props,{titleActive:a}=this.state,l=c({"faded-out":!e||t.tourPlaying||!a});return(0,s.h)("div",{id:"top-ui",class:l},r&&i&&(0,s.h)(J,{modelDetails:i,showExternalUrl:n,brandingEnabled:o}))}}var ie=i(57155),se=i(91172),ne=i(21685),oe=i(83455),re=i(63312),ae=i(10143),le=i(2082),ce=i(82359),he=i(43771),de=i(82209),ue=i(86682),pe=i(42733);class me extends s.Component{constructor(){super(),this.bindings=[],this.clearFloors=async()=>{await this.context.commandBinder.issueCommand(new ue.Vw(null,!1))},this.updateState=()=>{const{floorsViewData:e}=this;this.setState({active:e.showFloorSelection,floorName:e.currentFloorId?e.getFloorName(e.currentFloorId):this.state.floorName})},this.state={active:!1,floorName:void 0}}componentDidMount(){Promise.all([this.context.market.waitForData(ee.c)]).then((e=>{[this.floorsViewData]=e,this.updateState(),this.bindings.push(this.floorsViewData.makeFloorChangeSubscription(this.updateState),this.floorsViewData.onShowFloorSelectionChanged(this.updateState))}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{floorName:e,active:t}=this.state;if(!this.floorsViewData)return null;const i=c("floor-container",{"faded-out":!t});return(0,s.h)("div",{class:i},(0,s.h)("div",{class:"floor-title"},(0,s.h)("div",{class:"h4"},e||"")),(0,s.h)(w.h,{iconClass:"icon-close",buttonStyle:w.D.CLEAR,buttonSize:pe.qE.STANDARD,tooltipPosition:b.lZ.DOWN_RIGHT,onClick:this.clearFloors}))}}class ge extends s.Component{constructor(e){super(e),this.propertiesToRefreshUi=[se.re,oe.Mp,ie.N,I.gx.Labels,m.Q],this.newTagsEnabled=!1,this.notesEnabled=!1,this.onLoadSpinnerMessage=e=>{this.setState({loadSpinnerOn:e.isOpen})},this.onLoadSpinnerSuppressMessage=e=>{this.setState({loadSpinnerSuppress:e.suppress})},this.refreshVisibility=()=>{const e=this.context.settings;this.setState({labelsOn:e.tryGetProperty(ie.N,!1)&&e.tryGetProperty(I.gx.Labels,!1)&&!e.tryGetProperty(m.Q,!1),mattertagsOn:e.tryGetProperty(se.re,!1),notesOn:e.tryGetProperty(oe.Mp,!1),roomBasedNav:e.tryGetProperty(m.Q,!1)})},this.state={mattertagsOn:!1,labelsOn:!1,notesOn:!1,loadSpinnerOn:!1,loadSpinnerSuppress:!1,roomBasedNav:!1}}componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.refreshVisibility),this.context.messageBus.subscribe(de.Z_,this.onLoadSpinnerMessage),this.context.messageBus.subscribe(de.bN,this.onLoadSpinnerSuppressMessage);this.refreshVisibility(),this.newTagsEnabled=this.context.settings.tryGetProperty(ne.R,!1),this.notesEnabled=this.context.settings.tryGetProperty(oe.IA,!1)}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.refreshVisibility),this.context.messageBus.unsubscribe(de.Z_,this.onLoadSpinnerMessage)}render(){const{labelsOn:e,mattertagsOn:t,notesOn:i,roomBasedNav:n,loadSpinnerOn:o,loadSpinnerSuppress:r}=this.state,{mobile:a,viewmode:l,openModal:c,activeTool:h,tourPlaying:d}=this.props,u=o&&!r,p=t&&this.newTagsEnabled,m=i&&this.notesEnabled,g=m||p;return(0,s.h)("div",{class:"overlay-ui"},(0,s.h)(ce.I,null),g&&(0,s.h)(le.E,{notesEnabled:m,newTagsEnabled:p,openModal:c,activeTool:h}),t&&!this.newTagsEnabled&&(0,s.h)(re.$,{tourPlaying:d,toolOpen:!1,mobile:a,allowTagOverlay:!0}),e&&(0,s.h)(ae.H,{viewmode:l}),n&&(0,s.h)(me,null),(0,s.h)(he.Z,{showing:u}))}}var fe=i(58091),ve=i(14071),ye=i(95843),be=i(84952),we=i(20331),Se=i(55656);class Te extends s.Component{constructor(){super(),this.onScrollPositionChange=()=>{this.scrollbars&&this.setState({scrollClass:this.scrollbars.scrollPosition.vertical})},this.onClose=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new y.Bz(v.P.TERMS,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.state={termsText:"",showing:!1,scrollClass:ye.Ij.None}}async componentDidMount(){const e="./terms/terms-"+(this.context.locale?this.context.locale.languageCode:Se.a)+".html";let t="";try{t=await new we.gO({retries:0}).get(e)}catch(e){t=this.context.locale.t(h.Z.TERMS_FAIL)}window.requestAnimationFrame((()=>{this.setState({showing:!0,termsText:t})}))}componentDidUpdate(e){this.state.termsText!==e.termsText&&(this.termsTextDiv.innerHTML=this.state.termsText,[].slice.call(this.termsTextDiv.querySelectorAll("a")).forEach((e=>{e.setAttribute("target","_blank"),e.classList.add("link")})))}render(){const{showing:e,scrollClass:t}=this.state;return(0,s.h)("div",{class:c("modal","terms-modal",{"faded-in":e,[t]:!0}),onClick:this.stopPropagation},(0,s.h)("div",{id:"terms-wrapper"},(0,s.h)(fe.Z,{name:"terms",ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange,forceHidden:(0,be.w)(window)},(0,s.h)("div",{ref:e=>this.termsTextDiv=e,id:"terms-text"}))),(0,s.h)(ve.P,{buttonStyle:ve.A.LIGHT,onClose:this.onClose}))}}var Ee=i(38593),_e=i(18317),xe=i(25903),Me=i(35539),Pe=i(61103);const Ae=new M.Z("webvr");class Oe{constructor(e,t,i){this.vrDisplay=e,this.commandBinder=t,this.onEvent=i,this.startWebVR=()=>{if(this.vrDisplay&&this.vrDisplay.capabilities.canPresent&&!this.vrDisplay.isPresenting){this.onEvent("vr_enter_app"),this.commandBinder.issueCommand(new Pe.w);const e=document.createElement("canvas");for(e.getContext("webgl"),e.className="webvr-canvas",document.bgColor="#000",document.body.style.backgroundColor="#000";document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(e),this.vrDisplay.requestPresent([{source:e}]).then((()=>{window.addEventListener("vrdisplaypresentchange",this.onExitWebVr)})).catch((e=>{Ae.error("requestPresent Failed:",e),this.onEvent("vr_present_error")})),window.dispatchEvent(new Event("vrapp-start"))}else Ae.error("vrDisplay not found, or already presenting"),this.onEvent("vr_present_error")},this.onExitWebVr=()=>{if(!this.vrDisplay.isPresenting){this.onEvent("vr_exit_app"),window.removeEventListener("vrdisplaypresentchange",this.onExitWebVr);let e=window.location.href;-1===window.location.search.indexOf("&qs=1")&&(e+="&qs=1"),Ae.info("redirecting to:",e),window.location.replace(e)}},t.issueCommand(new Pe.s)}}const De=new M.Z("vr-select");let Ie=class extends s.Component{constructor(e){super(e),this.webVRUtility=null,this.stopPropagation=e=>{e.stopPropagation()},this.renderHeadsetHeader=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case Ee.bk.webvr:return(0,s.h)("div",{class:"headset-header"},(0,s.h)("img",{class:"align-center",src:i(7560)}));case Ee.bk.unsupported:case Ee.bk.webxr:return(0,s.h)("div",{class:"headset-header dark"},(0,s.h)("span",{class:"headset-titles"},(0,s.h)("h2",null,e.t(h.Z.VR_RECOMMENDED)),(0,s.h)("h1",null,e.t(h.Z.VR_QUEST))),(0,s.h)("img",{class:"headset-quest",src:i(63931)}));default:return null}},this.renderBodyText=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case Ee.bk.webvr:return(0,s.h)("div",null,(0,s.h)("p",null,e.t(h.Z.VR_APP_INSTRUCT)),(0,s.h)("p",null,e.t(h.Z.VR_APP_RECCOMMENDED)));case Ee.bk.unsupported:case Ee.bk.webxr:return(0,s.h)("div",null,(0,s.h)("p",null,e.t(h.Z.VR_SUPPORTS)));default:return null}},this.getFooterButtons=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state,i=[];return i.push((0,s.h)(pe.zx,{buttonStyle:pe.ZJ.OUTLINE,appendClass:{"button-inline":!0,cancel:!0},onClick:this.onLearnMoreClicked},e.t(h.Z.VR_LEARN_MORE_CAPS))),(t===Ee.bk.webvr||t===Ee.bk.webxr)&&i.push((0,s.h)(pe.zx,{buttonState:pe.BN.ENABLED,appendClass:{"button-inline":!0,confirm:!0},onClick:this.onActionClicked},e.t(h.Z.VR_ENTER))),i},this.closeModal=()=>{this.context.commandBinder.issueCommand(new y.Bz(v.P.VR_SELECT,!1))},this.onCloseClicked=()=>{this.trackEvent("vr_modal_close"),this.closeModal()},this.onActionClicked=()=>{switch(this.state.vrPlatform){case Ee.bk.webvr:this.webVRUtility&&(this.webVRUtility.startWebVR(),this.closeModal());break;case Ee.bk.webxr:this.startWebXR(),this.closeModal()}},this.onLearnMoreClicked=()=>{window.open("https://support.matterport.com/hc/en-us/articles/360050098973-Exploring-Matterport-Spaces-in-VR-","_blank"),this.trackEvent("vr_learn_more")},this.startWebXR=()=>{this.context.commandBinder.issueCommand(new Me.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else De.error("requestPresent Failed"),this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{De.error("requestPresent Failed:",e);const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){_e.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState(),this.trackEvent("click_vr_button")}componentWillUnmount(){_e.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}render(){const{isMobile:e}=this.props,{vrPlatform:t}=this.state,{locale:i}=this.context,n=c("vr-modal","modal","full-modal",{mobile:e,desktop:!e}),o=t===Ee.bk.webvr,r=c("modal-footer",{cardboard:o});return(0,s.h)("dialog",{class:n,onClick:this.stopPropagation},(0,s.h)("header",{class:"modal-header"},(0,s.h)("div",{class:"modal-title"},i.t(h.Z.VR_VIEW_SPACE)),(0,s.h)(ve.P,{onClose:this.onCloseClicked})),this.renderHeadsetHeader(),(0,s.h)("div",{class:"modal-body"},this.renderBodyText()),(0,s.h)("div",{class:r},this.getFooterButtons()))}async updatePlatformState(){const e=await(0,Ee.pl)();switch(e){case Ee.bk.webvr:const e=await xe.H();e&&!this.webVRUtility&&(this.webVRUtility=new Oe(e,this.context.commandBinder,this.trackEvent.bind(this)))}this.setState({vrPlatform:e}),De.debug(this.state)}trackEvent(e,t){let i={gui_action:e,orientation:(0,f.mI)()?"landscape":"portrait",vr_platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};Ie=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],Ie);const Ce=Ie;class Re extends s.Component{render(){const{isMobile:e}=this.props,{locale:t}=this.context;return(0,s.h)("div",{class:"cta"},(0,s.h)("h1",{class:c({mobile:e})},t.t(e?h.Z.MOBILE_SHORT_CTA:h.Z.DESKTOP_SHORT_CTA)))}}const Le={mouse:{click:i(41891),clickInside:i(70626),dragLeft:i(73993),dragRight:i(26668),play:i(31891),positionLeft:i(82906),positionRight:i(64991),zoom:i(12136)},gesture:{drag:i(72145),dragTwoFinger:i(12742),pinch:i(5435),position:i(67649),positionTwoFinger:i(2433),tap:i(24367),tapInside:i(90619),play:i(94874)},keyboard:{all:i(76064),inside:i(64549),leftRight:i(81202),spaceBar:i(71002),upDown:i(42135),zoom:i(26407)},moreHelp:{view360:i(86533),mattertag:i(14653)}};class Ne extends s.Component{constructor(){super(...arguments),this.keys={header:h.Z.DESKTOP_SHORT_CTA,move:h.Z.MOVE,inside:h.Z.INSIDE,rotate:h.Z.ROTATE,play:h.Z.PLAY,zoom:h.Z.ZOOM},this.clickInside={Icon:Le.mouse.clickInside,Label:this.keys.inside,FooterIcon:Le.keyboard.inside},this.clickMove={Icon:Le.mouse.positionRight,Label:this.keys.move,FooterIcon:""},this.moveUpDown={Icon:Le.mouse.click,Label:this.keys.move,FooterIcon:Le.keyboard.upDown},this.play={Icon:Le.mouse.play,Label:this.keys.play,FooterIcon:null},this.zoom={Icon:Le.mouse.zoom,Label:this.keys.zoom,FooterIcon:Le.keyboard.zoom},this.dragMove={Icon:Le.mouse.positionLeft,Label:this.keys.move,FooterIcon:null},this.dragRotateLeft={Icon:Le.mouse.dragLeft,Label:this.keys.rotate,FooterIcon:Le.keyboard.leftRight},this.dragRotateRight={Icon:Le.mouse.dragRight,Label:this.keys.rotate,FooterIcon:Le.keyboard.leftRight},this.left=this.clickInside,this.center=this.clickMove,this.right=this.play}render(){const{viewmode:e}=this.props,{locale:t}=this.context;return this.configureViewmodeSpecifics(e),(0,s.h)("div",{class:c({cta:!0})},(0,s.h)("h1",null,t.t(this.keys.header)),(0,s.h)("h2",null,t.t(this.left.Label)),(0,s.h)("img",{src:this.left.Icon}),this.left.FooterIcon?(0,s.h)("hr",null):(0,s.h)("span",null),this.left.FooterIcon?(0,s.h)("img",{class:"footer-icon",src:this.left.FooterIcon}):(0,s.h)("span",null),(0,s.h)("h2",null,t.t(this.center.Label)),(0,s.h)("img",{src:this.center.Icon}),this.center.FooterIcon?(0,s.h)("hr",null):(0,s.h)("span",null),this.center.FooterIcon?(0,s.h)("img",{class:"footer-icon",src:this.center.FooterIcon}):(0,s.h)("span",null),(0,s.h)("h2",null,t.t(this.right.Label)),(0,s.h)("img",{src:this.right.Icon}),this.right.FooterIcon?(0,s.h)("hr",null):(0,s.h)("span",null),this.right.FooterIcon?(0,s.h)("img",{class:"footer-icon",src:this.right.FooterIcon}):(0,s.h)("span",null))}configureViewmodeSpecifics(e){switch(e){case C.BD.INSIDE:this.left=this.dragRotateLeft,this.center=this.moveUpDown,this.right=this.props.isHelpCta?this.zoom:this.play;break;case C.BD.OUTSIDE:case C.BD.DOLLHOUSE:this.left=this.dragRotateLeft,this.center=this.clickMove,this.right=this.clickInside;break;case C.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.dragRotateRight,this.right=this.clickInside}}}class ke extends s.Component{constructor(){super(...arguments),this.keys={shortCta:h.Z.MOBILE_SHORT_CTA,move:h.Z.MOVE,inside:h.Z.INSIDE,rotate:h.Z.ROTATE,play:h.Z.PLAY,zoom:h.Z.ZOOM},this.clickInside={Icon:Le.gesture.tapInside,Label:this.keys.inside},this.clickMove={Icon:Le.gesture.tap,Label:this.keys.move},this.dragRotate={Icon:Le.gesture.drag,Label:this.keys.rotate},this.dragMove={Icon:Le.gesture.position,Label:this.keys.move},this.play={Icon:Le.gesture.play,Label:this.keys.play},this.zoom={Icon:Le.gesture.pinch,Label:this.keys.zoom},this.left=this.dragRotate,this.center=this.clickInside,this.right=this.play}render(){const e=c({mobile:!0}),{viewmode:t}=this.props,{locale:i}=this.context;return this.configureViewmodeSpecifics(t),(0,s.h)("div",{class:c({cta:!0,mobile:!0})},(0,s.h)("h1",{class:e},i.t(this.keys.shortCta)),(0,s.h)("h2",{class:e},i.t(this.left.Label)),(0,s.h)("img",{src:this.left.Icon}),(0,s.h)("h2",{class:e},i.t(this.center.Label)),(0,s.h)("img",{src:this.center.Icon}),(0,s.h)("h2",{class:e},i.t(this.right.Label)),(0,s.h)("img",{src:this.right.Icon}))}configureViewmodeSpecifics(e){switch(e){case C.BD.INSIDE:this.left=this.dragRotate,this.center=this.clickMove,this.right=this.props.isHelpCta?this.zoom:this.play;break;case C.BD.DOLLHOUSE:case C.BD.OUTSIDE:this.left=this.dragRotate,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play;break;case C.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play}}}var Fe=i(53339);const Be=new M.Z("cta");var Ue,He;!function(e){e[e.NONE=0]="NONE",e[e.LARGE=1]="LARGE",e[e.SMALL=2]="SMALL"}(Ue||(Ue={})),function(e){e[e.HELP=0]="HELP",e[e.TOUR=1]="TOUR"}(He||(He={}));let Ge=class extends s.Component{constructor(e){super(e),this.styles=[Ue.NONE],this.bindings=[],this.handleInteraction=()=>{this.props.showCta&&(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new y.Bz(v.P.CTA,!1)))},this.onTourStopped=()=>{this.state.ctaSource!==He.TOUR||this.state.seenCta||(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new y.Bz(v.P.CTA,!0)))},this.onTourStarted=()=>{this.state.ctaSource===He.HELP&&2===this.styles.length&&this.setState({ctaSource:He.TOUR,seenCta:!1,style:this.styles[1]}),this.props.showCta&&this.context.commandBinder.issueCommand(new y.Bz(v.P.CTA,!1))},this.state={ctaSource:He.TOUR,seenCta:!1,style:this.styles[0]}}componentDidMount(){const{canvas:e}=this.props,{messageBus:t,settings:i}=this.context;try{e&&(e.addEventListener("mousedown",this.handleInteraction),e.addEventListener("pointerdown",this.handleInteraction),e.addEventListener("touchstart",this.handleInteraction)),this.bindings.push(t.subscribe(Fe.NR,this.onTourStopped),t.subscribe(Fe.Mt,this.onTourStopped),t.subscribe(Fe.oR,this.onTourStarted))}catch(e){Be.debug(e)}let s=this.state.ctaSource;const n=parseInt(i.tryGetProperty("tourcta",1),10);!isNaN(n)&&n in Ue&&(this.styles[0]=n,s=He.TOUR);const o=i.tryGetProperty("help",0);!isNaN(o)&&o in Ue&&o!==Ue.NONE&&(this.styles[0]===Ue.NONE?this.styles[0]=o:this.styles.unshift(o),s=He.HELP),this.styles[0]!==Ue.NONE&&this.setState({style:this.styles[0],ctaSource:s})}componentWillUnmount(){const{canvas:e}=this.props;e&&(e.removeEventListener("mousedown",this.handleInteraction),e.removeEventListener("pointerdown",this.handleInteraction),e.removeEventListener("touchstart",this.handleInteraction)),this.bindings.forEach((e=>e.cancel()))}renderCtaStyle(){const{isMobile:e,viewmode:t}=this.props,{style:i,ctaSource:n}=this.state;switch(i){case Ue.NONE:return null;case Ue.SMALL:return(0,s.h)(Re,{isMobile:e});case Ue.LARGE:return e?(0,s.h)(ke,{isMobile:e,viewmode:t,isHelpCta:n===He.HELP}):(0,s.h)(Ne,{viewmode:t,isHelpCta:n===He.HELP})}}render(){const{showCta:e,isMobile:t}=this.props,{style:i,ctaSource:n}=this.state,o={ctaContainer:!0,mobile:t,showMessage:e,small:i===Ue.SMALL,helpCta:n===He.HELP};return(0,s.h)("div",{id:"cta-container",class:c(o)},this.renderCtaStyle())}};Ge=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],Ge);const Ve=Ge;var ze,je,We,Ze,qe,Ke;!function(e){e[e.navigation=0]="navigation",e[e.moreHelp=1]="moreHelp"}(ze||(ze={})),function(e){e.left="left",e.middle="middle",e.right="right"}(je||(je={})),function(e){e.topInfo="topInfo",e.bigImage="bigImage",e.bottomInfo="bottomInfo",e.keyboard="keyboard"}(We||(We={})),function(e){e.desktop="desktop",e.mobile="mobile"}(Ze||(Ze={})),function(e){e.hlr="hlr",e.dollhouse="dollhouse",e.floors="floors",e.mattertag="mattertag",e.floorplan="floorplan",e.tour="tour",e.inside="inside",e.vr="vr",e.view360="view360",e.fullscreen="fullscreen"}(qe||(qe={})),function(e){e.landscape="landscape",e.portrait="portrait"}(Ke||(Ke={}));const Ye={[Ze.desktop]:{[je.left]:{[We.topInfo]:"HELP_DESKTOP_PANORAMA_1A",[We.bottomInfo]:"HELP_DESKTOP_PANORAMA_1B",[We.bigImage]:Le.mouse.dragLeft,[We.keyboard]:Le.keyboard.leftRight},[je.middle]:{[We.topInfo]:"HELP_DESKTOP_PANORAMA_2A",[We.bottomInfo]:"HELP_DESKTOP_PANORAMA_2B",[We.bigImage]:Le.mouse.click,[We.keyboard]:Le.keyboard.upDown},[je.right]:{[We.topInfo]:"HELP_DESKTOP_PANORAMA_3A",[We.bottomInfo]:"HELP_DESKTOP_PANORAMA_3B",[We.bigImage]:Le.mouse.zoom,[We.keyboard]:Le.keyboard.zoom}},[Ze.mobile]:{[je.left]:{[We.topInfo]:"HELP_MOBILE_PANORAMA_1",[We.bigImage]:Le.gesture.drag},[je.middle]:{[We.topInfo]:"HELP_MOBILE_PANORAMA_2",[We.bigImage]:Le.gesture.tap},[je.right]:{[We.topInfo]:"HELP_MOBILE_3",[We.bigImage]:Le.gesture.pinch}}},$e={[Ze.desktop]:{[je.left]:{[We.topInfo]:"HELP_DESKTOP_DOLLHOUSE_1A",[We.bottomInfo]:"HELP_DESKTOP_DOLLHOUSE_1B",[We.bigImage]:Le.mouse.dragLeft,[We.keyboard]:Le.keyboard.all},[je.middle]:{[We.topInfo]:"HELP_DESKTOP_DOLLHOUSE_2A",[We.bigImage]:Le.mouse.positionRight},[je.right]:{[We.topInfo]:"HELP_DESKTOP_DOLLHOUSE_3A",[We.bigImage]:Le.mouse.zoom}},[Ze.mobile]:{[je.left]:{[We.topInfo]:"HELP_MOBILE_DOLLHOUSE_1",[We.bigImage]:Le.gesture.drag},[je.middle]:{[We.topInfo]:"HELP_MOBILE_DOLLHOUSE_2",[We.bigImage]:Le.gesture.positionTwoFinger},[je.right]:{[We.topInfo]:"HELP_MOBILE_3",[We.bigImage]:Le.gesture.pinch}}},Qe={[Ze.desktop]:{[je.left]:{[We.topInfo]:"HELP_DESKTOP_FLOORPLAN_1A",[We.bigImage]:Le.mouse.positionLeft},[je.middle]:{[We.topInfo]:"HELP_DESKTOP_FLOORPLAN_2A",[We.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_2B",[We.bigImage]:Le.mouse.dragRight,[We.keyboard]:Le.keyboard.leftRight},[je.right]:{[We.topInfo]:"HELP_DESKTOP_FLOORPLAN_3A",[We.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_3B",[We.bigImage]:Le.mouse.zoom,[We.keyboard]:Le.keyboard.upDown}},[Ze.mobile]:{[je.left]:{[We.topInfo]:"HELP_MOBILE_FLOORPLAN_1",[We.bigImage]:Le.gesture.position},[je.middle]:{[We.topInfo]:"HELP_MOBILE_FLOORPLAN_2",[We.bigImage]:Le.gesture.dragTwoFinger},[je.right]:{[We.topInfo]:"HELP_MOBILE_3",[We.bigImage]:Le.gesture.pinch}}},Xe=JSON.parse(JSON.stringify(Ye));Xe.desktop.middle={[We.topInfo]:"HELP_DESKTOP_360_2A",[We.bottomInfo]:"HELP_DESKTOP_360_2B",[We.bigImage]:Le.mouse.clickInside,[We.keyboard]:Le.keyboard.inside},Xe.mobile.middle={[We.topInfo]:"HELP_MOBILE_360_2",[We.bigImage]:Le.gesture.tapInside};const Je={INSIDE:Ye,OUTSIDE:Xe,FLOORPLAN:Qe,DOLLHOUSE:$e};var et=i(10396);let tt=class extends s.Component{constructor(e){super(e),this.state={overflow:!1}}componentWillReceiveProps(e){(this.navigationDiv&&this.navigationDiv.clientHeight||0)/(this.navigationDiv.parentElement&&this.navigationDiv.parentElement.clientHeight||1)>.7&&this.setState({overflow:!0})}getAssetObj(e){switch(e){case this.props.Modes.DOLLHOUSE:return Je.DOLLHOUSE[this.props.device];case this.props.Modes.FLOORPLAN:return Je.FLOORPLAN[this.props.device];case this.props.Modes.OUTSIDE:return Je.OUTSIDE[this.props.device];case this.props.Modes.INSIDE:default:return Je.INSIDE[this.props.device]}}buildRows(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in We){const n=[],o=[];for(const t in je)if(n.push(this.wrapAsset(e,t,i,!1)),i===We.bigImage){const i=!e[t][We.bottomInfo];o.push((0,s.h)("div",{class:c(t,"column",{noDivider:i})},(0,s.h)("hr",null)))}t.push((0,s.h)("div",{class:c(i,"row")},n))}return t}buildMobilePortrait(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in e)for(const s in e[i])t.push(this.wrapAsset(e,i,s,!0));return t}wrapAsset(e,t,i,n){const o=e[t][i],r=i===We.bigImage||i===We.keyboard;return(0,s.h)("div",{class:n?c(i,"row"):c(t,"column")},o&&r?(0,s.h)("img",{src:o}):o&&this.context.locale.t(o))}render(){const e=this.props.device===Ze.mobile&&this.props.orientation===et.i5.PORTRAIT,t=c({navigation:!0,small:this.state.overflow,[this.props.viewmode]:!0});return(0,s.h)("div",{class:t,ref:e=>{this.navigationDiv=e}},e?(0,s.h)(fe.Z,{name:"navigation",forceHidden:!1},(0,s.h)("div",{class:"nav-wrapper"},this.buildMobilePortrait())):this.buildRows())}};tt=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],tt);const it=tt,st={[qe.hlr]:{[We.topInfo]:"HELP_MORE_HLR_A",[We.bigImage]:"icon-hlr",[We.bottomInfo]:"HELP_DESKTOP_MORE_HLR_B"},[qe.dollhouse]:{[We.topInfo]:"HELP_MORE_DOLLHOUSE_A",[We.bigImage]:"icon-dollhouse",[We.bottomInfo]:"HELP_MOBILE_MORE_DOLLHOUSE_B"},[qe.floors]:{[We.topInfo]:"HELP_MORE_FLOORS_A",[We.bigImage]:"icon-floor-controls",[We.bottomInfo]:"HELP_DESKTOP_MORE_FLOORS_B"},[qe.mattertag]:{[We.topInfo]:"HELP_MORE_MATTERTAG_A",[We.bigImage]:Le.moreHelp.mattertag,[We.bottomInfo]:"HELP_MOBILE_MORE_MATTERTAG_B"},[qe.tour]:{[We.topInfo]:"HELP_MORE_TOUR_A",[We.bigImage]:"icon-play",[We.bottomInfo]:"HELP_DESKTOP_MORE_TOUR_B"},[qe.inside]:{[We.topInfo]:"HELP_MORE_INSIDE_A",[We.bigImage]:"icon-panorama",[We.bottomInfo]:"HELP_MOBILE_MORE_INSIDE_B"},[qe.vr]:{[We.topInfo]:"HELP_MORE_VR_A",[We.bigImage]:"icon-vr",[We.bottomInfo]:"HELP_MOBILE_MORE_VR_B"},[qe.view360]:{[We.topInfo]:"HELP_MORE_360_A",[We.bigImage]:Le.moreHelp.view360,[We.bottomInfo]:"HELP_MOBILE_MORE_360_B"},[qe.floorplan]:{[We.topInfo]:"HELP_MORE_FLOORPLAN_A",[We.bigImage]:"icon-floorplan",[We.bottomInfo]:"HELP_MOBILE_FLOORPLAN_B"}},nt=JSON.parse(JSON.stringify(st));nt[qe.fullscreen]={[We.topInfo]:"HELP_MORE_FULLSCREEN_A",[We.bigImage]:"icon-fullscreen",[We.bottomInfo]:"HELP_DESKTOP_MORE_FULLSCREEN_B"},nt[qe.dollhouse][We.bottomInfo]="HELP_DESKTOP_MORE_DOLLHOUSE_B",nt[qe.mattertag][We.bottomInfo]="HELP_DESKTOP_MORE_MATTERTAG_B",nt[qe.inside][We.bottomInfo]="HELP_DESKTOP_MORE_INSIDE_B",nt[qe.vr][We.bottomInfo]="HELP_DESKTOP_MORE_VR_B",nt[qe.view360][We.bottomInfo]="HELP_DESKTOP_MORE_360_B",nt[qe.floorplan][We.bottomInfo]="HELP_DESKTOP_FLOORPLAN_B";const ot={[Ze.desktop]:nt,[Ze.mobile]:st},rt=[We.topInfo,We.bigImage,We.bottomInfo];class at extends s.Component{constructor(e){super(e)}componentDidMount(){this.scrollbars.scrollTo({x:0,y:0})}buildInstructions(){const e=[],t=this.props.device===Ze.desktop?5:this.props.orientation===et.i5.LANDSCAPE?3:2,i=Object.keys(ot[this.props.device]);for(let n=0;n<i.length;n+=t){for(const o of rt){const r=[];for(let e=0;e<t;e++){if(n+e>=i.length)continue;const t=ot[this.props.device][i[n+e]][o],a=c(o,i[n+e],{noAsset:!t});switch(o){case We.topInfo:r.push((0,s.h)("div",{class:a},this.context.locale.t(t)));break;case We.bigImage:r.push((0,s.h)("div",{class:a},t.indexOf(".png")>-1?(0,s.h)("img",{src:t}):(0,s.h)("span",{class:t},"floors"===i[n+e]?(0,s.h)("span",null,"2"):null)));break;case We.bottomInfo:r.push((0,s.h)("div",{class:a},this.context.locale.t(t)))}}e.push((0,s.h)("div",{class:c("innerRow",o)},r))}e.push((0,s.h)("div",{class:"rowPadding"}))}return e.pop(),e}render(){return(0,s.h)("div",{class:c("more-help-wrapper",this.props.device)},(0,s.h)(fe.Z,{name:"more-help-wrapper",ref:e=>this.scrollbars=e,forceHidden:!1},(0,s.h)("div",{class:c("more-help")},this.buildInstructions())))}}let lt=class extends s.Component{constructor(e){super(e),this.setOrientation=e=>{const{orientation:t}=e;this.setState({orientation:t})},this.handleTabClick=e=>()=>{this.setState({tab:e})},this.closeHelp=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new y.Bz(v.P.HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.device=this.props.isMobile?Ze.mobile:Ze.desktop,this.state={showing:!1,tab:ze.navigation,orientation:(0,et.T8)().orientation},this.orientationSubscription=(0,et.kp)(et.g_.ORIENTATION_CHANGED,this.setOrientation)}componentDidMount(){this.orientationSubscription.renew(),window.requestAnimationFrame((()=>{this.setState({showing:!0})}))}componentWillUnmount(){this.orientationSubscription.cancel()}render(){const{showing:e,tab:t,orientation:i}=this.state;return(0,s.h)("div",{id:"help-modal",class:c(this.device,{"faded-in":e}),onClick:this.stopPropagation},(0,s.h)("div",{class:c("tabs",t)},(0,s.h)("div",{class:c("navigation-tab",{active:t===ze.navigation}),onClick:this.handleTabClick(ze.navigation)},(0,s.h)("span",null,this.context.locale.t(h.Z.HELP_NAVIGATION_TAB))),(0,s.h)("div",{class:c("more-help-tab",{active:t===ze.moreHelp}),onClick:this.handleTabClick(ze.moreHelp)},(0,s.h)("span",null,this.context.locale.t(h.Z.HELP_MORE_HELP_TAB)))),t===ze.navigation&&(0,s.h)(it,{device:this.device,Modes:this.props.allModes,viewmode:this.props.viewmode,orientation:i}),t===ze.moreHelp&&(0,s.h)(at,{device:this.device,orientation:i}),(0,s.h)(ve.P,{buttonStyle:ve.A.LIGHT,onClose:this.closeHelp}))}};lt=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],lt);const ct=lt;var ht=i(4292);class dt extends s.Component{constructor(){super(),this.closeIframe=()=>{this.context.commandBinder.issueCommand(new y.Bz(v.P.MATTERTAG_EMBED,!1)),this.setState({url:"",isIframeOpen:!1})},this.setIFrameOpen=e=>{e.embed&&(this.context.commandBinder.issueCommand(new y.Bz(v.P.MATTERTAG_EMBED,!0)),this.setState({isIframeOpen:!0,url:e.url}))}}componentDidMount(){this.context.messageBus.subscribe(ht.Ik,this.setIFrameOpen)}componentWillUnmount(){this.context.messageBus.unsubscribe(ht.Ik,this.setIFrameOpen)}render(){return this.state.url?(0,s.h)("div",{class:"mattertag-emb-link"},(0,s.h)("iframe",{id:"mattertag-emb-iframe",name:"mattertagEmb",sandbox:"allow-forms allow-scripts allow-same-origin allow-presentation"}),(0,s.h)(ve.P,{buttonStyle:ve.A.SHADOW,onClose:this.closeIframe})):null}}var ut,pt=i(73621),mt=i(55580),gt=i(87694),ft=i(89155),vt=i(77956),yt=i(12775);!function(e){e.MAIL="mail",e.PINTEREST="pinterest",e.LINKEDIN="linkedin",e.TWITTER="twitter",e.FACEBOOK="facebook",e.COPYLINK="copylink",e.NATIVE="native"}(ut||(ut={}));const{FACEBOOK:bt,TWITTER:wt,MAIL:St,PINTEREST:Tt,LINKEDIN:Et,COPYLINK:_t,NATIVE:xt}=ut,Mt=`${window.location.origin}/show/`,Pt={[St]:"em",[Tt]:"pn",[Et]:"ln",[wt]:"tw",[bt]:"fb",[_t]:"cp",[xt]:"os"},At={[bt]:{width:626,height:436},[wt]:{width:550,height:440},[Tt]:{width:750,height:749},[Et]:{width:550,height:453},[_t]:{},[St]:{},[xt]:{}},Ot=async(e,t=!0)=>{let i={};if(t){const[t,s,n,o]=await Promise.all([e.engine.market.waitForData(vt.Z),e.engine.market.waitForData(yt.O),e.engine.market.waitForData(ee.c),e.engine.market.waitForData(ft.M_)]);i=gt.K.serialize({cameraData:o,viewmodeData:s,floorsViewData:n,sweepData:t})}else i=gt.K.removeNavigationKeys(f.AO());const s=["ref","gclid","fbclid","cloudEdit"];Object.keys(i).forEach((e=>{(s.includes(e)||0===e.indexOf("utm_"))&&delete i[e]}));const n=Object.keys(i).map((e=>e+"="+i[e])).join("&");return`${Mt}?${n}`},Dt=e=>Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&"),It=(e,t,i)=>{const s=e.replace("?",`?ref=${Pt[bt]}&`);return`http://www.facebook.com/sharer.php?${Dt({display:"popup",u:s})}`},Ct=(e,t,i)=>{const s=e.replace("?",`?ref=${Pt[wt]}&`),n={text:i.t(h.Z.SHARED_MESSAGE_HASHTAG,{title:t,url:s,hashtag:"#Matterport"})};return`http://twitter.com/intent/tweet?${Dt(n)}`},Rt=(e,t,i)=>{const s=e.replace("?",`?ref=${Pt[St]}&`),n={subject:i.t(h.Z.SHARED_TITLE,{title:t}),body:i.t(h.Z.SHARED_MESSAGE,{title:t,url:s})};return`mailto:?${Dt(n)}`},Lt=(e,t,i,s)=>{const n={url:e.replace("?",`?ref=${Pt[Tt]}&`),media:i,description:s.t(h.Z.SHARED_TITLE,{title:t})};return`http://pinterest.com/pin/create/link/?${Dt(n)}`},Nt=(e,t,i)=>{const s=e.replace("?",`?ref=${Pt[Et]}&`);return`https://www.linkedin.com/shareArticle?${Dt({mini:"true",url:s})}`},kt=(e,t,i,s)=>({[bt]:It(e),[wt]:Ct(e,t,s),[St]:Rt(e,t,s),[Tt]:Lt(e,t,i,s),[Et]:Nt(e),[_t]:e,[xt]:e}),Ft=new M.Z("share-modal");class Bt extends s.Component{constructor(){super(),this.copyURL=()=>{const{deeplink:e}=this.state;this.urlInputRef.select(),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.urlInputRef.blur(),this.setState({copied:!0}),this.context.analytics.track("showcase_share_action",{channel:ut.COPYLINK,pano_id:this.sweepData.currentSweep,deeplink:e}),window.setTimeout((()=>{this.setState({copied:!1})}),2500)},this.toggleDeeplinks=()=>{const{deeplink:e}=this.state;this.setState({deeplink:!e})},this.close=()=>{this.context.commandBinder.issueCommand(new y.Bz(v.P.SHARE,!1))},this.openShareWindow=e=>{const{urls:t,deeplink:i,deeplinkUrls:s}=this.state,{width:n,height:o}=At[e],r=i?s[e]:t[e];let a;n&&o&&(a="top="+(window.screenY+(window.innerHeight-o)/2)+",left="+(window.screenX+(window.innerWidth-n)/2)+",width="+n+",height="+o),this.context.analytics.track("showcase_share_action",{channel:e,pano_id:this.sweepData.currentSweep,deeplink:i}),window.open(r,"",a)},this.openWebShareApi=e=>{if(!navigator.share)return;const{excerpt:t,title:i,urls:s,deeplinkUrls:n}=this.state,o={url:e?n[ut.COPYLINK]:s[ut.COPYLINK],text:t,title:i};Ft.debug("Launching Web Share API",o),navigator.share(o),this.context.analytics.track("showcase_share_action",{channel:ut.NATIVE,pano_id:this.sweepData.currentSweep,deeplink:e})},this.onWebShareClick=()=>{this.openWebShareApi(!1)},this.onWebShareDeeplinkClick=()=>{this.openWebShareApi(!0)},this.stopPropagation=e=>e.stopPropagation(),this.setUrlInputRef=e=>{this.urlInputRef=e},this.state={urls:{},deeplinkUrls:{},title:"",excerpt:"",image:"",copied:!1,deeplink:!1,webShareEnabled:(0,f.J1)()},this.openFacebook=this.openShareWindow.bind(this,ut.FACEBOOK),this.openTwitter=this.openShareWindow.bind(this,ut.TWITTER),this.openPinterest=this.openShareWindow.bind(this,ut.PINTEREST),this.openLinkedIn=this.openShareWindow.bind(this,ut.LINKEDIN),this.openEmail=this.openShareWindow.bind(this,ut.MAIL)}async componentDidMount(){const{market:e}=this.context,[t,i]=await Promise.all([e.waitForData(mt.T),e.waitForData(vt.Z)]);this.sweepData=i;const s=t.model,n=`${window.location.origin}/api/v1/player/models/${s.sid}/thumb`,o=s.details.name;this.setState({title:o,image:n},this.updateUrls)}async updateUrls(){const{title:e,image:t}=this.state,[i,s]=await Promise.all([Ot(this.context,!1),Ot(this.context,!0)]),n=kt(i,e,t,this.context.locale),o=kt(s,e,t,this.context.locale);Ft.debug("Social Share URLs:",n),Ft.debug("Social Share URLs, with current location",o),this.setState({urls:n,deeplinkUrls:o})}renderWebShareDialog(){return(0,s.h)("div",{class:"share-controls"},(0,s.h)(pe.zx,{appendClass:{"share-modal-button":!0},buttonStyle:pe.ZJ.PRIMARY,onClick:this.onWebShareDeeplinkClick},this.context.locale.t(h.Z.SHARE_CURRENT_LOCATION)),(0,s.h)(pe.zx,{appendClass:{"share-modal-button":!0},buttonStyle:pe.ZJ.OUTLINE,onClick:this.onWebShareClick},this.context.locale.t(h.Z.SHARE_DEFAULT_LOCATION)))}renderShareDialog(){const{copied:e,deeplink:t,urls:i,deeplinkUrls:n}=this.state,o=t?n[ut.COPYLINK]:i[ut.COPYLINK],r=this.sweepData&&this.sweepData.isSweepDisabled(),a=r?this.context.locale.t(h.Z.SHARE_ERROR_SWEEP_DISABLED):void 0;return(0,s.h)("div",{class:"share-controls"},(0,s.h)("div",{class:"social-icons"},(0,s.h)(w.h,{onClick:this.openFacebook,iconClass:"icon-facebook",buttonStyle:w.D.SOCIAL,buttonSize:pe.qE.LARGE}),(0,s.h)(w.h,{onClick:this.openTwitter,iconClass:"icon-twitter",buttonStyle:w.D.SOCIAL,buttonSize:pe.qE.LARGE}),(0,s.h)(w.h,{onClick:this.openLinkedIn,iconClass:"icon-linkedin",buttonStyle:w.D.SOCIAL,buttonSize:pe.qE.LARGE}),(0,s.h)(w.h,{onClick:this.openPinterest,iconClass:"icon-pinterest",buttonStyle:w.D.SOCIAL,buttonSize:pe.qE.LARGE}),(0,s.h)(w.h,{onClick:this.openEmail,iconClass:"icon-email",buttonStyle:w.D.SOCIAL,buttonSize:pe.qE.LARGE})),(0,s.h)("div",{class:"input-group"},(0,s.h)("input",{class:"input",type:"text",value:o||"",ref:this.setUrlInputRef,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,readOnly:!0}),(0,s.h)(b.oO,{content:e?this.context.locale.t(h.Z.SHARE_COPIED):this.context.locale.t(h.Z.COPY_URL),position:b.lZ.UP,tooltipTimeout:2e3},(0,s.h)("button",{class:"input-addon",onClick:this.copyURL},this.context.locale.t(h.Z.COPY)))),(0,s.h)(pt.X,{dataValue:"deeplink",key:"deeplink",checked:t,enabled:!r,error:r,helpText:a,label:this.context.locale.t(h.Z.SHARE_LINK_TO_LOCATION),onChange:this.toggleDeeplinks}))}render(){const{webShareEnabled:e}=this.state,t=c("modal","share-modal","modal-dialog",{"share-dialog":!e,"web-share-dialog":e}),i=e?this.renderWebShareDialog():this.renderShareDialog();return(0,s.h)("dialog",{open:!0,class:t,onClick:this.stopPropagation},(0,s.h)("header",{class:"modal-header"},(0,s.h)("div",{class:"modal-title"},this.context.locale.t(h.Z.SHARE_MODAL_TITLE)),(0,s.h)(ve.P,{onClose:this.close})),(0,s.h)("div",{class:"modal-body"},i))}}var Ut=i(59984);class Ht extends s.Component{constructor(e,t){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new y.Bz(v.P.MEASUREMENT_HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.locale={headerString:t.locale.t(h.Z.MEASUREMENT_MODE),subHeaderString:t.locale.t(h.Z.MEASUREMENT_HELP_MODAL_SUB_HEADER),body1String:t.locale.t(h.Z.MEASUREMENT_HELP_MODAL_BODY_1),body2String:t.locale.t(h.Z.MEASUREMENT_HELP_MODAL_BODY_2)}}render(){const{headerString:e,subHeaderString:t,body1String:i,body2String:n}=this.locale,{mobile:o}=this.props;return(0,s.h)("div",{class:c("modal","full-modal","measurement-mode-help-modal",{mobile:o}),onClick:this.stopPropagation},(0,s.h)("header",{class:"modal-header"},(0,s.h)("div",{class:"modal-title"},e),(0,s.h)(ve.P,{onClose:this.closeModal})),(0,s.h)("div",{class:"modal-subheader"},t),(0,s.h)("div",{class:"modal-body"},(0,s.h)("p",{class:"modal-paragraph"},i),(0,s.h)("p",{class:"modal-paragraph"},n)))}}class Gt extends s.Component{constructor(e){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new y.rE)},this.mobile=(0,f.tq)()}componentDidMount(){this.context.market.waitForData(mt.T).then((e=>{this.setState({modelDetails:e.model.details})}))}render(){const{openModal:e,viewmode:t,glCanvas:i}=this.props,{modelDetails:n}=this.state,o=e===v.P.SHARE,r=e===v.P.TERMS,a=e===v.P.HELP,l=e===v.P.CTA,c=e===v.P.MEASUREMENT_HELP,h=e===v.P.VR_SELECT,d=r||a,u=o||d||c||h&&!!n;return(0,s.h)("div",{id:"showcase-modals"},(0,s.h)(Ut.N,{appendClass:{"modal-background":!0,"dark-modal-background":d,open:u},open:u,selectChild:!0,childKey:e||void 0,onClick:this.closeModal},(0,s.h)(Bt,{key:v.P.SHARE}),(0,s.h)(Ht,{key:v.P.MEASUREMENT_HELP,mobile:this.mobile}),n&&(0,s.h)(Ce,{key:v.P.VR_SELECT,isMobile:this.mobile,modelDetails:n}),r&&(0,s.h)(Te,{key:v.P.TERMS}),a&&(0,s.h)(ct,{key:v.P.HELP,isMobile:this.mobile,viewmode:t,allModes:C.BD})),(0,s.h)(Ve,{canvas:i,isMobile:this.mobile,viewmode:t,showCta:l}),(0,s.h)(dt,null))}}var Vt=i(98728),zt=i(39869),jt=i(71208),Wt=i(14738),Zt=i(22952),qt=i(78641),Kt=i(75843),Yt=i(90926),$t=i(52595);let Qt=class extends s.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{this.setState({openTagView:this.props.manager.dataMap.tagsViewData.openTagView})},this.updatePinData=()=>{this.setState({pinState:this.props.manager.dataMap.pinsViewData.pinState})},this.state={pinState:Yt.tS.IDLE,openTagView:null}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateTagData),t.onPinStateChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{toolPanelLayout:e,manager:t,openModal:i}=this.props;return i?null:(0,s.h)("div",{class:"overlay"},(0,s.h)($t.O,{toolPanelLayout:e,manager:t}))}};Qt=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],Qt);var Xt=i(60930);let Jt=class extends s.Component{constructor(){super(),this.startWebXR=()=>{this.context.commandBinder.issueCommand(new Me.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){_e.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState()}componentWillUnmount(){_e.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}async updatePlatformState(){const e=await(0,Ee.pl)();this.setState({vrPlatform:e})}render(){return this.state.vrPlatform===Ee.bk.webxr?this.renderOverlayCta():null}renderOverlayCta(){const{locale:e}=this.context;return(0,s.h)("div",{id:"vr-overlay-layer",class:"overlay"},(0,s.h)("div",{class:"overlay-cta"},(0,s.h)(pe.zx,{buttonSize:pe.qE.LARGE,buttonState:pe.BN.ENABLED,buttonStyle:pe.ZJ.OVERLAY,appendClass:{"inline-block":!0,confirm:!0},onClick:this.startWebXR},e.t(h.Z.VR_ENTER))))}trackEvent(e,t){let i={gui_action:e,orientation:(0,f.mI)()?"landscape":"portrait",platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};Jt=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([g.Z],Jt);const ei=new M.Z("showcase-ui");class ti extends s.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,f.tq)(),this.propertiesToRefreshUi=[I.gx.Measurements,I.gx.DetailsModelName,m.w,I.gx.FloorSelect],this.getModeChange=e=>({viewmode:(0,C.ty)(e.toMode)}),this.updateToolPanelLayout=()=>{this.setState({toolPanelLayout:this.props.toolsData.toolPanelLayout})},this.showHelpOnPlaying=e=>{e.phase===r.nh.PLAYING&&(this.props.commandBinder.issueCommand(new y.Bz(v.P.CTA,!0)),this.props.messageBus.unsubscribe(o.LZ,this.showHelpOnPlaying))},this.updateTools=()=>{this.props.toolsData.toolsMap.length>0&&!this.state.toolsLoaded&&this.setState({toolsLoaded:!0}),this.props.commandBinder.issueCommandWhenBound(new l.xy)},this.updatePerSettings=()=>{this.setState(Object.assign({measurementsModeEnabled:this.isMeasurementsEnabled(),notesEnabled:this.isNotesEnabled(),newTagsEnabled:this.isNewTagsEnabled()},this.getTitleBarEnablement()))},this.getTourState=()=>this.tourData?{tourState:this.tourData.getCurrentTourState()}:{tourState:this.state.tourState},this.getTitleBarEnablement=()=>{const e=this.props.settings.tryGetProperty("title",1),t=this.props.settings.tryGetProperty(I.gx.DetailsModelName,!0),i=this.props.settings.tryGetProperty("mls",0);return{titleBarEnabled:0!==e&&2!==i&&t}},this.isVrButtonEnabled=()=>(0,Ee.hX)(this.props.settings),this.updateActiveTool=()=>{const{tourState:e}=this.state,t=this.props.toolsData.activeToolName;this.setState({activeTool:t}),t&&e.tourPlaying&&this.props.commandBinder.issueCommand(new P.vy,!1)},this.openModalChanged=()=>{const{toolsData:e,commandBinder:t}=this.props,{tourState:i}=this.state,s=e.openModal;s&&i.tourPlaying&&t.issueCommand(new P.vy,!1),this.setState({openModal:s})},this.glCanvas=document.getElementsByClassName("webgl-canvas")[0],this.state={viewmode:C.g,activeTool:null,openModal:null,toolsLoaded:!1,toolPanelLayout:e.toolsData.toolPanelLayout,tourState:{},modelDetails:null,measurementsModeEnabled:!1,notesEnabled:!1,newTagsEnabled:!1,vrEnabled:!1,brandingEnabled:!1,shareEnabled:!1,titleBarEnabled:!1,unaligned:!0,showExternalUrl:!1}}getChildContext(){const{editMode:e,locale:t,analytics:i,settings:s,toolsData:n,users:o,mainDiv:r,engine:a,messageBus:l,market:c,commandBinder:h}=this.props;return{editMode:e,locale:t,analytics:i,settings:s,toolsData:n,users:o,mainDiv:r,engine:a,messageBus:l,market:c,commandBinder:h}}async componentDidMount(){const{settings:e,messageBus:t,market:i,toolsData:s}=this.props;for(const t of this.propertiesToRefreshUi)e.onPropertyChanged(t,this.updatePerSettings);try{this.cancelBindings(),this.bindings=[s.onToolsLoadedChanged(this.updateTools),s.onToolChanged(this.updateActiveTool),s.onOpenModalChanged(this.openModalChanged),s.onToolPanelLayoutChanged(this.updateToolPanelLayout)],this.handleStartUpHelp();const[e,n,o,r]=await Promise.all([i.waitForData(mt.T),i.waitForData(yt.O),i.waitForData(vt.Z),i.waitForData(Vt.k3)]);this.bindings.push(t.subscribe(zt.Z,(e=>this.setState(Object.assign(Object.assign({},this.getModeChange(e)),this.getUnalignedSweepState())))),t.subscribe(Fe.NR,(()=>this.setState(this.getTourState()))),t.subscribe(Fe.oR,(()=>this.setState(this.getTourState()))),t.subscribe(Fe.Vx,(()=>this.setState(this.getTourState()))),t.subscribe(Fe.Mt,(()=>this.setState(this.getTourState()))),t.subscribe(Fe.dW,(()=>this.setState(this.getTourState()))),r.getReel().onChanged((()=>this.setState(this.getTourState()))),o.makeSweepChangeSubscription((()=>this.setState(this.getUnalignedSweepState()))));const a=(0,C.ty)(n.currentMode||jt.Ey.Panorama);this.tourData=r,this.sweepData=o,this.viewmodeData=n,this.setState(Object.assign(Object.assign(Object.assign({viewmode:a,modelDetails:e.model.details,brandingEnabled:this.isBrandingEnabled()&&this.isMlsEnabled(),shareEnabled:this.isShareEnabled()&&this.isMlsEnabled(),showExternalUrl:this.isBrandingEnabled()&&this.isMlsEnabled(),vrEnabled:this.isVrButtonEnabled()},this.getTitleBarEnablement()),this.getTourState()),this.getUnalignedSweepState())),this.props.onAppReadyChanged(!0,!1)}catch(e){ei.debug(e)}this.updateActiveTool(),this.updateTools(),this.updatePerSettings()}async componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.props.settings.removeOnPropertyChanged(e,this.updatePerSettings);this.cancelBindings(),this.props.onAppReadyChanged(!1,!1)}handleStartUpHelp(){const{settings:e,messageBus:t,commandBinder:i}=this.props,s=e.tryGetProperty("help",0);if(1===s||2===s){const s=1===e.tryGetProperty("ts",0),n=1===e.tryGetProperty("qs",0);s||(n?i.issueCommand(new y.Bz(v.P.CTA,!0)):t.subscribe(o.LZ,this.showHelpOnPlaying))}}getUnalignedSweepState(){return this.sweepData&&this.viewmodeData?{unaligned:this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)}:{unaligned:this.state.unaligned}}cancelBindings(){for(const e of this.bindings)e.cancel()}isNotesEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(oe.IA,!1)&&!!t.getTool(a.w1.NOTES)}isNewTagsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(ne.R,!1)&&!!t.getTool(a.w1.TAGS)}isMeasurementsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(I.gx.Measurements,!0)&&!!t.getTool(a.w1.MEASUREMENTS)}isShareEnabled(){return this.props.settings.tryGetProperty("enable_social_sharing",!1)&&this.props.settings.tryGetProperty("is_public",!1)}isMlsEnabled(){return 0===this.props.settings.tryGetProperty("mls",0)}isBrandingEnabled(){return 1===this.props.settings.tryGetProperty("brand",1)}renderToolPanels(){const{notesEnabled:e,newTagsEnabled:t,activeTool:i,openModal:n,toolPanelLayout:o}=this.state;if(!e&&!t)return null;const{toolsData:r}=this.props,l=r.getTool(a.w1.NOTES),c=r.getTool(a.w1.TAGS);return(0,s.h)(Wt.g,{activeTool:i,openModal:n,allowToggle:!1,toolPanelLayout:o},l&&(0,s.h)(qt.s,{key:a.w1.NOTES,manager:l.manager,toolPanelLayout:o}),c&&(0,s.h)(Zt.g,{key:a.w1.TAGS,manager:c.manager,toolPanelLayout:o}))}renderToolOverlay(){const{toolsData:e}=this.props,{openModal:t,activeTool:i,unaligned:n,toolPanelLayout:o}=this.state,r=e.toolsMap.get(a.w1.MEASUREMENTS),l=e.toolsMap.get(a.w1.NOTES),c=e.toolsMap.get(a.w1.TAGS);return(0,s.h)("div",{class:"tool-overlay"},!i&&(0,s.h)(Jt,null),i===a.w1.MEASUREMENTS&&r&&(0,s.h)(Xt.f,{mobile:this.mobile,openModal:t,unaligned:n,manager:r.manager}),i===a.w1.NOTES&&l&&(0,s.h)(Kt.R,{openModal:t,toolPanelLayout:o,manager:l.manager}),i===a.w1.TAGS&&c&&(0,s.h)(Qt,{openModal:t,toolPanelLayout:o,manager:c.manager}))}render(){const{toolsData:e}=this.props,{viewmode:t,unaligned:i,tourState:n,modelDetails:o,measurementsModeEnabled:r,notesEnabled:a,shareEnabled:l,brandingEnabled:c,titleBarEnabled:h,vrEnabled:d,openModal:u,toolsLoaded:p,toolPanelLayout:m,activeTool:g,showExternalUrl:f}=this.state,y=u===v.P.MATTERTAG_EMBED,b=e.toolOpen?g:null;return(0,s.h)("div",{id:"gui"},!!o&&(0,s.h)(te,{showing:!u&&!g,modelDetails:o,tourState:n,brandingEnabled:c,showExternalUrl:f,titleBarEnabled:h}),(0,s.h)(Gt,{viewmode:t,glCanvas:this.glCanvas,openModal:u}),!y&&(0,s.h)("div",{class:"showcase-ui-overlay"},(0,s.h)("div",{class:"scene-overlay"},!y&&(0,s.h)(ge,{viewmode:t,toolPanelLayout:m,activeTool:g,openModal:u,tourPlaying:n.tourPlaying,mobile:this.mobile}),p&&this.renderToolOverlay(),(0,s.h)(j,{openModal:u,openTool:b,unaligned:i,viewmode:t,tourState:n,measurementsModeEnabled:r,notesEnabled:a,shareEnabled:l,vrEnabled:d})),this.renderToolPanels()))}}var ii=i(39936),si=i(48769),ni=i(27691),oi=i(18403),ri=i(91307),ai=i(6983);const{TOOLS:li}=h.Z;class ci extends n.Y{constructor(){super(...arguments),this.name="showcase-gui-module",this.log=new M.Z(this.name),this.loadUi=async(e,t,i,n,o,r,a,l,c,h)=>{const d={editMode:!1,locale:e,analytics:t,settings:i,toolsData:this.toolsData,users:n,mainDiv:o,engine:r,messageBus:a,market:l,commandBinder:c,onAppReadyChanged:h};this.container=o,this.ref=(0,s.render)((0,s.h)(ti,d),o),this.initializeTools()}}async init(e,t){this.engine=t,[this.settingsData,this.toolsData]=await Promise.all([t.market.waitForData(ii.e),t.market.waitForData(si.t)])}async unloadUi(){if(this.ref&&this.container)return(0,s.render)(null,this.container,this.ref)}initializeTools(){const e=[new ni.U({id:a.w1.NOTES,namePhraseKey:li.NOTES,drawer:!1,panel:!0,icon:"icon-notes",analytic:"notes_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(oe.IA,!1),manager:new ri.L(this.engine,this.settingsData)}),new ni.U({id:a.w1.MEASUREMENTS,namePhraseKey:li.MEASUREMENTS,drawer:!1,panel:!1,icon:"icon-tape-measure",analytic:"measure_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(I.gx.Measurements,!0),manager:new oi.u(this.engine,this.settingsData)})];this.settingsData.tryGetProperty(ne.R,!1)&&e.push(new ni.U({id:a.w1.TAGS,namePhraseKey:li.TAGS,drawer:!1,panel:!0,icon:"icon-toolbar-mattertags",analytic:"mattertag",toolbar:!1,dimmed:!1,enabled:!0,manager:new ai.Q(this.engine,this.settingsData)})),this.engine.commandBinder.issueCommand(new N.MV(e))}}},72681:(e,t,i)=>{"use strict";i.d(t,{G:()=>n,M:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={startup:e}}}n.id="START_APPLICATION";class o extends s.m{constructor(e){super(),this.payload={expand:e}}}o.id="EXPAND_APP"},65976:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var s=i(54122),n=i(30853),o=i(3471),r=i(29675),a=i(55580),l=i(79994),c=i(29359),h=i(21265),d=i(62367),u=i(25799),p=i(44266),m=i(90831),g=i(76674),f=i(20640);class v{constructor(e){this.lastProgress=0,this.currentProgress=0,this.webpackChunks=[],this.meshAlloc={alloc:2e6,loaded:0},this.showingProgress=!1,this.progressElm=document.getElementById("bar"),window.addEventListener("WebpackChunkProgress",this.onWebpackChunkProgress.bind(this)),this.engine=e,this.meshProgressBinding=this.onMeshLoadProgress.bind(this),this.engine.subscribe(f.Zb,this.meshProgressBinding)}showProgress(){this.showingProgress=!0,this.setProgress(this.currentProgress)}setDone(){this.currentProgress=100,this.setProgress(this.currentProgress),this.engine.unsubscribe(f.Zb,this.meshProgressBinding)}setProgress(e){if(!this.progressElm||isNaN(e))return;this.lastProgress=Math.max(this.lastProgress,e),e=this.lastProgress;const t=Number.parseFloat(this.progressElm.getAttribute("r")||"0"),i=Math.PI*(2*t),s=(100-(e=Math.max(Math.min(e,100),0)))/100*i;this.progressElm.style.strokeDashoffset=s.toString(10)}calcProgress(){let e=0,t=0;this.webpackChunks.forEach((i=>{e+=i.loaded,t+=i.total})),e+=this.meshAlloc.loaded,t+=this.meshAlloc.alloc,this.currentProgress=75*Math.min(e/t,1),this.showingProgress&&this.setProgress(this.currentProgress)}onWebpackChunkProgress(e){this.webpackChunks[e.chunkID]?this.webpackChunks[e.chunkID].loaded=e.loaded:this.webpackChunks[e.chunkID]={loaded:e.loaded,total:e.total},this.calcProgress()}onMeshLoadProgress(e){this.meshAlloc.loaded=e.loaded/e.total*this.meshAlloc.alloc,this.calcProgress()}}var y=i(29963),b=i(72681);const w=new u.Z("loading-gui");class S extends s.Y{constructor(){super(...arguments),this.name="loading-ui",this.playPromise=new p.Q,this.resolvePlayPromise=async(e,t)=>{if(this.config.allowPlayInIframe||!this.config.startNewTab){if((0,h.yL)())if(t&&(this.config.allowPlayInIframe||1===(0,h.hu)("expand",0)))this.toggleIframeExpansion(!0);else if(!this.config.allowPlayInIframe){const e=(0,h.AO)();t&&(e.edit="1"),e.back="1",delete e.cloudEdit;const i=Object.keys(e).map((t=>t+"="+e[t])).join("&"),s=`${window.location.origin}${window.location.pathname}?${i}`;try{return void(window.top.location.href=s)}catch(e){w.debug("Couldn't set top window location; was Showcase sandboxed?"),w.debug(e)}}t&&this.settings.updateSetting("quickstart",!0),e&&(this.playIcon.classList.add("hidden"),this.progressUI.showProgress(),this.playPromise.resolve())}else window.open(self.location.href,"_blank")},this.toggleIframeExpansion=e=>{const t=e?new y.n3:new y.mQ;this.engine.commandBinder.issueCommand(t),this.engine.broadcast(new g.G(e))},this.hideUI=async e=>{e.phase!==r.nh.STARTING&&e.phase!==r.nh.PLAYING&&e.phase!==r.nh.ERROR||(this.progressUI.setDone(),this.config.quickstart?this.showQuickstartUI():this.uiRoot.classList.add("faded-out"),this.engine.unsubscribe(o.LZ,this.hideUI))}}async init(e,t){this.engine=t,this.locale=await t.getModule(l.default),this.settings=await t.getModule(n.default);const i=await t.market.waitForData(a.T);this.config={inWorkshop:!!e.inWorkshop,quickstart:!!e.quickstart,autoplay:!!e.autoplay,allowPlayInIframe:!!e.allowPlayInIframe,startNewTab:!!e.startNewTab,hidePoweredBy:!!e.hidePoweredBy,hideTitle:!!e.hideTitle,hideBranding:!!e.hideBranding,modelId:e.modelId,baseUrl:e.baseUrl},this.progressUI=new v(t),t.subscribe(o.LZ,this.hideUI),this.bindings.push(t.commandBinder.addBinding(b.G,(async e=>{this.resolvePlayPromise(e.startup,!0)})),t.commandBinder.addBinding(b.M,(async e=>{this.toggleIframeExpansion(e.expand)}))),this.renderSplashScreen(i.model.details)}get waitForPlaying(){return this.playPromise.nativePromise()}getLoadingElements(){if(this.uiRoot=document.getElementById("loading-gui"),!this.uiRoot)throw Error("Loading GUI root not found");this.uiRoot.classList.remove("hidden"),this.config.quickstart&&(this.uiRoot.style.pointerEvents="none"),this.presentedBy=document.getElementById("loading-presented-by"),this.poweredBy=document.getElementById("loading-powered-by"),this.mpLogo=document.getElementById("loading-mp-logo"),this.mpLogo.src=m,this.nameHeader=document.getElementById("loading-header"),this.background=document.getElementById("loading-background"),this.tint=document.getElementById("tint"),this.playIcon=document.getElementById("showcase-play")}addCobrand(e){if(e&&e.presentedBy){const t=this.presentedBy.querySelector(".loading-label");t&&(t.textContent=this.locale.t(c.Z.PRESENTED_BY_CAPS));const i=this.presentedBy.querySelector(".subheader");i&&(i.textContent=e.presentedBy),this.presentedBy.classList.remove("hidden")}}hidePlayButtonUI(){this.background.style.backgroundImage="none",this.presentedBy.style.transition="none",this.presentedBy.classList.remove("faded-in"),this.poweredBy.style.transition="none",this.poweredBy.classList.remove("faded-in"),this.nameHeader.classList.add("hidden"),this.tint.classList.add("hidden"),document.getElementById("circleLoader").classList.add("hidden"),this.uiRoot.classList.add("quickstart")}async showQuickstartUI(){this.background.classList.add("faded-out"),await(0,d.gw)(500),this.presentedBy.style.transition="",this.presentedBy.classList.add("faded-in"),this.poweredBy.style.transition="",this.poweredBy.classList.add("faded-in"),await(0,d.gw)(2500),this.presentedBy.classList.remove("faded-in"),this.poweredBy.classList.remove("faded-in"),this.uiRoot.classList.add("faded-out")}showLoadingUI(e){const t=document.createAttribute("data-status");t.value=this.locale.t(c.Z.LOADING);const i=document.getElementById("loader-cont");i.attributes.setNamedItem(t),i.classList.add(this.locale.languageCode),i.classList.add("loading"),e.classList.add("faded-out"),this.presentedBy.classList.add("faded-in")}renderSplashScreen(e){this.getLoadingElements();const t=document.getElementById("play-prompt");this.config.hideTitle&&this.nameHeader.classList.add("hidden"),this.config.hidePoweredBy&&this.poweredBy.classList.add("hidden"),this.config.hideBranding||this.addCobrand(e),this.nameHeader.textContent=e.name,this.poweredBy.classList.add("faded-in"),this.tint.classList.add("faded-in"),this.playPromise.then((()=>{this.config.quickstart?this.hidePlayButtonUI():this.showLoadingUI(t)})),this.config.autoplay?(this.progressUI.showProgress(),this.playPromise.resolve()):(t.classList.remove("hidden"),t.innerText=this.locale.t(c.Z.EXPLORE_3D_SPACE),this.playIcon.classList.remove("hidden"),this.uiRoot.addEventListener("click",(()=>this.resolvePlayPromise(!0,!1))));const i=window.devicePixelRatio||1,s=Math.max(window.innerWidth,400);this.background.style.backgroundImage=`url(${this.config.baseUrl}/api/v1/player/models/${this.config.modelId}/thumb?width=${s}&dpr=${i}&disable=upscale)`,this.config.allowPlayInIframe||window.scrollTo(0,0)}}},76674:(e,t,i)=>{"use strict";i.d(t,{G:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.expanded=e}}},29122:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>E});var s=i(54122),n=i(30853),o=i(10594),r=i(89895),a=i(89155),l=i(77956),c=i(12775),h=i(73029),d=i(1707),u=i(55530),p=i(22729),m=i(98809),g=i(87694),f=i(27545),v=i(17694),y=i(39936),b=i(35825),w=i(42885),S=i(91172),T=i(34216);class E extends s.Y{constructor(){super(...arguments),this.name="quick-menus"}async init(e,t){this.settingsModule=await t.getModuleSync(n.default),this.scanInfoDataModule=await t.getModule(o.default),this.settingsGui=this.settingsModule.getSettingsGui();const i=await t.market.waitForData(l.Z),s=await t.market.waitForData(y.e),g=await t.market.waitForData(c.O),E=await t.market.waitForData(p.c),_=await t.market.waitForData(a.M_);this.uIndex=this.settingsGui.addPanel("Link to location",[b.R.U],{allowSubGroups:!1,width:400,ratio:90});const x=[38,38,40,40,37,39,37,39,66,65,b.R.O];this.oIndex=this.settingsGui.addPanel("Scan Info",x,{allowSubGroups:!1,width:400,ratio:75}),this.pIndex=this.settingsGui.addPanel("Quick settings",[b.R.P],{allowSubGroups:!1}),this.settingsGui.loadPromise.then((()=>{this.settingsGui.addControl(this.uIndex,"","Link",{}),this.settingsGui.addControl(this.uIndex,"","Shorten URL",!0),this.settingsGui.addButton(this.uIndex,"","Copy to clipboard",(()=>{const e=document.createElement("input");e.type="text",e.value=this.buildLink(_,g,E,i),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})),this.settingsGui.toggle(this.uIndex),this.settingsGui.addControl(this.oIndex,"","Scan ID",{}),this.settingsGui.addControl(this.oIndex,"","Anchor ID",{}),this.settingsGui.addControl(this.oIndex,"","Created",{}),this.settingsGui.addControl(this.oIndex,"","Time of Day",{}),this.settingsGui.addControl(this.oIndex,"","Alignment",{}),this.settingsGui.addControl(this.oIndex,"","Options",{}),this.settingsGui.addControl(this.oIndex,"","Camera",{}),this.settingsGui.addControl(this.oIndex,"","Camera Types",{}),this.settingsGui.addControl(this.oIndex,"","Sensor Serials",{}),this.settingsGui.addControl(this.oIndex,"","Serial Number",{}),this.settingsGui.addControl(this.oIndex,"","Mount Calibration",{}),this.settingsGui.addControl(this.oIndex,"","Software Version",{}),this.settingsGui.addButton(this.oIndex,"","Copy Scan ID",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanInfo(i.currentSweep);if(e){const t=document.createElement("input");t.type="text",t.value=e.id,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}})),this.settingsGui.addButton(this.oIndex,"","Download Scan",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanDownloadURL(i.currentSweep);e&&window.open(e)}})),this.settingsGui.toggle(this.oIndex);const e=d.WI*(180/Math.PI)*60;this.settingsGui.addControl(this.pIndex,"",m.U,!0),this.settingsGui.addControl(this.pIndex,"",w.s,!0),this.settingsGui.addControl(this.pIndex,"",S.re,!0),this.settingsGui.addControl(this.pIndex,"",T.b,!0),this.settingsGui.addSlider(this.pIndex,"",u.lookAccelerationKey,e,.25,10,2),this.settingsGui.addSlider(this.pIndex,"",r.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,1,5e3,0);const t=s.tryGetProperty(f.EU,f.Im);this.settingsGui.addSlider(this.pIndex,"",f.WQ,(0,v.JG)(t),.5,10,2),this.settingsGui.toggle(this.pIndex),this.settingsModule.registerSetting("Quick settings",u.lookAccelerationKey,e,!1),this.settingsModule.registerSetting("Quick settings",r.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,!1),this.settingsGui.onToggle(this.uIndex,(e=>{e&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(_,g,E,i))})),this.settingsGui.onToggle(this.oIndex,(e=>{e&&this.refreshScanInfo(i)})),_.pose.onChanged((()=>{this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.uIndex)&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(_,g,E,i)),this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.oIndex)&&this.refreshScanInfo(i)})),s.onPropertyChanged(f.WQ,(e=>{s.setProperty(f.EU,(0,v.HG)(e))}))}))}refreshScanInfo(e){e.currentSweep?this.scanInfoDataModule.getScanInfo(e.currentSweep).then((e=>{this.updateScanInfo(e)})):this.updateScanInfo(void 0)}updateScanInfo(e){this.settingsGui.updateSetting(this.oIndex,"Scan ID",e?e.id:""),this.settingsGui.updateSetting(this.oIndex,"Anchor ID",e?e.anchorId:""),this.settingsGui.updateSetting(this.oIndex,"Created",e?e.created:""),this.settingsGui.updateSetting(this.oIndex,"Time of Day",e?e.timeOfDay:""),this.settingsGui.updateSetting(this.oIndex,"Alignment",e?e.alignment:""),this.settingsGui.updateSetting(this.oIndex,"Options",e?JSON.stringify(e.options):""),this.settingsGui.updateSetting(this.oIndex,"Camera",e?`${e.camera.vendor} ${e.camera.model}`:""),this.settingsGui.updateSetting(this.oIndex,"Camera Types",e?JSON.stringify(e.camera.cameraTypes):""),this.settingsGui.updateSetting(this.oIndex,"Sensor Serials",e?JSON.stringify(e.camera.sensorSerialNumbers):""),this.settingsGui.updateSetting(this.oIndex,"Serial Number",e?e.camera.serialNumber:""),this.settingsGui.updateSetting(this.oIndex,"Mount Calibration",e?e.camera.mountCalibrationVersion:""),this.settingsGui.updateSetting(this.oIndex,"Software Version",e?e.camera.softwareVersion:"")}buildLink(e,t,i,s){const n=this.settingsGui.getSetting(this.uIndex,"Shorten URL"),o=g.K.getQueryString({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:s},n);return`${location.origin}/show/?${o}`}}},10791:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Be});var s=i(54122),n=i(63418),o=i(13931),r=i(58931),a=i(17423),l=i(42238),c=i(7839),h=i(26986),d=i(21265),u=i(62367);const p=e=>`${e}_3.0`,m=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}},g=()=>{const e=(new l.UAParser).getResult();let t=e.os.name,i=e.browser.name;const s=Object.assign({},e.device);return d._1()&&(t="iPadOS",s.vendor="Apple",s.model="iPad",s.type="tablet","Safari"===i&&(i="Mobile Safari")),{browser:{name:i,major:e.browser.major,version:e.browser.version,language:navigator.language||"",languages:navigator.languages?navigator.languages.join(", "):""},os:{name:t,version:e.os.version},device:{vendor:s.vendor,model:s.model,type:s.type}}};const f=a.K.Logging;var v=i(51418),y=i(75711);class b{constructor(){this.handlers=[{msgType:v.m,func:(e,t,i)=>{const s=i.tryGetData(y.Z);s&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:s.source})}}]}}var w,S=i(47678),T=i(56022),E=i(98728),_=i(57369);function x(e,t){switch(e){case _.z9.ALIGNED:return 1;case _.z9.UNALIGNED:return 2}switch(t){case _.hU.MANUAL:return 3}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(w||(w={}));class M{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:S.Z,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:T.Z,func:(e,t,i)=>{const s=i.tryGetData(y.Z),n=i.tryGetData(E.k3);this.endLoadTime=Date.now();const o=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:x(t.alignmentType,t.placementType),navigation_source:n&&n.tourPlaying?w.TOUR:w.USER,interaction_source:s?s.source:y.Z.defaultSource,interaction_mode:s?s.mode:y.Z.defaultMode,load_time:o/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var P=i(39869);class A{constructor(){this.handlers=[{msgType:P.Z,func:(e,t,i)=>{const s=i.tryGetData(y.Z),n={view_mode:t.toMode};s&&(n.interaction_source=s.source,n.interaction_mode=s.mode),e.track("mode_changed",n)}}]}}var O=i(54733),D=i(41479),I=i(59340),C=i(25936);const R=(e,t)=>{const i=t.tryGetData(C.i);return e&&i?i.getFloor(e).index:-1};class L{constructor(){this.handlers=[{msgType:D.P,func:(e,t,i)=>{const s=i.tryGetData(y.Z);e.track("floor_changed",{floor_id:t.floorName,interaction_source:s?s.source:y.Z.defaultSource,interaction_mode:s?s.mode:y.Z.defaultMode})}},{msgType:I.M,func:(e,t,i)=>{const s=i.tryGetData(y.Z);e.track("sweep_floor_fixup",{sweep_index:t.index,sweep_floor_from:R(t.from,i),sweep_floor_to:R(t.to,i),interaction_source:s?s.source:y.Z.defaultSource,interaction_mode:s?s.mode:y.Z.defaultMode})}}]}}var N=i(23042),k=i(77956);class F{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:N.Z,func:(e,t,i)=>{this.analytics||(this.analytics=e);const s=i.tryGetData(k.Z);s&&s.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=s.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var B=i(3471),U=i(29675),H=i(19413);class G extends H.V{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}copy(e){this.modelLoadingStartTime=e.modelLoadingStartTime,this.waitingStartTime=e.waitingStartTime,this.appPlayingTime=e.appPlayingTime,this.appStartedTime=e.appStartedTime}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var V=i(25799),z=i(62431),j=i(50101),W=i(39936),Z=i(9713);const q=new V.Z("showcase-session"),K=new G;class Y{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:B.LZ,func:async(e,t,i)=>{switch(t.phase){case U.nh.WAITING:K.waitingStartTime=Date.now(),K.commit(),e.track("impression",{url_params:d.UD(),visible:!0});break;case U.nh.LOADING:K.modelLoadingStartTime=Date.now(),K.commit();break;case U.nh.STARTING:{K.appStartedTime=Date.now(),K.commit(),q.info("First render, model loaded "+K.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(z.af),i=await this.engine.getModule(j.default),s=this.engine.market.tryGetData(W.e),n=i.getCapabilities(),o=!t||t.options.highlight_reel,r=!!(null==s?void 0:s.tryGetProperty(Z.$,!1)),a={has_hlr:o,duration:Date.now()-K.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:n.gl_v2,gl_max_textures:n.gl_max_textures,gl_max_texture_size:n.gl_max_texture_size,gl_max_cubemap_size:n.gl_max_cubemap_size,gl_instancing:n.gl_instancing,gl_oes_texture_float:n.gl_oes_texture_float,gl_oes_texture_half_float:n.gl_oes_texture_half_float,gl_depth_texture:n.gl_depth_texture,gl_draw_buffers:n.gl_draw_buffers,gl_oes_fbo_render_mip_map:n.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:n.gl_shader_texture_lod,gl_oes_vertex_array_obj:n.gl_oes_vertex_array_obj,gl_ovr_multi_view:n.gl_ovr_multi_view,gl_color_buffer_float:n.gl_color_buffer_float,gl_astc_supported:n.gl_astc_supported,gl_etc1_supported:n.gl_etc1_supported,gl_etc2_supported:n.gl_etc2_supported,gl_dxt_supported:n.gl_dxt_supported,gl_bptc_supported:n.gl_bptc_supported,gl_pvrtc_supported:n.gl_pvrtc_supported,mds_enabled:r};e.track("model_loaded",a);break}case U.nh.PLAYING:K.appPlayingTime=Date.now(),K.commit(),q.info("Playing, session started "+K.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:K.totalTimeToAppStarting,time_to_app_playing:K.totalTimeToAppPlaying});break;case U.nh.ERROR:{const t=await i.waitForData(U.pu),{error:s}=t,n=s&&s.name?s.name:s&&s.constructor?s.constructor.name:null,o=s?s.message:null,r=s&&s.stack?s.stack.split("\n"):[],a=r.length>=2?r[1].match(/\s+at\s+([^\s]+)/):null,l={exception:{message:`${n}: ${o}`,function:a?a[1]:null,stack:r.slice(1,5).join("\n")},duration:Date.now()-K.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart};e.track("error_displayed",l);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-K.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var $=i(48840),Q=i(2124),X=i(71208),J=i(12775),ee=i(44106);const te=new V.Z("/index.js");let ie=0,se=1/0,ne=null,oe=null,re=window.devicePixelRatio||1;const ae={},le=new Q.P(1e3);class ce{constructor(){this.handlers=[{msgType:$.Z,func:(e,t,i)=>{oe!==U.nh.STARTING&&oe!==U.nh.PLAYING||he(e,X.Ey[t.toMode],1e4)}},{msgType:B.LZ,func:(e,t,i)=>{const s=i.tryGetData(J.O);t.phase===U.nh.LOADING?he(e,"Loading",6e4):t.phase===U.nh.STARTING?he(e,"Starting",6e4):t.phase===U.nh.PLAYING&&s&&s.currentMode&&he(e,X.Ey[s.currentMode],1e4),oe=t.phase}},{msgType:ee.V,func:(e,t,i)=>{re=t.pixelRatio}}]}}function he(e,t,i){t!==ne&&(ne&&(ue(e),de()),ae[t]||(ne=t,se=i,ae[ne]=!0))}const de=()=>{ne=null,le.clear(),ie=0},ue=e=>{const t=le.getList();if(0!==t.length)try{const i=pe(t);e.track("performance",i)}catch(e){te.warn("Could not send performance metrics",e)}},pe=e=>{let t=0,i=0,s=0,n=0,o=0,r=0;for(const a of e)t+=a,a<0||(a<=16.7?i+=a:a<=33.3?s+=a:a<=100?n+=a:a<=1e3?o+=a:r+=a);if(t<=0)throw Error("No positive timings, cannot calculate performance data");const a=t/e.length;i/=t,s/=t,n/=t,o/=t,r/=t;const l=e.slice(),c=(0,u.Pe)(l,50),h=(0,u.Pe)(l,95,!1),d=l[l.length-1];return{phase:ne,frame_delta:a,frame_delta_avg:a,frame_delta_median:c,frame_delta_95th:h,frame_delta_max:d,duration:t,time_60_fps:i,time_60_30_fps:s,time_30_10_fps:n,time_10_1_fps:o,time_1_0_fps:r,pixel_ratio:re}};var me=i(62194),ge=i(22729);const fe=(e,t)=>{const i=t.tryGetData(ge.c);return i?(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index:-1};class ve{constructor(){this.handlers=[{msgType:me.rf,func:(e,t,i)=>{const s={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:fe(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",s)}},{msgType:me.u6,func:(e,t,i)=>{const s={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:fe(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",s)}},{msgType:me.ty,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:me.mM,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:me.$Z,func:(e,t,i)=>{const s={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:fe(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",s)}},{msgType:me.av,func:(e,t,i)=>{const s={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:fe(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",s)}},{msgType:me.$n,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",s={viewmode:t.viewmode,measure_count:t.count};e.track(i,s)}},{msgType:me.ff,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var ye=i(79994),be=i(93528);class we extends be.v{constructor(e,t,i,s,n,o){super(),this.durationDollhouse=e,this.durationFloorplan=t,this.durationInside=i,this.mainMode=s,this.totalBytesDownloaded=n,this.tilesDownloaded=o}}class Se{constructor(){this.handlers=[{msgType:we,func:(e,t)=>{const i={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration:t.durationDollhouse+t.durationFloorplan+t.durationInside,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded};e.track("activity_ping",i)}}]}}var Te,Ee=i(30963),_e=i(75158),xe=i(21588),Me=i(78626),Pe=i(36073),Ae=i(93735),Oe=i(72942),De=i(15253);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(Te||(Te={}));class Ie{constructor(){this.name="activity-analytics",this._state=Te.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData]=await Promise.all([await e.getModule(Ee.default),await e.market.waitForData(J.O),await e.market.waitForData(U.pu)]);const s=[],n=[_e.R,xe._t,Me.e,Pe.er,Ae.G],o=()=>this.active=!0;this.applicationData.phase===U.nh.PLAYING?this._state=Te.INACTIVE:s.push(e.subscribe(B.LZ,(()=>{this.applicationData.phase===U.nh.PLAYING&&(this._state=Te.INACTIVE)}))),s.push(...(()=>{const e=[];return n.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,o))})),e})()),s.push(e.subscribe(P.Z,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==X.Ey.Transition&&this.applicationData.phase===U.nh.PLAYING&&this.handleModeChange(t,i)}))),s.push(this.engine.subscribe(De.o,this.onTileDownloaded)),t(s)}get active(){return this._state===Te.ACTIVE}set active(e){this._state!==Te.UNINITIALIZED&&(e&&this._state===Te.INACTIVE&&this.startActivityTimeout(),this._state=e?Te.ACTIVE:Te.INACTIVE)}handleModeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:s,totalTimeinMS:n}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:n}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:n+(Date.now()-s)})}startActivityTimeout(){this.activeModeMap.set(X.Ey.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(X.Ey.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(X.Ey.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),Ie.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==X.Ey.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=X.Ey.Panorama;this.activeModeMap.forEach(((i,s)=>{i.totalTimeinMS>e&&(t=s,e=i.totalTimeinMS)})),this.active=!1;const[i,s,n]=[this.activeModeMap.get(X.Ey.Dollhouse),this.activeModeMap.get(X.Ey.Floorplan),this.activeModeMap.get(X.Ey.Panorama)].map((e=>e?e.totalTimeinMS:0));this.engine.broadcast(new we(i,s,n,Oe.KP[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded))}}}Ie.ACTIVITY_INTERVAL=15e3;var Ce,Re=i(32359);!function(e){e.USER="self-guided",e.TOUR="tour"}(Ce||(Ce={}));class Le{constructor(){this.handlers=[{msgType:Re.D,func:(e,t,i)=>{const s=i.tryGetData(y.Z),n=i.tryGetData(E.k3),o={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?Oe.KP[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:n&&n.tourPlaying?Ce.TOUR:Ce.USER,interaction_source:s?s.source:y.Z.defaultSource,interaction_mode:s?s.mode:y.Z.defaultMode};e.track("room_visited",o)}}]}}var Ne=i(20331),ke=i(14408);const Fe=new V.Z("showcase-analytics");class Be extends s.Y{constructor(){super(...arguments),this.name="showcase-analytics",this.loaded=!1,this.handlers=[],this.track=(e,t)=>{this.analytics.track(e,t)}}async init(e,t){this.analytics=await t.getModule(o.default),this.apiClient=(await t.getModule(n.default)).getApi();const i=await t.market.waitForData(W.e),s=await t.getModule(ye.default);this.addMessageHandlers(this.analytics,t),this.context=function(e,t,i){const s=function(e,t){return{app:{name:p(t),version:"3.1.41.12-0-g5ddcd5eba"},locale:e,screen:{width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio},timezone:m(),location:{}}}(t,i);return(0,c.Z)(e).then((e=>{s.location={city:e.city,country:e.country_name,region:e.region}})),s}(e.queue,s.languageCode,e.appName),this.options=Object.assign({model_id:(0,h.uz)(),start_source:d.hu("play",!1)?"autoplay":d.yL()?"click":"fullpage",autoplay:d.hu("play",!1)||!d.yL(),quickstart:1===d.hu("qust",0)||1===d.hu("qs",0),language_tag:d.hu("lang",null),is_mobile:d.tq(),iframe:d.yL(),aspect_ratio:d.dy(),session_id:(0,u.DM)(),window:{height:window.innerHeight,width:window.innerWidth},platform:g()},e.additionalValues),this.activityTracking=new Ie,this.activityTracking.init(t,this.registerBindings.bind(this),e.queue);const r=await this.createAnalyticsConfigs(e,i),a=new Ne.gO({retries:0,concurrency:1});this.analytics.load(r,a,this.options,this.context,this.apiClient.user).then((()=>{this.loaded=!0}))}addMessageHandlers(e,t){this.addMessageHandler(new Y(e,t),t),this.addMessageHandler(new A,t),this.addMessageHandler(new M,t),this.addMessageHandler(new b,t),this.addMessageHandler(new L,t),this.addMessageHandler(new O.s,t),this.addMessageHandler(new F,t),this.addMessageHandler(new ve,t),this.addMessageHandler(new ce,t),this.addMessageHandler(new Se,t),this.addMessageHandler(new Le,t)}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}registerBindings(e){this.bindings.push(...e)}async createAnalyticsConfig(e,t){if((0,ke.J)(a.K,e)){const{apiClient:i}=this,s=r.H[e],n=null!==s.key?await i.getAppKey(t,s.key):null,o=null!==s.url?await i.getAppKey(t,s.url):null;if(null===s.key||null!==n&&null===s.url||null!==o)return{provider:e,token:n,url:o}}return null}async createAnalyticsConfigs(e,t){const i=e.appName,s=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(i,"analytics_provider"),n=[];if(!s)return n;const o=s.split(",");for(const e of o){const t=await this.createAnalyticsConfig(e,i);null!==t?n.push(t):Fe.warn(`Failed to set up ${e}, token/url required but not found in config`)}return n.length<1&&n.push({provider:f,token:null,url:null}),n}onUpdate(e){this.loaded&&((e,t)=>{ne&&(le.push(t),ie+=t,ie>=se&&(ue(e),de()))})(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}getSessionId(){return this.options.session_id}}},26451:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(30963),n=i(78626),o=i(35825),r=i(72942),a=i(93227),l=i(54122),c=i(22767),h=i(12775),d=i(71208),u=i(39936),p=i(15782);class m extends l.Y{constructor(){super(...arguments),this.name="showcase-hotkeys",this.inputCommandMap={[c.M.PRESSED]:{[o.R.ONE]:()=>(this.viewmodeData.currentMode===d.Ey.Panorama&&(this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!1),this.currentView=0),this.switchToMode(r.BD.INSIDE)),[o.R.TWO]:()=>this.switchToMode(r.BD.DOLLHOUSE),[o.R.THREE]:()=>this.switchToMode(r.BD.FLOORPLAN),[o.R.ZERO]:()=>{const e=this.currentView++%this.meshViews.length;return this.meshViews[e](),this.switchToMode(r.BD.INSIDE)}}},this.currentView=0,this.meshViews=[()=>{this.issueCommand(new a.g(1)),this.settings.setProperty(p.Lp,!1)},()=>{this.issueCommand(new a.g(1)),this.settings.setProperty(p.Lp,!0)},()=>{this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!0)},()=>{this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!1)}]}async init(e,t){const i=await t.getModule(s.default);[this.viewmodeData,this.settings]=await Promise.all([t.market.waitForData(h.O),t.market.waitForData(u.e)]),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),i.registerHandler(n.e,(async e=>{this.inputCommandMap[e.state]&&this.inputCommandMap[e.state][e.key]&&await this.inputCommandMap[e.state][e.key]()}))}async switchToMode(e){this.viewmodeData.currentMode!==d.Ey.Transition&&await this.issueCommand(new r._i(e))}}},49415:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var s=i(26605),n=i(54122),o=i(33886),r=i(17882),a=i(79994),l=i(25799),c=i(94184),h=i(29359),d=i(90831);class u extends s.Component{constructor(e){super(e)}render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,s.h)("div",{class:"powered-by"},(0,s.h)("p",{class:"powered-by-label"},i.t(h.Z.POWERED_BY)),(0,s.h)("img",{class:"powered-by-logo",alt:"Matterport",src:d,width:"150",height:"32"}),t&&(0,s.h)("a",{href:t,class:"powered-by-link"},e||t))}}var p=i(24877),m=i(17617);class g extends m.y{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class f extends m.y{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const v=new l.Z("showcase-password");class y extends s.Component{constructor(e){super(e),this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;v.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof f&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.setState({hasError:!i})}getChildContext(){const{locale:e}=this.props;return{locale:e}}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.props;return(0,s.h)("div",{class:"sc-password-modal sc-password-lockout"},(0,s.h)("header",{class:"modal-header"},(0,s.h)("h1",{class:"modal-title"},e.t(h.Z.SC_LOCKOUT_TITLE))),(0,s.h)("p",{class:"modal-body"},e.t(h.Z.SC_LOCKOUT_MESSAGE)))}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:n}=this.props;return(0,s.h)("div",{class:"sc-password-modal sc-password-login"},(0,s.h)("header",{class:"modal-header"},(0,s.h)("h1",{class:"modal-title"},n.t(h.Z.SC_PASSWORD_TITLE))),(0,s.h)("div",{class:"modal-body"},(0,s.h)("form",{onSubmit:this.onSubmit,class:"sc-password-form"},(0,s.h)("input",{type:"password",name:"password",placeholder:n.t(h.Z.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,class:c("sc-password-input",{error:e}),autocomplete:"on"}),(0,s.h)("button",{type:"submit",disabled:!i,class:"sc-password-submit"},n.t(h.Z.SC_PASSWORD_SUBMIT))),e&&(0,s.h)("p",{class:"help-text error"},(0,s.h)("span",{class:"icon icon-error"}),n.t(h.Z.SC_PASSWORD_INVALID)),!e&&(0,s.h)("p",{class:"help-text"})))}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,s.h)("div",{class:"sc-password-ui",style:`background-image: url(${p})`},(0,s.h)("div",{class:"sc-password-content"},i),(0,s.h)("footer",{class:"sc-password-footer"},(0,s.h)(u,null)))}}var b=i(64506);const w=new l.Z("showcase-password");class S extends n.Y{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new o.L(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModule(a.default),i=(0,s.h)(y,{locale:t,authenticate:e=>this.authenticate(e)});this.ref=(0,s.render)(i,e)}unloadUi(){if(!this.ref)return;const{container:e}=this.config;(0,s.render)(null,e,this.ref)}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new b.s(this.auth.errorType)),this.auth.errorType){case r.s.INVALID_CREDENTIALS:throw new g;case r.s.TOO_MANY_ATTEMPTS:throw new f}return!1}return w.debug("Password authentication was successful"),this.engine.broadcast(new b.L),!0}}},64506:(e,t,i)=>{"use strict";i.d(t,{L:()=>n,s:()=>o});var s=i(93528);class n extends s.v{}class o extends s.v{constructor(e){super(),this.errorType=e}}},40562:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>z});var s=i(83032),n=i(54122),o=i(30853),r=i(39936),a=i(62431),l=i(19334),c=i(47924),h=i(25799),d=i(80034),u=i(41263),p=i(7943),m=i(15119),g=i(20331);const f=e=>{if(!e||!e.player_options)return null;const t=e.player_options||{},i={address:t.address,background_color:t.background_color,contact_email:t.contact_email,contact_name:t.contact_name,contact_phone:t.contact_phone,dollhouse:t.dollhouse,dollhouse_pan_speed:t.dollhouse_pan_speed,external_url:t.external_url,fast_transitions:t.fast_transitions,floor_plan:t.floor_plan,floor_select:t.floor_select,highlight_reel:t.highlight_reel,labels:t.labels,labels_dh:t.labels_dh,measurements:t.measurements,measurements_saved:t.measurements_saved,model_name:t.model_name,model_summary:t.model_summary,pan_angle:t.pan_angle,pan_direction:t.pan_direction,pan_speed:t.pan_speed,presented_by:t.presented_by,tour_buttons:t.tour_buttons,transition_speed:t.transition_speed,transition_time:t.transition_time,unit_type:t.unit_type||e.unit_type,zoom_duration:t.zoom_duration};return new a.af(i)},v=(e,t)=>({player_options:{address:e.options.address,background_color:e.options.background_color,contact_email:e.options.contact_email,contact_name:e.options.contact_name,contact_phone:e.options.contact_phone,dollhouse:e.options.dollhouse,dollhouse_pan_speed:e.options.dollhouse_pan_speed,external_url:e.options.external_url,fast_transitions:e.options.fast_transitions,floor_plan:e.options.floor_plan,floor_select:e.options.floor_select,highlight_reel:e.options.highlight_reel,labels:e.options.labels,labels_dh:e.options.labels_dh,measurements:e.options.measurements,measurements_saved:e.options.measurements_saved,model_name:e.options.model_name,model_summary:e.options.model_summary,pan_angle:e.options.pan_angle,pan_direction:e.options.pan_direction,pan_speed:e.options.pan_speed,presented_by:e.options.presented_by,tour_buttons:e.options.tour_buttons,transition_speed:e.options.transition_speed,transition_time:e.options.transition_time,unit_type:e.options.unit_type,zoom_duration:e.options.zoom_duration}});var y,b=i(32400),w=i(51770);!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(y||(y={}));var S,T,E,_=i(19673);!function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}(S||(S={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASURE_AND_VIEW="measureAndView"}(T||(T={})),function(e){e.metric="metric",e.imperial="imperial"}(E||(E={}));var x=i(44228);const M=new h.Z("mds-player-options-deserializer"),P={[_.Y.LEFT]:x.kw.Left,[_.Y.RIGHT]:x.kw.Right,[_.Y.AUTO]:x.kw.Auto},A={[S.BLACK]:y.black,[S.GREY]:y.grey,[S.WHITE]:y.white};class O{deserialize(e){if(!e||!this.validate(e))return M.debug("Deserialized invalid options data from MDS",e),null;const t=(e.publication||{}).options||{},i=e.options,s=P[i.tourPanDirection],n={address:t.address,contact_email:t.contactEmail,contact_name:t.contactName,contact_phone:t.contactPhone,dollhouse:i.dollhouseEnabled,external_url:t.externalUrl,floor_plan:i.floorplanEnabled,floor_select:i.floorSelectEnabled,highlight_reel:i.highlightReelEnabled,labels:i.labelsEnabled,labels_dh:i.dollhouseLabelsEnabled,model_name:t.modelName,model_summary:t.modelSummary,presented_by:t.presentedBy,measurements:i.measurements!==T.DISABLED,measurements_saved:i.measurements===T.MEASURE_AND_VIEW,unit_type:i.unitType===E.imperial?a.Mc.USFractional:a.Mc.Metric,background_color:A[i.backgroundColor],tour_buttons:i.tourButtonsEnabled,fast_transitions:i.tourFastTransitionsEnabled,transition_speed:i.tourTransitionSpeed,transition_time:i.tourTransitionTime,pan_speed:i.tourPanSpeed,dollhouse_pan_speed:i.tourDollhousePanSpeed,zoom_duration:i.tourZoomDuration,pan_angle:i.tourPanAngle,pan_direction:s};return new a.af(n)}validate(e){return["id","options","publication"].every((t=>t in e))}}var D;!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DEFAULT="default"}(D||(D={}));const I=(0,w.Sc)(P),C=(0,w.Sc)(A);class R{serialize(e){const t={},i=e.options||{};if(void 0!==i.dollhouse&&(t.dollhouseOverride=i.dollhouse?D.ENABLED:D.DISABLED),void 0!==i.floor_plan&&(t.floorplanOverride=i.floor_plan?D.ENABLED:D.DISABLED),void 0!==i.floor_select&&(t.floorSelectOverride=i.floor_select?D.ENABLED:D.DISABLED),void 0!==i.labels&&(t.labelsOverride=i.labels?D.ENABLED:D.DISABLED),void 0!==i.labels_dh&&(t.dollhouseLabelsOverride=i.labels_dh?D.ENABLED:D.DISABLED),void 0!==i.highlight_reel&&(t.highlightReelOverride=i.highlight_reel?D.ENABLED:D.DISABLED),void 0!==i.background_color&&(t.backgroundColor={set:C[i.background_color]||S.BLACK}),void 0!==i.unit_type){const e=i.unit_type===a.Mc.Metric?E.metric:E.imperial;t.unitType={set:e}}if(void 0!==i.measurements||void 0!==i.measurements_saved){const e=i.measurements&&i.measurements_saved?T.MEASURE_AND_VIEW:i.measurements?T.MEASURE:T.DISABLED;t.measurements={set:e}}void 0!==i.tour_buttons&&(t.tourButtonsOverride=i.tour_buttons?D.ENABLED:D.DISABLED),void 0!==i.fast_transitions&&(t.tourFastTransitionsOverride=i.fast_transitions?D.ENABLED:D.DISABLED),void 0!==i.pan_angle&&(t.tourPanAngle={set:i.pan_angle}),void 0!==i.pan_direction&&(t.tourPanDirection={set:I[i.pan_direction]}),void 0!==i.pan_speed&&(t.tourPanSpeed={set:i.pan_speed}),void 0!==i.transition_speed&&(t.tourTransitionSpeed={set:i.transition_speed}),void 0!==i.transition_time&&(t.tourTransitionTime={set:i.transition_time}),void 0!==i.zoom_duration&&(t.tourZoomDuration={set:i.zoom_duration}),void 0!==i.dollhouse_pan_speed&&(t.tourDollhousePanSpeed={set:i.dollhouse_pan_speed});const s={};return void 0!==i.presented_by&&(s.presentedByOverride=i.presented_by?D.ENABLED:D.DISABLED),void 0!==i.contact_email&&(s.contactEmailOverride=i.contact_email?D.ENABLED:D.DISABLED),void 0!==i.contact_name&&(s.contactNameOverride=i.contact_name?D.ENABLED:D.DISABLED),void 0!==i.contact_phone&&(s.contactPhoneOverride=i.contact_phone?D.ENABLED:D.DISABLED),void 0!==i.external_url&&(s.externalUrlOverride=i.external_url?D.ENABLED:D.DISABLED),void 0!==i.model_name&&(s.modelNameOverride=i.model_name?D.ENABLED:D.DISABLED),void 0!==i.model_summary&&(s.modelSummaryOverride=i.model_summary?D.ENABLED:D.DISABLED),void 0!==i.address&&(s.addressOverride=i.address?D.ENABLED:D.DISABLED),{options:t,publication:{options:s}}}}var L=i(52227);const N=new h.Z("mds-player-options-store");class k extends b.u{constructor(){super(...arguments),this.serializer=new R,this.deserializer=new O}async read(){const e=this.getViewId();return this.query(L.GetModelOptions,{modelId:e}).then((e=>{const t=(0,w.qw)(e,"data.model");return this.deserializer.deserialize(t)}))}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(L.PatchModel,{modelId:t,patch:i}).then((e=>{N.debug(e)}))}}var F=i(74403),B=i(60841),U=i(97631),H=i(17256),G=i(44333);const V=new h.Z("showcase-settings");class z extends n.Y{constructor(){super(...arguments),this.name="showcase-settings",this.updateTransitionType=(e,t,i)=>{const s=e.options.fast_transitions?c.n.FadeToBlack:c.n.Interpolate;t.hasProperty(l.gj)?t.setProperty(l.gj,s):i.registerSetting("player_options",l.gj,s)}}async init(e,t){this.engine=t,this.store=this.configureStorage(e);const[i,s,n,l]=await Promise.all([t.getModule(o.default),t.market.waitForData(r.e),t.getModule(U.F),this.store.read()]);this.playerOptionsData=l||new a.af,t.market.register(this,a.af,this.playerOptionsData),this.configureMonitor(e);for(const e in a.gx){const t=a.gx[e],s=this.playerOptionsData.options[t];if(i.hasProperty(t)){const e=i.getProperty(t);i.updateSetting(t,s&&e),V.debug(`Updated player_options setting ${t} = ${s&&e}`)}else i.registerSetting("player_options",t,s),V.debug(`Registered player_options setting ${t} = ${s}`)}this.updateTransitionType(this.playerOptionsData,s,i),this.bindings.push(s.onPropertyChanged(a.gx.InstantTransitions,(()=>this.updateTransitionType(this.playerOptionsData,s,i))),n.onSave((()=>this.save()),{dataType:H.g.SETTINGS}),n.onRevert((()=>this.revert()),{dataType:H.g.SETTINGS}))}configureStorage(e){const{modelId:t,baseUrl:i,queue:n}=e,o=e.storageProvider||H.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;if(V.info(`Loading player options from ${o}`),o===H.Xq.MDS)return new k({readonly:r,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new g.gO,o={data:null},r=`${s}/api/v1/player/models/${t}`;if(i){const e=new d.gh({queue:n,path:r,deserialize:f,cachedData:o});return new u.nM({publishStores:[e]})}const a=new d.yh({queue:n,path:r,httpMethod:d.w$.PATCH,deserialize:f,serialize:v}),l=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,c=new m.Z({queue:n,path:l,cachedData:{data:null},httpMethod:d.w$.PATCH,deserialize:p.S.sessionObjectExtract(m.j.Model,f),serialize:v},m.j.Model);return new u.nM({publishStores:[a],editStore:c,editStoreKey:u.aw.SETTINGS})}({modelId:t,baseUrl:i,readonly:r,queue:n});return new s.N(a,{dataType:H.g.SETTINGS,modelId:t,readonly:r,engine:this.engine})}configureMonitor(e){e.readonly||(this.monitor=new F.u(this.playerOptionsData,{aggregationType:B.E.NextFrame},this.engine),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new G.VQ({dataTypes:[H.g.SETTINGS]})))),this.store instanceof s.N&&this.store.addMonitor(this.monitor))}async save(){if(!this.store||!this.monitor)return void V.warn("Settings changes will NOT be saved");if(this.store instanceof s.N)return;const e=this.monitor.getDiffRecord(),t=e.options;return t&&(t&&void 0===t.measurements&&void 0!==t.measurements_saved&&(t.measurements=this.playerOptionsData.options.measurements),t&&void 0!==t.measurements&&void 0===t.measurements_saved&&(t.measurements_saved=this.playerOptionsData.options.measurements_saved),void 0!==(null==t?void 0:t.floor_select)&&(t.floor_select=this.playerOptionsData.options.floor_select),void 0!==(null==t?void 0:t.labels_dh)&&(t.labels_dh=this.playerOptionsData.options.labels_dh),void 0===t.presented_by&&void 0===t.contact_email&&void 0===t.contact_name&&void 0===t.contact_phone&&void 0===t.external_url&&void 0===t.model_name&&void 0===t.model_summary&&void 0===t.address||(t.presented_by=this.playerOptionsData.options.presented_by,t.contact_email=this.playerOptionsData.options.contact_email,t.contact_name=this.playerOptionsData.options.contact_name,t.contact_phone=this.playerOptionsData.options.contact_phone,t.external_url=this.playerOptionsData.options.external_url,t.model_name=this.playerOptionsData.options.model_name,t.model_summary=this.playerOptionsData.options.model_summary,t.address=this.playerOptionsData.options.address)),this.monitor.clearDiffRecord(),this.store.update(e)}async revert(){if(this.store instanceof s.N)return this.store.revert()}}},48024:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={pose:e}}}},44100:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>M});var s=i(2212),n=i(54122),o=i(77956),r=i(71208),a=i(71144),l=i(47924),c=i(57369),h=i(62367),d=i(39936),u=i(89895),p=i(66997),m=i(50101),g=i(65976),f=i(48024),v=i(62431),y=i(97620),b=i(94210),w=i(44266),S=i(86682),T=i(85197),E=i(40562),_=i(82209),x=i(60982);class M extends n.Y{constructor(){super(...arguments),this.name="showcase-start",this.firstRenderPromise=new w.Q,this.flyInPromise=new w.Q,this.handleFlyIn=(e,t,i)=>(this.renderer.startRender(!1),this.doStandardStart(e,t,i,!0).catch((()=>this.renderer.startRender(!0))))}async init(e,t){const[i,s]=await Promise.all([t.market.waitForData(d.e),t.getModule(p.default)]);[this.sweepData,this.sweepModule,this.cameraModule,this.renderer]=await Promise.all([t.market.waitForData(o.Z),t.getModule(b.default),t.getModule(u.default),t.getModule(m.default)]);const n=i.tryGetProperty("quickstart",!1);n||await t.getModule(E.default);const r=s.getStartingPose();return(n?this.doQuickStart(r,t):this.doStandardStart(r,t,i,!1)).then((()=>this.flyInPromise.resolve())),this.bindings.push(t.commandBinder.addBinding(f.b,(async e=>{this.handleFlyIn(e.pose||s.getStartingPose(),t,i)}))),this.waitForFirstRender}get waitForFirstRender(){return this.firstRenderPromise.nativePromise()}get waitForFlyin(){return this.flyInPromise.nativePromise()}async doQuickStart(e,t){const i=this.sweepData.getStartSweep(e),s=await t.getModule(a.default);return await s.switchToMode(e.mode,l.n.Instant,{sweepID:i.id,position:e.camera.position||i.position,rotation:e.camera.rotation,zoom:-1!==e.camera.zoom?e.camera.zoom:void 0}),t.broadcast(new _.bN(!1)),e.mode!==r.Ey.Dollhouse&&e.mode!==r.Ey.Floorplan||e.floorVisibility&&await t.commandBinder.issueCommandWhenBound(new S.h9(e.floorVisibility.lastIndexOf(1),!0,0)),this.renderBeforeStarting(t)}async doStandardStart(e,t,i,n){var o;const[c]=await Promise.all([t.getModule(a.default)]),d=i.checkUrlParam("dh",0,1)||!i.tryGetProperty(v.gx.Dollhouse,!0),u=i.checkUrlParam("fp",0,1)||!i.tryGetProperty(v.gx.FloorPlan,!0);e&&(e.mode===r.Ey.Dollhouse&&d||e.mode===r.Ey.Floorplan&&u||e.mode===r.Ey.Panorama&&!e.pano)&&(e=null);const p=!e||e&&(e.mode===r.Ey.Dollhouse||e.mode===r.Ey.Floorplan),m=!e||e&&!this.is360Pano(e)&&e.mode===r.Ey.Panorama&&!d,g=e?e.mode:r.Ey.Panorama,f=this.sweepData.getStartSweep(e).id;let b=this.sweepData.getFirstSweep().rotation;if((null===(o=null==e?void 0:e.camera)||void 0===o?void 0:o.rotation)&&!(0,x.mB)(e.camera.rotation)&&(b=e.camera.rotation),b&&g!==r.Ey.Floorplan&&(b=(0,y.Z)(b)),m){await t.getModule(T.default);const i=c.getFlyinEndPose({sweepID:f,position:e?e.camera.position:void 0,rotation:b}),o=c.getFlyinStartPose(i,n?new s.Pa4(0,0,0):void 0);t.broadcast(new _.bN(!0));const d=this.sweepModule.activateSweep({sweepId:f});return await c.switchToMode(r.Ey.Dollhouse,l.n.Instant,o),await this.renderBeforeStarting(t),await(0,h.gw)(750),await this.cameraModule.moveTo({transitionType:l.n.Interpolate,pose:i}).nativePromise(),await d,t.broadcast(new _.bN(!1)),c.switchToMode(r.Ey.Panorama,l.n.Interpolate,{sweepID:f,rotation:b},a.DEFAULT_TRANSITION_TIME)}await c.switchToMode(g,l.n.Instant,{sweepID:f,position:e?e.camera.position:void 0,rotation:b,zoom:e&&-1!==e.camera.zoom?e.camera.zoom:void 0}),p&&e&&e.floorVisibility&&await t.commandBinder.issueCommandWhenBound(new S.h9(e.floorVisibility.lastIndexOf(1),!0,0)),await this.renderBeforeStarting(t)}is360Pano(e){if(e.pano.uuid){const t=this.sweepData.getSweep(e.pano.uuid);if(t)return t.alignmentType!==c.z9.ALIGNED}else{const e=this.sweepData.getFirstSweep();if(e)return e.alignmentType!==c.z9.ALIGNED}return!1}async renderBeforeStarting(e){await this.renderer.renderOnce(),await e.getModule(g.default),this.renderer.startRender(!0),this.firstRenderPromise.resolve()}}},61103:(e,t,i)=>{"use strict";i.d(t,{s:()=>n,w:()=>o});var s=i(99681);class n extends s.m{constructor(){super(...arguments),this.id="WEBVR_PRELOAD"}}class o extends s.m{constructor(){super(...arguments),this.id="WEBVR_PRESENT"}}},23444:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var s=i(54122),n=i(25903),o=i(21265),r=i(63418),a=i(30853),l=i(25799),c=i(29675),h=i(61103),d=i(16925);const u=new l.Z("webvr-loader");class p extends s.Y{constructor(){super(...arguments),this.name="webvr-loader"}async init(e,t){this.engine=t,this.onExitVr=this.onExitVr.bind(this);const i=await t.getModule(r.default);this.appPhaseModule=await t.getModule(d.default),this.hackWebVRVersion=await i.getApi().getAppKey("SHOWCASE","webvr_version"),t.commandBinder.addBinding(h.s,(async()=>this.hackLoadVrScript())),t.commandBinder.addBinding(h.w,(async()=>this.hackEnterVrMode()))}async maybeCacheVrDisplay(){const e=await n.H();e&&(this.vrDisplay=e)}async hackEnterVrMode(){if(await this.maybeCacheVrDisplay(),u.debug(`Presenting legacy webvr app to ${this.vrDisplay}`),this.vrDisplay){u.info("Headset mounted"),this.engine.getModuleSync(a.default).disposeGui(),this.engine.deactivate(),this.explosivelyDisableGui();try{this.appPhaseModule.updateActiveApp(c.Mx.WEBVR)}catch(e){throw Error("Error: Can't switch application mode at this time")}}else u.error("vrDisplay not found")}hackLoadVrScript(){const e=o.hu("webvr")||this.hackWebVRVersion;u.debug(`Loading legacy webvr app version ${e}`);const t="https://static.matterport.com/webvr/"+e+"/js/main.js";return new Promise((function(e,i){const s=document.createElement("script");s.type="text/javascript",s.src=t,s.onload=e,document.head.appendChild(s)}))}onExitVr(){this.vrDisplay.isPresenting||(window.removeEventListener("vrdisplaypresentchange",this.onExitVr),u.info("Exiting VR"),this.hackUnload())}hackUnload(){let e=window.location.href;-1===window.location.search.indexOf("&qs=1")&&(e+="&qs=1"),window.location.replace(e)}explosivelyDisableGui(){const e=document.getElementById("gui");e&&e.remove()}}},23042:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.zoomLevel=e}}},79841:(e,t,i)=>{"use strict";i.d(t,{bj:()=>n,KB:()=>o,ob:()=>r,_N:()=>a,ts:()=>l});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={step:e}}}n.id="ZOOM_IN";class o extends s.m{constructor(e){super(),this.payload={step:e}}}o.id="ZOOM_OUT";class r extends s.m{}r.id="ZOOM_RESET";class a extends s.m{}a.id="ZOOM_MAX_VALUE";class l extends s.m{constructor(e){super(),this.payload={value:e}}}l.id="ZOOM_SET"},76682:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>M});var s=i(54122),n=i(30963),o=i(30604),r=i(93735),a=i(78626),l=i(35825),c=i(22767),h=i(89895),d=i(89155),u=i(64279),p=i(12775),m=i(71208),g=i(84564),f=i(77956),v=i(2212),y=i(56040),b=i(97620),w=i(8697),S=i(79841),T=i(25799),E=i(23042),_=i(87131);const x=new T.Z("Showcase Zoom Controls");class M extends s.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0,tiles:!0}}async init(e,t){if(this.config.enabled=!!e.enabled,this.config.tiles=!!e.tiles,this.config.tiles)try{this.sweepTilingModule=await t.getModule(g.default)}catch(e){x.debug(`Tiling not enabled for zoom controls - ${e}`)}this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModule(h.default),this.cameraData=await t.market.waitForData(d.M_),this.viewmodeData=await t.market.waitForData(p.O),this.sweepData=await t.market.waitForData(f.Z),this.bindings.push(t.commandBinder.addBinding(S.bj,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(S.KB,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(S.ob,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(S.ts,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(S._N,this.getMaxZoomAvailable.bind(this)))}async registerControls(e){e.getModule(n.default).then((e=>{this.bindings.push(e.registerHandler(o.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(r.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(a.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweepObject;if(this.config.tiles&&this.checkTilingZoomLevels(e,i),(e=(0,b.uZ)(e,w.X.minZoom,w.X.maxHighResZoom))!==t){const t=v.M8C.radToDeg(this.cameraData.baseFovY/e),i=u.oR.near,s=u.oR.far;this.cameraModule.updateCameraProjection((new y.M).makePerspectiveFov(t,this.cameraData.aspect(),i,s))}return this.engine.broadcast(new E.Z(e)),e}checkTilingZoomLevels(e,t){e>=w.X.highResThreshold&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t).then((e=>{e?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}))):e<w.X.highResThreshold&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[e]?w.X.maxHighResZoom:w.X.maxZoom}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.currentMode===m.Ey.Panorama&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*w.X.zoomStep}pinchToZoomDelta(e){return e.pinchDelta*(w.X.maxZoom-w.X.minZoom)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,s=(0,b.uZ)(t+e,w.X.minZoom,this.getMaxZoom(i));return this.zoomTo(s)}keyHandler(e){if(e.state===c.M.DOWN)switch(e.key){case l.R.PLUSEQUALS:this.zoomByInput(w.X.zoomStep);break;case l.R.DASHUNDERSCORE:this.zoomByInput(-w.X.zoomStep);break;case l.R.OPENBRACKET:this.zoomTo(1)}}async getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return w.X.maxZoom;const e=this.sweepData.currentSweepObject;return await this.sweepTilingModule.availableResolution(e,_.SL.ULTRAHIGH)>=_.SL.ULTRAHIGH?w.X.maxHighResZoom:w.X.maxZoom}}},8697:(e,t,i)=>{"use strict";i.d(t,{X:()=>s});const s={zoomStep:.1,minZoom:.7,maxZoom:2,maxHighResZoom:3,highResThreshold:1.1}},91843:(e,t,i)=>{"use strict";i.d(t,{KW:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={application:e}}}n.id="APP_SWITCH";class o extends s.m{constructor(e){super(),this.payload={visible:e}}}o.id="TOGGLE_WORKSHOP_BAR";class r extends s.m{}r.id="EDIT_FROM_PARENT"},29963:(e,t,i)=>{"use strict";i.d(t,{n3:()=>n,mQ:()=>o});var s=i(99681);class n extends s.m{}n.id="SHOWCASE_START";class o extends s.m{}o.id="SHOWCASE_STOP";class r extends s.m{}r.id="SHOWCASE_READY"},48475:(e,t,i)=>{"use strict";i.d(t,{M:()=>n});var s=i(99681);class n extends s.m{constructor(e,t){super(),this.id="RENAME_FLOOR",this.payload={floorId:e,text:t}}}},94944:(e,t,i)=>{"use strict";i.d(t,{U:()=>d});var s=i(26605),n=i(2116),o=i(34431),r=i(9872),a=i(14071),l=i(59984),c=i(42733);const h=new(i(25799).Z)("workshop-modal");var d;!function(e){e[e.CONFIRM=0]="CONFIRM",e[e.CLOSE=1]="CLOSE"}(d||(d={}));const u={message:"",title:"",modalClass:"",cancellable:!0,closeButton:!0,confirmDisabled:!1};let p=class extends s.Component{constructor(e){super(),this.handleModalCommand=async e=>{if(e.action===r.f.DISPLAY){if(this.state.open){if(!this.state.cancellable)return Promise.reject("Cannot close non-cancellable modal");await this.close(d.CLOSE)}return this.openModal(e.properties)}if(e.action===r.f.UPDATE)this.updateModal(e.properties);else{if(!this.state.open)return Promise.reject("Cannot cancel a closed modal");this.close(d.CLOSE)}return this.togglePromise},this.close=async e=>{await this.props.commandBinder.issueCommand(new o.n(400,0)),this.props.handleBlur(!1),this.promiseResolve(e),this.setState({open:!1})},this.stopPropagation=e=>{e.stopPropagation()},this.onCancel=e=>{e.stopPropagation(),this.close(d.CLOSE)},this.onConfirm=async e=>{e.stopPropagation(),this.close(d.CONFIRM)},this.state={open:!1}}async componentDidMount(){try{this.props.commandBinder.addBinding(r.Q,this.handleModalCommand)}catch(e){h.debug(e)}}async componentWillUnmount(){try{this.props.commandBinder.removeBinding(r.Q,this.handleModalCommand)}catch(e){h.debug(e)}}updateModal(e){this.state.open&&this.setState(Object.assign({},e))}openModal(e){this.props.commandBinder.issueCommand(new o.n(400,3)),this.props.handleBlur(!0);const t=Object.assign({},u,e);return this.setState(Object.assign({open:!0},t)),this.togglePromise=new Promise((e=>{this.promiseResolve=e})),this.togglePromise}render(){const{locale:e}=this.context,{open:t,title:i,titleLocalizationOptions:n,message:o,messageLocalizationOptions:r,confirmPhraseKey:h,cancelPhraseKey:d,closeButton:u,modalClass:p,confirmDisabled:m}=this.state,g=p||"";let f=i;if("string"==typeof i){const t=void 0===n?{}:n,o=e.t(i,t);f=(0,s.h)("span",null,o)}let v=o;if("string"==typeof o){const t=void 0===r?{}:r,i=e.t(o,t);v=(0,s.h)("p",{class:"modal-message"},i)}return(0,s.h)(l.N,{open:t,appendClass:{"modal-background":!0,"workshop-modal-background":!0,open:t},onClick:this.stopPropagation},(0,s.h)("dialog",{class:`modal workshop-modal ${g}`},(0,s.h)("header",{class:"modal-header"},(0,s.h)("div",{class:"modal-title"},f),u&&(0,s.h)(a.P,{onClose:this.onCancel})),(0,s.h)("div",{class:"modal-body"},v),(0,s.h)("div",{class:"modal-footer"},d&&(0,s.h)(c.zx,{buttonStyle:c.ZJ.OUTLINE,appendClass:{"button-inline":!0,cancel:!0},onClick:this.onCancel},e.t(d)),h&&(0,s.h)(c.zx,{buttonState:m?c.BN.DISABLED:c.BN.ENABLED,appendClass:{"button-inline":!0,confirm:!0},onClick:this.onConfirm},e.t(h)))))}};p=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],p)},9872:(e,t,i)=>{"use strict";i.d(t,{f:()=>s,Q:()=>o});var s,n=i(99681);!function(e){e[e.CLOSE=0]="CLOSE",e[e.DISPLAY=1]="DISPLAY",e[e.UPDATE=2]="UPDATE"}(s||(s={}));class o extends n.m{constructor(e,t){if(super(),e&&!t)throw new Error("Cannot open empty modal");this.payload={action:e,properties:t}}}o.id="WORKSHOP_MODAL"},91542:(e,t,i)=>{"use strict";i.d(t,{om:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.sweepId=e,this.position=t}}},53944:(e,t,i)=>{"use strict";i.d(t,{WY:()=>n,_G:()=>o});var s=i(93528);class n extends s.v{constructor(e){super(),this.sweepId=e}}class o extends s.v{constructor(e){super(),this.sweepId=e}}},56040:(e,t,i)=>{"use strict";i.d(t,{M:()=>o});var s=i(2212);class n{constructor(e){this.elements=[],e?(e=>void 0!==e.elements)(e)?this.elements=e.elements.slice():s.yGw.prototype.set.apply(this,e):s.yGw.prototype.set.apply(this,n.identity)}equals(e){return s.yGw.prototype.equals.call(this,e)}clone(){return new n(this)}}n.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class o extends n{constructor(e){e instanceof Array||e?super(e):super(),this.threeMatrix=new s.yGw}set(e,t,i,n,o,r,a,l,c,h,d,u,p,m,g,f){return s.yGw.prototype.set.call(this,e,t,i,n,o,r,a,l,c,h,d,u,p,m,g,f),this}makeScale(e,t,i){return s.yGw.prototype.makeScale.call(this,e,t,i),this}copy(e){for(let t=0;t<this.elements.length;t++)this.elements[t]=e.elements[t];return this}clone(){return(new o).copy(this)}transpose(){return s.yGw.prototype.transpose.call(this)}lookAt(e,t,i){return s.yGw.prototype.lookAt.call(this,e,t,i),this}setPosition(e){return s.yGw.prototype.setPosition.call(this,e.x,e.y,e.z),this}extractRotation(e){return s.yGw.prototype.extractRotation.call(this,e),this}makePerspective(e,t,i,n,o,r){return s.yGw.prototype.makePerspective.call(this,e,t,i,n,o,r),this}makePerspectiveFov(e,t,i=.1,n=1e3){const o=i*Math.tan(e*(Math.PI/180)/2),r=-o,a=o*t,l=-a;return s.yGw.prototype.makePerspective.call(this,l,a,o,r,i,n),this}makeOrthographic(e,t,i,n,o,r){return s.yGw.prototype.makeOrthographic.call(this,e,t,i,n,o,r),this}identity(){return this.set.apply(this,n.identity)}makeRotationFromQuaternion(e){return s.yGw.prototype.makeRotationFromQuaternion.call(this,e),this}makeRotationFromEuler(e){return s.yGw.prototype.makeRotationFromEuler.call(this,e),this}getInverse(e){return s.yGw.prototype.copy.call(this,e),s.yGw.prototype.invert.call(this),this}premultiply(e){return s.yGw.prototype.premultiply.call(this,e),this}multiplyMatrices(e,t){return s.yGw.prototype.multiplyMatrices.call(this,e,t),this}scale(e){return s.yGw.prototype.scale.call(this,e),this}compose(e,t,i){return s.yGw.prototype.compose.call(this,e,t,i),this}asThreeMatrix4(){return this.threeMatrix.set(this.elements[0],this.elements[4],this.elements[8],this.elements[12],this.elements[1],this.elements[5],this.elements[9],this.elements[13],this.elements[2],this.elements[6],this.elements[10],this.elements[14],this.elements[3],this.elements[7],this.elements[11],this.elements[15])}}},45805:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"})},99681:(e,t,i)=>{"use strict";i.d(t,{m:()=>s});class s{}},19413:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});var s=i(78909);class n extends s.T{}},83032:(e,t,i)=>{"use strict";i.d(t,{N:()=>r});var s=i(14567),n=i(61111),o=i(83852);class r{constructor(e,t){this.sync=e,this.config=t}async read(){const{engine:e,dataType:t}=this.config,i=await this.sync.load();return this.sync.isDirty()&&e.market.waitForData(s.Q).then((e=>{e.setUnpublished(t)})),i}addMonitor(e){if(this.config.readonly)throw new n.d7;this.sync.addMonitor(e)}async revert(){return this.sync.reset()}async create(){throw new o.n}async update(){throw new o.n}async delete(){throw new o.n}}},41263:(e,t,i)=>{"use strict";i.d(t,{aw:()=>h,b3:()=>p,nM:()=>m,iY:()=>g});var s=i(46162),n=i(64614),o=i(25799),r=i(78909),a=i(34170);const l=new o.Z("datasync");var c,h,d;!function(e){e[e.NONE=0]="NONE",e[e.LEGACY_SYNC=1]="LEGACY_SYNC",e[e.IGNORE_LEGACY_SAVE=2]="IGNORE_LEGACY_SAVE"}(c||(c={})),function(e){e.FLOOR_NAMES="FLOOR_NAMES",e.HIGHLIGHTS="HIGHLIGHTS",e.LABELS="LABELS",e.MATTERTAGS="MATTERTAGS",e.MEASUREMENTS="MEASUREMENTS",e.SETTINGS="SETTINGS",e.START_LOCATION="START_LOCATION",e.SWEEPS="SWEEPS"}(h||(h={}));class u extends r.T{constructor(){super(...arguments),this.dirty=!1,this.dirtyWS2=!1,this.sessionsSaving=0}}!function(e){e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.CLEAN=2]="CLEAN",e[e.DIRTY=3]="DIRTY"}(d||(d={}));class p{constructor(e,t){this.state=d.IDLE,this.diff={},this.deletedKeys=[],this.config=e,this.collectionData=t,this.config.extras||(this.config.extras=0),this.config.extras&c.LEGACY_SYNC||p.configuredSyncs.push(this)}static setGlobalStore(e){if(this.sharedStore)throw Error("Attempting to overwrite sync's internal store");this.sharedStore=e,this.sharedStore.read().then((e=>{this.sharedState.lastPublished=e.lastPublished,this.sharedState.commit()}))}static setMessageBus(e){this.msgBus=e}static setAfterPublish(e){p.afterPublishCallback=e}static async publishAll(){const e=this.configuredSyncs.map((e=>e.publish()));return await Promise.all(e),l.debug("sharedState.dirty = false"),this.sharedState.dirty=!1,this.sharedState.lastPublished=new Date,this.sharedState.commit(),this.sharedStore&&this.sharedStore.update(this.sharedState),this.afterPublishCallback&&await this.afterPublishCallback(),this.sharedState.lastPublished}static async resetEditStore(e){const t=this.configuredSyncs.find((t=>t.config.editStoreKey===e));t&&await t.reset()}static getStateOfEditStores(){const e=[];return this.configuredSyncs.forEach((t=>{void 0!==t.config.editStoreKey&&e.push({key:t.config.editStoreKey,dirty:t.isDirty()})})),e}static get globalSession(){return this.sharedState}isDirty(){return this.state===d.DIRTY}async load(){if(this.state!==d.IDLE)throw Error("Data already loaded");this.setState(d.LOADING);const e=this.config.publishStores&&this.config.publishStores.length>0?this.config.publishStores.map((e=>this.loadStore(e))):[];this.config.editStore&&e.push(this.loadStore(this.config.editStore)),this.config.legacyEditStore&&e.push(this.loadStore(this.config.legacyEditStore,!0));const t=await Promise.all(e),i=(e,t,i)=>t&&t.modified&&i.modified&&t.modified>i.modified?t:(e&&this.setState(d.DIRTY),i),n=(e,t,i,s,n)=>{if(!t)return e&&this.setState(d.DIRTY),i;if(s&&n&&n<s)return t;for(const s in i)i.hasOwnProperty(s)&&(e&&this.setState(d.DIRTY),t[s]=i[s]);return t};if(this.data=t[0].data||{},this.setState(d.CLEAN),this.publishedData=(0,s.p$)(this.data),this.collectionData)for(let e=1;e<t.length;e++){const s=e>=this.config.publishStores.length,o=t[e];if(o.data){for(const e in o.data)o.data.hasOwnProperty(e)&&(this.data[e]?this.config.partialData?this.data[e]=n(s,this.data[e],o.data[e]):this.data[e]=i(s,this.data[e],o.data[e]):(s&&this.setState(d.DIRTY),this.data[e]=o.data[e]));if(o.isLegacy)for(const e in this.data)o.data[e]||(s&&this.setState(d.DIRTY),this.data[e]=null,this.diff[e]=null);o.isLegacy||(this.diff=o.data)}}else for(let e=1;e<t.length;e++){const s=e>=this.config.publishStores.length,o=t[e].data;if(!o)continue;const r=o;if(this.config.partialData){const e=this.data.modified instanceof Date?this.data.modified:void 0,t=r.modified instanceof Date?r.modified:void 0;this.data=n(s,this.data,r,e,t)}else this.data=i(s,this.data,r)}for(const e in this.data)this.data[e]||(this.deletedKeys.push(e),delete this.data[e]);return this.data}loadStore(e,t=!1){return e.read().then((e=>({data:e,isLegacy:t})))}get monitorNeeded(){return void 0!==this.config.editStore||void 0!==this.config.legacyEditStore||this.config.publishStores.length>0}addMonitor(e){if(!this.monitorNeeded)throw Error("Adding a monitor unnecessarily!");this._monitor=e,this._monitor.onChanged((async()=>{if(this.onDataChanged(),this.config.safeKeys){let e=!1;if(this.collectionData)for(const t in this.diff)for(const i in this.diff[t])-1!==this.config.safeKeys.indexOf(i)&&(e=!0);else for(const t in this.diff)-1!==this.config.safeKeys.indexOf(t)&&(e=!0);if(!e)return}this.setState(d.DIRTY),await this.saveSession()}))}get monitor(){return this._monitor}setState(e){this.config.extras&c.LEGACY_SYNC?e!==d.DIRTY||p.sharedState.dirtyWS2||(l.debug("sharedState.dirtyWS2 = true"),p.sharedState.dirtyWS2=!0,p.sharedState.commit()):(this.state=e,this.state!==d.DIRTY||p.sharedState.dirty||(l.debug("sharedState.dirty = true"),p.sharedState.dirty=!0,p.sharedState.commit()))}async saveSession(){l.info("Saving session..."),p.sharedState.sessionsSaving++,p.sharedState.commit();try{this.config.editStore&&await this.config.editStore.update(this.data,this.diff),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.update(this.data,this.diff)}catch(e){l.error(e),p.msgBus.broadcast(new a.dz(e))}p.sharedState.sessionsSaving--,p.sharedState.commit()}async publish(){if(this.state===d.DIRTY){for(const e of this.config.publishStores){if(!this.isWritable(e))throw Error("Trying to publish with readonly store");try{await e.update(this.data,this.diff),this.publishedData=(0,s.p$)(this.data)}catch(t){throw l.error("Failed to publish data: ",e.config,this.data,this.diff),t}}try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.setState(d.CLEAN)}catch(e){throw Error("Failed to clear session data after publishing: "+e)}}}async reset(){switch(this.state){case d.CLEAN:return this.data;case d.IDLE:throw Error("Attempting to reset a Sync that was not loaded.");case d.LOADING:throw Error("Attempting to reset a Sync that is still loading.");case d.DIRTY:l.info("Clearing session..."),p.sharedState.sessionsSaving++,p.sharedState.commit();try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.data=(0,s.p$)(this.publishedData),this.setState(d.CLEAN)}catch(e){l.error(e),p.msgBus.broadcast(new a.dz(e))}return p.sharedState.sessionsSaving--,p.sharedState.commit(),this.data}}isWritable(e){return void 0!==e.update}}p.sharedState=new u,p.configuredSyncs=[];class m extends p{constructor(e){super(e,!1)}onDataChanged(){const e=this.monitor.getDiffRecord();this.diff=e,this.diff.modified=new Date}}class g extends p{constructor(e){super(e,!0)}onDataChanged(){const e=this.monitor.getDiffRecord();for(const t of e)switch(t.action){case n.KI.added:this.diff[t.index]=t.diff;break;case n.KI.updated:this.diff[t.index]||(this.diff[t.index]={}),(0,s.TS)(this.diff[t.index],t.diff);break;case n.KI.removed:delete this.diff[t.index],this.data[t.index]=null}this.monitor.clearDiffRecord()}}},28247:(e,t,i)=>{"use strict";var s,n;i.d(t,{p3:()=>s,Jj:()=>r,M8:()=>c,ZP:()=>d}),function(e){e[e.None=0]="None",e[e.Duration=1]="Duration",e[e.Phase=2]="Phase",e[e.Promise=3]="Promise"}(s||(s={}));class o{constructor(e){this.type=e}}class r extends o{constructor(){super(s.None)}}class a extends o{constructor(e){super(s.Duration),this.duration=e,this.startTime=Date.now()}}class l extends o{constructor(e){super(s.Phase),this.phase=e}}!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(n||(n={}));class c extends o{constructor(e){super(s.Promise),this.promise=e,this.promiseState=n.Pending,e.then((()=>{this.promiseState=n.Fulfilled})).catch((()=>{this.promiseState=n.Rejected}))}}class h{constructor(e,t=!0){this.generator=e,t&&this.start()}start(){this.started||(this.iterator=this.generator()),this.started=!0}iterate(){const e=this.iterator.next();this.currentResult=e.value,e.done&&(this.started=!1)}}class d{constructor(){this.generators=[]}startGenerator(e){let t=this.generators.length;for(let i=0;i<this.generators.length;i++)this.generators[i].generator===e&&(t=i);this.generators[t]=new h(e)}stopGenerator(e){for(const t of this.generators)t.generator===e&&(t.started=!1)}processGenerators(e,t){for(const i of this.generators)if(i.started)switch(e){case s.None:(!i.currentResult||i.currentResult instanceof r)&&i.iterate();break;case s.Phase:if(i.currentResult instanceof l){const e=i.currentResult;void 0!==t&&e.phase===t&&i.iterate()}break;case s.Promise:i.currentResult instanceof c&&i.currentResult.promiseState===n.Fulfilled&&i.iterate();break;case s.Duration:if(i.currentResult instanceof a){const e=i.currentResult;Date.now()-e.startTime>=e.duration&&i.iterate()}}}}},93528:(e,t,i)=>{"use strict";i.d(t,{v:()=>s});class s{constructor(){this.msgId=-1}setID(e){if(-1!==this.msgId)throw Error("Message.msgId can only be set once.");this.msgId=e}}},59309:(e,t,i)=>{"use strict";i.d(t,{Q:()=>a,Y:()=>l});var s=i(41307),n=i(25799),o=i(57501);const r=new n.Z("message-bus");var a;!function(e){e[e.PERMANENT=0]="PERMANENT",e[e.ONCE=1]="ONCE"}(a||(a={}));class l{constructor(){this.typeLookup=new s.cj,this.callbacks=[],this.messageQueue=[],this.messageCount=0}subscribe(e,t,i=a.PERMANENT){return(0,o.k1)((()=>this._subscribe(e,t,i)),(()=>this.unsubscribe(e,t)),!0,(0,s.HS)(e))}_subscribe(e,t,i=a.PERMANENT){const s=this.typeLookup.getIndexByType(e,!0);this.callbacks[s]||(this.callbacks[s]=[]),this.callbacks[s].push({type:i,callback:t})}unsubscribe(e,t){const i=this.typeLookup.getIndexByType(e);-1!==i?this.unsubscribeByIndex(i,t):r.debug(`Message callback not bound for Type: ${e.name}`)}unsubscribeByIndex(e,t){const i=this.callbacks[e].findIndex((e=>e.callback===t));-1!==i?this.callbacks[e].splice(i,1):r.debug(`Message callback not bound for TypeIndex: ${e}`)}broadcast(e){if(e.setID(this.messageCount++),this.messageQueue.push(e),1===this.messageQueue.length){for(const e of this.messageQueue){const t=this.typeLookup.getIndexByInstance(e);if(-1===t)continue;const i=this.callbacks[t].slice();for(const s of i)s.callback(e),s.type===a.ONCE&&this.unsubscribeByIndex(t,s.callback)}this.messageQueue=[]}}}},54122:(e,t,i)=>{"use strict";i.d(t,{Y:()=>n});var s=i(25799);class n{constructor(){this.bindings=[],this.log=new s.Z("module")}init(e,t){return Promise.resolve()}onUpdate(e){}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[]}}},32545:()=>{Math.sign||(Math.sign=e=>e>0?1:0===e?0:-1),Math.log2||(Math.log2=function(e){return Math.log(e)*Math.LOG2E})},3058:()=>{Number.parseInt||(Number.parseInt=window.parseInt),Number.parseFloat||(Number.parseFloat=window.parseFloat)},72864:()=>{String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t=0){const i=t>0?0|t:0;return this.substring(i,i+e.length)===e}}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)})},8848:()=>{if(!window.location.origin){const e=`${window.location.protocol}//${window.location.hostname}${window.location.port?`:${window.location.port}`:""}`;window.location.origin=e}},2779:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});class s{constructor(e){this._mask=e}get mask(){return this._mask}addLayers(e){this._mask|=e.mask}removeLayers(e){return this._mask&=~e.mask}clone(){return new s(this._mask)}}class n{constructor(){this.layerRegistry=[],this.unusedLayers=[];for(let e=1;e<32;e++)this.unusedLayers.push(e)}static get ALL(){return new s(-1)}static get NONE(){return new s(0)}static get DEFAULT(){return new s(1)}claimLayer(e){const t=this.getLayer(e);if(t.mask)return t;if(0===this.unusedLayers.length)throw Error("All render layers have already been claimed");const i=this.unusedLayers[0];return this.layerRegistry[i]=e,this.unusedLayers.shift(),new s(1<<i)}getLayer(e){const t=this.layerRegistry.indexOf(e);return-1!==t?new s(1<<t):n.NONE}disposeLayer(e){const t=this.layerRegistry.indexOf(e);-1!==t&&this.unusedLayers.push(t)}}},41307:(e,t,i)=>{"use strict";i.d(t,{z$:()=>s,oL:()=>n,HS:()=>o,cj:()=>r});const s=e=>e.prototype.constructor.name,n=e=>e.constructor,o=e=>{if(e&&e.name)return e.name;const t=e.toString();return t.substring(0,t.indexOf("\n")).split(" ")[1]};class r{constructor(e=!1){this.typeLookup=[],this.funcProto=Function.__proto__,this.allowInheritance=e}addIndexByType(e){if(!e)throw Error("Cannot index undefined type");if(-1!==this.typeLookup.indexOf(e))throw Error("Type already registered");return this.typeLookup.push(e)-1}getIndexByType(e,t){if(!e)throw Error("Cannot index undefined type");let i=-1;if(this.allowInheritance)for(let t=0;t<this.typeLookup.length;t++){let i=this.typeLookup[t];for(;i!==e&&i!==this.funcProto;)i=i.__proto__;if(i===e)return t}else i=this.typeLookup.indexOf(e);return-1===i&&t&&(i=this.typeLookup.push(e)-1),i}getIndicesByType(e){if(!e)throw Error("Cannot index undefined type");if(!this.allowInheritance)return[this.getIndexByType(e)];const t=[];for(let i=0;i<this.typeLookup.length;i++){let s=this.typeLookup[i];for(;s!==e&&s!==this.funcProto;)s=s.__proto__;s===e&&t.push(i)}return t}getIndexByInstance(e,t){if(!e)throw Error("Cannot index undefined data");let i=this.typeLookup.indexOf(e.constructor);return-1===i&&t&&(i=this.typeLookup.push(e.constructor)-1),i}getTypeByIndex(e){if(!(e in this.typeLookup))throw Error("Index not found");return this.typeLookup[e]}getKnownTypes(){return this.typeLookup.concat()}}},70785:(e,t,i)=>{"use strict";var s;i.d(t,{A:()=>s}),function(e){e[e.Begin=0]="Begin",e[e.Logic=1]="Logic",e[e.Render=2]="Render",e[e.End=3]="End"}(s||(s={}))},84637:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.x=e,this.y=t}}},80384:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.width=e,this.height=t}}},29675:(e,t,i)=>{"use strict";i.d(t,{nh:()=>h,Mx:()=>d,pu:()=>u,RU:()=>p});var s=i(19413),n=i(51874),o=i(5442),r=i(46162);function a(e,t){const i=Object.getOwnPropertyNames(t);for(const s of i)void 0===e[s]&&("function"==typeof t[s]?Object.defineProperty(e,s,{value:t[s].bind(e)}):Object.defineProperty(e,s,{value:t[s],writable:!0}));null!==Object.getPrototypeOf(Object.getPrototypeOf(t))&&a(e,Object.getPrototypeOf(t))}var l=i(78909);const c=e=>{if(!e||0===Object.keys(e).length)throw new Error("createObservableProxy() only works on objects that has predefined keys. Did you mean createObservableMap or createObservableArray?");if(e instanceof l.T)throw new Error("Using ObservableProxy on an ObservableObject is a BUG!");if(e.isObservableProxy)return e;const t={},i=new n.y,s=Object.create(e);Object.defineProperties(s,{isObservableProxy:{value:!0},onPropertyChanged:{value:(e,i)=>t[e].onChanged(i)},removeOnPropertyChanged:{value:(e,i)=>t[e].removeOnChanged(i)},deepCopy:{value:()=>(0,r.p$)(e)}}),a(s,i);for(const i in e)if(e.hasOwnProperty(i)){const n=(0,o.Y)(e[i]);t[i]=n,s.addChildObservable(n),Object.defineProperty(s,i,{get:()=>e[i],set:s=>{e[i]=s,t[i].value=s},enumerable:!0})}return Object.seal(s),s};var h,d;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WAITING=1]="WAITING",e[e.LOADING=2]="LOADING",e[e.STARTING=3]="STARTING",e[e.PLAYING=4]="PLAYING",e[e.ERROR=5]="ERROR"}(h||(h={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBVR=1]="WEBVR",e[e.SHOWCASE=2]="SHOWCASE",e[e.WORKSHOP=3]="WORKSHOP"}(d||(d={}));class u extends s.V{constructor(e,t=d.UNKNOWN){super(),this.name="app",this.phase=e,this.application=t,this.phaseTimes=c({[h.UNINITIALIZED]:0,[h.WAITING]:0,[h.LOADING]:0,[h.STARTING]:0,[h.PLAYING]:0,[h.ERROR]:0}),this.error=null}copy(e){this.phase=e.phase,this.phaseTimes[h.UNINITIALIZED]=e.phaseTimes[h.UNINITIALIZED],this.phaseTimes[h.WAITING]=e.phaseTimes[h.WAITING],this.phaseTimes[h.LOADING]=e.phaseTimes[h.LOADING],this.phaseTimes[h.STARTING]=e.phaseTimes[h.STARTING],this.phaseTimes[h.PLAYING]=e.phaseTimes[h.PLAYING],this.phaseTimes[h.ERROR]=e.phaseTimes[h.ERROR],this.application=e.application,this.error=e.error}}const p=()=>new u(h.UNINITIALIZED)},16925:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var s=i(54122),n=i(29675),o=i(3471);const r=new(i(25799).Z)("app-phase");class a extends s.Y{constructor(){super(...arguments),this.name="app-phase"}async init(e,t){this.market=t.market,this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.appState=(0,n.RU)(),this.appState.phase=n.nh.UNINITIALIZED,this.appState.phaseTimes[n.nh.UNINITIALIZED]=Date.now(),this.appState.application=n.Mx.SHOWCASE,this.market.register(this,n.pu,this.appState),this.watchTasks(this.appState.phase),this.watchErrors()}async watchTasks(e){if(e>=n.nh.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===n.nh.PLAYING&&this.broadcast(new o.pB(this.appState.application)),this.appState.phase!==n.nh.ERROR&&e!==n.nh.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[n.nh.ERROR])}catch(e){this.error(e)}}updateCurrentPhase(e){this.appState.phase=e,this.appState.phaseTimes[e]=Date.now(),r.info(`${JSON.stringify(this.appState)}`),this.appState.commit(),this.broadcast(new o.LZ(e))}error(e){this.appState.error=e,this.updateCurrentPhase(n.nh.ERROR)}updateActiveApp(e){this.appState.application=e,this.appState.commit(),this.broadcast(new o.bS(e))}getData(){return this.appState}}},3471:(e,t,i)=>{"use strict";i.d(t,{LZ:()=>n,bS:()=>o,pB:()=>r});var s=i(93528);class n extends s.v{constructor(e){super(),this.phase=e}}class o extends s.v{constructor(e){super(),this.application=e}}class r extends s.v{constructor(e){super(),this.application=e}}},76786:(e,t,i)=>{"use strict";i.d(t,{l:()=>s,W:()=>n});class s{constructor(e,t,i){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=i.create(),this.freshDataCache=i.create()}static async create(e,t,i){const n=await e.getDependencies();return new s(n,t,i)}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class n{constructor(){this.dirty=!1}}},96759:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});const s=new Set;function n(){let e;do{e=Math.floor(1e6*Math.random())}while(s.has(e));return s.add(e),e}s.add(0)},40031:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>q,setupSdk:()=>K});var s,n=i(54122),o=i(17187);!function(e){e.POSTMESSAGE="postmesesage",e.DIRECT="direct"}(s||(s={}));var r,a,l,c,h,d,u,p,m,g=i(38677);(c=r||(r={})).EVENT="postmessage.event",c.RESPONSE="postmessage.response",c.OBSERVATION="postmessage.observation",c.COLLECTION_UPDATE="collection.updated",(l=a||(a={})).ITEM_ADDED="collection.item.added",l.ITEM_REMOVED="collection.item.removed",l.ITEM_UPDATED="collection.item.updated",l.COLL_UPDATED="collection.coll.updated",i(73550),(h||(h={})).map=new Map,(p=d||(d={})).ACTION="postmessage.action",p.EVENT_SUB="postmessage.subscribe",p.EVENT_UNSUB="postmessage.unsubscribe",p.OBSERVABLE_SUB="postmessage.observe",p.OBSERVABLE_UNSUB="postmessage.unobserve",p.COLLECTION_SUB="collection.sub",p.COLLECTION_UNSUB="collection.unsub",function(e){e.CONNECT="postmessage.connect",e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject",e.ACTION="postmessage.action",e.RESPONSE="postmessage.response",e.EVENT="postmessage.event",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.OBSERVABLE_UPDATE="postmessage.observation"}(u||(u={}));class f extends o.EventEmitter{constructor(e,t,i){super(),this.id=t,this.clientId=i,this.clientWindow=null,this.clientOrigin=null,this.hostWindow=e,this.messageHandler=e=>{this.onPostmessageReceived(e)},this.bindEvents()}send(e){this.clientWindow&&this.clientOrigin&&this.clientWindow.postMessage(Object.assign(Object.assign({payload:e},e),{fromId:this.id}),this.clientOrigin)}setTarget(e,t){this.clientWindow=e,this.clientOrigin=t}clearTarget(){this.clientWindow=null,this.clientOrigin=null}bindEvents(){this.hostWindow.addEventListener("message",this.messageHandler)}dispose(){this.hostWindow.removeEventListener("message",this.messageHandler)}onPostmessageReceived(e){const t=e.origin,i=e.source;if(i){switch(e.data.type){case u.CONNECT:break;case u.ACTION:case u.EVENT_SUB:case u.EVENT_UNSUB:case u.OBSERVABLE_SUB:case u.OBSERVABLE_UNSUB:case d.COLLECTION_SUB:case d.COLLECTION_UNSUB:if(!this.validateMessageOrigin(e.data.fromId,t,i))return;break;default:return}if(e.data.payload)this.emit(e.data.type,Object.assign(Object.assign({},e.data.payload),{type:e.data.type,fromId:e.data.fromId,source:i,origin:t,method:s.POSTMESSAGE}));else{const n=Object.assign(Object.assign({},e.data),{source:i,origin:t,timestamp:Date.now(),method:s.POSTMESSAGE});this.emit(e.data.type,n)}}}validateMessageOrigin(e,t,i){return-1===this.clientId&&"*"===this.clientOrigin||this.clientId===e&&this.clientWindow===i&&this.clientOrigin===t}}!function(e){e.CONNECTION="sdk.connection",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(m||(m={}));var v=i(25799);const y=new v.Z("SdkHost");class b extends o.EventEmitter{constructor(e){super(),this.hostWindow=e,this.id=Math.floor(1e5*Math.random()),this.clients={},this.connectionHandler=new f(e,this.id,-1),this.bindEvents(e)}broadcastEventToClient(e,t,i){const s=this.clients[e];if(!s)return;const n={type:u.EVENT,eventType:t,eventData:i,toId:e};s.messenger.send(n)}broadcastObservationToClient(e,t,i){const s=this.clients[e];if(!s)return;const n={type:u.OBSERVABLE_UPDATE,observableKey:t,observableData:i,toId:e};s.messenger.send(n)}broadcastCollectionItemAdded(e,t,i,s){const n=this.clients[e];if(!n)return;const o={type:r.COLLECTION_UPDATE,operation:a.ITEM_ADDED,collectionKey:t,collectionIndex:i,item:s,toId:e};n.messenger.send(o)}broadcastCollectionItemRemoved(e,t,i){const s=this.clients[e];if(!s)return;const n={type:r.COLLECTION_UPDATE,operation:a.ITEM_REMOVED,collectionKey:t,collectionIndex:i,toId:e};s.messenger.send(n)}broadcastCollectionItemUpdated(e,t,i,s){const n=this.clients[e];if(!n)return;const o={type:r.COLLECTION_UPDATE,operation:a.ITEM_UPDATED,collectionKey:t,collectionIndex:i,item:s,toId:e};n.messenger.send(o)}broadcastCollectionUpdated(e,t){const i=this.clients[e];if(!i)return;const s={type:r.COLLECTION_UPDATE,operation:a.COLL_UPDATED,collectionKey:t,toId:e};i.messenger.send(s)}broadcastEvent(e,t,i=!0){for(const s of Object.keys(this.clients))(i||this.clients[parseInt(s,10)].subscriptions[e])&&this.broadcastEventToClient(parseInt(s,10),e,t)}bindEvents(e){this.connectionHandler.on(u.CONNECT,(t=>{const i=new f(e,this.id,t.fromId);this.onConnectionReceived(i,t)}))}onConnectionReceived(e,t){const i=Object.assign(Object.assign({},t),{handshake:()=>{const s=this.clients[i.fromId];if(s&&s.connected)return void y.info(`client already connected: ${i.fromId}`);this.clients[i.fromId]={key:t.applicationKey,origin:t.origin,messenger:e,subscriptions:{},connected:!1};const n={type:u.HANDSHAKE,toId:i.fromId};y.info(`handshake ${i.fromId}`),e.send(n)},accept:(t,s,n)=>{const o=this.clients[i.fromId];if(o&&o.connected)return void y.info(`client already connected: ${i.fromId}`);const r={type:u.ACCEPT,toId:i.fromId,targetId:this.id,targetOrigin:`${this.hostWindow.location.protocol}//${this.hostWindow.location.host}`,warning:n,scriptUrl:t,interface:s};y.info(`accept ${i.fromId}`),e.send(r),o.connected=!0,e.on(u.ACTION,(e=>this.onMessageReceived(o,e))),e.on(u.EVENT_SUB,(e=>this.onEventSubscribe(o,e))),e.on(u.EVENT_UNSUB,(e=>this.onEventUnsubscribe(o,e))),e.on(u.OBSERVABLE_SUB,(e=>this.onObservableSubscribe(o,e))),e.on(u.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubscribe(o,e))),e.on(d.COLLECTION_SUB,(e=>this.onCollectionSubscribe(o,e))),e.on(d.COLLECTION_UNSUB,(e=>this.onCollectionUnsubscribe(o,e)))},reject:t=>{const s={type:u.REJECT,toId:i.fromId,reason:t};e.send(s),e.clearTarget(),e.dispose(),delete this.clients[i.fromId]},method:s.POSTMESSAGE});e.setTarget(i.source,i.origin),this.emit(m.CONNECTION,i)}onMessageReceived(e,t){const i={toId:t.fromId,uid:t.uid,message:null,success:!0,type:u.RESPONSE,timestamp:Date.now()};function s(t){i.message=t,e.messenger.send(i)}const n=Object.assign(Object.assign({},t),{applicationKey:e.key,origin:e.origin,onSuccess:e=>{s(e)},onFail:e=>{i.success=!1,i.error=e,s(e)}});this.emit(m.MESSAGED,n)}onEventSubscribe(e,t){e.subscriptions[t.subscription]=!0,this.emitSdkEvent(m.SUBSCRIBED,e,t)}onEventUnsubscribe(e,t){e.subscriptions[t.subscription]=!1,this.emitSdkEvent(m.UNSUBSCRIBED,e,t)}onObservableSubscribe(e,t){this.emitSdkEvent(m.OBSERVABLE_SUB,e,t)}onObservableUnsubscribe(e,t){this.emitSdkEvent(m.OBSERVABLE_UNSUB,e,t)}onCollectionSubscribe(e,t){this.emitSdkEvent(m.COLLECTION_SUB,e,t)}onCollectionUnsubscribe(e,t){this.emitSdkEvent(m.COLLECTION_UNSUB,e,t)}emitSdkEvent(e,t,i){this.emit(e,Object.assign(Object.assign({},i),{applicationKey:t.key,origin:t.origin}))}}var w=i(96759);class S{constructor(){this.observers=[]}addObserver(e){this.observers.push(e)}removeObserver(e){const t=this.observers.indexOf(e);t>-1&&this.observers.splice(t,1)}post(e){for(const t of this.observers)t.notify(e)}}class T{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e))}}class E{constructor(e,t,i){this.hostId=e,this.host=t,this.onCreationObserver=i}createMessenger(){const e=(0,w.O)(),t=new S,i=new g.Pf(e,this.hostId,new T(t,this.host));return this.onCreationObserver.notify(e,t,i),i}}class _{constructor(e,t,i){this.observer=e,this.applicationKey=t,this.origin=i}notify(e,t,i){this.observer.onConnectionReceived(this.applicationKey,this.origin,{id:e,node:t,messenger:i})}}class x{constructor(e,t){this.receiver=e,this.clientId=t,this.messageType=d.ACTION}notify(e){this.receiver.receiveAction(e,this.clientId)}}class M{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.EVENT_SUB}notify(e){this.observer.receiveEventSub(e,this.clientId)}}class P{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.EVENT_UNSUB}notify(e){this.observer.receiveEventUnsub(e,this.clientId)}}class A{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.OBSERVABLE_SUB}notify(e){this.observer.receiveObservableSub(e,this.clientId)}}class O{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.OBSERVABLE_UNSUB}notify(e){this.observer.receiveObservableUnsub(e,this.clientId)}}class D{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.COLLECTION_SUB}notify(e){this.observer.receiveCollectionSub(e,this.clientId)}}class I{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=d.COLLECTION_UNSUB}notify(e){this.observer.receiveCollectionUnsub(e,this.clientId)}}class C{constructor(e,t,i,s){this.type=r.RESPONSE,this.payload={uid:e,message:t,success:i,error:s}}}class R{constructor(e,t){this.type=r.EVENT,this.payload={eventType:e,eventData:t}}}class L{constructor(e,t){this.type=r.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class N{constructor(e,t,i,s){this.type=r.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:s}}}class k{constructor(e,t,i){this.type=r.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i}}}class F{constructor(e,t,i,s){this.type=r.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:s}}}class B{constructor(e,t){this.type=r.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class U{constructor(){this.hostId=Math.floor(1e6*Math.random()),this.host=new S,this.clientConnections={},this.clientEventSubscriptions=new g.XG,this.clientObservableSubscriptions=new g.XG,this.clientCollectionSubscriptions=new g.XG,this.facade=new U.DirectMessageHostFacade(this)}createFactory(e,t){const i=new _(this.facade,e,t);return new E(this.hostId,this.host,i)}broadcastEvent(e,t,i=!0){const s=this.clientEventSubscriptions.getValuesAtKey(e);if(s||i)for(const i of s)this.clientConnections[i].hostToClient.send(new R(e,t||[]))}broadcastObservationToClient(e,t){const i=this.clientObservableSubscriptions.getValuesAtKey(e);if(i)for(const s of i)this.clientConnections[s].hostToClient.send(new L(e,t))}broadcastCollectionItemAdded(e,t,i){const s=this.clientCollectionSubscriptions.getValuesAtKey(e);if(s)for(const n of s)this.clientConnections[n].hostToClient.send(new N(a.ITEM_ADDED,e,t,i))}broadcastCollectionItemRemoved(e,t){const i=this.clientCollectionSubscriptions.getValuesAtKey(e);if(i)for(const s of i)this.clientConnections[s].hostToClient.send(new k(a.ITEM_REMOVED,e,t))}broadcastCollectionItemUpdated(e,t,i){const s=this.clientCollectionSubscriptions.getValuesAtKey(e);if(s)for(const n of s)this.clientConnections[n].hostToClient.send(new F(a.ITEM_UPDATED,e,t,i))}broadcastCollectionUpdated(e){const t=this.clientCollectionSubscriptions.getValuesAtKey(e);if(t)for(const i of t)this.clientConnections[i].hostToClient.send(new B(a.COLL_UPDATED,e))}onCallReceived(e){this.functionCallcallback=e}onSubscribeReceived(e){this.eventSubCallback=e}onUnsubscribeReceived(e){this.eventUnsubCallback=e}onObservableSubReceived(e){this.observableSubCallback=e}onObservableUnsubReceived(e){this.observableUnsubCallback=e}onCollectionSubReceived(e){this.collectionSubCallback=e}onCollectionUnsubReceived(e){this.collectionUnsubCallback=e}createHostToClientConnection(e,t){const i=new g.Pf(this.hostId,e,new T(this.host,t)),s=new U.DirectMessageHostFacade(this);return i.addObserver(new x(s,e)),i.addObserver(new M(s,e)),i.addObserver(new P(s,e)),i.addObserver(new A(s,e)),i.addObserver(new O(s,e)),i.addObserver(new D(s,e)),i.addObserver(new I(s,e)),i.init(),i}onConnectionReceived(e,t,i){const s=i.id,n=this.createHostToClientConnection(s,i.node);this.clientConnections[s]={id:s,clientToHost:i.messenger,hostToClient:n,applicationKey:e,origin:t}}receiveAction(e,t){const i=this.clientConnections[t];if(!i)return;this.functionCallcallback&&this.functionCallcallback(Object.assign(Object.assign({},e),{type:u.ACTION,onSuccess:t=>{i.hostToClient.send(new C(e.uid,t,!0,""))},onFail:t=>{i.hostToClient.send(new C(e.uid,{},!1,t))},fromId:t,applicationKey:i.applicationKey,origin:i.origin,method:s.DIRECT,source:void 0}))}receiveEventSub(e,t){const i=this.clientConnections[t];i&&this.eventSubCallback&&(this.clientEventSubscriptions.add(e.subscription,t),this.eventSubCallback(this.createBridgedMessage(u.EVENT_SUB,e,i)))}receiveEventUnsub(e,t){const i=this.clientConnections[t];i&&this.eventUnsubCallback&&(this.clientEventSubscriptions.remove(e.subscription,t),this.eventUnsubCallback(this.createBridgedMessage(u.EVENT_UNSUB,e,i)))}receiveObservableSub(e,t){const i=this.clientConnections[t];i&&this.observableSubCallback&&(this.clientObservableSubscriptions.add(e.observableKey,t),this.observableSubCallback(this.createBridgedMessage(u.OBSERVABLE_SUB,e,i)))}receiveObservableUnsub(e,t){const i=this.clientConnections[t];i&&this.observableUnsubCallback&&(this.clientObservableSubscriptions.remove(e.observableKey,t),this.observableUnsubCallback(this.createBridgedMessage(u.OBSERVABLE_UNSUB,e,i)))}receiveCollectionSub(e,t){const i=this.clientConnections[t];i&&this.collectionSubCallback&&(this.clientCollectionSubscriptions.add(e.collectionKey,t),this.collectionSubCallback(this.createBridgedMessage(d.COLLECTION_SUB,e,i)))}receiveCollectionUnsub(e,t){const i=this.clientConnections[t];i&&this.collectionUnsubCallback&&(this.clientCollectionSubscriptions.remove(e.collectionKey,t),this.collectionUnsubCallback(this.createBridgedMessage(d.COLLECTION_UNSUB,e,i)))}createBridgedMessage(e,t,i){return Object.assign(Object.assign({},t),{fromId:i.id,uid:-1,type:e,applicationKey:i.applicationKey,origin:i.origin,method:s.DIRECT,source:void 0})}}U.DirectMessageHostFacade=class{constructor(e){this.directMessageHost=e}onConnectionReceived(e,t,i){this.directMessageHost.onConnectionReceived(e,t,i)}receiveAction(e,t){this.directMessageHost.receiveAction(e,t)}receiveEventSub(e,t){this.directMessageHost.receiveEventSub(e,t)}receiveEventUnsub(e,t){this.directMessageHost.receiveEventUnsub(e,t)}receiveObservableSub(e,t){this.directMessageHost.receiveObservableSub(e,t)}receiveObservableUnsub(e,t){this.directMessageHost.receiveObservableUnsub(e,t)}receiveCollectionSub(e,t){this.directMessageHost.receiveCollectionSub(e,t)}receiveCollectionUnsub(e,t){this.directMessageHost.receiveCollectionUnsub(e,t)}};var H=i(44266),G=i(13931),V=i(76786),z=i(19413);class j extends z.V{constructor(){super(...arguments),this.name="sdk",this.applicationKey=null}copy(e){this.applicationKey=e.applicationKey}}const W=new v.Z("sdk");class Z{constructor(e){this.analytics=e,this.trackedEvents={}}track(e,t,i){this.trackedEvents[e]&&this.trackedEvents[e][t]||(this.trackedEvents[e]=this.trackedEvents[e]||{},this.trackedEvents[e][t]=!0,this.analytics.track(e,i))}}class q extends n.Y{constructor(){super(...arguments),this.name="sdk",this.clientInterface={functions:{},commands:{},enums:{},observables:{},collections:{}},this.valueToClientInterface={},this.commandCreators={},this.registeredEventUsers={},this.commands={},this.observables={},this.registeredObservers={},this.collections={},this.registeredCollectionObservers={},this.observerMap=new Map}async init(e,t){this.validationUrl=e.validationUrl,this.postMessageHost=new b(window),this.directMessageHost=new U,this.analytics=new Z(await t.getModule(G.default)),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.interfacePromise=new H.Q,this.clientScriptUrl=e.clientScriptUrl,this.requestQueue=e.queue,this.data=new j,t.market.register(this,j,this.data)}async connect(e,t){return new Promise(((i,n)=>{this.onConnectionReceived({accept:(s,n,o)=>{i({scriptUrl:s,serializedInterface:n,messengerFactory:this.directMessageHost.createFactory(e,t),warning:o}),this.data.atomic((()=>{this.data.applicationKey=e}))},reject:e=>n(e),handshake:()=>{},applicationKey:e,origin:t,method:s.DIRECT})}))}enableHandshaking(){this.postMessageHost.on(m.CONNECTION,(e=>this.onConnectionReceived(e)))}acceptConnections(){this.postMessageHost.on(m.MESSAGED,(e=>this.onActionReceived(e))),this.postMessageHost.on(m.SUBSCRIBED,(e=>this.onSubscribeReceived(e))),this.postMessageHost.on(m.UNSUBSCRIBED,(e=>this.onUnsubscribeReceived(e))),this.postMessageHost.on(m.OBSERVABLE_SUB,(e=>this.onObservableSubReceived(e))),this.postMessageHost.on(m.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubReceived(e))),this.postMessageHost.on(m.COLLECTION_SUB,(e=>this.onCollectionSubReceived(e))),this.postMessageHost.on(m.COLLECTION_UNSUB,(e=>this.onCollectionUnsubReceived(e))),this.directMessageHost.onCallReceived((e=>this.onActionReceived(e))),this.directMessageHost.onSubscribeReceived((e=>this.onSubscribeReceived(e))),this.directMessageHost.onUnsubscribeReceived((e=>this.onUnsubscribeReceived(e))),this.directMessageHost.onObservableSubReceived((e=>this.onObservableSubReceived(e))),this.directMessageHost.onObservableUnsubReceived((e=>this.onObservableUnsubReceived(e))),this.directMessageHost.onCollectionSubReceived((e=>this.onCollectionSubReceived(e))),this.directMessageHost.onCollectionUnsubReceived((e=>this.onCollectionUnsubReceived(e))),this.interfacePromise.resolve()}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){if(this.observerMap.size)for(const[e,[t,i,s]]of this.observerMap)e.dirty&&(this.notifyObservableUpdate(t,i,s.getData()),e.dirty=!1)}addCommandCreator(e,t){const i=this.getInterfaceIndex(e);this.clientInterface.functions.hasOwnProperty(i)&&W.debug(`Overwriting ${i} function in sdk interface`),this.clientInterface.functions[i]=e,this.commandCreators[i]=t}addEnumToInterface(e){const t=this.getInterfaceIndex(e);if(this.clientInterface.functions.hasOwnProperty(t)&&W.debug(`Overwriting ${t} enum in sdk interface`),this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const i in t){this.valueToClientInterface;const s=e.values[t[i]];this.valueToClientInterface.hasOwnProperty(s)?W.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[s]=e}}}async addCommandToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCommand(i,t),this.clientInterface.commands[i]=e}async addCommand(e,t){this.clientInterface.commands.hasOwnProperty(e),this.commands[e]=await t;const i=this;return{dispose(){i.removeCommand(e)}}}removeCommand(e){delete this.commands[e]}addObservableToInterface(e,t){const i=this.getInterfaceIndex(e);this.addObservable(i,t),this.clientInterface.observables[i]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e),this.observables[e]=t;const i=this;return{dispose(){i.removeObservable(e)}}}removeObservable(e){delete this.observables[e];for(const t in this.registeredObservers){const i=this.registeredObservers[t],s=i[e];s&&s.cancel(),delete i[e]}}addCollectionToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCollection(i,t),this.clientInterface.collections[i]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e),this.collections[e]=t;const i=this;return{dispose(){i.removeCollection(e)}}}removeCollection(e){delete this.collections[e];for(const t in this.registeredCollectionObservers){const i=this.registeredCollectionObservers[t],s=i[e];s&&s.cancel(),delete i[e]}}getInterfaceIndex(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}broadcast(e,t,i,s=!0){const n=this.registeredEventUsers[e]>0;if(s||n)if(t)if(void 0!==i){const n=t(i);this.postMessageHost.broadcastEvent(e,n,s),this.directMessageHost.broadcastEvent(e,n,s)}else{const i=t();this.postMessageHost.broadcastEvent(e,i,s),this.directMessageHost.broadcastEvent(e,i,s)}else this.postMessageHost.broadcastEvent(e,void 0,s),this.directMessageHost.broadcastEvent(e,void 0,s)}notifyObservableUpdate(e,t,i){this.postMessageHost.broadcastObservationToClient(e,t,i),this.directMessageHost.broadcastObservationToClient(t,i)}async onConnectionReceived(e){if(!this.clientFilter(e))return e.reject("Connection refused");try{await this.verifyConnection(e)}catch(t){return e.reject("key/referrer mismatch")}const t=t=>{const i={enums:this.clientInterface.enums,functions:Object.assign(Object.assign({},this.clientInterface.functions),this.clientInterface.commands),observables:this.clientInterface.observables,collections:this.clientInterface.collections};this.trackSdkConnect(e),e.accept(this.clientScriptUrl,i,t)};e.handshake(),this.interfacePromise.then((()=>t()))}verifyConnection(e){const t={cache:!1,headers:{"X-Matterport-Application-Key":e.applicationKey,"X-Matterport-Referrer":e.origin}};return this.requestQueue.get(this.validationUrl,t)}onActionReceived(e){if(this.tryActionThroughCommand(e))return;const t=this.commandCreators[e.targetFunction];if(!t)return e.onFail(`${e.targetFunction} is not a valid command`);this.trackSdkCall(e);try{this.issueCommand(t(e.params)).then(e.onSuccess,(t=>e.onFail(t.message)))}catch(t){W.debug(t),e.onFail(t.message)}}tryActionThroughCommand(e){const t=this.commands[e.targetFunction];if(!t)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(e.onFail(`${e.targetFunction} is not ready to be called`),!0);this.trackSdkCall(e);try{t.exec(e.params,new Y(e))}catch(t){W.debug(t),e.onFail(t.message)}return!0}onSubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)||(this.registeredEventUsers[e.subscription]=0),this.registeredEventUsers[e.subscription]++,this.trackSdkEvent(m.SUBSCRIBED,e)}onUnsubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)&&(this.trackSdkEvent(m.UNSUBSCRIBED,e),this.registeredEventUsers[e.subscription]--)}async onObservableSubReceived(e){const t=e.fromId,i=e.observableKey,s=this.observables[i];if(s){const n=await s;if(!this.observables[i])return;if(this.registeredObservers[t]=this.registeredObservers[t]||{},void 0===this.registeredObservers[t][i]){const s=new V.W;this.registeredObservers[t][i]=n.subscribe(s),this.observerMap.set(s,[t,i,n]),this.trackClientSubscribe(m.OBSERVABLE_SUB,e)}}else W.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e){const t=e.fromId,i=e.observableKey;this.registeredObservers[t]&&this.registeredObservers[t][i]&&(this.registeredObservers[t][i].cancel(),delete this.registeredObservers[t][i],this.trackClientSubscribe(m.OBSERVABLE_UNSUB,e))}async onCollectionSubReceived(e){const t=e.fromId,i=e.collectionKey,s=this.collections[i];if(s){const n=await s;if(!this.collections[i])return;this.registeredCollectionObservers[t]=this.registeredCollectionObservers[t]||{},void 0===this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i]=n.observe({onAdded:(e,s)=>{this.postMessageHost.broadcastCollectionItemAdded(t,i,e,s),this.directMessageHost.broadcastCollectionItemAdded(i,e,s)},onRemoved:e=>{this.postMessageHost.broadcastCollectionItemRemoved(t,i,e),this.directMessageHost.broadcastCollectionItemRemoved(i,e)},onUpdated:(e,s)=>{this.postMessageHost.broadcastCollectionItemUpdated(t,i,e,s),this.directMessageHost.broadcastCollectionItemUpdated(i,e,s)},onCollectionUpdated:()=>{this.postMessageHost.broadcastCollectionUpdated(t,i),this.directMessageHost.broadcastCollectionUpdated(i)}}),this.trackClientSubCollection(m.COLLECTION_SUB,e))}else W.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e){const{fromId:t,collectionKey:i}=e;this.registeredCollectionObservers[t]&&this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i].cancel(),delete this.registeredCollectionObservers[t][i],this.trackClientSubCollection(m.COLLECTION_UNSUB,e))}trackSdkEvent(e,t){if(!this.analytics)return;const i=e===m.SUBSCRIBED?"on":"off",s=this.valueToClientInterface[t.subscription];if(!s)return;const n=Object.keys(s.values),o=n.find(((e,i)=>{const o=n[i];return s.values[o]===t.subscription}));if(!o)return;const r={origin:t.origin,applicationKey:t.applicationKey,name:i,namespace:s.namespace,eventType:o,count:this.registeredEventUsers[t.subscription],method:t.method};this.analytics.track("sdk_event",t.subscription,r)}trackSdkConnect(e){if(!this.analytics)return;const t={origin:e.origin,applicationKey:e.applicationKey,method:e.method};this.analytics.track("sdk_connect","connect",t)}trackSdkCall(e){if(!this.analytics)return;const t=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],i=Object.assign(Object.assign({origin:e.origin,applicationKey:e.applicationKey},t),{method:e.method});this.analytics.track("sdk_call",e.targetFunction,i)}trackClientSubscribe(e,t){const i=e===m.OBSERVABLE_SUB,s=this.clientInterface.observables[t.observableKey],n=Object.assign(Object.assign({origin:t.origin,applicationKey:t.applicationKey},s),{is_collection:!1,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.observableKey,n)}trackClientSubCollection(e,t){const i=e===m.COLLECTION_SUB,s=this.clientInterface.collections[t.collectionKey],n=Object.assign(Object.assign({origin:t.origin,applicationKey:t.applicationKey},s),{is_collection:!0,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.collectionKey,n)}}const K=async(e,t)=>{const i=await e.getModule(q);i.enableHandshaking(),await Promise.all(t.map((async t=>{await t(e,i)}))),i.acceptConnections()};class Y{constructor(e){this.action=e}return(e){this.action.onSuccess(e)}throw(e){this.action.onFail(e)}}},14600:(e,t,i)=>{"use strict";var s;i.d(t,{F:()=>s}),function(e){e.UnitType="user_preference/unit_type",e.MeasurementSnapping="user_preference/measurement_snapping",e.MeasurementContinuousLines="user_preference/measurement_continuous",e.MeasurementUserNudgeSeen="user_preference/measurement_nudge",e.HighlightReelSettingsTab="user_preference/highlight_reel_settings_tab",e.NotesModeNudgeSeen="user_preference/notes_mode_nudge",e.NotesAddNudgeSeen="user_preference/notes_add_nudge"}(s||(s={}))},9608:(e,t,i)=>{"use strict";i.d(t,{u:()=>s});class s{constructor(e,t){this.settingsData=e,this.settings=t,this.cache={}}apply(){this.cache={};for(const e of Object.keys(this.settings)){const t=this.settingsData.tryGetProperty(e,void 0);t!==this.settings[e]&&(this.cache[e]=t,this.settingsData.setProperty(e,this.settings[e]))}}reset(){for(const e of Object.keys(this.cache)){const t=this.cache[e];this.settingsData.setProperty(e,void 0!==t&&t)}this.cache={}}toggle(e){e?this.apply():this.reset()}}},39936:(e,t,i)=>{"use strict";i.d(t,{e:()=>r});var s=i(19413),n=i(71229),o=i(21265);class r extends s.V{constructor(){super(...arguments),this.name="settings",this.properties=(0,n.q)()}clone(){const e=new r;return e.copy(this),e}copy(e){const t=e.properties;for(const e of t.keys){const i=t.get(e);i&&"function"==typeof i.clone?this.setProperty(e,i.clone()):this.setProperty(e,i)}}setProperty(e,t){const i=this.properties.get(e);null!=t&&i===t||(this.properties.set(e,t),this.commit([e]))}notifyPropertyObserver(e,t){e(this.properties.get(t))}setLocalStorageProperty(e,t){(0,o.m8)(e,t),this.setProperty(e,t)}hasProperty(e){return this.properties.has(e)}tryGetProperty(e,t){return this.hasProperty(e)?this.properties.get(e):t}getProperty(e){if(this.hasProperty(e))return this.properties.get(e);throw new Error("SettingsData: "+e+" not found")}checkUrlParam(e,t,i=0){const s=this.tryGetProperty(e,i);return"number"==typeof s?s===t:parseInt(s,10)===t}iterate(e){for(const t of this.properties.keys)e(t,this.getProperty(t))}}},30853:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SettingPersistence:()=>p,default:()=>m});var s,n=i(25799),o=i(2212),r=i(62367),a=i(44266);!function(e){e[e.Init=0]="Init",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(s||(s={}));class l{constructor(e){this.onChange=e,this.settings={},this.helperObject={colors:{},vectors:{},quaternions:{}},this.initPromise=new a.Q,this.loadState=s.Init,this.uninitError="ControlKit not yet initialized",this.lastKeys=[],this.lastKeysBufferLength=0,this.controlKit=void 0,this.updateRequired=!1,this.panels=[],this.onToggleCallbacks={},this.onKeyDown=e=>{this.lastKeys.unshift(e.keyCode),this.lastKeys.length>this.lastKeysBufferLength&&this.lastKeys.pop();for(let e=0;e<this.panels.length;e++){const t=this.panels[e].activationSequence;(0,r.Jq)(this.lastKeys,t)&&this.toggle(e)}},this.getPanelId=e=>{for(const t of this.panels)if(e===t.header)return t.index;return-1},this.getSubGroup=(e,t)=>{const i=this.panels[e];if(i.guiPanel||(i.guiPanel=i.makeGuiPanel()),!i.allowSubGroups)return i.guiPanel;let s=i.subGroups[t];return s||(s=i.guiPanel.addSubGroup({label:t,enable:!1}),i.subGroups[t]=s),s},this.addColor=(e,t,i,s)=>{this.updateHelperObject(t+i,s),e.addColor(this.helperObject.colors,t+i,{label:i,colorMode:"hex",onChange:e=>{this.settings[t+i].setHex(parseInt(e.substring(1),16));const s={};s[i]=this.settings[t+i],this.onChange(s)}})},this.addVector3=(e,t,i,s)=>{this.updateHelperObject(i,s);const n=e.addSubGroup({label:i}),r=["x","y","z"];for(const e in r)n.addNumberInput(this.helperObject.vectors[t+i],r[e],{label:r[e],onChange:()=>{this.settings[t+i]=new o.Pa4(this.helperObject.vectors[i].x,this.helperObject.vectors[i].y,this.helperObject.vectors[i].z);const e={};e[i]=this.settings[t+i],this.onChange(e)}})},this.addQuaternion=(e,t,i,s)=>{this.updateHelperObject(i,s);const n=e.addSubGroup({label:i}),r=["x","y","z","w"];for(const e in r){const s=i+r[e];n.addNumberInput(this.helperObject.quaternions[t+i],s,{label:r[e],onChange:()=>{this.settings[t+i]=new o._fP(this.helperObject.quaternions[t+i].x,this.helperObject.quaternions[t+i].y,this.helperObject.quaternions[t+i].z,this.helperObject.quaternions[t+i].w);const e={};e[i]=this.settings[t+i],this.onChange(e)}})}}}init(){}async loadGuiPackage(){return this.loadState===s.Init&&(i.e(66).then(i.t.bind(i,94810,23)).then((e=>{const t=document.createElement("div");t.id="controlKitElement",(document.getElementById("control-kit-wrapper")||document.body).appendChild(t);const i=e=>e.stopPropagation();t.addEventListener("keydown",i),t.addEventListener("keyup",i),t.addEventListener("keypress",i),this.controlKit=new e.default({opacity:.9,enable:!1,parentDomElementId:"controlKitElement"}),this.controlKit.setShortcutEnable(""),this.controlKit.enable(),this.initPromise.resolve(),this.loadState=s.Loaded})),this.loadState=s.Loading),this.loadPromise}get loadPromise(){return this.initPromise.nativePromise()}get isLoaded(){return void 0!==this.controlKit}addPanel(e,t,i={}){for(void 0===i.width&&(i.width=250),void 0===i.allowSubGroups&&(i.allowSubGroups=!0),void 0===i.ratio&&(i.ratio=60),this.lastKeysBufferLength=Math.max(this.lastKeysBufferLength,t.length);this.lastKeysBufferLength>this.lastKeys.length;)this.lastKeys.unshift(-1);return this.panels.push({index:this.panels.length,header:e,guiPanel:null,makeGuiPanel:()=>this.controlKit.addPanel({label:e,align:"right",ratio:i.ratio,width:i.width}),subGroups:[],allowSubGroups:i.allowSubGroups,activationSequence:t.reverse()}),this.panels.length-1}isVisible(e){if(!this.controlKit)throw new Error(this.uninitError);return this.panels[e].guiPanel._enabled}toggle(e){this.controlKit?this.toggleVisibility(e):this.loadGuiPackage().then((()=>{this.toggleVisibility(e)}))}onToggle(e,t){this.onToggleCallbacks[e]||(this.onToggleCallbacks[e]=[]),this.onToggleCallbacks[e].push(t)}toggleVisibility(e){if(!this.controlKit)throw new Error(this.uninitError);const t=this.panels[e].guiPanel._enabled;if(t?this.panels[e].guiPanel.disable():this.panels[e].guiPanel.enable(),this.onToggleCallbacks[e])for(const i of this.onToggleCallbacks[e])i(!t)}dispose(){const e=document.getElementById("controlKit");e&&e.remove(),this.controlKit=void 0}activate(e){window.addEventListener("keydown",this.onKeyDown)}deactivate(e){this.controlKit&&this.controlKit.disable(),window.removeEventListener("keydown",this.onKeyDown)}render(){this.controlKit&&this.updateRequired&&(this.updateRequired=!1,this.controlKit.update())}updateSetting(e,t,i){if(!this.controlKit)throw new Error(this.uninitError);const s=e+t,n=this.settings[s];i&&"function"==typeof i.equals&&"function"==typeof i.copy&&n&&"function"==typeof n.equals&&"function"==typeof n.copy?i.equals(this.settings[s])||(this.settings[s].copy(i),this.updateHelperObject(s,i),this.updateRequired=!0):i!==this.settings[e+t]&&(this.settings[s]=i,this.updateRequired=!0)}getSetting(e,t){return this.settings[e+t]}isRegistered(e,t){return void 0!==this.settings[e+t]}addControl(e,t,i,s,n,r=2,a){if(!this.controlKit)throw new Error(this.uninitError);const l=this.getSubGroup(e,t),c=`${e}${i}`;this.settings[c]=s;let h=typeof s;if(("string"===h&&"true"===s||"false"===s)&&(h="boolean"),s instanceof o.Ilk)this.addColor(l,e,i,s);else if(s instanceof o.Pa4)this.addVector3(l,e,i,s);else if(s instanceof o._fP)this.addQuaternion(l,e,i,s);else switch(h){case"string":Array.isArray(a)?(this.settings[c]={options:a,selected:s},l.addSelect(this.settings[c],"options",{target:"selected",label:i,onChange:e=>{const t={[i]:a[e]};this.onChange(t)}})):l.addStringInput(this.settings,e+i,{label:i,onChange:t=>{const s={};this.settings[e+i]=t,s[i]=this.settings[e+i],this.onChange(s)}});break;case"number":this.settings[`${e+i}_range`]=n||[0,10],l.addSlider(this.settings,e+i,`${e+i}_range`,{label:i,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)},dp:r});break;case"boolean":l.addCheckbox(this.settings,e+i,{label:i,ratio:10,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}});break;default:l.addStringOutput(this.settings,e+i,{label:i})}}addButton(e,t,i,s){if(!this.controlKit)throw new Error(this.uninitError);this.getSubGroup(e,t).addButton(i,s,{label:"none",ratio:100})}addSlider(e,t,i,s,n,o,r){if(!this.controlKit)throw new Error(this.uninitError);const a=this.getSubGroup(e,t);this.settings[e+i]=s,this.settings[e+i+"_range"]=[n,o],a.addSlider(this.settings,e+i,e+i+"_range",{label:i,dp:r,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}})}updateHelperObject(e,t){t instanceof o.Ilk?this.helperObject.colors[e]="#"+t.getHexString():t instanceof o.Pa4?(this.helperObject.vectors[e]={},this.helperObject.vectors[e].x=t.x,this.helperObject.vectors[e].y=t.y,this.helperObject.vectors[e].z=t.z):t instanceof o._fP&&(this.helperObject.quaternions[e]={},this.helperObject.quaternions[e].x=t.x,this.helperObject.quaternions[e].y=t.y,this.helperObject.quaternions[e].z=t.z,this.helperObject.quaternions[e].w=t.w)}}var c=i(54122),h=i(39936),d=i(21265);const u=new n.Z("settings");var p;!function(e){e[e.NONE=0]="NONE",e[e.LOCAL_STORAGE=1]="LOCAL_STORAGE"}(p||(p={}));class m extends c.Y{constructor(){super(...arguments),this.name="settings",this.queuedControls=[],this.queuedButtons=[],this.secretWord=[38,38,40,40,37,39,37,39,66,65,72],this.panelID=-1,this.addPanel=(e,t,i)=>{const s=this.getPanelId(e);return-1===s?this.settingsGUI.addPanel(e,t,i):s},this.getPanelId=e=>this.settingsGUI.getPanelId(e)}async init(e,t){this.engine=t,this.settings=new h.e,this.engine.market.register(this,h.e,this.settings),e.useGUI&&(this.settingsGUI=new l((e=>{this.updateSettings(e)})),t.addComponent(this,this.settingsGUI),this.panelID=this.settingsGUI.addPanel("3.1.41.12-0-g5ddcd5eba",this.secretWord));const i=(0,d.AO)();for(const t in i){let s=i[t];if("string"==typeof s){const e=Number.parseFloat(s);isNaN(e)||(s=e)}this.settings.setProperty(t,s),e.useGUI&&this.queuedControls.push({panelId:this.panelID,group:"Engine Config",settingName:t,value:s})}e.useGUI&&this.settingsGUI.loadPromise.then((()=>{for(const e of this.queuedControls)this.settingsGUI.addControl(e.panelId,e.group,e.settingName,e.value,e.range,e.rangePrecision,e.options);for(const e of this.queuedButtons)this.settingsGUI.addButton(e.panelId,e.group,e.buttonName,e.callback);this.settingsGUI.toggle(this.panelID)}))}get loadPromise(){return this.settingsGUI.loadPromise}getSettingsGui(){return this.settingsGUI}getMainPanelId(){return this.panelID}updateSetting(e,t,i=this.panelID){t&&t.clone&&"function"==typeof t.clone?this.settings.setProperty(e,t.clone()):this.settings.setProperty(e,t),this.settingsGUI&&this.settingsGUI.isLoaded&&this.settingsGUI.updateSetting(i,e,t)}updateSettings(e){for(const t in e)this.updateSetting(t,e[t])}registerSetting(e,t,i,s=!0,n=p.NONE,o,r=this.panelID,a=2,l){if(this.settingsGUI&&this.settingsGUI.isRegistered(r,t))return void u.warn(`Duplicate setting ${t} registered. Is a module being used twice?`);let c;c=i&&i.clone&&"function"==typeof i.clone?i.clone():i,this.settingsGUI&&s&&(this.settingsGUI.isLoaded?this.settingsGUI.addControl(r,e,t,c,o,a,l):this.queuedControls.push({panelId:r,group:e,settingName:t,value:i,range:o,rangePrecision:a,options:l}));const h=n===p.LOCAL_STORAGE?(0,d.fp)(t,i):i;this.updateSetting(t,h)}registerMenuEntry(e){const{header:t,setting:i,initialValue:s,persist:n,displayInUi:o,range:r,panel:a,onChange:l,rangePrecision:c,options:h}=e,d=s();return this.registerSetting(t,i,d,o,n,r,a,c,h),l?(l(d),this.settings.onPropertyChanged(i,l)):null}registerMenuButton(e){const{header:t,buttonName:i,panel:s,callback:n}=e;this.registerButton(t,i,n,s)}registerButton(e,t,i,s=this.panelID){this.settingsGUI&&(this.settingsGUI.isLoaded?this.settingsGUI.addButton(s,e,t,i):this.queuedButtons.push({panelId:s,group:e,buttonName:t,callback:i}))}hasProperty(e){return this.settings.hasProperty(e)}getProperty(e){return this.settings.getProperty(e)}tryGetProperty(e,t){return this.settings.tryGetProperty(e,t)}toggleMenu(){this.settingsGUI&&this.settingsGUI.toggle(0)}disposeGui(){this.settingsGUI.dispose()}}},60841:(e,t,i)=>{"use strict";var s;i.d(t,{E:()=>s}),function(e){e[e.Immediate=0]="Immediate",e[e.NextFrame=1]="NextFrame",e[e.Duration=2]="Duration",e[e.Manual=3]="Manual"}(s||(s={}))},64614:(e,t,i)=>{"use strict";i.d(t,{KI:()=>s,AQ:()=>a,Z8:()=>l});var s,n=i(21307),o=i(60841),r=i(70785);!function(e){e.added="added",e.removed="removed",e.updated="updated"}(s||(s={}));class a{constructor(e,t,i){this.index=e,this.action=t,this.diff=i}}class l{constructor(e,t){if(this.changedHandlers=[],this.awaitingInvoke=!1,this.diffRecord=[],this.targetMonitors={},this.triggerChangeHandlers=this.invokeChangeHandlers.bind(this),this.config=e,this.updatePhaseSync=t,this.config.aggregationType===o.E.NextFrame){if(!t)throw Error("UpdatePhaseSync required for NextFrame aggregation")}else if(this.config.aggregationType===o.E.Duration)throw Error("Aggregation Type not implemented")}hasDiffRecord(){return this.diffRecord.length>0}clearDiffRecord(){this.diffRecord=[];for(const e in this.targetMonitors){const t=this.targetMonitors[e];t.hasDiffRecord()&&t.clearDiffRecord()}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,n.b)(this.changedHandlers,e)}invokeCallbacks(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}invokeChangeHandlers(e){switch(this.config.aggregationType){case o.E.Immediate:this.invokeCallbacks(e);break;case o.E.NextFrame:this.awaitingInvoke||(this.awaitingInvoke=!0,this.updatePhaseSync.after(r.A.End).then((()=>{this.awaitingInvoke=!1,this.invokeCallbacks(e)})));break;case o.E.Manual:}}}},83083:(e,t,i)=>{"use strict";i.d(t,{c:()=>r});var s=i(64614),n=i(74403),o=i(46162);class r extends s.Z8{constructor(e,t,i){super(t,i),this.target=e;for(const s of e.keys){const o=e.get(s),r=new n.u(o,t,i);r.onChanged(this.triggerChangeHandlers),this.targetMonitors[s]=r}const r={onAdded:(e,r)=>{const a=new n.u(e,t,i);a.onChanged(this.triggerChangeHandlers),this.targetMonitors[r]=a;const l=this.diffRecord.findIndex((e=>e.index===r));-1!==l&&this.diffRecord.splice(l,1);const c=new s.AQ(r,s.KI.added,(0,o.p$)(e));-1===l&&this.diffRecord.push(c),this.triggerChangeHandlers(c)},onRemoved:(e,t)=>{delete this.targetMonitors[t];const i=this.diffRecord.findIndex((e=>e.index===t));-1!==i&&this.diffRecord.splice(i,1);const n=new s.AQ(t,s.KI.removed,(0,o.p$)(e));this.triggerChangeHandlers(n),-1===i&&this.diffRecord.push(n)}};this.target.onElementChanged(r)}commitChanges(){this.invokeCallbacks(this.getDiffRecord())}getDiffRecord(){const e=[];for(const t in this.targetMonitors){const i=this.targetMonitors[t];if(i.hasDiffRecord()){const n=i.getDiffRecord(),r=this.diffRecord.findIndex((e=>e.index===t));-1!==r?(0,o.TS)(this.diffRecord[r].diff,n):e.push(new s.AQ(t,s.KI.updated,n))}}return this.diffRecord.concat(e)}}},74403:(e,t,i)=>{"use strict";i.d(t,{u:()=>a});var s=i(60841),n=i(46162),o=i(70785),r=i(21307);class a{constructor(e,t,i){this.updatePhaseSync=i,this.target=e,this.clearDiffRecord(),this.target.onChanged((()=>{this.diffRecord=(0,n.br)(this.originalData,(0,n.p$)(this.target),t.shallow),this.handleAggregation()})),this.aggregationType=t.aggregationType,this.changedHandlers=[]}hasDiffRecord(){return Object.keys(this.diffRecord).length>0}getDiffRecord(){return this.diffRecord}clearDiffRecord(){this.originalData=(0,n.p$)(this.target),this.diffRecord={}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,r.b)(this.changedHandlers,e)}commitChanges(){this.triggerChangeHandlers(this.diffRecord)}handleAggregation(){switch(this.aggregationType){case s.E.Immediate:this.triggerChangeHandlers(this.diffRecord);break;case s.E.NextFrame:if(!this.updatePhaseSync)throw new Error("handleAggregation() -> Next frame aggregation requested, but updatePhaseSync is null");this.nextFramePromise||(this.nextFramePromise=this.updatePhaseSync.after(o.A.Begin).then((()=>{this.triggerChangeHandlers(this.diffRecord)})).finally((()=>{this.nextFramePromise=void 0})));break;case s.E.Duration:throw new Error("AggregationType.Duration: Please implement me :)");case s.E.Manual:}}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}},51874:(e,t,i)=>{"use strict";i.d(t,{y:()=>n});var s=i(57501);class n{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,s.k1)((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){n.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){n.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}static isObservable(e){return e&&e.isObservable}}},90134:(e,t,i)=>{"use strict";i.d(t,{d:()=>o,C:()=>r});var s=i(51874),n=i(46162);class o extends s.y{constructor(){super(),this.isObservableArray=!0,this.elements=[]}push(e){return this.elements.push(e),this.addChildObservable(e),this.setDirty(),this.length}concat(e){const t=this.elements.length;this.elements=this.elements.concat(e);for(let e=t;e<this.elements.length;e++)this.addChildObservable(this.elements[e]);return this.setDirty(),this.length}replace(e){for(const e of this.elements)this.removeChildObservables(e);return this.elements=[],this.concat(e)}remove(e){if(e<0||e>=this.length)throw new Error(`Index ${e} not in range of ObservableArray`);const[t]=this.elements.splice(e,1);this.removeChildObservables(t),this.setDirty()}update(e,t){const i=this.elements[e];i!==t&&(this.elements[e]=t,this.removeChildObservables(i),this.addChildObservable(t),this.setDirty())}get length(){return this.elements.length}set length(e){if(e<this.elements.length){for(let t=this.elements.length-1;t>=e;t--){const e=this.elements[t];this.removeChildObservables(e)}this.elements.length=e,this.setDirty()}}values(){return[...this.elements]}filter(e){return this.elements.filter(e)}find(e){return this.elements.find(e)}*[Symbol.iterator](){for(const e of this.elements)yield e}map(e){return this.elements.map(e)}forEach(e){this.elements.forEach(e)}get(e){return this.elements[e]}findIndex(e){return this.elements.findIndex(e)}indexOf(e){return this.elements.indexOf(e)}splice(e,t,...i){let s;if(i.length){s=this.elements.splice(e,t,...i);for(const e of i)this.addChildObservable(e)}else s=this.elements.splice(e,t);for(const e of s)this.removeChildObservables(e);return this.setDirty(),s}insert(e,t){if(e>this.elements.length)throw new Error(`Tried to insert at index ${e} in an array that's only ${this.elements.length} long`);e!==this.elements.length?(this.elements.splice(e,0,t),this.addChildObservable(t),this.setDirty()):this.push(t)}shift(){const e=this.elements.shift();return e&&(this.removeChildObservables(e),this.setDirty()),e}move(e,t){if(t>this.elements.length-1)throw Error("Index to move to is out of bounds");const i=this.elements[e];this.elements.splice(e,1),this.elements.splice(t,0,i),this.setDirty()}onElementChanged(e){let t=this.elements.slice();return this.onChanged((()=>{for(const i in t){const s=parseInt(i,10);e.onRemoved&&void 0===this.get(s)&&e.onRemoved(t[s],s)}for(const i in this.elements){const n=parseInt(i,10),o=this.get(n);void 0===t[n]?e.onAdded&&e.onAdded(o,n):(s.y.isObservable(o)&&o._dirtyObservable||o!==t[n])&&(e.onUpdated?e.onUpdated(o,n):e.onRemoved&&null===o&&e.onRemoved(t[n],n))}t=this.elements.slice()}))}deepCopy(){return this.map((e=>(0,n.p$)(e)))}}const r=e=>{const t=new o;return e&&t.concat(e),t}},71229:(e,t,i)=>{"use strict";i.d(t,{v:()=>r,q:()=>a});var s=i(51874),n=i(46162);function o(e){return(0,n.hj)(e)?""+e:e}class r extends s.y{constructor(){super(),this.map={},this._keysSet=new Set,this._keysList=[]}get keys(){return this._keysList.slice()}get values(){return this._keysList.map((e=>this.get(e)))}entries(){const e=[];for(const t in this.map)e.push([t,this.map[t]]);return e}get length(){return this._keysList.length}*[Symbol.iterator](){for(const e of this._keysList)yield this.get(e)}get(e){return this.map[e]}has(e){return void 0!==this.map[e]}set(e,t){e=o(e),this.map[e]!==t&&(this.removeChildObservables(this.map[e]),this.addChildObservable(t),this.map[e]=t,this._keysSet.has(e)||(this._keysList.push(e),this._keysSet.add(e)),this.setDirty())}delete(e){e=o(e),this.removeChildObservables(this.map[e]);const t=this.map.hasOwnProperty(e);return delete this.map[e],t&&(this._keysSet.delete(e),this._keysList.splice(this._keysList.indexOf(e),1),this.setDirty()),t}onElementChanged(e){let t=Object.assign({},this.map);return this.onChanged((()=>{for(const i in t)e.onRemoved&&!this.has(i)&&e.onRemoved(t[i],i);for(const i of this._keysList){const n=this.get(i);void 0===t[i]?e.onAdded&&e.onAdded(n,i):(s.y.isObservable(n)&&n._dirtyObservable||n!==t[i])&&(e.onUpdated&&null!==n?e.onUpdated(n,i):e.onRemoved&&null===n&&e.onRemoved(t[i],i))}t=Object.assign({},this.map)}))}deepCopy(){const e={};for(const t of this._keysList)e[t]=(0,n.p$)(this.map[t]);return e}}const a=(e={})=>{const t=new r;for(const i in e)t.set(i,e[i]);return t}},78909:(e,t,i)=>{"use strict";i.d(t,{T:()=>h});var s=i(51874),n=i(46162),o=i(21265),r=i(25799),a=i(57501);const l=new r.Z("ObservableObject"),c=1===(0,o.hu)("debug",0);class h extends s.y{constructor(){super(),this._propertyObservables={},this._valueCache={},this._dirtyKeys=new Set,Object.defineProperties(this,{_propertyObservables:{value:this._propertyObservables,writable:!1,enumerable:!1},_valueCache:{value:this._valueCache,writable:!1,enumerable:!1},_dirtyKeys:{value:this._dirtyKeys,writable:!1,enumerable:!1}}),c&&setTimeout((()=>{!function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i],e._valueCache[i]=e[i],Object.defineProperty(e,i,{get:()=>t[i],set:n=>{const o=e._valueCache[i];(o!==n||s.y.isObservable(o)&&o._dirtyObservable)&&u(e,i),t[i]=n},enumerable:!0}))}(this)}),1)}onPropertyChanged(e,t){if(this._propertyObservables[e]||(this._propertyObservables[e]=[]),-1!==this._propertyObservables[e].indexOf(t))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,a.k1)((()=>this._propertyObservables[e].push(t)),(()=>this.removeOnPropertyChanged(e,t)),!0,e)}removeOnPropertyChanged(e,t){const i=this._propertyObservables[e].indexOf(t);i>=0&&this._propertyObservables[e].splice(i,1)}commit(e=[]){for(const t of e)this._dirtyKeys.add(t);this.setDirtyUp(),this.notifyUp()}setDirtyUp(){for(const e in this){if(!this.hasOwnProperty(e))continue;const t=this._valueCache[e],i=this[e],n=typeof i,o="undefined"===n||"string"===n||"number"===n||"boolean"===n||null===i;if(this._propertyObservables[e]&&!o&&!s.y.isObservable(i))throw new Error(`Property ${e} has property listeners, but has a value that is not observable or a primitive!`);t!==i?(this.removeChildObservables(t),this.addChildObservable(i),this._valueCache[e]=i,this._dirtyKeys.add(e)):s.y.isObservable(t)&&t._dirtyObservable&&this._dirtyKeys.add(e)}super.setDirtyUp()}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._dirtyKeys){for(const t of this._propertyObservables[e]||[])this.notifyPropertyObserver(t,e);c&&p(this,e)}this._observerNotifying=!1,this._dirtyKeys.clear()}super.notifyObservers()}notifyPropertyObserver(e,t){e(this._valueCache[t])}notifyObserver(e){e(this)}deepCopy(){const e={};for(const t in this)this.hasOwnProperty(t)&&(e[t]=(0,n.p$)(this[t]));return e}}const d=new Map;function u(e,t){d.has(e)||d.set(e,{}),d.get(e)[t]=Error()}function p(e,t){if(d.has(e)){const i=d.get(e);i[t]&&delete i[t]}}if(c){const e=setInterval((()=>{(function(){for(const e of d.values())for(const t in e)return l.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),l.error("See stack trace of the property write below:"),l.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}},5442:(e,t,i)=>{"use strict";i.d(t,{f:()=>o,Y:()=>r});var s=i(51874),n=i(46162);class o extends s.y{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return(0,n.p$)(this._value)}}const r=e=>new o(e)},23812:(e,t,i)=>{"use strict";i.d(t,{$:()=>s});class s{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}},80994:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});class s{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!t)return null;const i={};for(const s in e){const n=t.serialize(e[s]);n&&(i[s]=n)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!t)return{};const i={};for(const s in e){const n=t.deserialize(e[s]);n&&(i[s]=n)}return i}}},53999:(e,t,i)=>{"use strict";i.d(t,{V:()=>s});class s{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}},57501:(e,t,i)=>{"use strict";i.d(t,{gm:()=>n,ne:()=>o,k1:()=>a});const s=new(i(25799).Z)("Subscription");class n{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){return new r((()=>this.registerSubscription(e)),(()=>this.unregisterSubscription(e)),t)}getData(){return this.watchedData()}}class o{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){const i=()=>e(this.watchedData());return new r((()=>this.registerSubscription(i)),(()=>this.unregisterSubscription(i)),t)}getData(){return this.watchedData()}}class r{constructor(e,t,i=!1,s=""){this.startSubscription=e,this.endSubscription=t,this.id=s,this.isSubbed=!1,i&&this.renew()}renew(){this.isSubbed?s.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed?(this.endSubscription(),this.isSubbed=!1):s.debugWarn(`Duplicate subscription cancel ${this.id}`)}get active(){return this.isSubbed}}function a(e,t,i=!0,s=""){return new r(e,t,i,s)}},46162:(e,t,i)=>{"use strict";i.d(t,{p$:()=>n,TS:()=>o,br:()=>r,NK:()=>a,hj:()=>l});const s=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,n=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const i=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const o in e){if(s(o))continue;const r=e[o];r instanceof Date?i[o]=new Date(r):"function"!=typeof r&&(i[o]="object"==typeof r?n(r,t.concat(e)):r)}return i}return e}},o=(e,t)=>{for(const i in t){if("function"==typeof t[i])continue;if(s(i)&&!e.hasOwnProperty(i))continue;const r=t[i];if(e.hasOwnProperty(i)){const t=e[i];(null===t?null:typeof t)!==(null===r?null:typeof r)?e[i]=n(r):"object"==typeof t?t instanceof Date?e[i]=new Date(r):o(t,r):e[i]=r}else e[i]=n(r)}},r=(e,t,i=!1)=>{const s={};for(const n in e){const o=e[n],l=t[n];a(o,l)&&(void 0===o||void 0===l||typeof o!=typeof l||"object"!=typeof o?s[n]=l:Array.isArray(l)?a(o,l)&&(s[n]=l):s[n]=i?l:r(o,l))}for(const i in t)i in e||(s[i]=t[i]);return s},a=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const i in t)if(!(i in e))return!0;for(const i in e)if(a(e[i],t[i]))return!0;return!1};function l(e){return"number"==typeof e}},51090:(e,t,i)=>{"use strict";var s;i.d(t,{h:()=>s}),function(e){e.NOTE="note",e.COMMENT="comment",e.MATTERTAG="mattertag"}(s||(s={}))},61956:(e,t,i)=>{"use strict";i.d(t,{I:()=>n});var s=i(2212);class n{}n.MP_BRAND=new s.Ilk("rgb(255, 49, 88)"),n.MATTERTAG_BLUE=new s.Ilk("rgb(3, 104, 125)"),n.WHITE=new s.Ilk("rgb(255, 255, 255)"),n.BLACK=new s.Ilk("rgb(0, 0, 0)")},37024:(e,t,i)=>{"use strict";var s;i.d(t,{Z:()=>n}),function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.ForceQueued=2]="ForceQueued",e[e.Downloading=3]="Downloading",e[e.Downloaded=4]="Downloaded",e[e.DownloadFailed=5]="DownloadFailed"}(s||(s={}));const n=s},64630:(e,t,i)=>{"use strict";var s;i.d(t,{Z:()=>n}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(s||(s={}));const n=s},20599:(e,t,i)=>{"use strict";var s;i.d(t,{z:()=>s}),function(e){e[e.boundingSkybox=-100]="boundingSkybox",e[e.default=0]="default",e[e.ghostFloor=3]="ghostFloor",e[e.panoMarker=4]="panoMarker",e[e.reticule=5]="reticule",e[e.grid=5]="grid",e[e.pins360=6]="pins360",e[e.portals=9]="portals",e[e.rotators=10]="rotators",e[e.pins=14]="pins",e[e.pinSelectedHalo=15]="pinSelectedHalo",e[e.lines=20]="lines",e[e.endpoints=21]="endpoints",e[e.labels=22]="labels",e[e.colorOverlay=1e3]="colorOverlay"}(s||(s={}))},74674:(e,t,i)=>{"use strict";var s;i.d(t,{C:()=>s}),function(e){e.TEXT="text",e.LINK="link",e.HASH="hash",e.USER="user"}(s||(s={}))},27829:(e,t,i)=>{"use strict";i.d(t,{f:()=>o,e:()=>s});var s,n=i(2212);class o{}o.UP=new n.Pa4(0,1,0),o.DOWN=new n.Pa4(0,-1,0),o.LEFT=new n.Pa4(-1,0,0),o.RIGHT=new n.Pa4(1,0,0),o.FORWARD=new n.Pa4(0,0,-1),o.BACK=new n.Pa4(0,0,1),o.ZERO=new n.Pa4(0,0,0),o.UNIT=new n.Pa4(1,1,1),o.HORIZONTAL_PLANE=new n.Pa4(1,0,1),function(e){e.NONE="NONE",e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.FORWARD="FORWARD",e.BACK="BACK",e.ZERO="ZERO",e.UNIT="UNIT",e.HORIZONTAL_PLANE="HORIZONTAL_PLANE"}(s||(s={}))},17617:(e,t,i)=>{"use strict";i.d(t,{y:()=>s});class s extends Error{constructor(e){super(e),this.name="BaseException",Object.setPrototypeOf(this,new.target.prototype)}}},83852:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(17617);class n extends s.y{constructor(e="Not implemented"){super(e),this.name="NotImplemented"}}},31260:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(17617);class n extends s.y{constructor(e="Out of range"){super(e),this.name="OutOfRangeException"}}},7943:(e,t,i)=>{"use strict";i.d(t,{S:()=>s});var s,n,o=i(67125);!function(e){e.sessionObjectExtract=function(e,t){return i=>t(i?i[e]:null)},e.sessionObjectMap=function(e,t,i){return s=>i(s?{[t]:s[e]}:null)},e.sessionCollectionMap=function(e,t){return i=>{if(i){const s={},n=i[e];if(!(n&&n instanceof Array))return t(null);for(const e of n){if(!e.sid){let t;do{t=(0,o.f)(11)}while(n.find((e=>e.sid===t)));e.sid=t}s[e.sid]=e}return t(s)}return t(null)}}}(s||(s={})),function(e){e.sessionObjectMap=function(e,t,i){return(s,n)=>{const o=i(s,n);return o?{[t]:o[e]}:null}}}(n||(n={}))},15119:(e,t,i)=>{"use strict";i.d(t,{j:()=>o,Z:()=>r});var s=i(80034);const n=new(i(25799).Z)("session");var o;!function(e){e.WS3_Config="WS3_Config",e.WS3_Sweeps="WS3_Sweeps",e.WS3_Measurements="WS3_Measurements",e.Blurs="Blurs",e.Model="Model",e.FloorNames="FloorNames",e.Sweeps="Sweeps",e.Highlights="Highlights",e.Labels="Labels",e.Mattertags="Mattertags"}(o||(o={}));class r extends s.yh{constructor(e,t){super(e),this.config=e,this.sessionKey=t}async create(e){throw Error("Not implemented")}async update(e,t){const{serialize:i}=this.config,o=i(e,t);if(!o)return void n.info("not updating",{data:e,diff:t,newData:o});this.config.cachedData||(this.config.cachedData={data:{}}),this.config.cachedData.data||(this.config.cachedData.data={}),this.config.cachedData.data[this.sessionKey]||(this.config.cachedData.data[this.sessionKey]={}),this.config.cachedData.data[this.sessionKey]=o;const r=Object.assign(Object.assign({},this.options),{body:this.config.cachedData.data[this.sessionKey]});return this.config.queue.request(this.config.httpMethod||s.w$.POST,`${this.config.path}/${this.sessionKey}`,r)}async delete(e){this.config.cachedData&&this.config.cachedData.data&&(this.config.cachedData.data[this.sessionKey]={});const t=Object.assign(Object.assign({},this.options),{responseType:""});return this.config.queue.delete(`${this.config.path}/${this.sessionKey}`,t)}}},11340:(e,t,i)=>{"use strict";i.d(t,{o:()=>m});var s=i(71439),n=i(70655),o=i(81707),r=i(80496),a=i(51770),l=i(26149),c=i(25799),h=i(90778),d=i(17617);class u extends d.y{constructor(e="MDS Exception"){super(e),this.name="MdsException"}}const p=new c.Z("model-api-client");class m{constructor(e={}){const t=e.baseUrl||window.location.origin;this.graphUrl=e.url||`${t}/api/mp/models/graph`,p.debug(`Initialized Model API client for ${this.graphUrl}`);const i=(0,s.createHttpLink)({uri:this.graphUrl}),a=(c=(e,{headers:t})=>{const i=(0,l.PW)(this.graphUrl);return{headers:Object.assign(Object.assign({},t),{authorization:i})}},new o.i0((function(e,t){var i=(0,n._T)(e,[]);return new r.y$((function(s){var n;return Promise.resolve(i).then((function(t){return c(0,e.getContext())})).then(e.setContext).then((function(){n=t(e).subscribe({next:s.next.bind(s),error:s.error.bind(s),complete:s.complete.bind(s)})})).catch(s.error.bind(s)),function(){n&&n.unsubscribe()}}))})));var c;this.client=new s.fe({link:a.concat(i),cache:new s.h4})}async query(e,t,i={}){const s=Object.assign(Object.assign({errorPolicy:"all",fetchPolicy:"no-cache"},i),{query:e,variables:t});return this.client.query(s).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new u}))}async mutate(e,t,i={}){const s=Object.assign(Object.assign({errorPolicy:"all"},i),{mutation:e,variables:t});return this.client.mutate(s).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new u}))}async upload(e,t,i){const s={};let n=0;(0,a.yW)(i,((e,t,i)=>{if(e&&(o=e).filename&&o.blob&&o.blob instanceof Blob){const o="file"+n++;s[o]=e,i[t]=`multipart:${o}`}var o}));const o=new FormData;o.append("query",(0,h.S)(e)),o.append("operation",t),o.append("variables",JSON.stringify(i));for(const[e,t]of Object.entries(s))o.append(e,t.blob,t.filename);const r=await fetch(this.graphUrl,{method:"POST",body:o});try{return r.json()}catch(e){throw p.error(e),new u("Could not upload to MDS")}}}m.version="2020.05.28"},41964:(e,t,i)=>{"use strict";var s;i.d(t,{L:()=>s}),function(e){e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(s||(s={}))},19673:(e,t,i)=>{"use strict";var s;i.d(t,{Y:()=>s}),function(e){e.LEFT="left",e.RIGHT="right",e.AUTO="auto"}(s||(s={}))},99555:(e,t,i)=>{"use strict";var s;i.d(t,{b:()=>s}),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s||(s={}))},60268:(e,t,i)=>{"use strict";var s;i.d(t,{B:()=>s}),function(e){e.PHOTO2D="photo2D",e.EQUIRECTANGULAR="equirectangular"}(s||(s={}))},62749:(e,t,i)=>{"use strict";var s;i.d(t,{w:()=>s}),function(e){e.PANORAMA="panorama",e.FLOORPLAN="floorplan",e.DOLLHOUSE="dollhouse",e.MESH="mesh"}(s||(s={}))},17423:(e,t,i)=>{"use strict";var s;i.d(t,{K:()=>s}),function(e){e.Segment="segment",e.Logging="logging",e.Matterport="mp"}(s||(s={}))},58931:(e,t,i)=>{"use strict";i.d(t,{H:()=>u});var s=i(17423),n=i(25799);const o=new n.Z("segment"),r=new n.Z("log-analytics");var a=i(62367),l=i(32020),c=i(21265);const h=new n.Z("mp-analytics"),d="sc_anonymous_id",u={[s.K.Segment]:{class:class{constructor(e){this.token=e,this.endpointType=s.K.Segment}init(e,t){return this.options=e,this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(s,n),e._loadOptions=i},e.SNIPPET_VERSION="4.1.0"}}(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email})}track(e,t){n.Z.level>=3&&o.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);try{window.analytics.track(e,t,this.context)}catch(t){o.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){o.error("Failed to send async segment request")}}},key:"segment_key",url:null},[s.K.Logging]:{class:class{init(e,t){return r.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){r.debug("identify as",e)}track(e,t){r.debug({eventName:e,data:t})}trackAsync(e,t){r.debug({eventName:e,data:t})}},key:null,url:null},[s.K.Matterport]:{class:class{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.segmentStylePayload=(e,t,i)=>({timestamp:(0,l.U)(new Date),integrations:{},context:this.segmentStyleContext(i),properties:t,event:e,messageId:(0,a.DM)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(0,l.U)(new Date)}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:window.document.referrer,search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const s=(0,c.fp)(d);if(s)this.anonymousId=s;else{const e=(0,c.$K)("ajs_anonymous_id");this.anonymousId=e?e.replace(/%22/g,""):(0,a.DM)(),(0,c.m8)(d,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.options=e,this.context=t,h.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){h.debug("identify as",e),this.user=e}track(e,t){n.Z.level>=3&&h.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const i=this.segmentStylePayload(e,t,this.context);this.queue.post(this.url,{body:i,headers:this.headers})}trackAsync(e,t){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const i=this.segmentStylePayload(e,t,this.context);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(i))}catch(e){h.error("Failed to sendBeacon analytics request")}}},key:"analytics_mp_key",url:"analytics_mp_url"}}},13931:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>r,default:()=>a});var s=i(58931),n=i(54122),o=i(62367);class r extends n.Y{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.track=(e,t)=>this.loaded?(0,o.gw)(0).then((()=>{this.endpoints.forEach((i=>{i.track(e,t)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve()),this.trackAsync=(e,t)=>{this.loaded?this.endpoints.forEach((i=>{i.trackAsync(e,t)})):this.bufferedData.push({event:e,data:t})}}async load(e,t,i,n,o){this.loaded=!1;for(const r of e){const{provider:e,token:a,url:l}=r;if(void 0===s.H[e])continue;const c=new(0,s.H[e].class)(a,l,t);await c.init(i,n),o&&o.loggedIn&&c.identify(o),this.endpoints.push(c),this.loaded=!0}return this.loaded&&this.flushBufferedData(),this.loaded}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data)}));this.bufferedData.length=0}}const a=r},90991:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var s=i(19413),n=i(5442);class o extends s.V{constructor(){super(),this.name="annotations-view-data",this.listIndexObservable=(0,n.Y)(-1),this.searchBlockObservable=(0,n.Y)(null)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setSearchBlock(e){this.searchBlockObservable.value=e}get searchBlock(){return this.searchBlockObservable.value}onSearchBlockChanged(e){return this.searchBlockObservable.onChanged(e)}}},43098:(e,t,i)=>{"use strict";i.d(t,{R:()=>n,B:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={searchBlock:e}}}class o extends s.m{constructor(){super()}}},32052:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnnotationSearchCommand:()=>a.R,AnnotationSearchToggledMessage:()=>o,AnnotationsViewData:()=>r.A,CancelAnnotationSearchCommand:()=>a.B,default:()=>c});var s=i(54122),n=i(93528);class o extends n.v{constructor(e){super(),this.searching=e}}var r=i(90991),a=i(43098);class l extends s.Y{constructor(){super(...arguments),this.name="annotations",this.cancelSearch=async()=>{this.viewData.searchBlock&&(this.viewData.setSearchBlock(null),this.engine.broadcast(new o(!0)))},this.searchAnnotations=async e=>{const t=e.searchBlock;this.viewData.setSearchBlock(t),this.engine.broadcast(new o(!0))}}async init(e,t){this.viewData=new r.A,this.engine=t,t.market.register(this,r.A,this.viewData),this.bindings.push(t.commandBinder.addBinding(a.R,this.searchAnnotations),t.commandBinder.addBinding(a.B,this.cancelSearch))}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.cancelSearch(),super.dispose(e)}onUpdate(){}}const c=l},68399:(e,t,i)=>{"use strict";var s;i.d(t,{X:()=>s}),function(e){e.ACCESS_TOKEN_REQUIRED="object.access.token.required",e.FORBIDDEN="spaces.public.access.password.forbidden",e.INVALID_PASSWORD="spaces.public.access.invalid_password",e.TOO_MANY_ATTEMPTS="spaces.public.access.too_many_attempts",e.UNAUTHORIZED="user.unauthorized"}(s||(s={}))},1143:(e,t,i)=>{"use strict";i.d(t,{Ad:()=>n,iF:()=>o,O7:()=>r});let s=null;const n=e=>{s=e.applicationKey},o=e=>{s&&(e.headers||(e.headers={}),r(e.headers))},r=e=>{s&&(e["x-matterport-application-key"]=s)}},17882:(e,t,i)=>{"use strict";var s;i.d(t,{s:()=>s}),function(e){e.INVALID_CREDENTIALS="invalidcredentials",e.TOO_MANY_ATTEMPTS="toomanyattempts",e.UNKNOWN="unknown"}(s||(s={}))},33886:(e,t,i)=>{"use strict";i.d(t,{L:()=>c});var s=i(25799),n=i(17882),o=i(68399),r=i(22135),a=i(1143);const l=new s.Z("mp-password-authentication");class c{constructor(e=window.location.origin){this.baseUrl=e,this.errorType=n.s.UNKNOWN}async authenticate(e,t){if(!e.match(/[a-zA-Z0-9]+/))return l.error(`Invalid Model ID ${e}`),!1;const i=`${this.baseUrl}/api/v2/models/${e}/public-access/`;return this.fetchToken(i,t).then((async e=>{let t={};return e&&(t=await e.json(),e.ok&&t.token)?(this.login(t.token),!0):(this.errorType=c.getErrorType(t.code),this.logout(),!1)}))}isAuthenticated(){return void 0!==c.token}login(e){c.token=e}logout(){c.token=void 0}getAuthorizationHeader(e){return e&&r.b.some((t=>t.test(e)))&&c.token?`Matterport-Object-Access ${c.token}`:""}async fetchToken(e,t){const i=JSON.stringify({password:t}),s={"Content-Type":"application/json"};return(0,a.O7)(s),fetch(e,{method:"POST",cache:"no-cache",headers:s,body:i})}static getErrorType(e){switch(e){case o.X.TOO_MANY_ATTEMPTS:return n.s.TOO_MANY_ATTEMPTS;case o.X.INVALID_PASSWORD:return n.s.INVALID_CREDENTIALS}return n.s.UNKNOWN}}},26149:(e,t,i)=>{"use strict";i.d(t,{PW:()=>n});var s=i(22135);const n=(e,t=s.F)=>t.map((t=>t.getAuthorizationHeader(e))).find(Boolean)||""},22135:(e,t,i)=>{"use strict";i.d(t,{F:()=>r,b:()=>a});var s=i(33886),n=i(21265);class o{constructor(){const e=(0,n.hu)("auth","");this.authenticate(e)}isAuthenticated(){return!!o.token}authenticate(e){return!(!e||"string"!=typeof e||(o.token=e.replace(","," "),0))}getAuthorizationHeader(e){return o.token?o.token:""}}const r=[new o,new s.L],a=[/^https?:\/\/localhost(:[0-9]+)?\/api/,/^https?:\/\/[^\/]*\.matterport.com\/api/]},87131:(e,t,i)=>{"use strict";var s,n;i.d(t,{SL:()=>s,AB:()=>n,eE:()=>o,Qf:()=>r}),function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(s||(s={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(n||(n={}));const o={[s.BASE]:n.BASE,[s.STANDARD]:n.STANDARD,[s.HIGH]:n.HIGH,[s.ULTRAHIGH]:n.ULTRAHIGH},r={[n.BASE]:s.BASE,[n.STANDARD]:s.STANDARD,[n.HIGH]:s.HIGH,[n.ULTRAHIGH]:s.ULTRAHIGH}},41446:(e,t,i)=>{"use strict";i.d(t,{m:()=>r});var s=i(64630),n=i(31260);const o={0:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},r=e=>{if(e<0||e>5)throw new n.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return o[e]}},62431:(e,t,i)=>{"use strict";i.d(t,{af:()=>c,Mc:()=>s,gx:()=>n});var s,n,o=i(19413),r=i(78909),a=i(78383),l=i(19334);class c extends o.V{constructor(e={}){super(),this.name="player-options",this.options=new h(e)}resetDefaultTourOptions(){this.options.fast_transitions=l.LI,this.options.transition_speed=l.p$,this.options.transition_time=l.rd,this.options.pan_speed=l.tu,this.options.dollhouse_pan_speed=l.nr,this.options.zoom_duration=l.we,this.options.pan_angle=l.Cj,this.options.pan_direction=l.y6,this.options.commit()}}class h extends r.T{constructor(e){super(),this.presented_by=!1,this.highlight_reel=!0,this.floor_plan=!0,this.tour_buttons=!0,this.labels=!0,this.labels_dh=!0,this.floor_select=!0,this.measurements=!0,this.measurements_saved=!0,this.dollhouse=!0,this.contact_email=!1,this.address=!1,this.contact_name=!1,this.model_summary=!1,this.contact_phone=!1,this.model_name=!1,this.external_url=!1,this.unit_type=s.USFractional,this.background_color=a.z.default,this.fast_transitions=l.LI,this.transition_speed=l.p$,this.transition_time=l.rd,this.pan_speed=l.tu,this.dollhouse_pan_speed=l.nr,this.zoom_duration=l.we,this.pan_angle=l.Cj,this.pan_direction=l.y6,e&&this.copy(e)}copy(e){this.presented_by=!!e.presented_by,this.highlight_reel=!!e.highlight_reel,this.floor_plan=!!e.floor_plan,this.tour_buttons=!!e.tour_buttons,this.labels=!!e.labels,this.dollhouse=!!e.dollhouse,this.fast_transitions=!!e.fast_transitions,this.contact_email=!!e.contact_email,this.address=!!e.address,this.contact_name=!!e.contact_name,this.model_summary=!!e.model_summary,this.contact_phone=!!e.contact_phone,this.model_name=!!e.model_name,this.external_url=!!e.external_url,void 0!==e.measurements&&(this.measurements=e.measurements),void 0!==e.labels_dh&&(this.labels_dh=e.labels_dh),void 0!==e.floor_select&&(this.floor_select=e.floor_select),void 0!==e.measurements_saved&&(this.measurements_saved=e.measurements_saved),void 0!==e.unit_type&&(this.unit_type=e.unit_type),void 0!==e.background_color&&void 0!==a.z[e.background_color]&&(this.background_color=e.background_color),void 0!==e.transition_speed&&(this.transition_speed=e.transition_speed),void 0!==e.transition_time&&(this.transition_time=e.transition_time),void 0!==e.pan_speed&&(this.pan_speed=e.pan_speed),void 0!==e.dollhouse_pan_speed&&(this.dollhouse_pan_speed=e.dollhouse_pan_speed),void 0!==e.zoom_duration&&(this.zoom_duration=e.zoom_duration),void 0!==e.pan_angle&&(this.pan_angle=e.pan_angle),void 0!==e.pan_direction&&(this.pan_direction=e.pan_direction)}}!function(e){e.USFractional="imperial",e.Metric="metric"}(s||(s={})),function(e){e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color"}(n||(n={}))},5587:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(2212),n=i(25799),o=i(87131),r=i(62367);const a=new n.Z("api"),l={[o.SL.BASE]:256,[o.SL.STANDARD]:1024,[o.SL.HIGH]:2048,[o.SL.ULTRAHIGH]:4096};class c{constructor(e){this.urls=e,this.sweepCubeTextures={}}useTexture(e){const t=this.getTexture(e);if(!t)throw Error(`Texture for sweep ${e} not loaded before using`);return t}loadFace(e,t,i,n){return this.loadFaceImage(e,t,i,n).then((e=>{const t=new s.xEZ(e);return t.needsUpdate=!0,t}))}load(e,t=o.SL.STANDARD){const i=this.sweepCubeTextures[e.id];if(i)return a.debug("Skipping load of pano, already loaded"),new Promise((function(e,t){e(i)}));const n=[2,4,0,5,1,3].map((i=>this.loadFaceImage(e,t,i))),r=Promise.all(n).then((t=>{const i=new s.BtG(t);return i.flipY=!1,i.needsUpdate=!0,this.sweepCubeTextures[e.id]=i,i}));return r.catch((()=>{a.error(`Downloading cubemap for pano ${e.id} failed`)})),r}unload(e){const t=this.sweepCubeTextures[e];if(!t)throw Error(`Texture for sweep ${e} not loaded before unloading`);t.dispose(),this.sweepCubeTextures[e]=null}unloadAll(e){const t=(0,r.ow)(e);for(const e of Object.keys(this.sweepCubeTextures))this.sweepCubeTextures[e]&&!t[e]&&this.unload(e)}async loadFaceImage(e,t,i,s){const n=l[t],o=await e.getFaceUrl(t,i);return this.urls.getImageBitmap(o,n,n,s)}getTexture(e){return this.sweepCubeTextures[e]}}},78383:(e,t,i)=>{"use strict";i.d(t,{K:()=>n,z:()=>o});const s={bgPrimary:"#0F1011",bgSecondary:"#1e2023",gridPrimary:"#2d3035",gridSecondary:"#171a1c"},n={black:s,grey:{bgPrimary:"#c9cbcc",bgSecondary:"#9d9d9e",gridPrimary:"#c9cbcc",gridSecondary:"#b0b1b1"},white:{bgPrimary:"#fcfdff",bgSecondary:"#ced0d3",gridPrimary:"#fcfdff",gridSecondary:"#e2e3e5"},default:s};var o;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(o||(o={}))},76598:(e,t,i)=>{"use strict";i.d(t,{GT:()=>o,V2:()=>r,TR:()=>a});var s=i(17617);class n extends s.y{constructor(e="Api Exception"){super(e),this.name="ApiException"}}class o extends n{constructor(e="Unauthorized"){super(e),this.name="Unauthorized"}}class r extends n{constructor(e="Forbidden"){super(e),this.name="Forbidden"}}class a extends n{constructor(e="Not Found"){super(e),this.name="NotFound"}}},7839:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(20331);async function n(e){return e.get("https://static.matterport.com/geoip/",{responseType:"json",priority:s.ru.LOW})}},63418:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var s=i(25799),n=i(44266),o=i(20331),r=i(68399),a=i(1143),l=i(26149),c=i(76598);class h{constructor(e){e&&Object.assign(this,e)}}class d{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var u=i(21265);class p{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,u.hu)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const s=i.replace(e,"");t.add(s)}})),t}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}var m=i(7839);const g=new s.Z("api"),f=Object.freeze({cacheClearTimeout:6e4,retryTimeout:1e3});class v{constructor(e,t={},i=window.location.origin){this.prefetchedData=t,this.baseUrl=i,this._configCache={},this._userCache={},this._organizationCache={},e||(e=new o.gO({retries:0})),this.queue=e,setTimeout((()=>{this.prefetchedData={}}),f.cacheClearTimeout)}async init(e){const t=[this.getUser().then((e=>this.user=e))];e&&t.push(this.getConfigs(e)),await Promise.all(t)}get(e,t){if(t&&t.prefetchFrom&&this.prefetchedData[t.prefetchFrom])return Promise.resolve(this.prefetchedData[t.prefetchFrom]);const i=this.addAuthToOptions(t,e);return(0,a.iF)(i),this.queue.get(e,i).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e}))}addAuthToOptions(e,t){return this.authToken||(this.authToken=(0,l.PW)(t)),Object.assign(Object.assign({},e),{auth:this.authToken})}getImage(e,t){return this.get(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,s={}){if("createImageBitmap"in window){const n=-1!==e.indexOf("?"),o=e+(n?"&":"?")+"imgopt=1",r=await this.get(o,Object.assign(Object.assign({},s),{responseType:"blob"}));return createImageBitmap(r,0,0,t,i,{imageOrientation:s.flipY?"flipY":"none"})}return this.getImage(e,s)}getImageViaBrowser(e,t=3){const i=new n.Q,s=new Image,o=this,r=()=>{o.getImageViaBrowser(e,t-1).then(i.resolve.bind(i)).progress(i.notify.bind(i)).catch(i.reject.bind(i))};return s.onerror=function(){t>0?setTimeout(r,1e3):i.reject()},s.onload=function(){i.resolve(s)},s.crossOrigin="anonymous",s.src=e,i.promise()}async getConfigs(e,t){if(e=e.toLowerCase(),!t&&this._configCache[e])return this._configCache[e];const i=t?{responseType:"json"}:{responseType:"json",prefetchFrom:"config"};let s={};const n=this.baseUrl+`/api/v1/config/${e}`;try{s=await this.get(n,i)}catch(e){g.warn(`Failed to load config from ${n}, ignoring`)}return t||(this._configCache[e]=s),s||{}}async getAppKey(e,t,i){if(""===e||""===t)return null;const s=await this.getConfigs(e,i);return s.hasOwnProperty(t)?s[t]:null}async getGeoIpLocation(){return(0,m.Z)(this.queue)}async modelExists(e,t={ignorePrefetch:!1}){if(e.length>20)return Promise.resolve(!0);const{ignorePrefetch:i}=t;if(!i&&this.prefetchedData&&this.prefetchedData.model){const{model:t}=this.prefetchedData;if(!t.sid&&t.has_public_access_password)throw new c.GT("Model requires a password");return t.sid===e}const s=`${this.baseUrl}/api/v2/models/${e}/`,n={"Content-Type":"application/json"},o=(0,l.PW)();return o&&(n.Authorization=o),(0,a.O7)(n),fetch(s,{method:"GET",headers:n}).then((async e=>{if(e.ok)return!0;const t=await e.json().catch((e=>({})));if(t&&t.code===r.X.ACCESS_TOKEN_REQUIRED)throw new c.GT("Access token required (401)");if(403===e.status)throw new c.V2("Access denied (403)");throw new c.TR("Model not found (404)")}))}getQueue(){return this.queue}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{g.error(e)}));let s=null;return i&&(s=new d({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=s,s}async getUser(e){if(e&&e in this._userCache)return this._userCache[e];let t;const i=`${this.baseUrl}/api/v2/users/${e||"current"}`,s=await this.get(i,{responseType:"json"}).catch((e=>{g.error(e)}));if(s){const e=(s.memberships||[]).map((e=>new h({userId:s.user_sid,organizationId:e.organization_sid,name:e.name,flags:e.flags||[]})));t=new p({id:s.user_sid,firstName:s.first_name,lastName:s.last_name,email:s.email,loggedIn:s.is_authenticated,flags:new Set(s.flags),memberships:e})}else t=new p;return t.id&&(this._userCache[t.id]=t),t}}var y=i(54122);class b extends y.Y{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=new v(e.queue,e.prefetchedData,e.baseUrl),await this.api.init(e.preloadConfig)}getApi(){return this.api}}},19334:(e,t,i)=>{"use strict";i.d(t,{gj:()=>o,LI:()=>r,p$:()=>a,rd:()=>l,tu:()=>c,nr:()=>h,we:()=>d,Cj:()=>u,y6:()=>p});var s=i(44228),n=i(27545);const o="TransitionType",r=!0,a=n.Mk,l=n.mL,c=n.pn,h=n.su,d=n._c,u=n.BA,p=s.kw.Auto},21636:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var s=i(54122),n=i(10396),o=i(21265),r=i(17617),a=i(93273),l=i(6201);class c extends r.y{}class h extends s.Y{constructor(){super(...arguments),this.name="container-resizer",this.touchDevice=(0,o.Jm)(),this.timeout=0,this.keyboardFocused=!1,this.handleResize=e=>{this.keyboardFocused||(document.body.style.height=e.h+"px")},this.handleToolChange=e=>{!e.open&&this.keyboardFocused&&this.setKeyboardFocus(!1)},this.handleTextBoxFocus=e=>{this.setKeyboardFocus(e.focused)}}async init(e,t){if(!e.container)throw new c;this.appContainer=e.container,this.touchDevice&&(this.bindings.push((0,n.kp)(n.g_.RESIZE,this.handleResize),t.subscribe(a.S,this.handleTextBoxFocus),t.subscribe(l.Oj,this.handleToolChange)),this.handleResize((0,n.iv)()));for(const e of this.bindings)e.renew()}setKeyboardFocus(e){this.keyboardFocused=e,window.clearTimeout(this.timeout),this.keyboardFocused?(document.body.style.height="",this.timeout=window.setTimeout((()=>{document.documentElement.classList.add("keyboard-layout")}),300)):(document.documentElement.classList.remove("keyboard-layout"),this.appContainer.scrollTop=0)}}},93273:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.textElement=e,this.focused=t}}},98507:(e,t,i)=>{"use strict";i.d(t,{P:()=>n});var s=i(78909);class n extends s.T{constructor(e){super(),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.src=e.src,this.url=e.url,this.thumbnailUrl=e.thumbnailUrl,this.name=e.name,this.height=e.height,this.width=e.width,this.size=e.size,this.created=e.created,this.modified=e.modified,this.category=e.category,this.mediaType=e.mediaType,this.mediaId=e.mediaId,this.assetId=e.assetId||"",this.assetType=e.assetType,this}clone(){return(new n).copy(this)}}},3211:(e,t,i)=>{"use strict";i.d(t,{p:()=>o,s:()=>r});var s=i(32020),n=i(98507);class o{serialize(e){return e?{id:e.id,src:e.src,name:e.name,height:e.height,width:e.width,size:e.size||0,category:e.category,mediaType:e.mediaType,mediaId:e.mediaId,assetId:e.assetId,assetType:e.assetType,created:(0,s.U)(e.created),modified:(0,s.U)(e.modified)}:null}}class r{deserialize(e){if(!this.validate(e))return null;const t=new n.P;return t.id=e.id,t.src=e.src,t.url=e.src,t.thumbnailUrl=e.src,t.name=e.name,t.height=e.height,t.width=e.width,t.size=e.size,t.category=e.category,t.mediaId=e.mediaId,t.mediaType=e.mediaType,t.assetId=e.assetId,t.assetType=e.assetType,t.created=(0,s.p)(e.created),t.modified=(0,s.p)(e.modified),t}validate(e){return!(!e||"object"!=typeof e)&&["created","modified","category","mediaType","assetType","assetId","src"].every((t=>t in e))}}},36520:(e,t,i)=>{"use strict";i.d(t,{b:()=>h});var s=i(19413),n=i(71229),o=i(80994),r=i(80034),a=i(98507),l=i(51090),c=i(3211);class h extends s.V{constructor(e){super(),this.config=e,this.name="media-attachments-data",this.attachments=(0,n.q)(),this.tempAttachments=(0,n.q)(),this.pendingAttachments=(0,n.q)(),this.removedAttachments=(0,n.q)(),this.store=this.getDataStore()}async load(e){if(!this.store)throw new Error("Attachment storage is not configured");const t=await this.store.read()||{};for(const i in t){const s=new a.P(t[i]);if(s.mediaId){const t=e[s.mediaId];t&&(s.thumbnailUrl=await t.thumbnailUrl.get(),s.url=await t.imageUrl.get(),s.width=t.width,s.height=t.height)}this.attachments.set(i,s)}return this.attachments}async save(e){if(!this.store)throw new Error("Attachment storage is not configured");const t=e?{[e.id]:e}:this.attachments.deepCopy();return this.store.update(t)}getDataStore(){const{baseUrl:e,modelId:t,queue:i}=this.config,s=new o.A({serializer:new c.p,deserializer:new c.s});return new r.MU({queue:i,path:`${e}/api/v1/jsonstore/model/attachments/${t}`,batchUpdate:!0,httpMethod:r.w$.PATCH,deserialize:e=>s.deserialize(e),serialize:e=>s.serialize(e)})}iterate(e){for(const t of this.attachments)e(t)}iteratePending(e){for(const t of this.pendingAttachments)e(t)}iterateTemp(e){for(const t of this.tempAttachments)e(t)}getAttachmentsForAsset(e,t){const i=[];return this.iterate((s=>{s.assetType===t&&s.assetId===e&&i.push(s)})),t===l.h.MATTERTAG&&this.iterateTemp((s=>{s.assetType===t&&s.assetId===e&&i.push(s)})),i}getAttachmentsForAssetTypes(e){const t=[];return this.iterate((i=>{e.includes(i.assetType)&&t.push(i)})),e.includes(l.h.MATTERTAG)&&this.iterateTemp((i=>{e.includes(i.assetType)&&t.push(i)})),t}getAttachmentsForAssets(e){const t=[];return this.iterate((i=>{i.assetId&&e.includes(i.assetId)&&t.push(i)})),t}getAttachment(e){return this.attachments.get(e)}getTempAttachment(e){return this.tempAttachments.get(e)}hasPendingChanges(){return this.removedAttachments.length>0||this.pendingAttachments.length>0}getRemovedAttachments(){return this.removedAttachments.values}getPendingAttachment(e){return this.pendingAttachments.get(e)}getPendingAttachments(){return this.pendingAttachments.values}addPendingAttachments(e){0!==e.length&&(e.forEach((e=>{e&&this.pendingAttachments.set(e.id,e)})),this.commit())}getPendingAttachmentsForAsset(e,t){const i=[];return this.iteratePending((s=>{s.assetType===t&&s.assetId===e&&i.push(s)})),i}deletePendingAttachment(e){this.pendingAttachments.has(e)&&(this.pendingAttachments.delete(e),this.commit())}clearPendingAttachments(){0!==this.pendingAttachments.keys.length&&(this.pendingAttachments=(0,n.q)(),this.commit())}deleteRemovedAttachments(){0!==this.removedAttachments.keys.length&&(this.deleteAttachments(this.removedAttachments.keys),this.removedAttachments=(0,n.q)())}deleteAttachmentsForAsset(e,t){const i=[];this.iterate((s=>{s.assetType===t&&s.assetId===e&&i.push(s.id)})),this.deleteAttachments(i)}savePendingAttachments(e,t,i){if(this.pendingAttachments.length){const s=i||e;this.iteratePending((i=>{if(i.assetId===s&&i.assetType===t){const t=new a.P;t.copy(i),t.assetId=e,this.addAttachment(t)}})),this.clearPendingAttachments(),this.commit(),this.save()}}createTempAttachment(e){this.tempAttachments.set(e.id,e),this.deletePendingAttachment(e.id)}markAttachmentForDelete(e){const t=this.attachments.get(e);if(t){const i=new a.P;i.copy(t),this.removedAttachments.set(i.id,i),this.attachments.delete(e),this.commit()}}reattachRemovedAttachments(){const e=this.removedAttachments.keys;if(e.length){for(const t of e){const e=this.removedAttachments.get(t),i=new a.P;i.copy(e),this.addAttachment(i)}this.removedAttachments=(0,n.q)(),this.commit()}}addAttachment(e){this.attachments.set(e.id,e)}deleteAttachment(e){this.deleteAttachments([e])}deleteAttachments(e){const t={};e.forEach((e=>{t[e]=null,this.attachments.has(e)&&this.attachments.delete(e)})),Object.keys(t).length>0&&(this.commit(),this.store.update(t))}}},73305:(e,t,i)=>{"use strict";i.d(t,{wu:()=>n,st:()=>o,It:()=>r,iF:()=>a,GW:()=>l,rh:()=>c,u:()=>h,N0:()=>d,SI:()=>u,ms:()=>p,VO:()=>m,$T:()=>g,Qm:()=>f,HC:()=>v});var s=i(99681);class n extends s.m{constructor(e,t,i){super(),this.id="EMBED_MEDIA",this.payload={assetId:e,assetType:t,src:i}}}class o extends s.m{constructor(e){super(),this.id="LOAD_ATTACHMENT_EMBED",this.payload={attachmentId:e}}}class r extends s.m{constructor(e,t,i){super(),this.id="UPLOAD_ATTACHMENTS",this.payload={assetId:e,assetType:t,files:i}}}class a extends s.m{constructor(e,t,i){super(),this.id="ADD_TEMP_EMBED_ATTACHMENT",this.payload={assetId:e,mediaType:t,src:i}}}class l extends s.m{constructor(e,t,i){super(),this.id="SAVE_PENDING_ATTACHMENTS",this.payload={assetId:e,assetType:t,replyId:i}}}class c extends s.m{constructor(){super(...arguments),this.id="CLEAR_PENDING_ATTACHMENTS"}}class h extends s.m{constructor(){super(...arguments),this.id="REATTACH_REMOVED_ATTACHMENTS"}}class d extends s.m{constructor(){super(...arguments),this.id="DELETE_REMOVED_ATTACHMENTS"}}class u extends s.m{constructor(e,t){super(),this.payload={attachments:e,index:t}}}class p extends s.m{constructor(e,t,i){super(),this.payload={assetId:e,assetType:t,attachmentId:i}}}class m extends s.m{constructor(e,t){super(),this.payload={attachmentId:e,assetIds:t}}}class g extends s.m{constructor(e){super(),this.id="MARK_ATTACHMENT_DELETED",this.payload={id:e}}}class f extends s.m{constructor(e,t){super(),this.id="DELETE_ASSET_MEDIA",this.payload={assetId:e,assetType:t}}}class v extends s.m{constructor(e,t){super(),this.id="DELETE_ASSET_LIST_MEDIA",this.payload={assetIds:e,assetType:t}}}},63239:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddMattertagEmbedTempAttachmentCommand:()=>m.iF,Attachment:()=>g.P,AttachmentCategory:()=>R,AttachmentEmbedStatus:()=>N,AttachmentSerializer:()=>D.p,AttachmentUploadDoneMessage:()=>f.RE,AttachmentUploadError:()=>L,AttachmentUploadProgressMessage:()=>f.Vj,AttachmentsData:()=>w.b,AttachmentsUploadApi:()=>_,ClearPendingAttachmentsCommand:()=>m.rh,DeleteAssetListMediaCommand:()=>m.HC,DeleteAssetMediaCommand:()=>m.Qm,DeleteRemovedAttachmentsCommand:()=>m.N0,EmbedMediaCommand:()=>m.wu,EmbeddingDoneMessage:()=>f.v8,EmbedsData:()=>b,LoadEmbeddedMediaCommand:()=>m.st,MediaEmbedder:()=>A,MediaType:()=>C,ReattachRemovedAttachmentsCommand:()=>m.u,RemoveAttachmentCommand:()=>m.$T,SavePendingAttachmentsCommand:()=>m.GW,UploadAttachmentsCommand:()=>m.It,ViewAssetAttachmentsCommand:()=>m.ms,ViewAttachmentsCommand:()=>m.SI,ViewAttachmentsForAssetsCommand:()=>m.VO,default:()=>I,imageDeserializer:()=>T});var s=i(54122),n=i(25799),o=i(62367),r=i(51090),a=i(39936),l=i(80034),c=i(17513),h=i(68519);const d=new n.Z("media-serializer"),u=e=>{const t={};if(!e||!e.images||e.images.length<1)return t;const i=e.images;for(const e of Object.keys(i)){const s=p(i[e]);s&&(t[s.sid]=s)}return t},p=e=>{if(!e||!e.metadata)return null;let t=e.metadata;if("string"==typeof e.metadata)try{t=JSON.parse(e.metadata)}catch(e){return d.warn("Attachment metadata parse failed"),null}return 0===Object.keys(t).length?null:e.category===c.i.USER&&void 0!==t.assetType?{sid:e.sid,thumbnailUrl:new h.n(e.thumbnail_signed_src,null),imageUrl:new h.n(e.src,null),height:e.height,width:e.width}:null};var m=i(73305),g=i(98507),f=i(55994),v=i(19413),y=i(71229);class b extends v.V{constructor(){super(),this.name="embeds-data",this.embeds=(0,y.q)()}iterate(e){for(const t of this.embeds)e(t)}getEmbed(e){return this.embeds.get(e)}addEmbed(e){this.embeds.set(e.src,e)}clearCache(){this.embeds=(0,y.q)(),this.commit()}}var w=i(36520);const S=new n.Z("media-serializer"),T=e=>{if(!e||!e.metadata)return null;let t=e.metadata;if("string"==typeof e.metadata)try{t=JSON.parse(e.metadata)}catch(e){return S.warn("Attachment metadata parse failed"),null}if(0===Object.keys(t).length)return null;if(e.category===c.i.USER){const i=t;if(void 0!==i.assetType){const t=e.name&&(!e.name.match(/^[0-9.]+_[0-9.]+$/)||"")&&e.name||"";return{id:e.name,assetType:i.assetType,thumbnailUrl:e.thumbnail_signed_src,url:e.src,src:e.src,name:t,height:e.height,width:e.width,size:e.size,created:new Date(Date.parse(e.created)),modified:new Date(Date.parse(e.modified)),category:R.UPLOAD,mediaType:C.IMAGE,mediaId:e.sid}}}return null},E=new n.Z("attachment-uploader");class _{constructor(e,t){this.queue=e,this.imageEndpoint=t}uploadImageFile(e,t,i){const s=new FormData;return s.append("src",e.file,e.file.name),s.append("name",e.file.name),s.append("category",c.i.USER),s.append("metadata",JSON.stringify(t)),this.upload(s,i).then((t=>{if(E.info("upload successful!"),t){const i=T(t);if(i){const t=(new g.P).copy(i);return e.progress=100,e.attachment=t,e}}return e.error=L.UPLOAD_FAILED,e.progress=100,e})).catch((t=>(E.error(`upload failed ${t}`),e.error=L.UPLOAD_FAILED,e.progress=100,e)))}async upload(e,t){const i=`${this.imageEndpoint}?format=json`,s=new XMLHttpRequest;return s.open("POST",i,!0),s.responseType="json",s.setRequestHeader("Accept","application/json"),s.upload.onprogress=t,new Promise(((t,i)=>{s.onreadystatechange=e=>{4===s.readyState&&(200===s.status||201===s.status||204===s.status?t(s.response):0!==s.status&&i({status_code:s.status}))},s.onerror=function(e){i(e)},s.send(e)}))}deleteImageFile(e){return this.queue.delete(`${this.imageEndpoint}${e}?format=json`).then((e=>{E.info("delete successful!")})).catch((e=>{E.error(e)}))}}var x=i(20331),M=i(99898);const P=new n.Z("media-embedder");class A{constructor(e,t){this.key=e,this.embedsData=t,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.safeProvidersForScripts=[M.T_,M.Er],A.queue||(A.queue=new x.gO({retries:0})),this.embedsData=t}clearCache(){this.embedsData.clearCache()}async getEmbeddedMedia(e){const t=this.embedsData.getEmbed(e);if(t)return t;try{const t=await this.getEmbedDetails(e);if(t)return this.embedsData.addEmbed(t),t}catch(t){P.error(`Embed failed: ${e}`),P.error(t)}return null}async getEmbedDetails(e){const t=this.getEmbedUrl(e);return this.loadEmbed(t,e)}getEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}loadEmbed(e,t){return A.queue.get(e,{responseType:"json"}).then((i=>this.validateEmbed(e,t,i)))}validateEmbed(e,t,i){if(i.html&&i.html.match(/<script/i)&&!this.safeProvidersForScripts.includes(i.provider_name))return P.debug("html contains Javascript"),Promise.resolve(null);if(i.type===C.RICH_EMBED&&!i.html)return P.debug("missing html for embed"),Promise.resolve(null);let s=i.type;switch(s){case C.PHOTO_EMBED:case C.RICH_EMBED:case C.VIDEO_EMBED:break;default:{const e=`Did the OEmbed format extend?! Unknown type: ${i.type}`;return P.debug(e),Promise.resolve(null)}}const n=(void 0===i.height||void 0===i.width)&&i.thumbnail_width&&i.thumbnail_height,o=n?i.thumbnail_width:i.width,r=n?i.thumbnail_height:i.height,a=i.provider_name,l=i.thumbnail_url;a===M.Er&&n&&s===C.RICH_EMBED&&l?s=C.PHOTO_EMBED:a===M.T_&&!n&&s===C.PHOTO_EMBED&&i.url||s===C.PHOTO_EMBED&&i.html&&(s=C.RICH_EMBED);const c={width:o,height:r,mediaType:s,name:i.title||"",thumbnailUrl:l,mediaUrl:i.url||l||"",html:i.html||"",provider:a,src:t};return s!==C.PHOTO_EMBED||i.html?Promise.resolve(c):this.getImageDetails(t,c)}async getImageDetails(e,t){const i=this.getDisplayUrl(e);return this.loadImage(e,i,t)}getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}loadImage(e,t,i){return A.queue.get(t,{responseType:"arraybuffer"}).then((s=>s?this.validateImage(e,t,i,s):(P.debug("Embedly: got an empty response when requesting image"),Promise.resolve(null)))).catch((e=>(P.debug(`Embedly error: ${e}`),Promise.resolve(null))))}validateImage(e,t,i,s){return new Promise(((e,n)=>{const o=new Uint8Array(s),r=new Blob([o]),a=new Image;a.addEventListener("load",(s=>function(s){const n=s.target;i.width=n.naturalWidth,i.height=n.naturalHeight,i.mediaUrl=t,i.thumbnailUrl=l,e(i)}(s)));const l=URL.createObjectURL(r);a.src=l}))}}class O extends s.Y{constructor(){super(...arguments),this.name="attachments-module",this.log=new n.Z(this.name),this.viewAssetAttachments=async e=>{const t=this.attachmentsData.getAttachmentsForAsset(e.assetId,e.assetType),i=t.findIndex((t=>t.id===e.attachmentId));t.length>0&&-1!==i?this.engine.commandBinder.issueCommand(new m.SI(t,i)):this.log.warn("No attachments to view")},this.viewAttachmentsForAssets=async e=>{const t=this.attachmentsData.getAttachmentsForAssets(e.assetIds),i=t.findIndex((t=>t.id===e.attachmentId));t.length>0&&-1!==i?this.engine.commandBinder.issueCommand(new m.SI(t,i)):this.log.warn("Cannot view empty attachment list")},this.loadEmbeddedAttachment=async e=>{let t=this.attachmentsData.getAttachment(e.attachmentId);const i=!!t;return t||(t=this.attachmentsData.getPendingAttachment(e.attachmentId)||this.attachmentsData.getTempAttachment(e.attachmentId)),t?this.getUpdatedEmbed(t,i):null},this.embedMedia=async e=>{let t,i=null;const s=await this.mediaEmbedder.getEmbeddedMedia(e.src);return s?(i=new g.P,i.id=this.getNewattachmentId(),i.assetType=e.assetType,i.assetId=e.assetId,i.name=s.name,i.src=e.src,i.thumbnailUrl=s.thumbnailUrl,i.url=s.mediaUrl,i.category=R.EMBED,i.mediaType=s.mediaType,i.height=s.height,i.width=s.width,this.attachmentsData.addPendingAttachments([i]),t=N.EMBED_SUCCESS):t=N.EMBED_FAIL,this.engine.broadcast(new f.v8(i,t,e.assetId,e.assetType)),i},this.addTempTagEmbedAttachment=async e=>{const t=new g.P({id:this.getNewattachmentId(),assetId:e.assetId,mediaType:e.mediaType,src:e.src,assetType:r.h.MATTERTAG,category:R.EMBED});this.attachmentsData.createTempAttachment(t)},this.uploadAttachments=async e=>{const t=e.assetType,i=e.assetId,s=e.files,n=s.length,o=[];for(let e=0;e<n;e++){const n=s[e];let r=null;n.type.match(M.Y1[C.IMAGE].fileTypeMatch)?r=C.IMAGE:n.type.match(M.Y1[C.PDF].fileTypeMatch)&&(r=C.PDF),o.push(this.uploadAttachment(n,r,e,i,t))}const r=await Promise.all(o),a=[];r.forEach((e=>{e.attachment&&(e.attachment.id=this.getNewattachmentId(),e.attachment.assetId=e.assetId,a.push(e.attachment))})),a&&this.attachmentsData.addPendingAttachments(a),this.engine.broadcast(new f.RE(r,i,t))},this.onProgress=(e,t)=>{if(!e.lengthComputable)return;const i=Math.floor(e.loaded/e.total*100);this.engine.broadcast(new f.Vj(Object.assign(Object.assign({},t),{progress:i}),t.assetId,t.assetType))},this.removeAttachment=async e=>{const t=e.id;if(this.attachmentsData.getAttachment(t))this.attachmentsData.markAttachmentForDelete(t);else{const e=this.attachmentsData.getPendingAttachment(t);e&&(await this.deleteUploadedMedia([e]),this.attachmentsData.deletePendingAttachment(t))}},this.saveAttachments=async e=>{this.attachmentsData.savePendingAttachments(e.assetId,e.assetType,e.replyId)},this.clearPendingAttachments=async()=>{const e=this.attachmentsData.getPendingAttachments();await this.deleteUploadedMedia(e),this.attachmentsData.clearPendingAttachments()},this.reattachRemovedAttachments=async()=>{this.attachmentsData.reattachRemovedAttachments()},this.deleteRemovedAttachments=async()=>{const e=this.attachmentsData.getRemovedAttachments();await this.deleteUploadedMedia(e),this.attachmentsData.deleteRemovedAttachments()},this.handleDeleteAssetMedia=async e=>this.deleteAttachmentsForAsset(e.assetId,e.assetType),this.deleteAssetListAttachments=async e=>{const t=[];e.assetIds.forEach((i=>{t.push(this.deleteAttachmentsForAsset(i,e.assetType))})),await Promise.all(t)}}async init(e,t){this.engine=t,this.embedsData=new b,this.attachmentsData=new w.b(e);const i=new l.gh({queue:e.queue,path:e.modelUrl,deserialize:u}),s=await i.read().catch((e=>(this.log.debug(e),{})));this.attachmentsData.load(s||{}),this.settingsData=await t.market.waitForData(a.e);const n=e.modelUrl+"/images/";this.mediaUploader=new _(e.queue,n),this.mediaEmbedder=new A(this.settingsData.getProperty(M.lc),this.embedsData),this.bindings.push(t.commandBinder.addBinding(m.It,this.uploadAttachments),t.commandBinder.addBinding(m.wu,this.embedMedia),t.commandBinder.addBinding(m.st,this.loadEmbeddedAttachment),t.commandBinder.addBinding(m.iF,this.addTempTagEmbedAttachment),t.commandBinder.addBinding(m.GW,this.saveAttachments),t.commandBinder.addBinding(m.$T,this.removeAttachment),t.commandBinder.addBinding(m.Qm,this.handleDeleteAssetMedia),t.commandBinder.addBinding(m.HC,this.deleteAssetListAttachments),t.commandBinder.addBinding(m.rh,this.clearPendingAttachments),t.commandBinder.addBinding(m.u,this.reattachRemovedAttachments),t.commandBinder.addBinding(m.N0,this.deleteRemovedAttachments),t.commandBinder.addBinding(m.VO,this.viewAttachmentsForAssets),t.commandBinder.addBinding(m.ms,this.viewAssetAttachments)),t.market.register(this,b,this.embedsData),t.market.register(this,w.b,this.attachmentsData)}getNewattachmentId(){let e=(0,o.O1)(11);for(;this.attachmentsData.getAttachment(e);)e=(0,o.O1)(11);return e}async getUpdatedEmbed(e,t){if(e.category===R.EMBED){const i=await this.mediaEmbedder.getEmbeddedMedia(e.src);if(i)return e.thumbnailUrl=i.thumbnailUrl,e.url=i.mediaUrl,e.mediaType=i.mediaType,e.height=i.height,e.width=i.width,e.name=i.name,t&&this.attachmentsData.save(e),e.commit(),i;this.log.warn("Get embedded media failed")}return null}async uploadAttachment(e,t,i,s,n){const o={assetType:n},r={file:e,attachment:null,progress:0,index:i,error:null,assetId:s,assetType:n};if(t!==C.IMAGE){const e=t===C.PDF?L.SUPPORT_COMING_SOON:L.UNSUPPORTED_FILE_TYPE;return this.log.warn("Cannot upload file type"),r.error=e,Promise.resolve(r)}return this.mediaUploader.uploadImageFile(r,o,(e=>this.onProgress(e,r)))}async deleteUploadedMedia(e){const t=[];e.forEach((e=>{e.category===R.UPLOAD&&e.mediaId&&e.mediaType===C.IMAGE&&t.push(this.mediaUploader.deleteImageFile(e.mediaId))})),await Promise.all(t)}async deleteAttachmentsForAsset(e,t){const i=this.attachmentsData.getAttachmentsForAsset(e,t);await this.deleteUploadedMedia(i),this.attachmentsData.deleteAttachmentsForAsset(e,t)}}var D=i(3211);const I=O;var C,R,L,N;!function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO_EMBED="video",e.RICH_EMBED="rich",e.PHOTO_EMBED="photo"}(C||(C={})),function(e){e.UPLOAD="upload",e.EMBED="embed"}(R||(R={})),function(e){e.UNSUPPORTED_FILE_TYPE="unsupported",e.SUPPORT_COMING_SOON="coming",e.UPLOAD_FAILED="failed"}(L||(L={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(N||(N={}))},55994:(e,t,i)=>{"use strict";i.d(t,{Vj:()=>n,RE:()=>o,v8:()=>r});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.status=e,this.assetId=t,this.assetType=i}}class o extends s.v{constructor(e,t,i){super(),this.uploads=e,this.assetId=t,this.assetType=i}}class r extends s.v{constructor(e,t,i,s){super(),this.attachment=e,this.status=t,this.assetId=i,this.assetType=s}}},99898:(e,t,i)=>{"use strict";i.d(t,{lc:()=>s,Er:()=>n,T_:()=>o,yk:()=>r,Y1:()=>c});const s="embedlyKey",n="Instagram",o="Flickr",r=25,a=[".jpg",".jpeg",".png",".gif"],l=[".pdf"],c=Object.freeze({extensions:a.concat(l),image:{extensions:a,fileTypeMatch:"image/.+"},pdf:{extensions:l,fileTypeMatch:"application/pdf"}})},44857:(e,t,i)=>{"use strict";i.d(t,{L:()=>n});var s=i(99681);class n extends s.m{}},89155:(e,t,i)=>{"use strict";i.d(t,{M_:()=>f,rw:()=>m});var s=i(64279),n=i(19413),o=i(290),r=i(2212);const a=(e,t)=>e&&t?e.equals(t):e===t;var l=i(91055),c=i(56040),h=i(78909),d=i(97620);class u extends h.T{constructor(e){super(),this.position=new r.Pa4,this.rotation=new r._fP,this.focalDistance=-1,this.projection=(0,s.AN)(e)}aspect(){return this.projection.elements[5]/this.projection.elements[0]}clone(){const e=new u(this.aspect());return e.position.copy(this.position),e.rotation.copy(this.rotation),e.focalDistance=this.focalDistance,e.projection.copy(this.projection),e}}class p extends h.T{constructor(){super(...arguments),this.startTime=0,this.duration=0,this.active=!1,this.type=null,this.progress=new o.z(0),this.blackoutProgress=new o.z(0),this.from={position:new r.Pa4,rotation:new r._fP,projection:new c.M},this.to={position:new r.Pa4,rotation:new r._fP,projection:new c.M},this.rotationDelay=0,this.rotationDuration=1,this.matrixDelay=0,this.matrixDuration=1,this.activeInternal=!1}}const m=(e,t,i=!0)=>{t.position=g(e.position,t.position,i),t.rotation=g(e.rotation,t.rotation,i),t.projection=g(e.projection,t.projection,i),t.focalDistance=e.focalDistance},g=(e,t,i=!0)=>(e&&!t?t=e.clone():e&&t?t.copy(e):i&&(t=void 0),t);class f extends n.V{constructor(e,t){super(),this._width=e,this._height=t,this.name="camera",this._baseProjection=new c.M,this._orthoMatrix=new c.M,this._perspectiveMatrix=new c.M,this.pose=new u(e/t),this.transition=new p,this.setCameraDimensions(e,t),this._baseFovY=r.M8C.DEG2RAD*s.oR.fov}setCameraDimensions(e,t){if(void 0===e||void 0===t)return;this._width=e,this._height=t;const i=e/t,n=this.isOrtho()?(0,s.aH)(e,t,t/(2*this.orthoZoom()),this._orthoMatrix):this._perspectiveMatrix.makePerspectiveFov(d.MN*this.fovY(),i,s.oR.near,s.oR.far);if(this.pose.projection.copy(n),this.transition.active&&this.transition.to.projection)if((0,l.Pp)(this.transition.to.projection)){const i=(0,l.S3)(this.transition.to.projection);this.transition.to.projection.copy((0,s.aH)(e,t,t/(2*i)))}else{const e=2*d.MN*Math.atan(1/this.transition.to.projection.elements[5]);this.transition.to.projection.makePerspectiveFov(e,i,s.oR.near,s.oR.far)}this.pose.commit()}setBaseProjection(e){this._baseProjection=e}get width(){return this._width}get height(){return this._height}get baseFovY(){return this._baseFovY}aspect(){return this.pose.aspect()}fovY(){return 2*Math.atan(1/this.pose.projection.elements[5])}fovX(){return 2*Math.atan(1*this.aspect()/this.pose.projection.elements[5])}isOrtho(){return(0,l.Pp)(this.pose.projection)}baseZoom(){return this.pose.projection.elements[0]/2}defaultZoom(){return(0,l.Pp)(this._baseProjection)?(0,l.S3)(this._baseProjection):this.perspectiveZoom()}zoom(){return this.isOrtho()?this.orthoZoom():this.perspectiveZoom()}orthoZoom(){return(0,l.S3)(this.pose.projection)}perspectiveZoom(){return this.baseFovY/this.fovY()}copyTransition(e){this.transition.active=e.active,this.transition.activeInternal=e.activeInternal,this.transition.type=e.type,this.transition.startTime=e.startTime,this.transition.duration=e.duration,this.transition.rotationDelay=e.rotationDelay,this.transition.rotationDuration=e.rotationDuration,this.transition.matrixDelay=e.matrixDelay,this.transition.matrixDuration=e.matrixDuration,e.progress&&this.transition.progress.copy(e.progress),e.blackoutProgress&&this.transition.blackoutProgress.copy(e.blackoutProgress),e.from&&m(e.from,this.transition.from),e.to&&m(e.to,this.transition.to)}canTransition(){return!this.transition.active}clone(){const e=new f(this.width,this.height);return e.copy(this),e}copy(e){this.pose.position.copy(e.pose.position),this.pose.rotation.copy(e.pose.rotation),this.pose.focalDistance=e.pose.focalDistance,this.pose.projection.copy(e.pose.projection),this.pose.commit(),this._baseFovY=e.baseFovY,this.copyTransition(e.transition),this.transition.commit(),this._width=e.width,this._height=e.height}shallowIsEqual(e){return this.pose.position.equals(e.pose.position)&&this.pose.rotation.equals(e.pose.rotation)&&this.pose.projection.equals(e.pose.projection)&&this.pose.focalDistance===e.pose.focalDistance&&this.baseFovY===e.baseFovY}isEqual(e){return this.shallowIsEqual(e)&&this.transitionIsEqual(e.transition)}transitionIsEqual(e){return this.transition.active===e.active&&this.transition.type===e.type&&this.transition.progress.equals(e.progress)&&this.transition.blackoutProgress.equals(e.blackoutProgress)&&this.transition.rotationDelay===e.rotationDelay&&this.transition.rotationDuration===e.rotationDuration&&this.transition.matrixDelay===e.matrixDelay&&this.transition.matrixDuration===e.matrixDuration&&this.transition.activeInternal===e.activeInternal&&a(this.transition.from.position,e.from.position)&&a(this.transition.from.rotation,e.from.rotation)&&a(this.transition.from.projection,e.from.projection)&&a(this.transition.to.position,e.to.position)&&a(this.transition.to.rotation,e.to.rotation)&&a(this.transition.to.projection,e.to.projection)&&this.transition.startTime===e.startTime&&this.transition.duration===e.duration}}},64279:(e,t,i)=>{"use strict";i.d(t,{oR:()=>n,AN:()=>o,aH:()=>r});var s=i(56040);const n={fov:75,near:.1,far:3e3},o=(e,t)=>(t||(t=new s.M),t.makePerspectiveFov(n.fov,e,n.near,n.far)),r=(e,t,i=1,o)=>{o||(o=new s.M);const r=e/2,a=t/2,l=o.makeOrthographic(-r,r,a,-a,n.near,n.far);return l.elements[0]*=i,l.elements[5]*=i,l}},89895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{baseTransitionSpeedKey:()=>T,default:()=>E});var s=i(2212),n=i(91055),o=i(80384),r=i(54122),a=i(89155),l=i(93528);class c extends l.v{constructor(e,t){super(),this.from=t,this.to=e,this.timestamp=Date.now()}}class h extends c{}class d extends c{}var u=i(44266),p=i(1799),m=i(73029),g=i(39936),f=i(99169),v=i(97620),y=i(28247),b=i(47924),w=i(44857);const S={[b.n.Instant]:{blackoutTime:0,transitionTime:0},[b.n.FadeToBlack]:{blackoutTime:m.Z.camera.transitionBlackoutTime,transitionTime:2*m.Z.camera.transitionBlackoutTime},[b.n.Interpolate]:{blackoutTime:0,transitionTime:m.Z.camera.transitionFadeTime}},T="Transition time";class E extends r.Y{constructor(){super(...arguments),this.name="camera-data",this.eulerCache=new s.USm,this.quaternionCache=new s._fP}async init(e,t){this.engine=t,this.market=t.market,this.canvas=await t.market.waitForData(f.W),this.cameraData=new a.M_(this.canvas.width,this.canvas.height),this.market.register(this,a.M_,this.cameraData),this.baseTransitionTime=e.baseTransitionTime||m.Z.camera.baseTransitionTime,t.market.waitForData(g.e).then((e=>{e.onPropertyChanged(T,(e=>{this.baseTransitionTime=e}))})),t.commandBinder.addBinding(w.L,(async()=>this.resetPitch())),this.bindings.push(t.subscribe(o.a,(e=>this.cameraData.setCameraDimensions(e.width,e.height)))),this.transitionSpeed=e.transitionSpeed||m.Z.camera.transitionSpeed}getData(e=!0){return e?Object.freeze(this.cameraData.clone()):this.cameraData}onUpdate(e){}fromPose(){return{position:this.cameraData.pose.position.clone(),rotation:this.cameraData.pose.rotation.clone(),projection:this.cameraData.pose.projection.clone(),focalDistance:this.cameraData.pose.focalDistance}}updateCameraProjection(e){e&&(this.cameraData.pose.projection.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({projection:e}))}updateCameraFocus(e){this.cameraData.pose.focalDistance=e,this.cameraData.pose.commit()}updateCameraRotation(e){e&&(this.cameraData.pose.rotation.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({rotation:e}))}resetPitch(){this.eulerCache.setFromQuaternion(this.cameraData.pose.rotation,"YXZ"),this.eulerCache.x=0,this.eulerCache.z=0,this.quaternionCache.setFromEuler(this.eulerCache),this.updateCameraRotation(this.quaternionCache)}updateCameraPosition(e){e&&(this.cameraData.pose.position.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({position:e}))}broadcastCameraMoved(e){const t=this.fromPose(),i=Object.assign(Object.assign({},t),e);this.engine.broadcast(new c(i,t))}updateCameraPose(e){e.position&&this.updateCameraPosition(e.position),e.rotation&&this.updateCameraRotation(e.rotation)}canTransition(){return this.cameraData.canTransition()}moveTo(e){if(!this.canTransition())return u.Q.reject("Cannot move while the camera is already moving");const t=S[e.transitionType],i=e.pose.rotation,s=e.pose.position;let o=e.projection;e.pose.zoom&&(o&&(0,n.Pp)(o)||this.cameraData.isOrtho())&&(o=this.adjustProjectionZoom(o||this.cameraData.pose.projection.clone(),e.pose.zoom));const r=void 0!==e.blackoutTime?e.blackoutTime:t.blackoutTime,a=e.transitionType,l=e.transitionSpeedMultiplier?1/e.transitionSpeedMultiplier:1;let c=a===b.n.Instant?0:e.transitionTime;if(void 0===c)if(e.transitionType===b.n.Interpolate&&s){const e=s.distanceTo(this.cameraData.pose.position);c=this.baseTransitionTime+166*Math.log2(1+e)*this.transitionSpeed*l}else c=t.transitionTime;const p=this.fromPose();this.beginInternalTransition({transitionType:a,transitionTime:c,blackoutTime:r,pose:{position:s,rotation:i},projection:o,easing:e.easing,rotationDelay:e.rotationDelay||0,rotationDuration:e.rotationDuration||1,matrixDelay:e.matrixDelay||0,matrixDuration:e.matrixDuration||1,focalDistance:e.focalDistance||p.focalDistance});const m={position:e.pose.position?e.pose.position.clone():void 0,rotation:e.pose.rotation?e.pose.rotation.clone():void 0,projection:e.projection?e.projection.clone():void 0,focalDistance:e.focalDistance?e.focalDistance:void 0};this.engine.broadcast(new h(m,p));const g=new u.Q,f=this.progressInternalTransition.bind(this),w=this.endInternalTransition.bind(this),T=this;return g.notify(0),this.engine.startGenerator((function*(){let t=16;for(t>=T.cameraData.transition.duration&&(g.notify(.5),yield new y.Jj);t<T.cameraData.transition.duration;){f(t,r);const e=(0,v.uZ)(t/T.cameraData.transition.duration,0,1);g.notify(e),yield new y.Jj,t=16+Date.now()-T.cameraData.transition.startTime}w(e.transitionType),T.cameraData.commit(),g.notify(1),g.resolve(),T.engine.broadcast(new d(m,p))})),g.promise()}async cancelTransition(){return this.cameraData.transition.active?new Promise((e=>{(0,a.rw)(this.cameraData.pose,this.cameraData.transition.to,!1);const t=Date.now()-this.cameraData.transition.startTime;this.cameraData.transition.duration=t,this.cameraData.transition.progress.stop(1),this.cameraData.pose.commit(),this.cameraData.transition.commit();const i=this.cameraData.transition.onPropertyChanged("active",(t=>{t||(i&&i.cancel(),e())}))})):Promise.resolve()}updateTransitionSpeed(e){if(this.cameraData.transition.active){const t=Date.now(),i=t-this.cameraData.transition.startTime,s=i/e,n=this.cameraData.transition.progress,o=(n.duration-i)/e+s;this.cameraData.transition.duration=o,this.cameraData.transition.startTime=t-s,n.modifyAnimation(n.value,n.endValue,o,n.easing,s),this.cameraData.transition.commit()}}beginExternalTransition(){this.cameraData.transition.activeInternal||(this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.active=!0,this.cameraData.transition.commit())}endExternalTransition(){this.cameraData.transition.activeInternal||(this.cameraData.transition.active=!1,this.cameraData.transition.commit())}beginInternalTransition(e){const t=e.transitionTime||0;this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.duration=t,this.cameraData.transition.active=!0,this.cameraData.transition.activeInternal=!0,this.cameraData.transition.type=e.transitionType,this.cameraData.transition.progress.modifyAnimation(0,1,t,e.easing||p.to),this.cameraData.transition.rotationDelay=e.rotationDelay||0,this.cameraData.transition.rotationDuration=e.rotationDuration||1,this.cameraData.transition.matrixDelay=e.matrixDelay||0,this.cameraData.transition.matrixDuration=e.matrixDuration||1,e.transitionType===b.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.modifyAnimation(0,1,e.blackoutTime),this.cameraData.transition.from.position=this.cameraData.pose.position.clone(),this.cameraData.transition.from.rotation=this.cameraData.pose.rotation.clone(),this.cameraData.transition.from.projection=this.cameraData.pose.projection.clone(),this.cameraData.transition.from.focalDistance=this.cameraData.pose.focalDistance,this.cameraData.transition.to.position=e.pose.position?e.pose.position.clone():void 0,this.cameraData.transition.to.rotation=e.pose.rotation?e.pose.rotation.clone():void 0,this.cameraData.transition.to.projection=e.projection?e.projection.clone():void 0,this.cameraData.transition.to.focalDistance=e.focalDistance?e.focalDistance:void 0,this.cameraData.transition.commit()}progressInternalTransition(e,t){if(this.cameraData.transition.active){if(this.cameraData.transition.progress.updateAbsolute(e),this.cameraData.transition.type===b.n.Interpolate){const e=this.cameraData.transition.from,t=this.cameraData.transition.to;if(t.position&&e.position&&this.cameraData.pose.position.copy(e.position).lerp(t.position,this.cameraData.transition.progress.value),t.focalDistance&&e.focalDistance&&(this.cameraData.pose.focalDistance=s.M8C.lerp(e.focalDistance,t.focalDistance,this.cameraData.transition.progress.value)),t.rotation&&e.rotation){const i=(0,p.e3)(this.cameraData.transition.progress.easing,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.rotationDuration,this.cameraData.transition.rotationDelay);this.cameraData.pose.rotation.copy(e.rotation).slerp(t.rotation,i)}if(t.projection&&e.projection){const i=(0,p.e3)(p.w2,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.matrixDuration,this.cameraData.transition.matrixDelay);!function(e,t,i,s){const n=s.elements,o=e.elements,r=t.elements;for(let e=0;e<16;e++)n[e]=o[e]*(1-i)+r[e]*i}(e.projection,t.projection,i,this.cameraData.pose.projection)}}else if(this.cameraData.transition.type===b.n.FadeToBlack){let i=0;const s=this.cameraData.transition.duration;e<=t?i=e:((0,a.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),i=e>=s-t?s-e:t),this.cameraData.transition.blackoutProgress.updateAbsolute(i),this.cameraData.transition.progress.updateAbsolute(e<=t?0:s)}this.cameraData.pose.commit(),this.cameraData.transition.commit()}}endInternalTransition(e){(0,a.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),this.cameraData.transition.type=null,this.cameraData.transition.active=!1,this.cameraData.transition.activeInternal=!1,this.cameraData.transition.progress.stop(1),e===b.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.stop(0),this.cameraData.pose.commit(),this.cameraData.transition.commit()}adjustProjectionZoom(e,t){const i=1/t;return e.elements[0]=i/this.canvas.aspectRatio,e.elements[5]=i,e}setBaseProjection(e){this.cameraData.setBaseProjection(e)}}},47924:(e,t,i)=>{"use strict";var s;i.d(t,{n:()=>s}),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate"}(s||(s={}))},73029:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r,y:()=>a});var s=i(27468),n=i(47924),o=i(21265);const r=Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:o.hu("btt",200),transitionSpeed:o.hu("tsp",3)}}),a={[s.s.Desktop]:n.n.Interpolate,[s.s.Mobile]:n.n.Interpolate,[s.s.VrOrientOnly]:n.n.FadeToBlack,[s.s.VrWithController]:n.n.FadeToBlack,[s.s.VrWithTrackedController]:n.n.FadeToBlack}},75195:(e,t,i)=>{"use strict";i.d(t,{q9:()=>o,bD:()=>r,D_:()=>a,z5:()=>c,st:()=>h,Kh:()=>d,fi:()=>u});var s=i(2212),n=i(27829);const o=(()=>{const e=new s.yGw,t=new s.yGw;return(i,n,o,r)=>(o=o||new s.FM8,r=r||new s.Pa4,l(i.pose,t),e.copy(t),e.invert(),r.set(n.x,n.y,n.z).applyMatrix4(e).applyMatrix4(i.pose.projection.asThreeMatrix4()),u(i.width,i.height,r,o),{screenPosition:o,ndcPosition:r})})(),r=(()=>{const e=new s.Pa4,t=new s.FM8;return(i,s,n,o,r,l)=>(e.copy(a(i,s,n,l)),u(o,r,e,t),t)})(),a=(()=>{const e=new s.yGw,t=new s.yGw,i=new s.Pa4;return(s,o,r,a)=>(e.compose(o,r,n.f.UNIT),t.copy(e),t.invert(),i.copy(s).applyMatrix4(t).applyMatrix4(a),i)})(),l=(e,t)=>(t=t||new s.yGw).compose(e.position,e.rotation,n.f.UNIT),c=(e,t,i,n,o)=>((o=o||new s.FM8).x=e/i*2-1,o.y=-t/n*2+1,o),h=(e,t,i=.5,n)=>((n=n||new s.Pa4).x=t.x,n.y=t.y,n.z=i,d(e.pose,n)),d=(()=>{const e=new s.yGw,t=new s.yGw;return(i,n,o)=>((o=o||new s.Pa4).copy(n),t.copy(i.projection.asThreeMatrix4()),t.invert(),l(i,e),o.applyMatrix4(t).applyMatrix4(e))})(),u=(e,t,i,n)=>((n=n||new s.FM8).set((i.x+1)*e/2,(1-i.y)*t/2),n)},37018:(e,t,i)=>{"use strict";i.d(t,{O:()=>o,B:()=>r});var s=i(71208),n=i(19413);class o extends n.V{constructor(e,t,i){super(),this.name="cam-start",this.icon=e,this.thumb=t,this.modified=new Date(0),this.pose=new r,i&&this.pose.copy(i)}copy(e){return this.icon=e.icon,this.thumb=e.thumb,this.modified=e.modified||new Date,this.pose.copy(e.pose),this}get hasCameraPose(){return this.pose&&this.pose.camera&&void 0!==this.pose.camera.position}}class r{constructor(e=s.Ey.Panorama,t,i,n,o,r){this.mode=e,this.camera={position:t||void 0,rotation:i||void 0,zoom:n||void 0},this.pano=o||{uuid:void 0},this.floorVisibility=r||void 0}copy(e){return this.camera.position=a(e.camera.position,this.camera.position),this.camera.rotation=a(e.camera.rotation,this.camera.rotation),this.camera.zoom=e.camera.zoom,this.pano.uuid=e.pano.uuid?e.pano.uuid.slice():void 0,this.mode=e.mode,this.floorVisibility=e.floorVisibility?e.floorVisibility.slice():void 0,this}}const a=(e,t)=>e&&t?t.copy(e):e&&!t?e.clone():void 0},87694:(e,t,i)=>{"use strict";i.d(t,{K:()=>d});var s=i(2212),n=i(71208),o=i(21265),r=i(25799),a=i(97620),l=i(60982);const c=new r.Z("navurl");class h extends Error{constructor(e,t){super(`view mode ${e} is invalid${t?` when ${t}`:""}`)}}class d{static encodeVector3(e,t=2){const{x:i,y:s,z:n}=e;return d.packFloats([i,s,n],t)}static decodeVector3(e){const t=d.unpackFloats(e,3);return t?new s.Pa4(...t):null}static encodeQuaternion(e,t=2){return d.packFloats([e.x,e.y,e.z,e.w],t)}static decodeQuaternion(e){const t=d.unpackFloats(e,4);return t&&!(0,l.mB)(t)?new s._fP(...t):null}static encodeEuler(e,t=2){return d.packFloats([e.x,e.y,e.z],t)}static decodeEuler(e){const t=d.unpackFloats(e,3);return t?new s.USm(t[0],t[1],t[2],"XYZ"):void 0}static packFloats(e,t=2){let i=e.map((e=>{const i=parseFloat(e.toFixed(t)).toString().replace(/^(\-)?0+.(\d+)/,"$1.$2");return"0"===i?"":i})).join(",");return i=i.replace(/,+$/,""),i}static unpackFloats(e,t=0){const i=e.split(",").map((e=>""===e?0:parseFloat(e)));if(!i||i.includes(NaN))return[];for(;i.length<t;)i.push(0);return i}static getQueryString(e,t=!0){const i=d.serialize(e,t);return Object.keys(i).map((e=>e+"="+i[e])).join("&")}static serialize(e,t=!0){const i=d.removeNavigationKeys(o.AO());try{if(t){const t=d.getShortPose(e);Object.assign(i,t)}else{const t=d.getStartPose(e),s=encodeURIComponent(JSON.stringify(t));Object.assign(i,{start:s})}}catch(e){c.debug(e)}return i}static deserialize(e){const t=o.AO(e);try{return"start"in t?d.parseStartObject(t.start):d.parseShortUrl(t)}catch(e){c.debug(e)}return null}static removeNavigationKeys(e){const t=Object.assign({},e);for(const e of["start","sm","sp","sq","sr","ss","sf","sz"])delete t[e];return t}static parseShortUrl(e){const{sm:t,sp:i,sq:o,sr:r,ss:l,sf:u,sz:p}=e,m=d.parseViewmode(t),g=d.decodeEuler(r||"")||new s.USm(0,0,0),f=d.decodeQuaternion(o||"")||new s._fP(0,0,0,1),v=i?d.decodeVector3(i):void 0,y=l?parseInt(l,10)-1:void 0,b=u?d.unpackFloats(u,4):void 0,w=p?parseFloat(p):void 0;if(m===n.Ey.Panorama&&void 0===y)throw new h(m,"sweep index not defined");if(m!==n.Ey.Panorama&&!v)throw new h(m,"position is falsy");let S=o?f:(new s._fP).setFromEuler(g);m===n.Ey.Panorama&&(S=(0,a.Z)(S));const T={mode:m,quaternion:S,position:v||void 0,sweepIndex:y,floorVisibility:b,zoom:w};return c.debug("Parsed short URL pose data:",T),T}static parseStartObject(e){const t=JSON.parse(decodeURIComponent(e));if(!t.camera_quaternion)throw Error("Start override is missing camera_quaternion");if(!t.camera_position)throw Error("Start override is missing camera_position");const i=d.parseViewmode(t.camera_mode),n=(new s._fP).copy(t.camera_quaternion),o={mode:i,panoId:t.scan_id,position:(new s.Pa4).copy(t.camera_position),quaternion:n,zoom:t.ortho_zoom,floorVisibility:t.floor_visibility};return c.debug("Parsed &start URL pose data:",o),o}static getShortPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:o}){const r=(new s.USm).setFromQuaternion(e.pose.rotation,"XYZ"),a=o.currentSweepIndex,l={};if(t.currentMode===n.Ey.Panorama)r.z=0,l.sr=d.encodeEuler(r),void 0!==a&&(l.ss=a+1);else{l.sm=d.validateViewmode(t.currentMode),l.sr=d.encodeEuler(r),l.sp=d.encodeVector3(e.pose.position);const s=i.getFloorsVisibility();s.length&&i.totalFloors>1&&(l.sf=s)}return t.currentMode===n.Ey.Floorplan&&(l.sz=parseFloat(e.zoom().toFixed(2))),l.sq=d.encodeQuaternion(e.pose.rotation),c.debug(`Short URL params for current location ${JSON.stringify(l)}`),delete l.sq,l}static getStartPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:s}){const o={x:0,y:0,z:0,w:1};o.x=e.pose.rotation.x,o.y=e.pose.rotation.y,o.z=e.pose.rotation.z,o.w=e.pose.rotation.w;const r={x:0,y:0,z:0};r.x=e.pose.position.x,r.y=e.pose.position.y,r.z=e.pose.position.z;const a={camera_mode:d.validateViewmode(t.currentMode),camera_position:r,camera_quaternion:o};return t.currentMode===n.Ey.Panorama?a.scan_id=s.currentSweep:a.floor_visibility=i.getFloorsVisibility(),t.currentMode===n.Ey.Floorplan&&(a.ortho_zoom=e.zoom()),a}static parseViewmode(e){let t=d.DEFAULT_VIEW_MODE;return void 0!==e&&(t=parseInt(e,10)),d.validateViewmode(t)}static validateViewmode(e){if(null===e||!d.VALID_URL_VIEW_MODES.includes(e))throw new h(e);return e}}d.DEFAULT_VIEW_MODE=n.Ey.Panorama,d.VALID_URL_VIEW_MODES=[n.Ey.Panorama,n.Ey.Dollhouse,n.Ey.Floorplan,n.Ey.Outdoor]},17338:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={snapshotSid:e}}}n.id="SET_CAMERA_START"},66997:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>k});var s=i(26247),n=i(37018),o=i(54122),r=i(87694),a=i(71208),l=i(18446),c=i(25799),h=i(77956),d=i(97620),u=i(97631),p=i(17256),m=i(44333),g=i(32400),f=i(70096);class v{serialize(e){return{image:e.sid}}}var y=i(52227);const b=new c.Z("mds-camera-start-store");class w extends g.u{constructor(){super(...arguments),this.deserializer=new f.f,this.serializer=new v}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(y.PatchModel,{modelId:t,patch:i}).then((e=>{b.debug(e)}))}}var S=i(17338),T=i(20331),E=i(41263),_=i(80034),x=i(32020),M=i(68519);const P=e=>{if(!e)return null;const t=new n.O;if(!e.icon)return null;t.modified=(0,x.p)(e&&e.modified),t.icon=e.icon||void 0,t.pose={};const i=Math.ceil(140.625),s=e.image?`${e.image}&width=250&height=${i}&fit=crop&imgopt=1`:void 0;return t.thumb=s?new M.n(s,null):void 0,t},A=(e,t)=>{const i=t&&"icon"in t?t:e;return{modified:(0,x.U)(i.modified),icon:i.icon}};var O=i(15119),D=i(7943),I=i(83032),C=i(21307);class R{constructor(e,t){this.hasChanges=!1,this.changedHandlers=[],e.waitForData(t).then((e=>{this.target=e,e.onChanged((()=>{this.hasChanges=!0,this.triggerChangeHandlers(this.target)}))}))}hasDiffRecord(){return this.hasChanges}getDiffRecord(){return this.target}clearDiffRecord(){this.hasChanges=!1}commitChanges(){this.triggerChangeHandlers(this.getDiffRecord())}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,C.b)(this.changedHandlers,e)}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}var L=i(55580);const N=new c.Z("camera-start");class k extends o.Y{constructor(){super(...arguments),this.name="camera-start",this.store=null}async init(e,t){var i;this.engine=t,[this.storage,this.sweepData,this.modelData,this.snapshotsData]=await Promise.all([t.getModule(u.F),t.market.waitForData(h.Z),t.market.waitForData(L.T),t.market.waitForData(s.P)]),this.store=this.getStore(e);let o=this.modelData.model.image;if(!e.readonly&&this.store instanceof I.N){const e=await this.store.read();e&&e.icon&&(o=e.icon)}const a=r.K.deserialize();if(a){const e=this.parseNavigationPose(a);this.validStartPano(e)?(this.startingPose=new n.B,this.startingPose.copy(e),N.debug("Starting Camera Pose",this.startingPose)):N.error("Invalid start pose",e)}this.bindings.push(this.engine.commandBinder.addBinding(S.n,(async e=>this.updateStartLocationFromSnapshot(e.snapshotSid))),this.storage.onSave((()=>this.save()),{dataType:p.g.START_LOCATION}),this.storage.onRevert((()=>this.revert()),{dataType:p.g.START_LOCATION}));const l=o||void 0,c=this.getIconThumbnail(l),d=this.getIconStartPose(l)||this.getStartFallback();if(null===(i=null==d?void 0:d.pano)||void 0===i?void 0:i.uuid){const e=this.sweepData.getSweep(d.pano.uuid);e&&!e.enabled&&(N.warn(`Enabled hidden start sweep ${d.pano.uuid}`),e.enabled=!0,e.commit())}this.data=new n.O(l,c,d),t.market.register(this,n.O,this.data)}getStore(e){const{modelId:t,baseUrl:i,readonly:s,storageProvider:o,queue:r}=e;if(N.info(`Loading camera start from ${o}`),o===p.Xq.MDS)return new w({readonly:s});const a=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new T.gO,o={data:null},r=`${s}/api/v1/player/models/${t}`;if(i){const e=new _.gh({queue:n,path:r,deserialize:P,cachedData:o});return new E.nM({publishStores:[e]})}const a=new _.yh({queue:n,path:r,httpMethod:_.w$.PATCH,deserialize:P,serialize:A}),l=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,c=new O.Z({queue:n,path:l,cachedData:{data:null},httpMethod:_.w$.PATCH,deserialize:D.S.sessionObjectExtract(O.j.Model,P),serialize:A},O.j.Model);return new E.nM({publishStores:[a],editStore:c,editStoreKey:E.aw.START_LOCATION})}({modelId:t,baseUrl:i,readonly:s,queue:r});if(!s){const e=new R(this.engine.market,n.O);a.addMonitor(e)}return new I.N(a,{dataType:p.g.START_LOCATION,modelId:t,readonly:s,engine:this.engine})}getStartingPose(){return this.startingPose||this.data.pose}parseNavigationPose(e){const{mode:t,quaternion:i,position:s,floorVisibility:n,sweepIndex:o,zoom:r}=e;let{panoId:a}=e;if(!a&&void 0!==o){const e=this.sweepData.getSweepByIndex(o);e?a=e.id:N.debug(`Failed to load sweep index ${o}`)}return{mode:t,camera:{position:s,rotation:i,zoom:r},pano:{uuid:a},floorVisibility:n}}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),s=new n.O(t.sid,t.thumbnailUrl,i);this.data.copy(s),this.data.commit(),this.engine.broadcast(new l.O(t.is360)),await this.engine.commandBinder.issueCommand(new m.VQ({dataTypes:[p.g.START_LOCATION]}))}async save(){const e=this.data.icon;if(!e||!this.store)return void N.warn("Unable to save start location");if(this.store instanceof I.N)return;const t=this.snapshotsData.get(e);return this.store.update(t)}async revert(){if(this.store instanceof I.N)return this.store.revert()}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return t.mode===a.Ey.Panorama&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:a.Ey.Panorama,camera:{position:e.position,rotation:(0,d.Z)(e.rotation),zoom:0},pano:{uuid:e.id}}}validStartPano(e){return!!e&&(e.mode!==a.Ey.Panorama||!!e.pano.uuid&&this.sweepData.containsSweep(e.pano.uuid))}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep();return this.defaultCameraStart(e||this.sweepData.getFirstSweep())}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new n.B).copy(this.buildCameraStart(this.snapshotsData.get(e)))),this.validStartPano(t)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},18446:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.is360=e}}},88069:(e,t,i)=>{"use strict";i.d(t,{lb:()=>n,hf:()=>o});var s=i(24779);const n=(e=200)=>({resizeDimensions:[{property:s.P.width,setDimension:e=>e.width,duration:e},{property:s.P.height,setDimension:e=>e.height,duration:e},{property:s.P.top,setDimension:()=>0,duration:e},{property:s.P.left,setDimension:()=>0,duration:e}]}),o=(e,t,i=200)=>{const n=[];return-1!==e&&n.push({property:s.P.width,setDimension:t=>t.width+e,duration:i}),-1!==t&&n.push({property:s.P.height,setDimension:e=>e.height+t,duration:i}),{resizeDimensions:n}}},34431:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(99681);class n extends s.m{constructor(e,t){super(),this.name="blur-canvas",this.payload={duration:e,pixelBlur:t}}}},24779:(e,t,i)=>{"use strict";i.d(t,{P:()=>s,M:()=>o});var s,n=i(99681);!function(e){e.left="left",e.top="top",e.width="width",e.height="height"}(s||(s={}));class o extends n.m{constructor(e){super(),this.name="resize-canvas",this.payload=Object.assign({},e)}}},69711:(e,t,i)=>{"use strict";i.d(t,{L:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.name="screen-to-canvas-point",this.payload=Object.assign({},e)}}},99169:(e,t,i)=>{"use strict";i.d(t,{W:()=>n});var s=i(19413);class n extends s.V{constructor(e,t){super(),this.name="canvas",this.x=0,this.y=0,this.width=e||0,this.height=t||0;const i=this.width/this.height;this.aspectRatio=isFinite(i)?i:1}copy(e){this.width=e.width,this.height=e.height,this.aspectRatio=e.width/e.height,this.x=e.x,this.y=e.y}}},32818:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var s=i(54122),n=i(99169),o=i(80384),r=i(84637),a=i(24779),l=i(44266),c=i(69711),h=i(62367),d=i(34431),u=i(10396),p=i(17617);class m extends p.y{}class g extends s.Y{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in a.P&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onWindowResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()},this.resizeCanvas=async e=>{if(!e.resizeDimensions)return;this.activeTransitions.forEach(this.resolveActiveTransition.bind(this));const t=e.resizeDimensions.map((e=>{const{property:t,setDimension:i,duration:s}=e;switch(t){case a.P.height:this.setHeight(i,s);break;case a.P.width:this.setWidth(i,s);break;case a.P.top:this.setY(i,s);break;case a.P.left:this.setX(i,s)}const n=new l.Q;return this.activeTransitionMap[t]=n,this.activeTransitions.push(t),n}));return this.resolveNoopTransitions(),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),Promise.all(t)}}async init(e,t){if(this.engine=t,!e.container)throw new m;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.setAttribute("tabindex","-1"),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push((0,u.kp)(u.g_.RESIZE,this.onWindowResize),t.commandBinder.addBinding(a.M,this.resizeCanvas),this.makeTransitionEndSubscription(),t.commandBinder.addBinding(c.L,(async e=>this.screenToCanvasPoint(e.x,e.y))),t.commandBinder.addBinding(d.n,this.blur.bind(this)));for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new n.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,n.W,this.data)}resolveNoopTransitions(){const e=this.containerBounds;this.getNewHeight(e)!==this.data.height&&parseInt(this.transitionDurations[a.P.height],10)||this.resolveActiveTransition(a.P.height),this.getNewWidth(e)!==this.data.width&&parseInt(this.transitionDurations[a.P.width],10)||this.resolveActiveTransition(a.P.width),this.getNewY(e)!==this.data.y&&parseInt(this.transitionDurations[a.P.top],10)||this.resolveActiveTransition(a.P.top),this.getNewX(e)!==this.data.x&&parseInt(this.transitionDurations[a.P.left],10)||this.resolveActiveTransition(a.P.left),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,s=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new o.a(this.width,this.height))),s&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new r.k(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}async blur(e){this.transitionDurations.filter=`${e.duration}ms`,this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this._canvas.style.filter=`blur(${e.pixelBlur}px)`,await(0,h.gw)(e.duration),0===e.pixelBlur&&(this._canvas.style.filter="")}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},22888:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});class s{}},60959:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var s=i(54122),n=i(12775);class o extends s.Y{constructor(){super(...arguments),this.name="common-controls"}async init(e,t){this.modeControls={},t.market.waitForData(n.O).then((e=>this.viewmodeData=e))}startRotateTransition(e,t,i=!0){return this.checkControlsForAction((s=>s.startRotateTransition(e,t,i)))}startZoomTransition(e,t,i=!0){return this.checkControlsForAction((s=>s.startZoomTransition(e,t,i)))}startTranslateTransition(e,t,i=!0){return this.checkControlsForAction((s=>s.startTranslateTransition(e,t,i)))}stop(){return this.checkControlsForAction((e=>(e.stop(),Promise.resolve())))}checkControlsForAction(e){return this.viewmodeData&&null!==this.viewmodeData.currentMode&&this.modeControls[this.viewmodeData.currentMode]?e(this.modeControls[this.viewmodeData.currentMode].controls):Promise.reject("checkControlsForAction() -> Current view mode is null")}addControls(e,t,i=!1){this.modeControls[e]&&!i||(this.modeControls[e]={mode:e,controls:t})}}},63771:(e,t,i)=>{"use strict";i.d(t,{$:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="TOGGLE_PANO_MARKER",this.payload={enabled:e}}}},72075:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(54122),n=i(71208),o=i(2212),r=i(20599);class a{constructor(e,t,i,s,n){this.scene=e,this.viewmodeData=i,this.sweepData=s,this.panoMarkerEnabled=!0,this.material=new o.vBJ({transparent:!0,map:t,depthWrite:!1}),this.mesh=new o.Kj0(a.planeGeometry,this.material),this.mesh.name="CurrentPanoMarker",this.mesh.renderOrder=r.z.panoMarker,this.mesh.layers.mask=n.mask,this.mesh.lookAt(this.mesh.position.clone().setY(1))}init(){}dispose(){this.material.map&&this.material.map.dispose(),this.mesh.geometry.dispose()}render(){const e=this.sweepData.currentAlignedSweepObject;this.panoMarkerEnabled&&this.viewmodeData.currentMode!==n.Ey.Panorama&&this.viewmodeData.currentMode!==n.Ey.Transition&&e?(this.move(e.floorPosition),this.material.opacity=1):this.resetMesh()}activate(){this.scene.add(this.mesh)}deactivate(){this.scene.remove(this.mesh)}togglePanoMarker(e){this.panoMarkerEnabled=e}move(e){this.mesh.position.copy(e).setY(e.y+a.floorOffset)}resetMesh(){this.material.opacity=0}}a.floorOffset=.01,a.planeGeometry=new o._12(.5,.5);var l=i(60778),c=i(50101),h=i(12775),d=i(77956),u=i(99612),p=i(63771);class m extends s.Y{constructor(){super(...arguments),this.name="current-pano-marker"}async init(e,t){const i=(0,l.p)(u),s=(await t.getModule(c.default)).getScene(),n=await t.market.waitForData(d.Z),o=await t.market.waitForData(h.O),r=t.claimRenderLayer(this.name),m=new a(s,i,o,n,r);t.addComponent(this,m),this.bindings.push(t.commandBinder.addBinding(p.$,(async e=>{m.togglePanoMarker(e.enabled)})))}}},90014:(e,t,i)=>{"use strict";i.d(t,{y:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={disable:e}}}},5002:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var s=i(54122),n=i(77518),o=i(71208),r=i(12775),a=i(98728),l=i(75711),c=i(77956),h=i(90014),d=i(39936),u=i(34216);class p extends s.Y{constructor(){super(...arguments),this.name="cursor-controller",this.visibilityRules=[],this.disabled=!1}async init(e,t){this.cursorMesh=await t.getModule(n.default),this.visibilityRules.push((()=>{const e=t.market.tryGetData(r.O);return!!e&&e.closestMode===o.Ey.Panorama}),(()=>{const e=t.market.tryGetData(c.Z);return!!e&&!e.isSweepUnaligned(e.currentSweep)}),(()=>{const e=t.market.tryGetData(a.k3);return!!e&&!e.isTourActive()}),(()=>{const e=t.market.tryGetData(l.Z);return!!e&&!e.isMobile()}),(()=>{const e=t.market.tryGetData(d.e);return!!e&&e.tryGetProperty(u.b,!0)})),this.bindings.push(t.commandBinder.addBinding(h.y,(async e=>{this.disabled=e.disable})))}onUpdate(){this.updateCursorVisibility()}addVisibilityRule(e){this.visibilityRules.push(e)}removeVisibilityRule(e){const t=this.visibilityRules.indexOf(e);-1!==t&&this.visibilityRules.splice(t,1)}updateCursorVisibility(){const e=!this.disabled&&this.visibilityRules.reduce(((e,t)=>e&&t()),!0);this.cursorMesh.setVisible(e)}}},34216:(e,t,i)=>{"use strict";i.d(t,{b:()=>s});const s="features/cursor"},60484:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s=i(54122),n=i(2212),o=i(3834),r=i(36073),a=i(30963),l=i(25799),c=i(24135);const h=new l.Z("cursor-data");class d extends s.Y{constructor(){super(...arguments),this.name="cursor-data",this.cursorState=new o.Y,this.position=new n.FM8,this.timeToFade=0,this.onPointerMove=()=>{if(null!==this.raycasterData.hit&&this.raycasterData.pointerNdcPosition.distanceToSquared(this.position)>d.movementThreshold){this.position.copy(this.raycasterData.pointerNdcPosition),this.timeToFade=d.fadeOutDelay;const e=n.M8C.lerp(0,d.fadeInDuration,1-this.cursorState.opacity.value);this.cursorState.opacity.modifyAnimation(this.cursorState.opacity.value,1,e),this.cursorState.commit()}}}async init(e,t){this.input=await t.getModule(a.default),this.raycasterData=await t.market.waitForData(c.P),t.market.register(this,o.Y,this.cursorState),this.bindings.push(this.input.registerHandler(r.mE,this.onPointerMove)),d.fadeInDuration>d.fadeOutDelay&&h.warn("fadeInDuration should be less than fadeOutDelay!")}onUpdate(e){let t=!1;this.timeToFade>0&&(this.timeToFade-=e,this.timeToFade<=0&&(t=!0)),this.cursorState.opacity.tick(e),this.cursorState.commit(),t&&this.cursorState.opacity.modifyAnimation(1,0,d.fadeOutDuration)}dispose(e){super.dispose(e)}}d.fadeOutDelay=700,d.fadeOutDuration=700,d.fadeInDuration=300,d.movementThreshold=.003},3834:(e,t,i)=>{"use strict";i.d(t,{Y:()=>o});var s=i(290),n=i(19413);class o extends n.V{constructor(){super(),this.name="cursor",this.opacity=new s.z(0)}}},16002:(e,t,i)=>{"use strict";var s;i.d(t,{L:()=>s}),function(e){e[e.Reticle=0]="Reticle",e[e.GridPlane=1]="GridPlane"}(s||(s={}))},77518:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var s=i(54122),n=i(2212),o=i(3834),r=i(24135),a=i(2779),l=i(27829),c=i(60778),h=i(16002),d=i(408),u=i(20599);class p{constructor(e,t=a.o.ALL){this.scene=e,this.layer=t,this.supportsMobile=!1,this.style=h.L.Reticle,this.defaultTexture=(0,c.p)(d),this.bindings=[],this.onOpacityUpdate=e=>{this.material.opacity=e.opacity.value},this.onPositionUpdate=e=>{if(e.hit&&e.hit.face){const t=e.hit.point.clone(),i=e.hit.face.normal;this.container.position.copy(t).addScaledVector(i,.01),this.container.quaternion.setFromUnitVectors(l.f.FORWARD,i)}},this.container=new n.ZAu,this.container.name="cursor";const i=new n._12(.4,.4);this.material=new n.vBJ({side:n.ehD,transparent:!0,depthTest:!0,depthWrite:!1,map:this.defaultTexture});const s=new n.Kj0(i,this.material);this.container.add(s),s.renderOrder=u.z.reticule,s.layers.mask=this.layer.mask}init(){}render(){}dispose(){this.material.map&&this.material.map.dispose(),this.container.children.forEach((e=>{if(e.isMesh){e.geometry.dispose();const t=e.material;t.dispose(),t.map&&t.map.dispose()}}))}async activate(e){const t=await e.market.waitForData(o.Y),i=await e.market.waitForData(r.P);this.bindings.push(t.onChanged(this.onOpacityUpdate),i.onChanged(this.onPositionUpdate)),this.scene.add(this.container)}deactivate(){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}setVisible(e){this.container.visible=e}}var m=i(50101);class g extends s.Y{constructor(){super(...arguments),this.name="cursor-mesh",this.setVisible=e=>{this.cursor&&this.cursor.setVisible(e)}}async init(e,t){const i=(await t.getModule(m.default)).getScene(),s=t.claimRenderLayer(this.name);this.cursor=new p(i,s),t.addComponent(this,this.cursor)}get container(){return this.cursor.container}}},23113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>k});var s=i(54122),n=i(27829),o=i(60959),r=i(30963),a=i(30604),l=i(21588),c=i(78626),h=i(35825),d=i(22767),u=i(40582),p=i(85197),m=i(48840),g=i(12775),f=i(71208),v=i(21265),y=i(97620),b=i(2212),w=i(64279),S=i(25259),T=i(27871),E=i(62513),_=i(45805),x=i(22888),M=i(44266);const P=1e3/60,A=80*y.Ue,O=0*y.Ue,D=Math.PI/1e3,I=_.Z.epsilon;class C extends x.Z{constructor(e,t,i,s=!1){super(),this.cameraPoseProxy=e,this.cameraCheck=t,this.tempOrientation=new b._fP,this.tempAxis=new b.Pa4,this.nextPosition=new b.Pa4,this.nextOrientation=new b._fP,this.currentOrientation=new b._fP,this.currentPosition=new b.Pa4,this.positionDelta=new b.Pa4,this.angularAccel=new b.FM8,this.angularVelocity=new b.FM8,this.linearAccel=new b.FM8,this.linearVelocity=new b.FM8,this.zoomAccel=0,this.zoomVelocity=0,this.cameraOrientation=new b.USm,this.aimTarget=new b.Pa4,this.poseController=null,this.checkBounds=s,this._maxZoomDistance=Math.max(30,1.5*i.getSize(new b.Pa4).length()),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:new b.FM8,linearVelocity:new b.FM8,zoomVelocity:0,easeOut:!1}}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.stop()}get maxZoomDistance(){return this._maxZoomDistance}setOrbitalAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.angularVelocity),this.angularAccel.x=void 0!==e.x?e.x:this.angularAccel.x,this.angularAccel.y=void 0!==e.y?e.y:this.angularAccel.y)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startTransition(e,t,i,s,n){if(null===this.poseController)return M.Q.reject("Unable to start transition, since controller is unavailable.");const o=new M.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=o,this.transition.angularVelocity.copy(t),this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=s,this.transition.easeOut=n,this.angularAccel.set(0,0),this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity.copy(t),this.linearVelocity.copy(i),this.zoomVelocity=s,this.poseController.beginExternalTransition(),o.promise()}stopTransition(){this.transition.active&&(this.poseController&&this.poseController.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,s){let n=1,o=e/P;this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration&&(n=(this.transition.duration-(this.transition.elapsed-e))/e,o=1),t&&(this.angularVelocity.copy(this.transition.angularVelocity).multiplyScalar(n*o),this.orbit(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(n*o),this.pan(this.linearVelocity)),s&&(this.zoomVelocity=this.transition.zoomVelocity*n*o,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,s){const n=e/P;t&&(this.angularVelocity.addScaledVector(this.angularAccel,n),this.orbit(this.angularVelocity),this.angularVelocity.multiplyScalar(Math.pow(.92,n))),i&&(this.linearVelocity.addScaledVector(this.linearAccel,n),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(.92,n))),s&&(this.zoomVelocity+=this.zoomAccel*n,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(.84,n))}startRotateTransition(e,t,i){return t.x*=-1,this.startTransition(e,t.clone().multiplyScalar(P),new b.FM8,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,new b.FM8,t.clone().multiplyScalar(P),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,new b.FM8(0,0),new b.FM8(0,0),t,i).nativePromise()}update(e){const t=this.angularAccel.length()>I||this.angularVelocity.length()>I,i=this.linearAccel.length()>I||this.linearVelocity.length()>I,s=Math.abs(this.zoomAccel)>I||Math.abs(this.zoomVelocity)>I;this.transition.active?this.updateTransition(e,t,i,s):this.updateDefault(e,t,i,s)}stopMomentum(){this.transition.active||(this.angularVelocity.set(0,0),this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setOrbitalAcceleration({x:0,y:0}),this.setPanAcceleration({x:0,y:0}),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose;this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.nextPosition.copy(t.position).add(this.positionDelta),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,t.focalDistance)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition))}orbit(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(t.rotation,"YXZ");const i=-this.cameraOrientation.x,s=(0,y.uZ)(e.y,O-i,A-i);this.aimTarget.copy(n.f.FORWARD).applyQuaternion(t.rotation),this.aimTarget.setLength(t.focalDistance),this.aimTarget.addVectors(t.position,this.aimTarget),this.tempAxis.copy(n.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(t.rotation),-s),this.nextPosition.copy(t.position).sub(this.aimTarget).applyQuaternion(this.tempOrientation),this.nextOrientation.copy(t.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(n.f.UP,e.x),this.nextPosition.applyQuaternion(this.tempOrientation),this.nextOrientation.premultiply(this.tempOrientation),this.nextPosition=this.nextPosition.add(this.aimTarget),this.nextOrientation.normalize(),this.checkBounds&&!this.cameraCheck(t.position,this.nextOrientation,t.focalDistance)||(this.currentPosition.copy(this.nextPosition),this.currentOrientation.copy(this.nextOrientation),t.rotation.equals(this.currentOrientation)||(this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraRotation(this.currentOrientation)))}zoom(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose,i=this.maxZoomDistance-2,s=t.focalDistance,o=(0,y.uZ)(e*i+s,2,this.maxZoomDistance)-s,r=t.focalDistance+o;this.nextPosition.copy(t.position).add(n.f.FORWARD.clone().applyQuaternion(t.rotation).setLength(-o)),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,r)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraFocus(r))}}var R,L=i(75195);class N{constructor(e,t,i){this.poseProxy=e,this.cameraCheck=t,this.raycaster=i,this.movingCamera=!1,this.smoothedTouch0=new b.FM8,this.smoothedTouch1=new b.FM8,this.origTouchAxis=new b.FM8,this.origCenterPt=new b.FM8,this.plane=new b.JOQ(n.f.UP.clone(),0),this.originalPinchLength=0,this.pointersMoved=(()=>{const e=new b.FM8,t=new b.Pa4,i=new b.Pa4,s=new b.FM8,o=new b.Pa4;return r=>{if(!this.poseController)return;this.smoothedTouch0.lerp(r[0].position,.2),this.smoothedTouch1.lerp(r[1].position,.2),s.copy(this.smoothedTouch1).sub(this.smoothedTouch0).normalize();const a=this.origTouchAxis.angle()-s.angle();t.copy(this.initialPose.position);const l=new b.Pa4(-this.intersectionPt.x,0,-this.intersectionPt.z);t.add(l),t.applyAxisAngle(n.f.UP,a),l.negate(),t.add(l);const c=(new b._fP).copy(this.initialPose.rotation),h=(new b._fP).setFromAxisAngle(n.f.UP,a);c.premultiply(h);const d=this.smoothedTouch0.clone().lerp(this.smoothedTouch1,.5),u=new b.Pa4;if(i.copy(n.f.FORWARD).applyQuaternion(c),this.castFrom(d.x,i.y<-.01?d.y:this.origCenterPt.y,u),isNaN(u.x))return void(this.movingCamera=!1);u.x-=this.intersectionPt.x,u.z-=this.intersectionPt.z,u.negate(),u.applyAxisAngle(n.f.UP,a);const p=1-1/(e.subVectors(this.smoothedTouch0,this.smoothedTouch1).length()/this.originalPinchLength),m=t.add(u).lerp(this.intersectionPt,p).clone(),g=o.subVectors(m,this.intersectionPt).length();this.cameraCheck(m,c,g)&&this.poseController&&(this.poseController.updateCameraPosition(m),this.poseController.updateCameraRotation(c),this.poseController.updateCameraFocus(g))}})(),this.initMove=(()=>{const e=new b.FM8,t=new b.zHn,i=new b.Pa4;return s=>{const o=s[0].position,r=s[1].position;this.smoothedTouch0.copy(o),this.smoothedTouch1.copy(r),this.originalPinchLength=e.subVectors(o,r).length(),this.origTouchAxis.copy(r).sub(o).normalize(),this.origCenterPt.copy(o).lerp(r,.5);const{pose:a}=this.poseProxy;this.initialPose=a.clone();const l=new b.Pa4,c=new b.Pa4;(0,L.Kh)(this.initialPose,l.set(this.origCenterPt.x,this.origCenterPt.y,-1),l),(0,L.Kh)(this.initialPose,c.set(this.origCenterPt.x,this.origCenterPt.y,1),c),c.sub(l).normalize();const h=this.raycaster.picking.pick(l,c);h||(t.set(l,c),t.at(a.focalDistance,i)),this.intersectionPt=h?h.point:i,this.plane.set(n.f.UP.clone(),0),this.plane.translate(new b.Pa4(0,this.intersectionPt.y,0))}})(),this.castFrom=(()=>{const e=new b.zHn,t=new b.Pa4,i=new b.Pa4;return(s,n,o)=>{(0,L.Kh)(this.initialPose,t.set(s,n,-1),t),(0,L.Kh)(this.initialPose,i.set(s,n,1),i),i.sub(t).normalize(),e.set(t,i),e.intersectPlane(this.plane,o)&&!o.equals(t)||(o.x=NaN),o.y=0}})()}rawPointerUpdate(e){const t=this.movingCamera;this.movingCamera=2===e.pointers.length&&!!this.poseController,this.movingCamera&&(t?this.pointersMoved(e.pointers):this.initMove(e.pointers))}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.poseController=void 0,this.movingCamera=!1}}!function(e){e[e.NONE=u.r3.NONE]="NONE",e[e.ROTATE=u.r3.PRIMARY]="ROTATE",e[e.PAN=u.r3.SECONDARY]="PAN",e[e.ZOOM=u.r3.MIDDLE]="ZOOM"}(R||(R={}));class k extends s.Y{constructor(){super(...arguments),this.name="dollhouse-controls",this.controlState=R.NONE,this.movementKeys=new b.FM8,this.adjustedBounds=new b.ZzF,this.resetControlState=()=>{this.controlState=R.NONE},this.convertDeltaToLocal=(()=>{const e=new b.Pa4,t=new b.Pa4;return i=>{const s=i.x||0,o=i.y||0,r=2*s*this.cameraPoseProxy.pose.focalDistance,a=2*o*this.cameraPoseProxy.pose.focalDistance/this.cameraPoseProxy.pose.aspect();return e.copy(n.f.RIGHT).applyQuaternion(this.cameraPoseProxy.pose.rotation).setY(0).setLength(r),t.copy(n.f.FORWARD).applyQuaternion(this.cameraPoseProxy.pose.rotation),e.add(t.setY(0).setLength(a)),e}})(),this.cameraCheck=(()=>{function e(e){return e.x>=1||e.x<=-1||e.y>=1||e.y<=-1||e.z<=-1||e.z>=1}const t=[];for(let e=0;e<8;e++)t.push(new b.Pa4);const i=new b.yGw,s=new b.yGw,o=new b.ZzF;return(r,a,l)=>{if(l<2)return!1;if(!(0,y.cb)(r,a,this.cameraPoseProxy.pose.projection,this.adjustedBounds))return!1;(0,y.jB)(this.meshData.bounds,t),i.compose(r,a,n.f.UNIT),i.invert(),s.copy(this.cameraPoseProxy.pose.projection.asThreeMatrix4()),o.makeEmpty();let c=!1;for(let e=0;e<8;e++)t[e].applyMatrix4(i),t[e].z=(0,y.uZ)(t[e].z,-w.oR.far,-w.oR.near),t[e].applyMatrix4(s),o.expandByPoint(t[e]);return c=e(o.min)||e(o.max),o.min.clampScalar(-1,1),o.max.clampScalar(-1,1),(o.max.x-o.min.x)*(o.max.y-o.min.y)>(c?.5:.1)}})()}async init(e,t){this.cameraPoseProxy=e.cameraPoseProxy;const i=await t.getModule(p.default);this.modelMesh=i.mesh,[this.viewmodeData,this.meshData,this.commonControlsModule]=await Promise.all([t.market.waitForData(g.O),t.market.waitForData(T._),t.getModule(o.default)]),this.bindings.push(t.subscribe(m.Z,(e=>{this.controls.stop(),this.resetControlState()})));const s=await t.getModule(r.default);this.modelSize=Math.max(this.modelMesh.boundingBox.getSize(new b.Pa4).length(),1),this.setupBounds(),this.controls=new C(this.cameraPoseProxy,this.cameraCheck,this.modelMesh.boundingBox,!0),this.commonControlsModule.addControls(f.Ey.Dollhouse,this.controls);const n=await t.getModule(E.default);this.cameraTouchControls=new N(this.cameraPoseProxy,this.cameraCheck,n),this.bindings.push(s.registerHandler(a.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(s.registerHandler(l.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(s.registerHandler(l._R,(e=>{this.validateViewmode()&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(P),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons))}))),this.bindings.push(s.registerHandler(l._t,(e=>{this.validateViewmode()&&(this.onDrag(e.delta),this.controls.update(P),this.controls.stop())}))),this.bindings.push(s.registerHandler(S.h,(e=>{this.validateViewmode()&&this.cameraTouchControls.rawPointerUpdate(e)}))),this.bindings.push(s.registerHandler(c.e,(e=>{this.validateViewmode()&&e.state!==d.M.PRESSED&&this.onKey(e.key,e.state)}))),this.cameraPoseProxy.newSession(this)}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onAccessGranted(e){this.controls.onAccessGranted(e),this.cameraTouchControls.onAccessGranted(e)}onAccessRevoked(e){this.controls.onAccessRevoked(e),this.cameraTouchControls.onAccessRevoked(e)}onScrollWheel(e){if(0!==e.delta.y){const t=1/this.cameraPoseProxy.pose.focalDistance*2,i=this.modelSize;this.controls.setZoomAcceleration(.1*e.delta.y/(t*i*500)),this.controls.update(P),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===R.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case R.ROTATE:this.controls.setOrbitalAcceleration({x:-Math.PI*e.x,y:-Math.PI*e.y});break;case R.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case R.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=R.NONE,(0,v.tq)()&&this.controls.stop())}onKey(e,t){const i=t===d.M.DOWN;let s=!1;switch(e){case h.R.LEFTARROW:case h.R.J:this.controls.setOrbitalAcceleration({x:i?D:0},!0);break;case h.R.RIGHTARROW:case h.R.L:this.controls.setOrbitalAcceleration({x:i?-D:0},!0);break;case h.R.UPARROW:case h.R.I:this.controls.setOrbitalAcceleration({y:i?-D:0},!0);break;case h.R.DOWNARROW:case h.R.K:this.controls.setOrbitalAcceleration({y:i?D:0},!0);break;case h.R.W:this.movementKeys.y=i?1:0,s=!0;break;case h.R.S:this.movementKeys.y=i?-1:0,s=!0;break;case h.R.D:this.movementKeys.x=i?1:0,s=!0;break;case h.R.A:this.movementKeys.x=i?-1:0,s=!0}if(s){const e=this.convertDeltaToLocal(this.movementKeys).setLength(.02);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===f.Ey.Dollhouse}setupBounds(){function e(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}this.adjustedBounds.copy(this.modelMesh.boundingBox),this.adjustedBounds.min.x=e(this.adjustedBounds.min.x,4),this.adjustedBounds.min.y=e(this.adjustedBounds.min.y,4),this.adjustedBounds.min.z=e(this.adjustedBounds.min.z,4),this.adjustedBounds.max.x=e(this.adjustedBounds.max.x,-4),this.adjustedBounds.max.y=e(this.adjustedBounds.max.y,-4),this.adjustedBounds.max.z=e(this.adjustedBounds.max.z,-4);const t=new b.Pa4,i=new b.Pa4;this.modelMesh.boundingBox.getCenter(t),this.adjustedBounds.getSize(i),this.adjustedBounds.setFromCenterAndSize(t,i)}}},26956:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(54122),n=i(50266),o=i(62513),r=i(50101),a=i(2212),l=i(27829);class c extends s.Y{constructor(){super(...arguments),this.name="fat-caster",this.rayAssembly=new Array(c.rayCount),this.rayPlaneOrientation=new a._fP,this.rayVisuals=[]}async init(e,t){this.config={debug:!!e.debug},this.raycaster=await t.getModule(o.default);for(let e=0;e<c.rayCount;++e)this.rayAssembly[e]=new a.zHn;if(e.debug){const e=(await t.getModule(r.default)).getScene();for(let t=0;t<c.rayCount;++t){this.rayVisuals[t]=new a.tGC(new a.Pa4,new a.Pa4);const i=this.rayVisuals[t];i.remove(i.cone),i.setLength(1e3),e.add(this.rayVisuals[t])}}}async dispose(e){const t=(await e.getModule(r.default)).getScene();for(const e of this.rayVisuals)t.remove(e)}get ray(){return this.raycaster.pointer.pointerRay.clone()}cast(e,t,i=n.a.Filter.AVERAGE){const s=this.ray;return this.updateRayAssembly(s.origin,s.direction,e),this.castRays(t,i)}castRays(e,t){const i=[];let s=null;for(const t of this.rayAssembly){const n=this.raycaster.picking.pick(t.origin,t.direction,e);n&&(t===this.rayAssembly[0]&&(s=n),n.point.add(this.rayAssembly[0].origin).sub(t.origin),i.push(n))}return t(i,s,this.rayAssembly)}updateRayAssembly(e,t,i){for(const e of this.rayAssembly)e.direction.copy(t);if(this.rayPlaneOrientation.setFromUnitVectors(l.f.FORWARD,t),this.rayAssembly[0].origin.copy(e),this.rayAssembly[1].origin.copy(l.f.RIGHT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[2].origin.copy(l.f.UP).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[3].origin.copy(l.f.LEFT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[4].origin.copy(l.f.DOWN).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[5].origin.copy(l.f.UP).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[6].origin.copy(l.f.UP).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[7].origin.copy(l.f.DOWN).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[8].origin.copy(l.f.DOWN).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.config.debug)for(let e=0;e<this.rayVisuals.length;++e){const i=this.rayVisuals[e];i.setDirection(t),i.position.copy(this.rayAssembly[e].origin)}}}c.rayCount=9},50266:(e,t,i)=>{"use strict";i.d(t,{a:()=>s});var s,n=i(2212);!function(e){let t;!function(e){const t=e=>{for(const t of e)if(t.face)return{point:t.point,object:t.object,distance:t.distance,face:t.face};return null},i=(e,t)=>e.distance-t.distance;e.CENTER_FIRST=(e,i)=>i&&i.face?{point:i.point,normal:i.face.normal,object:i.object,distance:i.distance,face:i.face}:t(e),e.CLOSEST=e=>t(e.sort(i)),e.AVERAGE=e=>{if(0===e.length)return null;const t={point:new n.Pa4,face:new n.G_f(0,1,2),distance:0,object:e[0].object};for(const i of e)t.face&&i.face&&(t.point.add(i.point),t.face.normal.add(i.face.normal));return t.point.divideScalar(e.length),t.face&&t.face.normal.divideScalar(e.length).normalize(),t},e.CENTER_GROUP=t=>(i,n,o)=>{if(n){const s=[n];for(let e=1;e<i.length&&e<3;++e){const r=i[e];if(r.face){const i=Math.abs(o[e].direction.dot(r.face.normal));n.point.distanceTo(r.point)*i<=t&&s.push(r)}}if(s.length>=3){const t=e.AVERAGE(s,null,o);if(t&&t.face&&n.face)return t.face.normal=n.face.normal,t}}const r=s(i,o,t);return r?e.AVERAGE(r,null,o):e.CENTER_FIRST(i,n,o)};const s=(e,t,s)=>{const n=e.slice().sort(i),o=[n[0]];let r;for(r=1;r<n.length&&o.length<3;++r){const e=n[r];if(e.face){const i=Math.abs(t[r].direction.dot(e.face.normal));o[0].point.distanceTo(e.point)*i>s&&(o.length=0),o.push(e)}}return o.length<3?null:o}}(t=e.Filter||(e.Filter={}))}(s||(s={}))},88225:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload=Object.assign({},e)}}},43232:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetFloorIntersectCommand:()=>s.Z,default:()=>w});var s=i(88225),n=i(70785),o=i(54122),r=i(50101),a=i(89155),l=i(75195),c=i(25936),h=i(12775),d=i(71208),u=i(62513),p=i(67399),m=i(61718),g=i(24975),f=i(91055),v=i(2212),y=i(27829);class b extends o.Y{constructor(){super(...arguments),this.name="floor-caster",this.cameraPosition=new v.Pa4,this.forwardPosition=new v.Pa4,this.targetPlane=new v.JOQ}async init(e,t){this.engine=t,[this.renderer,this.cameraData,this.viewmodeData,this.raycaster,this.floorsData]=await Promise.all([t.getModule(r.default),t.market.waitForData(a.M_),t.market.waitForData(h.O),t.getModule(u.default),t.market.waitForData(c.i)]),t.commandBinder.addBinding(s.Z,(e=>this.castToFloor(e.screenPosition,e.height,e.includeHiddenFloors)))}async castToFloor(e,t,i=!0){await this.engine.after(n.A.End);const s=this.renderer.getScene().camera,o=(0,l.z5)(e.x,e.y,this.cameraData.width,this.cameraData.height);let r,a=null;this.cameraPosition.set(o.x,o.y,-1).unproject(s),this.forwardPosition.set(o.x,o.y,1).unproject(s);const c=this.raycaster.picking.cast(this.cameraPosition,this.forwardPosition.clone().sub(this.cameraPosition).normalize(),i?g.T0:g.Pv)[0];if(c&&c.object instanceof m.S&&(a=c&&c.point||null,p.$4.hasFloorId(c.object)?r=this.floorsData.getFloor(c.object.floorId):a&&(r=this.floorsData.getClosestFloorAtHeight(a.y))),void 0!==t){this.cameraPosition.copy(this.cameraData.pose.position);const e=(0,l.st)(this.cameraData,o);if(this.viewmodeData.currentMode!==d.Ey.Floorplan){const i=(0,f.n0)(this.cameraPosition,e);this.targetPlane.set(y.f.DOWN,t),a=(0,f.Fe)(this.cameraPosition,i,this.targetPlane)||null}else e.y=t,a=e}const h=r?r.index:-1;return{position:a,floor:h,floorIndex:h}}}const w=b},41397:(e,t,i)=>{"use strict";i.d(t,{SI:()=>n,O8:()=>o,YW:()=>r,Gu:()=>a,bC:()=>l,JU:()=>c,Ct:()=>h,Tm:()=>d,TD:()=>u,mP:()=>p,jX:()=>m,N4:()=>g});var s=i(21265);const n=1e3/60,o=.05,r=Math.PI/2/1e3,a=.1/60,l=.02,c=25,h=3,d=3,u=.16,p=(0,s.V5)()?45:(0,s.Kr)()?20:35,m=.01,g=2},43344:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var s=i(54122),n=i(2212),o=i(30963),r=i(56040),a=i(27829),l=i(41397),c=i(45805),h=i(97620),d=i(91055),u=i(22888),p=i(44266);class m extends u.Z{constructor(e,t,i,s=!1){super(),this.cameraModule=e,this.targetProjection=new r.M,this.currentOrientation=new n._fP,this.currentPosition=new n.Pa4,this.positionDelta=new n.Pa4,this.angularAccel=0,this.angularVelocity=0,this.linearAccel=new n.FM8,this.linearVelocity=new n.FM8,this.zoomAccel=0,this.zoomVelocity=0,this.scale=1,this.maxZoom=0,this.minZoom=l.Tm,this.checkBounds=s,this.bounds=t.clone(),this.boundsCenter=i.clone(),this.setupBounds(),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:0,linearVelocity:new n.FM8,zoomVelocity:0,easeOut:!1}}start(){this.scale=1,this.maxZoom=this.cameraModule.getData(!1).defaultZoom()*l.Ct}setRollAcceleration(e,t=!1){this.transition.active||(t&&e&&this.angularVelocity&&Math.sign(e)!==Math.sign(this.angularVelocity)&&(this.angularVelocity=0),this.angularAccel=e)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startRotateTransition(e,t,i){return this.startTransition(e,t.x*l.SI,new n.FM8,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,0,t.clone().multiplyScalar(l.SI),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,0,new n.FM8(0,0),t,i).nativePromise()}startTransition(e,t,i,s,n){const o=new p.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=o,this.transition.angularVelocity=t,this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=s,this.transition.easeOut=n,this.angularAccel=0,this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity=t,this.linearVelocity.copy(i),this.zoomVelocity=s,this.cameraModule.beginExternalTransition(),o.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,s){let n=1,o=e/l.SI;this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration&&(n=(this.transition.duration-(this.transition.elapsed-e))/e,o=1),t&&(this.angularVelocity=this.transition.angularVelocity*o*n,this.roll(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(n*o),this.pan(this.linearVelocity)),s&&(this.zoomVelocity=this.transition.zoomVelocity*n*o,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,s){const n=e/l.SI;t&&(this.angularVelocity=this.angularVelocity+this.angularAccel*n,this.roll(this.angularVelocity),this.angularVelocity*=Math.pow(1-l.O8,n)),i&&(this.linearVelocity.addScaledVector(this.linearAccel,n),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(1-l.O8,n))),s&&(this.zoomVelocity=this.zoomVelocity+this.zoomAccel*n,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(1-l.TD,n))}update(e){const t=Math.abs(this.angularAccel)>c.Z.epsilon||Math.abs(this.angularVelocity)>c.Z.epsilon,i=this.linearAccel.length()>c.Z.epsilon||this.linearVelocity.length()>c.Z.epsilon,s=Math.abs(this.zoomAccel)>c.Z.epsilon||Math.abs(this.zoomVelocity)>c.Z.epsilon;this.transition.active?this.updateTransition(e,t,i,s):this.updateDefault(e,t,i,s)}stopMomentum(){this.transition.active||(this.angularVelocity=0,this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setPanAcceleration({x:0,y:0}),this.setRollAcceleration(0),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){const t=this.cameraModule.getData(!1);this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.currentPosition.copy(t.pose.position).add(this.positionDelta),this.checkBounds&&!this.insideBounds(this.currentPosition,t.pose.rotation,t.pose.projection)||this.cameraModule.updateCameraPosition(this.currentPosition)}roll(e){const t=this.cameraModule.getData(!1);this.currentOrientation.setFromAxisAngle(a.f.FORWARD,e),this.currentOrientation.multiplyQuaternions(t.pose.rotation,this.currentOrientation),this.currentOrientation.normalize(),this.checkBounds&&!this.insideBounds(t.pose.position,this.currentOrientation,t.pose.projection)||t.pose.rotation.equals(this.currentOrientation)||this.cameraModule.updateCameraRotation(this.currentOrientation)}zoom(e){const t=this.cameraModule.getData(!1);this.targetProjection.copy(t.pose.projection);const i=this.scale*(1-e);if(Math.abs(i-this.scale)>c.Z.epsilon){this.targetProjection.elements[0]*=i/this.scale,this.targetProjection.elements[5]*=i/this.scale;const s=(0,d.S3)(this.targetProjection);if(e<0&&s<=this.minZoom||e>0&&s>=this.maxZoom)return;if(this.checkBounds&&!this.insideBounds(t.pose.position,t.pose.rotation,this.targetProjection))return;this.scale=i,this.cameraModule.updateCameraProjection(this.targetProjection.clone())}}setupBounds(){this.bounds.min.x=this.adjustBound(this.bounds.min.x,2),this.bounds.min.y=this.adjustBound(this.bounds.min.y,2),this.bounds.min.z=this.adjustBound(this.bounds.min.z,2),this.bounds.max.x=this.adjustBound(this.bounds.max.x,-2),this.bounds.max.y=this.adjustBound(this.bounds.max.y,-2),this.bounds.max.z=this.adjustBound(this.bounds.max.z,-2),this.worldBounds=(new n.ZzF).setFromCenterAndSize(this.boundsCenter,new n.Pa4(this.bounds.max.x-this.bounds.min.x,this.bounds.max.y-this.bounds.min.y,this.bounds.max.z-this.bounds.min.z))}insideBounds(e,t,i){return!!(0,h.cb)(e,t,i,this.worldBounds)}adjustBound(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}}var g,f=i(89895),v=i(12775),y=i(40582),b=i(35825),w=i(22767),S=i(71208),T=i(48840),E=i(39869),_=i(30604),x=i(21588),M=i(93735),P=i(22079),A=i(78626),O=i(60959),D=i(85197),I=i(89155);!function(e){e[e.NONE=y.r3.NONE]="NONE",e[e.PAN=y.r3.PRIMARY]="PAN",e[e.ROTATE=y.r3.SECONDARY]="ROTATE",e[e.ZOOM=y.r3.MIDDLE]="ZOOM"}(g||(g={}));class C extends s.Y{constructor(){super(...arguments),this.name="floorplan-controls",this.controlState=g.NONE,this.controlsEngaged=!1,this.movementKeys=new n.FM8,this.resetControlState=()=>{this.controlState=g.NONE}}async init(e,t){const[i,s,r,a,c]=await Promise.all([t.getModule(D.default),t.getModule(f.default),t.getModule(O.default),t.market.waitForData(I.M_),t.market.waitForData(v.O)]);this.cameraModule=s,this.cameraData=a,this.viewmodeData=c,this.modelMesh=i.mesh,this.modelSize=Math.max(this.modelMesh.boundingBox.getSize(new n.Pa4).length(),1),this.commonControlsModule=r,this.controls=new m(this.cameraModule,this.modelMesh.boundingBox,this.modelMesh.center,!0),this.commonControlsModule.addControls(S.Ey.Floorplan,this.controls),t.getModule(o.default).then((e=>{this.bindings.push(e.registerHandler(_.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(e.registerHandler(x.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(e.registerHandler(x._t,(e=>{this.validateViewmode()&&(this.controlsEngaged=!0,this.onDrag(e.delta),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(x._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(l.SI),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons),this.controlsEngaged=!1)}))),this.bindings.push(e.registerHandler(M.G,(e=>{this.validateViewmode()&&(this.controls.setZoomAcceleration(-e.pinchDelta*l.N4),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(M.i,this.resetControlState)),this.bindings.push(e.registerHandler(P.D,(e=>{this.validateViewmode()&&(this.controls.setRollAcceleration(e.rotateDelta),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(P.u,this.resetControlState)),this.bindings.push(e.registerHandler(A.e,(e=>{this.validateViewmode()&&e.state!==w.M.PRESSED&&this.onKey(e.key,e.state)})))})),this.bindings.push(t.subscribe(T.Z,(e=>{this.controls.stop(),this.resetControlState()}))),this.bindings.push(t.subscribe(E.Z,(e=>{e.toMode===S.Ey.Floorplan&&this.controls.start()})))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onScrollWheel(e){if(0!==e.delta.y){const t=(0,h.et)(this.modelSize,1,1500,2,.125);this.controls.setZoomAcceleration(e.delta.y*l.jX/(t*l.mP)),this.controls.update(l.SI),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===g.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case g.ROTATE:this.controls.setRollAcceleration(e.x*Math.PI);break;case g.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case g.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=g.NONE)}onKey(e,t){const i=t===w.M.DOWN;let s=!1;switch(e){case b.R.LEFTARROW:case b.R.J:this.controls.setRollAcceleration(i?l.YW:0,!0);break;case b.R.RIGHTARROW:case b.R.L:this.controls.setRollAcceleration(i?-l.YW:0,!0);break;case b.R.A:this.movementKeys.x=i?-1:0,s=!0;break;case b.R.D:this.movementKeys.x=i?1:0,s=!0;break;case b.R.W:this.movementKeys.y=i?1:0,s=!0;break;case b.R.S:this.movementKeys.y=i?-1:0,s=!0;break;case b.R.K:case b.R.DOWNARROW:this.controls.setZoomAcceleration(i?l.Gu:0);break;case b.R.I:case b.R.UPARROW:this.controls.setZoomAcceleration(i?-l.Gu:0)}if(s){const e=this.convertDeltaToLocal(this.movementKeys).setLength(l.bC);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===S.Ey.Floorplan}convertDeltaToLocal(e){const t=e.x||0,i=e.y||0,s=t/this.cameraData.pose.projection.elements[0],o=i/this.cameraData.pose.projection.elements[5],r=new n.Pa4;return r.set(s,o,0),r.applyQuaternion(this.cameraData.pose.rotation),r}}},41479:(e,t,i)=>{"use strict";i.d(t,{P:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.floorId=e,this.floorName=t}}},12527:(e,t,i)=>{"use strict";i.d(t,{O:()=>a});var s=i(2212);class n{constructor(){this.list=[]}insort(e){const t=this.binarySearch(e);let i=t.index;if(!t.success)for(;this.compare(e,this.list[i])>=0&&i<this.list.length;)i++;for(let e=this.list.length;e>i;e--)this.list[e]=this.list[e-1];this.list[i]=e}removeIndex(e){if(e>this.list.length)throw Error("OrderList.removeIndex() -> Invalid index: "+e);this.list.splice(e,1)}getElement(e){if(e>=0&&e<this.list.length)return this.list[e];throw new Error("OrderList.getElement() -> Invalid index: "+e)}get length(){return this.list.length}find(e){const t=this.binarySearch(e);return t.success?t.index:-1}compare(e,t){return void 0===t?1:"number"==typeof e?e===t?0:e<t?-1:1:e.compare(t)}binarySearch(e){let t=0,i=this.list.length-1,s=-1,n=null,o=0;for(;t<=i;){if(s=Math.floor((t+i)/2),n=this.list[s],o=this.compare(e,n),0===o)return{success:!0,index:s};o<0?i=s-1:t=s+1}return{success:!1,index:s}}}var o=i(46162),r=i(78909);class a extends r.T{constructor(e={}){super(),this.name="",this.center=new s.Pa4,this.boundingBox=new s.ZzF,this.size=new s.Pa4,this.sweepHeights=new n,this.sweepFloorHeights=new n,this.medianSweepHeight=()=>this.sweepHeights.length>0?this.sweepHeights.getElement(Math.floor(this.sweepHeights.length/2)):this.center.y,this.minSweepFloorHeight=()=>this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(0):this.boundingBox.min.y,Object.assign(this,e)}setBounds(e){this.boundingBox.copy(e),this.boundingBox.getSize(this.size),this.boundingBox.getCenter(this.center)}addSweep(e){this.sweepHeights.insort(e.position.y),this.sweepFloorHeights.insort(e.floorPosition.y)}get bottom(){return this.minSweepFloorHeight()}deepCopy(){return(0,o.p$)({id:this.id,meshGroup:this.meshGroup,index:this.index,name:this.name,center:this.center,boundingBox:this.boundingBox,size:this.size,medianSweepHeight:this.medianSweepHeight(),bottom:this.bottom})}}},7121:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.from=e,this.to=t}}},59340:(e,t,i)=>{"use strict";i.d(t,{M:()=>n});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.index=e,this.from=t,this.to=i}}},25936:(e,t,i)=>{"use strict";i.d(t,{i:()=>c});var s=i(19413),n=i(12527),o=i(71229),r=i(25799),a=i(63986);const l=new r.Z("floor-data");class c extends s.V{constructor(e){super(),this.name="floors",this.floors=(0,o.q)(e)}getFloor(e){if(!this.floors.has(e))throw new a.H;return this.floors.get(e)}hasFloor(e){return this.floors.has(e)}getFloorAtIndex(e){return this.floors.values.find((t=>t.index===e))}getFloorByMeshGroup(e){return this.floors.values.find((t=>t.meshGroup===e))}mapMeshesToFloors(e){for(const t of e){if(!("meshGroup"in t))return void l.warn("No DAM mesh group found on mesh",t);let e=this.getFloorByMeshGroup(t.meshGroup);e||(e=new n.O({id:String(t.meshGroup),meshGroup:t.meshGroup,index:t.meshGroup}),this.floors.set(e.id,e)),e.setBounds(t.boundingBox),t.floorId=e.id;for(const i of t.roomMeshes)i.floorId=e.id}this.getOrderedValues().forEach(((e,t)=>{e.index=t}))}getFloorCount(){return this.floors.length}getCollection(){return this.floors}iterate(e){return this.getOrderedValues().forEach(e)}getTopFloor(){const e=this.getOrderedValues();if(!e.length)throw new a.H("Cannot get top floor, model has no floors");return e[e.length-1]}getBottomFloor(){const e=this.getOrderedValues();if(!e.length)throw new a.H("Cannot get bottom floor, model has no floors");return e[0]}getFloorContainingPoint(e,t=!1){const i=t?this.floors.keys.reverse():this.floors.keys;for(const t of i){const i=this.floors.get(t);if(i.boundingBox.containsPoint(e))return i}return null}getFloorAtHeight(e,t=!1){const i=this.getOrderedValues();t&&i.reverse();for(const t of i){const i=t.boundingBox;if(i.min.y<=e&&e<=i.max.y)return t}const s=this.getBottomFloor();return e<s.boundingBox.min.y?s:this.getTopFloor()}getClosestFloorAtHeight(e){let t,i=1/0;for(const s of this.floors){const n=Math.abs(s.medianSweepHeight()-e);i>n&&(i=n,t=s)}return t}rename(e,t){if(!this.floors.has(e))return;const i=this.floors.get(e);i.name=t,i.commit()}getOrderedValues(){return this.floors.values.sort(((e,t)=>e.index-t.index))}}},63986:(e,t,i)=>{"use strict";i.d(t,{H:()=>n});var s=i(17617);class n extends s.y{constructor(e="Invalid Floor"){super(e),this.name="InvalidFloorException"}}},77787:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var s=i(67399);const n=(e,t)=>s.$4.hasFloorId(t.object)?t.object.floorId:e.getClosestFloorAtHeight(t.point.y).id},67940:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>F});var s=i(2212),n=i(83032),o=i(54122),r=i(60841),a=i(64614),l=i(83083),c=i(25936),h=i(85197),d=i(97631),u=i(44333),p=i(17256),m=i(77956),g=i(57369),f=i(25799),v=i(6875),y=i(32400),b=i(51770),w=i(12527);const S=new f.Z("mds-floor-deserializer");class T{deserialize(e){if(!e||!this.validate(e))return S.debug("Deserialized invalid floor data from MDS",e),null;const t=e.label||"",i=e.dimensions||{},{areaFloor:s}=i;return new w.O({id:e.id,index:e.sequence,meshGroup:e.meshId,name:t,areaFloor:s||-1})}validate(e){return["id","sequence","meshId"].every((t=>t in e))}}class E{serialize(e){return{label:e.name}}}class _ extends y.u{constructor(){super(...arguments),this.deserializer=new T}async read(){const e=this.getViewId();return this.query(v.GetFloors,{modelId:e}).then((e=>(0,b.qw)(e,"data.model.floors").reduce(((e,t)=>{const i=this.deserializer.deserialize(t);return i&&(e[t.id]=i),e}),{})))}async update(e,t){const i=this.getViewId(),s=(new E).serialize(t);if(!s)throw new Error("Could not update Floor");return this.mutate(v.PatchFloor,{modelId:i,floorId:e,data:s})}}var x=i(80034),M=i(41263),P=i(7943),A=i(15119),O=i(20331),D=i(63986),I=i(46162);const C=e=>e.replace(/,/gi," ").trim(),R=e=>{if(!e||!e.floors)return null;const t={};return e.floors.split(",").forEach(((e,i)=>{const s=e.trim();s&&(t[i]=new w.O({id:String(i),name:s,meshGroup:i,index:i}))})),t},L=(e,t)=>{const i=(0,I.p$)(e);(0,I.TS)(i,t);const s=[];for(const e in i){const t=i[e];if(!t)continue;const n=C(t.name||""),o=parseInt(e,10);if(isNaN(o))throw new D.H(`Can't save non-numeric floor ID ${o}`);s[o]=n}return{floors:s.join(",")}};var N=i(59340);const k=new f.Z("floors-data");class F extends o.Y{constructor(){super(...arguments),this.name="floors"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.configureStorage(e);const[s,o,a,g]=await Promise.all([this.store.read(),t.getModule(h.default),t.market.waitForData(m.Z),t.getModule(d.F)]),f=a.getSweepList();if(this.data=new c.i(s||{}),this.data.mapMeshesToFloors([...o.mesh.floorMeshes]),this.mapSweepsToFloors(f),t.market.register(this,c.i,this.data),this.fixupManuallyPlacedSweepsWithoutFloorData(f),!1===i){const e=this.data.getCollection();this.monitor=new l.c(e,{aggregationType:r.E.NextFrame},t),this.store instanceof n.N?this.store.addMonitor(this.monitor):this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new u.VQ({dataTypes:[p.g.FLOORS]})))),this.bindings.push(g.onSave((()=>this.save()),{dataType:p.g.FLOORS}),g.onRevert((()=>this.revert()),{dataType:p.g.FLOORS}))}}configureStorage(e){const{modelId:t,baseUrl:i,queue:s}=e,o=e.storageProvider||p.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;if(k.info(`Loading floors from ${o}`),o===p.Xq.MDS)return new _({readonly:r,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new O.gO,o={data:null},r=`${s}/api/v1/player/models/${t}`;if(i){const e=new x.gh({queue:n,path:r,deserialize:R,cachedData:o});return new M.iY({publishStores:[e]})}const a=new x.yh({queue:n,path:r,httpMethod:x.w$.PATCH,deserialize:R,serialize:L}),l=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,c=new A.Z({queue:n,path:l,cachedData:{data:null},deserialize:P.S.sessionObjectExtract(A.j.FloorNames,R),serialize:L},A.j.FloorNames);return new M.iY({publishStores:[a],editStore:c,editStoreKey:M.aw.FLOOR_NAMES})}({modelId:t,baseUrl:i,readonly:r,queue:s});return new n.N(a,{dataType:p.g.FLOORS,modelId:t,readonly:r,engine:this.engine})}onUpdate(){}mapSweepsToFloors(e){e.forEach((e=>{if(e.alignmentType===g.z9.ALIGNED){const t=e.floorId?this.data.getFloor(e.floorId):this.data.getClosestFloorAtHeight(e.position.y);t&&t.addSweep(e)}}))}fixupManuallyPlacedSweepsWithoutFloorData(e){const t=new s.Pa4;for(const i of e)if(i.placementType===g.hU.MANUAL&&!i.floorId){t.setY(i.position.y);const e=this.data.getFloorAtHeight(i.position.y),s=e?e.id:i.floorId;s!==i.floorId&&(k.debug(`Setting sweep ${i.id} from floor ${i.floorId} to ${s}`),this.engine.broadcast(new N.M(i.index,i.floorId,s))),i.floorId=s}}getFloorMins(){const e=[];return this.data.iterate((t=>{e.push(t.bottom)})),e}async save(){const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=[];for(const i of e){const e=i.index;if(!e)throw new D.H(`Invalid floor '${i.index}'`);i.action===a.KI.updated&&t.push(this.store.update(e,i.diff))}return Promise.all(t)}async revert(){if(this.store instanceof n.N)return this.store.revert()}}},22729:(e,t,i)=>{"use strict";i.d(t,{c:()=>a});var s=i(290),n=i(19413),o=i(29359),r=i(5442);class a extends n.V{constructor(e,t,i){super(),this.floors=e,this.name="floors-view",this.currentFloorObservable=new r.f(null),this._observableFloorsSelectMode=new r.f(!1),this._observableRoomSelectMode=new r.f(!1),this._showFloorSelection=new r.f(!1),this.getFloorMin=e=>{const t=e||this.currentFloorId||this.bottomFloorId;return this.floors.getFloor(t).bottom},this.isHidden=e=>{const t=!this.currentFloorId,i=!(!e||e!==this.currentFloorId),s=this.config.viewingAlignedPano();return!(t||i||s)},this.getHighestVisibleFloor=()=>this.currentFloor?this.currentFloor:this.floors.getTopFloor(),this.getHighestVisibleFloorId=()=>this.getHighestVisibleFloor().id,this.updateViewData=()=>{this.floors.iterate((e=>{this.derivedData[e.id]={id:e.id,index:e.index,name:this.getFloorName(e.id)}})),this.commit()},this.getViewData=e=>{const t=this.floors.getFloor(e);return this.derivedData[e]||(this.derivedData[e]={id:t.id,index:t.index,name:this.getFloorName(t.id)}),this.derivedData[e]},this.getFloor=e=>this.floors.getFloor(e),this.config=null!=i?i:{floorChangesEnabled:()=>!0,roomNavFeatureEnabled:()=>!0,viewingAlignedPano:()=>!0},this.localize=null!=t?t:function(e){return e},this.derivedData={},this._transition={from:null,to:null,progress:new s.z(0),promise:Promise.resolve()},this.updateViewData()}isCurrentOrAllFloors(e){return!e||!this.currentFloorId||e===this.currentFloorId}makeFloorChangeSubscription(e){return this.currentFloorObservable.onChanged(e)}get currentFloor(){return this.currentFloorObservable.value}get currentFloorId(){return!!this.currentFloorObservable.value&&this.currentFloorObservable.value.id||null}get bottomFloorId(){return this.floors.getBottomFloor().id}get topFloorId(){return this.floors.getTopFloor().id}get nearestFloor(){let e;return e=this.transitionActive?this.transition.progress.value>.5?this.transition.to:this.transition.from:this.currentFloorId,e?this.floors.getFloor(e):void 0}get transitionActive(){return this.transition.progress.active}get transition(){return this._transition}transitionToFloorInstant(e){this.currentFloorObservable.value=e?this.floors.getFloor(e):null,this.commit()}transitionToFloor(e,t,i,s){const n=this._transition.progress;n.modifyAnimation(0,1,i),this._transition={from:e,to:t,progress:n,promise:s},this.commit(),s.then((()=>{this.transitionToFloorInstant(t)}))}get totalFloors(){return this.floorsEnabled?this.floors.getFloorCount():1}iterate(e){this.floors.iterate((t=>{const i=this.getViewData(t.id);i&&e(i)}))}getFloorNames(){const e=[];return this.floorsEnabled?(this.floors.iterate((t=>{e[t.index]=this.getFloorName(t.id)})),e):e}getFloorName(e){if(!e)return this.localize(o.Z.FLOOR_ALL);const t=this.floors.getFloor(e);return void 0!==t.name&&""!==t.name?t.name:this.localize(o.Z.FLOOR_NAME)+(t.index+1)}getFloorsVisibility(){if(this.currentFloorId){const e=[];return this.floors.iterate((t=>{e[t.index]=t.id===this.currentFloorId?1:0})),e}return[]}get floorsEnabled(){return this.config.floorChangesEnabled()}get floorSelectModeEnabled(){return this.config.roomNavFeatureEnabled()}get floorSelectModeActive(){return this._observableFloorsSelectMode.value}set floorSelectModeActive(e){this._observableFloorsSelectMode.value=e&&this.floorsEnabled&&this.floorSelectModeEnabled,this.commit()}onFloorSelectModeChange(e){return this._observableFloorsSelectMode.onChanged(e)}get showFloorSelection(){return this._showFloorSelection.value}set showFloorSelection(e){this._showFloorSelection.value=e&&this.floorSelectModeActive,this.commit()}onShowFloorSelectionChanged(e){return this._showFloorSelection.onChanged(e)}get roomSelectModeActive(){return this._observableRoomSelectMode.value}set roomSelectModeActive(e){this._observableRoomSelectMode.value=e&&this.floorSelectModeEnabled||!this.floorSelectModeEnabled,this.commit()}onRoomSelectModeChange(e){return this._observableRoomSelectMode.onChanged(e)}}},86682:(e,t,i)=>{"use strict";i.d(t,{Vw:()=>n,h9:()=>o,EU:()=>r});var s=i(99681);class n extends s.m{constructor(e,t=!1,i,s){super(),this.id="MOVETO_FLOOR",this.payload={floorId:e,suppressCameraMovement:t,transitionTime:i,focusPoint:s}}}class o extends s.m{constructor(e,t=!1,i,s){super(),this.id="MOVETO_FLOOR_NUMBER",this.payload={floorIndex:e,suppressCameraMovement:t,transitionTime:i,focusPoint:s}}}class r extends s.m{constructor(e){super(),this.id="SHOW_ALL_FLOORS",this.payload=e}}},60243:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>pe});var s=i(54122),n=i(25799),o=i(89895),r=i(85197),a=i(30963),l=i(79994),c=i(50101),h=i(78626),d=i(73706),u=i(35825),p=i(22767),m=i(77956),g=i(12775),f=i(89155),v=i(27871),y=i(41479),b=i(56022),w=i(48840),S=i(24135),T=i(71208),E=i(98728),_=i(48769),x=i(29675),M=i(25936),P=i(2212),A=i(97620),O=i(15782),D=i(67399);class I{constructor(e,t,i,s,n,o,r,a,l){this.getAngleModifier=e,this.pose=t,this.floorsViewData=i,this.viewmodeData=s,this.sweepData=n,this.raycasterData=o,this.floorMeshes=r,this.meshData=a,this.touchDevice=l,this.floorTargetOpacity={},this.getDiscardDistance=e=>e?4+(this.pose.focalDistance*O.xx.DISCARD_FOCAL_MULTI||0):0}activate(){}init(){}dispose(){}deactivate(){for(const e of this.floorMeshes)for(const t of e.roomMeshes)t.opacity=1}beforeRender(){const e=this.floorsViewData.nearestFloor,t=this.floorsViewData.transition.progress.active,i=!(!e||this.viewmodeData.isPano());let s=O.xx.FADE_OPAQUE,n=s,o=s;const r=this.getAngleModifier();i&&(this.floorsViewData.floorSelectModeEnabled?(n=s*r*O.xx.FADE_IN_VALUE,o=n):(n=O.xx.FADE_ABOVE,o=O.xx.FADE_BELOW)),this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&this.viewmodeData.isPano()&&(s=0,n=0,o=0);for(const e of this.floorMeshes){const i=this.floorsViewData.floors.getFloorByMeshGroup(e.meshGroup);let r=s;const a=this.isBelowSelectedFloor(i)?o:n,l=(0,A.uZ)(a+O.xx.FADE_IN_HOVER_BOOST_VALUE,0,1);r=this.isHoveredFloor(null==i?void 0:i.id)&&!t&&a>0?l:a,r=this.isFloorTransitioningOut(i)?a:r,r=this.isSelectedFloor(null==i?void 0:i.id)||this.isFloorTransitioningIn(i)?s:r,r=this.clampForViewmodeTransitions(r),this.floorTargetOpacity[e.meshGroup]=r}}render(){const e=!(!this.floorsViewData.nearestFloor||!this.viewmodeData.isDollhouse());for(const t of this.floorMeshes)for(const i of t.roomMeshes){const s=i.opacity,n=this.floorTargetOpacity[i.meshGroup];i.opacity=P.M8C.lerp(s,n,.2),i.transparentFadeDist=this.getDiscardDistance(e&&i.meshGroup>t.meshGroup)}}clampForViewmodeTransitions(e){if(this.viewmodeData.currentMode===T.Ey.Transition){const{to:t}=this.viewmodeData.transition;if(t===T.Ey.Panorama)return Math.max(1-this.meshData.opacity.value,e)}return e}isHoveredFloor(e){if(void 0!==e&&this.raycasterData.hit&&this.viewmodeData.isDollhouse()&&!this.touchDevice){const t=this.raycasterData.hit.object;if(D.$4.hasFloorId(t))return e===t.floorId}return!1}isSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!t||!(!e||t.id!==e)}isBelowSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!!(e&&t&&t.index>e.index)}isFloorTransitioningIn(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.to&&this.floorsViewData.transition.to!==e.id)}isFloorTransitioningOut(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.from&&this.floorsViewData.transition.from!==e.id&&this.floorsViewData.transition.to===e.id)}}var C=i(44266),R=i(7121),L=i(28247),N=i(47924),k=i(55525),F=i(27829),B=i(85995),U=i(91055),H=i(17321),G=i(81733),V=i(63986);class z{constructor(e,t,i,s,n,o,r,a,l){this.engine=e,this.floorsData=t,this.floorsViewData=i,this.sweepData=s,this.cameraData=n,this.cameraModule=o,this.viewmodeData=r,this.updateCurrentFloor=a,this.meshData=l,this.FLOOR_TRANSITION_TIME=500,this.moveFloorUp=(e=!1,t)=>{const i=this.floorsViewData.currentFloor,s=Math.min(this.floorsViewData.totalFloors,i?i.index+1:0);return this.moveToFloorIndex(s,e,t)},this.moveFloorDown=(e=!1,t)=>{const i=this.floorsViewData.currentFloor,s=Math.max(0,i?i.index-1:0);return this.moveToFloorIndex(s,e,t)},this.moveToFloor=(e,t=!1,i,s)=>{const n=this.floorsViewData.currentFloorId,o=n===e,r=this.floorsViewData.totalFloors<2&&!e,a=e?this.floorsViewData.floors.getFloor(e):null;if(o||r||!this.floorsViewData.floorsEnabled)return this.updateCurrentFloor(e),C.Q.resolve();if(a&&!this.canMoveToFloor(a,t))return C.Q.reject(new V.H("Invalid floor ID"));this.engine.broadcast(new R.S(n,e)),void 0===i&&(i=this.FLOOR_TRANSITION_TIME);const l=new C.Q;let c;this.floorsViewData.transitionToFloor(n,e,i,l.nativePromise()),this.floorsViewData.commit();let h=s,d=Promise.resolve();const u=e?H.nK:e=>e=>this.floorsViewData.isCurrentOrAllFloors(e.floorId),p=[(0,H._T)(),(0,H._k)(),u(e)],m=[(0,G.l0)(s||this.cameraData.pose.position)],g=this.sweepData.sortByScore(p,m).shift();let f;g&&(h=g.sweep.position,c=g.sweep.id,(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan())&&(d=this.engine.commandBinder.issueCommand(new B.aK(c)))),f=t?Promise.resolve():this.getCameraTransition(e,i,c,h);const v=this,y=C.Q.all([l,f,d]);return this.engine.startGenerator((function*(){let e=Date.now();for(;v.floorsViewData.transition.progress.active;){yield new L.Jj;const t=Date.now(),i=t-e;v.floorsViewData.transition.progress.tick(i),v.floorsViewData.commit(),e=t}v.updateCurrentFloor(v.floorsViewData.transition.to),l.resolve()})),y}}moveToFloorIndex(e,t=!1,i,s){let n=null;if(-1!==e){const t=this.floorsViewData.floors.getFloorAtIndex(e);if(!t)return C.Q.reject(new V.H(`Invalid floor index ${e}`));n=t.id}return this.moveToFloor(n,t,i,s)}canMoveToFloor(e,t=!1){if(!e)return!1;const i=this.floorsViewData.transition.progress.active,s=this.cameraData.canTransition()||t,n=e.index<=this.floorsViewData.totalFloors-1,o=e.index>=-1;return!i&&s&&n&&o}getCameraTransition(e,t,i,s){if(this.viewmodeData.currentMode===T.Ey.Dollhouse||this.viewmodeData.currentMode===T.Ey.Floorplan){const i=this.getPoseForFloor(e,s);return this.cameraModule.moveTo({transitionType:N.n.Interpolate,pose:i.pose,focalDistance:i.focalDistance,transitionTime:t}).nativePromise()}return this.viewmodeData.currentMode===T.Ey.Panorama&&i?this.engine.commandBinder.issueCommand(new k.ju({transition:N.n.Interpolate,sweep:i})):Promise.resolve()}getPoseForFloor(e,t){const{position:i,rotation:s}=this.cameraData.pose,n=e?this.floorsData.getFloor(e):null,o=n?n.medianSweepHeight():this.meshData.center.y,r=n?n.center:this.meshData.center;r.setY(o);const a=F.f.FORWARD.clone().applyQuaternion(s),l=i.clone();let c,h;if(t){const e=i.clone().addScaledVector(a,this.cameraData.pose.focalDistance),s=(new P.Pa4).set(0,i.y,0),n=(new P.Pa4).set(0,e.y,0),r=s.distanceTo(n);l.setY(o+r);const d=e.clone().setY(t.y);h=d.distanceTo(l),this.viewmodeData.isDollhouse()&&(c=(0,U.n0)(l,d))}else{const e=(n?n.size.y:j)/2+j*-a.y;l.setY(o+e),h=l.distanceTo(r)}return{focalDistance:h,pose:{position:l,rotation:c}}}}const j=8;var W=i(22729),Z=i(86682),q=i(1799);class K{constructor(e,t,i){this.floorsViewData=e,this.viewmodeData=t,this.pose=i,this.vectors={lookDir:new P.Pa4,flattenedLookDir:new P.Pa4},this.getAngleModifier=this.getAngleModifier.bind(this)}update(){const e=this.getAngleModifier(),t=1===this.floorsViewData.totalFloors,i=!!this.floorsViewData.nearestFloor,s=!this.viewmodeData.isPano()&&!this.viewmodeData.transitionActive();this.floorsViewData.roomSelectModeActive=s&&(t||i&&e<1),this.floorsViewData.floorSelectModeActive=s&&1===e&&!t,this.floorsViewData.showFloorSelection=!this.viewmodeData.transitionActive()&&this.viewmodeData.currentMode===T.Ey.Dollhouse&&i&&!t}getAngleModifier(){const e=this.vectors.lookDir.copy(F.f.FORWARD).applyQuaternion(this.pose.rotation),t=this.vectors.flattenedLookDir.copy(e).setY(0),i=e.angleTo(t)*A.MN,s=O.xx.FADE_IN_START_ANGLE,n=O.xx.FADE_IN_END_ANGLE,o=1-(0,A.dS)(i,s,n,0,1);return(0,q.FG)(o,0,1,1)}}var Y=i(57501),$=i(53999),Q=i(75158),X=i(75712),J=i(76258),ee=i(7065),te=i(30041),ie=i(58286);class se{constructor(e,t,i,s,n,o,r,a){this.input=e,this.issueCommand=t,this.floorsRenderer=i,this.floorsViewData=s,this.meshData=n,this.cameraData=o,this.toolsData=r,this.appData=a,this.container=new P.ZAu,this.floorLabels={},this.state={hovered:null,targetOpacity:{}},this.inputBindings=[],this.centerModel=(()=>{const e=new P.Pa4,t=new P.Pa4,i=new P.Pa4,s={};return n=>{let o=s[n.id];void 0===o&&(o=n.medianSweepHeight());const r=this.cameraData.pose.position;return i.copy(n.center).setY(o),t.copy(this.meshData.center).setY(o),i.distanceTo(t)>10&&t.copy(i),(0,A.Xe)(t,r,.9*r.distanceTo(t),e),e}})(),this.setupInput=()=>{const e=X.s.is((e=>e instanceof oe&&this.floorsViewData.currentFloorId!==e.userData.floorId)),t=e=>this.floorsViewData.floorSelectModeActive&&!!this.state.targetOpacity[e.collider.floorId],i=(0,Y.k1)((()=>{this.beforeRender();for(const e of Object.values(this.floorLabels))t(e)?this.input.registerMesh(e.collider,!1):this.input.unregisterMesh(e.collider)}),(()=>{for(const e of Object.values(this.floorLabels))this.input.unregisterMesh(e.collider)}),!1),s=(0,Y.k1)((()=>{}),(()=>{this.issueCommand(new J.u(ee.C.DEFAULT)),this.state.hovered=null}),!1),n=this.input.registerMeshHandler(d.z,e,((e,t)=>{this.issueCommand(new J.u(ee.C.FINGER)),this.state.hovered=t.floorId})),o=this.input.registerMeshHandler(d.A,X.s.isType(oe),(()=>{this.issueCommand(new J.u(ee.C.DEFAULT)),this.state.hovered=null})),r=this.input.registerMeshHandler(Q.R,e,((e,t)=>{this.issueCommand(new Z.Vw(t.floorId))})),a=new $.V(i,n,o,r,s);return a.cancel(),a},this.container.name="FloorLabels",this.textStyle=te.u.makeConfig({color:"white",align:"left",background:!1,backgroundAsCollider:!0,backgroundColliderType:oe,backgroundColor:"white",opacity:0,backgroundOpacity:0,outline:!0,outlineWidth:6,backgroundBorderHeight:10,backgroundBorderWidth:10,wordWrapWidth:768,scale:1}),this.inputBindings.push(this.setupInput())}init(){}activate(){this.onModeChange||(this.onModeChange=this.floorsViewData.onFloorSelectModeChange((e=>{this.inputBindings.forEach((t=>e?t.renew():t.cancel()))}))),this.floorsViewData.iterate((e=>{this.state.targetOpacity[e.id]=0,this.container.add(this.getOrCreateLabel(e.id))})),this.onModeChange&&this.onModeChange.renew()}dispose(){}deactivate(){this.onModeChange&&this.onModeChange.cancel(),this.floorsViewData.iterate((e=>{this.container.remove(this.getOrCreateLabel(e.id))}))}beforeRender(){const e=this.appData.phase===x.nh.PLAYING;if(!e)return;const t=null!==this.toolsData.activeToolName,i=e&&!t&&this.floorsViewData.floorSelectModeActive,s=null===this.floorsViewData.currentFloorId;this.floorsViewData.iterate((e=>{const t=this.getOrCreateLabel(e.id);if(i||t.opacity>0){t.text=e.name;const i=this.floorsRenderer.isSelectedFloor(e.id);this.renderLabel(t,e,i,s)}i||(this.state.targetOpacity[e.id]=0)}))}render(){for(const e of Object.keys(this.state.targetOpacity)){const t=this.getOrCreateLabel(e),i=this.state.targetOpacity[e];t.opacity!==i&&(t.opacity=P.M8C.lerp(t.opacity,this.state.targetOpacity[e],.15))}}renderLabel(e,t,i,s){const n=this.floorsViewData.getFloor(t.id),o=this.centerModel(n);e.position.copy(o),e.quaternion.copy(this.cameraData.pose.rotation),e.scaleBillboard(this.cameraData.pose.position,this.cameraData.pose.rotation,this.cameraData.pose.projection,this.cameraData.zoom(),this.cameraData.height,this.cameraData.aspect(),.065);const r=this.state.hovered===t.id||this.floorsRenderer.isHoveredFloor(t.id),a=r||i&&!s?ne.ColorSelected:s?ne.ColorWhite:ne.ColorDefault;e.setColorHex(a);const l=i||s?ne.OpacitySelected:r?ne.OpacityHovered:ne.OpacityDefault;this.state.targetOpacity[t.id]=l}getOrCreateLabel(e){if(!this.floorLabels[e]){const t=new ne(Object.assign({},this.textStyle));t.scaleType=ie.N.NDC,t.opacity=0,this.state.targetOpacity[e]=0,t.collider.floorId=e,this.input.registerMesh(t.collider,!1),this.container.add(t),this.floorLabels[e]=t,this.container.updateMatrixWorld()}return this.floorLabels[e]}}class ne extends ie.${}ne.OpacityDefault=.8,ne.OpacityHovered=.95,ne.OpacitySelected=1,ne.ColorWhite=16777215,ne.ColorDefault=11908275,ne.ColorSelected=16724312;class oe extends P.Kj0{}var re=i(21265),ae=i(82138),le=i(39936),ce=i(47173),he=i(39869),de=i(62431);const ue=new n.Z("floors-view-data");class pe extends s.Y{constructor(){super(...arguments),this.name="floors-viewdata",this.updateCurrentFloor=e=>{this.config.allowFloorChanges&&this.floorsViewData.currentFloorId!==e&&(this.floorsViewData.transitionToFloorInstant(e),this.engine.broadcast(new y.P(e,this.floorsViewData.getFloorName(e))))}}async init(e,t){this.engine=t,this.config=e;const[i,s,n,h]=await Promise.all([t.market.waitForData(M.i),t.market.waitForData(le.e),t.getModule(l.default),t.market.waitForData(x.pu)]);this.applicationData=h,this.floorsData=i,this.settingsData=s;const d={floorChangesEnabled:()=>this.config.allowFloorChanges,roomNavFeatureEnabled:()=>this.config.focusBasedNav,viewingAlignedPano:()=>void 0!==this.sweepData.currentAlignedSweepObject&&this.viewmodeData.isPano()};if(this.floorsViewData=new W.c(this.floorsData,n.t.bind(n),d),this.floorSelectFeatureEnabledCheck(),t.market.register(this,W.c,this.floorsViewData),[this.viewmodeData,this.sweepData,this.cameraData,this.input,this.raycasterData]=await Promise.all([t.market.waitForData(g.O),t.market.waitForData(m.Z),t.market.waitForData(f.M_),t.getModule(a.default),t.market.waitForData(S.P)]),this.config.allowFloorChanges&&this.viewmodeData.currentMode===T.Ey.Panorama&&this.sweepData.currentSweepObject){const e=this.sweepData.currentSweepObject.floorId;e&&(ue.debug(`Set initial floor to ${e} from current sweep`),this.updateCurrentFloor(e))}const[u,p,y]=await Promise.all([t.getModule(o.default),t.market.waitForData(v._),t.getModule(r.default)]);this.floorNavigation=new z(t,this.floorsData,this.floorsViewData,this.sweepData,this.cameraData,u,this.viewmodeData,this.updateCurrentFloor,p),this.floorsSelectModeHelper=new K(this.floorsViewData,this.viewmodeData,this.cameraData.pose);const P=new I(this.floorsSelectModeHelper.getAngleModifier,this.cameraData.pose,this.floorsViewData,this.viewmodeData,this.sweepData,this.raycasterData,y.mesh.floorMeshes.copyToList([]),p,(0,re.Jm)());if(t.addComponent(this,P),this.config.focusBasedNav&&this.config.allowFloorChanges){this.registerFloorHoverCursorEffect();const e=new se(this.input,t.commandBinder.issueCommand,P,this.floorsViewData,p,this.cameraData,await this.engine.market.waitForData(_.t),this.applicationData);t.addComponent(this,e),t.getModule(c.default).then((t=>t.getScene().add(e.container)))}this.bindings.push(this.registerKeys(),this.floorsData.onChanged(this.floorsViewData.updateViewData),t.subscribe(b.Z,(e=>{const t=this.sweepData.getSweep(e.toSweep);t&&this.updateCurrentFloor(t.floorId)})),t.subscribe(w.Z,function(e,t,i){let s=!1;return n=>{const o=e.tryGetData(E.k3);if(!o||o&&o.isTourActive())return;n.toMode===T.Ey.Panorama&&(s=null!==i.currentFloorId);const r=n.fromMode===T.Ey.Panorama,a=n.toMode===T.Ey.Floorplan,l=n.toMode===T.Ey.Dollhouse;if(!r||!l&&!a)return;const c=s||a?i.currentFloorId:null;t(new Z.Vw(c,!0,0))}}(t.market,t.commandBinder.issueCommand,this.floorsViewData)),t.commandBinder.addBinding(Z.Vw,(async e=>this.floorNavigation.moveToFloor(e.floorId,e.suppressCameraMovement,e.transitionTime,e.focusPoint))),t.commandBinder.addBinding(Z.h9,(async e=>this.floorNavigation.moveToFloorIndex(e.floorIndex,e.suppressCameraMovement,e.transitionTime,e.focusPoint))),t.commandBinder.addBinding(Z.EU,(async e=>{const i="boolean"==typeof e.moveCamera&&!e.moveCamera;await t.commandBinder.issueCommand(new Z.Vw(null,i))})),t.subscribe(he.Z,(()=>this.updateFloorSelectMode())),this.cameraData.pose.onChanged((()=>this.updateFloorSelectMode())),this.floorsViewData.onChanged((()=>this.updateFloorSelectMode())),s.onPropertyChanged(ce.w,(()=>this.floorSelectFeatureEnabledCheck())),s.onPropertyChanged(de.gx.FloorSelect,(()=>this.floorSelectFeatureEnabledCheck())),this.applicationData.onPropertyChanged("application",(()=>this.floorSelectFeatureEnabledCheck()))),this.updateFloorSelectMode()}onUpdate(){}updateFloorSelectMode(){var e;null===(e=this.floorsSelectModeHelper)||void 0===e||e.update()}floorSelectFeatureEnabledCheck(){const e=this.settingsData.tryGetProperty(ce.w,!0),t=this.settingsData.tryGetProperty(de.gx.FloorSelect,!0),i=this.applicationData.application===x.Mx.WORKSHOP;this.toggleFloors(i||e&&t)}toggleFloors(e){e||null===this.floorsViewData.currentFloorId||this.updateCurrentFloor(null),this.config.allowFloorChanges=e,this.updateFloorSelectMode()}registerKeys(){return this.input.registerHandler(h.e,(async e=>{if(!this.cameraData.canTransition())return;const t=e.modifiers.shiftKey,i=this.floorsViewData.getHighestVisibleFloor(),s=i?(i.index+1)%this.floorsViewData.totalFloors:0,n=i?(i.index-1)%this.floorsViewData.totalFloors:0;if(e.state===p.M.PRESSED)switch(e.key){case u.R.UPARROW:t&&this.floorNavigation.moveToFloorIndex(s);break;case u.R.DOWNARROW:t&&this.floorNavigation.moveToFloorIndex(n);break;case u.R.R:this.floorNavigation.moveFloorUp();break;case u.R.F:this.floorNavigation.moveFloorDown();break;case u.R.Y:this.floorNavigation.moveToFloor(null)}}))}registerFloorHoverCursorEffect(){const e=X.s.is((e=>e instanceof ae.g&&e.raycastEnabled&&this.floorsViewData.floorSelectModeActive)),t=new $.V(this.input.registerMeshHandler(d.z,e,((e,t)=>{this.engine.commandBinder.issueCommand(new J.u(ee.C.FINGER))})),this.input.registerMeshHandler(d.A,e,((e,t)=>{this.engine.commandBinder.issueCommand(new J.u(ee.C.DEFAULT))})));t.cancel();const i=(()=>{let e=!1;return()=>{const i=this.floorsViewData.floorSelectModeActive;i!==e&&(e=i,e?t.renew():(t.cancel(),this.engine.commandBinder.issueCommand(new J.u(ee.C.DEFAULT))))}})();i(),this.bindings.push(this.viewmodeData.onChanged(i),this.floorsViewData.onFloorSelectModeChange(i),this.floorsViewData.makeFloorChangeSubscription(i),t)}}},47173:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s,w:()=>n});const s="features/roomnav",n="features/floorselect"},71583:(e,t,i)=>{"use strict";i.d(t,{Bz:()=>n,rE:()=>o,Mn:()=>r});var s=i(99681);class n extends s.m{constructor(e,t){super(),this.payload={modal:e,open:t}}}n.id="TOGGLE_MODAL";class o extends s.m{constructor(){super()}}o.id="CLOSE_MODAL";class r extends s.m{constructor(e){super(),this.payload={open:e}}}r.id="TOGGLE_ICON_TOOLBAR"},96240:(e,t,i)=>{"use strict";i.d(t,{Q:()=>H,Z:()=>V});var s=i(26605),n=i(94184),o=i(2116),r=i(21265),a=i(74674),l=i(90601),c=i(43098),h=i(73305),d=i(55994),u=i(36520),p=i(99898),m=i(88686),g=i(63239),f=i(18120);let v=class extends s.Component{constructor(e){super(e)}render(){const{appendClass:e,progress:t,error:i}=this.props,o={"upload-error":!!i};e&&Object.keys(e).length>0&&Object.assign(o,e);const r=i===g.AttachmentUploadError.SUPPORT_COMING_SOON;return(0,s.h)("div",{class:n("attachment","attachment-upload",o)},(0,s.h)("div",{class:"upload-status"},i&&!r&&(0,s.h)("span",{class:"icon icon-error"}),i&&r&&(0,s.h)("span",{class:"upload-msg"},"Support coming soon"),!i&&(0,s.h)(f.$,{progress:t,innerRadius:20,barWidth:4})))}};v=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],v);var y=i(42733),b=i(35825),w=i(98867),S=i(80807),T=i(71313),E=i(53189),_=i(59064);let x=class extends s.Component{constructor(e){super(e),this.wordToken=null,this.linkElement=null,this.wordElement=null,this.onClickAnchor=e=>{const t=e.target,i=t.dataset.blocktype;this.props.active?(e.preventDefault(),i===a.C.LINK&&this.prepareLinkForEdit(t)):i!==a.C.HASH&&i!==a.C.USER||this.props.onClickBlock({blockType:i,text:t.innerText,value:t.dataset.value})},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.onSelectionChange=()=>{const e=this.getCurrentRange();e&&(this.range=e.cloneRange(),this.wordElement&&null===this.wordElement.parentElement&&this.endWordMatching())},this.onInput=e=>{const t=this.getMarkdown();this.props.onInput(t),this.filterSuggestions(e)},this.onClickMatch=e=>{const t=e.currentTarget;if(t){const i=t.dataset.value,s=t.dataset.text||t.innerText;e.stopPropagation(),this.chooseMatch(s,i)}},this.onHoverMatch=e=>{const t=e.currentTarget;if(t){const e=parseInt(t.dataset.index||"0",10);this.setState({activeMatch:e})}},this.onClick=e=>{const{active:t,onClickToEdit:i}=this.props;t?(this.removeFauxHighlight(),this.range=null):i&&i(e)},this.onKeyPress=e=>{const{users:t,hashtags:i}=this.props,{matches:s,activeMatch:n}=this.state;e.stopPropagation();const o=e.key,r=e.which||e.keyCode;if((e.ctrlKey||e.metaKey)&&["b","i","u"].includes(o))return e.preventDefault(),!1;if(r===b.R.ESCAPE)return this.props.onCancelEditing&&this.props.onCancelEditing(),!1;const a=[b.R.TAB,b.R.RETURN,b.R.DOWNARROW,b.R.UPARROW,b.R.SPACE];if("keydown"===e.type&&!a.includes(r))return!1;const l=e.target;this.props.maxLength&&l.innerText.length>this.props.maxLength&&e.preventDefault();let c=this.range;c||(c=this.range=this.getCurrentRange());const h=[];if(t&&h.push("@"),i&&h.push("#"),h.length){const t=[","," ",".","!","?","/",";",":"];if(h.includes(o))return e.preventDefault(),this.startWordMatching(o),!0;this.wordToken&&this.wordElement&&t.includes(o)&&(e.preventDefault(),this.finishWordElement(o))}switch(r){case b.R.TAB:case b.R.RETURN:if(s.length&&this.state.activeMatch>-1)return e.preventDefault(),this.chooseMatch(s[n].text,s[n].value),!0;this.wordToken&&this.finishWordElement(""),e.shiftKey||(e.preventDefault(),this.props.onDoneEditing&&this.props.onDoneEditing());break;case b.R.DOWNARROW:s.length&&(e.preventDefault(),this.setState((e=>({activeMatch:Math.min(e.activeMatch+1,s.length-1)}))));break;case b.R.UPARROW:s.length&&(e.preventDefault(),this.setState((e=>({activeMatch:Math.max(e.activeMatch-1,-1)}))))}return!1},this.saveRef=e=>{this.textBox=e},this.state={activeMatch:-1,matches:[],sortedSuggestions:[]}}componentDidMount(){this.props.active&&(this.textBox,document.addEventListener("selectionchange",this.onSelectionChange))}componentWillUnmount(){this.props.active&&document.removeEventListener("selectionchange",this.onSelectionChange)}componentWillReceiveProps(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(this.endWordMatching(),this.setState({sortedSuggestions:[]}),i!==e.active&&(this.toggleEditing(!!e.active),e.active||this.textBox.replaceTextContent(e.text)))}componentDidUpdate(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(i?document.addEventListener("selectionchange",this.onSelectionChange):document.removeEventListener("selectionchange",this.onSelectionChange))}getTextElement(){return this.textBox.getTextElement()}toggleEditing(e){this.textBox&&this.textBox.toggleEditing(e)}focus(){this.textBox&&this.textBox.focus()}getMarkdown(){return T.v.serialize(this.getTextElement(),!!this.props.hashtags)}hasTextSelected(){return!(!this.range||this.range.startOffset===this.range.endOffset)}prepareLinkForEdit(e){const t=e||this.getAnchorFromSelection();let i="";const s=window.getSelection();s&&(t||this.range?(this.addFauxHighlight(),t||(i=this.range?this.range.toString():s.toString())):(this.textBox.focus(),s.selectAllChildren(this.getTextElement()),s.collapseToEnd(),this.range=s.getRangeAt(0),i=this.range.toString())),this.linkElement=t;const n=t?t.innerText:i,o=t?t.href:"";this.props.onClickBlock({blockType:a.C.LINK,text:n,value:o})}saveLink(e,t){this.linkElement?""!==t?(this.linkElement.text=e,this.linkElement.href=t):this.unlink(this.linkElement):this.linkify(e,t)}linkify(e,t){this.execCommand("backColor","transparent"),this.execCommand("createLink",t);const i=this.getAnchorFromSelection();i&&(i.text=e,i.className=`link-annotation ${T.o.LINK}`,i.setAttribute("data-blocktype",a.C.LINK),i.onclick=this.onClickAnchor)}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!(0,w.j)(i)&&this.execCommand("insertText",i))}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.getTextElement())return null;t=t.parentNode}return t||null}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=this.getTextElement(),i=e.getRangeAt(0);if(t===i.commonAncestorContainer||t.compareDocumentPosition(i.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return i}return null}getCurrentRange(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.getTextElement()===t.commonAncestorContainer||this.getTextElement().compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}getSortedUsers(e){return this.sortWords(e.map((e=>({text:e.name,value:e.id,blockType:a.C.USER}))))}getSortedHashtags(e){return this.sortWords(e.map((e=>({text:e,blockType:a.C.HASH}))))}sortWords(e){return e.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}filterSuggestions(e){const t=this.wordElement?this.wordElement.textContent:null;if(this.wordToken&&t){const i=t.toLowerCase(),s=e?this.state.sortedSuggestions.filter((e=>0===`${this.wordToken}${e.text.toLowerCase()}`.indexOf(i))):[],n=s.length>0?0:-1;this.setState({matches:s,activeMatch:n})}}chooseMatch(e,t){if(this.wordElement){const i=e.replace(/ /g,"&nbsp;");this.replaceWord(`${this.wordToken}${i}`,t)}}startWordMatching(e){const{users:t,hashtags:i}=this.props;let s=[];if("@"===e&&t)s=this.getSortedUsers(t);else{if("#"!==e||!i)return;s=this.getSortedHashtags(i)}this.wordToken=e,this.createWordElement(e),this.setState({sortedSuggestions:s}),s.length&&this.wordElement&&this.filterSuggestions(e)}endWordMatching(){this.setState({matches:[],activeMatch:-1}),this.wordToken=null,this.wordElement=null}createWordElement(e){const t=window.getSelection(),i=this.range;if(!i||!t)return;const s=document.createElement("a");s.removeAttribute("href"),s.innerText=e,i.insertNode(s),i.selectNodeContents(s),i.collapse(!1),this.applyRange(),this.wordElement=s}finishWordElement(e){const t=this.range,i=window.getSelection();if(t&&i&&this.wordElement&&this.wordToken){if("#"===this.wordToken?(this.wordElement.className=`link-annotation ${T.o.HASH}`,this.wordElement.setAttribute("data-blocktype",a.C.HASH),this.wordElement.contentEditable="false"):"@"===this.wordToken&&this.wordElement.dataset.value&&(this.wordElement.className=`link-annotation ${T.o.USER}`,this.wordElement.setAttribute("data-blocktype",a.C.USER),this.wordElement.contentEditable="false"),this.textBox.focus(),t.setStartAfter(this.wordElement),e){const i=document.createTextNode(e);t.insertNode(i),t.selectNodeContents(i),t.collapse(!1)}this.applyRange(),this.endWordMatching()}}replaceWord(e,t){this.wordElement&&(t&&this.wordElement.setAttribute("data-value",t),this.wordElement.innerHTML=e,this.finishWordElement(""))}renderSuggestion(e,t){const{activeMatch:i}=this.state,o=t===i,{users:r}=this.context,l=e.blockType===a.C.USER,c=l&&e.value?r.getUserInfo(e.value)||(0,S.Q)(e.value):null;return(0,s.h)("div",{class:n("suggestion",{selected:o}),onMouseDown:this.onClickMatch,onMouseEnter:this.onHoverMatch,"data-value":e.value,"data-text":e.text,"data-index":t},l&&(0,s.h)(_.C,{badgeStyle:{color:c.color,"border-color":c.color,"background-color":"transparent"},label:c.initials}),(0,s.h)("span",{class:"suggestion-text"},e.text))}renderSuggestions(){const{active:e}=this.props;if(!e)return null;const{matches:t}=this.state,i=t.length>0;return(0,s.h)("div",{class:n("suggestion-menu",{open:i})},i&&t.map(((e,t)=>this.renderSuggestion(e,t))))}render(){const{text:e,onClickToEdit:t,active:i,placeholder:o,tabIndex:r,maxLength:a,className:l,onBlur:c,onFocus:h}=this.props,d=!!t&&!i,u=l||"";return(0,s.h)("div",{class:n("smart-text-box",`${u}`)},(0,s.h)(E.Z,{ref:this.saveRef,text:e,activeLinks:!0,hashtags:!0,userMentions:!0,placeholder:o,tabIndex:r,clickToEdit:d,maxLength:a,onClick:this.onClick,onInput:this.onInput,onKeyPress:this.onKeyPress,onBlur:c,onFocus:h,onClickAnchor:this.onClickAnchor}),this.renderSuggestions())}};x=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.A],x);var M=i(80429);let P=class extends s.Component{constructor(e){super(e),this.handleUpload=e=>{const t=e.target;if(!t)return;const i=t.files;i&&this.props.onUpload(i),t.value=""},this.onClick=e=>{const{onClick:t,buttonState:i,tooltip:s}=this.props;i===y.BN.DIMMED&&s?(this.setState({showingTooltip:!0}),window.setTimeout((()=>{this.setState({showingTooltip:!1})}),2500)):t(e)},this.state={showingTooltip:!1}}render(){const{accept:e,id:t,multi:i,buttonState:n,tooltip:o,dataValue:r,onMouseDown:a}=this.props,{showingTooltip:l}=this.state,c=n===y.BN.ENABLED,h=`file-upload-${t}`;return(0,s.h)("div",{class:"file-upload-button"},(0,s.h)("label",{for:h},(0,s.h)(M.h,{dataValue:r,iconClass:"icon-attach",buttonStyle:M.D.PLAIN,buttonState:n,onClick:this.onClick,onMouseDown:a,tooltipMsg:l?o:void 0})),c&&(0,s.h)("input",{type:"file",class:"file-input",id:h,accept:e,multiple:!!i,onChange:this.handleUpload}))}};P=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],P);let A=class extends s.Component{constructor(e){super(e),this.active=!1,this.dropZone=null,this.onDragOver=e=>{e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.stopPropagation(),this.activate())},this.onDrop=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.files&&this.props.onDropped(e.dataTransfer.files),this.deactivate()},this.onDragEnd=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.setDropZoneRef=e=>{this.dropZone=e}}activate(){!this.active&&this.dropZone&&(this.props.onActivate(!0),this.active=!0,this.dropZone.classList.add("active"))}deactivate(){this.active&&this.dropZone&&(this.active=!1,this.dropZone.classList.remove("active"),this.props.onDone&&this.props.onDone())}render(){const{appendClass:e,children:t,disabled:i}=this.props;return(0,s.h)("div",{class:n(e),onDragEnter:i?void 0:this.onDragOver,onDragLeave:i?void 0:this.onDragLeave,onDragOver:i?void 0:this.onDragOver,onDragEnd:i?void 0:this.onDragEnd,onDrop:i?void 0:this.onDrop},(0,s.h)("div",{class:"file-drop-zone",ref:this.setDropZoneRef},(0,s.h)("span",{class:"icon icon-attach"}),(0,s.h)("label",null,"Upload file")),t)}};A=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],A);var O=i(42190),D=i(2752),I=i(93528);class C extends I.v{}class R extends I.v{}var L,N,k=i(14071),F=i(47133);!function(e){e.NONE="none",e.INVALID_URL_SYNTAX="invalid",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(N||(N={}));let B=L=class extends s.Component{constructor(e){super(e),this.open=()=>{this.el.classList.add("open"),this.focus()},this.close=()=>{this.el.classList.remove("open")},this.onInput=e=>{const t=(0,w.j)(e)?N.NONE:N.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{this.isDisabled()||this.onDoneEditing(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onDoneEditing=async e=>{const{onEmbed:t}=this.props;e&&(null!==await this.loadMedia(e)?(this.setState({validationPhase:N.LOADED}),t(e)):this.setState({validationPhase:N.ERROR,currentUrl:e}))},this.loadMedia=async e=>{const{assetId:t,assetType:i}=this.props;return this.setState({validationPhase:N.NONE}),e?(this.setState({validationPhase:N.LOADING}),this.context.commandBinder.issueCommand(new h.wu(t,i,e))):null},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.state={currentUrl:"",validationPhase:N.NONE}}componentDidMount(){this.context.messageBus.subscribe(C,this.open),this.context.messageBus.subscribe(R,this.close)}componentWillUnmount(){this.context.messageBus.unsubscribe(C,this.open),this.context.messageBus.unsubscribe(R,this.close)}focus(){this.urlInput&&this.urlInput.focus()}isDisabled(){const{validationPhase:e,currentUrl:t}=this.state;return e===N.ERROR||e===N.LOADING||e===N.INVALID_URL_SYNTAX&&""!==t||""===t}renderHelpMessage(){const{currentUrl:e,validationPhase:t}=this.state;switch(t){case N.ERROR:return(0,s.h)("div",{class:"popover-message popover-message-error"},"Can't find media. Please check URL.",(0,s.h)("a",{class:"link",target:"_blank",rel:"noreferrer",href:L.supportPage},"Help"));case N.LOADING:return(0,s.h)("div",{class:"popover-message"},"Looking up media...");case N.INVALID_URL_SYNTAX:if(""!==e)return(0,s.h)("div",{class:"popover-message popover-message-error"},"Invalid URL")}return(0,s.h)("div",{class:"popover-message"},(0,s.h)("a",{class:"link",target:"_blank",href:L.supportPage},"See supported formats"))}render(){const{onCancel:e}=this.props,t=this.isDisabled()?y.BN.DISABLED:y.BN.ENABLED;return(0,s.h)("div",{ref:this.setRef,class:"annotation-popup media-embed-editor",onClick:this.stopPropagation},(0,s.h)("div",{class:"popover-header"},(0,s.h)("div",{class:"popover-label"},"Media Link"),(0,s.h)(k.P,{buttonStyle:k.A.LIGHT,onClose:e})),(0,s.h)(F.Z,{ref:this.setUrlRef,text:"",type:"url",placeholder:"https://",onDone:this.onDoneEditing,onInput:this.onInput}),(0,s.h)("div",{class:"popover-footer"},this.renderHelpMessage(),(0,s.h)(y.zx,{appendClass:{"button-inline":!0},buttonStyle:y.ZJ.CLEAR,buttonSize:y.qE.SMALL,buttonState:t,onClick:this.onApply},"Apply")))}};B.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post",B=L=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],B);var U,H;!function(e){e.EMBED="embed",e.LINK="link"}(U||(U={})),function(e){e.COLLABORATION="collaboration",e.PRESENTATION="presentation"}(H||(H={}));let G=class extends s.Component{constructor(e){super(e),this.bindings=[],this.iMobile=(0,r.s)()||(0,r._1)(),this.attachmentsChanged=()=>{this.updateAttachments(this.props)},this.handleBlur=e=>{},this.handleFocus=e=>{const t=this.props.toolPanelLayout===l.wS.BOTTOM_PANEL;this.textEditor&&this.iMobile&&t&&window.setTimeout((()=>{this.textEditor.getTextElement().scrollIntoView()}),200)},this.cancelEdits=()=>{this.props.onCancelEditing&&this.props.onCancelEditing()},this.saveEdits=()=>{this.onDoneEditing()},this.onDoneEditing=()=>{const{onDoneEditing:e}=this.props;if(e){const{attachments:t,pendingAttachments:i,currentUploads:s}=this.state,n=this.getMarkdown(),o=t.length+i.length+s.length===0;e(n,""===n&&o)}},this.onClickTextBox=()=>{this.props.active||this.startEditingAnnotation()},this.onInput=e=>{this.setState({textChanged:e!==this.props.text})},this.startEditingAnnotation=()=>{const{onClickToEdit:e}=this.props;e&&e()},this.setPopupEditor=(e,t)=>{t?this.setState({popup:e}):e===this.state.popup&&this.setState({popup:null})},this.openLinkEditor=()=>{this.state.popup!==U.LINK&&this.textEditor&&(this.trackEvent("notes_open_link_editor"),this.textEditor.prepareLinkForEdit())},this.onClickBlock=e=>{const{active:t}=this.props,i=e.blockType;if(i===a.C.LINK&&t){this.setState({selectedBlock:e}),this.setPopupEditor(U.LINK,!0);const t=""!==e.text;this.context.messageBus.broadcast(new D.g(t))}else t||i!==a.C.USER&&i!==a.C.HASH||this.context.commandBinder.issueCommand(new c.R(e))},this.closeLinkEditor=()=>{this.context.messageBus.broadcast(new D.Z),this.setPopupEditor(U.LINK,!1),this.setState({selectedBlock:null})},this.toggleEmbedEditor=()=>{this.state.popup!==U.EMBED?(this.trackEvent("notes_open_embed_editor"),this.setPopupEditor(U.EMBED,!0),this.context.messageBus.broadcast(new C)):this.closeEmbedEditor()},this.closeEmbedEditor=()=>{this.setPopupEditor(U.EMBED,!1),this.context.messageBus.broadcast(new R)},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{const{popup:i}=this.state;i===U.LINK&&this.textEditor&&(this.setState({textChanged:!0}),this.textEditor.saveLink(e,t),this.closeLinkEditor())},this.onViewAttachment=(e,t)=>{this.props.onViewAttachment&&this.props.onViewAttachment(e,t)},this.onRemoveAttachment=e=>{this.trackEvent("notes_click_remove_attachment"),this.context.commandBinder.issueCommand(new h.$T(e))},this.onClickFileInput=()=>{this.startEditingAnnotation()},this.onFileUpload=e=>{const{editable:t,assetId:i,assetType:s}=this.props;if(!t)return;const n=Array.from(e),{attachments:o,pendingAttachments:r}=this.state,a=o.length+r.length;e.length+a>p.yk&&n.splice(p.yk-a),this.setState((e=>{const t=n.map(((e,t)=>({progress:0,index:t,error:null,file:e})));return{currentUploads:e.currentUploads.concat(t),uploading:!0}})),this.context.commandBinder.issueCommand(new h.It(i,s,n)),this.context.messageBus.subscribe(d.Vj,this.updateProgress),this.context.messageBus.subscribe(d.RE,this.uploadingDone),this.edit()},this.onDrop=e=>{this.trackEvent("notes_drag_and_dropped"),this.onFileUpload(e)},this.onFilesChosen=e=>{this.trackEvent("notes_files_chosen"),this.onFileUpload(e)},this.dropActivated=()=>{const{active:e,creating:t}=this.props;t&&!e&&this.startEditingAnnotation()},this.updateProgress=e=>{if(e.assetType!==this.props.assetType||e.assetId!==this.props.assetId)return;const t=e.status;this.setState((e=>({currentUploads:e.currentUploads.map((e=>e.file===t.file?Object.assign(Object.assign({},e),t):e))})))},this.uploadingDone=e=>{e.assetType===this.props.assetType&&e.assetId===this.props.assetId&&(this.setState({currentUploads:e.uploads,uploading:!1}),this.context.messageBus.unsubscribe(d.Vj,this.updateProgress),this.context.messageBus.unsubscribe(d.RE,this.uploadingDone))},this.setTextEditorRef=e=>this.textEditor=e,this.state={textChanged:!1,attachmentsChanged:!1,attachments:[],users:[],uploading:!1,selectedBlock:null,pendingAttachments:[],currentUploads:[],popup:null}}componentDidMount(){this.context.market.waitForData(u.b).then((e=>{this.init(e)}))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentWillReceiveProps(e){this.props.assetId===e.assetId&&this.props.assetType===e.assetType||this.updateAttachments(e)}componentDidUpdate(e,t){e.active&&!this.props.active&&this.setState({attachmentsChanged:!1,textChanged:!1,pendingAttachments:[],currentUploads:[]}),t.attachments!==this.state.attachments&&this.setState({attachmentsChanged:!0})}edit(){this.textEditor&&this.textEditor.toggleEditing(!0)}focus(){this.textEditor&&this.textEditor.focus()}init(e){this.attachmentsData=e,this.bindings.push(this.attachmentsData.onChanged(this.attachmentsChanged)),this.updateAttachments(this.props),this.setState({users:this.getUserSuggestions()})}getUserSuggestions(){const e=[];return this.context.users.getUsers(!0).map((t=>{e.push(t)})),e}updateAttachments(e){const{assetType:t,assetId:i}=e;this.setState({attachments:this.attachmentsData.getAttachmentsForAsset(i,t),pendingAttachments:this.attachmentsData.getPendingAttachmentsForAsset(i,t)})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getMarkdown(){return this.textEditor?this.textEditor.getMarkdown():this.props.text}inEmptyState(){const{active:e,text:t}=this.props,{attachments:i,pendingAttachments:s,currentUploads:n}=this.state,o=i.length+s.length+n.length===0;return""===t&&o&&!e}renderButtonBar(){const{active:e,creating:t,assetId:i}=this.props;if(!e)return null;const{attachments:n,pendingAttachments:o,textChanged:r,attachmentsChanged:a,uploading:l}=this.state,c=n.length+o.length>=p.yk,h=r||a,d=t?"Add":"Save",u=h&&e?y.BN.ENABLED:y.BN.DISABLED,m=p.Y1.extensions.join(","),g=c?y.BN.DIMMED:l?y.BN.DISABLED:y.BN.ENABLED,f=c?`${p.yk} attachments max`:void 0;return(0,s.h)("div",{class:"annotation-button-bar"},(0,s.h)("div",{class:"annotation-editors"},(0,s.h)(P,{id:`${i}-annotation`,accept:m,multi:!0,buttonState:g,tooltip:f,onUpload:this.onFilesChosen,onClick:this.onClickFileInput}),(0,s.h)(M.h,{iconClass:"icon-media-mix",buttonStyle:M.D.PLAIN,onClick:this.toggleEmbedEditor}),(0,s.h)(M.h,{iconClass:"icon-link",buttonStyle:M.D.PLAIN,onClick:this.openLinkEditor})),(0,s.h)("div",{class:"annotation-cta-buttons"},(0,s.h)(y.zx,{buttonStyle:y.ZJ.SECONDARY,buttonSize:y.qE.SMALL,appendClass:{"button-inline":!0},buttonState:y.BN.ENABLED,onClick:this.cancelEdits},"Cancel"),(t||h)&&(0,s.h)(y.zx,{appendClass:{"button-inline":!0},buttonStyle:y.ZJ.SECONDARY,buttonSize:y.qE.SMALL,buttonState:u,onClick:this.saveEdits},d)))}renderAttachment(e,t,i){const{active:n}=this.props,o=!n&&(1===i||0===t&&i>2),r=n?80:o?300:140,a=n?80:o?250:140,l=n||!o;return(0,s.h)(m.P,{attachment:e,sizeMedia:!0,width:r,height:a,hero:o,cover:!0,thumbnail:l,appendClass:{inline:n},onClick:n?void 0:this.onViewAttachment,onRemove:n?this.onRemoveAttachment:void 0})}renderPendingUpload(e){return 100===e.progress&&null===e.error?null:(0,s.h)(v,{appendClass:{inline:!0},progress:e.progress,error:e.error})}renderAttachments(){const{active:e}=this.props,{attachments:t,pendingAttachments:i,currentUploads:o}=this.state,r=t.length;return(0,s.h)("div",{class:n("annotation-attachments",{"annotation-attachments-inline":e})},t.map(((e,t)=>this.renderAttachment(e,t,r))),i.map(((e,t)=>this.renderAttachment(e,t,r))),o.map(((e,t)=>this.renderPendingUpload(e))))}renderTextBox(){const{placeholder:e,hashtags:t,text:i,creating:n,clickToEdit:o,active:r,editable:a,maxLength:l,tabIndex:c,annotationStyle:h}=this.props,{users:d}=this.state,u=h===H.PRESENTATION,p=this.inEmptyState()&&!u,m=p&&!n?"Original content was deleted":e,g=p&&m?"placeholder":void 0,f=o&&a?this.onClickTextBox:void 0;return(0,s.h)(x,{ref:this.setTextEditorRef,className:g,text:i,active:!!r,placeholder:m,onClickBlock:this.onClickBlock,onClickToEdit:f,onDoneEditing:this.onDoneEditing,onCancelEditing:this.cancelEdits,onFocus:this.handleFocus,onBlur:this.handleBlur,onInput:this.onInput,tabIndex:c,maxLength:l,users:d,hashtags:t||[]})}renderReadonlyAnnotation(){const{appendClass:e,creating:t,annotationStyle:i,title:o}=this.props,r=i===H.PRESENTATION,a={"annotation-emptied":this.inEmptyState()&&!t&&!r};return e&&Object.keys(e).length>0&&Object.assign(a,e),(0,s.h)("div",{class:"annotation-box"},r&&this.renderAttachments(),o&&(0,s.h)("div",{class:"annotation-title"},o),(0,s.h)("div",{class:n("annotation-text-box",a)},this.renderTextBox()),!r&&this.renderAttachments())}renderEditableAnnotation(){const{appendClass:e,creating:t,active:i,assetId:o,assetType:r,editable:l,clickToEdit:c,edited:h,annotationStyle:d}=this.props,{attachments:u,pendingAttachments:m,uploading:g,selectedBlock:f}=this.state,v=u.length+m.length<p.yk,y=l&&!g&&(i||t)&&v,b=d===H.PRESENTATION,w=this.inEmptyState()&&!t&&!b,S=!i&&h&&!w,T={annotating:i,"editor-box":i||c,"annotation-emptied":w};e&&Object.keys(e).length>0&&Object.assign(T,e);let E="",_="";return f&&f.blockType===a.C.LINK&&(E=f.text,_=f.value||""),(0,s.h)(A,{appendClass:{"annotation-box":!0},onDropped:this.onDrop,disabled:!y,onActivate:this.dropActivated},(0,s.h)("div",{class:n("annotation-text-box",T)},this.renderTextBox(),i&&this.renderAttachments(),i&&this.renderButtonBar()),S&&(0,s.h)("div",{class:"annotation-edited"},"(edited)"),!i&&!t&&this.renderAttachments(),i&&!!o&&(0,s.h)(B,{assetId:o,assetType:r,onEmbed:this.closeEmbedEditor,onCancel:this.closeEmbedEditor}),i&&!!o&&(0,s.h)(O.s,{linkText:E,linkUrl:_,onCancel:this.closeLinkEditor,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}render(){return this.props.editable?this.renderEditableAnnotation():this.renderReadonlyAnnotation()}};G=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],G);const V=G},2082:(e,t,i)=>{"use strict";i.d(t,{E:()=>_});var s,n=i(26605),o=i(91033),r=i(2116),a=i(94184),l=i(47924),c=i(90601),h=i(43711),d=i(90926),u=i(68611),p=i(70008),m=i(87493),g=i(80807),f=i(16945),v=i(59064),y=i(53189);let b=s=class extends n.Component{constructor(e){super(),this.openAttachment=(e,t)=>{this.trackEvent("notes_preview_click_attachment"),e.stopPropagation(),this.props.onClick(t)},this.onClickNote=e=>{e.stopPropagation(),this.props.onClick()},this.state={noteView:null}}componentDidMount(){this.updateNoteView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateNoteView()}updateNoteView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(c.w1.NOTES);if(i){const t=i.manager.dataMap.notesViewData.getNoteView(e);this.setState({noteView:t})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNoteImages(e){return(0,n.h)(f.T,{attachments:e,startIndex:0,width:318,height:130,onClick:this.openAttachment})}renderNoteHeader(e,t){const i=e.created,s=this.context.users.getUserInfo(e.user)||(0,g.Q)(e.user),o=s.color,r=e.numComments,a=1===r?`${r} reply`:`${r} replies`,l=""!==e.text||t?i.toLocaleString():"Original content was deleted";return(0,n.h)("header",{class:"note-header"},(0,n.h)(v.C,{label:s.initials,badgeStyle:{color:o,"border-color":o}}),(0,n.h)("div",{class:"note-details"},(0,n.h)("span",{class:"note-user"},s.name),r>0&&(0,n.h)("span",{class:"note-summary-info note-replies"},a),(0,n.h)("div",{class:"note-subheader"},l)))}renderNotePost(e){const t=e.text.length>s.MAX_NOTE_LENGTH,i=t||e.numComments>0,o=t?`${e.text.substring(0,s.MAX_NOTE_LENGTH)}...`:e.text;return(0,n.h)("div",{class:a("note-post",{"note-summary-info":!o})},o&&(0,n.h)(y.Z,{text:o,activeLinks:!0,hashtags:!0,userMentions:!0}),i&&(0,n.h)("div",{class:"link link-more"},"Read more >"))}render(){const{noteView:e}=this.state;if(!e)return null;const t=e.attachments,i=t.length>0;return(0,n.h)("div",{class:a("annotation-preview-contents","note-preview-contents",{"has-image":i}),onClick:this.onClickNote},i&&this.renderNoteImages(t),this.renderNoteHeader(e,i),this.renderNotePost(e))}};b.MAX_NOTE_LENGTH=150,b=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],b);var w,S=i(7920),T=i(252);let E=w=class extends n.Component{constructor(e){super(),this.openAttachment=(e,t)=>{this.trackEvent("tags_preview_click_attachment"),this.props.onClick(t)},this.onClickTag=e=>{e.stopPropagation(),this.props.onClick()},this.state={tagView:null}}componentDidMount(){this.updateTagView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateTagView()}updateTagView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(c.w1.TAGS);if(i){const t=i.manager.dataMap.tagsViewData.getTagView(e);this.setState({tagView:t})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderWidgetFrame(e){const{widgetFrame:t}=e;return t?(0,n.h)(T.l,{widget:t}):null}renderTitle(e){const{label:t}=e;return t?(0,n.h)("header",{class:"tag-header"},t):null}renderDescription(e){const{description:t}=e;if(!t)return null;const i=t.length>w.MAX_TAG_LENGTH,s=i?`${t.substring(0,w.MAX_TAG_LENGTH)}...`:t;return(0,n.h)("div",{class:"tag-description"},s&&(0,n.h)(y.Z,{text:s,activeLinks:!0,hashtags:!1,userMentions:!1}),i&&(0,n.h)("div",{class:"link link-more"},"Read more >"))}render(){const{tagView:e}=this.state;if(!e)return null;const{layerWidth:t,layerHeight:i}=this.props,s=e.attachments,o=s.length>0;return(0,n.h)("div",{class:a("annotation-preview-contents","tag-preview-contents",{"has-image":o}),onClick:this.onClickTag},(0,n.h)(S.v,{attachments:s,sizeMedia:!0,layerWidth:t,layerHeight:i,onClick:this.openAttachment}),this.renderTitle(e),this.renderDescription(e),this.renderWidgetFrame(e))}};E.MAX_TAG_LENGTH=100,E=w=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],E);let _=class extends n.Component{constructor(e){super(),this.bindings=[],this.clickOuterAnnotation=()=>{const{currentPin:e,pinState:t}=this.state;e&&(e.pinType===d.Er.MATTERTAG?t===d.tS.SELECTED?this.context.commandBinder.issueCommand(new m.xb):(this.trackEvent("select_tag"),this.context.commandBinder.issueCommand(new u.Ar(e.id,d.Er.MATTERTAG))):e.pinType===d.Er.NOTE&&this.onClickNote())},this.onClickNote=async e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_note_preview"),this.clickInnerAnnotationToOpen(t,c.w1.NOTES,e))},this.onClickTag=e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_tag_preview"),this.clickInnerAnnotationToOpen(t,c.w1.TAGS,e))},this.onResize=()=>{this.updatePositioning()},this.onScreenPositionChanged=()=>{this.updatePositioning()},this.updateOpenPin=()=>{const{openPin:e,pinState:t}=this.viewData,{currentPin:i}=this.state;if(e&&t===d.tS.SELECTED){const t=e.id!==(null==i?void 0:i.id);this.setState({currentPin:e}),t&&this.trackEvent("switch_pin_annotation"),this.updatePositioning(t)}else this.setState({currentPin:null})},this.updatePreviewPin=()=>{const{previewPin:e}=this.viewData,{currentPin:t}=this.state;if(e){const i=e.id!==(null==t?void 0:t.id);i&&this.trackEvent("preview_pin_annotation"),this.updatePositioning(i)}this.setState({currentPin:e})},this.updatePinState=()=>{this.setState({pinState:this.viewData.pinState})},this.updatePositioning=e=>{if(!this.viewData||!this.layer||!this.state.currentPin)return;const t=this.viewData.screenPosition;if(t){const i=t.x,s=t.y;e&&this.updatePreviewDirection(i,s),this.setState({screenPosition:t,layerWidth:this.layer.offsetWidth,layerHeight:this.layer.offsetHeight})}},this.updatePreviewDirection=(e,t)=>{const i=this.layer.offsetWidth,s=1-(e+1)/i*2,n=1-(t+1)/this.layer.offsetHeight*2,o=n<-.5?0:n>.5?2:1,r=s<-.5?2:s>.5?0:1;let a;if(0===r)a=1===o?d.Od.RIGHT:0===o?d.Od.UP_RIGHT:d.Od.DOWN_RIGHT;else if(2===r)a=1===o?d.Od.LEFT:0===o?d.Od.UP_LEFT:d.Od.DOWN_LEFT;else{const t=Math.max(e,i-e);a=1===o&&t>378?s<0?d.Od.RIGHT:d.Od.LEFT:2===o?d.Od.DOWN:d.Od.UP}this.setState({previewDirection:a})},this.setLayerRef=e=>{e&&(this.layer=e,this.resizeObserver.observe(this.layer),this.updatePositioning())},this.state={currentPin:null,screenPosition:null,previewDirection:d.Od.DOWN,pinState:d.tS.IDLE,layerWidth:0,layerHeight:0},this.resizeObserver=new o.Z(this.onResize)}componentDidMount(){const{market:e}=this.context;e.waitForData(p.B).then((e=>{this.viewData=e,this.bindings.push(e.onOpenPinChanged(this.updateOpenPin),e.onPreviewPinChanged(this.updatePreviewPin),e.onScreenPositionChanged(this.onScreenPositionChanged),e.onPinStateChanged(this.updatePinState)),this.updatePinState()}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.resizeObserver&&this.resizeObserver.disconnect()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}async clickInnerAnnotationToOpen(e,t,i){const{activeTool:s}=this.props,{commandBinder:n}=this.context,o=s===t;s&&!o&&await n.issueCommand(new h.tT(s,!1)),o||await n.issueCommand(new h.tT(t,!0)),await n.issueCommand(new u.$b(e.id,e.pinType,l.n.Interpolate,i))}getPreviewPositioning(){const{screenPosition:e,previewDirection:t}=this.state;if(e){let i="",s=e.x;switch(t){case d.Od.UP:i="translate(-50%, -100%)";break;case d.Od.DOWN:i="translateX(-50%)";break;case d.Od.LEFT:i="translate(-100%, -50%)";break;case d.Od.RIGHT:i="translateY(-50%)";break;case d.Od.UP_LEFT:s+=50,i="translate(-100%, -100%)";break;case d.Od.UP_RIGHT:i="translate(-50px, -100%)";break;case d.Od.DOWN_LEFT:s+=50,i="translate(-100%, 5px)";break;case d.Od.DOWN_RIGHT:i="translate(-50px, 5px)"}return{top:`${e.y}px`,left:`${s}px`,transform:i}}return{}}render(){const{openModal:e,newTagsEnabled:t,notesEnabled:i}=this.props;if(e)return null;const{currentPin:s,pinState:o,previewDirection:r,layerWidth:l,layerHeight:c}=this.state,h=o===d.tS.PREVIEWING||o===d.tS.SELECTED,u=h&&t&&s&&s.pinType===d.Er.MATTERTAG,p=h&&i&&s&&s.pinType===d.Er.NOTE;return(0,n.h)("div",{ref:this.setLayerRef,class:"annotations-preview-layer"},s&&(u||p)&&(0,n.h)("div",{class:a("annotation-preview",`annotation-preview-${r}`,{"tag-preview":!!u,"note-preview":!!p}),style:this.getPreviewPositioning(),onClick:this.clickOuterAnnotation},u&&(0,n.h)(E,{previewId:s.id,onClick:this.onClickTag,layerWidth:l,layerHeight:c}),p&&(0,n.h)(b,{previewId:s.id,onClick:this.onClickNote})))}};_=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],_)},88686:(e,t,i)=>{"use strict";i.d(t,{P:()=>w});var s=i(26605),n=i(94184),o=i(2116),r=i(63239),a=i(17141),l=i(73305),c=i(25799),h=i(21265),d=i(21746),u=i(99898);let p=class extends s.Component{constructor(e){super(e),this.clickImage=e=>{this.props.onClick&&this.props.onClick(e,this.props.id)}}getSmartCropUrl(e,t,i){const s=-1!==e.indexOf("?");return`${e}${s?"&":"?"}height=${i}&crop=${t}:${i},smart`}render(){const{appendClass:e,onClick:t,url:i,width:o,height:r,cover:a,smartCrop:l}=this.props,c={"image-cover":!!(a&&o&&r)};if(e&&Object.keys(e).length>0&&Object.assign(c,e),a&&o&&r){const e={backgroundImage:(l?this.getSmartCropUrl(i,o,r):i)?`url('${i}')`:"none"};return(0,s.h)("div",{class:n("image",c),style:e,onClick:t?this.clickImage:void 0})}{const e={};return o&&(e.width=`${o}px`),r&&(e.height=`${r}px`),(0,s.h)("img",{class:n("image",c),src:i,style:e,onClick:t?this.clickImage:void 0})}}};p=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],p);var m=i(80429);const g=new c.Z("mattertag-media");var f;!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(f||(f={}));let v=class extends s.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=e=>{this.state.embed&&this.props.onClick&&this.props.onClick(e,this.props.attachment.id)},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=f.NOT_READY;const i=()=>{t=f.CUED,this.onPlayerLoaded(a)},s=()=>{t=f.PLAYING},n=()=>{t=f.PAUSED},o=()=>{};try{e.on("ready",i),e.on("play",s),e.on("pause",n),e.on("ended",o)}catch(e){g.debug(e)}const r=(0,h.tq)(),a={play:()=>{if(e&&t!==f.NOT_READY&&!r)try{e.play()}catch(e){g.error(e)}},pause:()=>{if(e&&t!==f.NOT_READY)try{e.pause()}catch(e){g.debug(e)}}}},this.updateMaxDims=()=>{const{width:e,height:t,getContainer:i}=this.props,{embed:s}=this.state,n=i();if(!n||e&&t||!s)return;const o=n.getBoundingClientRect();this.setState({maxWidth:o.width,maxHeight:o.height})},this.getMediaStyles=()=>{const{maxWidth:e,maxHeight:t,embed:i}=this.state;if(!i)return{};const{mediaType:s,mediaUrl:n,provider:o,width:a,height:l}=i,c=this.getMediaAspectRatio(),h={};switch(s){case r.MediaType.PHOTO_EMBED:h.backgroundImage=n?`url("${n}")`:"none";case r.MediaType.RICH_EMBED:void 0!==a&&(h.width=`${a}px`),void 0!==l&&(h.height=`${l}px`,o===u.Er?h.height=`${l+54}px`:h.height=`${l}px`);break;case r.MediaType.VIDEO_EMBED:if(e&&t)if(a<=e&&l<=t)h.width=`${a}px`,h.height=`${l}px`;else{const i=Math.min(t,(0,d.yB)(e,e/c)),s=i*c;h.width=`${s}px`,h.height=`${i}px`}}return h},this.setEmbedRef=e=>{!e||this.iframe||this.props.width||this.props.height||this.createEmbedIframe(e)},this.state={maxWidth:0,maxHeight:0,embed:null}}componentDidMount(){this.getEmbeddedMedia(this.props.attachment.id)}componentWillUnmount(){window.removeEventListener("resize",this.updateMaxDims),this.playerControls&&this.playerControls.pause()}componentWillReceiveProps(e){e.attachment.src!==this.props.attachment.src&&(this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.getEmbeddedMedia(e.attachment.id))}componentDidUpdate(e,t){this.props.width||this.props.height||t.embed||!this.state.embed||this.state.embed.mediaType!==r.MediaType.VIDEO_EMBED||(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}getEmbeddedMedia(e){this.context.commandBinder.issueCommand(new l.st(e)).then((e=>{this.setState({embed:e}),this.updateMaxDims()}))}getMediaAspectRatio(){if(!this.state.embed)return 1;const{width:e,height:t}=this.state.embed;return t>0?e/t:1}createEmbedIframe(e){const{embed:t}=this.state;if(!t)return;const{html:i,provider:s,src:n,mediaUrl:o,mediaType:l,width:c,height:h}=t,d=document.createElement("div");d.innerHTML=i;let p=d.firstChild;if("iframe"!==p.tagName.toLowerCase()){if(p=document.createElement("iframe"),!("srcdoc"in p))return g.warn(`Browser does not support srcdoc, refusing to embed ${i}`),void(this.iframe=null);let e,t;void 0!==c&&(p.width=c.toString()),void 0!==h&&(p.height=h.toString()),p.setAttribute("allow","encrypted-media; autoplay; fullscreen"),p.classList.add("embedded-iframe-sandbox","loading"),p.onload=()=>p.classList.remove("loading"),e=s===u.T_&&void 0!==n?`<img src=${o} />`:i,t=s===u.Er?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const r=t.replace(/\s+/g," ");p.srcdoc=`<!doctype html>${r}${e}`}else{const e=p.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(l===r.MediaType.VIDEO_EMBED&&p.src)try{const e=new a.Player(p);p.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){g.error(e)}this.iframe=p,e.appendChild(p)}renderMediaImage(e){const{width:t,height:i,thumbnail:n,attachment:o,cover:a}=this.props,{thumbnailUrl:l,mediaUrl:c,mediaType:h}=e,d=h===r.MediaType.VIDEO_EMBED;if(a){const e=n||!c||d?l:c,t={backgroundImage:e?`url('${e}')`:"none"};return(0,s.h)("div",{class:"attachment-view image-cover",style:t,onClick:this.handleClick},d&&(0,s.h)(m.h,{appendClass:{"attachment-play":!0},iconClass:"icon-play-unicode"}))}{let r;if(t&&i){const s=this.getMediaAspectRatio();r=s>1?Math.max(Math.min(e.width,400,t),310):Math.max(Math.min(e.width,300),200),r/s>i&&(r=i*s)}return(0,s.h)(p,{id:o.id,url:n?l:c,cover:!1,width:r,smartCrop:!1,appendClass:{"attachment-view":!0},onClick:this.handleClick})}}render(){const{embed:e}=this.state;if(!e)return null;const{cover:t,width:i,height:n,sizeMedia:o}=this.props,{mediaType:a,thumbnailUrl:l}=e,c=a===r.MediaType.PHOTO_EMBED,h=a===r.MediaType.VIDEO_EMBED;if(c||h&&t&&i&&n&&l){const t=this.renderMediaImage(e);if(t)return t}const d=o?this.getMediaStyles():{};return(0,s.h)("div",{class:"embedded-content",onClick:this.handleClick,ref:this.setEmbedRef,style:d})}};v=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],v);var y=i(42733),b=i(26265);let w=class extends s.Component{constructor(e){super(e),this.attachmentDiv=null,this.removeAttachment=()=>{this.props.onRemove&&this.props.onRemove(this.props.attachment.id)},this.getAttachmentDiv=()=>this.attachmentDiv,this.setAttachmentRef=e=>{this.attachmentDiv=e}}getAttachmentStyle(){const{attachment:e,width:t,height:i,cover:s}=this.props;return s&&void 0===t&&void 0===i&&e.width&&e.height?{maxHeight:e.height,maxWidth:e.width}:{}}renderAttachment(){const{attachment:e,width:t,height:i,thumbnail:n,onClick:o,cover:a,sizeMedia:l}=this.props,{category:c,id:h,url:d,thumbnailUrl:u}=e;if(e.category===r.AttachmentCategory.UPLOAD&&e.mediaType===r.MediaType.IMAGE)return(0,s.h)(p,{id:h,url:n?u:d,cover:a,width:t,height:i,smartCrop:c===r.AttachmentCategory.UPLOAD,appendClass:{"attachment-view":!0},onClick:o});switch(e.mediaType){case r.MediaType.PHOTO_EMBED:case r.MediaType.VIDEO_EMBED:case r.MediaType.RICH_EMBED:return(0,s.h)(v,{attachment:e,sizeMedia:l,width:t,height:i,thumbnail:n,cover:a,getContainer:this.getAttachmentDiv,onClick:o})}return null}render(){const{attachment:e,hero:t,appendClass:i,onClick:o,onRemove:a}=this.props,{id:l}=e,c=!!a,h=e.mediaType===r.MediaType.PHOTO_EMBED,d=this.getAttachmentStyle(),u={clickable:!!o,"hero-image":!!t,photo:h};return i&&Object.keys(i).length>0&&Object.assign(u,i),(0,s.h)("div",{class:n("attachment",u),style:d,ref:this.setAttachmentRef},this.renderAttachment(),c&&(0,s.h)(m.h,{iconClass:"icon-close",appendClass:{"attachment-delete":!0},buttonStyle:m.D.SOCIAL,buttonSize:y.qE.SMALL,tooltipMsg:"Delete Attachment",tooltipPosition:b.lZ.DOWN_LEFT,onClick:this.removeAttachment,dataValue:l}))}};w=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],w)},16945:(e,t,i)=>{"use strict";i.d(t,{T:()=>a});var s=i(26605),n=i(2116),o=i(88686),r=i(80429);let a=class extends s.Component{constructor(e){super(),this.onNext=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const s=i+1<t.length?i+1:0;this.trackEvent("notes_viewer_next"),this.setState({index:s})},this.onPrev=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const s=i>0?i-1:t.length-1;this.trackEvent("notes_viewer_prev"),this.setState({index:s})},this.state={index:e.startIndex}}componentWillReceiveProps(e){this.setState({index:e.startIndex})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachments:e,width:t,height:i,onClick:n}=this.props,{index:a}=this.state,l=e[a];if(!l)return null;const c=void 0!==t&&void 0!==i,h=e.length>1;return(0,s.h)("div",{class:"attachment-carousel"},h&&(0,s.h)(r.h,{appendClass:{"modal-nav":!0,"modal-prev":!0},iconClass:"icon-dpad-left",onClick:this.onPrev}),(0,s.h)("div",{class:"attachment-carousel-view"},(0,s.h)(o.P,{attachment:l,sizeMedia:!0,width:t,height:i,cover:c,thumbnail:!1,onClick:n})),h&&(0,s.h)(r.h,{appendClass:{"modal-nav":!0,"modal-next":!0},iconClass:"icon-dpad-right",onClick:this.onNext}))}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a)},82359:(e,t,i)=>{"use strict";i.d(t,{I:()=>m});var s=i(26605),n=i(2116),o=i(94184),r=i(12856),a=i(71583),l=i(82209),c=i(73305),h=i(43770),d=i(16945),u=i(80429),p=i(26265);let m=class extends s.Component{constructor(){super(),this.closeAttachmentViewer=()=>{this.state.open&&this.context.commandBinder.issueCommand(new a.Bz(r.P.ATTACHMENT,!1))},this.modalToggled=e=>{e.modal===r.P.ATTACHMENT&&this.setState({open:e.open})},this.viewAttachment=e=>{this.context.commandBinder.issueCommand(new a.Bz(r.P.ATTACHMENT,!0)),this.setState({open:!0,attachments:e.attachments,attachmentIndex:e.index})},this.state={open:!1,attachmentIndex:-1,attachments:[]}}componentDidMount(){this.context.commandBinder.addBinding(c.SI,this.viewAttachment),this.context.messageBus.subscribe(l.nV,this.modalToggled),this.context.messageBus.subscribe(h.A,this.closeAttachmentViewer)}componentWillUnmount(){this.context.commandBinder.removeBinding(c.SI,this.viewAttachment),this.context.messageBus.unsubscribe(l.nV,this.modalToggled),this.context.messageBus.unsubscribe(h.A,this.closeAttachmentViewer)}render(){const{open:e,attachments:t,attachmentIndex:i}=this.state;return(0,s.h)("div",{class:o("overlay attachment-overlay",{open:e})},e&&(0,s.h)("div",{class:"overlay-close"},(0,s.h)(u.h,{iconClass:"icon-close",buttonStyle:u.D.OVERLAY,tooltipMsg:"Close",tooltipPosition:p.lZ.DOWN,onClick:this.closeAttachmentViewer})),e&&(0,s.h)(d.T,{attachments:t,startIndex:i}))}};m=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],m)},78215:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var s,n=i(26605),o=i(2116),r=i(83455),a=i(14600),l=i(43711),c=i(90601),h=i(5261),d=i(26265),u=i(80429),p=i(86134);let m=s=class extends n.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(r.pE,!1),t=this.context.settings.tryGetProperty(a.F.NotesModeNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),s.DISMISS_NUDGE_TIMEOUT)}),s.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{if(this.state.showNudge){const e=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(e,{gui_action:"notes_nudge_dismissed"}),this.context.settings.setLocalStorageProperty(a.F.NotesModeNudgeSeen,!0),this.setState({showNudge:!1})}},this.openNotesMode=()=>{const e=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(e,{gui_action:"notes_mode_click_open"}),this.context.messageBus.broadcast(new h.E),this.context.commandBinder.issueCommand(new l.tT(c.w1.NOTES,!0))},this.localized={notesModeString:"Notes",nudgeTitleString:"Add a note",nudgeMessageString:"Tap here to add your first note to this space."},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e}=this.props,{showNudge:t}=this.state,{nudgeTitleString:i,nudgeMessageString:s}=this.localized;return(0,n.h)("div",{class:"notes-mode-button"},(0,n.h)(u.h,{onClick:this.openNotesMode},(0,n.h)(d.oO,{content:this.localized.notesModeString,position:d.lZ.UP,tooltipTimeout:e},(0,n.h)("span",{class:"icon icon-notes"}))),(0,n.h)(p.u,{appendClass:{"tooltip-title-large":!0,"nudge-tooltip":!0},open:t,closeButton:!0,onClose:this.dismissNudge,title:i,message:(0,n.h)("div",{class:"nudge-message"},(0,n.h)("span",{class:"message"},s)),arrowPos:p.x.BOTTOM_CENTER}))}};m.SHOW_NUDGE_TIMEOUT=15e3,m.DISMISS_NUDGE_TIMEOUT=1e4,m=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],m);const g=m},979:(e,t,i)=>{"use strict";i.d(t,{Z:()=>S});var s=i(26605),n=i(72942),o=i(22729),r=i(19417),a=i(71208),l=i(12775),c=i(94184),h=i(58091),d=i(21265),u=i(95843),p=i(29359),m=i(26265),g=i(80429),f=i(42733);class v extends s.Component{constructor(e){super(e),this.floors=[],this.scrollbars=null,this.canClick=!1,this.newFloorIndex=null,this.mobile=(0,d.tq)(),this.updateScrollCenter=e=>{void 0===e&&(e=this.props.currentFloor),this.floors.length<=5||this.scrollbars&&(this.newFloorIndex=null,this.scrollbars.setScrollCenter(this.floors[e]))},this.onScrollbarClick=()=>{this.canClick=!0},this.onOutsideClick=e=>{this.toggleMenu(!1)},this.onIconClick=e=>{e.stopPropagation(),this.toggleMenu(),this.context.analytics.track("showcase_gui",{gui_action:"floor_controls"})},this.toggleMenu=e=>{const{showMenu:t}=this.state,i=void 0!==e?e:!t;t!==i&&(i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.setState({showMenu:i}))},this.onFloorClick=e=>{this.scrollbars&&!this.canClick||(e.stopPropagation(),this.toggleMenu(),this.props.handleClickFloor(e),this.context.analytics.track("showcase_gui",{gui_action:"floor_clicked"}))},this.setScrollbarRef=e=>this.scrollbars=e,this.state={showMenu:!1}}componentWillReceiveProps(e){this.props.currentFloor!==e.currentFloor&&(this.newFloorIndex=e.currentFloor)}componentDidUpdate(){null!==this.newFloorIndex&&this.updateScrollCenter(this.newFloorIndex)}getFloorMenu(){const e=this.props.floorNames.map(((e,t)=>(0,s.h)("div",{class:c("floor-button",{current:this.props.currentFloor===t}),key:String(t),ref:e=>{this.floors[t]=e},onClick:this.onFloorClick,"data-value":t},e||this.context.locale.t(p.Z.FLOOR_NAME)+(t+1)))).reverse(),t=e.length>5,i=c("floor-menu-wrapper",{"faded-in":this.state.showMenu,scrollable:t});return t?(0,s.h)("div",{class:i},(0,s.h)(h.Z,{name:"floor-menu-wrapper",forceHidden:this.mobile,ref:this.setScrollbarRef,singleScrollDirection:u.Nm.vertical,onScrollbarVisibilityChange:this.updateScrollCenter,handleClick:this.onScrollbarClick},e)):(this.scrollbars=null,(0,s.h)("div",{class:i},e))}render(){const{visible:e,currentFloor:t}=this.props;if(e){const{showMenu:e}=this.state,i=this.props.isAllFloors(t),n=!i&&String(t+1).length>1,o=i?"icon-floor-controls-all":"icon-floor-controls",r=this.context.locale.t(p.Z.HELP_MORE_FLOORS_A),a=e?f.BN.ACTIVE:f.BN.ENABLED;return(0,s.h)(g.h,{buttonState:a,onClick:this.onIconClick,appendClass:{"floor-controls":!0}},this.getFloorMenu(),(0,s.h)(m.oO,{content:r,position:m.lZ.UP,className:c("select-floor",{"tooltip-hidden":e,isAllFloors:i})},(0,s.h)("div",{class:c("floor-number",{twoDigit:n})},(0,s.h)("span",null,!i&&t+1)),(0,s.h)("span",{class:c("icon",o)})))}return(0,s.h)("div",{class:"floor-controls"})}}var y=i(25799),b=i(86682);const w=new y.Z("floor-controls");class S extends s.Component{constructor(e){super(e),this.originalFloors=[],this.handleClickFloor=async e=>{try{const t=e.target.getAttribute("data-value"),i="string"==typeof t?parseInt(t,10):-1;await this.context.commandBinder.issueCommand(new r.vy),this.isAllFloors(i)?(this.context.analytics.track("showcase_gui",{gui_action:"click_toggle_all_floors_button"}),await this.context.commandBinder.issueCommand(new b.Vw(null,!1))):i!==this.state.currentFloor&&(this.context.analytics.track("showcase_gui",{gui_action:"click_floor_select_button"}),await this.context.commandBinder.issueCommand(new b.h9(i,!1)))}catch(e){w.debug(e)}},this.isAllFloors=e=>!this.originalFloors[e],this.setFloorNamesForMode=()=>{const e=this.viewmodeData.currentMode!==a.Ey.Panorama?[...this.originalFloors,this.viewData.getFloorName(null)]:this.originalFloors;if(this.viewmodeData.currentMode!==this.state.currentMode)this.setState({floorNames:e,currentMode:this.viewmodeData.currentMode});else{const t=this.getFloorIndex(e.length);this.setState({floorNames:e,currentFloor:t})}},this.updateData=()=>{const e=this.viewData.getHighestVisibleFloor(),t=e?e.index:-1;this.state.floorNames===this.viewData.getFloorNames()&&this.state.currentFloor===t||(this.originalFloors=this.viewData.getFloorNames(),this.setFloorNamesForMode())},this.getFloorIndex=e=>{const{currentFloor:t}=this.viewData;return t||this.props.viewmode===n.BD.INSIDE?t?t.index:-1:e-1},this.modeChanged=()=>{this.setFloorNamesForMode()},this.state={visible:e.viewmode!==n.BD.OUTSIDE,currentFloor:-2,floorNames:[],currentMode:null}}componentWillReceiveProps(e){e.viewmode!==this.props.viewmode&&this.setState({visible:e.viewmode!==n.BD.OUTSIDE})}async componentDidMount(){try{this.viewmodeData=await this.context.market.waitForData(l.O),this.viewData=await this.context.market.waitForData(o.c),this.changeSubscription=this.viewData.makeFloorChangeSubscription(this.updateData),this.modeChangeSub=this.viewmodeData.makeModeChangeSubscription(this.modeChanged),this.updateData(),this.modeChanged()}catch(e){w.debug(e)}}componentWillUnmount(){this.changeSubscription&&this.changeSubscription.cancel(),this.modeChangeSub&&this.modeChangeSub.cancel()}render(){return(0,s.h)(v,{visible:this.originalFloors.length>1&&this.state.visible,floorNames:this.state.floorNames,currentFloor:this.state.currentFloor,handleClickFloor:this.handleClickFloor,isAllFloors:this.isAllFloors})}}},30593:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(26605),n=i(94184),o=i(21265),r=i(29359),a=i(26265),l=i(80429);class c extends s.Component{constructor(e){super(e),this.handleButtonClick=()=>{o.rm()?(this.context.analytics.track("showcase_gui",{gui_action:"click_exit_fullscreen",interaction_source:"gui"}),o.Qg()):(this.context.analytics.track("showcase_gui",{gui_action:"click_enter_fullscreen",interaction_source:"gui"}),o.Zx(document.body))},this.onFullScreenChange=()=>{this.setState({fullscreen:o.rm()})},this.state={fullscreen:o.rm()},document.addEventListener("fullscreenchange",this.onFullScreenChange),document.addEventListener("webkitfullscreenchange",this.onFullScreenChange),document.addEventListener("MSFullscreenChange",this.onFullScreenChange),document.addEventListener("mozfullscreenchange",this.onFullScreenChange)}render(){const e=o.Jm(),{fullscreen:t}=this.state;return(0,s.h)("div",{class:"fullscreen-mode"},(0,s.h)(l.h,{onClick:this.handleButtonClick},(0,s.h)(a.oO,{content:t?this.context.locale.t(r.Z.EXIT_FULLSCREEN):this.context.locale.t(r.Z.VIEW_FULLSCREEN),position:a.lZ.UP_LEFT,tooltipTimeout:e?1e3:void 0},(0,s.h)("span",{class:n("icon",t?"icon-fullscreen-exit":"icon-fullscreen")}))))}}},24391:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var s=i(26605),n=i(2116),o=i(29359),r=i(80429),a=i(26265),l=i(21265);let c=class extends s.Component{constructor(e){super(e),this.handleButtonClick=()=>{const e=this.props.reelOpen?"hide_":"show_";this.context.analytics.track("showcase_gui",{gui_action:e+"highlight_reel"}),this.props.onToggleHLR(!this.props.reelOpen)}}render(){const{reelEnabled:e,reelOpen:t}=this.props;return e?(0,s.h)(r.h,{appendClass:{"highlight-button":!0},onClick:this.handleButtonClick},(0,s.h)(a.oO,{content:t?this.context.locale.t(o.Z.CLOSE_HIGHLIGHTS):this.context.locale.t(o.Z.OPEN_HIGHLIGHTS),position:a.lZ.UP_RIGHT,tooltipTimeout:(0,l.Jm)()?1e3:void 0},(0,s.h)("span",{class:"icon "+(t?"icon-dpad-down":"icon-dpad-up")}))):null}};c=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],c);const h=c},18676:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(26605);class n extends s.Component{constructor(){super()}render(){return(0,s.h)("div",{class:"no-highlights-message"},(0,s.h)("p",null,"Your space does not have any highlights yet."),(0,s.h)("p",null,"A Highlight Reel lets your visitors get a taste of what the Space is like.",(0,s.h)("a",{class:"link",target:"_blank",href:"https://support.matterport.com/hc/en-us/articles/360019401733"},"Learn More")))}}},15100:(e,t,i)=>{"use strict";i.d(t,{cR:()=>v,ZP:()=>S});var s=i(26605),n=(i(6225),i(2116)),o=i(72609),r=i(18676),a=i(59984),l=i(21265),c=i(19417),h=i(62367),d=i(14109);class u extends s.Component{constructor(e){super(e),this.highlights=[],this.highlightList=e=>{const{currentStep:t,onHighlightClicked:i}=this.props;return(0,s.h)("div",{class:"hlr-container"},(0,s.h)("div",{class:"highlights"},e.items.map(((e,n)=>(0,s.h)(d.Z,{key:`${e.sid}_${n}`,highlight:e,index:n,active:n===t,editable:!1,onClickHighlight:i,getRef:this.addHighlightRef})))))},this.addHighlightRef=(e,t)=>{this.highlights[e]=t,e===this.props.currentStep&&this.props.setActiveElement&&this.props.setActiveElement(t)}}render(){const{highlights:e}=this.props;return e&&e.length?(0,s.h)(this.highlightList,{items:e}):null}}var p=i(25799),m=i(62431),g=i(23549);const f=new p.Z("highlight-reel"),v=400;var y;!function(e){e[e.flash=0]="flash",e[e.expanded=1]="expanded",e[e.collapsed=2]="collapsed"}(y||(y={}));const b=[y.flash,y.expanded,y.collapsed];let w=class extends s.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,l.tq)(),this.showReel=()=>{if(this.props.onToggleHLR&&this.props.highlights.length>0)switch(this.hlStartupStyle){case y.expanded:case y.flash:this.props.onToggleHLR(!0)}},this.setActiveElement=e=>{this.setState({activeElement:e})},this.setHighlightClickable=(e=>this.highlightClickable=e).bind(this),this.onHighlightClicked=async e=>{const{commandBinder:t,analytics:i}=this.context;if(this.highlightClickable)try{this.props.tourPlaying&&await t.issueCommand(new c.vy),this.props.transition.active||(i.track("showcase_gui",{gui_action:"click_highlight"}),await t.issueCommand(new c.rU(e)).catch((e=>{if(!(e instanceof g.z))throw e;f.warn(e.message)})),this.setHighlightClickable(!1))}catch(e){f.debug(e)}},this.state={activeElement:null}}componentDidMount(){if(this.props.briefHlr){const e=this.context.settings.tryGetProperty(m.gx.HighlightReel,!0);!this.context.editMode&&this.props.totalSteps>0&&e&&(this.hlStartupStyle=this.getHlStartupValue(),(0,h.gw)(100).then((()=>{this.showReel(),(0,h.gw)(3e3).then((()=>{this.dismissReel(),this.props.onBriefHLR&&this.props.onBriefHLR()}))})))}}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()}))}render(){const{reelOpen:e,activeStep:t,highlights:i,totalSteps:n}=this.props,l=n>0,c=l?(0,s.h)(u,{highlights:i,currentStep:t,onHighlightClicked:this.onHighlightClicked,setActiveElement:this.setActiveElement}):(0,s.h)(r.Z,null);return(0,s.h)(a.N,{appendClass:{"highlight-reel":!0,"reel-viewing":l,"reel-empty":!l},open:e},(0,s.h)("div",{id:"reel-container"},(0,s.h)(o.Z,{totalSteps:n,activeElement:this.state.activeElement,mobile:this.mobile,highlightClickable:this.setHighlightClickable,thumbScrollingOnly:!1},c)))}getHlStartupValue(){const e=this.props.highlights.some((e=>e.snapshot.is360))?y.expanded:y.flash,t=(0,l.hu)("hl",e);return b.includes(t)?t:e}dismissReel(){this.props.onToggleHLR&&this.hlStartupStyle===y.flash&&this.props.onToggleHLR(!1)}};w=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],w);const S=w},72609:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(26605),n=i(94184),o=i(84952),r=i(10396),a=i(65277),l=i(95843);class c extends s.Component{constructor(e){super(e),this.onWindowResize=()=>{const e=(0,o.w)(window);this.state.hideScrollbar!==e&&this.setState({hideScrollbar:e})},this.onScrollableChanged=e=>{this.setState({scrollable:e})},this.onScrollPositionChange=e=>{this.setState({scrollPosition:e})},this.getScrollableContainer=()=>this.scrollbar?this.scrollbar.getScrollableContainer():void 0,this.handleHighlightClickable=()=>{this.props.highlightClickable(!0)},this.state={scrollLeft:0,hideScrollbar:(0,o.w)(window),scrollPosition:l.Ij.None,scrollable:!1},this.resizeSubscription=(0,r.kp)(r.g_.RESIZE,this.onWindowResize)}componentDidMount(){this.resizeSubscription.renew(),this.onScrollableChanged(!0),this.onScrollPositionChange(l.Ij.Beginning)}componentWillUnmount(){this.resizeSubscription.cancel()}componentDidUpdate(e){const{activeElement:t}=this.props;null!==t&&e.activeElement!==t&&this.scrollbar.scrollToElement(t)}setSorting(e){e?(this.el.classList.add("sorting"),this.props.mobile&&this.scrollbar.pauseScrollHandling()):this.el.classList.remove("sorting")}render(){const{thumbScrollingOnly:e,children:t,totalSteps:i}=this.props,{hideScrollbar:o,scrollPosition:r,scrollable:c}=this.state,h=n({scrollable:c,[r]:!0});return(0,s.h)("div",{id:"reel",class:h,ref:e=>{this.el=e}},(0,s.h)(a.Z,{direction:l.Nm.horizontal,ref:e=>this.scrollbar=e,hideScrollbar:o,thumbScrollingOnly:e,waitToUpdate:0===i,handleClick:this.handleHighlightClickable,onScrollableChanged:this.onScrollableChanged,onScrollPositionChange:this.onScrollPositionChange},t))}}},14109:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var s=i(26605),n=i(94184),o=i(47924),r=i(44228),a=i(71208),l=i(26265),c=i(29359);const{HLR:h}=c.Z.WORKSHOP;class d extends s.Component{constructor(e){super(e),this.editHighlight=e=>{e.stopPropagation(),this.props.onClickHighlight(this.props.index,!0)},this.removeHighlight=e=>{e.stopPropagation(),this.props.onRemoveHighlight&&this.props.onRemoveHighlight(this.props.highlight.snapshot.sid)},this.onClickHighlight=e=>{e.preventDefault(),this.props.onClickHighlight(this.props.index,!1)},this.setContainerRef=e=>{const{index:t,getRef:i}=this.props;this.element=e,i(t,this.element)},this.setState({thumbnailUrl:""})}componentDidMount(){this.loadThumbnail()}async loadThumbnail(){const{snapshot:e}=this.props.highlight,t=await e.thumbnailUrl.get();this.setState({thumbnailUrl:t})}renderTransitionSettings(){const{locale:e}=this.context,{transitionType:t,panDirection:i,transitionCondition:n}=this.props;let a="pan-auto";i===r.kw.Left?a="icon icon-rotate-left":i===r.kw.Right&&(a="icon icon-rotate-right");let l="";return t===o.n.FadeToBlack?l=e.t(h.TRANSITION_SETTING_SLIDESHOW):t===o.n.Interpolate&&(l=e.t(h.TRANSITION_SETTING_WALKTHROUGH)),(0,s.h)("div",{class:"transition-settings"},(0,s.h)("span",{class:"transition-type"},l,n&&(0,s.h)("span",null,"*")),(0,s.h)("span",{class:`pan-icon ${a}`}))}renderImageBar(){const{locale:e}=this.context,{highlight:t,editable:i}=this.props,o=t.snapshot.is360,r=t.snapshot.metadata.cameraMode,a=this.getMarker(r,o),c=e.t(h.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE),d=e.t(h.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE);return(0,s.h)("div",{class:"image-bar"},(0,s.h)("span",{class:n("highlight-marker",a)}),i&&(0,s.h)(l.oO,{className:"highlight-remove",content:c,position:l.lZ.DOWN_RIGHT},(0,s.h)("span",{class:n("icon-delete"),onClick:this.removeHighlight})),i&&(0,s.h)(l.oO,{className:"highlight-edit",content:d,position:l.lZ.DOWN_LEFT},(0,s.h)("span",{class:n("icon-toggle-pencil"),onClick:this.editHighlight})))}getMarker(e,t){return e===a.Ey.Dollhouse||e===a.Ey.Floorplan?null:t?"icon-360":"icon-panorama"}render(){const{thumbnailUrl:e}=this.state,{highlight:t,active:i,editable:o}=this.props,{name:r}=t.snapshot,a=!!r||o,l=e?{backgroundImage:`url('${e}')`}:{};return(0,s.h)("div",{class:n("highlight-box",{active:i,editable:o}),onClick:this.onClickHighlight,ref:this.setContainerRef},(0,s.h)("div",{class:"highlight-image",style:l}),this.renderImageBar(),o&&this.renderTransitionSettings(),(0,s.h)("div",{class:n("image-name",{shadowed:a})},(0,s.h)("span",{class:"static-text"},r)))}}},8336:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var s,n,o=i(26605),r=i(27871),a=i(39936),l=i(12775),c=i(72942),h=i(93227),d=i(19417),u=i(29359),p=i(25799);!function(e){e.Inside="panorama",e.InsideMesh="mesh",e.Dollhouse="dollhouse",e.Floorplan="floorplan",e.None="none"}(s||(s={})),function(e){e.Inside="click_inside_mode_button",e.InsideMesh="click_mesh_mode_button",e.Dollhouse="click_dollhouse_mode_button",e.Floorplan="click_dollhouse_mode_button"}(n||(n={}));var m=i(80429),g=i(42733),f=i(26265);class v extends o.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this)}get tooltip(){return this.context.locale.t(this.props.tooltipPhraseKey)}onClick(){const{buttonId:e,analyticsName:t}=this.props;this.props.onClick(e,t)}render(){const{disabled:e,hidden:t,activeButtonId:i,buttonId:s}=this.props;return t||i===s?null:(0,o.h)(m.h,{onClick:this.onClick,appendClass:{[`mode-${s}`]:!0},buttonState:e?g.BN.DECORATIVE:g.BN.ENABLED},(0,o.h)(f.oO,{content:this.tooltip,position:f.lZ.UP},(0,o.h)("span",{class:`icon icon-${s}`})))}}const y=new p.Z("mode-buttons");class b extends o.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this)}async onClick(e,t){const{analytics:i,commandBinder:n}=this.context;if(e!==this.props.activeButtonId&&!this.props.transitioning){i.track("showcase_gui",{gui_action:t});try{const t=function(e){switch(e){case s.Dollhouse:return c.BD.DOLLHOUSE;case s.Floorplan:return c.BD.FLOORPLAN;case s.Inside:case s.InsideMesh:return c.BD.INSIDE;default:throw new Error(`cannot get viewmode for mode buttonId ${e}`)}}(e);if(await n.issueCommand(new d.vy),await n.issueCommand(new c._i(t)),[s.Inside,s.InsideMesh].includes(e)){const t=e===s.InsideMesh?1:0;n.issueCommand(new h.g(t))}}catch(e){y.warn(e)}}}render(){const{activeButtonId:e,transitioning:t,dollhouseHidden:i,floorplanHidden:r,meshHidden:a}=this.props;return(0,o.h)("div",{class:"mode-buttons"},(0,o.h)(v,{tooltipPhraseKey:u.Z.VIEW_INSIDE_MESH,analyticsName:n.InsideMesh,buttonId:s.InsideMesh,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:a}),(0,o.h)(v,{tooltipPhraseKey:u.Z.VIEW_INSIDE,analyticsName:n.Inside,buttonId:s.Inside,activeButtonId:e,onClick:this.onClick,disabled:t}),(0,o.h)(v,{tooltipPhraseKey:u.Z.VIEW_DOLLHOUSE,analyticsName:n.Dollhouse,buttonId:s.Dollhouse,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:i}),(0,o.h)(v,{tooltipPhraseKey:u.Z.VIEW_FLOORPLAN,analyticsName:n.Floorplan,buttonId:s.Floorplan,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:r}))}}var w=i(62431);const S=["dh",w.gx.Dollhouse],T=["fp",w.gx.FloorPlan],E={showingMesh:!1,commandViewmode:c.g,dollhouseHidden:!1,floorplanHidden:!1};class _ extends o.Component{constructor(e){super(e),this.bindings=[],this.onMeshDataUpdate=e=>{const t=0!==e.value;this.setState({showingMesh:t})},this.onDollhouseDataUpdate=()=>{const{editMode:e,market:t}=this.context,i=t.tryGetData(a.e);if(!i)return;const s=function(e,t){if(t)return!1;const i=e.checkUrlParam("dh",0,1),s=!e.tryGetProperty(w.gx.Dollhouse,!1);return i||s}(i,e);this.setState({dollhouseHidden:s})},this.onFloorplanDataUpdate=()=>{const{editMode:e,market:t}=this.context,i=t.tryGetData(a.e);if(!i)return;const s=function(e,t){if(t)return!1;const i=e.checkUrlParam("fp",0,1),s=!e.tryGetProperty(w.gx.FloorPlan,!1);return i||s}(i,e);this.setState({floorplanHidden:s})},this.onViewmodeUpdate=e=>{const t=e.value;if(!t)return;const i=(0,c.ty)(t);this.setState({commandViewmode:i})},this.state=E}async componentDidMount(){const{market:e}=this.context;e.waitForData(r._).then((e=>{this.bindings.push(e.onPropertyChanged("opacity",this.onMeshDataUpdate)),this.onMeshDataUpdate(e.opacity)})),e.waitForData(a.e).then((e=>{S.forEach((t=>{this.bindings.push(e.onPropertyChanged(t,this.onDollhouseDataUpdate))})),T.forEach((t=>{this.bindings.push(e.onPropertyChanged(t,this.onFloorplanDataUpdate))})),this.onDollhouseDataUpdate(),this.onFloorplanDataUpdate()})),this.context.market.waitForData(l.O).then((e=>{this.bindings.push(e.onPropertyChanged("currentModeObservable",this.onViewmodeUpdate)),this.onViewmodeUpdate(e.currentModeObservable)}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.bindings=[]}render(){const{editMode:e}=this.context,{unaligned:t}=this.props,{commandViewmode:i,showingMesh:n,dollhouseHidden:r,floorplanHidden:a}=this.state,l=i===c.BD.TRANSITIONING;l||(this.activeButtonId=function(e,t,i){return e?s.None:t===c.BD.DOLLHOUSE?s.Dollhouse:t===c.BD.FLOORPLAN?s.Floorplan:t===c.BD.INSIDE?i?s.InsideMesh:s.Inside:s.None}(t,i,n));const h=function(e,t){return!t||e!==s.Inside}(this.activeButtonId,e);return(0,o.h)(b,{activeButtonId:this.activeButtonId,transitioning:l,dollhouseHidden:r,floorplanHidden:a,meshHidden:h})}}},14900:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var s=i(26605),n=i(94184),o=i(2116),r=i(29359),a=i(19417),l=i(26265),c=i(80429),h=i(42733);const d=new(i(25799).Z)("tour-controls");let u=class extends s.Component{constructor(e){super(e),this.handlePlayPause=async()=>{if(!this.props.tourEmpty)try{this.props.tourPlaying?await this.stopTour():(this.context.analytics.track("showcase_gui",{gui_action:"play_highlights"}),await this.startTour())}catch(e){d.debug(e)}}}async startTour(){try{await this.context.commandBinder.issueCommand(new a.TH)}catch(e){d.debug(e)}}async stopTour(){try{this.context.analytics.track("showcase_gui",{gui_action:"pause_highlights"}),await this.context.commandBinder.issueCommand(new a.vy)}catch(e){d.debug(e)}}render(){const{tourEmpty:e,tourPlaying:t}=this.props,i="ontouchstart"in window,o=e?h.BN.DISABLED:t?h.BN.ACTIVE:h.BN.ENABLED;return(0,s.h)(c.h,{buttonState:o,onClick:this.handlePlayPause,appendClass:{"tour-controls":!0}},e?(0,s.h)("span",{class:"icon icon-play"}):(0,s.h)(l.oO,{content:t?this.context.locale.t(r.Z.PAUSE):this.context.locale.t(r.Z.PLAY),position:l.lZ.UP,tooltipTimeout:i?1e3:void 0},(0,s.h)("span",{class:n({icon:!0,"icon-pause":t,"icon-play":!t})})))}};u=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],u);const p=u},35543:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(26605),n=i(94184),o=i(2116);let r=class extends s.Component{constructor(e){super(e),this.handleClick=()=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_progress"}),this.props.reelOpen||this.props.onToggleHLR(!0)}}getTourSteps(){const{totalSteps:e,activeStep:t}=this.props,i=[];for(let o=0;o<e;o++)i.push((0,s.h)("div",{class:n({active:o===t}),key:o.toString()}));return i}render(){const{reelOpen:e,tourPlaying:t,activeStep:i,totalSteps:o}=this.props,r=i+1+"/"+o,a=-1!==i&&!e&&r,l=-1!==i&&e&&t;return o>0?(0,s.h)("div",{id:"tour-progress",class:n({"faded-in":t}),onClick:this.handleClick,"data-balloon":a,"data-balloon-pos":"right","data-balloon-size":"xs"},l&&(0,s.h)("div",{class:"progress-number"},r),-1!==i&&(0,s.h)("div",{class:"progress-bar"},this.getTourSteps())):null}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],r);const a=r},59059:(e,t,i)=>{"use strict";i.d(t,{B:()=>f});var s=i(26605),n=i(2116),o=i(86134),r=i(42733),a=i(80429),l=i(62431),c=i(14600),h=i(7351),d=i(75328),u=i(72822),p=i(76104),m=i(26265),g=i(29359);let f=class extends s.Component{constructor(e,t){super(),this.propertiesToRefreshUi=[c.F.UnitType,c.F.MeasurementSnapping,c.F.MeasurementContinuousLines],this.close=()=>{this.setState({settingsOpen:!1})},this.updatePerSettings=()=>{this.setState({units:this.context.settings.tryGetProperty(c.F.UnitType,l.Mc.Metric),snapping:this.context.settings.tryGetProperty(c.F.MeasurementSnapping,!1),continuousLines:this.context.settings.tryGetProperty(c.F.MeasurementContinuousLines,!1)})},this.toggleUnits=()=>{const e=this.state.units!==l.Mc.Metric?l.Mc.Metric:l.Mc.USFractional;this.context.settings.setLocalStorageProperty(c.F.UnitType,e)},this.toggleSnapping=()=>{const e=this.state.snapping;this.context.settings.setLocalStorageProperty(c.F.MeasurementSnapping,!e)},this.toggleOpen=e=>{const{onToggle:t}=this.props;t&&t(e,!this.state.settingsOpen),this.setState((e=>({settingsOpen:!e.settingsOpen})))},this.toggleContinuousLines=()=>{const e=this.state.continuousLines;this.context.settings.setLocalStorageProperty(c.F.MeasurementContinuousLines,!e)},this.locale={continuousLinesString:t.locale.t(g.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(g.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(g.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(g.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(g.Z.MEASUREMENT_METRIC),settingsString:t.locale.t(g.Z.MEASUREMENT_SETTINGS),closeString:t.locale.t(g.Z.CLOSE)},this.state={settingsOpen:!1,units:l.Mc.Metric,snapping:!1,continuousLines:!1}}async componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.updatePerSettings);this.updatePerSettings()}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.updatePerSettings)}render(){const{iconButtonStyle:e}=this.props,{settingsOpen:t}=this.state,{settingsString:i}=this.locale,n=e||a.D.OVERLAY;return(0,s.h)(a.h,{appendClass:{"measurement-settings-btn":!0},buttonStyle:n,iconClass:"icon-settings",buttonState:t?r.BN.ACTIVE:r.BN.ENABLED,onClick:this.toggleOpen,tooltipMsg:!t&&i||void 0,tooltipPosition:m.lZ.DOWN},this.renderSettingsPopup())}renderSettingsPopup(){const{settingsOpen:e,units:t,snapping:i,continuousLines:n}=this.state,{continuousLinesString:r,snappingString:a,unitsString:c,imperialString:m,metricString:g}=this.locale,f=t===l.Mc.Metric;return(0,s.h)(h.J,{appendClass:{"measurement-settings-popup":!0},arrowPosition:o.x.TOP_RIGHT,open:e,close:this.close},(0,s.h)(d.w,{label:a},(0,s.h)(u.Z,{onToggle:this.toggleSnapping,enabled:!0,onOffLabel:!0,toggled:i})),(0,s.h)(d.w,{label:r},(0,s.h)(u.Z,{onToggle:this.toggleContinuousLines,enabled:!0,onOffLabel:!0,toggled:n})),(0,s.h)(d.w,{label:c,appendClass:"units-setting"},(0,s.h)("div",{class:"radio-group radio-buttons"},(0,s.h)(p.E,{name:"unit",value:l.Mc.USFractional,id:"unit-imperial",enabled:!0,checked:!f,onChange:this.toggleUnits},m),(0,s.h)(p.E,{name:"unit",value:l.Mc.Metric,id:"unit-metric",enabled:!0,checked:f,onChange:this.toggleUnits},g))))}};f=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],f)},18403:(e,t,i)=>{"use strict";i.d(t,{u:()=>E});var s=i(9608),n=i(83455),o=i(42885),r=i(57155),a=i(91172),l=i(98809),c=i(54590),h=i(42060),d=i(86034),u=i(60579),p=i(35887),m=i(22729),g=i(26983),f=i(77956),v=i(12775),y=i(94944),b=i(9872),w=i(22936),S=i(29359);const{MEASUREMENTS:T}=S.Z.WORKSHOP;class E{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[l.U]:!1,[o.s]:!1,[r.N]:!1,[a.re]:!1,[n.Mp]:!1},this.settingsToggler=new s.u(t,this.disabledAssets)}async activate(){if(!this.initialized){this.initialized=!0;const e=this.engine,[t,i,s,n]=await Promise.all([e.market.waitForData(g.X),e.market.waitForData(m.c),e.market.waitForData(f.Z),e.market.waitForData(v.O)]);this.dataMap={measurementModeData:t,floorsViewData:i,sweepData:s,viewmodeData:n}}this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommandWhenBound(new c.O(!0,!0))}async deactivate(){this.settingsToggler.toggle(!1),this.dataMap.measurementModeData.setSelectedGroupIndex(-1),await this.engine.commandBinder.issueCommand(new c.O(!1))}in360view(){const e=this.dataMap.sweepData.currentSweep?this.dataMap.sweepData.currentSweep:"";return this.dataMap.viewmodeData.isPano()&&this.dataMap.sweepData.isSweepUnaligned(e)}getSelectedMeasurement(){return this.dataMap.measurementModeData.selectedGroupSid}renameMeasurement(e,t){return this.engine.commandBinder.issueCommand(new h.R(e,t))}setMeasurementVisibility(e,...t){return this.engine.commandBinder.issueCommand(new d.W(e,...t))}async batchDeleteMeasurement(e){const t=e.length,i=(0,w.P)(t,T.TYPE);return await this.engine.commandBinder.issueCommand(new b.Q(b.f.DISPLAY,i))!==y.U.CLOSE&&(this.engine.commandBinder.issueCommand(new u.JM(...e)),!0)}async deleteMeasurement(e){await this.engine.commandBinder.issueCommand(new u.JM(e))}async toggleSelected(e){await this.engine.commandBinder.issueCommand(new p.t(e))}}},60930:(e,t,i)=>{"use strict";i.d(t,{f:()=>C});var s=i(26605),n=i(94184),o=i(2116),r=i(45982),a=i(60579),l=i(77399),c=i(1437),h=i(62431),d=i(90709);const u=(e,t)=>{if(t===h.Mc.Metric)return`${e.toFixed(2)}m`;const{feet:i,inches:s}=(0,d.XJ)(e);return i>0?`${i}' ${s}"`:`${s}"`};var p=i(18120),m=i(86134),g=i(42733),f=i(80429),v=i(26265),y=i(14600),b=i(59059);const w={[r.au.CREATING]:!0,[r.au.CONFIRMING_POINT]:!0},S={[r.au.IDLE]:!0,[r.au.CREATING]:!0,[r.au.CREATING_NEXT_POINT]:!0},T=(r.au.CREATING,r.au.CONFIRMING_POINT,{[r.au.IDLE]:!0,[r.au.CREATING]:!0,[r.au.CREATING_NEXT_POINT]:!0});var E=i(43711),_=i(90601),x=i(12856),M=i(71583),P=i(29359);const A="measurement-mode-add-tooltip",O="measurement-mode-desktop-help",D="measurement-mode-mobile-help";var I;let C=I=class extends s.Component{constructor(e,t){super(),this.bindings=[],this.propertiesToRefreshUi=[y.F.UnitType,y.F.MeasurementSnapping,y.F.MeasurementContinuousLines,A,O,D],this.onMeasurementModeDataChanged=()=>{const{measurementModeData:e}=this.props.manager.dataMap,t=this.getSelectedGroup(),i=t?t.count:0,s=t?t.length:0,n=e.phase,o=e.pressProgress>=.95?1:e.pressProgress;n===r.au.CLOSED?(this.closeMeasurementHelpModal(),this.dismissAddTooltip()):n===r.au.IDLE&&this.updateAddTooltipVisibility(),this.setState({phase:n,pressProgress:o,pointPosition:e.pointPosition,totalLength:s,selectedNumPoints:i})},this.updatePerSettings=()=>{const e=this.context.settings;this.setState({units:e.tryGetProperty(y.F.UnitType,h.Mc.Metric),snapping:e.tryGetProperty(y.F.MeasurementSnapping,!1),continuousLines:e.tryGetProperty(y.F.MeasurementContinuousLines,!1),addTooltipShown:e.tryGetProperty(A,!1),desktopHelpShown:e.tryGetProperty(O,!1),mobileHelpShown:e.tryGetProperty(D,!1)})},this.updateAddTooltipVisibility=()=>{this.state.addTooltipShown||this.context.editMode||(this.setState({showAddTooltip:!0}),window.clearTimeout(this.startAddingTooltip),this.startAddingTooltip=window.setTimeout((()=>{this.dismissAddTooltip()}),I.START_ADDING_TOOLTIP_TIMEOUT))},this.dismissAddTooltip=()=>{this.setState({showAddTooltip:!1}),this.context.settings.setProperty(A,!0)},this.getOverlayComponents=()=>{const{mobile:e,openModal:t}=this.props,{units:i,mobileHelpShown:n,desktopHelpShown:o,totalLength:r}=this.state,{editMode:a}=this.context,l=t===x.P.MEASUREMENT_HELP,{closeString:c,helpString:h}=this.locale,d=a?"overlay-top-center":"overlay-bar",p=[(0,s.h)("div",{class:d},!a&&(0,s.h)("div",{class:"overlay-bar-filler"}),(0,s.h)("div",{class:"overlay-bar-center"},r>0&&(0,s.h)("div",{class:"overlay-info"},u(r,i))),!a&&(0,s.h)("div",{class:"overlay-bar-right"},(0,s.h)(f.h,{appendClass:{"measurement-help-btn":!0},buttonStyle:f.D.OVERLAY,iconClass:"icon-help",buttonState:l?g.BN.ACTIVE:g.BN.ENABLED,onClick:this.toggleHelpOpen,tooltipMsg:!l&&h||void 0,tooltipPosition:v.lZ.DOWN}),(0,s.h)(b.B,{ref:e=>this.measurementSettings=e,onToggle:this.settingsToggled}),(0,s.h)(f.h,{iconClass:"icon-close",buttonStyle:f.D.OVERLAY,tooltipMsg:c,tooltipPosition:v.lZ.DOWN,onClick:this.onCloseMeasurementTool})))];if(!o||!n){const t=e?this.getMobileHelp():this.getDesktopHelp();p.push(t)}return p},this.getMobileHelp=()=>{const{phase:e}=this.state,{pressHoldStart:t,pressHoldEnd:i,dragEdit:n}=this.locale.mobileHelp;let o,a;switch(e){case r.au.CREATING_NEXT_POINT:o=(0,s.h)("div",{class:"icon icon-drag-edit"}),a=(0,s.h)("span",{class:"message"},i);break;case r.au.EDITING:case r.au.POINT_PLACED:o=(0,s.h)("div",{class:"icon icon-finger-drag"}),a=(0,s.h)("span",{class:"message"},n);break;case r.au.CREATING:o=(0,s.h)("div",{class:"icon icon-press-hold"}),a=(0,s.h)("span",{class:"message"},t)}return(0,s.h)("div",{class:"overlay-message"},o,a)},this.getDesktopHelp=()=>{const{phase:e,selectedNumPoints:t}=this.state,{clickAnywhereString:n,escapeString:o}=this.locale.desktopHelp;let a,l;switch(e){case r.au.CREATING:a=(0,s.h)("div",{class:"icon icon-draw-lines"}),l=(0,s.h)("span",{class:"message"},n);break;case r.au.CREATING_NEXT_POINT:t>=3&&(a=(0,s.h)("div",{class:"escape-key"},(0,s.h)("img",{src:i(78899)})),l=(0,s.h)("span",{class:"message escape-message"},o))}return(0,s.h)("div",{class:"overlay-message"},a,l)},this.clickCTAButton=e=>{const{phase:t}=this.state;t===r.au.IDLE?this.onStartPointPlacement(e):this.onStopPointPlacement(e)},this.onDeleteMeasurement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new a.Ev)},this.onStartPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new l.c),this.dismissAddTooltip()},this.onStopPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new c.B)},this.onCloseMeasurementTool=async e=>{e&&e.stopPropagation(),this.closeMeasurementHelpModal(),await this.context.commandBinder.issueCommand(new E.tT(_.w1.MEASUREMENTS,!1)),this.measurementSettings&&this.measurementSettings.close(),this.dismissAddTooltip()},this.settingsToggled=(e,t)=>{e.stopPropagation(),t&&this.closeMeasurementHelpModal()},this.toggleHelpOpen=e=>{const{openModal:t}=this.props,i=t===x.P.MEASUREMENT_HELP;e.stopPropagation(),this.measurementSettings&&this.measurementSettings.close(),i||this.context.analytics.track("showcase_gui",{gui_action:"measure_mode_help_clicked"}),this.context.commandBinder.issueCommand(new M.Bz(x.P.MEASUREMENT_HELP,!i))},this.locale={startAddingString:t.locale.t(P.Z.MEASUREMENT_START_ADDING),continuousLinesString:t.locale.t(P.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(P.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(P.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(P.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(P.Z.MEASUREMENT_METRIC),desktopHelp:{clickAnywhereString:t.locale.t(P.Z.MEASUREMENT_HELP_CLICK_ANYWHERE),escapeString:t.locale.t(P.Z.MEASUREMENT_HELP_ESCAPE)},mobileHelp:{pressHoldStart:t.locale.t(P.Z.MEASUREMENT_HELP_PRESS_START),dragEdit:t.locale.t(P.Z.MEASUREMENT_HELP_DRAG_EDIT),pressHoldEnd:t.locale.t(P.Z.MEASUREMENT_HELP_PRESS_END)},helpString:t.locale.t(P.Z.HELP),closeString:t.locale.t(P.Z.CLOSE)},this.state={units:h.Mc.Metric,snapping:!1,continuousLines:!1,phase:r.au.CLOSED,selectedNumPoints:0,totalLength:0,pressProgress:0,pointPosition:null,showAddTooltip:!1,desktopHelpShown:!1,mobileHelpShown:!1,addTooltipShown:!1}}async componentDidMount(){const{measurementModeData:e}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.onMeasurementModeDataChanged),e.onDataChanged(this.onMeasurementModeDataChanged));for(const e of this.propertiesToRefreshUi)this.bindings.push(this.context.settings.onPropertyChanged(e,this.updatePerSettings));this.onMeasurementModeDataChanged(),this.updatePerSettings()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(){const{mobile:e}=this.props,{continuousLines:t,selectedNumPoints:i}=this.state;e?this.isCheckVisible()&&this.context.settings.setProperty(D,!0):(t?i>3:2===i)&&this.context.settings.setProperty(O,!0)}getSelectedGroup(){return this.props.manager.dataMap.measurementModeData.selectedGroupInfo}renderProgressCircle(){const{mobile:e}=this.props,{pressProgress:t,pointPosition:i,phase:o}=this.state;if(!e||null===i||t<=0||!w[o])return null;const r={left:i.x-I.pointButtonRadius/2+"px",top:i.y-I.pointButtonRadius/2+"px"};return(0,s.h)("div",{class:"measurement-overlay"},(0,s.h)("div",{class:"point-button-wrapper",style:r},(0,s.h)(p.$,{appendClass:n({complete:1===t,reset:0===t}),progress:100*t,innerRadius:I.pointButtonRadius,barWidth:I.pressProgressBarThickness},(0,s.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"}))))}render(){return(0,s.h)("div",{id:"measurement-mode-layer",class:"overlay"},this.getOverlayComponents(),this.renderProgressCircle(),this.renderOverlayCta())}hasCancelCta(){if(this.isCheckVisible())return!1;const{phase:e,selectedNumPoints:t}=this.state,i=e===r.au.CREATING&&0===t,s=e===r.au.CREATING_NEXT_POINT&&2===t;return i||s}isCheckVisible(){const{phase:e,continuousLines:t}=this.state;return this.isCompleteMeasurement()&&(t?e===r.au.CREATING_NEXT_POINT:e===r.au.CREATING)}isCompleteMeasurement(){const{continuousLines:e,selectedNumPoints:t}=this.state;return e?t>2:2===t}renderOverlayCta(){const{startAddingString:e}=this.locale,{mobile:t,unaligned:i}=this.props,{phase:n,showAddTooltip:o}=this.state,a=this.getSelectedGroup(),l=n===r.au.EDITING,c=a&&a.count>0&&(t?S[n]:T[n])?g.BN.ENABLED:g.BN.DISABLED,h=this.isCheckVisible()?"icon-checkmark":"icon-plus",d=i||l?g.BN.DISABLED:g.BN.ENABLED,u={"overlay-cta-btn":!0,"overlay-cta-cancel":this.hasCancelCta()};return(0,s.h)("div",{class:"overlay-cta"},(0,s.h)(m.u,{appendClass:{"tooltip-simple-medium":!0},open:o,message:(0,s.h)("span",null,e),arrowPos:m.x.BOTTOM_CENTER}),(0,s.h)(f.h,{appendClass:u,iconClass:h,buttonStyle:f.D.PRIMARY,buttonState:d,onClick:this.clickCTAButton}),(0,s.h)(f.h,{appendClass:{"overlay-cta-button-outer":!0},buttonStyle:f.D.OVERLAY,iconClass:"icon-delete",buttonState:c,onClick:this.onDeleteMeasurement}))}closeMeasurementHelpModal(){const{openModal:e}=this.props;e===x.P.MEASUREMENT_HELP&&this.context.commandBinder.issueCommand(new M.Bz(e,!1))}};C.pointButtonRadius=132,C.pressProgressBarThickness=8,C.START_ADDING_TOOLTIP_TIMEOUT=5e3,C=I=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],C)},43771:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var s=i(26605),n=i(2116),o=i(18120),r=i(59984);let a=class extends s.Component{constructor(e){super(e)}render(){const{showing:e}=this.props;return(0,s.h)(r.N,{open:e,appendClass:{"load-indicator":!0,"fade-in":e,"fade-out":!e}},(0,s.h)("div",{class:"center-container"},(0,s.h)(o.$,{progress:33,barWidth:4,progressColor:"#ffffff"})))}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a);const l=a},12856:(e,t,i)=>{"use strict";var s;i.d(t,{P:()=>s}),function(e){e.TERMS="terms",e.VR_SELECT="vrSelect",e.MATTERTAG="mattertag",e.MATTERTAG_EMBED="mattertagEmbLink",e.HELP="help",e.CTA="cta",e.MEASUREMENT_HELP="measurementModeHelp",e.SHARE="share",e.ATTACHMENT="attachmentViewer",e.ADD_FROM_PHOTOS="add_from_photos",e.HIGHLIGHT_EDITOR="highlight_editor",e.REVERT_CHANGES="revert_unpublished_modal",e.HLR_SETTINGS="hlr_settings"}(s||(s={}))},91307:(e,t,i)=>{"use strict";i.d(t,{L:()=>g});var s=i(9608),n=i(42885),o=i(57155),r=i(98809),a=i(91172),l=i(90991),c=i(36520),h=i(70008),d=i(72215),u=i(79283),p=i(13545),m=i(90039);class g{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[r.U]:!1,[o.N]:!1,[n.s]:!1,[a.re]:!1},this.settingsToggler=new s.u(t,this.disabledAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(d.X),e.waitForData(u.l),e.waitForData(p.c),e.waitForData(c.b),e.waitForData(h.B),e.waitForData(l.A)]).then((([e,t,i,s,n,o])=>(this.dataMap={notesViewData:e,commentsData:t,hashtagData:i,attachmentsData:s,pinsViewData:n,annotationsViewData:o},!0)))}async activate(){this.initialized||(this.initialized=!0,await this.initPromise),this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommand(new m.yK(!0))}async deactivate(){await this.engine.commandBinder.issueCommand(new m.yK(!1)),this.settingsToggler.toggle(!1)}}},75843:(e,t,i)=>{"use strict";i.d(t,{R:()=>v});var s,n=i(26605),o=i(2116),r=i(21265),a=i(90601),l=i(90926),c=i(90039),h=i(77113),d=i(83455),u=i(99363),p=i(86134),m=i(42733),g=i(80429),f=i(18120);let v=s=class extends n.Component{constructor(e){super(),this.bindings=[],this.touchDevice=(0,r.Jm)(),this.timeout=0,this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.updateOpenNoteView=()=>{this.setState({openNoteView:this.props.manager.dataMap.notesViewData.openNoteView})},this.updateForPinChanges=()=>{const e=this.props.manager.dataMap.pinsViewData;this.setState({pinState:e.pinState,creationProgress:e.progress,screenPosition:e.screenPosition,canPlace:e.canPlace,canAdd:e.canAdd})},this.clickCTAButton=e=>{this.setState({showAddTooltip:!1}),this.hasCancelCta()?(e.stopPropagation(),this.props.manager.dataMap.notesViewData.creatingNote&&this.context.commandBinder.issueCommand(new c.gc)):this.onStartAddingNote(e)},this.savePinAppearance=e=>{const{openNoteView:t}=this.state;t&&this.context.commandBinder.issueCommand(new c.oE(t.id,e))},this.onStartAddingNote=e=>{e.stopPropagation(),this.trackEvent("notes_overlay_click_add"),this.context.commandBinder.issueCommand(new c.VI)},this.deleteNote=()=>{const{openNoteView:e}=this.state;e&&(this.trackEvent("notes_overlay_click_delete"),this.context.commandBinder.issueCommand(new c.sG(e.id)))},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new c.df(!1))},this.toggleColorPicker=e=>{e.stopPropagation();const{notesPhase:t}=this.state,i=t===h.U.EDITING;this.context.commandBinder.issueCommand(new c.df(!i)),this.setState({showAddTooltip:!1})},this.state={showAddTooltip:!0,notesPhase:h.U.CLOSED,pinState:l.tS.IDLE,openNoteView:null,screenPosition:null,creationProgress:0,canPlace:!0,canAdd:!0}}componentDidMount(){const{notesViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateOpenNoteView),t.onChanged(this.updateForPinChanges)),this.updateNotesPhase(),this.updateForPinChanges(),this.updateOpenNoteView()}componentWillUnmount(){window.clearTimeout(this.timeout);for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}hasCancelCta(){const{pinState:e}=this.state;return e===l.tS.CREATING||e===l.tS.PLACING}renderOverlayMessage(){const{pinState:e,canPlace:t}=this.state;if(e===l.tS.CREATING||!this.touchDevice&&e===l.tS.PLACING||!t){const e=this.touchDevice?"Press and hold on the space to add a note":"Click on the space to add a note",i=this.touchDevice?"Unable to add note here, press and hold on the space to add a note":"Unable to add note here, click on the space to add a note.",s=t?e:i;return(0,n.h)("div",{class:"overlay-message"},(0,n.h)("div",{class:"icon icon-notes"}),(0,n.h)("span",{class:"message"},s))}return null}renderProgressCircle(){const{creationProgress:e,screenPosition:t,pinState:i}=this.state;if(!(i===l.tS.PRESSING&&e>0&&this.touchDevice&&t))return null;const o={left:t.x-s.PROGRESS_RADIUS/2+"px",top:t.y-s.PROGRESS_RADIUS/2+"px"};return(0,n.h)("div",{class:"point-button-wrapper",style:o},(0,n.h)(f.$,{progress:100*e,innerRadius:s.PROGRESS_RADIUS,barWidth:s.PROGRESS_WIDTH},(0,n.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}renderTopBar(){const{toolPanelLayout:e,manager:t}=this.props,{notesViewData:i}=t.dataMap,s=e===a.wS.SIDE_PANEL,o=i.creatingNote;if(s||o)return(0,n.h)("div",{class:"overlay-top-center"},this.renderOverlayMessage());{const{notesPhase:e,openNoteView:t}=this.state,i=e!==h.U.OPENING&&!!t,s=e===h.U.EDITING?m.BN.ACTIVE:i?m.BN.ENABLED:m.BN.DISABLED;return(0,n.h)("div",{class:"overlay-bar overlay-top-right"},(0,n.h)(g.h,{iconClass:"icon-stem-height",buttonStyle:g.D.OVERLAY,buttonState:s,onClick:this.toggleColorPicker}))}}renderActionBar(){const{toolPanelLayout:e}=this.props,{showAddTooltip:t,notesPhase:i,pinState:s,canAdd:o,openNoteView:r}=this.state,{users:c}=this.context,d="icon-plus",u=s===l.tS.CREATING||s===l.tS.PLACING,f=i===h.U.IDLE,v=i===h.U.VIEWING,y=i===h.U.EDITING,b=i===h.U.OPENING,w=e===a.wS.SIDE_PANEL,S=c.isEditor()&&(f||u||v||y),T=o?m.BN.ENABLED:m.BN.DISABLED,E={"overlay-cta-btn":!0,"overlay-cta-cancel":this.hasCancelCta()};if(!S)return null;if(w){const e=!u&&!b&&!!r,i=y?m.BN.ACTIVE:e?m.BN.ENABLED:m.BN.DISABLED;return(0,n.h)("div",{class:"overlay-cta"},(0,n.h)(g.h,{appendClass:{"overlay-cta-button-outer":!0,"overlay-cta-button-outer-left":!0},iconClass:"icon-stem-height",buttonStyle:g.D.OVERLAY,buttonState:i,onClick:this.toggleColorPicker}),(0,n.h)(p.u,{appendClass:{"tooltip-simple-medium":!0},open:t,message:(0,n.h)("span",null,"Click to add a note to your Space."),arrowPos:p.x.BOTTOM_CENTER,maxMsOpen:4e3}),(0,n.h)(g.h,{appendClass:E,iconClass:d,buttonStyle:g.D.PRIMARY,buttonState:T,onClick:this.clickCTAButton}),(0,n.h)(g.h,{appendClass:{"overlay-cta-button-outer":!0},buttonStyle:g.D.OVERLAY,iconClass:"icon-delete",buttonState:e?m.BN.ENABLED:m.BN.DISABLED,onClick:this.deleteNote}))}return(0,n.h)("div",{class:"overlay-cta"},(0,n.h)(g.h,{appendClass:E,iconClass:d,buttonStyle:g.D.PRIMARY,buttonState:T,onClick:this.clickCTAButton}))}render(){const{toolPanelLayout:e,openModal:t}=this.props;if(t)return null;const{openNoteView:i,notesPhase:s}=this.state,o=s===h.U.EDITING,r=e===a.wS.SIDE_PANEL;return(0,n.h)("div",{class:"overlay"},this.renderTopBar(),this.renderActionBar(),i&&r&&(0,n.h)(u.q,{pin:i,pinType:l.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,open:o,colors:d.ZP.colors,toolPanelLayout:e}),this.renderProgressCircle())}};v.PROGRESS_RADIUS=132,v.PROGRESS_WIDTH=8,v=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],v)},78641:(e,t,i)=>{"use strict";i.d(t,{s:()=>Y});var s=i(26605),n=i(2116),o=i(47924),r=i(51090),a=i(90601),l=i(29677),c=i(43098),h=i(90926),d=i(68611),u=i(43770),p=i(90039),m=i(77113),g=i(95892),f=i(94184),v=i(43711),y=i(73305),b=i(83455),w=i(80807),S=i(96240),T=i(82209),E=i(42733),_=i(80429),x=i(86134);let M=class extends s.Component{constructor(e){super(e),this.popupOpened=e=>{const{assetId:t,onToggleMenu:i}=this.props;e.id!==t&&(this.setState({open:!1}),i(t,!1))},this.toggleMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+x.u.POPUP_OFFSET>window.innerHeight?x.x.BOTTOM_RIGHT:x.x.TOP_RIGHT;this.setState((e=>{const i=!e.open;return i&&this.context.messageBus.broadcast(new T.nZ(this.props.assetId)),{arrowPosition:t,open:i}}))},this.closeMenu=()=>{const{assetId:e,onToggleMenu:t}=this.props;this.setState({open:!1}),t(e,!1)},this.clickMenu=e=>{this.setState({open:!1})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.state={open:!1,arrowPosition:x.x.TOP_RIGHT}}componentDidMount(){this.context.messageBus.subscribe(T.nZ,this.popupOpened)}componentWillUnmount(){this.context.messageBus.unsubscribe(T.nZ,this.popupOpened)}renderMenu(){const{children:e}=this.props,{open:t}=this.state;return(0,s.h)("div",{ref:this.setPopupMenu,class:"tooltip-menu",onClick:this.clickMenu},t&&e)}render(){const{assetId:e}=this.props,{open:t,arrowPosition:i}=this.state;return(0,s.h)(_.h,{buttonStyle:_.D.SOCIAL,buttonSize:E.qE.SMALL,iconClass:"icon-more-vert item-more-options",dataValue:e,onClick:this.toggleMenu},(0,s.h)(x.u,{open:t,onClose:this.closeMenu,message:this.renderMenu(),arrowPos:i,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}}))}};M=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],M);var P=i(59064);let A=class extends s.Component{constructor(e){super(e),this.editComment=()=>{this.trackEvent("notes_click_edit_comment"),this.props.onAnnotate(this.props.comment.id),this.annotation&&this.annotation.edit()},this.deleteComment=()=>{const{noteId:e,comment:t}=this.props;this.trackEvent("notes_click_delete_comment"),this.context.commandBinder.issueCommand(new p.mH(e,t.id))},this.saveChanges=(e,t)=>{const{comment:i,noteId:s,onCancel:n,onDone:o}=this.props;t?(this.trackEvent("notes_delete_empty_comment"),this.context.commandBinder.issueCommand(new p.mH(s,i.id)),n()):(this.context.commandBinder.issueCommand(new p.Uw(s,i.id,e)),o(i.id))},this.setAnnotationRef=e=>{this.annotation=e}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderAnnotation(e){const{comment:t,hashtags:i,active:n,onViewAttachment:o,onCancel:a,toolPanelLayout:l}=this.props,{text:c,edited:h,id:d}=t;return(0,s.h)(S.Z,{key:d,ref:this.setAnnotationRef,annotationStyle:S.Q.COLLABORATION,assetType:r.h.COMMENT,assetId:d,editable:e,clickToEdit:!1,active:n,edited:h,creating:!1,text:c,hashtags:i,toolPanelLayout:l,onViewAttachment:o,onDoneEditing:this.saveChanges,onCancelEditing:a,maxLength:b.Ko})}render(){const{comment:e,active:t,onToggleMenu:i}=this.props,{user:n,created:o,id:r}=e,a=this.context.users.isEditor(),l=this.context.users.getUserInfo(n)||(0,w.Q)(n),c=l.color,h=l.id===this.context.users.getCurrentUserId();return(0,s.h)("div",{class:f("comment",{active:t})},(0,s.h)("div",{class:"note-header comment-header"},(0,s.h)(P.C,{badgeStyle:{color:c,"border-color":c},label:l.initials}),(0,s.h)("div",{class:"note-details"},(0,s.h)("span",{class:"note-user"},l.name),(0,s.h)("div",{class:"note-subheader"},o.toLocaleString())),!t&&a&&(0,s.h)(M,{assetId:r,onToggleMenu:i},h&&(0,s.h)("div",{class:"tpMsg",onClick:this.editComment},"Edit"),(0,s.h)("div",{class:"tpMsg",onClick:this.deleteComment},"Delete"))),this.renderAnnotation(h))}};A=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],A);let O=class extends s.Component{constructor(e){super(e),this.startReply=()=>{const{replyId:e,onAnnotate:t}=this.props;this.trackEvent("notes_click_new_comment"),t(e)},this.saveChanges=(e,t)=>{const{replyId:i,noteId:s,onDone:n,onCancel:o}=this.props;t?o():(n(i),this.context.commandBinder.issueCommand(new p.Df(s,e,i)))}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{hashtags:e,replyId:t,active:i,onCancel:n,toolPanelLayout:o}=this.props;return(0,s.h)(S.Z,{appendClass:{"reply-box":!0},annotationStyle:S.Q.COLLABORATION,assetType:r.h.COMMENT,assetId:t,editable:!0,clickToEdit:!0,active:i,edited:!1,creating:!0,text:"",hashtags:e,toolPanelLayout:o,placeholder:"Reply...",onClickToEdit:this.startReply,onDoneEditing:this.saveChanges,onCancelEditing:n,maxLength:b.Ko})}};O=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],O);var D=i(21265),I=i(87694),C=i(26265);let R=class extends s.Component{constructor(e){super(e),this.editNote=()=>{const{note:e,onAnnotate:t}=this.props;this.trackEvent("notes_click_edit_note"),t(e.id)},this.deleteNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_delete_note"),this.context.commandBinder.issueCommand(new p.sG(e.id))},this.resolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_resolve_note"),this.context.commandBinder.issueCommand(new p.yp(e.id,!0))},this.unresolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_unresolve_note"),this.context.commandBinder.issueCommand(new p.yp(e.id,!1))},this.onCopyLink=async()=>{if(this.state.linkCopied)return;const e=this.createLinkToNote(),t=document.createElement("input");t.type="text",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.setState({linkCopied:!0}),window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)},this.state={linkCopied:!1}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}createLinkToNote(){this.trackEvent("notes_click_copy_link");const e=I.K.removeNavigationKeys((0,D.AO)());e.note=this.props.note.id;const t=Object.keys(e).map((t=>t+"="+e[t])).join("&");return`${window.location.origin}${window.location.pathname}?${t}`}render(){const{note:e,creatingNote:t,onToggleMenu:i}=this.props,{linkCopied:n}=this.state,{users:o}=this.context,r=o.isEditor(),a=o.getUserInfo(e.user)||o.getUnknownUserInfo(e.user),l=a.color,c=!t&&!n,h=e.user===this.context.users.getCurrentUserId();return(0,s.h)("header",{class:"note-header"},(0,s.h)(P.C,{badgeStyle:{color:l,"border-color":l},label:a.initials}),(0,s.h)("div",{class:"note-details"},(0,s.h)("span",{class:"note-user"},a.name),(0,s.h)("div",{class:"note-subheader"},e.created.toLocaleString())),c&&!e.resolved&&r&&(0,s.h)(_.h,{iconClass:"icon-checkmark",buttonStyle:_.D.SOCIAL,buttonSize:E.qE.SMALL,buttonState:E.BN.ENABLED,tooltipMsg:"Mark as resolved",tooltipPosition:C.lZ.DOWN,onClick:this.resolveNote}),c&&(0,s.h)(_.h,{iconClass:"icon-link",buttonStyle:_.D.SOCIAL,buttonSize:E.qE.SMALL,buttonState:E.BN.ENABLED,tooltipMsg:"Copy Link",tooltipPosition:C.lZ.DOWN,onClick:this.onCopyLink}),n&&(0,s.h)("div",{class:"link-copied"},"Link copied"),c&&r&&(0,s.h)(M,{assetId:e.id,onToggleMenu:i},h&&(0,s.h)("div",{class:"tpMsg",onClick:this.editNote},"Edit"),e.resolved&&(0,s.h)("div",{class:"tpMsg",onClick:this.unresolveNote},"Unresolve"),(0,s.h)("div",{class:"tpMsg",onClick:this.deleteNote},"Delete")))}};R=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],R);var L=i(25255),N=i(81323),k=i(30300),F=i(99363);let B=class extends s.Component{constructor(e){super(e),this.bindings=[],this.onScrollOpenNote=()=>{},this.onModalChange=()=>{const e=!!this.context.toolsData.openModal;e!==this.state.modalOpen&&(e||this.toolPanel&&this.props.toolPanelLayout===a.wS.BOTTOM_PANEL&&this.toolPanel.resetScrollTop(),this.setState({modalOpen:e}))},this.updateToolAssetAccess=()=>{this.setState({toolAccess:this.context.toolsData.toolAccess})},this.onFocusPin=()=>{this.props.manager.dataMap.notesViewData.creatingNote&&this.startEditingNote()},this.startEditingNote=()=>{const e=this.props.manager.dataMap.notesViewData.notesPhase;this.noteAnnotation&&e===m.U.ANNOTATING&&this.noteAnnotation.edit()},this.closeNotesMode=()=>{this.context.commandBinder.issueCommand(new v.tT(a.w1.NOTES,!1))},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new p.df(!1))},this.savePinAppearance=e=>{const{note:t}=this.props;t&&this.context.commandBinder.issueCommand(new p.oE(t.id,e))},this.saveNoteChanges=(e,t)=>{const{note:i,manager:s}=this.props;i&&(s.dataMap.notesViewData.creatingNote?this.context.commandBinder.issueCommand(new p.FB(e)):this.context.commandBinder.issueCommand(new p.kd(i.id,{text:e})),this.setState({activeAnnotation:null}))},this.cancelChanges=()=>{const{note:e,manager:t}=this.props;t.dataMap.notesViewData.creatingNote?this.closeNote():e&&this.context.commandBinder.issueCommand(new p.Wh(e.id)),this.setState({activeAnnotation:null})},this.closeNote=()=>{this.props.manager.dataMap.notesViewData.creatingNote?this.context.commandBinder.issueCommand(new p.gc):this.context.commandBinder.issueCommand(new p._N),this.setState({activeAnnotation:null})},this.onEditAnnotation=e=>{const{note:t,manager:i}=this.props;i.dataMap.notesViewData.setNotesPhase(m.U.ANNOTATING),t&&e===t.id&&this.startEditingNote(),this.setState({activeAnnotation:e})},this.onDone=e=>{this.state.activeAnnotation===e&&this.setState({activeAnnotation:null})},this.onViewAttachment=(e,t)=>{const i=this.getAllMedia(),s=i.findIndex((e=>e.id===t));this.trackEvent("notes_click_view_attachment"),-1!==s&&this.context.commandBinder.issueCommand(new y.SI(i,s))},this.getNoteAttachments=()=>{const{note:e,attachments:t}=this.props,i=[];return e&&t.forEach((t=>{t.assetType===r.h.NOTE&&t.assetId===e.id&&i.push(t)})),i},this.getCommentAttachments=e=>{const t=[];return this.props.attachments.forEach((i=>{i.assetType===r.h.COMMENT&&i.assetId===e&&t.push(i)})),t},this.onNavigate=e=>{this.props.onSwitchAnnotation(e)},this.toggleOptionsMenu=(e,t)=>{t&&this.setState({activeAnnotation:null})},this.setNoteAnnotationRef=e=>{this.noteAnnotation=e},this.setToolPanelRef=e=>{e&&(this.toolPanel=e)};const t=e.creatingNote||e.notesPhase===m.U.ANNOTATING;this.state={modalOpen:!1,activeAnnotation:e.note&&t?e.note.id:null,toolAccess:a.X$.SCENE}}componentDidMount(){const{messageBus:e,toolsData:t}=this.context;this.bindings.push(e.subscribe(u.nY,this.onFocusPin),t.onOpenModalChanged(this.onModalChange),t.onToolAssetAccessChanged(this.updateToolAssetAccess)),this.onModalChange(),this.updateToolAssetAccess()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentWillReceiveProps(e){const t=e.note?e.note.id:null;if(t){if(t!==(this.props.note?this.props.note.id:null)){const i=e.creatingNote||e.notesPhase===m.U.ANNOTATING;this.setState({activeAnnotation:i?t:null})}}else this.setState({activeAnnotation:null})}componentDidUpdate(e,t){this.toolPanel&&(e.notesPhase!==m.U.EDITING&&this.props.notesPhase===m.U.EDITING||e.note!==this.props.note)&&this.toolPanel.resetScrollTop(),!e.note&&this.props.note&&this.props.notesPhase===m.U.ANNOTATING&&this.startEditingNote()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getAllMedia(){const{comments:e}=this.props;let t=this.getNoteAttachments();return e.forEach((e=>{t=t.concat(this.getCommentAttachments(e.id))})),t}renderReplyBox(){const{note:e,replyId:t,hashtags:i,comments:n,toolPanelLayout:o}=this.props,{activeAnnotation:r}=this.state,a=r===t;return!e||!a&&null!==r?null:(0,s.h)(O,{key:`reply-${n.length}`,replyId:t,noteId:e.id,active:a,hashtags:i,toolPanelLayout:o,onAnnotate:this.onEditAnnotation,onDone:this.onDone,onCancel:this.cancelChanges})}renderComments(){const{comments:e,note:t,hashtags:i,toolPanelLayout:n}=this.props;if(!t)return null;const{activeAnnotation:o}=this.state;return(0,s.h)("div",{class:"note-comments"},e.map((e=>(0,s.h)(A,{key:e.id,comment:e,noteId:t.id,active:o===e.id,hashtags:i,toolPanelLayout:n,onAnnotate:this.onEditAnnotation,onDone:this.onDone,onCancel:this.cancelChanges,onToggleMenu:this.toggleOptionsMenu,onViewAttachment:this.onViewAttachment}))))}renderNoteNavHeader(){const{notesPhase:e,listIndex:t,numAnnotations:i,creatingNote:n,note:o,toolPanelLayout:r}=this.props;if(n||!o)return null;const{toolAccess:l}=this.state,c=e===m.U.ANNOTATING,h=!n&&!c&&i>1&&-1!==t,d=r===a.wS.SIDE_PANEL,u=l===a.X$.SCENE,p=l===a.X$.LIST||!u&&d,g=p?"Back":"Close",f=p?"icon-back":"icon-close",v=p||!u?this.closeNote:this.closeNotesMode;return(0,s.h)("div",{class:"detail-panel-header"},(0,s.h)(L.A,{label:g,className:"return-btn",icon:f,buttonSize:E.qE.SMALL,buttonStyle:E.ZJ.TOOLBAR,onClick:v}),h&&(0,s.h)(N.$,{index:t,total:i,disabled:c,wrapAround:!0,onNavigate:this.onNavigate}))}renderNoteAnnotation(){const{note:e,notesPhase:t,creatingNote:i,hashtags:n,toolPanelLayout:o}=this.props,{activeAnnotation:a}=this.state,l=e?e.id:"new",c=t===m.U.ANNOTATING&&(a===l||i),h=e?e.text:"",d=!(e&&e.user!==this.context.users.getCurrentUserId()),u=!!e&&e.edited;return(0,s.h)("div",{class:"note-post"},e&&(0,s.h)(R,{note:e,creatingNote:i,onToggleMenu:this.toggleOptionsMenu,onAnnotate:this.onEditAnnotation}),(0,s.h)(S.Z,{ref:this.setNoteAnnotationRef,annotationStyle:S.Q.COLLABORATION,assetId:l,assetType:r.h.NOTE,clickToEdit:!1,editable:d,active:c,edited:u,creating:i,text:h,hashtags:n,placeholder:"Add your message",toolPanelLayout:o,onViewAttachment:this.onViewAttachment,onDoneEditing:this.saveNoteChanges,onCancelEditing:this.cancelChanges,maxLength:b.TM}))}render(){const{note:e,notesPhase:t,creatingNote:i,closing:n,toolPanelLayout:o}=this.props,{modalOpen:r}=this.state,l=this.context.users.isEditor(),c=t===m.U.ANNOTATING,d=t===m.U.EDITING,u=o===a.wS.BOTTOM_PANEL,p=!(!e||n||u&&r),g=d&&u,v={annotating:c,creating:i};return(0,s.h)(k.J,{ref:this.setToolPanelRef,open:p,toolPanelLayout:o,onScrolled:this.onScrollOpenNote,scrollingDisabled:g},(0,s.h)("div",{class:f("note-widget",v)},this.renderNoteNavHeader(),this.renderNoteAnnotation(),!i&&this.renderComments(),!i&&l&&this.renderReplyBox()),e&&u&&(0,s.h)(F.q,{key:e.id,pin:e,pinType:h.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,colors:b.ZP.colors,open:d,toolPanelLayout:o}))}};B=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],B);var U,H=i(74674),G=i(96608),V=i(74121),z=i(4633),j=i(17666),W=i(20392),Z=i(53189);!function(e){e.TODAY="Today",e.YESTERDAY="Yesterday",e.THIS_WEEK="This week",e.ONE_WEEK_AGO="1 week ago",e.TWO_WEEKS_AGO="2 weeks ago",e.THREE_WEEKS_AGO="3 weeks ago",e.OLDER="Older"}(U||(U={}));const q=35;class K extends s.Component{constructor(e){super(e),this.bindings=[],this.updateNoteGroups=()=>{const e=new Set;this.props.annotationViews.forEach((t=>{e.add(t.user)}));const t=this.getSortedNoteGroups();this.setState({listGroups:t})},this.selectAnnotation=e=>{this.trackEvent("notes_list_open_note"),this.props.onOpenNote(e,!1)},this.editNote=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&(this.trackEvent("notes_list_edit_note"),this.props.onOpenNote(t,!0),this.setState({activeMenuId:null}))},this.deleteNote=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&(this.trackEvent("notes_list_delete_note"),this.context.commandBinder.issueCommand(new p.sG(t)),this.setState({activeMenuId:null}))},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.closeMenu=e=>{const t=e.target;t&&t.classList.contains("item-more-options")||this.setState({activeMenuId:null})},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+x.u.POPUP_OFFSET>window.innerHeight?x.x.BOTTOM_RIGHT:x.x.TOP_RIGHT,i=e.currentTarget,s=i&&i.getAttribute?i.getAttribute("data-value"):null;s&&this.state.activeMenuId!==s?this.setState({activeMenuId:s,arrowPosition:t,filterOpen:!1}):this.setState({activeMenuId:null,arrowPosition:t})},this.changeFilter=(e,t)=>{if(t){const e=t;this.trackEvent("notes_list_change_filter"),this.props.onChangeFilter(e)}},this.toggleFilter=e=>{e.stopPropagation(),this.setState((e=>({filterOpen:!e.filterOpen,activeMenuId:null})))},this.closeFilter=()=>{this.setState({filterOpen:!1})},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new v.tT(a.w1.NOTES,!1))},this.state={listGroups:{},activeMenuId:null,filterOpen:!1,arrowPosition:x.x.TOP_RIGHT}}componentDidMount(){this.updateNoteGroups()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e){e.annotationViews===this.props.annotationViews&&e.filter===this.props.filter&&e.searchBlock===this.props.searchBlock||this.updateNoteGroups()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getSortedNoteGroups(){const e={};return this.props.annotationViews.forEach((t=>{const i=this.getDateBucket(t.createdTime);e[i]||(e[i]={dateBucket:i,items:[]}),e[i].items.push(t)})),e}getDateBucket(e){const t=new Date(e),i=new Date;i.setHours(0,0,0,0),t.setHours(0,0,0,0);const s=(i.getTime()-t.getTime())/864e5;if(0===s)return U.TODAY;if(1===s)return U.YESTERDAY;if(s<7)return U.THIS_WEEK;const n=Math.floor(s/7);return 1===n?U.ONE_WEEK_AGO:2===n?U.TWO_WEEKS_AGO:3===n?U.THREE_WEEKS_AGO:U.OLDER}getEmptyMessage(){const{filter:e,searchBlock:t}=this.props;return t?"No matches":e===g.$.OPEN?"You don't have any open notes.":e===g.$.RESOLVED?"You don't have any resolved notes.":"You don't have any notes yet."}getAnnotationText(e){const{searchBlock:t}=this.props;let i=e.text;if(""===i){const t=e.numAttachments,s=e.numComments;i=1===t?"1 attachment":t>1?`${t} attachments`:1===s?"1 reply":s>0?`${s} replies`:"Original content was deleted"}else if(t&&e.textIndex>0&&i.length>q){const s=i.length,n=t.text.length,o=Math.floor((q-n)/2);let r=e.textIndex-o;if(r+q>s&&(r-=r+q-s),r>0){const e=`...${i.substr(r)}`;e.length<q?(r-=q-e.length,r>0&&(i=`...${i.substr(r)}`)):i=e}}return i}getListTitle(){const{annotationViews:e,searchBlock:t}=this.props;let i;const s=e.length;return i=t?1===s?"1 Result":`${s} Results`:1===s?"1 Note":`${s} Notes`,i}renderNoteMenu(e){return(0,s.h)("div",{class:"tooltip-menu",ref:e=>this.setPopupMenu(e)},e&&(0,s.h)("div",{class:"tpMsg",onClick:this.editNote},"Edit"),(0,s.h)("div",{class:"tpMsg",onClick:this.deleteNote},"Delete"))}renderAnnotationSummary(e){const t=this.getAnnotationText(e);return(0,s.h)("div",{class:f("note-text",{"note-summary-info":!e.text})},(0,s.h)(Z.Z,{text:t,activeLinks:!1,hashtags:!0,userMentions:!0}))}renderItem(e,t){const{searchBlock:i}=this.props,{activeMenuId:n,arrowPosition:o}=this.state,{id:r,user:a,color:l,assetType:c}=e,h=e.numComments||0,d=this.context.users.isEditor(),u=n===r,p=this.context.users.getUserInfo(a)||{id:a,name:"",initials:""},m=p.id===this.context.users.getCurrentUserId(),g=1===h?`${h} reply`:`${h} replies`,f={"accordion-item-with-options":d,"note-header":!0};return(0,s.h)(W.Q,{key:`${c}${r}`,sid:r,appendClass:f,enabled:!0,selected:!1,onSelect:this.selectAnnotation},(0,s.h)(P.C,{badgeStyle:{"background-color":l,"border-color":l},iconClass:"icon-comment"}),(0,s.h)("div",{class:"note-details"},(0,s.h)("span",{class:"note-user"},p.name),h>0&&!i&&(0,s.h)("span",{class:"note-summary-info note-replies"},g),this.renderAnnotationSummary(e)),d&&!i&&(0,s.h)(_.h,{dataValue:r,appendClass:{"accordion-item-more-options":!0},buttonStyle:_.D.PLAIN,iconClass:"icon-more-vert item-more-options",onClick:this.toggleOptionsMenu},(0,s.h)(x.u,{open:u,onClose:this.closeMenu,message:this.renderNoteMenu(m),arrowPos:o,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}renderGroups(){const{listGroups:e}=this.state,t=[];for(const i in e){const n=e[i];t.push((0,s.h)(j.b,{key:i,id:i,header:n.dateBucket,open:!0,doubleLine:!0},n.items.map(((e,t)=>this.renderItem(e,t)))))}return t}renderFilter(){const{filter:e}=this.props,{filterOpen:t}=this.state,i=[{text:"Unresolved",value:g.$.OPEN,selected:e===g.$.OPEN},{text:"Resolved",value:g.$.RESOLVED,selected:e===g.$.RESOLVED},{text:"All",value:g.$.ALL,selected:e===g.$.ALL}];return(0,s.h)("div",{class:"filter note-filter"},(0,s.h)(V.S,{className:"filter-note-select",menuStyle:V.K.DROPDOWN,open:t,onToggle:this.toggleFilter,onSelect:this.changeFilter,onClose:this.closeFilter,options:i}))}renderAnnotations(){const{annotationViews:e}=this.props;if(0===e.length){const e=this.getEmptyMessage();return(0,s.h)("div",{class:"empty-message"},e)}return(0,s.h)(z.F,null,this.renderGroups())}renderSearchHeader(){const{searchBlock:e,onCancelSearch:t}=this.props;return e?(0,s.h)("div",{class:"search-header"},(0,s.h)("span",{class:"search-term"},e.text),(0,s.h)(E.zx,{buttonStyle:E.ZJ.PLAIN,onClick:t},"Clear")):null}renderSubheader(){return(0,s.h)("div",{class:"list-subheader"},this.renderSearchHeader(),this.renderFilter())}render(){const{active:e,toolPanelLayout:t,searchBlock:i}=this.props,n=!!i&&i.blockType===H.C.USER,o=!!i&&i.blockType===H.C.HASH;return(0,s.h)(G.L,{active:e,appendClass:{"annotations-list-panel":!0},title:this.getListTitle(),subheader:this.renderSubheader(),toolPanelLayout:t,onClose:this.onCloseLayer},(0,s.h)("div",{class:f("list-panel-list","annotations-list",{"search-results-user":n,"search-results-hash":o})},this.renderAnnotations()))}}let Y=class extends s.Component{constructor(e){super(e),this.bindings=[],this.noteClosedTimeout=0,this.updateAnnotationViews=()=>{const e=this.props.manager.dataMap.notesViewData.getAnnotationViewList();this.setState({annotationViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.notesViewData.listIndex;this.setState({listIndex:e})},this.updateNotesPhase=()=>{const e=this.props.manager.dataMap.notesViewData.notesPhase;this.setState({notesPhase:e})},this.pinPlaced=e=>{e.pinType===h.Er.NOTE&&this.startOpeningNoteWidget()},this.updateCurrentNote=async()=>{const{currentNote:e}=this.state,t=this.props.manager.dataMap.notesViewData,i=t.notesPhase,s=this.placingNewNote(i),n=t.openNoteView;s?e&&this.startClosingNoteWidget():!e&&n?this.startOpeningNoteWidget():e&&!n?this.startClosingNoteWidget():this.setState({currentNote:n})},this.updateHashtags=()=>{const e=this.props.manager.dataMap.hashtagData;this.setState({hashtags:e.getHashtags()})},this.updateMedia=()=>{const e=this.props.manager.dataMap.attachmentsData;this.setState({attachments:e.getAttachmentsForAssetTypes([r.h.NOTE,r.h.COMMENT])}),this.updateAnnotationViews()},this.updateNoteFilter=()=>{const e=this.props.manager.dataMap.notesViewData;this.setState({filter:e.notesFilter})},this.updateSearchTerm=()=>{const e=this.props.manager.dataMap.annotationsViewData;this.setState({searchBlock:e.searchBlock})},this.onChangeFilter=e=>{this.props.manager.dataMap.notesViewData.setNotesFilter(e)},this.onSwitchAnnotation=e=>{const t=this.state.annotationViews[e];if(!t)return;const i=t.assetId?t.assetId:t.id,s=this.props.toolPanelLayout===a.wS.SIDE_PANEL?o.n.FadeToBlack:o.n.Instant;this.context.commandBinder.issueCommand(new d.$b(i,h.Er.NOTE,s,void 0,e))},this.onOpenAnnotation=(e,t)=>{this.context.commandBinder.issueCommand(new p.ql(e,t))},this.onCancelSearch=()=>{this.context.commandBinder.issueCommand(new c.B)},this.state={noteClosing:!1,annotationViews:[],notesPhase:m.U.CLOSED,currentNote:null,hashtags:[],attachments:[],filter:g.$.OPEN,searchBlock:null,listIndex:-1}}componentDidMount(){const{notesViewData:e,hashtagData:t,attachmentsData:i,annotationsViewData:s}=this.props.manager.dataMap,{messageBus:n}=this.context;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onNotesFilterChanged(this.updateNoteFilter),e.onOpenNoteViewChanged(this.updateCurrentNote),e.onListIndexChanged(this.updateListIndex),e.getAnnotationViewList().onChanged(this.updateAnnotationViews),s.onSearchBlockChanged(this.updateSearchTerm),t.onChanged(this.updateHashtags),i.onChanged(this.updateMedia),n.subscribe(u.b0,this.pinPlaced)),this.updateMedia(),this.updateCurrentNote(),this.updateListIndex(),this.updateNotesPhase(),this.updateNoteFilter(),this.updateSearchTerm(),this.updateHashtags()}componentWillUnmount(){window.clearTimeout(this.noteClosedTimeout);for(const e of this.bindings)e.cancel()}placingNewNote(e){return e===m.U.CREATING}startOpeningNoteWidget(){const e=this.props.manager.dataMap.notesViewData;window.clearTimeout(this.noteClosedTimeout),this.setState({currentNote:e.openNoteView,noteClosing:!1})}startClosingNoteWidget(){this.state.noteClosing||(this.setState({noteClosing:!0}),this.noteClosedTimeout=window.setTimeout((()=>{this.setState({currentNote:null,noteClosing:!1})}),l.El))}getReplyId(){const{currentNote:e}=this.state;return e?`${e.id}-reply`:""}render(){const{toolPanelLayout:e,manager:t}=this.props,{notesViewData:i,commentsData:n}=t.dataMap,{noteClosing:o,filter:r,searchBlock:a,annotationViews:l,listIndex:c,notesPhase:h,currentNote:d,hashtags:u,attachments:p}=this.state,m=d?n.getCommentsForNote(d.id):[],g=l.length,f=m.sort(((e,t)=>e.created.getTime()-t.created.getTime())),v=this.getReplyId(),y=i.creatingNote;return(0,s.h)("div",{class:"tool-panel notes-panel"},(0,s.h)(B,{manager:t,closing:o,note:d,comments:f,hashtags:u,attachments:p,replyId:v,toolPanelLayout:e,notesPhase:h,creatingNote:y,numAnnotations:g,listIndex:c,onSwitchAnnotation:this.onSwitchAnnotation}),(0,s.h)(K,{active:o||!d,toolPanelLayout:e,annotationViews:l,filter:r,searchBlock:a,onOpenNote:this.onOpenAnnotation,onChangeFilter:this.onChangeFilter,onCancelSearch:this.onCancelSearch}))}};Y=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],Y)},10143:(e,t,i)=>{"use strict";i.d(t,{H:()=>v});var s=i(26605),n=i(25799),o=i(72942),r=i(7342),a=i(89155),l=i(22729),c=i(24550),h=i(2212),d=i(39869),u=i(48840),p=i(7121),m=i(41479);class g extends s.Component{constructor(e){super(e)}render(){const{sid:e,position:t,text:i,readOnlyText:n,rotation:o,visible:r}=this.props,a={left:t.x+"px",top:t.y+"px",transform:o?`translate(-50%, -50%) rotate(${o}deg) `:"translate(-50%, -50%)"},l=n?`${i} ${n}`:i;return r?(0,s.h)("div",{id:e,class:"label",style:a},(0,s.h)("span",null,l)):null}}const f=new n.Z("label-ui");class v extends s.Component{constructor(e){super(e),this.subscriptions=[],this.reusableVector=new h.Pa4,this.inFloorPlan=e=>e===o.BD.FLOORPLAN,this.onCameraUpdate=()=>{this.inFloorPlan(this.props.viewmode)&&this.updateLabelPositions()},this.onViewTransitionStart=()=>{this.setState({inModeTransition:!0})},this.onViewTransitionEnd=async e=>{this.inFloorPlan((0,o.ty)(e.toMode))&&(this.setState({inModeTransition:!1}),this.updateLabelPositions())},this.updateFloorState=()=>{this.setState({currentFloorId:this.floorsViewData.currentFloorId,topMostFloorId:this.floorsViewData.topFloorId})},this.updateLabelPositions=async()=>{const e={};for(const t of this.labelData.getCollection()){this.reusableVector.set(t.position.x,t.position.y,t.position.z);const i=await this.context.commandBinder.issueCommand(new c.b({worldPosition:this.reusableVector}));e[t.sid]=Object.assign({screenPosition:i},t)}this.setState({labelPositions:e})},this.clearVisibleFloor=()=>{this.setState({currentFloorId:null})},this.updateVisibleFloor=e=>{this.setState({currentFloorId:e.floorId})},this.setState({labelPositions:{},currentFloorId:null,topMostFloorId:null,inModeTransition:!1})}async componentDidMount(){const e=this.context.messageBus;try{this.floorsViewData=await this.context.market.waitForData(l.c);const e=this.floorsViewData.onChanged(this.updateFloorState);this.subscriptions.push(e),this.updateFloorState(),this.labelData=await this.context.market.waitForData(r.D)}catch(e){f.debug(e)}this.updateLabelPositions();const t=await this.context.market.waitForData(a.M_);this.subscriptions.push(t.onChanged(this.onCameraUpdate),e.subscribe(p.S,this.clearVisibleFloor),e.subscribe(m.P,this.updateVisibleFloor),e.subscribe(u.Z,this.onViewTransitionStart),e.subscribe(d.Z,this.onViewTransitionEnd)),this.subscriptions.forEach((e=>e.renew()))}componentWillUnmount(){this.subscriptions.forEach((e=>e.cancel()))}renderLabel(e){const{currentFloorId:t,topMostFloorId:i,labelPositions:n}=this.state,{floorId:o,screenPosition:r,text:a,visible:l,sid:c,rotation:h}=n[e];return(0,s.h)(g,{key:c,position:r,rotation:h,text:a,visible:(!t&&i===o||t===o)&&l,sid:c})}render(){const{inModeTransition:e,labelPositions:t}=this.state,{viewmode:i}=this.props;if(!this.inFloorPlan(i)||e)return null;const n=[];return Object.keys(t).forEach((e=>{n.push(this.renderLabel(e))})),(0,s.h)("div",{class:"overlay-layer labels-layer"},n)}}},63312:(e,t,i)=>{"use strict";i.d(t,{$:()=>Fe});var s=i(26605),n=i(94184),o=i(12856),r=i(71583),a=i(43084),l=i(54733),c=i(4292),h=i(47924),d=i(2116),u=i(20331),p=i(28615),m=i(25799);const g=new m.Z("embedly");class f{constructor(e){this.msg=e}}class v{constructor(e){this.msg=e}}class y{constructor(e){this.msg=e}}const b="Instagram",w="Flickr";class S{constructor(e){this.key=e,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.saveProvidersForScripts=[w,b],S.queue||(S.queue=new u.gO({retries:0}))}static clearCache(){S.embedCache={},S.imageCache={}}async getType(e){const t=await this.fetchFromCache(e);if(t)return t.type;try{const t=await this.getEmbedDetails(e);if(t.type===p.z.rich||t.type===p.z.video)return t.type}catch(e){if(401!==e.status_code&&404!==e.status_code&&501!==e.status_code&&!(e instanceof f))return p.z.error}try{return await this.getImageDetails(e),p.z.photo}catch(e){}return p.z.error}async fetchFromCache(e){const t=await this.getDisplayUrl(e),i=S.imageCache[t];if(i)return i;const s=await this.getOEmbedUrl(e);return S.embedCache[s]||null}async getMediaDetails(e,t){switch(e){case p.z.photo:return this.getImageDetails(t);case p.z.rich:case p.z.video:return this.getEmbedDetails(t)}throw Error("unsupported media type")}async getOEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}async getEmbedDetails(e){const t=await this.getOEmbedUrl(e);return S.embedCache[t]?Promise.resolve(S.embedCache[t]):this.loadEmbed(t)}async getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}async getImageDetails(e){const t=await this.getDisplayUrl(e);return S.imageCache[t]?Promise.resolve(S.imageCache[t]):this.loadImage(t)}loadEmbed(e){return S.queue.get(e,{responseType:"json"}).then((t=>this.validateAndCacheEmbed(e,t)))}loadImage(e){return new Promise(((t,i)=>S.queue.get(e,{responseType:"arraybuffer"}).then((t=>this.validateAndCacheImage(e,t))).then(t).catch(i)))}validateAndCacheEmbed(e,t){const i=!(t.html&&t.html.match(/<script/i))||this.saveProvidersForScripts.includes(t.provider_name);if(!(t.type!==p.z.photo||t.html&&i))throw new f('image can\'t be used as a "rich" type');if(!t||t.type===p.z.rich&&(!t.html||!i))throw new v("missing html or html contains Javascript");switch(t.type){case p.z.photo:t.html&&(t.type=p.z.rich);break;case p.z.rich:case p.z.video:break;case p.z.link:{const e="not supporting link types because of existing link functionality";throw g.debug(e),new y(e)}default:{const e=`Did the OEmbed format extend?! Unknown type: ${t.type}`;throw g.debug(e),new y(e)}}const s=(void 0===t.height||void 0===t.width)&&t.thumbnail_width&&t.thumbnail_height,n=s?t.thumbnail_width:t.width,o=s?t.thumbnail_height:t.height,r=t.provider_name,a={width:n,height:o,embedlyResponse:{html:t.html,src:t.url,provider:r},type:t.type};return S.embedCache[e]=a,a}validateAndCacheImage(e,t){return new Promise(((i,s)=>{t||s("Embedly: got an empty response when requesting image");const n=new Uint8Array(t),o=new Blob([n]),r=new Image;r.addEventListener("load",(t=>function(t){const s=t.target,n={width:s.naturalWidth,height:s.naturalHeight,embedlyResponse:{url:a,src:e},type:p.z.photo};S.imageCache[e]=n,i(n)}(t)));const a=URL.createObjectURL(o);r.src=a}))}}S.embedCache={},S.imageCache={};var T,E=i(6082),_=i(2752),x=i(35825),M=i(62367),P=i(74674),A=i(71313),O=i(17141),D=i(21265);!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(T||(T={}));var I=i(21746);const C=new m.Z("mattertag-media");let R=class extends s.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=()=>{this.props.mediaType===p.z.photo&&this.props.onClickImage&&this.props.onClickImage()},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=T.NOT_READY;const i=()=>{t=T.CUED,this.onPlayerLoaded(a)},s=()=>{t=T.PLAYING},n=()=>{t=T.PAUSED},o=()=>{};try{e.on("ready",i),e.on("play",s),e.on("pause",n),e.on("ended",o)}catch(e){C.debug(e)}const r=(0,D.tq)(),a={play:()=>{if(e&&t!==T.NOT_READY&&!r)try{e.play()}catch(e){C.error(e)}},pause:()=>{if(e&&t!==T.NOT_READY)try{e.pause()}catch(e){C.debug(e)}}}},this.setEmbedContentRef=e=>{e&&!this.iframe&&this.createEmbed(e)},this.setContainerRef=e=>{this.mediaContainer=e,this.updateMaxDims()},this.updateMaxDims=()=>{if(this.mediaContainer&&this.props.mediaAspectRatio&&this.props.mediaType===p.z.video){const e=this.mediaContainer.getBoundingClientRect();this.setState({maxWidth:e.width,maxHeight:e.height})}},this.mediaStyles=()=>{const{width:e,height:t,mediaPayload:i,mediaType:s,mediaAspectRatio:n}=this.props,{maxWidth:o,maxHeight:r}=this.state,a={};if(i)switch(s){case p.z.photo:a.backgroundImage=i.url?`url('${i.url}')`:"none";case p.z.rich:void 0!==e&&(a.width=`${e}px`),void 0!==t&&(a.height=`${t}px`,i.provider===b?a.height=`${t+54}px`:a.height=`${t}px`);break;case p.z.video:if(void 0!==e&&void 0!==t){const i=(0,I.yB)(e,t);a.width=`${e}px`,a.height=`${i}px`}else if(o&&r&&void 0!==n){const e=Math.min(r,(0,I.yB)(o,o/n)),t=e*n;a.width=`${t}px`,a.height=`${e}px`}}return a},this.state={maxWidth:0,maxHeight:0}}componentDidMount(){this.props.mediaAspectRatio&&this.props.mediaType===p.z.video&&(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}componentWillUnmount(){this.props.mediaAspectRatio&&this.props.mediaType===p.z.video&&window.removeEventListener("resize",this.updateMaxDims)}componentWillReceiveProps(e){e.mediaPayload!==this.props.mediaPayload&&this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.playerControls&&this.props.closing!==e.closing&&(e.closing?this.playerControls.pause():this.playerControls.play())}createEmbed(e){const{mediaType:t,mediaPayload:i,width:s,height:n}=this.props,{html:o,provider:r,src:a}=i,l=document.createElement("div");l.innerHTML=o;let c=l.firstChild;if("iframe"!==c.tagName.toLowerCase()){if(c=document.createElement("iframe"),!("srcdoc"in c))return C.warn(`Browser does not support srcdoc, refusing to embed ${o}`),void(this.iframe=null);let e,t;void 0!==s&&(c.width=s.toString()),void 0!==n&&(c.height=n.toString()),c.setAttribute("allow","encrypted-media; autoplay; fullscreen"),c.classList.add("tag-iframe-sandbox","loading"),c.onload=()=>c.classList.remove("loading"),e=r===w&&void 0!==a?`<img src=${a} />`:o,t=r===b?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const i=t.replace(/\s+/g," ");c.srcdoc=`<!doctype html>${i}${e}`}else{const e=c.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(t===p.z.video&&c.src)try{const e=new O.Player(c);c.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){C.error(e)}this.iframe=c,e.appendChild(c)}render(){const{mediaPayload:e,mediaType:t}=this.props;if(!e)return null;const i=n({"tag-image":t===p.z.photo,"tag-embed":t===p.z.rich,"tag-video":t===p.z.video}),o=e&&e.html?(0,s.h)("div",{class:"tag-embed-content",ref:this.setEmbedContentRef}):null;return(0,s.h)("div",{ref:this.setContainerRef,class:"tag-media-content",onClick:this.handleClick},(0,s.h)("div",{className:i,style:this.mediaStyles()},o))}};R=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],R);const L=R;var N=i(31399),k=i(57501),F=i(98867),B=i(93273);class U extends s.Component{constructor(e){super(e),this.getInputDiv=()=>this.inputDiv,this.hasTextSelected=()=>this.range&&this.range.startOffset!==this.range.endOffset,this.onSelectionChange=()=>{const e=this.getCurrentSelection();e&&(this.range=e.cloneRange())},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.prepareLinkSelection=()=>{const e=this.getAnchorFromSelection();let t=null;const i=window.getSelection();return i&&(e||this.range?(this.addFauxHighlight(),e||(t=this.range?this.range.toString():i.toString())):(this.inputDiv.focus(),i.selectAllChildren(this.inputDiv),i.collapseToEnd(),this.range=i.getRangeAt(0),t=this.range.toString())),e||t||""},this.onMouseDown=e=>{e.stopPropagation(),this.removeFauxHighlight(),this.range=null},this.onKeyPress=e=>{const t=e.which||e.keyCode;if(e.stopPropagation(),t===x.R.ESCAPE)return this.props.onNavigationKey(e);if(t===x.R.RETURN||t===x.R.TAB)return e.shiftKey||(e.preventDefault(),this.finalizeInput()),this.props.onNavigationKey(e);if("keydown"===e.type)return;const i=this.inputDiv.innerText;this.props.maxLength&&i&&i.length>this.props.maxLength&&e.preventDefault()},this.onInput=()=>{this.props.onInput(this.inputDiv.innerText)},this.onPaste=e=>{const t=(e.clipboardData||window.clipboardData).getData("text/plain");let i=t.length;const s=this.inputDiv.innerText,n=window.getSelection();if(n&&this.props.maxLength&&s&&s.length+i>this.props.maxLength){const e=this.props.maxLength-this.inputDiv.innerText.length+n.toString().length;i=Math.min(e,i)}document.execCommand("insertText",!1,t.slice(0,i)),e.preventDefault()},this.onFocus=e=>{this.context.messageBus.broadcast(new B.S(this.inputDiv,!0)),this.props.onFocus&&this.props.onFocus()},this.onBlur=()=>{this.context.messageBus.broadcast(new B.S(this.inputDiv,!1)),this.props.onBlur&&this.props.onBlur(),this.finalizeInput()},this.setInput=e=>{this.inputDiv=e};const t=new k.gm((()=>({})),(e=>document.addEventListener("selectionchange",e)),(e=>document.removeEventListener("selectionchange",e)));this.selectionSubscription=t.createSubscription(this.onSelectionChange)}componentDidMount(){const{description:e,onLinkClick:t}=this.props,i=this.getInputDiv();A.v.deserialize(e,!1,!1,void 0,t).forEach((e=>{i.appendChild(e)})),this.selectionSubscription.renew()}componentWillUnmount(){this.selectionSubscription.cancel(),this.inputDiv&&this.inputDiv.blur()}shouldComponentUpdate(){return!1}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.inputDiv===t.commonAncestorContainer||this.inputDiv.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}linkify(e,t){this.execCommand("backColor","transparent"),this.execCommand("createLink",t);const i=this.getAnchorFromSelection();i&&(i.text=e,this.addLinkProperties(i))}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!(0,F.j)(i)&&this.execCommand("insertText",i))}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}addLinkProperties(e){e.classList.add(A.o.LINK),e.onclick=this.props.onLinkClick}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.inputDiv)return null;t=t.parentNode}return t||null}finalizeInput(){this.props.onFinalizeInput(),this.inputDiv.blur()}render(){return(0,s.h)("div",{ref:this.setInput,class:"inputDiv",placeholder:this.props.placeholder,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyPress,onKeyPress:this.onKeyPress,onPaste:this.onPaste,contentEditable:!0,onInput:this.onInput,onFocus:this.onFocus,onBlur:this.onBlur})}}var H=i(42190),G=i(29359);const{MATTERTAGS:V}=G.Z.WORKSHOP;let z=class extends s.Component{constructor(e){super(e),this.linkElement=null,this.onLabelEdit=e=>{this.handleTextChange("label",e)},this.onLabelKeyPress=e=>{if(e.keyCode===x.R.ESCAPE)return this.props.onNavigationKey(e);if(e.stopPropagation(),e.keyCode===x.R.TAB){const e=this.editableDescription.getInputDiv();e&&e.focus()}return!1},this.onDescriptionInput=e=>{const t=e.length;this.props.onDescriptionInput(0===t),this.setState({descriptionLength:t})},this.onDescriptionEdited=()=>{const e=this.editableDescription.getInputDiv();if(e){const t=A.v.serialize(e);this.handleTextChange("description",t)}},this.onLabelFocus=()=>{this.closePopover()},this.onDescriptionFocus=()=>{this.setState({editingDescription:!0})},this.onDescriptionBlur=()=>{this.setState({editingDescription:!1})},this.closePopover=()=>{this.setState({linkUrl:"",linkText:""}),this.linkElement=null,this.props.onClosePopover()},this.linkClicked=e=>{if(e.preventDefault(),this.props.linkEditorOpen)this.closePopover();else{e.stopPropagation(),this.linkElement=e.target;const{href:t,text:i}=this.linkElement;this.setState({linkUrl:t,linkText:i}),this.props.onClickLink()}},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{this.linkElement?""!==t?(this.linkElement.href=t,this.linkElement.text=e):this.editableDescription.unlink(this.linkElement):this.editableDescription.linkify(e,t),this.closePopover(),this.onDescriptionEdited()},this.state={editingDescription:!1,descriptionLength:0,linkUrl:"",linkText:""}}componentWillMount(){this.updateDescriptionLength(this.props.description)}componentWillReceiveProps(e){e.description!==this.props.description&&this.updateDescriptionLength(e.description)}prepareNewLinkSelection(){const e=this.editableDescription.prepareLinkSelection();let t,i;return"string"==typeof e?(this.linkElement=null,t="",i=e):(this.linkElement=e,t=e.href,i=e.text),this.setState({linkUrl:t,linkText:i}),""!==i&&""===t}updateDescriptionLength(e){let t=0;const i=A.v.parse(e,!1);for(const e of i)e.blockType!==P.C.LINK&&e.blockType!==P.C.TEXT||(t+=e.text.length);this.setState({descriptionLength:t})}handleTextChange(e,t){this.props.modifyMattertag(this.props.id,{[e]:t}).then(this.props.onEdited)}render(){const{locale:e}=this.context,{linkUrl:t,linkText:i,editingDescription:o,descriptionLength:r}=this.state,{label:a,linkEditorOpen:l,onNavigationKey:c,description:h}=this.props,d=`${r}/1000`,u=e.t(V.TITLE_PLACEHOLDER),p=e.t(V.DESCRIPTION_PLACEHOLDER);return(0,s.h)("div",{class:"editable-text-content"},(0,s.h)("div",{class:"mattertag-label-editor"},(0,s.h)(N.Z,{text:a,defaultText:"",placeholder:u,onEdited:this.onLabelEdit,onInput:this.onLabelEdit,onKeyPress:this.onLabelKeyPress,maxLength:60,closeOnFocusOut:!0,textarea:!0,fractionalCounter:!0,onStartEditing:this.onLabelFocus})),(0,s.h)("div",{class:"editable-tag-description"},(0,s.h)("div",{class:n("modifiable-text fractional-counter",{editing:o||l,empty:0===r}),"data-fractional-counter":d},(0,s.h)(U,{ref:e=>this.editableDescription=e,maxLength:1e3,placeholder:p,description:h,onInput:this.onDescriptionInput,onFinalizeInput:this.onDescriptionEdited,onNavigationKey:c,onLinkClick:this.linkClicked,onFocus:this.onDescriptionFocus,onBlur:this.onDescriptionBlur}))),(0,s.h)(H.s,{linkUrl:t,linkText:i,onCancel:this.closePopover,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}};z=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.A],z);var j=i(80429),W=i(42733),Z=i(79830),q=i(84245),K=i(90709),Y=i(62431);const{MATTERTAGS:$}=G.Z.WORKSHOP;class Q extends s.Component{constructor(e){super(e),this.setStemValue=(e,t=!0)=>{const i=t?(0,K._F)(e):e;i!==this.props.stemHeight&&this.props.modifyMattertag(this.props.sid,{stemHeight:i}).then((()=>{this.props.onEdited()}))},this.onClickReset=()=>{this.slider&&(this.setStemValue(this.state.originalStemHeight,!1),this.slider.setValue((0,K.zy)(this.state.originalStemHeight)))},this.onToggleStemVisibility=()=>{this.props.modifyMattertag(this.props.sid,{stemVisible:!this.props.stemVisible}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()},this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(Y.gx.Units,Y.Mc.USFractional)})},this.formatStemHeight=e=>this.state.units===Y.Mc.USFractional?(0,q.KQ)(e):Math.round(100*(0,K._F)(e))/100+"m",this.state={originalStemHeight:e.stemHeight,units:Y.Mc.USFractional}}componentWillMount(){this.updateUnits()}componentDidMount(){this.slider.setValue((0,K.zy)(this.props.stemHeight)),this.context.settings.onPropertyChanged(Y.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(Y.gx.Units,this.updateUnits)}render(){const{locale:e}=this.context,{stemVisible:t,stemHeight:i}=this.props,{originalStemHeight:o}=this.state,r=o!==i,a=e.t($.STEM_SLIDER_RESET_CTA),l=e.t($.SHOW_STEM_LABEL);return(0,s.h)("div",{class:"editable-popover stem-popover",onClick:this.stopPropagation},(0,s.h)(Z.S,{ref:e=>this.slider=e,discrete:!1,min:0,max:9,initialValue:(0,K.zy)(i),onInput:this.setStemValue,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:Z.h.DOWN}),(0,s.h)("div",{class:n("link-btn","popover-btn","stem-slider-reset",{disabled:!r}),onClick:this.onClickReset},a),(0,s.h)("hr",null),(0,s.h)("div",{class:"stem-checkbox",onClick:this.onToggleStemVisibility},(0,s.h)("div",{class:n("checkbox icon-checkmark",{checked:t})}),(0,s.h)("div",{class:"checkbox-text"},l)))}}var X=i(1402);const J=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];class ee extends s.Component{constructor(e){super(e),this.handleColorPicked=e=>{this.props.modifyMattertag(this.props.sid,{color:e}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{color:e}=this.props;return(0,s.h)("div",{class:"editable-popover color-editor",onClick:this.stopPropagation},(0,s.h)(X.z,{colors:J,defaultColor:e,onColorPicked:this.handleColorPicked}))}}var te=i(47133),ie=i(14071);const{MATTERTAGS:se}=G.Z.WORKSHOP;var ne;!function(e){e[e.NONE=0]="NONE",e[e.INVALID_URL_SYNTAX=1]="INVALID_URL_SYNTAX",e[e.LOADING=2]="LOADING",e[e.LOADED=3]="LOADED",e[e.ERROR=4]="ERROR"}(ne||(ne={}));class oe extends s.Component{constructor(e){super(e),this.onInput=e=>{const t=(0,F.j)(e)?ne.NONE:ne.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{e.target.classList.contains("disabled")||this.onChangeMedia(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onChangeMedia=async e=>{const{sid:t,mediaSrc:i,onEdited:s}=this.props;if(e!==i){const i=await this.loadMedia(e);i!==p.z.error?(await this.props.modifyMattertag(t,{mediaSrc:e,mediaType:i}),this.setState({validationPhase:ne.LOADED}),s()):this.setState({validationPhase:ne.ERROR})}else this.props.onCancel()},this.loadMedia=async e=>{let t=p.z.none;return this.setState({validationPhase:ne.NONE}),e&&(this.setState({validationPhase:ne.LOADING}),t=await this.props.embedlyValidator.getType(e)),t},this.state={currentUrl:e.mediaSrc,validationPhase:this.getInitialValidationPhase()}}getInitialValidationPhase(){return this.props.mediaType===p.z.error?ne.ERROR:this.props.mediaSrc?ne.LOADED:ne.NONE}componentWillReceiveProps(e){this.state.currentUrl!==e.mediaSrc&&this.setState({currentUrl:e.mediaSrc})}render(){const{locale:e}=this.context,{mediaSrc:t,onCancel:i}=this.props,n=e.t(se.MEDIA_LINK_LABEL),o=e.t(se.MEDIA_LINK_SUPPORTED_FORMATS_LINK);return(0,s.h)("div",{class:"annotation-popup open media-editor",onClick:this.stopPropagation},(0,s.h)("div",{class:"popover-header"},(0,s.h)("div",{class:"popover-label"},n,(0,s.h)("a",{class:"link",target:"_blank",href:oe.supportPage},o)),(0,s.h)(ie.P,{buttonStyle:ie.A.LIGHT,onClose:i})),(0,s.h)(te.Z,{text:t,type:"url",placeholder:"https://",onDone:this.onChangeMedia,onInput:this.onInput}),this.renderPopoverFooter())}renderPopoverFooter(){const{locale:e}=this.context,{mediaSrc:t}=this.props,{validationPhase:i,currentUrl:n}=this.state,o=i===ne.ERROR||i===ne.LOADING||i===ne.INVALID_URL_SYNTAX&&""!==n||n===t&&""===n?W.BN.DISABLED:W.BN.ENABLED,r=e.t(se.MEDIA_LINK_APPLY_CTA);return(0,s.h)("div",{class:"popover-footer"},this.renderValidationMessage(),(0,s.h)(W.zx,{appendClass:{"button-inline":!0},buttonStyle:W.ZJ.CLEAR,buttonSize:W.qE.SMALL,buttonState:o,onClick:this.onApply},r))}renderValidationMessage(){const{locale:e}=this.context;switch(this.state.validationPhase){case ne.ERROR:return(0,s.h)("div",{class:"popover-message popover-message-error"},e.t(se.MEDIA_LINK_ERROR_MESSAGE),(0,s.h)("a",{class:"link",target:"_blank",href:oe.supportPage},e.t(se.MEDIA_LINK_HELP_LINK)));case ne.LOADING:return(0,s.h)("div",{class:"popover-message"},e.t(se.MEDIA_LINK_LOADING_MESSAGE));case ne.INVALID_URL_SYNTAX:if(""!==this.state.currentUrl)return(0,s.h)("div",{class:"popover-message popover-message-error"},e.t(se.MEDIA_LINK_INVALID_URL_MESSAGE))}return(0,s.h)("div",{class:"popover-message"})}}oe.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post";var re=i(26265);const{MATTERTAGS:ae}=G.Z.WORKSHOP;var le;!function(e){e.COLOR="color",e.STEM="stem",e.MEDIA="media",e.LINK="text-link"}(le||(le={}));let ce=class extends s.Component{constructor(e){super(e),this.getColorStyle=()=>{const e=this.props.getSavedData().color;if(e)return"background-color: "+e},this.toggleVisibility=()=>{const{id:e,manager:t}=this.props;this.closePopover();const i={visible:!this.state.currentValues.visible};t.modifyMattertag(e,i).then(this.onEdited)},this.onEdited=()=>{const e=this.props.getSavedData();e&&this.setState({currentValues:e,tagEmpty:this.props.manager.isTagEmpty(this.props.id)})},this.onMediaEdited=()=>{this.onEdited(),this.closePopover()},this.onMediaCancel=()=>{this.closePopover()},this.cancelEdits=()=>{this.props.manager.revertChanges()},this.doneEditing=()=>{const{manager:e,id:t}=this.props;e.saveMattertag(t)},this.onAddLinkClicked=e=>{if(e.stopPropagation(),this.state.popover===le.LINK)this.closePopover();else if(this.state.linkCount<5){const e=this.billboardText.prepareNewLinkSelection();this.openLinkEditor(e)}},this.onClickLink=()=>{this.openLinkEditor(!1)},this.onDescriptionInput=e=>{const t=this.props.getSavedData(),i=(0,M.Yv)(t.label)&&(0,M.Yv)(t.mediaSrc)&&e;this.updateLinkCount(this.props.description),this.setState({tagEmpty:i})},this.onNavigationKey=e=>{e.keyCode===x.R.ESCAPE&&this.cancelEdits()},this.billboardClick=e=>{e.stopPropagation(),this.closePopover()},this.closePopover=()=>{const{popover:e}=this.state;null!==e&&this.setPopover(e,!1)},this.clickOnBackground=e=>{this.closePopover(),e.stopPropagation()},this.setBillboardTextRef=e=>{this.billboardText=e};const t=e.getSavedData();this.state={popover:null,linkCount:0,currentValues:Object.assign({},t),tagEmpty:e.manager.isTagEmpty(e.id)},this.clickColor=this.clickMenuIcon.bind(this,le.COLOR),this.clickStem=this.clickMenuIcon.bind(this,le.STEM),this.clickMedia=this.clickMenuIcon.bind(this,le.MEDIA)}componentDidMount(){this.context.analytics.track("workshop_gui",{gui_action:"mattertag_editor_opened"}),this.updateLinkCount(this.props.description)}componentDidUpdate(e,t){const i=this.props.manager.dataMap.mattertagsViewData.toolState;t.tagEmpty&&!this.state.tagEmpty&&i===a.rI.PLACED&&this.props.manager.dataMap.mattertagsViewData.setToolState(a.rI.EDITING),this.updateLinkCount(this.props.description)}setPopover(e,t){const i=this.state.popover,s=t?e:null;i!==s&&i===le.LINK&&this.context.messageBus.broadcast(new _.Z),this.setState({popover:s})}openLinkEditor(e){this.setPopover(le.LINK,!0),this.context.messageBus.broadcast(new _.g(e))}updateLinkCount(e){let t=0;const i=A.v.parse(e,!1);for(const e of i)e.blockType===P.C.LINK&&t++;this.setState({linkCount:t})}clickMenuIcon(e,t){t.stopPropagation(),this.setPopover(e,this.state.popover!==e)}render(){const{locale:e}=this.context,{tagEmpty:t,popover:i}=this.state,{fullSized:o}=this.props,r=null!==i,a=i===le.LINK||i===le.MEDIA,l=e.t(ae.EDIT_BILLBOARD_CANCEL_CTA),c=e.t(ae.EDIT_BILLBOARD_DONE_CTA);return(0,s.h)("div",{class:n("editable-billboard-body",{"full-sized":o,"popover-open":r,"url-popover-open":a}),onClick:this.clickOnBackground},(0,s.h)("div",{class:"editable-billboard-content",onClick:this.billboardClick},this.renderTextContent(),this.renderMattertagMedia(),this.renderActivePopover()),(0,s.h)("div",{class:"billboard-footer",onClick:this.billboardClick},this.renderMenuItems(),(0,s.h)("div",{class:"billboard-cta"},(0,s.h)(W.zx,{buttonStyle:W.ZJ.CLEAR,buttonSize:W.qE.SMALL,appendClass:{"button-inline":!0},onClick:this.cancelEdits},l),(0,s.h)(W.zx,{appendClass:{"button-inline":!0},buttonStyle:W.ZJ.CLEAR,buttonSize:W.qE.SMALL,buttonState:t?W.BN.DISABLED:W.BN.ENABLED,onClick:this.doneEditing},c))))}renderActivePopover(){const{id:e,manager:t}=this.props,{popover:i,currentValues:n}=this.state,{stemVisible:o,stemHeight:r,color:a,mediaSrc:l,mediaType:c}=n;switch(i){case le.STEM:return(0,s.h)(Q,{sid:e,stemVisible:o,stemHeight:r,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case le.COLOR:return(0,s.h)(ee,{sid:e,color:a,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case le.MEDIA:return(0,s.h)(oe,{sid:e,mediaSrc:l,mediaType:c,embedlyValidator:this.props.embedlyValidator,onEdited:this.onMediaEdited,onCancel:this.onMediaCancel,modifyMattertag:t.modifyMattertag});default:return null}}renderMenuItems(){const{locale:e}=this.context,{manager:t,id:i,fullSized:n}=this.props,{popover:o,currentValues:r,linkCount:a}=this.state,{visible:l}=r,c=t.isNewTag(i),h=o===le.COLOR,d=o===le.STEM,u=o===le.MEDIA,p=o===le.LINK,m=a<5,g=e.t(m?ae.LINK_TOOLTIP_MESSAGE:ae.LINK_DISABLED_TOOLTIP_MESSAGE),f=n?re.lZ.UP:re.lZ.DOWN,v=p?W.BN.ACTIVE:m?W.BN.ENABLED:W.BN.DIMMED;return(0,s.h)("div",{class:"billboard-menu"},(0,s.h)(j.h,{iconClass:"icon-link",appendClass:{"billboard-menu-item":!0,"add-link":!0},buttonState:v,buttonStyle:j.D.CLEAR,onClick:this.onAddLinkClicked,tooltipMsg:p?void 0:g,tooltipPosition:f}),(0,s.h)(j.h,{appendClass:{"billboard-menu-item":!0,color:!0},buttonStyle:j.D.CLEAR,buttonState:h?W.BN.ACTIVE:W.BN.ENABLED,onClick:this.clickColor,tooltipMsg:h?void 0:e.t(ae.COLOR_TOOLTIP_MESSAGE),tooltipPosition:f},(0,s.h)("span",{class:"color-dot",style:this.getColorStyle()})),(0,s.h)(j.h,{iconClass:"icon-stem-height",appendClass:{"billboard-menu-item":!0,stem:!0},buttonStyle:j.D.CLEAR,buttonState:d?W.BN.ACTIVE:W.BN.ENABLED,onClick:this.clickStem,tooltipMsg:d?void 0:e.t(ae.STEM_TOOLTIP_MESSAGE),tooltipPosition:f}),(0,s.h)(j.h,{iconClass:"icon-media-mix",appendClass:{"billboard-menu-item":!0,media:!0},buttonStyle:j.D.CLEAR,buttonState:u?W.BN.ACTIVE:W.BN.ENABLED,onClick:this.clickMedia,tooltipMsg:u?void 0:e.t(ae.MEDIA_TOOLTIP_MESSAGE),tooltipPosition:f}),!c&&(0,s.h)(j.h,{iconClass:l?"icon-eye-hide":"icon-eye-show",appendClass:{"billboard-menu-item":!0},buttonStyle:j.D.CLEAR,onClick:this.toggleVisibility,tooltipMsg:e.t(l?ae.HIDE_TOOLTIP_MESSAGE:ae.SHOW_TOOLTIP_MESSAGE),tooltipPosition:f}))}renderTextContent(){const{popover:e}=this.state,{id:t,label:i,description:n,manager:o}=this.props,r=e===le.LINK;return(0,s.h)(z,{id:t,ref:this.setBillboardTextRef,label:i,description:n,linkEditorOpen:r,onClickLink:this.onClickLink,onClosePopover:this.closePopover,onDescriptionInput:this.onDescriptionInput,onNavigationKey:this.onNavigationKey,onEdited:this.onEdited,modifyMattertag:o.modifyMattertag})}renderMattertagMedia(){const{id:e,mediaType:t,closing:i,media:{hasMedia:n,mediaPayload:o},mediaAspectRatio:r}=this.props;return n?o?(0,s.h)(L,{key:e,mediaPayload:o,mediaType:t,mediaAspectRatio:r,closing:i}):(0,s.h)("div",{class:"loadingSpinner"},(0,s.h)("div",{class:"gui-spinner-icon"})):null}};ce=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],ce);var he=i(96630),de=i(45296),ue=i(39936);const pe=new m.Z("mattertag-description");let me=class extends s.Component{constructor(e){super(e),this.formatLink=(e,t)=>ge(e,t,!1),this.linkClicked=e=>t=>{if(t.preventDefault(),this.props.onLinkClick(e),void 0!==e.link)switch(e.link.type){case de.U.NAVIGATION:this.props.navigationTagClicked(e);break;case de.U.MODEL:window.location.replace(e.link.url);break;case de.U.EXT_LINK:const t=1===this.embeddedlinks;t?window.requestAnimationFrame((()=>{try{const t=window.open(e.link.url,"mattertagEmb");t&&t.focus()}catch(t){pe.debug(`Could not load the link within an iFrame! Error: ${t}`),window.open(e.link.url)}})):window.open(e.link.url),this.context.messageBus.broadcast(new c.Ik(e.link.url,t))}}}async componentDidMount(){this.settings=await this.context.market.waitForData(ue.e),this.embeddedlinks=this.settings.tryGetProperty("emb",0)}render(){const{description:e,parsedDescription:t}=this.props;let i=e;return t&&t.length>0&&(i=fe(t,this.formatLink,this.linkClicked)),i?(0,s.h)("div",{className:"tag-description"},i):null}};me=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],me);const ge=(e,t,i)=>{if(!e.link)return null;const n=e.link,o=n.type===de.U.NAVIGATION?"Link to position within this model":"Link to external web site";return(0,s.h)("a",{className:"link-url",contentEditable:i,href:n.url,onClick:t(e)},n.label,(0,s.h)("i",{class:"icon-ext-link",title:o}))},fe=(e,t,i)=>e.map((e=>{switch(e.type){case p.z.link:if(e.link)return t(e,i);case p.z.text:return(e.text||"").replace("&zwnj;","")}return null}));var ve=i(58091),ye=i(95843);const be=E.l7+3*E.qS,we=6*E.XJ+be,Se=3*E.XJ+E.qS;let Te=class extends s.Component{constructor(e){super(e),this.state={height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:ye.Ij.None},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})}}componentWillReceiveProps(e){e.tagWidth!==this.props.tagWidth&&this.setState({height:null,scrollable:!0,determiningScrollability:!0})}componentDidMount(){this.determineScrollability()}componentDidUpdate(){this.state.determiningScrollability&&this.determineScrollability()}determineScrollability(){const e=this.textContainer&&this.textContainer.querySelector(".tag-description");let t={determiningScrollability:!1};if(this.props.description&&e){const i=this.props.mediaTag?Se:we;if(e.scrollHeight>i+E.J6){const e=this.textContainer&&this.textContainer.querySelector(".tag-label"),s=this.props.label?i+e.scrollHeight-E.qS:i;t=Object.assign(Object.assign({},t),{height:s,scrollable:!0,scrollClass:ye.Ij.Beginning})}else t=Object.assign(Object.assign({},t),{height:null,scrollable:!1,scrollClass:ye.Ij.None})}this.setState(t)}render(){const{label:e,description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r}=this.props;if(e||t||i){const a=n({"tag-text-content":!0,noScroll:!this.state.height||!this.state.scrollable,[this.state.scrollClass]:!0});return(0,s.h)("div",{class:a,style:{height:this.state.scrollable&&this.state.height||"auto"},ref:e=>{this.textContainer=e}},(0,s.h)(ve.Z,{name:"mattertag-text-content",forceHidden:!1,waitToUpdate:this.state.determiningScrollability,singleScrollDirection:ye.Nm.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},e&&(0,s.h)("div",{class:"tag-label",onClick:this.onBoundClick},(0,s.h)("span",null,e)),(0,s.h)(me,{description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r})))}return null}};Te=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],Te);const Ee=Te;var _e=i(252);let xe=class extends s.Component{constructor(e){super(e),this.clickBillboard=()=>{this.props.onClickBillboard()},this.onClickImage=()=>{this.props.allowTagOverlay?this.props.onOpenOverlay():this.props.onClickBillboard()}}render(){const{media:e,style:t,selected:i,allowTagOverlay:o,label:r,description:a,parsedDescription:l}=this.props;return(0,s.h)("div",{class:n("billboard-body",{expandable:o}),onClick:this.clickBillboard},(0,s.h)("div",{className:"billboard-content",style:t.bodyStyle},(0,s.h)(Ee,{label:r,description:a,parsedDescription:l,tagWidth:t.width,imgHeight:t.height,mediaTag:e.hasMedia,onLinkClick:this.props.onLinkClick,navigationTagClicked:this.props.navigationTagClicked}),this.renderMattertagMedia(),this.renderCustomWidget()),!i&&(0,s.h)(he.s,{sendEvents:[he.s.SendEvent.BUTTON],className:"hover-arrow"}))}renderMattertagMedia(){const{id:e,allowTagOverlay:t,mediaType:i,style:{width:n,height:o,closing:r},media:{hasMedia:a,mediaPayload:l}}=this.props;return a?l?(0,s.h)(L,{key:e,mediaPayload:l,mediaType:i,width:n,height:o,onClickImage:t?this.onClickImage:void 0,closing:r}):(0,s.h)("div",{class:"loadingSpinner"},(0,s.h)("div",{class:"gui-spinner-icon"})):null}renderCustomWidget(){if(this.props.customWidget)return(0,s.h)(_e.l,{widget:this.props.customWidget})}};xe=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.A],xe);const Me=E.J6+E.l7+E.qS;let Pe=class extends s.Component{constructor(e){super(e),this.toggleCollapseText=()=>{this.setState((e=>({collapsed:!e.collapsed})))},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})},this.updateScrollAndCollapse=()=>{const e=this.textContainer?this.textContainer.scrollHeight:0,t=this.textContainer&&this.textContainer.querySelector(".tag-description");let i={determiningScrollability:!1};if(e){const s=Math.max(e-Me-this.state.overlayHeight,0),n=s>0,o=e-s,r=t&&t.scrollHeight-s,a=n?ye.Ij.Beginning:ye.Ij.None,l=t&&e>Me;i=Object.assign(Object.assign({},i),{height:o,scrollable:n,descriptionHeight:r,scrollClass:a,collapsible:l})}this.setState(i)},this.updateOverlayDimensions=()=>{const{label:e,description:t,maxWidth:i,maxHeight:s,mediaAspectRatio:n}=this.props,o=e||t?Me:0,r=i-2*E.J6,a=s-2*E.J6-o,l=n<r/a;this.setState({overlayWidth:l?a*n:r,overlayHeight:l?a:r/n})},this.stopPropagation=e=>{e.stopPropagation()},this.state={overlayWidth:0,overlayHeight:0,collapsible:!!(e.description&&e.description.length>0),collapsed:!1,height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:ye.Ij.None}}componentDidMount(){this.updateOverlayDimensions(),this.updateScrollAndCollapse()}componentDidUpdate(e,t){const i=e.mediaAspectRatio!==this.props.mediaAspectRatio,s=e.maxWidth!==this.props.maxWidth,n=e.maxHeight!==this.props.maxHeight;(i||s||n)&&(this.setState({determiningScrollability:!0,scrollable:!1,scrollClass:ye.Ij.None,height:0}),window.requestAnimationFrame((()=>{this.updateOverlayDimensions(),this.updateScrollAndCollapse()})))}render(){const{mediaPayload:e,mediaType:t,closing:i}=this.props,{overlayWidth:o,overlayHeight:r,collapsible:a}=this.state;return(0,s.h)("div",{class:"billboard-body",onClick:this.stopPropagation},(0,s.h)("div",{className:n("billboard-content",{collapsible:a})},this.renderOverlayText(),(0,s.h)(L,{mediaPayload:e,mediaType:t,width:o,height:r,closing:i})))}renderOverlayText(){const{label:e,description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r,closeImageOverlay:a}=this.props,{collapsible:l,collapsed:c,descriptionHeight:h,scrollable:d,height:u,determiningScrollability:p,scrollClass:m}=this.state,g=p||c?void 0:{maxHeight:u+"px"},f={};return t&&u&&d&&(f.height=h+"px",f.overflow="hidden"),(0,s.h)("div",{class:n("tag-text-content",{collapsed:c,noScroll:!u||!d}),style:g,ref:e=>{this.textContainer=e}},e&&(0,s.h)("div",{class:"tag-label",onClick:this.toggleCollapseText},(0,s.h)("div",{class:"labelText"},e)),t&&(0,s.h)("div",{style:f,class:n(m,"wrappedDesc")},(0,s.h)(ve.Z,{name:"mattertag-overlay-text",forceHidden:!1,waitToUpdate:p,singleScrollDirection:ye.Nm.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},(0,s.h)("div",null,(0,s.h)(me,{description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r})))),(0,s.h)("div",{class:"buttons"},l&&(0,s.h)(j.h,{appendClass:{"tag-button":!0,"tag-collapse-button":!0},iconClass:"icon-dpad-down",onClick:this.toggleCollapseText}),(0,s.h)(j.h,{appendClass:{"tag-button":!0},iconClass:"icon-close",onClick:a})))}};Pe=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],Pe);const Ae=Pe;var Oe,De=i(91172);const Ie=new m.Z("billboard");var Ce;!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED",e[e.ENABLED=4]="ENABLED"}(Ce||(Ce={}));let Re=Oe=class extends s.Component{constructor(e,t){super(e),this.linkCount=0,this.linksClicked=[],this.linkEditorOpened=()=>this.setState({expanded:!0}),this.linkEditorClosed=()=>this.setState({expanded:!1}),this.getSavedData=()=>{const{label:e,description:t,mediaSrc:i,mediaType:s,stemVisible:n,enabled:o}=this.props.tag,{stemHeight:r,color:a}=this.props.view;return{visible:o,color:a,label:e,description:t,stemHeight:r,mediaSrc:i,mediaType:s,stemVisible:n}},this.updateBillboardSize=()=>{const{mediaWidth:e,mediaHeight:t}=this.state,{tag:i}=this.props;if(this.adjustSizing(),i.mediaType===p.z.photo||i.mediaType===p.z.rich||i.mediaType===p.z.video){const s=this.getDimensionsForMedia(i.mediaType,e,t);this.setState(Object.assign({},s))}},this.closeImageOverlay=()=>{const{overlay:e,toggleImageOverlay:t,tag:i}=this.props;e&&t(i.sid,!1)},this.onOpenOverlay=()=>{const{toggleImageOverlay:e,allowTagOverlay:t,tag:i}=this.props;t&&e(i.sid,!0)},this.onBillboardClicked=()=>{const{manager:e,toolOpen:t,tag:i,selected:s}=this.props;t&&e&&!s&&e.selectMattertag(i.sid)},this.setBillboardRef=e=>{this.billboardRef=e},this.updateTagDirection=()=>{const{direction:e}=this.state,{getTagContainer:t,tag:i}=this.props,{navigating:s,navigatingPosition:n,position:o,onTagDirectionChanged:r}=this.props.view,a=t();if(!a)return;const[l,c]=[a.offsetWidth,a.offsetHeight];let h;h=s&&n?Oe.getTagDirection(n.x,n.y,l,c):o?Oe.getTagDirection(o.x,o.y,l,c):Oe.getTagDirection(0,0,l,c),h!==e&&(r(i.sid,h),this.setState({direction:h}))},this.onLinkClick=e=>{if(void 0===e.link)return;-1===this.linksClicked.indexOf(e.link)&&this.linksClicked.push(e.link);const t=e.link.type;this.linkCount++,this.context.analytics.track("click_mattertag_link",{link_type:t,link_count:this.linkCount,links_clicked:this.linksClicked.length})};const i=this.getDimensionsForMedia(e.tag.mediaType,1024,1024);this.embedly=new S(t.settings.getProperty(De.lc)),this.state={width:i.width,height:190,fullSized:!1,expanded:!1,mediaWidth:0,mediaHeight:0,mediaPayload:null,landscape:!1,active:!1,mediaLoadingState:e.mediaEnabled?Ce.NOT_LOADED:Ce.ENABLED,savedData:this.getSavedData(),direction:void 0};const s=e.tag,n=new k.gm((()=>({})),(e=>{s.onPropertyChanged("mediaSrc",e),s.onPropertyChanged("mediaType",e)}),(e=>{s.removeOnPropertyChanged("mediaSrc",e),s.removeOnPropertyChanged("mediaType",e)}));this.tagOnChangedSub=n.createSubscription((()=>{this.loadMedia(!0)}),!1),this.updateTagDirection()}componentDidMount(){const{view:e,manager:t}=this.props;this.loadMedia(),!e.located||e.navigating&&!e.navigatingPosition||this.setState({active:!0}),window.addEventListener("resize",this.updateBillboardSize),t&&(this.context.messageBus.subscribe(_.g,this.linkEditorOpened),this.context.messageBus.subscribe(_.Z,this.linkEditorClosed)),this.adjustSizing(),this.tagOnChangedSub.renew()}componentWillUnmount(){this.tagOnChangedSub.cancel(),this.props.manager&&(this.context.messageBus.unsubscribe(_.g,this.linkEditorOpened),this.context.messageBus.unsubscribe(_.Z,this.linkEditorClosed)),this.state.fullSized&&this.context.messageBus.broadcast(new c.vE(!1)),window.removeEventListener("resize",this.updateBillboardSize)}componentDidUpdate(e,t){const{manager:i,editing:s,tag:n,view:o,overlay:r}=this.props,{active:a}=this.state;if(i===e.manager||e.manager||(this.context.messageBus.subscribe(_.g,this.linkEditorOpened),this.context.messageBus.subscribe(_.Z,this.linkEditorClosed)),s===e.editing&&r===e.overlay||this.updateBillboardSize(),o.closeTheTag||n&&n.mediaSrc!==e.tag.mediaSrc&&this.loadMedia(!0),a||e.view.navigatingPosition===o.navigatingPosition||this.updateTagDirection(),o.closeTheTag)a&&this.setState({active:!1});else if(a||!o.located||o.navigating&&!o.navigatingPosition||this.setState({active:!0}),s&&(!e.editing||null===this.state.savedData)){const e=this.getSavedData();e&&this.setState({savedData:e})}}loadMedia(e=!1){const{mediaType:t,mediaSrc:i}=this.props.tag,{mediaLoadingState:s}=this.state;if(Oe.isMediaTag(t)&&(e||![Ce.LOADING,Ce.FAILED,Ce.ENABLED].includes(s)))return this.setState({mediaLoadingState:Ce.LOADING}),this.embedly.getMediaDetails(t,i).then((e=>{if(e&&this.billboardRef){const i=this.getDimensionsForMedia(t,e.width,e.height);this.setState(Object.assign(Object.assign({},i),{mediaWidth:e.width,mediaHeight:e.height,mediaPayload:e.embedlyResponse,mediaLoadingState:Ce.LOADED}))}})).catch((e=>{if(Ie.debug(e),this.billboardRef){const e=this.getDimensionsForMedia(p.z.text,1024,1024);this.setState(Object.assign(Object.assign({},e),{mediaLoadingState:Ce.FAILED}))}}))}adjustSizing(){const e=this.props.editing&&(window.innerWidth<=E.NE||window.innerHeight<=E.vR);e!==this.state.fullSized&&(this.context.messageBus.broadcast(new c.vE(e)),this.setState({fullSized:e}))}getDimensionsForMedia(e,t,i){if(e===p.z.text||e===p.z.none||e===p.z.error)return{width:E.Z-E.J6,height:0,landscape:!1};const{getTagContainer:s,editing:n,overlay:o}=this.props;let r=t,a=i;const l=Math.max(t,1)/Math.max(i,1),c=s();if(c)if(o)r=c.offsetWidth,a=c.offsetHeight;else{const i=e===p.z.photo;let s;s=n?i?E.l$:E.Le:E.QH;const o=c.offsetWidth-E.kn,h=c.offsetHeight-s;r=i?l>1?Math.max(Math.min(t,E.Hj,o),E.Z):Math.max(Math.min(t,E.Cz),E.dI):Math.max(Math.min(t,E.QI,o),E.Z),a=r/l,a>h&&(a=h,r=a*l)}return{width:r,height:a,landscape:l>1}}render(){const{overlay:e,editing:t,view:i,tag:o}=this.props,{closeTheTag:r}=i,{sid:a,mediaType:l,label:c,description:h}=o,{landscape:d,mediaLoadingState:u,active:m,direction:g,fullSized:f,expanded:v}=this.state,y=Oe.isMediaTag(l)&&u!==Ce.FAILED&&u!==Ce.ENABLED,b=u===Ce.LOADING&&l===p.z.photo,w=t||e?void 0:this.getTagPositionStyle(),S=t||e||!g?void 0:"tag"+g.trim().replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase(),T=this.isImageTag(),E=y&&l===p.z.video,_=y&&(l===p.z.rich||b),x=E||_||T,M=c.length>0||h.length>0;return(0,s.h)("div",{className:n("tag-position",{"billboard-standard-view":!t&&!e,"billboard-overlay":e,"billboard-editing":t,"media-only-mattertag":!M&&x,"media-mattertag":x,"video-mattertag":E,"embed-mattertag":_,"image-mattertag":T,"full-sized":f,"link-popover-expanded":v}),key:a,style:w},(0,s.h)("div",{className:n("tag-wrapper",{active:!r&&m})},(0,s.h)("div",{ref:this.setBillboardRef,className:n("tag-container",[S],{"media-landscape":x&&d,"media-portrait":x&&!d}),onClick:this.closeImageOverlay},this.renderBillboard(y))))}renderBillboard(e){const{mediaPayload:t,width:i,height:n,savedData:o,fullSized:r,mediaWidth:a,mediaHeight:l}=this.state,{onNavigationLinkClicked:c,overlay:h,selected:d,view:u,tag:p,allowTagOverlay:m}=this.props,g=l>0?a/l:void 0;if(h&&g){const{label:e,description:o,parsedDescription:r,mediaType:a}=p;return(0,s.h)(Ae,{label:e,description:o,parsedDescription:r,mediaPayload:t,mediaType:a,maxWidth:i,maxHeight:n,mediaAspectRatio:g,closing:u.closeTheTag,closeImageOverlay:this.closeImageOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:c})}{const{sid:a}=p,l={mediaPayload:t,hasMedia:e},h=e&&!t?{width:i+"px"}:{},{editing:f,manager:v}=this.props;if(f&&v)return(0,s.h)(ce,{id:a,getSavedData:this.getSavedData,manager:v,fullSized:r,mediaAspectRatio:g,media:l,mediaType:p.mediaType,closing:u.closeTheTag,label:p.label,description:p.description,originalValues:o,embedlyValidator:this.embedly});{const e={width:i,height:n,bodyStyle:h,closing:u.closeTheTag};return(0,s.h)(xe,{id:a,allowTagOverlay:m,selected:d,style:e,onClickBillboard:this.onBillboardClicked,onOpenOverlay:this.onOpenOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:c,media:l,mediaType:p.mediaType,mediaSrc:p.mediaSrc,label:p.label,parsedDescription:p.parsedDescription,description:p.description,customWidget:p.widgetFrame})}}}isImageTag(){const{tag:e}=this.props;return this.state.mediaLoadingState!==Ce.FAILED&&this.state.mediaLoadingState!==Ce.ENABLED&&e.mediaType===p.z.photo}getTagPositionStyle(){const{view:e}=this.props;if(e.located){const{position:t}=e;return{transform:`translate(${t?t.x:0}px, ${t?t.y:0}px)`}}return{pointerEvents:"none",visibility:"hidden"}}static isMediaTag(e){return e===p.z.photo||e===p.z.video||e===p.z.rich}};Re.getTagDirection=(e,t,i,s)=>{const n=1-(e+1)/(i=i||window.innerWidth)*2,o=1-(t+1)/(s=s||window.innerHeight)*2,r=o<-.2?0:o<.2?1:2,l=n<-.2?2:n<.2?1:0,c=Math.max(e,i-e);let h;return h=0===l?1===r?a.Pg.RIGHT:0===r?a.Pg.RIGHT_UP:a.Pg.RIGHT_DOWN:2===l?1===r?a.Pg.LEFT:0===r?a.Pg.LEFT_UP:a.Pg.LEFT_DOWN:1===r&&c>E.Z?n<0?a.Pg.RIGHT:a.Pg.LEFT:2===r?a.Pg.DOWN:a.Pg.UP,Ie.debug(`Selected ${h} for [${e}, ${t}] in ${i}x${s} (${l}, ${r})`),h},Re=Oe=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([d.Z],Re),Re.getTagDirection;var Le=i(25145),Ne=i(20983),ke=i(18120);class Fe extends s.Component{constructor(e){super(e),this.bindings=[],this.onUpdateSelectedTag=()=>this.setState({selectedTag:this.mattertagsViewData.selectedTag}),this.onUpdateToolState=()=>this.setState({toolState:this.mattertagsViewData.toolState}),this.onUpdateScreenPosition=()=>this.setState({screenPosition:this.mattertagsViewData.screenPosition}),this.onUpdateProgress=()=>this.setState({creationProgress:this.mattertagsViewData.progress}),this.onUpdateBillboards=()=>this.setState({billboards:this.mattertagsViewData.activeBillboards.keys}),this.toggleImageOverlay=async(e,t)=>{if(this.props.allowTagOverlay||!t)if(this.setState({overlay:t}),this.context.commandBinder.issueCommand(new r.Bz(o.P.MATTERTAG,t)),t){this.context.messageBus.broadcast(new c.dJ(e,l.V.OVERLAY));const t=e!==this.state.selectedTag?h.n.Interpolate:h.n.Instant,i=this.mattertagsData.getTag(e);this.context.commandBinder.issueCommand(new Le.Y(i.sid,t))}else this.closeBillboard(e)},this.getTagContainer=()=>this.tagsRoot,this.onNavigationLinkClicked=e=>{this.context.commandBinder.issueCommand(new Le.c(e))},this.setState({billboards:[],selectedTag:null,overlay:!1,toolState:a.rI.CLOSED,creationProgress:0,screenPosition:null})}componentDidMount(){const e=this.context.market;Promise.all([e.waitForData(Ne.n),e.waitForData(a.P5),e.waitForData(ue.e)]).then((([e,t,i])=>{this.init(e,t,i)}))}init(e,t,i){this.mattertagsData=e,this.mattertagsViewData=t,this.settingsData=i,this.bindings.push(this.mattertagsViewData.onSelectedTagChanged(this.onUpdateSelectedTag),this.mattertagsViewData.onChanged(this.onUpdateBillboards),this.mattertagsViewData.onToolStateChanged(this.onUpdateToolState)),this.context.editMode&&this.bindings.push(this.mattertagsViewData.onScreenPositionChanged(this.onUpdateScreenPosition),this.mattertagsViewData.onProgressChanged(this.onUpdateProgress)),this.setState({selectedTag:this.mattertagsViewData.selectedTag,toolState:this.mattertagsViewData.toolState,screenPosition:this.mattertagsViewData.screenPosition,creationProgress:this.mattertagsViewData.progress,billboards:this.mattertagsViewData.activeBillboards.keys})}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()})),this.bindings.length=0}componentDidUpdate(e){const{allowTagOverlay:t,toolOpen:i}=this.props;if(this.context.editMode&&(t!==e.allowTagOverlay||i!==e.toolOpen)){const e=this.mattertagsViewData&&this.mattertagsViewData.openTag;e&&(this.state.overlay?t||this.toggleImageOverlay(e,!1):this.closeBillboard(e))}}closeBillboard(e){this.mattertagsViewData.closeBillboard(e)}renderBillboards(){const{overlay:e,selectedTag:t,toolState:i,billboards:n}=this.state,{toolOpen:o,manager:r,allowTagOverlay:l}=this.props,c=[],h=i===a.rI.CREATING||i===a.rI.PRESSING||i===a.rI.PLACING,d=!(!o||i!==a.rI.EDITING&&i!==a.rI.PLACED);return h||n.forEach((i=>{const n=t===i,a=d&&n,h=this.mattertagsViewData.getViewData(i),u=this.mattertagsData.getTag(i),p=a||0===this.settingsData.tryGetProperty("mls",0);!u||h.closeTheTag&&a||c.push((0,s.h)(Re,{key:`billboard-${i}`,editing:a,selected:n,overlay:e,allowTagOverlay:l,toolOpen:o,view:h,tag:u,manager:r,mediaEnabled:p,toggleImageOverlay:this.toggleImageOverlay,onNavigationLinkClicked:this.onNavigationLinkClicked,getTagContainer:this.getTagContainer}))})),c}renderProgressCircle(){const{mobile:e}=this.props,{creationProgress:t,screenPosition:i,toolState:o}=this.state;if(!(o===a.rI.PRESSING&&t>0&&e&&i))return null;const r={left:i.x-Fe.creationButtonRadius/2+"px",top:i.y-Fe.creationButtonRadius/2+"px"};return(0,s.h)("div",{class:"point-button-wrapper",style:r},(0,s.h)(ke.$,{appendClass:n({complete:1===t,reset:0===t}),progress:100*t,innerRadius:Fe.creationButtonRadius,barWidth:Fe.progressBarThickness},(0,s.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}render(){if(!this.mattertagsData||!this.mattertagsViewData||!this.settingsData)return null;const{toolOpen:e}=this.props,{toolState:t}=this.state,i=!(!e||t!==a.rI.EDITING&&t!==a.rI.PLACED);return(0,s.h)("div",{className:n("overlay-layer","tags-layer",{"tag-editable":e,"tags-layer-editing":i}),ref:e=>{this.tagsRoot=e}},this.renderProgressCircle(),this.renderBillboards())}}Fe.creationButtonRadius=132,Fe.progressBarThickness=8},6082:(e,t,i)=>{"use strict";i.d(t,{J6:()=>s,l7:()=>n,XJ:()=>o,qS:()=>r,kn:()=>a,QH:()=>l,l$:()=>c,Le:()=>h,Z:()=>d,dI:()=>u,Cz:()=>p,QI:()=>m,Hj:()=>g,NE:()=>f,vR:()=>v});const s=12,n=24,o=20,r=5,a=100,l=80,c=150,h=340,d=310,u=200,p=300,m=350,g=400,f=700,v=600},252:(e,t,i)=>{"use strict";i.d(t,{l:()=>n});var s=i(26605);class n extends s.Component{shouldComponentUpdate(){return!1}componentDidMount(){this.base&&this.props.widget.frame.mount(this.base)}componentWillUnmount(){this.base&&this.props.widget.frame.unmount()}render(){const{width:e,height:t}=this.props.widget.size,i={};return e&&t&&(i.width=e+"px",i.height=t+"px"),(0,s.h)("div",{class:"custom-widget-container",style:i})}}},99363:(e,t,i)=>{"use strict";i.d(t,{q:()=>f});var s=i(26605),n=i(2116),o=i(94184),r=i(68611),a=i(90601),l=i(1402),c=i(62431),h=i(79830),d=i(84245),u=i(90709),p=i(73621);class m extends s.Component{constructor(e){super(e),this.stemLengthUpdating=(e,t=!0)=>{const i=t?(0,u._F)(e):e;i!==this.props.stemLength&&this.props.onLengthUpdate(i)},this.saveStemLength=(e,t=!0)=>{const i=t?(0,u._F)(e):e;this.props.onLengthChanged(i)},this.onChangeStemEnabled=()=>{this.props.onStemEnabledChanged(!this.props.stemEnabled)},this.stopPropagation=e=>e.stopPropagation(),this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(c.gx.Units,c.Mc.USFractional)})},this.formatStemHeight=e=>this.state.units===c.Mc.USFractional?(0,d.KQ)(e):Math.round(100*(0,u._F)(e))/100+"m",this.state={units:c.Mc.USFractional}}componentDidMount(){this.updateUnits(),this.slider.setValue((0,u.zy)(this.props.stemLength)),this.context.settings.onPropertyChanged(c.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(c.gx.Units,this.updateUnits)}componentWillReceiveProps(e){e.stemLength!==this.props.stemLength&&this.slider.setValue((0,u.zy)(e.stemLength))}render(){const{stemEnabled:e,stemLength:t}=this.props;return(0,s.h)("div",{class:"stem-editor",onClick:this.stopPropagation},(0,s.h)("div",{class:"stem-slider"},(0,s.h)(h.S,{ref:e=>this.slider=e,discrete:!1,min:.1,max:9,initialValue:(0,u.zy)(t),onChange:this.saveStemLength,onInput:this.stemLengthUpdating,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:h.h.DOWN})),(0,s.h)(p.X,{enabled:!0,checked:e,label:"Show Stem",onChange:this.onChangeStemEnabled}))}}var g=i(14071);let f=class extends s.Component{constructor(e){super(),this.closePinAssetEditor=e=>{e&&e.stopPropagation(),this.props.onClose()},this.handleColorPicked=e=>{this.trackEvent("pin_change_color"),this.props.onSave({color:e})},this.saveStemEnabled=e=>{this.trackEvent(e?"pin_show_stem":"pin_hide_stem"),this.props.onSave({stemEnabled:e})},this.saveStemLength=e=>{this.trackEvent("pin_change_stem_height"),this.props.onSave({stemLength:e})},this.previewStemLength=e=>{const{pin:t,pinType:i}=this.props;this.context.commandBinder.issueCommand(new r.fe(t.id,i,e))},this.stopPropagation=e=>{e.stopPropagation()}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderStemEditor(){const{pin:e}=this.props;return(0,s.h)(m,{stemLength:e.stemLength,stemEnabled:e.stemEnabled,onLengthUpdate:this.previewStemLength,onLengthChanged:this.saveStemLength,onStemEnabledChanged:this.saveStemEnabled})}render(){const{toolPanelLayout:e,open:t,pin:i,colors:n}=this.props,r=e===a.wS.BOTTOM_PANEL;return t||r?(0,s.h)("div",{class:o("pin-tool-editor",{"tool-popup":!r,open:r&&t}),onClick:this.stopPropagation},(0,s.h)("div",{class:"tool-editor-title"},(0,s.h)("span",null,"Color & Stem"),(0,s.h)(g.P,{buttonStyle:g.A.LIGHT,onClose:this.closePinAssetEditor,hideTooltip:!0})),(0,s.h)(l.z,{colors:n,defaultColor:i.color,onColorPicked:this.handleColorPicked}),this.renderStemEditor()):null}};f=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],f)},7920:(e,t,i)=>{"use strict";i.d(t,{v:()=>l});var s=i(26605),n=i(2116),o=i(63239),r=i(16945),a=i(88686);let l=class extends s.Component{constructor(e){super(),this.clickAttachment=(e,t)=>{const{attachments:i,onClick:s}=this.props;0!==i.length&&(e.stopPropagation(),s(e,t))},this.state={width:0,height:0}}getMediaDisplayDimension(e){const{layerWidth:t,layerHeight:i}=this.props;if(void 0===t||void 0===i)return{};const{mediaType:s,width:n,height:r}=e;if(![o.MediaType.PHOTO_EMBED,o.MediaType.VIDEO_EMBED,o.MediaType.RICH_EMBED].includes(s))return{};const a=.4*i,l=.7*t;if(n&&r){const e=Math.max(n,1)/Math.max(r,1);let t,i;return t=s===o.MediaType.PHOTO_EMBED?e>1?Math.max(Math.min(n,400,l),310):Math.max(Math.min(n,300),200):Math.max(Math.min(n,350,l),310),i=t/e,i>a&&(i=a,t=i*e),{width:t,height:i}}return{width:Math.max(Math.min(350,l),310),height:a}}renderAttachment(e){const{sizeMedia:t}=this.props,{width:i,height:n}=this.getMediaDisplayDimension(e);return(0,s.h)(a.P,{attachment:e,sizeMedia:t,thumbnail:!1,cover:!1,width:i,height:n,onClick:this.clickAttachment})}render(){const{attachments:e}=this.props;return 0===e.length?null:(0,s.h)("div",{class:"tag-media"},1===e.length?this.renderAttachment(e[0]):(0,s.h)(r.T,{attachments:e,startIndex:0,width:318,height:130,onClick:this.clickAttachment}))}};l=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],l)},6983:(e,t,i)=>{"use strict";i.d(t,{Q:()=>v});var s=i(47924),n=i(90601),o=i(9608),r=i(42885),a=i(57155),l=i(98809),c=i(83455),h=i(36520),d=i(22729),u=i(70008),p=i(68611),m=i(90926),g=i(85282),f=i(87493);class v{constructor(e,t){this.engine=e,this.initialized=!1,this.bindings=[],this.disabledEditorAssets={[l.U]:!1,[a.N]:!1,[r.s]:!1,[c.Mp]:!1},this.settingsToggler=new o.u(t,this.disabledEditorAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(g.n),e.waitForData(h.b),e.waitForData(d.c),e.waitForData(u.B)]).then((([e,t,i,s])=>(this.dataMap={tagsViewData:e,attachmentsData:t,floorsViewData:i,pinsViewData:s},!0)))}async activate(e){const t=this.engine;if(this.initialized)for(const e of this.bindings)e.renew();else this.initialized=!0,await this.initPromise;e&&this.settingsToggler.toggle(!0),await t.commandBinder.issueCommand(new f.bF(!0))}async deactivate(){this.settingsToggler.toggle(!1),await this.engine.commandBinder.issueCommand(new f.bF(!1))}navigateInList(e,t,i){const{tagsViewData:o}=this.dataMap,r=o.getCurrentTagViewByIndex(e);if(r)if(t){const t=i===n.wS.SIDE_PANEL?s.n.FadeToBlack:s.n.Instant;this.engine.commandBinder.issueCommand(new p.$b(r.id,m.Er.MATTERTAG,t,void 0,e))}else this.engine.commandBinder.issueCommand(new p.Ar(r.id,m.Er.MATTERTAG))}setTagVisibility(e,t){}}},52595:(e,t,i)=>{"use strict";i.d(t,{O:()=>a});var s=i(26605),n=i(2116),o=i(90926),r=i(81323);let a=class extends s.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{const{tagsViewData:e}=this.props.manager.dataMap,{listIndex:t,openTagView:i}=e;this.setState({listIndex:t,numTags:e.getEnabledTagViews().length,openTagView:i})},this.updatePinData=()=>{const{pinsViewData:e}=this.props.manager.dataMap;this.setState({pinState:e.pinState})},this.onNavigateList=e=>{this.props.manager.navigateInList(e,!1,this.props.toolPanelLayout)},this.state={pinState:o.tS.IDLE,openTagView:null,listIndex:-1,numTags:0}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.updateTagData),t.onChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{pinState:e,openTagView:t,listIndex:i,numTags:n}=this.state;return t&&e===o.tS.SELECTED&&n>1?(0,s.h)("div",{class:"overlay-top-center tags-navigation-bar"},(0,s.h)("div",{class:"overlay-info"},(0,s.h)(r.$,{index:i,total:n,disabled:!1,wrapAround:!0,onNavigate:this.onNavigateList}))):null}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a)},22952:(e,t,i)=>{"use strict";i.d(t,{g:()=>G});var s=i(26605),n=i(2116),o=i(47924),r=i(90601),a=i(29677),l=i(68611),c=i(90926),h=i(94184),d=i(51090),u=i(43711),p=i(73305),m=i(7920),g=i(30300),f=i(14071),v=i(25255),y=i(42733),b=i(81323),w=i(96240),S=i(53189),T=i(252);let E=class extends s.Component{constructor(e){super(e),this.bindings=[],this.onModalChange=()=>{const e=!!this.context.toolsData.openModal;e||this.toolPanel&&this.props.toolPanelLayout===r.wS.BOTTOM_PANEL&&this.toolPanel.resetScrollTop(),this.setState({modalOpen:e})},this.onViewAttachment=(e,t)=>{const{tag:i}=this.props;if(!i)return;const s=i.attachments,n=s.findIndex((e=>e.id===t));-1!==n&&this.closeTag().then((()=>{this.trackEvent("tags_click_view_attachment"),this.context.commandBinder.issueCommand(new p.SI(s,n))}))},this.onNavigate=e=>{this.props.manager.navigateInList(e,!0,this.props.toolPanelLayout)},this.closeTag=async()=>this.context.commandBinder.issueCommand(new u.tT(r.w1.TAGS,!1)),this.setToolPanelRef=e=>{e&&(this.toolPanel=e)},this.state={modalOpen:!1}}componentDidMount(){const{toolsData:e}=this.context;this.bindings.push(e.onOpenModalChanged(this.onModalChange)),this.onModalChange()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNavHeader(e){const{listIndex:t,numTags:i,tag:n}=this.props;if(!n)return null;const o=i>1&&-1!==t;return e?(0,s.h)("div",{class:"detail-panel-header"},o&&(0,s.h)(b.$,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}),(0,s.h)(f.P,{onClose:this.closeTag})):(0,s.h)("div",{class:"detail-panel-header"},(0,s.h)(v.A,{label:"Close",className:"return-btn",icon:"icon-close",buttonSize:y.qE.SMALL,buttonStyle:y.ZJ.TOOLBAR,onClick:this.closeTag}),o&&(0,s.h)(b.$,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}))}renderWidgetFrame(e){const t=e.widgetFrame;return t?(0,s.h)(T.l,{widget:t}):null}renderText(e){const{label:t,description:i}=e;return t||i?(0,s.h)("div",{class:"tag-text"},t&&(0,s.h)("header",{class:"tag-header"},t),i&&(0,s.h)("div",{class:"tag-description"},(0,s.h)(S.Z,{text:i,activeLinks:!0,hashtags:!1,userMentions:!1}))):null}renderTag(e,t){const{toolPanelLayout:i}=this.props,{label:n,description:o,id:r,attachments:a}=e;return t?(0,s.h)("div",{class:h("tag",{"has-media":a.length>0,"has-text":!(!n&&!o)})},(0,s.h)(m.v,{sizeMedia:!1,attachments:a,onClick:this.onViewAttachment}),this.renderText(e),this.renderWidgetFrame(e)):(0,s.h)("div",{class:"tag"},(0,s.h)(w.Z,{annotationStyle:w.Q.PRESENTATION,assetId:r,assetType:d.h.MATTERTAG,clickToEdit:!1,editable:!1,active:!1,edited:!1,text:o,title:n,toolPanelLayout:i,onViewAttachment:this.onViewAttachment}))}renderTagWidget(e,t){return(0,s.h)("div",{class:h("tag-widget",{modal:t})},this.renderNavHeader(t),this.renderTag(e,t))}render(){const{tag:e,closing:t,toolPanelLayout:i}=this.props,{modalOpen:n}=this.state,o=i===r.wS.BOTTOM_PANEL,a=i===r.wS.SIDE_PANEL,l=o||a,c=l&&!!e&&!t&&(a||!n);return l?(0,s.h)(g.J,{ref:this.setToolPanelRef,open:c,toolPanelLayout:i,scrollingDisabled:!1},e&&this.renderTagWidget(e,!1)):null}};E=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],E);var _=i(6999),x=i(96608),M=i(4633),P=i(17666),A=i(20392),O=i(90197),D=i(25382),I=i(65287),C=i(73621),R=i(18288),L=i(98784),N=i(80429),k=i(86134),F=i(29359);const{TAGS:B}=F.Z.SHOWCASE;class U extends s.Component{constructor(e){super(e),this.bindings=[],this.onTagsToolStateChanged=()=>{const{selectMode:e,toggleSelectMode:t}=this.props,{tagsViewData:i}=this.props.manager.dataMap;i.tagsToolState!==_.p.IDLE&&e&&t&&t()},this.updateGroups=()=>{const{floorsViewData:e,tagsViewData:t}=this.props.manager.dataMap,i=t.getAllTagViews().values(),s={};e.iterate((e=>{s[e.id]={id:e.id,label:e.name,items:[]}})),i.forEach((e=>{var i;const n=e.floorId;if(!s[n])throw Error(`Mattertag on non-existent floor: ${n}`);s[n].items.push({sid:e.id,floorId:e.floorId,text:this.getTagText(e),visible:e.enabled,selected:(null===(i=t.openTagView)||void 0===i?void 0:i.id)===e.id,color:e.color})}));for(const e in s)s[e].items.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1));this.setState({listGroups:s,numTags:i.length})},this.onGroupCheckboxClick=e=>{const t=e.dataset.value,{onSelectGroup:i}=this.props,{listGroups:s}=this.state;if(t&&i){const e=s[t];e&&i(e)}},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+k.u.POPUP_OFFSET>window.innerHeight?k.x.BOTTOM_RIGHT:k.x.TOP_RIGHT,i=e.currentTarget,s=i&&i.getAttribute?i.getAttribute("data-value"):null;s&&this.state.activeMenuId!==s?this.setState({activeMenuId:s,arrowPosition:t}):this.setState({activeMenuId:null,arrowPosition:t})},this.closeOptionsMenu=e=>{const t=e.target;t&&t.classList.contains("item-more-options")||this.setState({activeMenuId:null})},this.batchToggleVisibility=async()=>!!this.props.selectedItems,this.batchDelete=async()=>{if(this.props.selectedItems){const{clearSelected:e}=this.props;if(e)return e(),!0}return!1},this.toggleAll=()=>{const{onSelectAll:e}=this.props,{listGroups:t}=this.state;e&&e(t)},this.selectTag=e=>{this.trackEvent("tags_list_open_tag"),this.props.onOpenTag(e)},this.deleteItem=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&this.setState({activeMenuId:null})},this.editItem=e=>{const t=this.state.activeMenuId;e.stopPropagation(),t&&this.setState({activeMenuId:null})},this.toggleItemVisibility=e=>{const t=e.currentTarget,i=t&&t.getAttribute?t.getAttribute("data-value"):null;if(e.stopPropagation(),i){this.context.analytics.track("workshop_gui",{gui_action:"drawer_mattertag_visibility_modified"});const e=this.getListItem(i);e&&this.props.manager.setTagVisibility(i,!e.visible)}},this.renderFloorRenameHeader=(e,t)=>{const{label:i}=e,n=e.items.length,{selectedItems:o,selectMode:r,expandedGroups:a}=this.props,l=!!a&&a[e.id],c=!!o&&e.items.length>0&&e.items.every((e=>o.has(e.sid))),h={"with-children":!!r};return(0,s.h)(I.K,{label:i,expanded:!t,collapsible:t,count:n,onToggle:this.noop,floorId:e.id,hideOptions:r,appendClass:h},r&&(0,s.h)("div",{class:"accordion-checkbox"},(0,s.h)(C.X,{enabled:e.items.length>0,checked:c,id:e.id,onChange:this.onGroupCheckboxClick,stopPropagation:l,dataValue:e.id})))},this.state={numTags:0,listGroups:{},activeMenuId:null,arrowPosition:k.x.TOP_RIGHT}}componentDidMount(){const e=this.props.manager.dataMap.tagsViewData;this.bindings.push(e.onOpenTagViewChanged(this.updateGroups),e.getAllTagViews().onChanged(this.updateGroups),e.onTagsToolStateChanged(this.onTagsToolStateChanged)),this.updateGroups()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getTagText(e){let t=e.label;return""===t&&(t=e.description),t}noop(){}getListItem(e){const{listGroups:t}=this.state;for(const i in t){const s=t[i].items.find((t=>t.sid===e));if(s)return s}return null}getEmptyMessage(){return"You don't have any tags yet."}renderItemOptions(e){const{locale:t}=this.context,i=t.t(B.EDIT_LIST_ITEM_OPTION_CTA),n=t.t(B.DELETE_LIST_ITEM_OPTION_CTA);return(0,s.h)("div",{class:"tooltip-menu",ref:e=>this.setPopupMenu(e)},(0,s.h)("div",{class:"tpMsg",onClick:this.editItem},i),(0,s.h)("div",{class:"tpMsg",onClick:this.deleteItem},n))}renderItem(e,t){const{selectedItems:i,onCheckboxClick:n,onSelectItem:o,selectMode:r}=this.props,{activeMenuId:a,arrowPosition:l}=this.state,{sid:c,text:h,visible:d,selected:u,color:p}=e,m={"background-color":p},g=a===c;return(0,s.h)(A.Q,{key:c,sid:c,appendClass:{"tag-header":!0,"accordion-item-with-options":!0,"accordion-item-with-toggle":!0},enabled:d,selected:u,onSelect:r?o:this.selectTag},r&&(0,s.h)("div",{class:"accordion-checkbox"},(0,s.h)(C.X,{enabled:!0,checked:i&&i.has(c),id:c,onChange:n,stopPropagation:!0,dataValue:c})),!r&&(0,s.h)(R.Z,{id:c,visible:d,showTooltip:B.SHOW_LIST_ITEM_TOOLTIP_MESSAGE,hideTooltip:B.HIDE_LIST_ITEM_TOOLTIP_MESSAGE,onClick:this.toggleItemVisibility}),(0,s.h)("span",{class:"accordion-item-text tag-text"},(0,s.h)(S.Z,{text:h,activeLinks:!1,hashtags:!1,userMentions:!1})),(0,s.h)("span",{class:"mattertag-color-dot",style:m}),!r&&(0,s.h)(N.h,{dataValue:c,appendClass:{"accordion-item-more-options":!0},buttonStyle:N.D.PLAIN,iconClass:"icon-more-vert item-more-options",onClick:this.toggleOptionsMenu},(0,s.h)(k.u,{open:g,onClose:this.closeOptionsMenu,message:this.renderItemOptions(d),arrowPos:l,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}renderGroups(){const{locale:e}=this.context,{listGroups:t}=this.state,{onExpandChange:i,manager:n}=this.props,o=[],r=Object.keys(t).length>1,a=n.dataMap.floorsViewData.currentFloorId,l=e.t(r?B.MULTI_FLOOR_EMPTY_MESSAGE:B.SINGLE_FLOOR_EMPTY_MESSAGE);for(const e in t){const n=t[e],c=this.renderFloorRenameHeader(n,r);o.push((0,s.h)(P.b,{key:e,id:e,emptyMessage:l,header:c,open:a===n.id||!r,collapsible:r,onExpandChange:i},n.items.map(((e,t)=>this.renderItem(e,t)))))}return o}renderTagsList(){const{numTags:e}=this.state;if(0===e)return(0,s.h)("div",{class:"empty-message"},this.getEmptyMessage());const{locale:t}=this.context,{manager:i,selectedItems:n,selectMode:o,toggleSelectMode:r}=this.props,a=t.t(B.NUM_TYPE,e),l=!!n&&n.size>0,c=i.dataMap.tagsViewData.tagsToolState!==_.p.IDLE;return(0,s.h)("div",{class:h("list-panel-list","tags-list")},(0,s.h)(O.y,{selectMode:!!o,selectAllCallback:this.toggleAll,selectButtonCallback:r,disableToggle:c,title:a,hasSelectedItems:l}),(0,s.h)("div",{class:h("accordion-main-content",{"footer-active":o})},(0,s.h)(M.F,null,this.renderGroups())),(0,s.h)(D.n,{active:!!o,enabled:!!n&&n.size>0,leftButtonCallback:this.batchDelete,rightButtonCallback:this.batchToggleVisibility}))}render(){const{active:e,toolPanelLayout:t}=this.props;return(0,s.h)(x.L,{active:e,appendClass:{"tags-list-panel":!0},toolPanelLayout:t},this.renderTagsList())}}const H=(0,L.A)(U);let G=class extends s.Component{constructor(e){super(e),this.bindings=[],this.tagClosedTimeout=0,this.updateTagViews=()=>{const e=this.props.manager.dataMap.tagsViewData.getEnabledTagViews();this.setState({tagViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.tagsViewData.listIndex;this.setState({listIndex:e})},this.updateCurrentTag=async()=>{const{manager:e,toolPanelLayout:t}=this.props,{currentTag:i}=this.state,s=e.dataMap.tagsViewData,{openTagView:n,selectedPreview:o}=s,a=t!==r.wS.NONE;!n||o||i&&a?i&&a&&(!n||o)?this.startClosingTagWidget():this.setState({currentTag:n}):this.startOpeningTagWidget()},this.openTagFromList=e=>{const t=this.props.toolPanelLayout===r.wS.SIDE_PANEL?o.n.FadeToBlack:o.n.Instant;this.context.commandBinder.issueCommand(new l.$b(e,c.Er.MATTERTAG,t))},this.state={tagClosing:!1,tagViews:[],currentTag:null,listIndex:-1}}componentDidMount(){const{manager:e}=this.props,{tagsViewData:t}=e.dataMap;this.bindings.push(t.onOpenTagViewChanged(this.updateCurrentTag),t.onListIndexChanged(this.updateListIndex),t.getEnabledTagViews().onChanged(this.updateTagViews)),this.updateTagViews(),this.updateCurrentTag(),this.updateListIndex()}componentWillUnmount(){window.clearTimeout(this.tagClosedTimeout);for(const e of this.bindings)e.cancel()}startOpeningTagWidget(){const{manager:e}=this.props,t=e.dataMap.tagsViewData;window.clearTimeout(this.tagClosedTimeout),this.setState({currentTag:t.openTagView,tagClosing:!1})}startClosingTagWidget(){this.state.tagClosing||(this.setState({tagClosing:!0}),this.tagClosedTimeout=window.setTimeout((()=>{this.setState({currentTag:null,tagClosing:!1})}),a.El))}render(){const{toolPanelLayout:e,manager:t}=this.props,{tagClosing:i,tagViews:n,listIndex:o,currentTag:a}=this.state,l=e!==r.wS.NONE;if(!i&&!l)return null;const{editMode:c}=this.context,h=n.length;return(0,s.h)("div",{class:"tool-panel tags-panel"},(0,s.h)(E,{manager:t,closing:i,tag:a,toolPanelLayout:e,numTags:h,listIndex:o}),c&&(0,s.h)(H,{manager:t,active:i||!a,toolPanelLayout:e,onOpenTag:this.openTagFromList}))}};G=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],G)},30300:(e,t,i)=>{"use strict";i.d(t,{J:()=>f});var s,n=i(26605),o=i(94184),r=i(84952),a=i(21265),l=i(93273),c=i(90601),h=i(2116),d=i(91033),u=i(35175),p=i(67538),m=i(10396);n.options.debounceRendering=requestAnimationFrame,function(e){e.CENTER="center",e.TOP="top"}(s||(s={}));let g=class extends n.Component{constructor(e){super(e),this.usePointerEvents=window.PointerEvent,this.focusedElement=null,this.listening=!1,this.startY=0,this.onThumb=!1,this.scrollTop=0,this.handleResize=()=>{this.computeStateValues(),this.focusedElement&&this.scrollToElement(this.focusedElement)},this.handleWheelEvent=e=>{this.props.disabled||(this.onThumb=!1,this.focusedElement=null,this.scrollBy(e.deltaY))},this.handleEvent=e=>{if(this.scroller&&!this.props.disabled){if(this.scrollVelocityPixelsMS=0,"mousedown"===e.type||"pointerdown"===e.type||"touchstart"===e.type){const t=e.target;this.onThumb=t&&t.classList.contains("scroller-thumb")}this.focusedElement=null,this.inputFilter.handleEvent(e)}},this.handlePressStart=e=>{this.onThumb?this.startY=this.getThumbTop():this.startY=this.getScrollTop()},this.handlePressMove=e=>{const{trackHeight:t,contentsHeight:i}=this.state;let s;this.onThumb?(s=(this.startY-e.y)/t,this.scrollToPercent(s)):(s=(e.y+this.startY)/i,this.scrollToPercent(s))},this.handleDragStart=()=>{},this.handleDragEnd=(e,t)=>{this.scrollVelocityPixelsMS=e.y/t,this.lastScrollTimeMS=void 0,Math.abs(this.scrollVelocityPixelsMS)<1?this.scrollVelocityPixelsMS=0:this.animateScroll()},this.onTrackClick=e=>{if(e.target!==this.track)return;const t=this.getThumbHeight(),i=this.getThumbTop(),s=this.track.getBoundingClientRect().top,n=this.state.trackHeight;let o;o=e.clientY<s+i?Math.max(0,(i-t)/n):Math.min(n,(i+t)/n),this.scrollToPercent(o)},this.scrollToPercent=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentsHeight,0))},this.scrollBy=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(this.scroller.scrollTop+e,0))},this.computeStateValues=()=>{if(this.props.disabled)return;const e=Number(this.scroller&&this.scroller.clientHeight)||1,t=Number(this.track&&this.track.clientHeight)||e,i=Number(this.contents&&this.contents.clientHeight)||1,s=Number(this.contents&&this.contents.offsetTop)||0;this.setState({scrollerHeight:e,contentsHeight:i,trackHeight:t,offsetTop:s})},this.setContentsRef=e=>{e?(this.contents=e,this.resizeObserver.observe(this.contents)):this.contents&&this.resizeObserver.unobserve(this.contents)},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.setTrackRef=e=>{e&&(this.track=e)},this.setThumbRef=e=>{e&&(this.thumb=e)},this.state={scrollerHeight:1,contentsHeight:1,trackHeight:1,offsetTop:0},this.resizeObserver=new d.Z(this.handleResize),this.resizeSubscription=(0,m.kp)(m.g_.RESIZE,this.handleResize),this.inputFilter=new p.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd})}componentDidMount(){this.toggleEventHandling(!0),this.computeStateValues()}componentWillUnmount(){this.toggleEventHandling(!1),this.resizeObserver&&this.resizeObserver.disconnect()}componentDidUpdate(e,t){this.scroller&&e.disabled!==this.props.disabled&&(this.props.disabled?this.toggleEventHandling(!1):this.toggleEventHandling(!0))}resetScrollTop(){this.focusedElement=null,this.setScrollPosition(0)}scrollToElement(e,t=s.CENTER){if(!(e&&e.compareDocumentPosition(this.scroller)&Node.DOCUMENT_POSITION_CONTAINS))return;if(!this.isOverflowing())return;this.focusedElement=e;const{contentsHeight:i,scrollerHeight:n,offsetTop:o}=this.state;let r=e.offsetTop,a=e;for(;a.parentElement&&(a=a.parentElement,r+=a.offsetTop,a.offsetParent!==this.contents););let l=o+r;t===s.CENTER&&(l+=e.offsetHeight/2-n/2),this.scrollToPercent(l/i)}setScrollPosition(e){if(this.scroller){const t=this.scroller.scrollTop;this.scroller.scrollTop=e,this.scrollTop=this.getScrollTop(),this.props.onScrolled&&t!==this.scrollTop&&this.props.onScrolled(),this.thumb&&(this.thumb.style.height=`${this.getThumbHeight()}px`,this.thumb.style.top=`${this.getThumbTop()}px`)}}toggleEventHandling(e){const t=this.handleEvent,i=u.h?{passive:!0}:void 0;!this.listening&&e?(this.resizeSubscription.renew(),this.scroller.addEventListener("wheel",this.handleWheelEvent,i),this.usePointerEvents?(this.scroller.addEventListener("pointerdown",t,i),window.addEventListener("pointermove",t,i),window.addEventListener("pointerup",t,i)):(this.scroller.addEventListener("touchstart",t,i),this.scroller.addEventListener("mousedown",t,i),window.addEventListener("mousemove",t,i),window.addEventListener("mouseleave",t,i),window.addEventListener("mouseup",t,i),window.addEventListener("touchmove",t,i),window.addEventListener("touchend",t,i),window.addEventListener("touchcancel",t,i))):this.listening&&!e&&(this.resizeSubscription.cancel(),this.scroller.removeEventListener("wheel",this.handleWheelEvent),this.usePointerEvents?(this.scroller.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(this.scroller.removeEventListener("touchstart",t),this.scroller.removeEventListener("mousedown",t),window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}animateScroll(){window.requestAnimationFrame((e=>{void 0===this.lastScrollTimeMS&&(this.lastScrollTimeMS=e);let t=e-this.lastScrollTimeMS;if(t>0){this.scrollBy(this.scrollVelocityPixelsMS*t);const e=this.scrollVelocityPixelsMS>0?-1:1;for(;t>0;)this.scrollVelocityPixelsMS+=this.scrollVelocityPixelsMS*this.scrollVelocityPixelsMS*.01*e,t-=1}Math.abs(this.scrollVelocityPixelsMS)>.001&&this.animateScroll()}))}getThumbTop(){const{contentsHeight:e,trackHeight:t}=this.state;return Math.min(this.scrollTop/e*t,t-this.getThumbHeight())}getThumbHeight(){const{scrollerHeight:e,contentsHeight:t,trackHeight:i}=this.state;return e/t*i}getScrollTop(){return this.scroller?this.scroller.scrollTop:0}isOverflowing(){const{contentsHeight:e,scrollerHeight:t,offsetTop:i}=this.state;return e+i>t}renderTrack(){const e={height:`${this.getThumbHeight()}px`,top:`${this.getThumbTop()}px`};return(0,n.h)("div",{ref:this.setTrackRef,class:"scroller-track",onClick:this.onTrackClick},(0,n.h)("div",{ref:this.setThumbRef,class:"scroller-thumb",style:e,onPointerDown:this.usePointerEvents?this.handleEvent:void 0,onMouseDown:this.usePointerEvents?void 0:this.handleEvent,onTouchStart:this.usePointerEvents?void 0:this.handleEvent}))}render(){const{children:e,appendClass:t,hideThumb:i,disabled:s}=this.props,r=!s&&this.isOverflowing(),a={};return t&&Object.keys(t).length>0&&Object.assign(a,t),(0,n.h)("div",{class:o("scroller-container",a)},(0,n.h)("div",{class:"scroller-scroller",ref:this.setScrollerRef},(0,n.h)("div",{class:"scroller-contents",ref:this.setContentsRef},e)),!i&&r&&this.renderTrack())}};g=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([h.Z],g);class f extends n.Component{constructor(e){super(e),this.mobileSized=(0,r.w)(window),this.touchDevice=(0,a.Jm)(),this.handleTextBoxFocus=e=>{this.setState({textFocused:e.focused})},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.state={textFocused:!1}}componentDidMount(){this.context.messageBus.subscribe(l.S,this.handleTextBoxFocus)}componentWillUnmount(){this.context.messageBus.unsubscribe(l.S,this.handleTextBoxFocus)}resetScrollTop(){this.scroller&&this.scroller.resetScrollTop()}render(){const{open:e,appendClass:t,children:i,onScrolled:s,toolPanelLayout:r,scrollingDisabled:a}=this.props,{textFocused:l}=this.state,h=r===c.wS.BOTTOM_PANEL,d=this.touchDevice&&l&&h,u=h||this.mobileSized,p={open:e,"sticky-header":!d};return t&&Object.keys(t).length>0&&Object.assign(p,t),(0,n.h)("div",{class:o("detail-panel",p)},(0,n.h)(g,{ref:this.setScrollerRef,hideThumb:u,disabled:a,onScrolled:s},i))}}},96608:(e,t,i)=>{"use strict";i.d(t,{L:()=>a});var s=i(26605),n=i(94184),o=i(90601),r=i(80429);class a extends s.Component{constructor(e){super(e),this.onToggleCollapsed=e=>{e.stopPropagation(),this.state.collapsing||(this.setState((e=>{const t=!e.collapsed;return{collapsed:t,collapsing:t}})),window.setTimeout((()=>{this.setState({collapsing:!1})}),500))},this.state={collapsed:e.toolPanelLayout===o.wS.BOTTOM_PANEL,collapsing:!1}}render(){const{active:e,toolPanelLayout:t,children:i,title:a,onClose:l,appendClass:c,subheader:h}=this.props,{collapsed:d,collapsing:u}=this.state,p=t===o.wS.BOTTOM_PANEL,m=p&&d&&!u,g={active:e,collapsed:d},f=m?"icon-dpad-up":"icon-dpad-down";return c&&Object.keys(c).length>0&&Object.assign(g,c),(0,s.h)("div",{class:n("list-panel",g)},(a||l)&&(0,s.h)("div",{class:"list-panel-header",onClick:this.onToggleCollapsed},a&&(0,s.h)("div",{class:"list-panel-title"},a),(0,s.h)("div",null,p&&(0,s.h)(r.h,{iconClass:f,buttonStyle:r.D.PLAIN,onClick:this.onToggleCollapsed}),(0,s.h)(r.h,{iconClass:"icon-close",buttonStyle:r.D.PLAIN,onClick:l}))),!m&&(h||null),!m&&i)}}},14738:(e,t,i)=>{"use strict";i.d(t,{g:()=>l});var s=i(26605),n=i(2116),o=i(94184),r=i(90601),a=i(43711);let l=class extends s.Component{constructor(e){super(e),this.togglePanel=()=>{const{activeTool:e,toolPanelLayout:t}=this.props;e&&t===r.wS.SIDE_PANEL&&this.setState((e=>{const t=!e.collapsed;return this.context.commandBinder.issueCommand(new a.zK(t)),{collapsed:t}}))},this.state={currentToolPanel:e.activeTool,closing:!1,collapsed:!1}}componentDidUpdate(e,t){const{activeTool:i,toolPanelLayout:s}=this.props;e.activeTool&&!i||e.toolPanelLayout!==r.wS.NONE&&s===r.wS.NONE?(window.clearTimeout(this.panelCloseTimeout),this.panelCloseTimeout=window.setTimeout((()=>{this.setState({currentToolPanel:null,closing:!1})}),600),this.setState({closing:!0})):!e.activeTool&&i?(window.clearTimeout(this.panelCloseTimeout),this.setState({currentToolPanel:i,closing:!1})):this.setState({currentToolPanel:i})}renderContent(){const{children:e}=this.props,{currentToolPanel:t}=this.state;if(e&&Array.isArray(e)&&e.length){const i=e.find((e=>e&&e.key===t));if(i)return i}return null}render(){const{allowToggle:e}=this.props,{closing:t,currentToolPanel:i,collapsed:n}=this.state,r={"panel-expanded":!!i&&!n},a=n?"Expand List":"Collapse List",l=n?"icon-dpad-left":"icon-dpad-right",c=this.renderContent();return(0,s.h)("div",{class:o("panels",r)},c&&e&&!t&&(0,s.h)("div",{class:"panel-track"},(0,s.h)("div",{class:"panel-track-thumb","data-balloon":a,"data-balloon-pos":"left",onClick:this.togglePanel},(0,s.h)("span",{class:`icon ${l}`}))),c)}};l=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],l)},61597:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(26605),n=i(54122),o=i(10791),r=i(79994),a=i(39936),l=i(33843);class c extends n.Y{constructor(){super(...arguments),this.name="gui",this.workshopApp=!1,this.onAppReadyChanged=(e,t)=>{this.workshopApp&&(t&&e?this.mainDiv.classList.add("edit-mode"):this.mainDiv.classList.remove("edit-mode"))}}async init(e,t){this.workshopApp=e.workshopApp,this.mainDiv=e.mainDiv,this.engine=t,this.messageBus=t,this.market=t.market,this.commandBinder=t.commandBinder;const i=t.getModule(r.default),s=t.getModule(o.default),n=t.getModule(l.default),c=t.market.waitForData(a.e);this.mainArgs=await Promise.all([i,s,c,n]),this.preactRenderer=new h,t.addComponent(this,this.preactRenderer)}dispose(e){e.removeComponent(this,this.preactRenderer),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[]}unloadUi(){}async loadUi(e){let t=[];return t=t.concat(this.mainArgs),t=t.concat([this.mainDiv,this.engine,this.messageBus,this.market,this.commandBinder,this.onAppReadyChanged]),e.apply(this,t)}}class h{render(){(0,s.rerender)()}init(){}dispose(){}activate(e){}deactivate(e){}}},82209:(e,t,i)=>{"use strict";i.d(t,{nV:()=>n,nZ:()=>o,Z_:()=>r,bN:()=>a});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.modal=e,this.open=t}}class o extends s.v{constructor(e){super(),this.id=e}}class r extends s.v{constructor(e){super(),this.isOpen=e}}class a extends s.v{constructor(e){super(),this.suppress=e}}},17666:(e,t,i)=>{"use strict";i.d(t,{b:()=>a});var s=i(26605),n=i(2116),o=i(94184);let r=class extends s.Component{constructor(e){super(e)}render(){const{label:e,onToggle:t,children:i,appendClass:n}=this.props;return(0,s.h)("div",{class:o("accordion-header",n),onClick:t||void 0},i,(0,s.h)("span",{class:"accordion-header-label"},e),!!t&&(0,s.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}))}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],r);let a=class extends s.Component{constructor(e){super(e),this.toggleGroup=()=>{this.setState((e=>({expanded:!e.expanded})));const{id:e,onExpandChange:t}=this.props;t&&t(e,this.state.expanded)},this.state={expanded:!e.header||!!e.open};const{id:t,onExpandChange:i}=this.props;i&&i(t,this.state.expanded)}renderContents(){const{children:e,emptyMessage:t,doubleLine:i}=this.props,{expanded:n}=this.state,o=i?60:40,r=e&&Array.isArray(e)&&e.length||0,a=r>0;let l;return l=n?a?r*o+"px":"unset":"0",(0,s.h)("div",{class:"accordion-contents",style:`height: ${l}`},a?e:(0,s.h)("p",{class:"hint accordion-empty-message"},t||""))}renderHeader(){const{header:e,collapsible:t}=this.props,{expanded:i}=this.state,n="string"==typeof e?e:void 0;if(n)return(0,s.h)(r,{label:n,expanded:i,onToggle:t?this.toggleGroup:void 0});if(void 0!==e){const t=e;return(0,s.cloneElement)(t,{expanded:i,onToggle:this.toggleGroup})}return null}render(){const{doubleLine:e}=this.props,{expanded:t}=this.state;return(0,s.h)("div",{class:o("accordion-group",{expanded:t,collapsed:!t,"double-line":e})},this.renderHeader(),this.renderContents())}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a)},20392:(e,t,i)=>{"use strict";i.d(t,{Q:()=>r});var s=i(26605),n=i(2116),o=i(94184);let r=class extends s.Component{constructor(e){super(e),this.onClick=e=>{const t=e.target;this.props.onSelect&&!t.classList.contains("icon-more-vert")&&this.props.onSelect(this.props.sid)}}render(){const{enabled:e,selected:t,children:i,appendClass:n}=this.props,r={"accordion-item-disabled":!e,"accordion-item-selected":t};return n&&Object.keys(n).length>0&&Object.assign(r,n),(0,s.h)("div",{class:o("accordion-item",r),onClick:this.onClick},i)}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],r)},25382:(e,t,i)=>{"use strict";i.d(t,{n:()=>c});var s=i(94184),n=i(26605),o=i(42733),r=i(29359);const{TOGGLE_VISIBILITY_FOOTER_CTA:a,DELETE_FOOTER_CTA:l}=r.Z.WORKSHOP.ACCORDION;class c extends n.Component{constructor(e){super(e)}renderFooterButton(e,t,i){const{locale:s}=this.context,r=this.props.enabled&&!i,a=s.t(e);return(0,n.h)("span",{class:"footer-button-container"},(0,n.h)(o.zx,{buttonStyle:o.ZJ.CLEAR,buttonSize:o.qE.MINI,buttonState:r?o.BN.ENABLED:o.BN.DISABLED,onClick:t},a),";")}render(){const{active:e,leftButtonPhraseKey:t=l,leftButtonCallback:i,leftButtonDisabled:o=!1,rightButtonPhraseKey:r=a,rightButtonCallback:c,rightButtonDisabled:h=!1}=this.props,d={active:e},u=this.renderFooterButton(t,i,o),p=this.renderFooterButton(r,c,h);return(0,n.h)("div",{class:s("accordion-selector-footer",d)},(0,n.h)("div",{class:"footer-list"},u,p))}}},90197:(e,t,i)=>{"use strict";i.d(t,{y:()=>d});var s=i(94184),n=i(26605),o=i(42733),r=i(29359);const{DELETE_SELECTED_CTA:a,SELECT_ALL_CTA:l,ENTER_SELECT_MODE_CTA:c,EXIT_SELECT_MODE_CTA:h}=r.Z.WORKSHOP.ACCORDION;class d extends n.Component{constructor(e){super(e)}render(){const{locale:e}=this.context,{title:t,hasSelectedItems:i,selectMode:r,selectAllCallback:d,selectButtonCallback:u,hideToggle:p,disableToggle:m}=this.props,g={"select-mode":r},f=e.t(i?a:l),v=e.t(r?h:c);return(0,n.h)("div",{class:s("accordion-selector-header",g)},(0,n.h)("span",{class:"title"},r?(0,n.h)(o.zx,{buttonSize:o.qE.MINI,buttonStyle:o.ZJ.CLEAR,onClick:d},f):t),p||(0,n.h)(o.zx,{buttonSize:o.qE.MINI,buttonStyle:r?o.ZJ.CLEAR:o.ZJ.LIGHT,buttonState:m?o.BN.DISABLED:o.BN.ENABLED,onClick:u},v))}}},4633:(e,t,i)=>{"use strict";i.d(t,{F:()=>r});var s=i(26605),n=i(2116),o=i(94184);let r=class extends s.Component{constructor(e){super(e)}render(){const{children:e,className:t}=this.props,i=t||"";return(0,s.h)("div",{class:o("accordion-list",[i])},e)}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],r)},22936:(e,t,i)=>{"use strict";i.d(t,{P:()=>c});var s=i(26605),n=i(29359);const{ACCORDION:o,MODAL:r}=n.Z.WORKSHOP;function a({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,s=i.t(e,t);return i.t(o.BATCH_DELETE_MODAL_TITLE,{itemType:s})}function l({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,s=i.t(e,t);return i.t(o.BATCH_DELETE_MODAL_MESSAGE,{number:t,itemType:s})}const c=(e,t)=>({title:(0,s.h)(a,{number:e,itemTypePhraseKey:t}),message:(0,s.h)(l,{number:e,itemTypePhraseKey:t}),cancellable:!0,cancelPhraseKey:r.NO,confirmPhraseKey:r.YES})},18288:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(26605),n=i(80429),o=i(42733),r=i(26265);function a(e){const{locale:t}=this.context,{id:i,visible:a,showTooltip:l,hideTooltip:c,forceDisable:h}=e,d=a?"icon-eye-show":"icon-eye-hide",u=a&&!h?o.BN.ENABLED:o.BN.DIMMED,p=h?void 0:t.t(a?c:l),m=h?()=>{}:this.props.onClick;return(0,s.h)(n.h,{appendClass:{"accordion-icon":!0,"accordion-item-toggle-icon":!0},iconClass:d,buttonStyle:n.D.PLAIN,buttonState:u,tooltipMsg:p,tooltipPosition:r.lZ.DOWN_RIGHT,dataValue:i,onClick:m})}},98784:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var s=i(26605);const n=e=>class extends s.Component{constructor(e){super(e),this.toggleSelectMode=()=>{const{selectMode:e}=this.state;this.setState({checkedItems:new Set,selectMode:!e})},this.setGroupExpandState=(e,t)=>{const{expandedGroups:i}=this.state;i[e]=t,this.setState({expandedGroups:Object.assign({},i)})},this.onCheckboxClick=e=>{const t=e.dataset.value;t&&this.checkItem(t)},this.checkItem=e=>{e&&this.toggleId(e)},this.checkGroup=e=>{const t=e.items.every((e=>this.state.checkedItems.has(e.sid)||e.disableCheckbox));for(const i of e.items)i.disableCheckbox||this.setId(i.sid,!t,!1);this.setState({checkedItems:new Set(this.state.checkedItems)})},this.toggleId=e=>{const t=this.state.checkedItems.has(e);this.setId(e,!t)},this.clearSelected=()=>{this.setState({checkedItems:new Set})},this.setId=(e,t,i=!0)=>{t?this.state.checkedItems.add(e):this.state.checkedItems.delete(e),i&&this.setState({checkedItems:new Set(this.state.checkedItems)})},this.toggleAll=e=>{const{checkedItems:t}=this.state,i=0===t.size;for(const t in e){const s=e[t].items;for(const e of s)e.disableCheckbox||this.setId(e.sid,i,!1)}this.setState({checkedItems:new Set(this.state.checkedItems)})},this.setState({expandedGroups:{},checkedItems:new Set,selectMode:!1})}render(){const t=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(this.props,[]),{checkedItems:i,selectMode:n,expandedGroups:o}=this.state;return(0,s.h)(e,Object.assign({},t,{onCheckboxClick:this.onCheckboxClick,onSelectItem:this.checkItem,onSelectGroup:this.checkGroup,onSelectAll:this.toggleAll,clearSelected:this.clearSelected,toggleSelectMode:this.toggleSelectMode,selectMode:n,selectedItems:i,expandedGroups:o,onExpandChange:this.setGroupExpandState}))}}},59064:(e,t,i)=>{"use strict";i.d(t,{C:()=>r});var s=i(26605),n=i(2116),o=i(94184);let r=class extends s.Component{constructor(e){super(e)}render(){const{iconClass:e,label:t,badgeStyle:i,onClick:n}=this.props;return(0,s.h)("span",{class:o("badge",{clickable:!!n}),style:i,onClick:n},e&&(0,s.h)("span",{class:`icon badge-icon ${e}`}),t&&(0,s.h)("span",{class:"badge-label"},t))}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],r)},25255:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var s=i(26605),n=i(2116),o=i(94184),r=i(42733);let a=class extends s.Component{constructor(e){super(e)}render(){const{onClick:e,label:t,icon:i,buttonSize:n,buttonStyle:a,className:l}=this.props;return(0,s.h)(r.zx,{appendClass:{"button-with-icon":!0,[l]:!0},buttonSize:n,buttonStyle:a,onClick:e},(0,s.h)("span",{class:o("icon",i)}),t)}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a)},73621:(e,t,i)=>{"use strict";i.d(t,{X:()=>r});var s=i(26605),n=i(94184),o=i(2116);let r=class extends s.Component{constructor(e){super(e),this.onChange=e=>{this.props.stopPropagation&&e.stopPropagation(),this.setState((e=>({checkedValue:!e.checkedValue})),(()=>{this.props.onChange&&this.props.onChange(this.checkboxElement)}))},this.setCheckboxRef=e=>{this.checkboxElement=e},this.state={checkedValue:e.checked}}componentWillReceiveProps(e){this.setState({checkedValue:e.checked})}render(){const{id:e,dataValue:t,enabled:i,error:o,key:r,helpText:a,label:l}=this.props,{checkedValue:c}=this.state,h=!i;return(0,s.h)("div",{ref:this.setCheckboxRef,id:e,"data-value":t,class:n("checkbox-element",{checked:c,disabled:h,error:o}),onClick:this.onChange,key:r},(0,s.h)("div",{class:"checkbox icon-checkmark"}),(0,s.h)("div",{class:"checkbox-text"},l),a&&(0,s.h)("span",{className:"help-text"},a))}};r.defaultProps={enabled:!0,error:!1},r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],r)},18120:(e,t,i)=>{"use strict";i.d(t,{$:()=>l});var s,n=i(26605),o=i(2116),r=i(97620),a=i(94184);let l=s=class extends n.Component{constructor(e){super(e),this.strokePattern=[0,100],this.strokeOffset=0,this.innerRadius=15.92,this.strokeWidth=1,this.drawRadius=this.innerRadius+this.strokeWidth/2,this.updateSvgAttributes(e),this.elementId=this.props.id||"circle-progress-"+s.id++}componentWillReceiveProps(e){this.updateSvgAttributes(e)}updateSvgAttributes(e){this.strokeWidth=e.barWidth||this.strokeWidth,this.innerRadius=e.innerRadius||this.innerRadius,this.drawRadius=this.innerRadius+this.strokeWidth/2;const t=2*this.drawRadius*Math.PI;this.strokeOffset=t*(e.startPosition||this.strokeOffset),this.strokePattern[0]=t*(0,r.uZ)(e.progress,0,100)/100,this.strokePattern[1]=t-this.strokePattern[0]}render(){const{progressColor:e}=this.props,t=2*(this.innerRadius+this.strokeWidth),i=t/2;return(0,n.h)("svg",{id:this.elementId,class:a("circular-progress",this.props.appendClass),viewBox:`${-i} ${-i} ${t} ${t}`},(0,n.h)("circle",{class:"bar-bg",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[1]} ${this.strokePattern[0]}`,"stroke-dashoffset":this.strokeOffset-this.strokePattern[0],"stroke-width":this.strokeWidth,fill:"none"}),(0,n.h)("circle",{class:e?void 0:"progress",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[0]} ${this.strokePattern[1]}`,"stroke-width":this.strokeWidth,stroke:e,fill:"none"}),this.props.children)}};l.id=0,l=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],l)},63985:(e,t,i)=>{"use strict";i.d(t,{i:()=>d});var s,n=i(91033),o=i(94184),r=i(26605),a=i(80429),l=i(2116);!function(e){e.UP="up",e.DOWN="down"}(s||(s={}));let c=class extends r.Component{constructor(e){super(e),this.onOutsideClick=e=>{this.toggleDropdown(!1)},this.onToggleClick=e=>{e.stopPropagation(),this.toggleDropdown()},this.onTransitionEnd=e=>{e&&e.target!==e.currentTarget||(window.clearTimeout(this.transitionTimeout),this.setState({transitioning:!1}))},this.toggleDropdown=e=>{const{open:t}=this.state,i=void 0!==e?e:!t;i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.transitionTimeout=window.setTimeout(this.onTransitionEnd,1e3),this.setState({open:i,transitioning:!0})},this.state={open:!1,transitioning:!1}}componentWillUnmount(){window.removeEventListener("click",this.onOutsideClick)}render(){const{open:e,transitioning:t}=this.state,i=this.props,{children:n,className:l,direction:c}=i,h=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(i,["children","className","direction"]),d={up:c===s.UP,open:e,transitioning:t};return(0,r.h)("div",Object.assign({className:o("dropdown",d,l)},h),(0,r.h)("div",{className:"dropdown-mask"},(0,r.h)("div",{className:"dropdown-menu",onTransitionEnd:this.onTransitionEnd},n)),(0,r.h)("div",{className:"dropdown-toggle"},(0,r.h)(a.h,{iconClass:"icon-toolbar-more-horiz",onClick:this.onToggleClick,appendClass:{"dropdown-toggle":!0}})))}};c.defaultProps={direction:s.DOWN},c=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([l.Z],c);const h="collapsed";let d=class extends r.Component{constructor(e){super(e),this.onResize=()=>{this.update()},this.setContentRef=e=>{this.contentRef=e},this.setCollapsedRef=e=>{this.collapsedRef=e},this.setToggleRef=e=>{this.toggleRef=e},this.state={collapsed:!1},this.observer=new n.Z(this.onResize)}componentDidMount(){this.connectObserver(),this.update()}componentDidUpdate(){this.update()}componentWillUnmount(){this.disconnectObserver(),this.reset()}connectObserver(){this.observer.observe(this.contentRef)}disconnectObserver(){this.observer&&this.observer.disconnect()}reset(){if(!this.contentRef)return;const e=this.contentRef.querySelectorAll(".collapsed");Array.from(e).forEach((e=>e.classList.remove(h)))}update(){if(!this.contentRef||!this.collapsedRef||!this.toggleRef)return;const e=this.contentRef.children,t=this.collapsedRef.children;if(!e||e.length!==t.length)return;const{collapsed:i}=this.state,s=this.contentRef.offsetWidth,n=this.toggleRef.base&&this.toggleRef.base.offsetWidth||0;let o=0,r=0;for(let i=0;i<e.length;i++){let a=e[i].offsetWidth||0;r||i!==e.length-1||(a-=n),o+=a,o<=s?(e[i].classList.remove(h),t[i].classList.add(h)):(r++,e[i].classList.add(h),t[i].classList.remove(h))}!!r!==i&&this.setState({collapsed:!i})}render(){const e=this.props,{children:t,className:i}=e,n=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(e,["children","className"]),{collapsed:a}=this.state,l=`collapsible-list ${i}`,h={hidden:!a};return t&&Array.isArray(t)?(0,r.h)("div",Object.assign({className:o(l)},n),(0,r.h)("div",{ref:this.setContentRef,class:"collapsible-list-items"},t),(0,r.h)(c,{ref:this.setToggleRef,direction:s.UP,className:o(h)},(0,r.h)("div",{ref:this.setCollapsedRef,class:"collapsible-list-menu"},t))):{children:t}}};d.defaultProps={},d=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([l.Z],d)},1402:(e,t,i)=>{"use strict";i.d(t,{z:()=>r});var s=i(26605),n=i(94184),o=i(2116);let r=class extends s.Component{constructor(e){super(e),this.clickColor=e=>{const t=e.currentTarget;if(t&&t.getAttribute){const i=t.dataset.value;i&&(e.stopPropagation(),this.props.onColorPicked(i),this.setState({activeColor:i}))}},this.renderColorSwatch=e=>{const{activeColor:t}=this.state,i={backgroundColor:e},o=n({"color-swatch":!0,"icon-checkmark":!0,active:e===t});return(0,s.h)("div",{class:o,style:i,"data-value":e,onClick:this.clickColor})},this.state={activeColor:e.defaultColor||""}}componentWillReceiveProps(e){e.defaultColor&&!this.state.activeColor&&this.setState({activeColor:e.defaultColor})}render(){const{colors:e}=this.props;return(0,s.h)("div",{class:"color-picker"},e.map((e=>this.renderColorSwatch(e))))}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],r)},26265:(e,t,i)=>{"use strict";i.d(t,{lZ:()=>s,oO:()=>l});var s,n,o=i(26605),r=i(2116),a=i(94184);!function(e){e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right"}(s||(s={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.XLARGE="xlarge",e.FIT="fit"}(n||(n={}));let l=class extends o.Component{constructor(){super(),this.onClick=e=>{this.props.onClick&&this.props.onClick(e),void 0!==this.props.tooltipTimeout&&window.setTimeout((()=>{this.setState({tooltipEnabled:!1})}),this.props.tooltipTimeout)},this.onMouseEnter=e=>{this.enableTooltip(),this.adjustBalloonPosIfNeeded(e)},this.enableTooltip=()=>{this.setState({tooltipEnabled:!0})},this.state={currentPosition:null,tooltipEnabled:!0}}render(){const{children:e,position:t,content:i,className:s,tooltipWidth:n}=this.props,{currentPosition:r,tooltipEnabled:l}=this.state;return(0,o.h)("div",{type:"button","data-balloon":i,"data-balloon-pos":r||t,"data-balloon-width":n,class:a("data-balloon",s,{disabled:!l}),onClick:this.onClick,onTouchStart:this.enableTooltip,onMouseEnter:this.onMouseEnter},e)}adjustBalloonPosIfNeeded(e){const{currentPosition:t}=this.state;if(null===t){const t=e.target,{position:i}=this.props;let n=i;if(i!==s.LEFT&&i!==s.RIGHT){const e=window.getComputedStyle(t,":after"),o=e.width?parseInt(e.width,10):0;if(o>0){const e=t.getBoundingClientRect(),r=(o-e.width)/2,a=i===s.UP||i===s.UP_RIGHT||i===s.UP_LEFT;e.left-r<=0?n=a?s.UP_RIGHT:s.DOWN_RIGHT:(i===s.UP_LEFT||i===s.DOWN_LEFT)&&e.left-o<=0?n=a?s.UP:s.DOWN:e.right+r>=window.innerWidth?n=a?s.UP_LEFT:s.DOWN_LEFT:(i===s.UP_RIGHT||i===s.DOWN_RIGHT)&&e.right+o>=window.innerWidth&&(n=a?s.UP:s.DOWN)}}this.setState({currentPosition:n})}}};l=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],l)},65287:(e,t,i)=>{"use strict";i.d(t,{K:()=>p});var s,n=i(26605),o=i(2116),r=i(94184),a=i(48475),l=i(86134),c=i(31399),h=i(80429),d=i(29359);const{RENAME_HEADER_OPTION_CTA:u}=d.Z.WORKSHOP.ACCORDION;let p=s=class extends n.Component{constructor(e){super(e),this.startRename=e=>{e.stopPropagation(),this.setState({renaming:!0,menuOpen:!1})},this.renameFloor=e=>{this.context.commandBinder.issueCommand(new a.M(this.props.floorId,e||this.props.label)),this.setState({renaming:!1})},this.cancelRename=()=>{this.setState({renaming:!1})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+l.u.POPUP_OFFSET>window.innerHeight?l.x.BOTTOM_RIGHT:l.x.TOP_RIGHT;this.setState((e=>({menuOpen:!e.menuOpen,arrowPosition:t})))},this.closeOptionsMenu=()=>{this.setState({menuOpen:!1})},this.toggleExpanded=e=>{const t=e.target;this.props.onToggle&&!t.classList.contains("icon-more-vert")&&this.props.onToggle()},this.state={arrowPosition:l.x.TOP_RIGHT,renaming:!1,menuOpen:!1}}renderOptionsMenu(){const{locale:e}=this.context,t=e.t(u);return(0,n.h)("div",{class:"tooltip-menu",ref:this.setPopupMenu},(0,n.h)("div",{class:"tpMsg",onClick:this.startRename},t))}render(){const{label:e,count:t,collapsible:i,children:o,hideOptions:a,appendClass:d}=this.props,{renaming:u,menuOpen:p,arrowPosition:m}=this.state,g=void 0!==t?`(${t})`:void 0,f={"accordion-header-editing":u,"accordion-collapsible":i};return d&&Object.keys(d).length>0&&Object.assign(f,d),(0,n.h)("div",{class:r("accordion-header","floor-rename-header",f),onClick:this.toggleExpanded},o,(0,n.h)(c.Z,{isDisabled:!1,editing:u,className:"accordion-header-label",text:e,hint:g,clickToEdit:!1,closeOnFocusOut:!0,defaultText:e,onEdited:this.renameFloor,maxLength:s.maxFloorNameLength,showUnderline:u,readOnlyMode:!u,propagateMouseEvent:!u,onCancelEditing:this.cancelRename}),i&&(0,n.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}),a||(0,n.h)(h.h,{appendClass:{"accordion-more-options":!0},buttonStyle:h.D.PLAIN,iconClass:"icon-more-vert",onClick:this.toggleOptionsMenu},(0,n.h)(l.u,{open:p,onClose:this.closeOptionsMenu,message:this.renderOptionsMenu(),arrowPos:m,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}};p.maxFloorNameLength=24,p.focusedFloor=-1,p=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],p)},80429:(e,t,i)=>{"use strict";i.d(t,{D:()=>n,h:()=>d});var s,n,o=i(26605),r=i(2116),a=i(94184),l=i(21265),c=i(26265),h=i(42733);!function(e){e[e.CLEAR=0]="CLEAR",e[e.PLAIN=1]="PLAIN",e[e.OVERLAY=2]="OVERLAY",e[e.PRIMARY=3]="PRIMARY",e[e.SOCIAL=4]="SOCIAL",e[e.TOOLBAR=5]="TOOLBAR"}(n||(n={}));let d=s=class extends o.Component{constructor(e){super(e),this.onClick=e=>{const t=this.props.buttonState;t!==h.BN.BUSY&&t!==h.BN.DISABLED&&this.props.onClick&&this.props.onClick(e)},this.onMouseDown=e=>{const{onMouseDown:t,onClick:i,buttonState:n}=this.props;if(t)t(e);else if(s.iMobile&&i&&n!==h.BN.BUSY&&n!==h.BN.DISABLED){const t=document.activeElement;t&&e.cancelable&&(t.blur(),e.preventDefault())}}}render(){const{id:e,tooltipMsg:t,tooltipPosition:i,tooltipPreformatted:s,tooltipWidth:r,dataValue:l,buttonState:d,buttonStyle:u,buttonSize:p,appendClass:m,children:g,iconClass:f,onClick:v,onMouseUp:y}=this.props,b=d===h.BN.DISABLED,w=d===h.BN.BUSY,S=d===h.BN.DECORATIVE,T=!b&&!w&&!S,E=t?i||c.lZ.DOWN:void 0,_=t?!!s:void 0,x={"button-small":p===h.qE.SMALL,"button-large":p===h.qE.LARGE,"button-disabled":b,"button-dimmed":d===h.BN.DIMMED,"button-active":d===h.BN.ACTIVE,"button-busy":w,"button-interactive":T,"icon-button-primary":u===n.PRIMARY,"icon-button-overlay":u===n.OVERLAY,"icon-button-plain":u===n.PLAIN,"icon-button-social":u===n.SOCIAL,"icon-button-toolbar":u===n.TOOLBAR};return m&&Object.keys(m).length>0&&Object.assign(x,m),(0,o.h)("div",{id:e,role:"button","data-value":l,"data-balloon":t,"data-balloon-pos":E,"data-balloon-width":r,"data-balloon-pre":_,class:a("icon-button",x),onClick:v?this.onClick:void 0,onMouseUp:y,onMouseDown:this.onMouseDown},f&&(0,o.h)("span",{class:`icon ${f}`}),g)}};d.iMobile=(0,l.s)()||(0,l._1)(),d=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],d)},42190:(e,t,i)=>{"use strict";i.d(t,{s:()=>d});var s=i(26605),n=i(98867),o=i(2752),r=i(80429),a=i(26265),l=i(14071),c=i(47133),h=i(42733);class d extends s.Component{constructor(e){super(e),this.open=e=>{this.el.classList.add("open"),this.focus(e.urlFocus)},this.close=()=>{this.urlInput&&this.urlInput.blur(),this.textInput&&this.textInput.blur(),this.el.classList.remove("open")},this.onEditedUrl=e=>{const{validUrl:t,currentText:i}=this.state;if(!t)return;const s=""!==i?i:e;this.props.onSaveLink(s,e)},this.onInputUrl=e=>{this.setState({validUrl:(0,n.j)(e),currentUrl:e})},this.onEditedText=e=>{this.focus(!0)},this.onInputText=e=>{this.setState({currentText:e})},this.onApply=e=>{this.state.currentUrl&&this.onEditedUrl(this.state.currentUrl)},this.onClose=e=>{this.close(),this.props.onCancel()},this.onPreviewUrl=()=>{this.state.validUrl&&window.open(this.state.currentUrl,"_blank")},this.stopPropagation=e=>{e.stopPropagation()},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.setTextRef=e=>this.textInput=e,this.state={currentUrl:e.linkUrl,currentText:e.linkText,validUrl:!0}}componentDidMount(){this.context.messageBus.subscribe(o.g,this.open),this.context.messageBus.subscribe(o.Z,this.close)}componentWillUnmount(){this.context.messageBus.unsubscribe(o.g,this.open),this.context.messageBus.unsubscribe(o.Z,this.close)}componentWillReceiveProps(e){this.state.currentUrl!==e.linkUrl&&this.setState({currentUrl:e.linkUrl}),this.state.currentText!==e.linkText&&this.setState({currentText:e.linkText})}focus(e=!1){e?this.urlInput&&this.urlInput.focus():this.textInput&&this.textInput.focus()}renderButtons(){const{validUrl:e,currentUrl:t}=this.state,{onRemoveLink:i,linkText:n,linkUrl:o}=this.props,l=""!==n&&""!==o,c=t&&e?h.BN.ENABLED:h.BN.DISABLED;return(0,s.h)("div",{class:"popover-footer"},this.renderValidationMessage(),l&&(0,s.h)(r.h,{iconClass:"icon-delete",buttonStyle:r.D.CLEAR,tooltipMsg:"Remove Link",tooltipPosition:a.lZ.UP,onClick:i}),(0,s.h)(h.zx,{appendClass:{"button-inline":!0},buttonStyle:h.ZJ.CLEAR,buttonSize:h.qE.SMALL,buttonState:c,onClick:this.onApply},"Apply"))}renderValidationMessage(){const{linkText:e,linkUrl:t}=this.props,{validUrl:i,currentUrl:n}=this.state,o=""===e&&""===t&&""===n;return!i&&n?(0,s.h)("div",{class:"popover-message popover-message-error"},"Invalid URL"):(0,s.h)("div",{class:"popover-message"},o&&"Tip: Turn text into a link by selecting the text before clicking 'Add Link'")}render(){const{validUrl:e,currentText:t,currentUrl:i}=this.state;return(0,s.h)("div",{ref:this.setRef,class:"annotation-popup link-editor",onClick:this.stopPropagation},(0,s.h)("div",{class:"popover-header"},(0,s.h)("div",{class:"popover-label"},"Text"),(0,s.h)(l.P,{buttonStyle:l.A.LIGHT,onClose:this.onClose})),(0,s.h)(c.Z,{ref:this.setTextRef,text:t,onDone:this.onEditedText,onInput:this.onInputText}),(0,s.h)("div",{class:"url-field"},(0,s.h)("div",{class:"popover-label"},"Link to"),(0,s.h)(c.Z,{ref:this.setUrlRef,text:i,type:"url",placeholder:"https://",onDone:this.onEditedUrl,onInput:this.onInputUrl}),e&&i&&(0,s.h)(r.h,{appendClass:{"preview-link":!0},iconClass:"icon-ext-link",buttonStyle:r.D.PLAIN,tooltipMsg:"Preview Link",tooltipPosition:a.lZ.UP,onClick:this.onPreviewUrl})),this.renderButtons())}}},2752:(e,t,i)=>{"use strict";i.d(t,{g:()=>n,Z:()=>o});var s=i(93528);class n extends s.v{constructor(e=!1){super(),this.urlFocus=e}}class o extends s.v{}},81323:(e,t,i)=>{"use strict";i.d(t,{$:()=>o});var s=i(26605),n=i(2116);let o=class extends s.Component{constructor(e){super(),this.onGotoNextNote=()=>{const e=this.getNextIndex();-1!==e&&this.props.onNavigate(e)},this.onGotoPrevNote=()=>{const e=this.getPrevIndex();-1!==e&&this.props.onNavigate(e)}}getNextIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t+1<e?t+1:i?0:-1}getPrevIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t>0?t-1:i?e-1:-1}render(){const{total:e,index:t,disabled:i}=this.props;if(e<2||-1===t)return null;const n=i||-1===this.getNextIndex()?"disabled":"",o=i||-1===this.getPrevIndex()?"disabled":"",r=`${t+1} of ${e}`;return(0,s.h)("div",{class:"list-nav"},(0,s.h)("span",{class:"list-nav-btn list-nav-btn-prev"},(0,s.h)("span",{class:`icon icon-dpad-left ${o}`,onClick:this.onGotoPrevNote})),(0,s.h)("span",{class:"list-nav-label"},r),(0,s.h)("span",{class:"list-nav-btn list-nav-btn-next"},(0,s.h)("span",{class:`icon icon-dpad-right ${n}`,onClick:this.onGotoNextNote})))}};o=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],o)},96630:(e,t,i)=>{"use strict";i.d(t,{s:()=>o});var s=i(26605),n=i(46162);class o extends s.Component{constructor(e){super(e),this.eventsToSend={[o.SendEvent.HOVER]:!1,[o.SendEvent.CLICK]:!1,[o.SendEvent.BUTTON]:!1},this.setRef=e=>this.mouseThroughElement=e,this.onHoverEvent=e=>{switch(e.type){case"mousemove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"mouseenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"mouseleave":this.props.onMouseLeave&&this.props.onMouseLeave(e);break;case"pointermove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"pointerenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"pointerleave":this.props.onMouseLeave&&this.props.onMouseLeave(e)}this.eventsToSend[o.SendEvent.HOVER]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.isValidTarget=e=>e===this.mouseThroughElement||this.props.includeChildrenEvents&&e.compareDocumentPosition(this.mouseThroughElement)&Node.DOCUMENT_POSITION_CONTAINS,this.onClick=e=>{this.props.onClick&&this.props.onClick(e),this.eventsToSend[o.SendEvent.CLICK]&&this.isValidTarget(e.target)&&(this.sendEventThrough("mousedown",e),window.setTimeout((()=>this.sendEventThrough("mouseup",e)),0))},this.onButtonEvent=e=>{switch(e.type){case"pointerdown":this.props.onPointerDown&&this.props.onPointerDown(e);break;case"pointerup":this.props.onPointerUp&&this.props.onPointerUp(e)}this.eventsToSend[o.SendEvent.BUTTON]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.onClick=this.onClick.bind(this),this.target=e.clickTarget||document.getElementsByTagName("canvas")[0],this.registerEvents()}componentWillReceiveProps(e){(0,n.NK)(this.props.sendEvents,e.sendEvents)&&this.registerEvents()}render(){return(0,s.h)("div",{id:this.props.id,ref:this.setRef,class:this.props.className,style:this.props.style||{},onMouseEnter:this.onHoverEvent,onMouseLeave:this.onHoverEvent,onMouseMove:this.onHoverEvent,onPointerEnter:this.onHoverEvent,onPointerLeave:this.onHoverEvent,onPointerMove:this.onHoverEvent,onMouseDown:this.onButtonEvent,onMouseUp:this.onButtonEvent,onPointerDown:this.onButtonEvent,onPointerUp:this.onButtonEvent,onClick:this.onClick},this.props.children)}registerEvents(){this.props.sendEvents.length&&(this.eventsToSend[o.SendEvent.CLICK]=this.props.sendEvents.indexOf(o.SendEvent.CLICK)>-1,this.eventsToSend[o.SendEvent.HOVER]=this.props.sendEvents.indexOf(o.SendEvent.HOVER)>-1,this.eventsToSend[o.SendEvent.BUTTON]=this.props.sendEvents.indexOf(o.SendEvent.BUTTON)>-1)}sendEventThrough(e,t){let i;try{i=window.PointerEvent?new PointerEvent(e,t):new MouseEvent(e,t)}catch(s){i=document.createEvent("MouseEvents");const n=t.view;if(!n)return;i.initMouseEvent(e,t.bubbles,t.cancelable,n,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}this.target.dispatchEvent(i)}}!function(e){let t;!function(e){e[e.HOVER=1]="HOVER",e[e.CLICK=2]="CLICK",e[e.BUTTON=3]="BUTTON"}(t=e.SendEvent||(e.SendEvent={}))}(o||(o={}))},76104:(e,t,i)=>{"use strict";i.d(t,{E:()=>r});var s=i(26605),n=i(94184),o=i(2116);let r=class extends s.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange(e)}}render(){const{id:e,name:t,value:i,checked:o,children:r,enabled:a}=this.props,l=!a;return(0,s.h)("div",{class:n("radio-element","radio-button",{disabled:l})},(0,s.h)("input",{type:"radio",id:e,name:t,value:i,checked:o,onChange:this.onChange}),(0,s.h)("label",{for:e},r))}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],r)},74121:(e,t,i)=>{"use strict";i.d(t,{S:()=>a,K:()=>s});var s,n=i(26605),o=i(86134),r=i(94184);class a extends n.Component{constructor(e){super(e),this.onSelectOption=e=>{const t=e.target,i=t.getAttribute("data-index"),s=t.getAttribute("data-value");i&&this.props.onSelect(parseInt(i,10),s)}}getSelectedOption(){return this.props.options.find((e=>e.selected))||null}renderPopupContents(){const e=[];return this.props.options.forEach(((t,i)=>{const s=t.className||"";e.push((0,n.h)("div",{"data-index":i,"data-value":t.value,class:r({tpMsg:!0,disabled:!!t.disabled,[s]:!!s}),onClick:this.onSelectOption},t.text))})),(0,n.h)("div",{class:"tooltip-menu"},e)}render(){const{id:e,onToggle:t,open:i,onClose:a,arrowPos:l,label:c,className:h,menuStyle:d}=this.props,u=this.getSelectedOption(),p=u?u.text:"",m=h||"",g=d===s.BUTTON,f=d===s.DROPDOWN,v={[m]:!!m,"select-button":g,"select-dropdown":f};return(0,n.h)("div",{class:r("select-popup",v),id:e},c&&(0,n.h)("label",{class:"select-label"},c),(0,n.h)("div",{class:"select-trigger",onClick:t},(0,n.h)("span",{class:"select-menu-text"},p),f&&(0,n.h)("svg",{viewBox:"0 0 16 10"},(0,n.h)("polygon",{points:"2 2, 14 2, 8 8"})),g&&(0,n.h)("span",{class:"icon icon-arrows"}),(0,n.h)(o.u,{open:!!i,onClose:a,message:this.renderPopupContents(),arrowPos:l||o.x.NONE,appendBodyClass:{"item-tooltip":!0}})))}}!function(e){e[e.DROPDOWN=0]="DROPDOWN",e[e.BUTTON=1]="BUTTON"}(s||(s={}))},7351:(e,t,i)=>{"use strict";i.d(t,{J:()=>r});var s=i(26605),n=i(2116),o=i(86134);let r=class extends s.Component{constructor(){super(...arguments),this.stopClickPropagation=e=>{e.stopPropagation()}}render(){const{children:e,open:t,appendClass:i,close:n,arrowPosition:r}=this.props,a=(0,s.h)("div",{class:"settings-container settings-box",onClick:this.stopClickPropagation},e);return(0,s.h)(o.u,{open:t,message:a,appendClass:i,arrowPos:r,onClose:n})}};r=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],r)},75328:(e,t,i)=>{"use strict";i.d(t,{w:()=>o});var s=i(26605),n=i(2116);let o=class extends s.Component{render(){const{label:e,children:t,appendClass:i}=this.props,n=i||"";return(0,s.h)("div",{class:`settings-toggle ${n}`},e&&(0,s.h)("div",{class:"settings-label"},e),t)}};o=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],o)},65277:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var s=i(26605),n=i(94184),o=i(97620),r=i(20072),a=i(95843),l=i(85768),c=i(1481),h=i(67538),d=i(1799),u=i(10396),p=i(80429),m=i(42733);s.options.debounceRendering=requestAnimationFrame;class g extends s.Component{constructor(e){super(e),this.dragStartScroll=0,this.listening=!1,this.animation=null,this.handlingPaused=!1,this.handleEvent=e=>{"mousedown"!==e.type&&"pointerdown"!==e.type&&"touchstart"!==e.type||(this.handlingPaused=!1),this.props.suppressDrag||this.handlingPaused||this.inputFilter.handleEvent(e)},this.getScrolledOffset=()=>{if(!this.innerWrapper&&0===this.state.contentSize)return 0;const e=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]/this.state.contentSize},this.getScrollableContainer=()=>this.innerWrapper,this.pauseScrollHandling=()=>{this.handlingPaused=!0,this.toggleDownEventListening(!1)},this.scrollWithScrollBar=e=>{if(!this.props.suppressDrag){const t=this.getAxis();e.hasOwnProperty(t)&&this.scrollTo(e[t])}},this.scrollTo=e=>{void 0===e||isNaN(e)||(this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentSize,0)),this.setState({scrollOffset:this.getScrollPosition()}))},this.handleDragStart=()=>{this.setState({scrollCenter:null})},this.handlePressStart=()=>{this.dragStartScroll=this.getScrollPosition()},this.handlePressMove=e=>{if(!this.props.suppressDrag){const t=(e[this.getAxis()]+this.dragStartScroll)/this.state.contentSize;this.scrollTo(t)}},this.handleWheelEvent=e=>{this.props.suppressDrag?e.preventDefault():this.props.direction===a.Nm.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.setState({scrollCenter:null}),this.handleExternalChange())},this.handleClick=e=>{this.props.handleClick&&this.props.handleClick(e)},this.handleDragEnd=(e,t)=>{const i=e[this.getAxis()]/t,s=Math.min(a.UI,Math.abs(a.UI*i)),n=this.getScrollPosition(),o=i*s/2;this.animation=new c.Z({duration:s,startValue:n/this.state.contentSize,endValue:Math.max(0,Math.min((n+o)/this.state.contentSize,1)),easingFunction:d.hl})},this.onManualScroll=()=>{this.props.onScrolled&&this.props.onScrolled()},this.onButtonScroll=e=>{if(this.contentContainer&&this.props.steps){const t=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth",i=this.contentContainer[t]/this.props.steps,s=this.getScrollPosition();let n;n=e?(s+i)/this.state.contentSize:(s-i)/this.state.contentSize,this.scrollTo((0,o.uZ)(n,0,1))}},this.onScrollBack=()=>{this.onButtonScroll(!1)},this.onScrollForward=()=>{this.onButtonScroll(!0)},this.onHoldScrollBack=()=>{this.mouseInterval=window.setInterval(this.onScrollBack,300)},this.onHoldScrollForward=()=>{this.mouseInterval=window.setInterval(this.onScrollForward,300)},this.onScrollButtonUp=()=>{window.clearInterval(this.mouseInterval)},this.renderScrollBackButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===a.Nm.vertical?"icon-dpad-up":"icon-dpad-left",i=0===e?m.BN.DISABLED:m.BN.ENABLED;return(0,s.h)(p.h,{appendClass:{"scroll-button":!0,"scroll-back":!0},iconClass:t,buttonStyle:p.D.CLEAR,buttonState:i,onClick:this.onScrollBack,onMouseDown:this.onHoldScrollBack,onMouseUp:this.onScrollButtonUp})},this.renderScrollForwardButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth",i=this.props.direction===a.Nm.vertical?"icon-dpad-down":"icon-dpad-right",n=this.contentContainer[t]-this.innerWrapper[t]-e>0?m.BN.ENABLED:m.BN.DISABLED;return(0,s.h)(p.h,{appendClass:{"scroll-button":!0,"scroll-forward":!0},iconClass:i,buttonStyle:p.D.CLEAR,buttonState:n,onClick:this.onScrollForward,onMouseDown:this.onHoldScrollForward,onMouseUp:this.onScrollButtonUp})},this.setOuterWrapper=e=>this.outerWrapper=e,this.setInnerWrapper=e=>this.innerWrapper=e,this.setcontentContainer=e=>this.contentContainer=e,this.state={scrollCenter:null,scrollOffset:0,innerSize:0,contentSize:0},this.resizeSubscription=(0,u.kp)(u.g_.RESIZE,(()=>this.handleExternalChange(u.g_.RESIZE))),this.inputFilter=new h.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick})}componentDidMount(){this.resizeSubscription.renew(),this.props.thumbScrollingOnly?this.innerWrapper.addEventListener("click",this.handleClick):this.toggleDownEventListening(!0),this.toggleDragHandling(!0),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent),this.inputFilter.setEnabled(!this.props.suppressDrag),this.handleExternalChange()}componentWillUnmount(){this.resizeSubscription.cancel(),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent),this.toggleDragHandling(!1),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):this.toggleDownEventListening(!1)}componentWillReceiveProps(e){e.thumbScrollingOnly&&!this.props.thumbScrollingOnly?(this.innerWrapper.addEventListener("click",this.handleClick),this.toggleDownEventListening(!1)):!e.thumbScrollingOnly&&this.props.thumbScrollingOnly&&(this.toggleDownEventListening(!0),this.innerWrapper.removeEventListener("click",this.handleClick)),e.suppressDrag!==this.props.suppressDrag&&this.inputFilter.setEnabled(!e.suppressDrag)}componentDidUpdate(e,t){const i=this.animation;if(i)if(i.isAnimating){const e=i.getUpdatedValue();window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}else this.animation=null;t.scrollOffset!==this.state.scrollOffset&&this.props.onScrolled&&this.props.onScrolled()}toggleDownEventListening(e){const t=this.handleEvent;e?window.PointerEvent?this.innerWrapper.addEventListener("pointerdown",t):(this.innerWrapper.addEventListener("mousedown",t),this.innerWrapper.addEventListener("touchstart",t)):window.PointerEvent?this.innerWrapper.removeEventListener("pointerdown",t):(this.innerWrapper.removeEventListener("mousedown",t),this.innerWrapper.removeEventListener("touchstart",t))}toggleDragHandling(e){const t=this.handleEvent;!this.listening&&e?(this.listening=!0,window.PointerEvent?(window.addEventListener("pointermove",t),window.addEventListener("pointerup",t)):(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t))):this.listening&&!e&&(this.listening=!1,window.PointerEvent?(window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}getScrollPosition(){if(!this.innerWrapper)return 0;const e=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]}setScrollPosition(e){if(!this.innerWrapper)return;const t=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";this.innerWrapper[t]=e}getAxis(){return this.props.direction===a.Nm.vertical?"y":"x"}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}scrollToPercentage(e,t){this.animation=new c.Z({duration:t,startValue:this.getScrolledOffset(),endValue:Math.max(0,Math.min(1,e))})}scrollToElement(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;const t=this.props.direction===a.Nm.vertical;this.setState({scrollCenter:e});const i=t?"offsetTop":"offsetLeft",s=t?"offsetHeight":"offsetWidth";let n=e[i]+e[s]/2,o=e;for(;o.parentElement&&o!==this.innerWrapper;)o=o.parentElement,n+=o[i];const r=(n-this.outerWrapper.parentElement[s]/2)/this.state.contentSize;this.animation=new c.Z({duration:a.UI,startValue:this.getScrollPosition()/this.state.contentSize,endValue:Math.max(0,Math.min(1,r))})}handleExternalChange(e){if(!this.innerWrapper||!this.contentContainer)return;this.state.scrollCenter&&e&&e===u.g_.RESIZE&&this.scrollToElement(this.state.scrollCenter);const t=this.props.direction===a.Nm.vertical?"clientHeight":"clientWidth",i={innerSize:Number(this.innerWrapper&&this.innerWrapper[t])||1,contentSize:Number(this.contentContainer&&this.contentContainer[t])||1,scrollOffset:this.innerWrapper&&this.getScrollPosition()};(0,r.g)(this.state,i)&&this.setState(i)}needScrolling(){if(!this.contentContainer||!this.outerWrapper)return!1;const e=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth";return this.contentContainer[e]>this.outerWrapper[e]}render(){const{hideScrollbar:e,children:t,onScrollableChanged:i,scrollButtons:o,steps:r,onScrollPositionChange:a,direction:c,className:h}=this.props,{innerSize:d,contentSize:u,scrollOffset:p}=this.state,m=o&&!!r&&this.needScrolling();return(0,s.h)("div",{class:n("outerScrollbarWrapper",[c],[h],{"button-scrolling":m}),ref:this.setOuterWrapper},m&&this.renderScrollBackButton(),(0,s.h)("div",{class:"innerScrollbarWrapper",ref:this.setInnerWrapper},(0,s.h)("div",{class:"paddingScrollbarWrapper",ref:this.setcontentContainer},t)),(0,s.h)(l.L,{direction:c,wrapperLength:d,childLength:u,scrollOffset:p,scrollTo:this.scrollWithScrollBar,forceHidden:!!e,onVisibilityChange:i,onScrollPositionChange:a,onThumbDrag:this.onManualScroll}),m&&this.renderScrollForwardButton())}}},79830:(e,t,i)=>{"use strict";i.d(t,{h:()=>l,S:()=>a});var s=i(26605),n=i(28276),o=i(94184);let r=0;class a extends s.Component{constructor(e){super(e),this.setValue=e=>{this.setState({value:e}),this.slider&&this.slider.setValue(e)},this.getValue=()=>{const e=this.slider.getValue();return"object"==typeof e?e.value:e},this.onSliderInput=()=>{var e;this.layoutRecalculated||(null===(e=this.slider.MDComponent)||void 0===e||e.layout(),this.layoutRecalculated=!0);const t=this.getValue();this.setState({value:t}),this.props.onInput&&this.props.onInput(t)},this.onSliderChange=()=>{const e=this.getValue();this.setState({value:e}),this.props.onChange&&this.props.onChange(e)},this.getLeftOffset=()=>100*(this.state.value-this.props.min)/(this.props.max-this.props.min)+"%",this.getSliderId=()=>`slider-with-tooltip-${this.id}`,this.getStyleElement=()=>`#${this.getSliderId()} .mdc-slider__thumb-container {\n        left: ${this.getLeftOffset()}\n    }`,this.getDisplayValue=e=>{const{formatNumbers:t,units:i}=this.props;return(t?t(e):e)+(i||"")},this.setActive=e=>()=>this.setState({active:e}),this.hasChanged=()=>{this.setState({hasChanged:!1})},this.onMouseDown=e=>{this.props.onInputStart&&this.props.onInputStart()},this.onMouseUp=e=>{this.props.onInputEnd&&this.props.onInputEnd()},this.id=r++,this.state={value:void 0!==e.initialValue?e.initialValue:(e.max+e.min)/2,active:!1,hasChanged:!1},this.setActiveSlider=this.setActive(!0),this.setInactiveSlider=this.setActive(!1)}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mouseleave",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mouseleave",this.onMouseUp)}componentDidUpdate(e,t){t.value!==this.state.value&&(clearTimeout(this.hasChangedTimeout),this.setState({hasChanged:!0}),this.hasChangedTimeout=window.setTimeout(this.hasChanged,450))}render(){const{width:e,displayBounds:t,min:i,max:r,discrete:a,tooltipPosition:c}=this.props,{active:h,hasChanged:d,value:u}=this.state;return(0,s.h)("div",{id:this.getSliderId(),class:o("slider-with-tooltip",{displayBounds:t}),style:`width:${e}px`,onMouseEnter:this.setActiveSlider,onMouseLeave:this.setInactiveSlider},c===l.UP&&(0,s.h)("div",{class:o("slider-tooltip",{active:h||d}),"data-balloon":this.getDisplayValue(u),"data-balloon-pos":l.UP,style:{left:this.getLeftOffset()}}),t&&(0,s.h)("div",{class:"min-amount"},this.getDisplayValue(i)),(0,s.h)(n.ZP,{ref:e=>this.slider=e,discrete:a,min:i,max:r,value:u,onInput:this.onSliderInput,onChange:this.onSliderChange,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp}),t&&(0,s.h)("div",{class:"max-amount"},this.getDisplayValue(r)),(0,s.h)("style",{dangerouslySetInnerHTML:{__html:this.getStyleElement()}}),c===l.DOWN&&(0,s.h)("div",{class:o("slider-tooltip",{active:h||d}),"data-balloon":this.getDisplayValue(u),"data-balloon-pos":l.DOWN,style:{left:this.getLeftOffset()}}))}}var l;!function(e){e.UP="up",e.DOWN="down"}(l||(l={}))},84245:(e,t,i)=>{"use strict";i.d(t,{KQ:()=>s});const s=e=>{let t="";t+=Math.floor(e)+"'";const i=Math.floor(e%1*12);return i<10&&(t+="0"),t+=i+"''",t}},31399:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var s=i(26605),n=i(94184),o=i(35825),r=i(2116),a=i(58091),l=i(95843),c=i(21265),h=i(93273);let d=class extends s.Component{constructor(e){super(e),this.touchDevice=(0,c.Jm)(),this.handleOutsideClick=e=>{if(!this.state.editing||!this.input)return;const t=this.getTextString(this.input.value,this.props.defaultText);this.stopEditing(t,!0)},this.stopEditing=(e,t=!0)=>{this.setState({editing:!1}),t&&this.props.text!==e?(this.setState({currentText:e}),this.props.onEdited&&this.props.onEdited(e)):this.props.onCancelEditing&&this.props.onCancelEditing()},this.stopPropagation=e=>{e.stopPropagation()},this.onBlur=()=>{this.context.engine.broadcast(new h.S(this.input,!1))},this.onFocus=()=>{this.context.engine.broadcast(new h.S(this.input,!0))},this.startEditing=e=>{if(!this.input)return;e&&e.stopPropagation();const{onStartEditing:t,autoSelect:i,defaultText:s}=this.props,{currentText:n}=this.state;this.setState({editing:!0}),t&&t(),this.input.focus(),(i||s&&this.input.select&&n===s)&&this.input.select()},this.onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return;e.stopPropagation();const t=e.which||e.keyCode;if(!("keydown"===e.type&&t!==o.R.TAB||t!==o.R.RETURN&&t!==o.R.TAB||e.shiftKey)){e.preventDefault(),this.input.blur(),this.setState({editing:!1});const t=this.getTextString(e.target.value,this.props.defaultText);this.props.onEdited&&this.props.onEdited(t)}},this.onInput=e=>{const t=e.target.value;this.setState({currentText:t}),this.props.onInput&&this.props.onInput(t)},this.setRef=e=>{this.input=e},this.state={editing:!1,currentText:this.props.text}}componentDidMount(){this.input&&(this.input.addEventListener("keypress",this.stopPropagation),this.input.addEventListener("keydown",this.stopPropagation),this.input.addEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.addEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.addEventListener("blur",this.onBlur),this.input.addEventListener("focus",this.onFocus)),(this.props.editing||this.props.autofocus)&&this.startEditing())}componentWillUnmount(){this.input&&(this.input.removeEventListener("keypress",this.stopPropagation),this.input.removeEventListener("keydown",this.stopPropagation),this.input.removeEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.removeEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.removeEventListener("blur",this.onBlur),this.input.removeEventListener("focus",this.onFocus)),this.input.blur())}componentWillReceiveProps(e){if(e.editing&&!this.props.editing&&this.startEditing(),e.text!==this.props.text){const t=this.getTextString(e.text,e.defaultText);this.setState({currentText:t})}}componentDidUpdate(e,t){this.input&&(!t.editing&&this.state.editing?this.input.focus():t.editing&&!this.state.editing&&this.input.blur())}getTextString(e,t){return""===e&&void 0!==t?t:e}getCurrentText(){return this.state.currentText}focusInput(){this.input&&this.input.focus()}getFractionalCounter(){if(this.props.maxLength&&this.props.fractionalCounter)return`${this.state.currentText.length}/${this.props.maxLength}`}render(){const{editing:e,currentText:t}=this.state,{appendClass:i,hint:o,isDisabled:r,placeholder:c,noFocusedPlaceholder:h,clickToEdit:d,maxLength:u,tabIndex:p,textarea:m,readOnlyText:g,autocapitalize:f,fractionalCounter:v,showUnderline:y,className:b}=this.props,w=!(t||!c||e&&h),S=w?c:void 0,T=!1!==d?this.startEditing:void 0,E=b||"",_={inputDiv:!0,editing:e};i&&Object.keys(i).length>0&&Object.assign(_,i);const x={ref:this.setRef,class:n(_),type:"text",value:t,placeholder:S,maxLength:u,onInput:this.onInput,onClick:this.props.propagateMouseEvent?void 0:this.stopPropagation,onKeyPress:this.onKeyPress,disabled:r,readonly:this.props.readOnlyMode,onKeyDown:this.onKeyPress,tabIndex:p,autocapitalize:f},M=(0,s.h)("div",{class:"current-text",onClick:T,"data-hint":o},t||c||"");return(0,s.h)("div",{class:n("modifiable-text",`${E}`,{editing:e,"fractional-counter":v,default:!t,"has-hint":!!o,"has-placeholder":w}),"data-hint":o,"data-fractional-counter":this.getFractionalCounter()},m?(0,s.h)(a.Z,{name:"text-input",singleScrollDirection:l.Nm.vertical,forceHidden:!1},M):M,(0,s.h)(m?"textarea":"input",x),g&&(0,s.h)("div",{class:"read-only-text"},g),y&&(0,s.h)("div",{class:"editable-line"}))}};d=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],d);const u=d},47133:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var s=i(26605),n=i(2116),o=i(35825),r=i(93273);let a=class extends s.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[o.R.TAB,o.R.RETURN];if("keydown"===e.type&&!i.includes(t))return!1;const s=e.target;switch(this.props.maxLength&&s.value.length>this.props.maxLength&&e.preventDefault(),t){case o.R.TAB:case o.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur(),this.props.onDone(s.value))}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new r.S(this.input,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new r.S(this.input,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>this.input=e,this.state={currentText:e.text}}componentWillUnmount(){this.input&&this.input.blur()}componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}render(){const{placeholder:e,tabIndex:t,maxLength:i,type:n}=this.props,{currentText:o}=this.state;return(0,s.h)("div",{class:"text-box"},(0,s.h)("input",{ref:this.setRef,class:"text-input-box",type:n||"text",value:o,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,tabIndex:t}))}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a);const l=a},72822:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(26605),n=i(2116),o=i(94184),r=i(29359);let a=class extends s.Component{constructor(e,t){super(e),this.onClick=()=>{this.props.enabled&&this.props.onToggle()},this.locale={onSettingString:t.locale.t(r.Z.ON),offSettingString:t.locale.t(r.Z.OFF)};const i=Math.max(this.props.toggleTime||300);this.trackTransitionStyle=`transition: background-color ${i}ms`,this.thumbTransitionStyle=`${this.trackTransitionStyle}, left ${i}ms`}render(){const{id:e,toggled:t,enabled:i,onOffLabel:n}=this.props,r=t?this.locale.onSettingString:this.locale.offSettingString;return(0,s.h)("div",{class:o("reusable-toggle",{"toggle-on":t,enabled:i}),id:e,onClick:this.onClick},n&&(0,s.h)("span",{class:"toggle-label"},r),(0,s.h)("div",{style:this.trackTransitionStyle,class:"track"}),(0,s.h)("div",{style:this.thumbTransitionStyle,class:"thumb"}))}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.Z],a)},59984:(e,t,i)=>{"use strict";i.d(t,{N:()=>a});var s,n=i(26605),o=i(2116),r=i(94184);!function(e){e[e.OPEN=0]="OPEN",e[e.UNLOADING=1]="UNLOADING",e[e.CLOSED=2]="CLOSED"}(s||(s={}));let a=class extends n.Component{constructor(e){super(e),this.onTransitionEnd=()=>{this.state.phase===s.UNLOADING&&this.setState({phase:s.CLOSED,activeChild:null})},this.onClick=e=>{this.props.onClick&&this.props.onClick(e)},this.onPointerDown=e=>{this.props.onPointerDown&&this.props.onPointerDown(e)},this.onPointerUp=e=>{this.props.onPointerUp&&this.props.onPointerUp(e)},this.state={phase:e.open?s.OPEN:s.CLOSED,activeChild:e.selectChild&&e.childKey||null}}componentWillReceiveProps(e){const{open:t}=this.props;t&&!e.open?this.setState({phase:s.UNLOADING}):!t&&e.open&&this.setState({phase:s.OPEN,activeChild:e.selectChild&&e.childKey||null})}renderChildren(){const{children:e,selectChild:t}=this.props,{phase:i,activeChild:n}=this.state;return i===s.CLOSED||t&&!n?null:t?e&&Array.isArray(e)&&e.length&&e.find((e=>e&&e.key===n))||null:e}render(){const{id:e,appendClass:t}=this.props,{phase:i}=this.state,o={unloading:i===s.UNLOADING};return t&&Object.keys(t).length>0&&Object.assign(o,t),(0,n.h)("div",{id:e,class:r(o),onTransitionEnd:this.onTransitionEnd,onClick:this.onClick,onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp},this.renderChildren())}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([o.Z],a)},42733:(e,t,i)=>{"use strict";i.d(t,{BN:()=>n,qE:()=>o,ZJ:()=>r,zx:()=>d});var s,n,o,r,a=i(26605),l=i(2116),c=i(94184),h=i(21265);!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DECORATIVE="decorative",e.DIMMED="dimmed",e.ACTIVE="active",e.BUSY="busy"}(n||(n={})),function(e){e[e.STANDARD=0]="STANDARD",e[e.MINI=1]="MINI",e[e.SMALL=2]="SMALL",e[e.LARGE=3]="LARGE"}(o||(o={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY",e[e.OUTLINE=2]="OUTLINE",e[e.OVERLAY=3]="OVERLAY",e[e.LIGHT=4]="LIGHT",e[e.SECONDARY_LIGHT=5]="SECONDARY_LIGHT",e[e.CLEAR=6]="CLEAR",e[e.TOOLBAR=7]="TOOLBAR",e[e.PLAIN=8]="PLAIN"}(r||(r={}));let d=s=class extends a.Component{constructor(e){super(e),this.handlingClick=!1,this.mouseupTimeout=0,this.onMouseDown=e=>{if(this.handlingClick=!1,this.props.onMouseDown)this.props.onMouseDown(e);else if(s.iMobile&&this.props.onClick){const t=document.activeElement;t&&e.cancelable&&(this.handlingClick=!0,e.preventDefault(),e.stopImmediatePropagation(),t.blur(),window.addEventListener("mouseup",(t=>{this.handlingClick&&(this.handleClick(e),window.clearTimeout(this.mouseupTimeout))}),{once:!0}),this.mouseupTimeout=window.setTimeout((()=>{this.handlingClick=!1}),300))}},this.onClick=e=>{this.handlingClick||this.handleClick(e)}}handleClick(e){const{buttonState:t}=this.props,i=t===n.DISABLED,s=t===n.BUSY,o=t===n.DECORATIVE;!this.props.onClick||i||s||o?e.stopPropagation():this.props.onClick(e)}render(){const{buttonState:e,buttonSize:t,buttonStyle:i,id:s,appendClass:l,dataValue:h,children:d,onMouseEnter:u,onMouseLeave:p,tooltipMsg:m,tooltipPosition:g,tooltipPreformatted:f}=this.props,v=e===n.DISABLED,y=e===n.BUSY,b=e===n.DECORATIVE,w=i===r.SECONDARY||i===r.SECONDARY_LIGHT,S=i===r.LIGHT||i===r.SECONDARY_LIGHT,T={"button-small":t===o.SMALL,"button-large":t===o.LARGE,"button-mini":t===o.MINI,"button-secondary":w,"button-outline":i===r.OUTLINE,"button-light":S,"button-primary":i===r.PRIMARY,"button-overlay":i===r.OVERLAY,"button-clear":i===r.CLEAR,"button-plain":i===r.PLAIN,"button-toolbar":i===r.TOOLBAR,"button-active":e===n.ACTIVE,"button-dimmed":e===n.DIMMED,"button-busy":y,"button-disabled":v,"button-decorative":b};return l&&Object.keys(l).length>0&&Object.assign(T,l),(0,a.h)("div",{id:s,type:"button",class:c("button",T),"data-value":h,onClick:this.onClick,onMouseEnter:u,onMouseLeave:p,onMouseDown:this.onMouseDown,"data-balloon":m||null,"data-balloon-pre":!!f,"data-balloon-pos":g||null},d)}};d.iMobile=(0,h.s)()||(0,h._1)(),d=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([l.Z],d)},14071:(e,t,i)=>{"use strict";i.d(t,{A:()=>l,P:()=>c});var s=i(26605),n=i(80429),o=i(26265),r=i(29359);const{CLOSE_BUTTON_TOOLTIP_MESSAGE:a}=r.Z.REUSABLES;var l;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.LIGHT=1]="LIGHT",e[e.SHADOW=2]="SHADOW",e[e.OVERLAY=3]="OVERLAY",e[e.TOOLBAR=4]="TOOLBAR"}(l||(l={}));class c extends s.Component{constructor(e){super(e)}getIconButtonStyle(){switch(this.props.buttonStyle){case l.LIGHT:case l.SHADOW:return n.D.CLEAR;case l.OVERLAY:return n.D.OVERLAY;case l.TOOLBAR:return n.D.TOOLBAR;default:return n.D.PLAIN}}render(){const{locale:e}=this.context,{buttonStyle:t,onClose:i,hideTooltip:r}=this.props,c=r?void 0:e.t(a);return(0,s.h)(n.h,{appendClass:{"close-button":!0,"close-button-shadow":t===l.SHADOW,"close-button-light":t===l.LIGHT},iconClass:"icon-close",buttonStyle:this.getIconButtonStyle(),tooltipMsg:c,tooltipPosition:o.lZ.DOWN,onClick:i})}}},58091:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var s=i(26605),n=i(95843),o=i(85768),r=i(20072),a=i(1481),l=i(67538),c=i(1799),h=i(94184),d=i(10396);s.options.debounceRendering=requestAnimationFrame;class u extends s.Component{constructor(e){super(e),this.horizontal=(0,n.Sv)(),this.vertical=(0,n.Sv)(),this.manuallyMoved=!1,this.scrollPosition={horizontal:n.Ij.Beginning,vertical:n.Ij.End},this.handleEvent=e=>{this.inputFilter.handleEvent(e)},this.getScrollableContainer=()=>this.innerWrapper,this.getScrolledOffset=e=>{const t=n.uG[e].scrollOffset;return this.innerWrapper[t]/this.state[e].childLength},this.state={horizontal:(0,n.cL)(),vertical:(0,n.cL)()},this.resizeSubscription=(0,d.kp)(d.g_.RESIZE,(()=>this.handleExternalChange(d.g_.RESIZE))),this.scrollTo=this.scrollTo.bind(this),this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this),this.handleDragStart=this.handleDragStart.bind(this),this.handleWheelEvent=this.handleWheelEvent.bind(this),this.handleClick=this.handleClick.bind(this),this.toggleVisibility=this.toggleVisibility.bind(this),this.hasManuallyMoved=this.hasManuallyMoved.bind(this),this.inputFilter=new l.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick});const t=this.handleEvent;window.PointerEvent||(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t)),window.addEventListener("pointermove",t),window.addEventListener("pointerup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t)}componentDidMount(){if(this.resizeSubscription.renew(),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly)this.innerWrapper.addEventListener("click",this.handleClick);else{const e=this.handleEvent;this.innerWrapper.addEventListener("mousedown",e),this.innerWrapper.addEventListener("pointerdown",e),this.innerWrapper.addEventListener("touchstart",e)}this.firstChild=this.innerWrapper.firstElementChild,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(),this.props.hasOwnProperty("suppressDrag")&&this.inputFilter.setEnabled(!!this.props.suppressDrag)}componentWillUnmount(){const e=this.handleEvent;this.resizeSubscription.cancel(),window.PointerEvent||(window.removeEventListener("mousemove",e),window.removeEventListener("mouseleave",e),window.removeEventListener("mouseup",e)),window.removeEventListener("pointermove",e),window.removeEventListener("touchmove",e),window.removeEventListener("pointerup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):(this.innerWrapper.removeEventListener("mousedown",e),this.innerWrapper.removeEventListener("pointerdown",e),this.innerWrapper.removeEventListener("touchstart",e))}componentWillReceiveProps(e){e.suppressDrag!==this.props.suppressDrag&&(this.inputFilter.setEnabled(!!this.props.suppressDrag),this.props.suppressDrag&&(this.manuallyMoved=!1))}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}componentDidUpdate(){if(!this.horizontal.animation&&!this.vertical.animation)return;const e={};for(const t in this.state){const i=t;this[i].animation&&(this[i].animation.isAnimating?e[(0,n.O1)(i)]=this[i].animation.getUpdatedValue():this[i].animation=null)}Object.keys(e).length>0&&window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}scrollTo(e){if(!e.hasOwnProperty(n.RD.x)&&!e.hasOwnProperty(n.RD.y))return;const t={};for(const i of this.getVisibleAxes(e)){const s=(0,n.UC)(i),o=n.uG[s].scrollOffset,r=e[i];if(void 0!==r){if(isNaN(r))return;this.innerWrapper[o]=Math.max(Math.min(1,r)*this.state[s].childLength,0),t[s]=Object.assign(Object.assign({},this.state[s]),{scrollOffset:this.innerWrapper[o]})}}this.setState(t)}animatedScrollTo(e,t){if(e.hasOwnProperty(n.RD.x)||e.hasOwnProperty(n.RD.y))for(const i of this.getVisibleAxes(e)){const s=(0,n.UC)(i),o=n.uG[s].scrollOffset;this[s].animation=new a.Z({duration:t||n.UI,startValue:this.innerWrapper[o]/this.state[s].childLength,endValue:Math.max(0,Math.min(1,e[i]))})}}setScrollCenter(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;this.scrollCenter=e;const t={},i={};for(const s of this.getVisibleAxes(this.state)){const o=(0,n.O1)(s);t[o]=e[n.uG[s].positionOffset]+e[n.uG[s].offsetLength]/2;let r=e;for(;r.parentElement&&r!==this.innerWrapper;)r=r.parentElement,t[o]+=r[n.uG[s].positionOffset];const a=this.outerWrapper.parentElement[n.uG[s].offsetLength];i[o]=(t[o]-a/2)/this.state[s].childLength}Object.keys(i).length>0&&this.animatedScrollTo(i)}getVisibleAxes(e){const t=[];for(const i in e)(e[i]||"number"==typeof e[i])&&(i in n.RD&&this.state[(0,n.UC)(i)].isVisible||i in n.Nm&&this.state[i].isVisible)&&t.push(i);return t}handleDragStart(){delete this.scrollCenter,this.hasManuallyMoved()}handlePressStart(){this.horizontal.dragStartScroll=this.innerWrapper.scrollLeft,this.vertical.dragStartScroll=this.innerWrapper.scrollTop}handlePressMove(e){const t={};for(const i of this.getVisibleAxes(e)){const s=(0,n.UC)(i);t[i]=(e[i]+this[s].dragStartScroll)/this.state[s].childLength}this.scrollTo(t)}handleWheelEvent(e){this.props.singleScrollDirection===n.Nm.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.hasManuallyMoved(),this.handleExternalChange())}handleClick(e){this.props.handleClick&&this.props.handleClick(e)}toggleVisibility(e){return t=>{const i=Object.assign(Object.assign({},this.state[e]),{isVisible:t});if((0,r.g)(this.state[e],i)){const t={};t[e]=i,this.setState(t),this.props.onScrollbarVisibilityChange&&this.props.onScrollbarVisibilityChange()}}}toggleScrollPosition(e){return t=>{this.scrollPosition[e]=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)}}handleDragEnd(e,t){for(const i of this.getVisibleAxes(e)){const s=(0,n.UC)(i),o=e[i]/t,r=Math.min(n.UI,Math.abs(n.UI*o)),l=this.innerWrapper[n.uG[s].scrollOffset],h=o*r/2;this[s].animation=new a.Z({duration:r,startValue:l/this.state[s].childLength,endValue:Math.max(0,Math.min((l+h)/this.state[s].childLength,1)),easingFunction:c.hl})}this.setState({})}handleExternalChange(e){this.scrollCenter&&e&&e===d.g_.RESIZE&&this.setScrollCenter(this.scrollCenter);const t={};for(const e in this.state){const i=e,s=n.uG[i].clientLength,o=Object.assign(Object.assign({},this.state[i]),{wrapperLength:Number(this.innerWrapper&&this.innerWrapper[s])||1,childLength:Number(this.firstChild&&this.firstChild[s])||1,scrollOffset:this.innerWrapper&&this.innerWrapper[n.uG[i].scrollOffset]});(0,r.g)(this.state[i],o)&&(t[i]=o)}Object.keys(t).length>0&&this.setState(t)}hasManuallyMoved(){this.manuallyMoved=!0,this.props.onScrolled&&this.props.onScrolled()}resetManuallyMoved(){this.manuallyMoved=!1}render(){const{scrollbarHeight:e,singleScrollDirection:t,name:i,children:r,forceHidden:a}=this.props,l={"max-height":e||""},c=t?`${t}Only`:"dual-scroll";return(0,s.h)("div",{class:h("outerScrollbarWrapper",c,`scrollbar-${i}`),ref:e=>{this.outerWrapper=e},style:l},(0,s.h)("div",{class:"innerScrollbarWrapper",ref:e=>{this.innerWrapper=e}},(0,s.h)("div",{class:"paddingScrollbarWrapper"},r)),t!==n.Nm.vertical&&(0,s.h)(o.L,{direction:n.Nm.horizontal,ref:e=>{this.horizontal.scrollbar=e},wrapperLength:this.state.horizontal.wrapperLength,childLength:this.state.horizontal.childLength,scrollOffset:this.state.horizontal.scrollOffset,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(n.Nm.horizontal),onScrollPositionChange:this.toggleScrollPosition(n.Nm.horizontal),forceHidden:a,onThumbDrag:this.hasManuallyMoved}),t!==n.Nm.horizontal&&(0,s.h)(o.L,{direction:n.Nm.vertical,ref:e=>{this.vertical.scrollbar=e},wrapperLength:this.state.vertical.wrapperLength,childLength:this.state.vertical.childLength,scrollOffset:this.state.vertical.scrollOffset,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(n.Nm.vertical),onScrollPositionChange:this.toggleScrollPosition(n.Nm.vertical),forceHidden:a,onThumbDrag:this.hasManuallyMoved}))}}},95843:(e,t,i)=>{"use strict";i.d(t,{UI:()=>s,cL:()=>n,Sv:()=>o,Nm:()=>r,RD:()=>a,O1:()=>l,UC:()=>c,uG:()=>h,Ij:()=>d,w5:()=>u});const s=250,n=()=>({wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1}),o=()=>({scrollbar:null,animation:null,dragStartScroll:0});var r,a;!function(e){e.horizontal="horizontal",e.vertical="vertical"}(r||(r={})),function(e){e.x="x",e.y="y"}(a||(a={}));const l=e=>{switch(e){case r.horizontal:return a.x;case r.vertical:return a.y}throw Error()},c=e=>{switch(e){case a.x:return r.horizontal;case a.y:return r.vertical}throw Error()},h={[r.horizontal]:{scrollOffset:"scrollLeft",offsetLength:"offsetWidth",clientLength:"clientWidth",positionOffset:"offsetLeft",lengthName:"width",offsetName:"left",eventPosition:"clientX",delta:a.x},[r.vertical]:{scrollOffset:"scrollTop",offsetLength:"offsetHeight",clientLength:"clientHeight",positionOffset:"offsetTop",lengthName:"height",offsetName:"top",eventPosition:"clientY",delta:a.y}};var d;!function(e){e.Beginning="Beginning",e.Middle="Middle",e.End="End",e.None="None"}(d||(d={}));const u=(e,t)=>t?e<.01?d.Beginning:1-e<.01?d.End:d.Middle:d.None},85768:(e,t,i)=>{"use strict";i.d(t,{L:()=>a});var s=i(26605),n=i(20072),o=i(67538),r=i(95843);class a extends s.Component{constructor(e){super(e),this.state={visible:!1,trackLength:1,thumbLength:1,thumbOffset:0},this.direction=r.uG[e.direction],this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleTrackClick=this.handleTrackClick.bind(this),this.inputFilter=new o.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove}),window.PointerEvent||(window.addEventListener("mousemove",this.inputFilter.handleEvent),window.addEventListener("mouseleave",this.inputFilter.handleEvent),window.addEventListener("mouseup",this.inputFilter.handleEvent)),window.addEventListener("pointermove",this.inputFilter.handleEvent),window.addEventListener("pointerup",this.inputFilter.handleEvent)}componentWillUnmount(){window.PointerEvent||(window.removeEventListener("mousemove",this.inputFilter.handleEvent),window.removeEventListener("mouseleave",this.inputFilter.handleEvent),window.removeEventListener("mouseup",this.inputFilter.handleEvent)),window.removeEventListener("pointermove",this.inputFilter.handleEvent),window.removeEventListener("pointerup",this.inputFilter.handleEvent)}getTrackLength(){return Number(this.thumbTrack&&this.thumbTrack[this.direction.clientLength]||window.innerWidth)}handleTrackClick(e){if(e.target!==this.thumbTrack)return;const t=this.direction.eventPosition,i=this.thumbTrack.getBoundingClientRect()[this.direction.offsetName],s=e[t]<i+this.state.thumbOffset,n=this.getTrackLength();let o=0;o=s?Math.max(0,(this.state.thumbOffset-this.state.thumbLength)/n):Math.min(n,(this.state.thumbOffset+this.state.thumbLength)/n),this.props.scrollTo({[(0,r.O1)(this.props.direction)]:o})}handlePressStart(e){this.dragStartThumbOffset=this.state.thumbOffset}handlePressMove(e){const t=this.getTrackLength(),i=(this.dragStartThumbOffset-e[this.direction.delta])/t;this.props.scrollTo({[(0,r.O1)(this.props.direction)]:i}),this.props.onThumbDrag&&this.props.onThumbDrag()}componentDidUpdate(){const{wrapperLength:e,childLength:t,scrollOffset:i}=this.props;if(e>0&&t>0){const s=this.getTrackLength(),o=e/t*s,a={thumbLength:o,visible:t>e,thumbOffset:Math.min(i/t*s,s-o)};if((0,n.g)(this.state,a)){const e=this.state.visible!==a.visible;e&&this.props.onVisibilityChange&&this.props.onVisibilityChange(a.visible);const t=(0,r.w5)(a.thumbOffset/(s-o),a.visible);(t!==this.scrollPosition||e)&&(this.scrollPosition=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)),this.setState(a)}}}render(){const e={[`${this.direction.lengthName}`]:this.state.thumbLength+"px",[`${this.direction.offsetName}`]:this.state.thumbOffset+"px"},t=this.inputFilter.handleEvent,i=window.PointerEvent,n=i?t:void 0,o=i?void 0:t,r=i?void 0:t;return(0,s.h)("div",null,this.state.visible&&!this.props.forceHidden&&(0,s.h)("div",{class:"scrollbarTrack "+this.props.direction,onClick:this.handleTrackClick,ref:e=>{this.thumbTrack=e}},(0,s.h)("div",{class:"scrollbarThumb",style:e,onPointerDown:n,onMouseDown:r,onTouchStart:o})))}}},53189:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var s=i(26605),n=i(2116),o=i(93273),r=i(71313);let a=class extends s.Component{constructor(e){super(e),this.editing=!1,this.stopPropagation=e=>e.stopPropagation(),this.onPaste=e=>{if(!e.clipboardData)return;const{maxLength:t}=this.props,i=e.clipboardData.getData("text/plain");let s=i.length;const n=this.textElement.innerText,o=window.getSelection();if(o&&t&&n&&n.length+s>t){const e=t-n.length+o.toString().length;s=Math.min(e,s)}document.execCommand("insertText",!1,i.slice(0,s)),e.preventDefault()},this.onMouseDown=e=>{const{onClick:t,clickToEdit:i}=this.props;(this.editing||i)&&t&&(e.stopPropagation(),t(e),this.editing||this.toggleEditing(!0))},this.onInput=()=>{if(this.props.onInput){const e=this.textElement.innerText;this.props.onInput(e)}},this.onFocus=e=>{this.context.messageBus.broadcast(new o.S(this.textElement,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new o.S(this.textElement,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>{this.textElement=e}}componentDidMount(){this.replaceTextContent(this.props.text)}componentWillUnmount(){this.textElement&&this.textElement.blur()}componentDidUpdate(e){this.props.text!==e.text&&this.replaceTextContent(this.props.text)}shouldComponentUpdate(){return!1}getTextElement(){return this.textElement}focus(){this.editing&&this.textElement.focus()}toggleEditing(e){this.textElement&&(this.editing!==e&&(this.editing=e,this.textElement.contentEditable=e?"true":"false",e?this.textElement.classList.add("editing"):this.textElement.classList.remove("editing")),e?this.textElement.focus():this.textElement.blur())}replaceTextContent(e){if(!this.textElement)return;const{hashtags:t,userMentions:i,onClickAnchor:s,activeLinks:n}=this.props;for(;this.textElement.firstChild;)this.textElement.removeChild(this.textElement.firstChild);r.v.deserialize(e,!!n,!!t,i?this.context.users:void 0,s).forEach((e=>{this.textElement.appendChild(e)})),this.focus()}render(){const{placeholder:e,tabIndex:t,onKeyPress:i}=this.props;return(0,s.h)("div",{ref:this.setRef,class:"text-box-text",role:"textbox",draggable:!1,spellcheck:!0,contentEditable:!1,placeholder:e,onMouseDown:this.onMouseDown,onKeyDown:i,onKeyUp:this.stopPropagation,onKeyPress:i,onFocus:this.onFocus,onBlur:this.onBlur,onInput:this.onInput,onPaste:this.onPaste,tabIndex:t})}};a=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([n.A],a);const l=a},71313:(e,t,i)=>{"use strict";i.d(t,{o:()=>s,v:()=>o});var s,n=i(74674);!function(e){e.TEXT="",e.LINK="link-url",e.HASH="link-hashtag",e.USER="link-user"}(s||(s={}));class o{static parse(e,t,i){const s=[];if(!e)return[];const n=e.split("[").map(((e,t)=>0===t?e:"["+e));let r=0;for(;r<n.length;){const e=o.parseIntoBlocks(n[r],s,t,i);e&&n.splice(r+1,0,e),r++}return s}static parseIntoBlocks(e,t,i,s){const n=o.getLinkBlock(e);if(n&&n.value){if(-1===n.value.indexOf("javascript:"))return t.push(n),e.slice(n.markdown.length)}else{const n=o.getSpecialBlock(e,i,s);if(n)return t.push(n),e.slice(n.markdown.length);{const i=o.getTextBlock(e);i&&t.push(i)}}return null}static getTextBlock(e){return 0===e.length?null:{blockType:n.C.TEXT,text:e,markdown:e}}static getSpecialBlock(e,t,i){if(t){const t=o.getHashBlock(e);if(t)return t}if(i){const t=o.getUserBlock(e,i);if(t)return t}return null}static getHashBlock(e){let t=null;const i=e.match(o.hashRegex);return i&&(t=i[0]),null===t?null:{blockType:n.C.HASH,markdown:`[${t}]`,text:t}}static getUserBlock(e,t){const i=e.match(o.userRegex);let s=null;if(i&&(s=i[0]),null===s)return null;const r=s.substr(1),a=t.getUserInfo(r);return a?{blockType:i?n.C.USER:n.C.HASH,markdown:`[${s}]`,value:s.substr(1),text:`@${a.name}`}:null}static getLinkBlock(e){const t=e.match(/\[([^\]]*)\]\((.*)\)/);if(!t)return null;const i=t[2];let s=1,r=0;for(;r<i.length&&("("===i[r]?s++:")"===i[r]&&s--,0!==s);)r++;const a=i.length-r;let l=o.conditionallyEncode(t[2].substring(0,r));return-1===l.indexOf("://")&&(l="http://"+l),{blockType:n.C.LINK,markdown:t[0].substring(0,t[0].length-a),text:t[1],value:l}}static conditionallyEncode(e){return o.needsEncoding(e)?encodeURI(e):e}static needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}}o.userRegex=/(@\w*)/gi,o.hashRegex=/(#\w*)/gi,o.serialize=(e,t=!1)=>{let i="";const s=[].slice.call(e.childNodes);for(const e of s)switch(e.nodeName){case"#text":i+=o.serializeText(e,t);break;case"A":i+=o.serializeAnchor(e);break;case"P":case"DIV":i+=o.serializeElement(e,!0);break;case"SPAN":i+=o.serializeElement(e,!1);break;case"BR":i+=o.serializeBreak(e);break;default:i+=o.serialize(e)}return i},o.deserialize=(e,t,i,r,a)=>{const l=o.parse(e,i,r),c=[];for(const e of l)switch(e.blockType){case n.C.TEXT:const i=document.createTextNode(""+e.text);c.push(i);break;case n.C.USER:const o=document.createElement(a?"a":"span");if(o.setAttribute("data-blocktype",e.blockType),a){const t=o;t.className=`link-annotation ${s.USER}`,t.contentEditable="false",t.removeAttribute("href"),t.onclick=a,e.value&&t.setAttribute("data-value",e.value)}o.textContent=`${e.text}`,c.push(o);break;case n.C.HASH:const r=document.createElement(a?"a":"span");if(r.setAttribute("data-blocktype",e.blockType),a){const e=r;e.className=`link-annotation ${s.HASH}`,e.contentEditable="false",e.removeAttribute("href"),e.onclick=a}r.textContent=`${e.text}`,c.push(r);break;case n.C.LINK:if(e.value){const i=t||!!a,n=document.createElement(i?"a":"span");if(n.setAttribute("data-blocktype",e.blockType),i){const t=n;t.href=`${e.value}`,t.target="_blank",t.className=`link-annotation ${s.LINK}`,t.contentEditable="false",a&&(t.onclick=a)}n.textContent=`${e.text}`,c.push(n)}}return c},o.serializeText=(e,t)=>{let i=(e.textContent||"").replace(/\]\(/g,"]&zwnj;(");const s=new RegExp(/https?:\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?/gi);return i=i.replace(s,(e=>`[${e}](${e})`)),t&&(i=i.replace(o.hashRegex,(e=>`[${e}]`))),i.replace(/\<\s*br\s*\/?>/gi,"\n")},o.serializeAnchor=e=>{const t=e.dataset.blocktype;let i=e.innerText;switch(t){case n.C.HASH:i=`[${e.innerText}]`;break;case n.C.USER:const t=e.dataset.value;t&&(i=`[@${t}]`);break;case n.C.LINK:default:i=`[${e.innerText}](${e.href})`}return i},o.serializeElement=(e,t)=>{let i=t?"\n":" ";return e.childNodes.length>0&&(i+=o.serialize(e)),i},o.serializeBreak=e=>"\n"},86134:(e,t,i)=>{"use strict";i.d(t,{x:()=>n,u:()=>c});var s,n,o=i(26605),r=i(2116),a=i(94184),l=i(14071);!function(e){e.NONE="no-arrow",e.TOP_LEFT="position-top-left",e.TOP_RIGHT="position-top-right",e.TOP_CENTER="position-top-center",e.BOTTOM_RIGHT="position-bottom-right",e.BOTTOM_LEFT="position-bottom-left",e.BOTTOM_CENTER="position-bottom-center",e.RIGHT_BOTTOM="position-right-bottom"}(n||(n={}));let c=s=class extends o.Component{constructor(e){super(e),this.closeTooltip=()=>{this.setState({showing:!1}),window.removeEventListener("click",this.handleOutsideClick)},this.timeoutTooltip=()=>{this.closeTooltip(),this.props.onTimeout&&this.props.onTimeout()},this.openTooltip=e=>{this.setState({showing:!0}),window.addEventListener("click",this.handleOutsideClick),void 0!==e&&window.setTimeout(this.timeoutTooltip,e)},this.getContentPosition=()=>{if(!this.tooltipWrapper)return{};const e=this.tooltipWrapper.parentElement;switch(this.props.arrowPos){case n.BOTTOM_RIGHT:return{transform:`translate(${32-this.tooltipContent.offsetWidth}px, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-15}px)`};case n.BOTTOM_LEFT:return{transform:`translate(0, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-35}px)`};case n.RIGHT_BOTTOM:return{transform:`translate(${-this.tooltipContent.offsetWidth-7}px, ${9-this.tooltipContent.offsetHeight}px)`};default:return{}}},this.handleOutsideClick=e=>{this.props.onClose&&this.props.onClose(e)},this.state={showing:e.open};const t=s.count++;this.wrapperId=`tooltip-wrapper-${e.name||t}`,this.id=`${e.tooltipId||`tooltip-${t}`}`}static clearCount(){this.count=0}componentDidMount(){this.props.open&&this.openTooltip(this.props.maxMsOpen)}componentWillUnmount(){this.state.showing&&this.closeTooltip()}componentWillReceiveProps(e){e.open&&!this.props.open?this.openTooltip(e.maxMsOpen):!e.open&&this.props.open&&this.closeTooltip()}render(){const{arrowPos:e,title:t,message:i,onClose:s,closeButton:r,darkTheme:c,appendHTML:h,appendBodyClass:d,appendClass:u}=this.props,{showing:p}=this.state,m={emulatedDialog:!0,open:p,dark:c,[void 0===e?n.TOP_CENTER:e]:!0};return u&&Object.keys(u).length>0&&Object.assign(m,u),(0,o.h)("div",{id:this.wrapperId,class:a(m),ref:e=>this.tooltipWrapper=e},(0,o.h)("div",{id:this.id,class:a("tooltip",d),style:this.getContentPosition(),ref:e=>this.tooltipContent=e},t&&(0,o.h)("div",{class:"title"},t),r&&s&&(0,o.h)(l.P,{onClose:s}),i,h))}};c.POPUP_OFFSET=28,c.count=0,c=s=function(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r}([r.Z],c)},29677:(e,t,i)=>{"use strict";i.d(t,{O8:()=>s,OR:()=>n,LH:()=>o,El:()=>r});const s=500,n=()=>window.innerWidth>768,o=375,r=750},1481:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(1799);class n{constructor(e){this.isAnimating=!0,this.duration=e.duration,this.startValue=e.startValue,this.changeValue=e.endValue-this.startValue,this.easingFunction=e.easingFunction||s.to}getUpdatedValue(){this.startTime||(this.startTime=Date.now());const e=Date.now()-this.startTime;return e>this.duration&&(this.isAnimating=!1),this.easingFunction(Math.min(e,this.duration),this.startValue,this.changeValue,this.duration)}}},20072:(e,t,i)=>{"use strict";i.d(t,{g:()=>s});const s=(e,t)=>{for(const i in t)if(e[i]!==t[i])return!0;return!1}},67538:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(3159),n=i(41397);class o{constructor(e){this.couldBeDrag=!1,this.isDragging=!1,this.shouldHandleEvents=!0,this.handleEvent=e=>{if(this.shouldHandleEvents)switch(e.stopPropagation(),e.type){case"mousedown":case"touchstart":case"pointerdown":this.onPressStart(e);break;case"mousemove":case"pointermove":case"touchmove":this.onPressMove(e);break;case"mouseup":case"pointerup":case"mouseleave":case"touchend":case"touchcancel":case"pointercancel":case"pointerleave":this.onPressEnd(e)}},this.callbacks=e}setEnabled(e){this.shouldHandleEvents=e,this.couldBeDrag=this.couldBeDrag&&e}getPosition(e){return(0,s.z6)(e)?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}}onPressStart(e){this.couldBeDrag=!0,this.dragEvents=[],this.dragStart=this.getPosition(e),this.callbacks.handlePressStart&&this.callbacks.handlePressStart(this.getPosition(e))}onPressMove(e){if(!this.couldBeDrag)return;const t=this.getPosition(e);this.addDragEvent(t),this.isDragging||Math.sqrt(Math.pow(t.x-this.dragStart.x,2)+Math.pow(t.y-this.dragStart.y,2))>n.JU&&(this.isDragging=!0,this.callbacks.handleDragStart&&this.callbacks.handleDragStart()),this.callbacks.handlePressMove&&this.callbacks.handlePressMove({x:this.dragStart.x-t.x,y:this.dragStart.y-t.y})}onPressEnd(e){if(this.couldBeDrag){if(this.couldBeDrag=!1,this.isDragging){if(!this.dragEvents||!this.dragEvents[0])return;const e=this.dragEvents[0],t=this.dragEvents[this.dragEvents.length-1];if(this.callbacks.handleDragEnd){const i={x:0,y:0};Date.now()-t.timestamp<o.dragMoveTimeout&&(i.x=e.position.x-t.position.x,i.y=e.position.y-t.position.y),this.callbacks.handleDragEnd(i,t.timestamp-e.timestamp)}}else this.callbacks.handleClick&&this.callbacks.handleClick(e);this.isDragging=!1}}addDragEvent(e){this.dragEvents.push({position:e,timestamp:Date.now()}),this.dragEvents.length>10&&this.dragEvents.shift()}}o.dragMoveTimeout=100},84952:(e,t,i)=>{"use strict";i.d(t,{w:()=>s});const s=e=>e.innerWidth<487||e.innerHeight<487},98867:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});var s=new RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");const n=e=>(e=>s.test(e))(e)&&/^https?:\/\//.test(e)},73706:(e,t,i)=>{"use strict";i.d(t,{z:()=>n,A:()=>o});var s=i(86480);class n extends s.G{constructor(){super(...arguments),this.type="hover"}}class o extends s.G{constructor(){super(...arguments),this.type="unhover"}}},86480:(e,t,i)=>{"use strict";i.d(t,{G:()=>s});class s{constructor(){this.eventType="input"}}},75158:(e,t,i)=>{"use strict";i.d(t,{T:()=>n,R:()=>o});var s=i(24946);class n extends s.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class o extends s.C{constructor(e,t){super(),this.position=e,this.button=t}}},21588:(e,t,i)=>{"use strict";i.d(t,{E0:()=>n,_t:()=>o,_R:()=>r,u4:()=>a,Zv:()=>l});var s=i(24946);class n extends s.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class o extends s.C{constructor(e,t,i,s){super(),this.position=e,this.clientPosition=s,this.delta=t,this.buttons=i}}class r extends s.C{constructor(e,t,i,s,n){super(),this.position=e,this.delta=t,this.buttons=i,this.timeSinceLastMove=s,this.fullDelta=n}}class a extends s.C{constructor(e,t){super(),this.position=e,this.pointer=t}}class l extends s.C{constructor(e,t){super(),this.position=e,this.fullDelta=t}}},24946:(e,t,i)=>{"use strict";i.d(t,{C:()=>n});var s=i(86480);class n extends s.G{}},35056:(e,t,i)=>{"use strict";i.d(t,{DG:()=>n,PC:()=>o,Vh:()=>r,$b:()=>a,pt:()=>l});var s=i(24946);class n extends s.C{constructor(e,t,i,s){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=s}}class o extends s.C{constructor(e,t,i,s,n){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=s,this.progress=n}}class r extends s.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.buttons=i}}class a extends s.C{constructor(e,t){super(),this.position=e,this.clientPosition=t}}class l extends s.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.cancelled=i}}},93735:(e,t,i)=>{"use strict";i.d(t,{G:()=>n,i:()=>o});var s=i(24946);class n extends s.C{constructor(e){super(),this.pinchDelta=e}}class o extends s.C{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},25259:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});var s=i(24946);class n extends s.C{constructor(e){super(),this.pointers=e}}},22079:(e,t,i)=>{"use strict";i.d(t,{D:()=>n,u:()=>o});var s=i(24946);class n extends s.C{constructor(e){super(),this.rotateDelta=e}}class o extends s.C{constructor(e,t){super(),this.rotateDelta=e,this.timeSinceLastMove=t}}},30604:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var s=i(24946);class n extends s.C{constructor(e,t){super(),this.position=e,this.delta=t}}},30963:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>$});var s=i(54122),n=i(41307),o=i(3159),r=i(40582),a=i(36073),l=i(35175),c=i(62367),h=i(21265);class d{constructor(e,t,i,s){if(this.config=e,this.canvasData=i,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.activeButtons=r.r3.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=d.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=s,window.PointerEvent||(t.addEventListener("mousedown",(e=>this.onMouseDown(e))),t.addEventListener("mouseup",(e=>this.onMouseUp(e))),t.addEventListener("mousemove",(e=>this.onMouseMove(e))),t.addEventListener("mouseenter",(e=>this.onMouseEnter(e)))),t.addEventListener("contextmenu",(e=>e.preventDefault())),t.addEventListener("touchstart",(e=>this.onTouchStart(e))),t.addEventListener("touchend",(e=>this.onTouchEnd(e))),t.addEventListener("touchmove",(e=>this.onTouchMove(e))),t.addEventListener("touchcancel",(e=>this.onTouchEnd(e))),t.addEventListener("pointerdown",(e=>this.onPointerDown(e))),t.addEventListener("pointerup",(e=>this.onPointerUp(e))),t.addEventListener("pointermove",(e=>this.onPointerMove(e))),t.addEventListener("pointercancel",(e=>this.onPointerUp(e))),t.addEventListener("pointerenter",(e=>this.onMouseEnter(e))),(0,h.s)()||(0,h._1)()){const e=!!l.h&&{passive:!1};document.addEventListener("touchmove",this.preventMultiTouchGesture,e),document.addEventListener("touchend",this.preventDoubleTap,e)}}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e),this.activeButtons|=1<<e.button;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!0,a._A.MOUSE))}onMouseUp(e){this.tryPreventDefault(e),this.activeButtons&=~(1<<e.button);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!1,a._A.MOUSE))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(this.getPointerId(e),t,i,this.activeButtons,a._A.MOUSE))}onMouseEnter(e){const t=(0,c.lY)(e.buttons,r.MP.MIDDLE,r.MP.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=r.MP.PRIMARY;t<r.MP.COUNT;++t){const s=(0,r.AF)(t);if(s&&(i&s)>0){const{ndc:i,client:s}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),i,s,t,!1,a._A.MOUSE))}}this.activeButtons=t}onTouchStart(e){if(e.currentTarget.focus(),e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:s,client:n}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,s,n,r.MP.PRIMARY,!0,a._A.TOUCH))}}onTouchEnd(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:s,client:n}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,s,n,r.MP.PRIMARY,!1,a._A.TOUCH))}}onTouchMove(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:s,client:n}=this.getTouchPosition(i),o=new a.mE(i.identifier,s,n,r.r3.PRIMARY,a._A.TOUCH);this.onEventCallback(o)}}onPointerDown(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseDown(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,r.MP.PRIMARY,!0,e.pointerType))}}onPointerUp(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseUp(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,r.MP.PRIMARY,!1,e.pointerType))}}onPointerMove(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(e.pointerId,t,i,r.r3.PRIMARY,e.pointerType))}}getPointerId(e){return(0,o.bX)(e)?e.pointerId:0}getPointerPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}getTouchPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}normalizePosition(e,t){return{x:2*(e-this.canvasData.x)/this.canvasData.width-1,y:-2*(t-this.canvasData.y)/this.canvasData.height+1}}tryPreventDefault(e){this.config.pointerPreventDefault&&e.cancelable&&e.preventDefault()}}d.doubleTapThreshold=300;var u,p=i(35825),m=i(22767),g=i(78626);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(u||(u={}));class f{constructor(e){this.keysDown={},this.onEventCallback=e,this.bindHandlers()}bindHandlers(){if(window&&window.document){const e=window.document;window.addEventListener("blur",(()=>{Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),e.addEventListener("keydown",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new g.e(t,m.M.DOWN,e))}})),e.addEventListener("keyup",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]&&this.onEventCallback(new g.e(t,m.M.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new g.e(t,m.M.UP,e))}}))}}translateFirefoxKeys(e){switch(e){case u.SEMICOLON:return p.R.SEMICOLON;case u.PLUSEQUALS:return p.R.PLUSEQUALS;case u.DASHUNDERSCORE:return p.R.DASHUNDERSCORE}return e}}var v,y=i(32818),b=i(2212);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(v||(v={}));var w=i(75158);class S{constructor(e=.04,t=300){this.startPosition=new b.FM8,this.pointerDelta=new b.FM8,this.activeButtons=r.r3.NONE,this.state=v.WAITING,this.dragLimit=e,this.holdLimit=t}start(e){if(this.state===v.WAITING&&this.startPosition.copy(e.position),0==(e.buttons&e.buttons-1))this.startTime=Date.now(),this.activeButtons=e.buttons,this.state=v.WAITINGTOEXCEEDTHRESHOLD;else if(this.activeButtons)return this.state=v.GESTURING,new w.T(e.position,this.activeButtons)}stop(){let e;return this.state===v.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit&&(e=new w.R(this.startPosition.add(this.pointerDelta),(0,r.L2)(this.activeButtons)),this.pointerDelta.set(0,0)),this.state=v.WAITING,e}onMove(e){if(this.state===v.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=v.GESTURING,new w.T(e.position,e.buttons)}compareState(e){return e===this.state}}var T=i(21588);class E{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new b.FM8,this.previousPosition=new b.FM8,this.pointerDelta=new b.FM8,this.lastPointerMove=Date.now(),this.state=v.WAITING,this.threshold=t}start(e){return this.state===v.WAITING&&(this.startPosition.copy(e.position),this.previousPosition.copy(this.startPosition),this.state=v.WAITINGTOEXCEEDTHRESHOLD),new T.E0(e.position,e.buttons)}stop(){const e=(new b.FM8).copy(this.previousPosition).sub(this.startPosition);this.state===v.GESTURING&&this.onEventCallback(new T.Zv(this.startPosition,e)),this.state===v.WAITING&&this.pointerDelta.set(0,0),this.state=v.WAITING;const t=Date.now()-this.lastPointerMove;return new T._R(this.previousPosition,this.pointerDelta,r.r3.NONE,t,e)}onMove(e){let t;return this.state===v.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=v.GESTURING,this.onEventCallback(new T.u4(this.startPosition,e)))),this.state===v.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.pointerDelta.length()>0&&(t=new T._t(this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var _=i(93735);class x{constructor(e=new b.FM8,t=new b.FM8,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const M=2*Math.SQRT2;class P{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new b.FM8,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=v.WAITING,this.pointerMovement1=new x,this.pointerMovement2=new x}start(e,t){this.state===v.WAITING&&(this.restart(e,t),this.pointerMovement1.start(e.position),this.pointerMovement2.start(t.position))}stop(){this.state=v.WAITING;const e=Date.now()-this.lastPointerMove;return new _.i(this.pinchDelta,e)}onMove(e,t){if(this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position),!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/M;if(this.state===v.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=v.GESTURING)}let s;if(this.state===v.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,s=new _.G(e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),s}restart(e,t){this.state=v.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/M,this.previousDistance=this.startDistance}}var A=i(97620),O=i(22079);class D{constructor(e=.1){this.startPointerDelta=new b.FM8,this.previousPointerDelta=new b.FM8,this.pointerDelta=new b.FM8,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=v.WAITING,this.threshold=e}start(e,t){this.state===v.WAITING&&(this.state=v.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(e.position).sub(t.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta))}stop(){this.state=v.WAITING;const e=Date.now()-this.lastPointerMove;return new O.u(this.angleWithDirection,e)}onMove(e,t){let i;if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===v.WAITINGTOEXCEEDTHRESHOLD&&Math.acos((0,A.uZ)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=v.GESTURING),this.state===v.GESTURING){const e=Math.acos((0,A.uZ)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new O.D(this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}var I=i(24946);class C extends I.C{constructor(e,t,i){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i)}}class R extends I.C{constructor(e,t,i,s){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i),this.timeSinceLastMove=s}}class L{constructor(e=.04){this.startEpicenter=new b.FM8,this.previousEpicenter=new b.FM8,this.deltaEpicenter=new b.FM8,this.currentEpicenter=new b.FM8,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=v.WAITING,this.pointerMovements=[],this.threshold=e}start(e){this.state===v.WAITING&&(this.restart(e),this.pointerMovements=e.map((e=>new x)),e.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})))}stop(){this.state=v.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new R(e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){if((0,c.VS)(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)})),this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);let i;return this.state===v.WAITINGTOEXCEEDTHRESHOLD&&this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=v.GESTURING),this.state===v.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new C(e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){(0,c.VS)(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=v.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var N=i(30604),k=i(35056);const F=new(i(25799).Z)("longpress");var B;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(B||(B={}));class U{constructor(e,t=500){this.onEventCallback=e,this.state=B.IDLE,this.ndcStartPosition=new b.FM8,this.pointerDelta=new b.FM8,this.ndcPosition=new b.FM8,this.clientPosition=new b.FM8,this.pressConfirmThreshold=this.pressStartThreshold=Math.max(t,1e-4)}start(e){this.state!==B.IDLE&&this.stop(),this.state===B.IDLE&&0==(e.buttons&e.buttons-1)&&(this.ndcStartPosition.copy(e.position),this.state=B.WAITING,this.buttons=e.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.holdTimeout=window.setTimeout((()=>{this.state=B.STARTED,F.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new k.Vh(e.position,e.clientPosition,e.buttons)),this.successTimeout=window.setTimeout((()=>{F.debug("SUCCESSFUL"),this.state=B.SUCCESSFUL,this.progress(1),this.onEventCallback(new k.$b(this.ndcPosition,this.clientPosition))}),this.pressConfirmThreshold)}),this.pressStartThreshold))}stop(){const e=this.state;if(this.state=B.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>B.WAITING){F.debug("DONE, cancelled:",e<B.SUCCESSFUL);const t=e<B.SUCCESSFUL;this.onEventCallback(new k.pt(this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===B.STARTED||this.state===B.WAITING,i=this.state===B.STARTED||this.state===B.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>.1?this.stop():i&&this.onEventCallback(new k.DG(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===B.STARTED){const e=1-(this.pressStartThreshold-(Date.now()-this.startTime))/this.pressStartThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new k.PC(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var H,G=i(25259),V=i(30853);class z{constructor(){this.displayTouches=!1,this.touches=new Map}async init(e){const[t]=await Promise.all([e.getModule(V.default)]);t.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(H||(H={}));class j{constructor(){this.activeGesture=H.NONE,this.pointers=[],this.couldBeClick=!1}async init(e,t,i){this.onEventCallback=t,this.clicker=new S(e.dragThreshold),this.longPress=new U(t,e.holdThreshold),this.dragger=new E(t,e.dragThreshold),this.pincher=new P(e.pinchThreshold),this.rotater=new D(e.rotateThreshold),this.multiswiper=new L(e.dragThreshold);const s=await i.getModule(y.default);e.disableWheel||this.bindWheelHandlers(s.element),this.inputDebug=new z,this.inputDebug.init(i)}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e.id,e.position,e.clientPosition,e.buttons),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e.id,e.position,e.clientPosition,e.button),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e.id,e.button),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){e.addEventListener("wheel",(e=>{e.preventDefault(),this.onEventCallback(new N.a({x:e.clientX,y:e.clientY},{x:this.normalizeWheelDelta(e.deltaMode,e.deltaX),y:this.normalizeWheelDelta(e.deltaMode,e.deltaY)}))}))}normalizeWheelDelta(e,t){return e===WheelEvent.DOM_DELTA_LINE?.7*t*t*t+13*t:t}addPointer(e,t,i,s){const n=(0,r.AF)(s);if(!n)return;const o=this.getPointer(e);o&&0==(o.buttons&n)?(o.buttons|=n,o.activeButtons++):this.pointers.push({id:e,position:new b.FM8(t.x,t.y),clientPosition:new b.FM8(i.x,i.y),buttons:n,activeButtons:1}),this.toggleGestures()}removePointer(e,t){const i=(0,r.AF)(t);if(!i)return;const s=this.getPointerIndex(e);if(-1!==s){const e=this.pointers[s];0!=(e.buttons&i)&&(e.buttons&=~i,e.activeButtons--),e.activeButtons||this.pointers.splice(s,1),this.toggleGestures()}}movePointer(e,t,i,s){const n=this.getPointer(e);if(n)switch(n.position.copy(t),n.clientPosition.copy(i),n.buttons!==s?this.updateOffscreenPointer(n,s):this.onEventCallback(new G.h(this.pointers)),this.activeGesture){case H.CLICK_DRAG_LONGPRESS:const e=this.clicker.onMove(n);e&&this.onEventCallback(e);const t=this.dragger.onMove(n);t&&this.onEventCallback(t),this.longPress.onMove(n);break;case H.PINCH_ROTATE:const i=this.pincher.onMove(this.pointers[0],this.pointers[1]),s=this.rotater.onMove(this.pointers[0],this.pointers[1]);i&&this.onEventCallback(i),s&&this.onEventCallback(s);case H.MULTI_SWIPE_ONLY:const o=this.multiswiper.onMove(this.pointers);o&&this.onEventCallback(o)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(){this.onEventCallback(new G.h(this.pointers));const e=this.activeGesture;if(this.activeGesture=this.pointers.length,e===H.CLICK_DRAG_LONGPRESS&&this.activeGesture===H.NONE&&this.couldBeClick){const e=this.clicker.stop();e&&this.onEventCallback(e)}if(this.couldBeClick=e===H.NONE&&this.activeGesture===H.CLICK_DRAG_LONGPRESS,this.activeGesture===H.CLICK_DRAG_LONGPRESS){const e=this.clicker.start(this.pointers[0]);e&&this.onEventCallback(e);const t=this.dragger.start(this.pointers[0]);t&&this.onEventCallback(t),this.longPress.start(this.pointers[0])}else if(e===H.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.longPress.stop(),this.onEventCallback(e)}this.activeGesture===H.PINCH_ROTATE?(this.pincher.start(this.pointers[0],this.pointers[1]),this.rotater.start(this.pointers[0],this.pointers[1]),this.multiswiper.start(this.pointers)):e===H.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===H.MULTI_SWIPE_ONLY?this.multiswiper.start(this.pointers):e===H.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++)if(this.pointers[t].id===e)return t;return-1}updateOffscreenPointer(e,t){if(e.buttons=t,0===t){const t=this.getPointerIndex(e.id);this.pointers.splice(t,1),this.toggleGestures()}}tick(){this.longPress.tick()}}var W=i(86515),Z=i(73706),q=i(99169),K=i(62513);class Y{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class $ extends s.Y{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new W.Z((e=>e.object.id)),this.activeIntersections=new W.Z((e=>e.object.id)),this.eventTypeLookup=new n.cj,this.meshTypeLookup=new n.cj,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerMesh=(e,t)=>{this.raycaster.targets.addTarget(e,t)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{const t=!e.hasOwnProperty("down"),i=!t&&e.down,s=!i&&!t;if(t||i){this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh()}i&&(this.gesturing=!0),this.onEvent(e)}this.inputGesture.onPointerChange(e),s&&this.onEvent(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing=!1)},this.onEvent=e=>{const t=this.eventTypeLookup.getIndexByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const s=this.unfilteredHandlerMap[t];if(s)for(const t of s)t(e);const n=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),o=this.fallbackHandlerMap[t];if(!n&&o)for(const t of o)t(e)}}async init(e,t){const i={disableWheel:!!e.disableWheel},s=await t.getModule(y.default),n=await t.market.waitForData(q.W);this.raycaster=await t.getModule(K.default),new d({pointerPreventDefault:e.pointerPreventDefault},s.element,n,this.onPointerEvent),new f(this.onEvent),this.inputGesture=new j,this.inputGesture.init(i,this.onEvent,t)}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getIndexByType(e,!0);return new Y((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i){return this._registerMeshHandler(e,{comparator:t,callback:i})}_registerMeshHandler(e,t){const i=this.eventTypeLookup.getIndexByType(e,!0);this.meshHandlerMap[i]||(this.meshHandlerMap[i]=[]);const s=this.meshHandlerMap[i];return s.push(t),new Y((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==s.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getIndexByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],s=e.indexOf(t);s>-1&&e.splice(s,1)}}registerPriorityHandler(e,t,i){const s=this.eventTypeLookup.getIndexByType(e,!0),o=this.meshTypeLookup.getIndexByType(t,!0);this.priorityHandlerMap[s]||(this.priorityHandlerMap[s]={});const r=this.priorityHandlerMap[s];if(r[o]){const i=(0,n.z$)(e),s=(0,n.z$)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${s}`)}return r[o]=i,new Y((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==r[o]))}unregisterPriorityHandler(e,t,i){const s=this.eventTypeLookup.getIndexByType(e),n=this.priorityHandlerMap[s];if(n){const e=this.meshTypeLookup.getIndexByType(t),s=n[e];s&&i===s&&delete n[e]}}registerUnfilteredHandler(e,t){this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getIndexByType(e);return new Y((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}updateHoveredMesh(){const e=this.activeIntersections.getByIndex(0),t=e&&e.object===this.hoveredMesh.object&&e.instanceId===this.hoveredMesh.instanceId&&e.index===this.hoveredMesh.index;let i=!1;if(this.hoveredMesh.object&&(void 0===e||!t)){const t=this.getMeshHandler(Z.A,(0,n.oL)(this.hoveredMesh.object),this.priorityHandlerMap);if(t&&(i=t(new Z.A,this.hoveredMesh.object,e)||!1),!i){const t=this.meshHandlerMap[this.eventTypeLookup.getIndexByType(Z.A)];if(t)for(const i of t)i.comparator.compare(this.hoveredMesh.object)&&i.callback(new Z.A,this.hoveredMesh.object,e)}}let s=!1;if(e&&!t){const t=this.getMeshHandler(Z.z,(0,n.oL)(e.object),this.priorityHandlerMap);if(t&&(s=t(new Z.z,e.object,e)||!1),!s){const t=this.meshHandlerMap[this.eventTypeLookup.getIndexByType(Z.z)];if(t)for(const i of t)i.comparator.compare(e.object)&&i.callback(new Z.z,e.object,e)}}this.hoveredMesh.object=e&&e.object||null,this.hoveredMesh.instanceId=null==e?void 0:e.instanceId,this.hoveredMesh.index=null==e?void 0:e.index}iterateMeshCallbacks(e,t){let i=!1;const s=this.eventTypeLookup.getIndexByInstance(e);for(const n of t){if(i)break;const t=n.object,o=this.activeIntersections.get(t.id)||n;for(const r in this.priorityHandlerMap[s])if(n.object instanceof this.meshTypeLookup.getTypeByIndex(parseInt(r,10))){const n=this.priorityHandlerMap[s]&&this.priorityHandlerMap[s][r];if(n&&(i=!0,n(e,t,o)))return!0}const r=this.meshHandlerMap[s];if(r)for(const s of r)if(s.comparator.compare(t)){const n=s.callback(e,t,o);i||(i=n||void 0===n)}}return i}insertHandler(e,t,i){const s=this.eventTypeLookup.getIndexByType(e,!0);t[s]||(t[s]=[]),t[s].push(i)}removeHandler(e,t,i){const s=t[this.eventTypeLookup.getIndexByType(e)];if(s)for(let e=0;e<s.length;e++)if(s[e]===i){s.splice(e,1);break}}getMeshHandler(e,t,i){const s=i[this.eventTypeLookup.getIndexByType(e)];return s?s[this.meshTypeLookup.getIndexByType(t)]:null}onUpdate(){this.inputGesture.tick()}}},78626:(e,t,i)=>{"use strict";i.d(t,{e:()=>n});var s=i(86480);class n extends s.G{constructor(e,t,i){super(),this.key=e,this.state=t,this.modifiers=i}}},22767:(e,t,i)=>{"use strict";var s;i.d(t,{M:()=>s}),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(s||(s={}))},35825:(e,t,i)=>{"use strict";var s;i.d(t,{R:()=>s}),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.OPENBRACKET=219]="OPENBRACKET"}(s||(s={}))},40582:(e,t,i)=>{"use strict";var s,n;i.d(t,{MP:()=>s,r3:()=>n,AF:()=>o,L2:()=>r}),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(s||(s={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(n||(n={}));const o=e=>{const t=n[s[e]];return"number"==typeof t?t:void 0},r=e=>{const t=s[n[e]];return"number"==typeof t?t:void 0}},36073:(e,t,i)=>{"use strict";i.d(t,{_A:()=>s,er:()=>r,mE:()=>a});var s,n=i(86480);class o extends n.G{}!function(e){e.MOUSE="mouse",e.TOUCH="touch",e.PEN="pen",e.GAMEPAD="gamepad"}(s||(s={}));class r extends o{constructor(e,t,i,s,n,o){super(),this.id=e,this.position=t,this.clientPosition=i,this.button=s,this.down=n,this.device=o}}class a extends o{constructor(e,t,i,s,n){super(),this.id=e,this.position=t,this.clientPosition=i,this.buttons=s,this.device=n}}},27468:(e,t,i)=>{"use strict";var s,n;i.d(t,{s:()=>s,f:()=>n}),function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller"}(s||(s={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(n||(n={}))},75711:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(19413),n=i(27468);class o extends s.V{constructor(){super(...arguments),this.name="interaction",this._source=o.defaultSource,this._mode=o.defaultMode}static get defaultMode(){return n.s.Desktop}static get defaultSource(){return n.f.None}get mode(){return this._mode}get source(){return this._source}updateSource(e){this._source=e}updateMode(e){this._mode=e}copy(e){this.updateMode(e.mode),this.updateSource(e.source)}hasController(e=this.mode){return e===n.s.VrWithController||e===n.s.VrWithTrackedController}isVR(e=this.mode){return e===n.s.VrOrientOnly||e===n.s.VrWithController||e===n.s.VrWithTrackedController}isMobile(e=this.mode){return e===n.s.Mobile}}},75752:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var s=i(54122),n=i(50101),o=i(30963),r=i(36073),a=i(78626),l=i(75711),c=i(27468),h=i(51418),d=i(21265);class u extends s.Y{constructor(){super(...arguments),this.name="interactionmode",this.onPointerButtonEvent=e=>{let t=this.data.source;switch(e.device){case r._A.TOUCH:t=c.f.Touch;break;case r._A.MOUSE:t=c.f.Mouse;break;case r._A.PEN:t=c.f.Pen;break;case r._A.GAMEPAD:this.renderer.xr.enabled&&this.renderer.xr.isPresenting&&(t=c.f.XRController);break;default:this.log.debug("source:",e.device,e)}this.updateSource(t)},this.onKeyEvent=()=>{this.updateSource(c.f.Key)}}async init(e,t){this.engine=t,this.data=new l.Z,this.mobileBrowser=(0,d.tq)();const i=await t.getModule(n.default);this.renderer=i.threeRenderer,this.updateMode(this.getInteractionMode(),this.data.mode),this.engine.market.register(this,l.Z,this.data),t.getModule(o.default).then((e=>{this.bindings.push(e.registerHandler(r.er,this.onPointerButtonEvent),e.registerHandler(a.e,this.onKeyEvent))}))}onUpdate(e){const t=this.getInteractionMode();this.updateMode(t,this.data.mode)}getInteractionMode(){if(this.renderer.xr.enabled&&this.renderer.xr.isPresenting){const e=this.renderer.xr.getSession();if(null!==e&&e.inputSources.length>0)switch(e.inputSources[0].targetRayMode){case"gaze":case"screen":return c.s.VrOrientOnly;case"tracked-pointer":return c.s.VrWithTrackedController}return c.s.VrOrientOnly}return this.mobileBrowser?c.s.Mobile:c.s.Desktop}updateMode(e,t){e!==this.data.mode&&(this.data.updateMode(e),this.data.commit(),this.engine.broadcast(new h.m(this.data.mode,t)))}updateSource(e){e!==this.data.source&&(this.data.updateSource(e),this.data.commit(),this.engine.broadcast(new h.a(this.data.source)))}}},51418:(e,t,i)=>{"use strict";i.d(t,{m:()=>n,a:()=>o});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.mode=e,this.fromMode=t}}class o extends s.v{constructor(e){super(),this.source=e}}},52388:(e,t,i)=>{"use strict";i.d(t,{_:()=>o});var s=i(78909),n=i(2212);class o extends s.T{constructor(){super(...arguments),this.position=new n.Pa4,this.floorId="",this.sid="",this.text="",this.visible=!1,this.roomId="",this.created=new Date,this.modified=new Date,this.version="3.1"}copy(e){return this.floorId=e.floorId,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.roomId=e.roomId,this.created=e.created,this.modified=e.modified,this.position.copy(e.position),this.version=e.version,this.commit(),this}}},4410:(e,t,i)=>{"use strict";i.d(t,{Fh:()=>n,wm:()=>o,xV:()=>r,Qn:()=>a});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="CREATE_LABEL",this.payload=Object.assign({},e)}}class o extends s.m{constructor(e){super(),this.id="UPDATE_LABEL",this.payload=Object.assign({},e)}}class r extends s.m{constructor(e,...t){super(),this.id="SET_VISIBLE_LABEL",this.payload={visible:e,sids:t}}}class a extends s.m{constructor(...e){super(),this.id="DELETE_LABEL",this.payload={sids:e}}}},7342:(e,t,i)=>{"use strict";i.d(t,{D:()=>l});var s=i(19413),n=i(52388),o=i(71229),r=i(62367);const a=new(i(25799).Z)("label-data");class l extends s.V{constructor(e){super(),this.name="label",this.has=e=>this.map.has(e),this.getLabel=e=>this.map.get(e),this.map=(0,o.q)(e||{})}add(e){let t=e.sid;for(this.map.has(t)&&a.warn("Label already tracked:",{sid:t,label:e,existing:this.getLabel(t)});!t||this.map.has(t);)t=(0,r.O1)(11);return e.sid=t,e.commit(),this.map.set(e.sid,e),t}remove(e){return!!this.map.has(e)&&(this.map.delete(e),!0)}clear(){for(const e of this.map.keys)this.map.delete(e)}getCollection(){return this.map}iterate(e){for(const t of this.map.keys)e(this.map.get(t),t)}isEqual(e){if(this.map.length!==e.map.length)return!1;for(const t of this.map){const i=e.map.get(t.sid);if(!i||!l.labelsAreEqual(t,i))return!1}return!0}static labelsAreEqual(e,t){return e.floorId===t.floorId&&e.roomId===t.roomId&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.z===t.position.z&&e.sid===t.sid&&e.text===t.text&&e.floorId===t.floorId&&e.roomId===t.roomId&&e.visible===t.visible}copy(e){return this.clear(),e.iterate((e=>{this.add((new n._).copy(e))})),this}clone(){return(new l).copy(this)}getLabelsForRoom(e){const t=[];return this.iterate((i=>{i.roomId===e&&t.push(i)})),t}}},66872:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>z});var s=i(2212),n=i(25799),o=i(54122),r=i(17256),a=i(97631),l=i(44333),c=i(83032),h=i(83083),d=i(64614),u=i(60841),p=i(31113),m=i(4410),g=i(7342),f=i(52388),v=i(82858),y=i(20331),b=i(80034),w=i(41263),S=i(7943),T=i(15119),E=i(97620),_=i(46162),x=i(32020);const M=new n.Z("label-serialization"),P=e=>{if(!e)return null;const t={};if(e)for(const i of Object.keys(e)){const s=e[i];try{if(!s||!s.version||isNaN(Number.parseFloat(s.version))||Number.parseFloat(s.version)<3)continue;const e=new f._;e.copy({floorId:"number"==typeof s.floorId?String(s.floorId):"",position:(0,E.gj)(s.position),sid:s.sid,text:s.text||"",visible:s.visible,roomId:s.roomId,created:(0,x.p)(s.created),modified:(0,x.p)(s.modified),version:s.version}),t[s.sid]=e}catch(e){M.warn("Error parsing label data; not adding label: ",s)}}return t},A=(e,t)=>{const i={},s=(0,_.p$)(e);(0,_.TS)(s,t);for(const e of Object.keys(s)){const t=s[e];if(!t)continue;const n=parseInt(t.floorId,10);if(isNaN(n))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i[t.sid]={floorId:n,position:t.position,sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,x.U)(t.created),modified:(0,x.U)(t.modified),version:t.version},i[t.sid].position=(0,E.gj)(t.position)}return i},O=(e,t)=>{const i=[],s=(0,_.p$)(e);(0,_.TS)(s,t);for(const e of Object.keys(s)){const t=s[e];if(!t)continue;const n=parseInt(t.floorId,10);if(isNaN(n))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i.push({floorId:n,position:(0,E.gj)(t.position),sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,x.U)(t.created),modified:(0,x.U)(t.modified),version:t.version})}return i};var D=i(32400),I=i(51770),C=i(60982);const R=new n.Z("mds-label-serialize");class L{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","floorId","label","position"].filter((t=>!(t in e))),i=0===t.length,s=!!e.floorId&&"string"==typeof e.floorId,n=!!e.position&&(0,C.uU)(e.position),o=i&&s&&n;return o||R.debug("Label invalid:",{missingFields:t,validPosition:n}),o}}serialize(e){const t=k(e);return this.validate(t)?t:null}}class N{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","label","position","floorId","roomId"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=k(e);return t&&this.validate(t)?t:null}}const k=e=>{const t={};return void 0!==e.visible&&(t.enabled=e.visible),void 0!==e.text&&(t.label=e.text),void 0!==e.position&&(0,C.uU)(e.position)&&(t.position=E.ep.toVisionVector(e.position)),void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),Object.keys(t).length>0?t:null},F=new n.Z("mds-label-deserializer");class B{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","created","modified","enabled","floor","label","position"].filter((t=>!(t in e))),i=0===t.length,s=!(!e.floor||!e.floor.id),n=!!e.position&&(0,C.uU)(e.position);return i&&s&&n||F.debug("Label invalid:",{missingFields:t,validFloor:s,validPosition:n}),i&&s&&n}}deserialize(e){if(!e||!this.validate(e))return F.debug("Deserialized invalid Label data from MDS",e),null;const t=new f._;return t.sid=e.id,t.floorId=e.floor.id,t.text=e.label,t.visible=!!e.enabled,t.created=(0,x.p)(e.created),t.modified=(0,x.p)(e.modified),t.position=E.ep.fromVisionVector(e.position),e.room&&e.room.id&&(t.roomId=e.room.id),t}}var U=i(23637);const H=new n.Z("MdsLabelStore");class G extends D.u{constructor(e){super(e),this.deserializer=new B,this.updateSerializer=new N,this.createSerializer=new L}async read(){const{includeDisabled:e=!1}=this.config,t=this.getViewId();return this.query(U.GetLabels,{modelId:t,includeDisabled:e}).then((e=>{const t=(0,I.qw)(e,"data.model.labels");if(!t||!Array.isArray(t))return null;const i=[];for(const e of t){const t=this.deserializer.deserialize(e);t&&i.push(t)}return i.reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw H.error("Failure saving label:",e.sid,e),new Error("Could not save Label");return this.mutate(U.AddLabel,{modelId:t,labelId:e.sid,data:i}).then((t=>{const i=(0,I.qw)(t,"data.addLabel"),s=(new f._).copy(e);return s.sid=i.id,s.commit(),H.debug(Object.assign({type:"addLabel"},t)),s}))})))}async update(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=e.sid,s=this.updateSerializer.serialize(e);if(!s)throw H.error("Failure updating label:",i,e),new Error("Could not update Label");return this.mutate(U.PatchLabel,{modelId:t,labelId:i,data:s}).then((e=>{H.debug(Object.assign({type:"patchLabel"},e))}))})))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||!e.sid)throw H.error("Failure deleting label:",e),new Error("Could not update Label");const i=e.sid;return this.mutate(U.DeleteLabel,{modelId:t,labelId:i}).then((e=>{H.debug(Object.assign({type:"deleteLabel"},e))}))})))}}const V=new n.Z("label-data");class z extends o.Y{constructor(){super(...arguments),this.name="label-data",this.viewmodeData=null,this.monitor=null,this.onCreateLabel=async e=>{const t=new f._;t.position=new s.Pa4(e.position.x,e.position.y,e.position.z),t.text=e.text,t.visible=!0,t.floorId=e.floorId,t.roomId=e.roomId,this.labelData.add(t),this.labelData.commit(),this.save();const i=this.viewmodeData&&this.viewmodeData.currentMode||0;return this.engine.broadcast(new v.zJ(t.sid,"Label",i,t.floorId,t.text)),t.sid},this.onUpdateLabel=async e=>{const t=this.labelData.getLabel(e.sid);if(!t)throw new Error(`UpdateLabel: could not find label "${e.sid}"`);const i=new Set;e.position&&(i.add("position"),t.position.set(e.position.x,e.position.y,e.position.z)),e.text&&e.text!==t.text&&(i.add("text"),t.text=e.text),e.floorId&&e.floorId!==t.floorId&&(i.add("floorId"),t.floorId=e.floorId),e.roomId&&e.roomId!==t.roomId&&(i.add("roomId"),t.roomId=e.roomId),void 0!==e.visible&&e.visible!==t.visible&&(i.add("visible"),t.visible=e.visible),i.size>0&&(t.commit(),this.save()),i.has("text")&&this.engine.broadcast(new v.k4(t.sid,t.text)),i.has("position")&&this.engine.broadcast(new v.TA(t.sid,t.floorId,t.position,t.text))},this.onSetLabelVisibility=async e=>{for(const t of e.sids){const i=this.labelData.getLabel(t);i.visible=e.visible,i.commit()}this.save()},this.onDeleteLabel=async e=>{for(const t of e.sids){if(!this.labelData.getLabel(t))throw new Error(`DeleteLabel: could not find label ${t}`);if(!this.labelData.remove(t))throw new Error(`DeleteLabel: could not delete label ${t}`);this.engine.broadcast(new v.lt(t,"Label"))}this.save()}}async init(e,t){this.config=Object.assign(Object.assign({},e),{readonly:!("readonly"in e)||!!e.readonly,storageProvider:e.storageProvider||r.Xq.JSONSTORE}),this.engine=t,this.market=t.market,this.store=this.configureStorage();const i=await this.store.read()||{};this.roomDataModule=await t.getModule(p.default);const s=await t.getModule(a.F);for(const e of Object.values(i))this.roomDataModule.inferMeshIdsFromPoint(e,e.position);this.labelData=t.market.tryGetData(g.D)||new g.D(i),this.market.register(this,g.D,this.labelData),this.config.readonly||this.configureSaving(this.store,this.labelData),this.bindings.push(t.commandBinder.addBinding(m.Fh,this.onCreateLabel),t.commandBinder.addBinding(m.wm,this.onUpdateLabel),t.commandBinder.addBinding(m.Qn,this.onDeleteLabel),t.commandBinder.addBinding(m.xV,this.onSetLabelVisibility),s.onSave((()=>this.saveDiff()),{dataType:r.g.LABELS}),s.onRevert((()=>this.revert()),{dataType:r.g.LABELS}))}configureStorage(){const{modelId:e,baseUrl:t,queue:i,readonly:s}=this.config;if(V.info(`Loading Labels from ${this.config.storageProvider}`),this.config.storageProvider===r.Xq.MDS)return new G({readonly:s,includeDisabled:!s,baseUrl:t});const n=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new y.gO,o=P,r=A,a=`${s}/api/v1/jsonstore/model/Labels/${t}`;if(i){const e=new b.gh({queue:n,path:a,deserialize:o});return new w.iY({publishStores:[e]})}const l=new b.MU({queue:n,path:a,batchUpdate:!0,deserialize:o,serialize:r}),c=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,h=new T.Z({queue:n,path:c,cachedData:{data:null},deserialize:S.S.sessionCollectionMap(T.j.Labels,o),serialize:O},T.j.Labels);return new w.iY({publishStores:[l],editStore:h,editStoreKey:w.aw.LABELS})}({modelId:e,baseUrl:t,readonly:s,queue:i});return new c.N(n,{dataType:r.g.LABELS,modelId:e,readonly:s,engine:this.engine})}configureSaving(e,t){this.monitor=new h.c(t.getCollection(),{aggregationType:u.E.Manual,shallow:!0},this.engine),this.store instanceof c.N&&e.addMonitor(this.monitor)}async save(){return this.engine.commandBinder.issueCommand(new l.VQ({dataTypes:[r.g.LABELS]}))}async saveDiff(){if(!this.store||!this.monitor)return void V.warn("Labels changes will NOT be saved");if(this.monitor.commitChanges(),this.store instanceof c.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===d.KI.removed)).map((e=>({sid:e.index}))),s=t.filter((e=>e.action===d.KI.added)).map((e=>this.labelData.getLabel(e.index))),n=t.filter((e=>e.action===d.KI.updated)).map((e=>Object.assign({sid:e.index},e.diff)));return Promise.all([this.store.delete(i),this.store.create(s),this.store.update(n)]).then((()=>{}))}async revert(){if(this.store instanceof c.N)return this.store.revert()}onUpdate(e){}}},82858:(e,t,i)=>{"use strict";i.d(t,{zJ:()=>o,lt:()=>r,k4:()=>a,TA:()=>l});var s=i(93528),n=i(2212);class o extends s.v{constructor(e,t,i,s,n){super(),this.sid=e,this.type=t,this.cameraMode=i,this.floorId=s,this.text=n}}class r extends s.v{constructor(e,t){super(),this.sid=e,this.type=t}}class a extends s.v{constructor(e,t){super(),this.sid=e,this.text=t||""}}class l extends s.v{constructor(e,t,i,s){super(),this.sid=e,this.floorId=t,this.position=i||new n.Pa4,this.text=s}}},57155:(e,t,i)=>{"use strict";i.d(t,{N:()=>s});const s="features/labels"},15263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{USER_LABELS:()=>E,default:()=>pe});var s=i(54122),n=i(7342),o=i(89155),r=i(22729),a=i(48769),l=i(50101),c=i(59120),h=i(2212),d=i(58286),u=i(30041),p=i(74725),m=i(20599);const g=16777215,f=13224908;class v extends d.${use(e){this.userData.sid=e.data.sid,this.collider.data=e.data,this.collider.name=e.data.text,this.collider.labelMesh=e}}class y extends h.Kj0{labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(e,t){if(!this.labelVisible())return;if(this.material.depthTest)return void super.raycast(e,t);const i=this.material.depthTest?t:[];super.raycast(e,i),i.length>0&&(i[0].distance/=1e4,t.push(i[0]))}}const b=16777215,w=3694079;class S extends h.Kj0{getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}setColorHex(e){this.material.color.getHex()!==e&&this.material.color.setHex(e)}use(e){this.data=e.data}}var T=i(21265);const E={LABEL_SIZE:10,FADE_DURATION:200,ANCHOR_2D_COLLAPSE_RADIUS:20,ANCHOR_MAX_RADIUS:.09,ANCHOR_MIN_RADIUS:.04,ANCHOR_OPACITY:1,LINE_OPACITY:.4,ANCHOR_OPACITY_COLLAPSE:0,LABEL_OPACITY_COLLAPSE:0,SCREEN_FILTER_WIDTH_FACTOR:0,SHOW_ANCHOR:1===(0,T.hu)("anchor",0),DEBUG:-1!==(0,T.hu)("debug","").indexOf("labels")};class _{constructor(){this.makeLine=(e="white")=>{const t=c.default.makeLineMaterial(new h.Ilk(e).getHex(),!0,{linewidth:6}),i=new p.c(new h.Pa4,new h.Pa4,t,{});return i.setRenderOrder(m.z.labels),i.setRenderLayer(this.layer),i.opacity(0),i},this.makeLabel=()=>{const e=new v(Object.assign({},this.textStyle));return e.scaleType=d.N.NDC,e.setRenderOrder(m.z.labels),e.setRenderLayer(this.layer),e.opacity=0,e},this.makeAnchor=()=>{const e=new h.xo$(1,16,16),t=new h.vBJ({transparent:!0,opacity:0,color:"white"});t.depthWrite=!1;const i=new S(e,t);return i.renderOrder=m.z.labels,i.layers.mask=this.layer.mask,i},this.textStyle=u.u.makeConfig({color:"white",background:E.DEBUG,backgroundAsCollider:!0,backgroundColliderType:y,backgroundColor:"white",backgroundOpacity:.8,outline:!0,outlineWidth:6,backgroundBorderHeight:10,backgroundBorderWidth:10,wordWrapWidth:256,disableDepth:!0})}setRenderLayer(e){this.layer=e}}var x=i(71229),M=i(88493),P=i(290),A=i(62367);class O extends h.Tme{constructor(e,t,i){super(),this.anchor=e,this.text=t,this.line=i,this.maxOpacity=1,this.labelAnim=new P.z(0),this.anchorAnim=new P.z(0),this.radius=E.ANCHOR_MAX_RADIUS,this.targets={labelPos:new h.Pa4,labelLookAt:new h._fP,anchorPos:new h.Pa4},this.temp={v3:new h.Pa4,line:new h.Zzh,justShortOfAnchor:new h.Pa4,justShortOfLabel:new h.Pa4},this.selectState={active:!1,on:()=>{this.toggleAnchor(!0),this.anchor.setColorHex(w)},off:()=>{this.toggleAnchor(!1),this.anchor.setColorHex(b)}},this.validState={active:!0,on:()=>{const e=this.hoverState.active?f:g;this.text.setColorHex(e);const t=this.selectState.active?w:b;this.anchor.setColorHex(t)},off:()=>{this.text.setColorHex(16405248),this.anchor.setColorHex(16405248)}},this.hoverState={active:!1,on:()=>{this.validState.active&&this.text.setColorHex(f)},off:()=>{this.validState.active&&this.text.setColorHex(g)}},this.add(i.getMesh(M.B.line)),this.add(e),this.add(t)}getColliders(){return[this.anchor,this.text.collider]}use(e){this.data=e,this.userData.sid=e.sid,this.userData.data=e,this.line.updatePositions(e.position,e.position),this.anchor.use(this),this.anchorUpdate(e.position,this.radius,!0),this.text.use(this),this.labelUpdate(e.position,new h._fP,"")}getId(){return this.data.sid}labelVisible(){return this.labelAnim.endValue>0}anchorVisible(){return this.anchorAnim.endValue>0}updatePose(e,t,i){return this.targets.anchorPos.copy(e),this.targets.labelPos.copy(t),i&&this.targets.labelLookAt.copy(i),this}setMaxOpacity(e){this.maxOpacity=e,this.toggleLabel(this.labelVisible())}async free(){(this.labelVisible()||this.anchorVisible())&&(this.toggleAnchor(!1),this.toggleLabel(!1),await(0,A.gw)(E.FADE_DURATION))}tickAnimations(e){return this.animateLabelOpacity(.5*e),this.animateAnchorOpacity(.2*e),this.animateAnchor(),this.animateLineAndLabel(1),this}toggleLabel(e){const t=e?this.maxOpacity:0;return this.labelAnim.endValue!==t&&this.labelAnim.modifyAnimation(this.labelAnim.value,t,E.FADE_DURATION),this}toggleAnchor(e){const t=e?1:0;return this.anchorAnim.endValue!==t&&this.anchorAnim.modifyAnimation(this.anchorAnim.value,t,E.FADE_DURATION),this}animateLabelOpacity(e){const t=this.labelAnim.tick(e);Math.min(t,this.maxOpacity)!==this.text.opacity&&(this.text.opacity=t)}animateAnchorOpacity(e){const t=this.anchorAnim.tick(e),i=Math.min(t,E.LINE_OPACITY);this.line.currentOpacity!==i&&this.line.opacity(i)}animateAnchor(){const{anchorPos:e}=this.targets;if(!this.anchor.position.equals(e)){this.temp.v3.copy(this.anchor.position).lerp(e,this.anchorAnim.value);const t=this.labelVisible()?E.ANCHOR_MAX_RADIUS:E.ANCHOR_MIN_RADIUS;this.anchorUpdate(this.temp.v3,t)}}animateLineAndLabel(e){const{labelPos:t,anchorPos:i,labelLookAt:s}=this.targets;let n=!1;if(this.temp.v3.copy(this.text.position),this.text.position.equals(t)||(this.temp.v3.lerp(t,e),n=!0),this.labelUpdate(this.temp.v3,s,this.data.text),this.temp.line.set(this.text.position,i),this.temp.line.at(.9,this.temp.justShortOfAnchor),n||!this.line.endPosition.equals(this.temp.justShortOfAnchor)){this.temp.line.at(.08,this.temp.justShortOfLabel);const t=this.temp.v3.copy(this.line.endPosition).lerp(this.temp.justShortOfAnchor,e);this.line.updatePositions(this.temp.justShortOfLabel,t)}}anchorUpdate(e,t,i=!1){this.anchor.position.copy(e),void 0===t||!i&&this.radius===t||(this.anchor.scale.set(t,t,t),this.radius=t)}labelUpdate(e,t,i){this.text.position.copy(e),this.text.quaternion.copy(t),this.text.text=i}billboard(e,t,i,s,n,o,r){this.text.scaleBillboard(e,t,i,s,n,o,r),this.anchorVisible()&&this.anchor.scale.copy(this.text.scale).multiplyScalar(20)}}var D=i(25799);const I=new D.Z("label-spawner");class C{constructor(e,t){this.map=e,this.maker=t,this.container=new h.Tme,this.pool=[],this.bindings=[],this.iterator=()=>this.meshesMap.values,this.meshesMap=(0,x.q)();const i=e.keys;for(const t of i){const i=e.get(t);this.add(i,t)}this.bindings.push(e.onElementChanged({onAdded:(e,t)=>{this.add(e,t),I.debug("LabelMesh: added:",t)},onRemoved:(e,t)=>{I.debug("LabelMesh: removing:",t);const i=this.meshesMap.get(t);i&&this.free(i)}}))}subscribe(e){return this.meshesMap.onElementChanged(e)}get(e){return this.meshesMap.get(e)}free(e){const t=e.getId(),i=this.meshesMap.get(t);return i.free().then((()=>{this.meshesMap.delete(t),this.container.remove(i),this.pool.push(i),I.debug("LabelMesh: removed:",i)}))}add(e,t){const i=this.pool.shift();if(void 0!==i)return i.use(e),this.container.add(i),this.meshesMap.set(t,i),i;{const i=new O(this.maker.makeAnchor(),this.maker.makeLabel(),this.maker.makeLine());return i.use(e),this.container.add(i),this.meshesMap.set(t,i),i}}dispose(){for(const e of this.iterator())this.free(e);this.bindings.forEach((e=>e.cancel()))}}var R=i(97620);class L{constructor(e,t,i,s){this.meshes=e,this.cameraData=t,this.positionHelper=i,this.screenFilter=s}beforeRender(){const{position:e,rotation:t,projection:i}=this.cameraData.pose,{height:s}=this.cameraData,n=this.cameraData.zoom(),o=this.cameraData.aspect();this.screenFilter.update();for(const r of this.meshes()){r.labelVisible()&&!this.screenFilter.visible(r.data.sid)&&r.toggleLabel(!1);const a=this.positionHelper.position(r),l=r.labelVisible()?a.anchor:a.label;r.updatePose(l,a.label,t);const c=(0,R.dS)(64-E.LABEL_SIZE,0,64,.02,.1);r.billboard(e,t,i,n,s,o,c)}}render(e){for(const t of this.meshes())t.tickAnimations(e)}deactivate(){}init(){}dispose(){}activate(){}}var N=i(75195),k=i(82582),F=i.n(k);class B{constructor(e,t,i){this.meshes=e,this.cameraData=t,this.enabled=i,this.tree=new(F()),this.visibleMap={},this._screenPosition=new h.FM8,this._ndcPosition=new h.Pa4,this.update=()=>{this.enabled()?(this.visibleMap={},this.updatePositions()):Object.keys(this.visibleMap).length&&(this.visibleMap={})}}visible(e){return e in this.visibleMap&&e in this.visibleMap}updatePositions(){this.tree.clear(),this.meshes().filter((e=>e.labelVisible())).map((e=>((0,N.q9)(this.cameraData,e.text.position,this._screenPosition,this._ndcPosition),this.describeBbox(e.text,this._screenPosition,this._ndcPosition.z)))).sort(((e,t)=>e.depth-t.depth)).forEach((e=>{this.tree.collides(e)||(this.tree.insert(e),this.visibleMap[e.id]=e)}))}describeBbox(e,t,i){const s=(e.height+4)/2,n=(e.width+4)/2;return{id:e.userData.sid,depth:i,minX:t.x-n,minY:t.y-s,maxX:t.x+n,maxY:t.y+s}}}var U=i(12775),H=i(39936),G=i(57155),V=i(62431),z=i(90601),j=i(29675),W=i(47173);class Z{constructor(e){this.meshes=e,this.initialized=!1,this.featureEnabled=()=>{if(!this.initialized)return!1;const e=this.appData.phase===j.nh.PLAYING,t=this.settingsData.tryGetProperty(G.N,!1),i=this.settingsData.tryGetProperty(V.gx.Labels,!1);return e&&t&&i},this.visibleByTool=()=>!!this.initialized&&(null===this.toolsData.activeToolName||this.toolsData.activeToolName===z.w1.LABELS||this.toolsData.activeToolName===z.w1.PHOTOS),this.visibleByViewmode=()=>{const e=this.appData.application===j.Mx.SHOWCASE,t=this.viewmodeData.isDollhouse()&&this.settingsData.tryGetProperty(V.gx.LabelsDollhouse,!0)&&this.settingsData.tryGetProperty(W.Q,!1);return e&&this.viewmodeData.isFloorplan()||t},this.hiddenByTransition=()=>this.viewmodeData.transitionActive()||this.floorsViewData.transitionActive,this.visibleByFloor=e=>!!this.floorsViewData.roomSelectModeActive&&!this.floorsViewData.floorSelectModeActive&&this.floorsViewData.isCurrentOrAllFloors(e)}async init(e){[this.viewmodeData,this.floorsViewData,this.settingsData,this.toolsData,this.appData]=await Promise.all([e.waitForData(U.O),e.waitForData(r.c),e.waitForData(H.e),e.waitForData(a.t),e.waitForData(j.pu)]),this.initialized=!0}onUpdate(){if(!this.initialized)return;const e=this.featureEnabled(),t=!this.hiddenByTransition(),i=this.visibleByTool(),s=e&&t&&i&&this.visibleByViewmode();for(const e of this.meshes()){const t=s&&this.visibleByFloor(e.data.floorId);e.toggleLabel(t)}}}var q=i(27829),K=i(91055);class Y{constructor(e,t){this.floorsViewData=e,this.pose=t,this.shift={minAngle:60,maxAngle:70,minVal:0,maxVal:0},this.vectors={labelPos:new h.Pa4,anchorPos:new h.Pa4,shiftTowardsCamPos:new h.Pa4,lookDir:new h.Pa4,flattenedLookDir:new h.Pa4}}position(e){return this.positionAboveLabelAnchor(e)}onCurrentFloor(e){return this.floorsViewData.transitionActive?void 0!==this.floorsViewData.nearestFloor&&this.floorsViewData.nearestFloor.id===e:this.floorsViewData.getHighestVisibleFloor().id===e}getFloor(e){let t=this.floorsViewData.getHighestVisibleFloor();try{t=this.floorsViewData.floors.getFloor(e)}catch(e){}return t}getFloorHeight(e){return this.getFloor(e).medianSweepHeight()}getFloorBottom(e){return this.getFloor(e).bottom}positionAboveLabelAnchor(e){const t=this.vectors.lookDir.copy(q.f.FORWARD).applyQuaternion(this.pose.rotation),i=this.vectors.flattenedLookDir.copy(t).setY(0),s=t.angleTo(i)*R.MN,n=this.getFloorHeight(e.data.floorId),o=e.data.position.y;if(this.vectors.labelPos.set(e.data.position.x,Math.max(o,n),e.data.position.z),this.onCurrentFloor(e.data.floorId)){const e=(0,R.dS)(s,this.shift.minAngle,this.shift.maxAngle,this.shift.minVal,this.shift.maxVal);(0,K.Pp)(this.pose.projection)?this.vectors.labelPos.setY(this.vectors.labelPos.y+e):(this.vectors.shiftTowardsCamPos.copy(this.pose.position).sub(this.vectors.labelPos).setLength(e).add(this.vectors.labelPos),this.vectors.labelPos.copy(this.vectors.shiftTowardsCamPos))}return e.anchorVisible()?this.vectors.anchorPos.set(e.data.position.x,this.getFloorBottom(e.data.floorId),e.data.position.z):this.vectors.anchorPos.copy(this.vectors.labelPos),{anchor:this.vectors.anchorPos,label:this.vectors.labelPos}}}var $=i(77956),Q=i(72942),X=i(47924),J=i(75712),ee=i(73706),te=i(75158),ie=i(57501),se=i(53999),ne=i(76258),oe=i(7065);class re{constructor(e,t,i,s,n,o){this.labelRenderer=e,this.issueCommand=t,this.input=i,this.floorsViewData=s,this.toolsData=n,this.roomNavigationPose=o,this.inputBindings=[],this.appStateBindings=[],this.raycasterRegistrationBindings=[],this.refresh=()=>{this.inputBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel())),this.raycasterRegistrationBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel()))},this.refreshColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.shouldBeInteractive?this.input.registerMesh(e.text.collider,!1):this.input.unregisterMesh(e.text.collider)},this.clearColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.input.unregisterMesh(e.text.collider)},this.setupInputBindings(),this.setupRaycasterBindings();const r=this.toolsData.onToolChanged(this.refresh),a=this.floorsViewData.makeFloorChangeSubscription(this.refresh),l=this.floorsViewData.onRoomSelectModeChange(this.refresh);this.appStateBindings.push(r,a,l),this.refresh()}toggleInput(e){this.appStateBindings.forEach((t=>e?t.renew():t.cancel())),this.inputBindings.forEach((t=>e&&this.shouldBeInteractive?t.renew():t.cancel())),this.raycasterRegistrationBindings.forEach((t=>e&&this.shouldBeInteractive?t.renew():t.cancel()))}get shouldBeInteractive(){return null===this.toolsData.activeToolName&&this.floorsViewData.roomSelectModeActive}setupRaycasterBindings(){const e=(0,ie.k1)((()=>this.refreshColliders()),(()=>this.clearColliders()),this.shouldBeInteractive);e.cancel();const t=this.labelRenderer.subscribe({onAdded:e=>this.input.registerMesh(e.text.collider,!1),onRemoved:e=>this.input.unregisterMesh(e.text.collider)});this.shouldBeInteractive||t.cancel(),this.raycasterRegistrationBindings.push(e,t)}setupInputBindings(){const e=J.s.is((e=>e instanceof y&&e.labelVisible()));let t=null;const i=new se.V(this.input.registerMeshHandler(ee.z,e,((e,i)=>{const s=this.labelRenderer.getLabelMesh(i.getId());s&&(s.hoverState.active=!0,s.hoverState.on(),t=s,this.issueCommand(new ne.u(oe.C.FINGER)))})),this.input.registerMeshHandler(ee.A,e,((e,t)=>{const i=this.labelRenderer.getLabelMesh(t.getId());i&&(this.issueCommand(new ne.u(oe.C.DEFAULT)),i.hoverState.active=!1,i.hoverState.off())})),(0,ie.k1)((()=>{}),(()=>{t&&(t.hoverState.active=!1,t.hoverState.off())})));this.shouldBeInteractive||i.cancel();const s=this.input.registerMeshHandler(te.R,e,((e,t)=>{const i=this.labelRenderer.getLabelMesh(t.getId());if(i){const e=i.data.roomId,t=this.roomNavigationPose.getPoseForRoom(e,i.data.position);t&&this.issueCommand(new Q._i(Q.BD.INSIDE,X.n.Interpolate,t))}}));this.shouldBeInteractive||s.cancel(),this.inputBindings.push(i,s)}}var ae=i(30963),le=i(18687),ce=i(71208);const he=new D.Z("room-with-a-view");class de{constructor(e,t){this.sweepData=e,this.roomData=t}getPoseForRoom(e,t){const i=this.bestViewForRoom(e,t);return i?{rotation:i.rotation,sweepID:i.sweepID,viewmode:ce.Ey.Panorama}:null}bestViewForRoom(e,t){const i=this.sweepData.filter((t=>t.roomId===e));if(0===i.length)return he.debug("no sweeps in selected room",{roomId:e,scansInRoom:i}),null;let s=1;const n=this.roomData.get(e).mesh.boundingBox.getSize(new h.Pa4).length();t&&n>10&&(s=.2);const o=i.sort(((i,n)=>{let o=0,r=0;t&&(o=i.position.distanceTo(t),r=n.position.distanceTo(t));const a=i.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length,l=n.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length;return 1*s*(l-a)-3*(r-o)})),r=o[0];if(!r)return he.debug("no start sweep",{roomId:e,scansInRoom:i,connectedness:o}),null;const a=r.neighbours.map((e=>this.sweepData.getSweep(e))).sort(((t,i)=>{let s=r.position.distanceTo(t.position),n=r.position.distanceTo(i.position);return t.roomId===e&&(s*=1e3),i.roomId===e&&(n*=1e3),n-s})).map((e=>({sweep:e,dist:r.position.distanceTo(e.position),rm:e.roomId}))),l=a[0];he.warn({roomId:e,roomSize:n,scoring:o,byDistance:a,scansInRoom:i});const c=new h._fP;if(1===i.length&&void 0!==l){const e=(new h.yGw).setPosition(r.position);e.lookAt(l.sweep.position,r.position,q.f.UP),c.setFromRotationMatrix(e)}else{const e=(new h.yGw).setPosition(r.position);e.lookAt(r.position,l.sweep.position,q.f.UP),c.setFromRotationMatrix(e)}return{sweepID:r.id,rotation:c}}}class ue extends s.Y{constructor(){super(...arguments),this.name="user-labels",this.labelMeshIterator=()=>this.spawner.iterator()}async init(e,t){const[i,s,c,h,d,u,p,m]=await Promise.all([t.market.waitForData(n.D),t.market.waitForData(o.M_),t.market.waitForData(r.c),t.market.waitForData(a.t),t.market.waitForData($.Z),t.market.waitForData(le.Z),t.getModule(l.default),t.getModule(ae.default)]),g=p.getScene(),f=new _;f.setRenderLayer(t.claimRenderLayer("labels")),this.spawner=new C(i.getCollection(),f),g.add(this.spawner.container),this.visibilityRules=new Z(this.labelMeshIterator),this.visibilityRules.init(t.market);const v=new B(this.labelMeshIterator,s,(()=>this.visibilityRules.featureEnabled()&&this.visibilityRules.visibleByTool())),y=new Y(c,s.pose),b=new L(this.labelMeshIterator,s,y,v);t.addComponent(this,b);const w=new de(d,u);this.labelNavInput=new re(this,t.commandBinder.issueCommand,m,c,h,w),this.toggleInput(!0)}getLabelMesh(e){return e&&this.spawner.get(e)||null}addLabelMesh(e,t){return this.spawner.add(e,t)}freeLabelMesh(e){e&&this.spawner.free(e)}toggleInput(e){this.labelNavInput.toggleInput(e)}subscribe(e){return this.spawner.subscribe(e)}onUpdate(){this.visibilityRules&&this.visibilityRules.onUpdate()}}const pe=ue},29641:(e,t,i)=>{"use strict";i.d(t,{q:()=>r});var s,n=i(19413),o=i(5442);!function(e){e[e.CLOSED=0]="CLOSED",e[e.IDLE=1]="IDLE",e[e.CREATING=2]="CREATING",e[e.PRESSING=3]="PRESSING",e[e.PLACING=4]="PLACING",e[e.PLACED=5]="PLACED",e[e.EDITING=6]="EDITING",e[e.MOVING=7]="MOVING"}(s||(s={}));class r extends n.V{constructor(e){super(),this.data=e,this.name="label-view",this.toolStateObservable=(0,o.Y)(s.CLOSED),this.creatingNewLabel=!1,this.selectedObservable=new o.f(null),this.progressObservable=new o.f(-1),this.screenPositionObservable=new o.f(null),this.labelPlacementObservable=new o.f(null)}initialize(e){}dispose(){}clearLabelCreation(){this.isCreatingNewLabel()&&(this.setScreenPosition(null),this.setLabelPlacement(null),this.setSelected(null),this.setToolState(s.IDLE))}iterate(e){this.data.iterate(e)}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e,t=!1){const i=this.screenPositionObservable.onChanged(e);return t&&i.renew(),i}setLabelPlacement(e){this.labelPlacementObservable.value=e}get labelPlacement(){return this.labelPlacementObservable.value}onLabelPlacementChanged(e,t=!1){const i=this.labelPlacementObservable.onChanged(e);return t&&i.renew(),i}get selected(){return this.selectedObservable.value}setSelected(e){this.selectedObservable.value=e}onSelectedChanged(e,t=!1){const i=this.selectedObservable.onChanged(e);return t&&i.renew(),i}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){return this.progressObservable.onChanged(e)}setToolState(e){switch(e){case s.CREATING:this.creatingNewLabel=!0;break;case s.IDLE:case s.CLOSED:this.creatingNewLabel=!1}this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}isCreatingNewLabel(){return this.creatingNewLabel}onToolStateChanged(e,t=!1){const i=this.toolStateObservable.onChanged(e);return t&&i.renew(),i}}},90072:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var s=i(54122),n=i(7342),o=i(29641);class r extends s.Y{constructor(){super(...arguments),this.name="label-viewdata"}async init(e,t){this.data=await t.market.waitForData(n.D);const i=new o.q(this.data);i.initialize(t),t.market.register(this,o.q,i)}}},74725:(e,t,i)=>{"use strict";i.d(t,{c:()=>u});var s=i(2212),n=i(88493);class o extends s.Kj0{constructor(e,t){super(),this.type="Line",this.part=n.B.line,this.computeLineDistances=(()=>{const e=new s.Pa4,t=new s.Pa4;return()=>{const i=this.geometry,n=i.attributes.instanceStart,o=i.attributes.instanceEnd,r=new Float32Array(2*n.data.count);for(let i=0,s=0,a=n.data.count;i<a;i++,s+=2)e.fromBufferAttribute(n,i),t.fromBufferAttribute(o,i),r[s]=0===s?0:r[s-1],r[s+1]=r[s]+e.distanceTo(t);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(r,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new s.$TI(r,2,1),i.setAttribute("instanceDistanceStart",new s.kB5(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new s.kB5(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=e,this.material=t}copy(e){throw Error("not implemented")}}class r extends s.L5s{constructor(){super(),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.a$l([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.positionBuffer?(this.positionBuffer.set(t,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new s.$TI(t,6,1),this.setAttribute("instanceStart",new s.kB5(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new s.kB5(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.colorBuffer?(this.colorBuffer.set(t,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new s.$TI(t,6,1),this.setAttribute("instanceColorStart",new s.kB5(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new s.kB5(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new s.Uk6(e.geometry)),this}fromLineSegements(e){const t=e.geometry;return t instanceof s.ZXM?this.setPositions(t.vertices):t instanceof s.u9r&&this.setPositions(t.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new s.ZzF),this.box||(this.box=new s.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new s.Pa4),this.boundingSphere||(this.boundingSphere=new s.aLr),this.boundingBox||this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let n=0,o=e.count;n<o;n++)this.tempVector.fromBufferAttribute(e,n),s=Math.max(s,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}class a extends r{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return r.prototype.setPositions.call(this,i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return r.prototype.setColors.call(this,i),this}fromLine(e){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(e){return this}}var l=i(91055),c=i(53628);class h extends s.Kj0{constructor(e,t,i=c.V9.endpointSelected,s=c.V9.endpointDefault){super(e,t),this.selectedSize=i,this.defaultSize=s,this.currentSize=c.V9.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(c.Ey,c.Ey,c.Ey)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(e,t,i){const s=(0,l.mY)(t,e,this.position,i,.5),n=Math.max(Math.min(1/s*this.currentSize,c.g4),c.Ey);this.scale.set(n,n,n)}updateSelected(e){this.currentSize=e?this.selectedSize:this.defaultSize}}var d=i(20599);class u{constructor(e,t,i,r,c){this.lineMaterial=i,this.options=r,this.endpointMaterial=c,this.startPosition=new s.Pa4,this.endPosition=new s.Pa4,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=e=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(e),this.lineMesh.material.setOpacity(e),this),this.updatePositions=(e,t)=>(this.startPosition.copy(e),this.endPosition.copy(t),this.options.beforeUpdatePositions&&(e=this.options.beforeUpdatePositions(e),t=this.options.beforeUpdatePositions(t)),this.lineMesh.geometry.setPositions([e.x,e.y,e.z,t.x,t.y,t.z]),this.endpoints&&(this.endMesh.position.copy(t),this.startMesh.position.copy(e),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=e=>{if(this.endpoints&&(e.rotation&&(this.endMesh.quaternion.copy(e.rotation),this.startMesh.quaternion.copy(e.rotation)),e.position&&e.projection&&!(0,l.s1)(e.projection))){const t=this.lineMesh.material.uniforms.resolution.y;this.endMesh.billboardScale(e.position,e.projection,t),this.startMesh.billboardScale(e.position,e.projection,t)}return this.lastBillboardOptions=e,this},this.updateSelected=e=>(this.lineMesh.material.updateSelected(e),this.endpoints&&(this.endMesh.material.updateHovered(e),this.endMesh.updateSelected(e),this.startMesh.updateSelected(e)),this),this.setRenderLayer=e=>{this.children.forEach((t=>t.layers.mask=e.mask))},this.setRenderOrder=e=>{this.children.forEach((t=>t.renderOrder=e))},this.updateResolution=(e,t)=>(this.lineMesh.material.uniforms.resolution.x=e,this.lineMesh.material.uniforms.resolution.y=t,this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=e=>(e?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=e=>{this.lineMesh.material=e},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(e),this.endPosition.copy(t),this.lineMesh=new o(new a,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=n.B.line,this.lineMesh.renderOrder=d.z.lines,this.meshToLinePartMap[n.B.line]=this.lineMesh,c&&(this.endpoints=!0,this.endMesh=new h(new s.BKK(1,1),c),this.endMesh.part=n.B.end,this.endMesh.renderOrder=d.z.endpoints,this.meshToLinePartMap[n.B.end]=this.endMesh,this.startMesh=new h(new s.BKK(1,1),c),this.startMesh.part=n.B.start,this.startMesh.renderOrder=d.z.endpoints,this.meshToLinePartMap[n.B.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(e){return this.meshToLinePartMap[e]}get children(){return Object.keys(this.meshToLinePartMap).map((e=>this.meshToLinePartMap[e]))}get visible(){return this.isVisible}}},88493:(e,t,i)=>{"use strict";var s;i.d(t,{B:()=>s}),function(e){e.line="line",e.start="start",e.end="end"}(s||(s={}))},59120:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var s,n=i(54122),o=i(2212),r=i(74725),a=i(60778),l=i(91975),c=i(40886),h=i(71370),d=i(88296);!function(e){e[e.LINE_DEFAULT=0]="LINE_DEFAULT",e[e.LINE_HOVER=1]="LINE_HOVER",e[e.END_DEFAULT=2]="END_DEFAULT",e[e.END_HOVER=3]="END_HOVER"}(s||(s={}));class u{constructor(){const e=(0,a.p)(l),t=(0,a.p)(c),i=(0,a.p)(h),n=(0,a.p)(d);this.textures={[s.LINE_DEFAULT]:i,[s.LINE_HOVER]:n,[s.END_DEFAULT]:e,[s.END_HOVER]:t},i.minFilter=o.wem,n.minFilter=o.wem,e.minFilter=o.wem,t.minFilter=o.wem}get(e){return this.textures[e]}dispose(){for(const e in this.textures){const t=Number(e);this.get(t).dispose()}}}var p=i(30092);class m extends o.FIo{constructor(e,t,i){const s=o.rDY.clone(p.T.endpoint.uniforms);super({fragmentShader:p.T.endpoint.fragmentShader,vertexShader:p.T.endpoint.vertexShader,uniforms:s,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=e,this.defaultTex=t,this.hoverTex=i,this.uniforms.bg.value=t,this.uniforms.color.value.copy(this.color)}clone(){return new m(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(e){this.uniforms&&e!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=e)}getOpacity(){return this.uniforms.opacity.value}updateHovered(e){const t=e?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==t&&(this.uniforms.bg.value=t)}}var g=i(7167),f=i(89155),v=i(50101),y=i(60303),b=i(99169),w=i(53628);class S extends n.Y{constructor(){super(...arguments),this.name="lines",this.makeLineMaterial=(e,t,i={},s,n)=>S.makeLineMaterial(e,t,i,s,n),this.makeEndpointMaterial=(e,t,i)=>S.makeEndpointMaterial(e,t,i),this.onCanvasChange=e=>{for(const t of this.segments)t.updateResolution(e.width,e.height)}}static get textures(){return S._textures||(S._textures=new u),S._textures}async init(e,t){S._textures||(S._textures=new u);const i=await t.getModule(v.default);this.scene=i.getScene(),this.canvas=await t.market.waitForData(b.W),this.cameraData=await t.market.waitForData(f.M_),this.bindings.push(this.canvas.onChanged(this.onCanvasChange)),this.cameraPosition=new o.Pa4,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(e){super.dispose(e),this.segments.forEach((e=>e.dispose()))}makeLine(e,t,i,s,n=(()=>!1)){const o=n()?w.iV.OFFSET_TOWARDS_CAMERA:0,a=n()?e=>this.cameraPosition.clone().sub(e).setLength(o).add(e):e=>e,l=new r.c(e,t,i,{beforeUpdatePositions:a,onShow:()=>l.children.forEach((e=>this.scene.addChild(y.a.Root,e))),onHide:()=>l.children.forEach((e=>this.scene.removeChild(y.a.Root,e)))},s);return l.updateResolution(this.canvas.width,this.canvas.height),l.opacity(1),l.show(),l.updatePositions(e,t),this.segments.push(l),l}}S.makeLineMaterial=(e,t,i={},n,r)=>{const a=r||S.textures.get(s.LINE_HOVER),l=n||S.textures.get(s.LINE_DEFAULT),c=new o.FM8(window.innerWidth,window.innerHeight);return t?new g.Y(Object.assign({color:new o.Ilk(e),resolution:c},i),a,l):new g.Y(Object.assign({color:new o.Ilk(e)},i))},S.makeEndpointMaterial=(e,t,i)=>{const n=i||S.textures.get(s.END_HOVER),r=t||S.textures.get(s.END_DEFAULT);return new m(new o.Ilk(e),r,n)}},7167:(e,t,i)=>{"use strict";i.d(t,{Y:()=>r});var s=i(2212),n=i(30092),o=i(53628);class r extends s.jyz{constructor(e,t,i,r=o.V9.lineSelected){super(),this.parameters=e,this.hoverTexture=t,this.defaultTexture=i,this.selectedWidth=r,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=o.V9.lineDefault,this.setValues({uniforms:s.rDY.clone(n.T.line.uniforms),vertexShader:n.T.line.vertexShader,fragmentShader:n.T.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(e),i&&(this.mask=i),this.defaultWidth=e&&e.linewidth?e.linewidth:o.V9.lineDefault}updateSelected(e){const t=e?this.hoverTexture:this.defaultTexture;t&&this.mask!==t&&(this.mask=t,e?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(e){this.uniforms.linewidth||(this.uniforms=s.rDY.clone(n.T.line.uniforms)),this.getLinewidth()!==e&&(this.uniforms.linewidth.value=e)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}getOpacity(){return this.uniforms.opacity.value}setOpacity(e){this.uniforms||(this.uniforms=s.rDY.clone(n.T.line.uniforms)),this.getOpacity()!==e&&(this.uniforms.opacity.value=e)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}set dashed(e){e?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value=e}set mask(e){this.uniforms.mask.value!==e&&(e?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=e,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(e){return s.jyz.prototype.copy.call(this,e),this.parameters=e.parameters,this.color.copy(e.color),this.defaultWidth=e.defaultWidth,this.setLinewidth(e.getLinewidth()),this.resolution.copy(e.resolution),this.defaultTexture=e.defaultTexture,this.hoverTexture=e.hoverTexture,this.mask=e.mask,this.setOpacity(e.getOpacity()),this.dashed=e.dashed,this.dashScale=e.dashScale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}},30092:(e,t,i)=>{"use strict";i.d(t,{T:()=>a});var s=i(2212),n=i(13441),o=i(81047),r=i(48101);const a={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new s.Ilk},bg:{type:"t",value:null}},vertexShader:(0,r.m)(o,i(82334)),fragmentShader:(0,r.m)(n,i(7281))},line:{uniforms:s.rDY.merge([s.rBU.common,s.rBU.fog,{linewidth:{value:4},resolution:{value:new s.FM8(window.innerWidth,window.innerHeight)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:i(9391),fragmentShader:i(29966)}}},53628:(e,t,i)=>{"use strict";i.d(t,{iV:()=>s,V9:()=>n,Ey:()=>o,g4:()=>r});const s={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},n={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},o=.01,r=5},14647:(e,t,i)=>{"use strict";i.d(t,{Ko:()=>u,up:()=>m,hJ:()=>g});var s=i(2212),n=i(97620),o=i(62431),r=i(75195),a=i(90709);const l=new s.FM8,c=new s.Pa4,h=new s.FM8,d=new s.FM8,u=(e,t,i)=>{const s=((e,t,i)=>((0,r.q9)(i,e,h),(0,r.q9)(i,t,d),{pixelDistance:h.distanceTo(d),startScreenPosition:h,endScreenPosition:d}))(e,t,i);return{screenPosition:((e,t,i)=>(c.copy(e).add(t).multiplyScalar(.5),(0,r.q9)(i,c,l),l))(e,t,i),rotation:p(h,d),pixelDistance:s.pixelDistance,startScreenPosition:s.startScreenPosition,endScreenPosition:s.endScreenPosition}},p=(e,t)=>{const i=e.y-t.y,s=e.x-t.x;let o=Math.atan2(i,s)*n.MN;return o=o>=90||o<=-90?o+180:o,o},m=(e,t=o.Mc.USFractional)=>{let i='0"';switch(t){case o.Mc.USFractional:const{feet:t,inches:s}=(0,a.XJ)(e);i=t>0?`${t}' ${s}"`:`${s}"`;break;case o.Mc.Metric:i=`${e.toFixed(2)}m`}return i},g=(e,t=10,i=40)=>({width:Math.max(9*Math.max(e,2)+t,i),height:18+t})},55656:(e,t,i)=>{"use strict";i.d(t,{a:()=>s,B:()=>n});const s="en-US",n={en:s,es:"es-MX",fr:"fr-FR",de:"de-DE",ru:"ru-RU",ja:"ja-JP",zh:"zh-CN",ko:"ko-KR",nl:"nl-NL",it:"it-IT",pt:"pt-BR",cn:"zh-CN",jp:"ja-JP"}},29359:(e,t,i)=>{"use strict";var s;i.d(t,{Z:()=>n}),function(e){e.LOADING="LOADING",e.PRESENTED_BY_CAPS="PRESENTED_BY_CAPS",e.EXPLORE_3D_SPACE="EXPLORE_3D_SPACE",e.POWERED_BY="POWERED_BY",e.SC_LOCKOUT_MESSAGE="SC_LOCKOUT_MESSAGE",e.SC_LOCKOUT_TITLE="SC_LOCKOUT_TITLE",e.SC_PASSWORD_TITLE="SC_PASSWORD_TITLE",e.SC_PASSWORD_INVALID="SC_PASSWORD_INVALID",e.SC_PASSWORD_PLACEHOLDER="SC_PASSWORD_PLACEHOLDER",e.SC_PASSWORD_SUBMIT="SC_PASSWORD_SUBMIT",e.VIEW_INSIDE="VIEW_INSIDE",e.VIEW_INSIDE_MESH="VIEW_INSIDE_MESH",e.VIEW_DOLLHOUSE="VIEW_DOLLHOUSE",e.VIEW_FLOORPLAN="VIEW_FLOORPLAN",e.VIEW_FULLSCREEN="VIEW_FULLSCREEN",e.EXIT_FULLSCREEN="EXIT_FULLSCREEN",e.OPEN_HIGHLIGHTS="OPEN_HIGHLIGHTS",e.CLOSE_HIGHLIGHTS="CLOSE_HIGHLIGHTS",e.PAUSE="PAUSE",e.SOCIAL_SHARING="SOCIAL_SHARING",e.VIEW_IN_VR="VIEW_IN_VR",e.FLOOR_NAME="FLOOR_NAME",e.FLOOR_ALL="FLOOR_ALL",e.PRESENTED_BY="PRESENTED_BY",e.MORE="MORE",e.LESS="LESS",e.LEARN_MORE="LEARN_MORE",e.TERMS="TERMS",e.HELP="HELP",e.TERMS_FAIL="TERMS_FAIL",e.HELP_NAVIGATION_TAB="HELP_NAVIGATION_TAB",e.HELP_MORE_HELP_TAB="HELP_MORE_HELP_TAB",e.HELP_DESKTOP_360_2A="HELP_DESKTOP_360_2A",e.HELP_DESKTOP_360_2B="HELP_DESKTOP_360_2B",e.HELP_DESKTOP_DOLLHOUSE_1A="HELP_DESKTOP_DOLLHOUSE_1A",e.HELP_DESKTOP_DOLLHOUSE_1B="HELP_DESKTOP_DOLLHOUSE_1B",e.HELP_DESKTOP_DOLLHOUSE_2A="HELP_DESKTOP_DOLLHOUSE_2A",e.HELP_DESKTOP_DOLLHOUSE_3A="HELP_DESKTOP_DOLLHOUSE_3A",e.HELP_DESKTOP_FLOORPLAN_1A="HELP_DESKTOP_FLOORPLAN_1A",e.HELP_DESKTOP_FLOORPLAN_2A="HELP_DESKTOP_FLOORPLAN_2A",e.HELP_DESKTOP_FLOORPLAN_2B="HELP_DESKTOP_FLOORPLAN_2B",e.HELP_DESKTOP_FLOORPLAN_3A="HELP_DESKTOP_FLOORPLAN_3A",e.HELP_DESKTOP_FLOORPLAN_3B="HELP_DESKTOP_FLOORPLAN_3B",e.HELP_DESKTOP_MORE_360_B="HELP_DESKTOP_MORE_360_B",e.HELP_DESKTOP_MORE_DOLLHOUSE_B="HELP_DESKTOP_MORE_DOLLHOUSE_B",e.HELP_DESKTOP_MORE_FLOORS_B="HELP_DESKTOP_MORE_FLOORS_B",e.HELP_DESKTOP_MORE_FULLSCREEN_B="HELP_DESKTOP_MORE_FULLSCREEN_B",e.HELP_DESKTOP_MORE_HLR_B="HELP_DESKTOP_MORE_HLR_B",e.HELP_DESKTOP_MORE_INSIDE_B="HELP_DESKTOP_MORE_INSIDE_B",e.HELP_DESKTOP_MORE_MATTERTAG_B="HELP_DESKTOP_MORE_MATTERTAG_B",e.HELP_DESKTOP_MORE_TOUR_B="HELP_DESKTOP_MORE_TOUR_B",e.HELP_DESKTOP_MORE_VR_B="HELP_DESKTOP_MORE_VR_B",e.HELP_DESKTOP_MORE_ZOOM_B="HELP_DESKTOP_MORE_ZOOM_B",e.HELP_DESKTOP_PANORAMA_1A="HELP_DESKTOP_PANORAMA_1A",e.HELP_DESKTOP_PANORAMA_1B="HELP_DESKTOP_PANORAMA_1B",e.HELP_DESKTOP_PANORAMA_2A="HELP_DESKTOP_PANORAMA_2A",e.HELP_DESKTOP_PANORAMA_2B="HELP_DESKTOP_PANORAMA_2B",e.HELP_DESKTOP_PANORAMA_3A="HELP_DESKTOP_PANORAMA_3A",e.HELP_DESKTOP_PANORAMA_3B="HELP_DESKTOP_PANORAMA_3B",e.HELP_MOBILE_3="HELP_MOBILE_3",e.HELP_MOBILE_360_2="HELP_MOBILE_360_2",e.HELP_MOBILE_DOLLHOUSE_1="HELP_MOBILE_DOLLHOUSE_1",e.HELP_MOBILE_DOLLHOUSE_2="HELP_MOBILE_DOLLHOUSE_2",e.HELP_MOBILE_FLOORPLAN_1="HELP_MOBILE_FLOORPLAN_1",e.HELP_MOBILE_FLOORPLAN_2="HELP_MOBILE_FLOORPLAN_2",e.HELP_MOBILE_MORE_360_B="HELP_MOBILE_MORE_360_B",e.HELP_MOBILE_MORE_DOLLHOUSE_B="HELP_MOBILE_MORE_DOLLHOUSE_B",e.HELP_MOBILE_MORE_INSIDE_B="HELP_MOBILE_MORE_INSIDE_B",e.HELP_MOBILE_MORE_MATTERTAG_B="HELP_MOBILE_MORE_MATTERTAG_B",e.HELP_MOBILE_MORE_VR_B="HELP_MOBILE_MORE_VR_B",e.HELP_MOBILE_PANORAMA_1="HELP_MOBILE_PANORAMA_1",e.HELP_MOBILE_PANORAMA_2="HELP_MOBILE_PANORAMA_2",e.HELP_MORE_360_A="HELP_MORE_360_A",e.HELP_MORE_DOLLHOUSE_A="HELP_MORE_DOLLHOUSE_A",e.HELP_MORE_FLOORS_A="HELP_MORE_FLOORS_A",e.HELP_MORE_FLOORPLAN_A="HELP_MORE_FLOORPLAN_A",e.HELP_MORE_FULLSCREEN_A="HELP_MORE_FULLSCREEN_A",e.HELP_MORE_HLR_A="HELP_MORE_HLR_A",e.HELP_MORE_INSIDE_A="HELP_MORE_INSIDE_A",e.HELP_MORE_MATTERTAG_A="HELP_MORE_MATTERTAG_A",e.HELP_MORE_TOUR_A="HELP_MORE_TOUR_A",e.HELP_MORE_VR_A="HELP_MORE_VR_A",e.HELP_MORE_ZOOM_A="HELP_MORE_ZOOM_A",e.VR_APP_INSTRUCT="VR_APP_INSTRUCT",e.VR_APP_RECCOMMENDED="VR_APP_RECCOMMENDED",e.VR_ENTER="VR_ENTER",e.VR_LEARN_MORE_CAPS="VR_LEARN_MORE_CAPS",e.VR_QUEST="VR_QUEST",e.VR_RECOMMENDED="VR_RECOMMENDED",e.VR_SUPPORTS="VR_SUPPORTS",e.VR_VIEW_SPACE="VR_VIEW_SPACE",e.ERROR_WEBGL_UNSUPPORTED_PROBLEM="ERROR_WEBGL_UNSUPPORTED_PROBLEM",e.ERROR_BROWSER_SOLUTION="ERROR_BROWSER_SOLUTION",e.ERROR_BROWSER_EXPLANATION="ERROR_BROWSER_EXPLANATION",e.ERROR_LOADING_FAILED_PROBLEM="ERROR_LOADING_FAILED_PROBLEM",e.ERROR_LOADING_FAILED_ACTIONS_1="ERROR_LOADING_FAILED_ACTIONS_1",e.ERROR_LOADING_FAILED_ACTIONS_2="ERROR_LOADING_FAILED_ACTIONS_2",e.ERROR_GENERIC_PROBLEM="ERROR_GENERIC_PROBLEM",e.ERROR_GENERIC_SOLUTION="ERROR_GENERIC_SOLUTION",e.ERROR_GENERIC_ACTIONS_1="ERROR_GENERIC_ACTIONS_1",e.ERROR_GENERIC_ACTIONS_2="ERROR_GENERIC_ACTIONS_2",e.ERROR_GENERIC_ACTIONS_3="ERROR_GENERIC_ACTIONS_3",e.ERROR_GENERIC_ACTIONS_4="ERROR_GENERIC_ACTIONS_4",e.DESKTOP_SHORT_CTA="DESKTOP_SHORT_CTA",e.MOBILE_SHORT_CTA="MOBILE_SHORT_CTA",e.ROTATE="ROTATE",e.MOVE="MOVE",e.PLAY="PLAY",e.INSIDE="INSIDE",e.ZOOM="ZOOM",e.MEASUREMENT="MEASUREMENT",e.MEASUREMENT_START_ADDING="MEASUREMENT_START_ADDING",e.MEASUREMENT_CONTINUOUS_LINES="MEASUREMENT_CONTINUOUS_LINES",e.MEASUREMENT_SNAPPING="MEASUREMENT_SNAPPING",e.MEASUREMENT_UNITS="MEASUREMENT_UNITS",e.MEASUREMENT_IMPERIAL="MEASUREMENT_IMPERIAL",e.MEASUREMENT_METRIC="MEASUREMENT_METRIC",e.MEASUREMENT_SETTINGS="MEASUREMENT_SETTINGS",e.MEASUREMENT_HELP_CLICK_ANYWHERE="MEASUREMENT_HELP_CLICK_ANYWHERE",e.MEASUREMENT_HELP_ESCAPE="MEASUREMENT_HELP_ESCAPE",e.MEASUREMENT_HELP_PRESS_START="MEASUREMENT_HELP_PRESS_START",e.MEASUREMENT_HELP_DRAG_EDIT="MEASUREMENT_HELP_DRAG_EDIT",e.MEASUREMENT_HELP_PRESS_END="MEASUREMENT_HELP_PRESS_END",e.MEASUREMENT_MODE="MEASUREMENT_MODE",e.MEASUREMENT_HELP_MODAL_SUB_HEADER="MEASUREMENT_HELP_MODAL_SUB_HEADER",e.MEASUREMENT_HELP_MODAL_BODY_1="MEASUREMENT_HELP_MODAL_BODY_1",e.MEASUREMENT_HELP_MODAL_BODY_2="MEASUREMENT_HELP_MODAL_BODY_2",e.MEASUREMENT_NUDGE_TITLE="MEASUREMENT_NUDGE_TITLE",e.MEASUREMENT_NUDGE_MESSAGE="MEASUREMENT_NUDGE_MESSAGE",e.ON="ON",e.OFF="OFF",e.CLOSE="CLOSE",e.COPY="COPY",e.COPY_URL="COPY_URL",e.SHARE="SHARE",e.SHARE_COPIED="SHARE_COPIED",e.SHARE_CURRENT_LOCATION="SHARE_CURRENT_LOCATION",e.SHARE_DEFAULT_LOCATION="SHARE_DEFAULT_LOCATION",e.SHARE_ERROR_SWEEP_DISABLED="SHARE_ERROR_SWEEP_DISABLED",e.SHARE_EXPLORE="SHARE_EXPLORE",e.SHARE_LINK_TO_LOCATION="SHARE_LINK_TO_LOCATION",e.SHARE_AT="SHARE_AT",e.SHARE_WITH="SHARE_WITH",e.SHARE_3D="SHARE_3D",e.SHARE_MODAL_TITLE="SHARE_MODAL_TITLE",e.SHARED_TITLE="SHARED_TITLE",e.SHARED_MESSAGE="SHARED_MESSAGE",e.SHARED_MESSAGE_HASHTAG="SHARED_MESSAGE_HASHTAG"}(s||(s={})),function(e){let t,i,s,n;!function(e){e.CLOSE_BUTTON_TOOLTIP_MESSAGE="REUSABLES.CLOSE_BUTTON_TOOLTIP_MESSAGE",e.HELP_BUTTON_TOOLTIP_MESSAGE="REUSABLES.HELP_BUTTON_TOOLTIP_MESSAGE"}(t=e.REUSABLES||(e.REUSABLES={})),function(e){let t;!function(e){e.TYPE="SHOWCASE.TAGS.TYPE",e.NUM_TYPE="SHOWCASE.TAGS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.DELETE_LIST_ITEM_OPTION_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EMPTY_LIST_MESSAGE="SHOWCASE.TAGS.EMPTY_LIST_MESSAGE"}(t=e.TAGS||(e.TAGS={}))}(i=e.SHOWCASE||(e.SHOWCASE={})),function(e){e.BLUR="TOOLS.BLUR",e.BLUR_HELP_MESSAGE="TOOLS.BLUR_HELP_MESSAGE",e.HLR="TOOLS.HLR",e.HLR_HELP_MESSAGE="TOOLS.HLR_HELP_MESSAGE",e.LABELS="TOOLS.LABELS",e.LABELS_HELP_MESSAGE="TOOLS.LABELS_HELP_MESSAGE",e.MATTERTAGS="TOOLS.MATTERTAGS",e.MATTERTAGS_HELP_MESSAGE="TOOLS.MATTERTAGS_HELP_MESSAGE",e.MEASUREMENTS="TOOLS.MEASUREMENTS",e.MEASUREMENTS_HELP_MESSAGE="TOOLS.MEASUREMENTS_HELP_MESSAGE",e.NOTES="TOOLS.NOTES",e.PHOTOS="TOOLS.PHOTOS",e.PHOTOS_HELP_MESSAGE="TOOLS.PHOTOS_HELP_MESSAGE",e.SCANS_3D="TOOLS.SCANS_3D",e.SCANS_3D_HELP_MESSAGE="TOOLS.SCANS_3D_HELP_MESSAGE",e.SETTINGS_PANEL="TOOLS.SETTINGS_PANEL",e.START_LOCATION="TOOLS.START_LOCATION",e.START_LOCATION_HELP_MESSAGE="TOOLS.START_LOCATION_HELP_MESSAGE",e.TAGS="TOOLS.TAGS",e.VIEW_360="TOOLS.VIEW_360",e.VIEW_360_HELP_MESSAGE="TOOLS.VIEW_360_HELP_MESSAGE",e.VR_PATH="TOOLS.VR_PATH",e.VR_PATH_HELP_MESSAGE="TOOLS.VR_PATH_HELP_MESSAGE"}(s=e.TOOLS||(e.TOOLS={})),function(e){let t,i,s,n,o,r,a,l,c,h,d,u,p,m,g,f;!function(e){e.DELETE_SELECTED_CTA="WORKSHOP.ACCORDION.DELETE_SELECTED_CTA",e.SELECT_ALL_CTA="WORKSHOP.ACCORDION.SELECT_ALL_CTA",e.ENTER_SELECT_MODE_CTA="WORKSHOP.ACCORDION.ENTER_SELECT_MODE_CTA",e.EXIT_SELECT_MODE_CTA="WORKSHOP.ACCORDION.EXIT_SELECT_MODE_CTA",e.DELETE_FOOTER_CTA="WORKSHOP.ACCORDION.DELETE_FOOTER_CTA",e.TOGGLE_VISIBILITY_FOOTER_CTA="WORKSHOP.ACCORDION.TOGGLE_VISIBILITY_FOOTER_CTA",e.BATCH_DELETE_MODAL_TITLE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_TITLE",e.BATCH_DELETE_MODAL_MESSAGE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_MESSAGE",e.RENAME_HEADER_OPTION_CTA="WORKSHOP.ACCORDION.RENAME_HEADER_OPTION_CTA"}(t=e.ACCORDION||(e.ACCORDION={})),function(e){e.CHANGES_SAVED_MESSAGE="WORKSHOP.APP_SWITCH.CHANGES_SAVED_MESSAGE",e.EDIT_CTA="WORKSHOP.APP_SWITCH.EDIT_CTA",e.UNSUPPORTED_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_MESSAGE",e.UNSUPPORTED_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_TITLE",e.PRIVATE_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_MESSAGE",e.PRIVATE_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_MESSAGE",e.PUBLISH_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISH_CHANGES_CTA",e.PUBLISHING_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISHING_CHANGES_CTA",e.REVERT_CHANGES_MODAL_TITLE="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_TITLE",e.REVERT_CHANGES_MODAL_HEADER="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_HEADER",e.REVERT_CHANGES_MODAL_EXPLANATION="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_EXPLANATION",e.REVERT_CHANGES_MODAL_WARNING="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_WARNING",e.REVERT_CHANGES_MODAL_LEARN_MORE_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_LEARN_MORE_CTA",e.REVERT_CHANGES_MODAL_CANCEL_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_CANCEL_CTA",e.REVERT_CHANGES_MODAL_REVERT_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_REVERT_CTA",e.FLOORS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.FLOORS_CHECKBOX_LABEL",e.MEASUREMENTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MEASUREMENTS_CHECKBOX_LABEL",e.MATTERTAGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MATTERTAGS_CHECKBOX_LABEL",e.LABELS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.LABELS_CHECKBOX_LABEL",e.HIGHLIGHTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.HIGHLIGHTS_CHECKBOX_LABEL",e.START_LOCATION_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.START_LOCATION_CHECKBOX_LABEL",e.SETTINGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SETTINGS_CHECKBOX_LABEL",e.SWEEPS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SWEEPS_CHECKBOX_LABEL",e.BLURS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.BLURS_CHECKBOX_LABEL",e.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL",e.EXIT_EDIT_MODE_CTA="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_CTA",e.EXIT_EDIT_MODE_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_TOOLTIP_MESSAGE",e.DISCARD_CHANGES_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.DISCARD_CHANGES_TOOLTIP_MESSAGE",e.PREVIEW_CHANGES_CTA="WORKSHOP.APP_SWITCH.PREVIEW_CHANGES_CTA",e.TIMESTAMP_UNPUBLISHED_CHANGES="WORKSHOP.APP_SWITCH.TIMESTAMP_UNPUBLISHED_CHANGES",e.TIMESTAMP_GREATER_THAN_ONE_MONTH="WORKSHOP.APP_SWITCH.TIMESTAMP_GREATER_THAN_ONE_MONTH",e.TIMESTAMP_DAY="WORKSHOP.APP_SWITCH.TIMESTAMP_DAY",e.TIMESTAMP_HOUR="WORKSHOP.APP_SWITCH.TIMESTAMP_HOUR",e.TIMESTAMP_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_MINUTE",e.TIMESTAMP_LESS_THAN_ONE_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_LESS_THAN_ONE_MINUTE",e.TIMESTAMP_LAST_PUBLISHED_MESSAGE="WORKSHOP.APP_SWITCH.TIMESTAMP_LAST_PUBLISHED_MESSAGE",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNAUTHORIZED_ERROR_MESSAGE"}(i=e.APP_SWITCH||(e.APP_SWITCH={})),function(e){e.TYPE="WORKSHOP.BLURS.TYPE",e.NUM_TYPE="WORKSHOP.BLURS.NUM_TYPE",e.APPLY_BLURS_CTA="WORKSHOP.BLURS.APPLY_BLURS_CTA",e.OVERLAY_MESSAGE="WORKSHOP.BLURS.OVERLAY_MESSAGE",e.CREATE_TOOLTIP_TITLE="WORKSHOP.BLURS.CREATE_TOOLTIP_TITLE",e.CREATE_TOOLTIP_MESSAGE="WORKSHOP.BLURS.CREATE_TOOLTIP_MESSAGE",e.BRUSH_TOOLTIP_TITLE="WORKSHOP.BLURS.BRUSH_TOOLTIP_TITLE",e.BRUSH_TOOLTIP_MESSAGE="WORKSHOP.BLURS.BRUSH_TOOLTIP_MESSAGE",e.DELETE_BLUR_CTA="WORKSHOP.BLURS.DELETE_BLUR_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.SINGLE_FLOOR_EMPTY_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.BLURS.OTHER_GROUP_LABEL",e.DEFAULT_FLOOR_NAME="WORKSHOP.BLURS.DEFAULT_FLOOR_NAME",e.DEFAULT_BLUR_NAME="WORKSHOP.BLURS.DEFAULT_BLUR_NAME",e.DEFAULT_ALERT_TITLE="WORKSHOP.BLURS.DEFAULT_ALERT_TITLE",e.DEFAULT_ALERT_CONFIRMATION="WORKSHOP.BLURS.DEFAULT_ALERT_CONFIRMATION",e.ALREADY_PROCESSING_ALERT_MESSAGE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_MESSAGE",e.ALREADY_PROCESSING_ALERT_TITLE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_TITLE",e.BLUR_STATUS_PROCESSING="WORKSHOP.BLURS.BLUR_STATUS_PROCESSING",e.BLUR_STATUS_SUGGESTED="WORKSHOP.BLURS.BLUR_STATUS_SUGGESTED",e.BLUR_STATUS_APPLIED="WORKSHOP.BLURS.BLUR_STATUS_APPLIED",e.BLUR_STATUS_FAILED="WORKSHOP.BLURS.BLUR_STATUS_FAILED",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.APPLY_MODAL_TITLE="WORKSHOP.BLURS.APPLY_MODAL_TITLE",e.APPLY_MODAL_MESSAGE="WORKSHOP.BLURS.APPLY_MODAL_MESSAGE",e.APPLY_MODAL_WARNING="WORKSHOP.BLURS.APPLY_MODAL_WARNING",e.APPLY_MODAL_CONFIRM="WORKSHOP.BLURS.APPLY_MODAL_CONFIRM",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.BLURS.UNAUTHORIZED_ERROR_MESSAGE"}(s=e.BLURS||(e.BLURS={})),function(e){e.HELP_LINK="WORKSHOP.EDIT_BAR.HELP_LINK",e.BETA_TAG="WORKSHOP.EDIT_BAR.BETA_TAG",e.COLLAPSE_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.COLLAPSE_LIST_TOOLTIP_MESSAGE",e.EXPAND_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.EXPAND_LIST_TOOLTIP_MESSAGE"}(n=e.EDIT_BAR||(e.EDIT_BAR={})),function(e){e.TYPE="WORKSHOP.HLR.TYPE",e.NUM_TYPE="WORKSHOP.HLR.NUM_TYPE",e.ADD_HIGHLIGHT_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_CTA",e.ADD_HIGHLIGHT_DISABLED_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_DISABLED_CTA",e.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE="WORKSHOP.HLR.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE",e.SCAN_NOT_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NOT_HIDDEN_TOOLTIP_TITLE",e.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE",e.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE",e.ADD_HIGHLIGHT_INSTRUCTIONS="WORKSHOP.HLR.ADD_HIGHLIGHT_INSTRUCTIONS",e.DISMISS_TOOLTIP_CTA="WORKSHOP.HLR.DISMISS_TOOLTIP_CTA",e.TOAST_ERROR_MESSAGE="WORKSHOP.HLR.TOAST_ERROR_MESSAGE",e.TOAST_ERROR_CTA="WORKSHOP.HLR.TOAST_ERROR_CTA",e.CLEAR_HLR_MODAL_TITLE="WORKSHOP.HLR.CLEAR_HLR_MODAL_TITLE",e.CLEAR_HLR_MODAL_MESSAGE="WORKSHOP.HLR.CLEAR_HLR_MODAL_MESSAGE",e.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE",e.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE",e.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE",e.TRANSITION_SETTING_SLIDESHOW="WORKSHOP.HLR.TRANSITION_SETTING_SLIDESHOW",e.TRANSITION_SETTING_WALKTHROUGH="WORKSHOP.HLR.TRANSITION_SETTING_WALKTHROUGH",e.EDIT_SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_SETTINGS_TOOLTIP_MESSAGE",e.CLEAR_REEL_CTA="WORKSHOP.HLR.CLEAR_REEL_CTA",e.PAN_DIRECTION_SETTING_AUTO="WORKSHOP.HLR.PAN_DIRECTION_SETTING_AUTO",e.PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LABEL",e.PAN_DIRECTION_SETTING_LEFT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LEFT",e.PAN_DIRECTION_SETTING_RIGHT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_RIGHT",e.ROTATION_ANGLE_SETTING_LABEL="WORKSHOP.HLR.ROTATION_ANGLE_SETTING_LABEL",e.ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.ROTATION_SPEED_SETTING_LABEL",e.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL",e.SPEED_SETTING_FAST="WORKSHOP.HLR.SPEED_SETTING_FAST",e.SPEED_SETTING_MEDIUM="WORKSHOP.HLR.SPEED_SETTING_MEDIUM",e.SPEED_SETTING_SLOW="WORKSHOP.HLR.SPEED_SETTING_SLOW",e.SLIDESHOW_SPEED_SETTING_LABEL="WORKSHOP.HLR.SLIDESHOW_SPEED_SETTING_LABEL",e.WALKTHROUGH_SPEED_SETTING_LABEL="WORKSHOP.HLR.WALKTHROUGH_SPEED_SETTING_LABEL",e.ZOOM_SPEED_SETTING_LABEL="WORKSHOP.HLR.ZOOM_SPEED_SETTING_LABEL",e.TRANSITION_SETTING_LABEL="WORKSHOP.HLR.TRANSITION_SETTING_LABEL",e.INDIVIDUAL_TRANSITION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_TRANSITION_SETTING_LABEL",e.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL",e.SETTINGS_MODAL_TITLE="WORKSHOP.HLR.SETTINGS_MODAL_TITLE",e.PANNING_SETTINGS_TAB_TITLE="WORKSHOP.HLR.PANNING_SETTINGS_TAB_TITLE",e.TRANSITION_SETTINGS_TAB_TITLE="WORKSHOP.HLR.TRANSITION_SETTINGS_TAB_TITLE",e.CLOSE_SETTINGS_CTA="WORKSHOP.HLR.CLOSE_SETTINGS_CTA",e.PREVIEW_SETTINGS_CTA="WORKSHOP.HLR.PREVIEW_SETTINGS_CTA",e.RESTORE_DEFAULTS_CTA="WORKSHOP.HLR.RESTORE_DEFAULTS_CTA",e.TRANSITION_IS_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_IS_360_DISABLED_MESSAGE",e.TRANSITION_AFTER_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_AFTER_360_DISABLED_MESSAGE",e.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE",e.TRANSITION_NO_ROTATION_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_NO_ROTATION_DISABLED_MESSAGE",e.TRANSITION_EDITOR_TITLE="WORKSHOP.HLR.TRANSITION_EDITOR_TITLE",e.HIGHLIGHT_CAPTION_HINT="WORKSHOP.HLR.HIGHLIGHT_CAPTION_HINT",e.HIGHLIGHT_CAPTION_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_CAPTION_PLACEHOLDER",e.APPLY_TO_ALL_CTA="WORKSHOP.HLR.APPLY_TO_ALL_CTA"}(o=e.HLR||(e.HLR={})),function(e){e.TYPE="WORKSHOP.LABELS.TYPE",e.NUM_TYPE="WORKSHOP.LABELS.NUM_TYPE",e.DEFAULT_INPUT_TEXT="WORKSHOP.LABELS.DEFAULT_INPUT_TEXT",e.INPUT_PLACEHOLDER="WORKSHOP.LABELS.INPUT_PLACEHOLDER",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.LABELS.MOBILE_OVERLAY_MESSAGE",e.ADD_LABEL_TOOLTIP_MESSAGE="WORKSHOP.LABELS.ADD_LABEL_TOOLTIP_MESSAGE",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.LABELS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.SINGLE_FLOOR_EMPTY_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE"}(r=e.LABELS||(e.LABELS={})),function(e){e.KITCHEN="WORKSHOP.LABEL_SUGGESTIONS.KITCHEN",e.PRIMARY_BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BEDROOM",e.BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.BEDROOM",e.PRIMARY_BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BATHROOM",e.BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.BATHROOM",e.LIVING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LIVING_ROOM",e.FAMILY_ROOM="WORKSHOP.LABEL_SUGGESTIONS.FAMILY_ROOM",e.DINING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.DINING_ROOM",e.PATIO="WORKSHOP.LABEL_SUGGESTIONS.PATIO",e.BALCONY="WORKSHOP.LABEL_SUGGESTIONS.BALCONY",e.BACKYARD="WORKSHOP.LABEL_SUGGESTIONS.BACKYARD",e.FRONT_YARD="WORKSHOP.LABEL_SUGGESTIONS.FRONT_YARD",e.HALLWAY="WORKSHOP.LABEL_SUGGESTIONS.HALLWAY",e.LAUNDRY="WORKSHOP.LABEL_SUGGESTIONS.LAUNDRY",e.PANTRY="WORKSHOP.LABEL_SUGGESTIONS.PANTRY",e.CLOSET="WORKSHOP.LABEL_SUGGESTIONS.CLOSET",e.GARAGE="WORKSHOP.LABEL_SUGGESTIONS.GARAGE",e.DRIVEWAY="WORKSHOP.LABEL_SUGGESTIONS.DRIVEWAY",e.BASEMENT="WORKSHOP.LABEL_SUGGESTIONS.BASEMENT",e.FACADE="WORKSHOP.LABEL_SUGGESTIONS.FACADE",e.GARDEN="WORKSHOP.LABEL_SUGGESTIONS.GARDEN",e.LOBBY="WORKSHOP.LABEL_SUGGESTIONS.LOBBY",e.OFFICE="WORKSHOP.LABEL_SUGGESTIONS.OFFICE",e.POOL="WORKSHOP.LABEL_SUGGESTIONS.POOL",e.UNFURNISHED="WORKSHOP.LABEL_SUGGESTIONS.UNFURNISHED",e.STAIRWAY="WORKSHOP.LABEL_SUGGESTIONS.STAIRWAY",e.ELEVATOR="WORKSHOP.LABEL_SUGGESTIONS.ELEVATOR",e.ESCALATOR="WORKSHOP.LABEL_SUGGESTIONS.ESCALATOR",e.STUDY="WORKSHOP.LABEL_SUGGESTIONS.STUDY",e.SPA="WORKSHOP.LABEL_SUGGESTIONS.SPA",e.RECEPTION="WORKSHOP.LABEL_SUGGESTIONS.RECEPTION",e.MEETING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.MEETING_ROOM",e.STORAGE="WORKSHOP.LABEL_SUGGESTIONS.STORAGE",e.BREAK_ROOM="WORKSHOP.LABEL_SUGGESTIONS.BREAK_ROOM",e.LUNCH_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LUNCH_ROOM",e.CONFERENCE_ROOM="WORKSHOP.LABEL_SUGGESTIONS.CONFERENCE_ROOM"}(a=e.LABEL_SUGGESTIONS||(e.LABEL_SUGGESTIONS={})),function(e){e.TYPE="WORKSHOP.MATTERTAGS.TYPE",e.NUM_TYPE="WORKSHOP.MATTERTAGS.NUM_TYPE",e.EDIT_BILLBOARD_CANCEL_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_CANCEL_CTA",e.EDIT_BILLBOARD_DONE_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_DONE_CTA",e.LINK_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_TOOLTIP_MESSAGE",e.LINK_DISABLED_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_DISABLED_TOOLTIP_MESSAGE",e.COLOR_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.COLOR_TOOLTIP_MESSAGE",e.STEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.STEM_TOOLTIP_MESSAGE",e.MEDIA_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_TOOLTIP_MESSAGE",e.HIDE_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_TOOLTIP_MESSAGE",e.SHOW_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_TOOLTIP_MESSAGE",e.TITLE_PLACEHOLDER="WORKSHOP.MATTERTAGS.TITLE_PLACEHOLDER",e.DESCRIPTION_PLACEHOLDER="WORKSHOP.MATTERTAGS.DESCRIPTION_PLACEHOLDER",e.STEM_SLIDER_RESET_CTA="WORKSHOP.MATTERTAGS.STEM_SLIDER_RESET_CTA",e.SHOW_STEM_LABEL="WORKSHOP.MATTERTAGS.SHOW_STEM_LABEL",e.MEDIA_LINK_LABEL="WORKSHOP.MATTERTAGS.MEDIA_LINK_LABEL",e.MEDIA_LINK_SUPPORTED_FORMATS_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_SUPPORTED_FORMATS_LINK",e.MEDIA_LINK_APPLY_CTA="WORKSHOP.MATTERTAGS.MEDIA_LINK_APPLY_CTA",e.MEDIA_LINK_ERROR_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_ERROR_MESSAGE",e.MEDIA_LINK_HELP_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_HELP_LINK",e.MEDIA_LINK_LOADING_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_LOADING_MESSAGE",e.MEDIA_LINK_INVALID_URL_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_INVALID_URL_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.DEFAULT_LIST_ITEM_TEXT="WORKSHOP.MATTERTAGS.DEFAULT_LIST_ITEM_TEXT",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.DELETE_LIST_ITEM_OPTION_CTA",e.ADD_MATTERTAG_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.ADD_MATTERTAG_TOOLTIP_MESSAGE",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.MATTERTAGS.MOBILE_OVERLAY_MESSAGE",e.DELETE_MATTERTAGS_MODAL_TITLE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_TITLE",e.DELETE_MATTERTAGS_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_MESSAGE",e.DISCARD_MATTERTAG_MODAL_TITLE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_TITLE",e.DISCARD_MATTERTAG_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_MESSAGE"}(l=e.MATTERTAGS||(e.MATTERTAGS={})),function(e){e.TYPE="WORKSHOP.MEASUREMENTS.TYPE",e.NUM_TYPE="WORKSHOP.MEASUREMENTS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.MEASUREMENTS.OTHER_GROUP_LABEL",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.MEASUREMENTS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.SINGLE_FLOOR_EMPTY_MESSAGE"}(c=e.MEASUREMENTS||(e.MEASUREMENTS={})),function(e){e.ERROR_TITLE="WORKSHOP.MODAL.ERROR_TITLE",e.SAVING_ERROR_TITLE="WORKSHOP.MODAL.SAVING_ERROR_TITLE",e.SAVING_ERROR_MESSAGE="WORKSHOP.MODAL.SAVING_ERROR_MESSAGE",e.NO="WORKSHOP.MODAL.NO",e.YES="WORKSHOP.MODAL.YES",e.CANCEL="WORKSHOP.MODAL.CANCEL",e.OK="WORKSHOP.MODAL.OK",e.DISCARD="WORKSHOP.MODAL.DISCARD",e.SAVE="WORKSHOP.MODAL.SAVE"}(h=e.MODAL||(e.MODAL={})),function(e){e.TYPE="WORKSHOP.PHOTOS.TYPE",e.NUM_TYPE="WORKSHOP.PHOTOS.NUM_TYPE",e.ADD_PHOTOS_CTA="WORKSHOP.PHOTOS.ADD_PHOTOS_CTA",e.ADDING_PHOTOS_CTA="WORKSHOP.PHOTOS.ADDING_PHOTOS_CTA",e.MODAL_TITLE="WORKSHOP.PHOTOS.MODAL_TITLE",e.NUM_SELECTED="WORKSHOP.PHOTOS.NUM_SELECTED",e.SELECT_ALL_CTA="WORKSHOP.PHOTOS.SELECT_ALL_CTA",e.UNSELECT_ALL_CTA="WORKSHOP.PHOTOS.UNSELECT_ALL_CTA",e.SAVING_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVING_TOAST_MESSAGE",e.SAVED_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVED_TOAST_MESSAGE",e.SAVED_TOAST_CTA="WORKSHOP.PHOTOS.SAVED_TOAST_CTA",e.ERROR_MODAL_TITLE="WORKSHOP.PHOTOS.ERROR_MODAL_TITLE",e.ERROR_MODAL_MESSAGE="WORKSHOP.PHOTOS.ERROR_MODAL_MESSAGE",e.CAMERA_PITCH_RESET_MESSAGE="WORKSHOP.PHOTOS.CAMERA_PITCH_RESET_MESSAGE",e.ZOOM_RESET_MESSAGE="WORKSHOP.PHOTOS.ZOOM_RESET_MESSAGE",e.ZOOM_IN_MESSAGE="WORKSHOP.PHOTOS.ZOOM_IN_MESSAGE",e.ZOOM_OUT_MESSAGE="WORKSHOP.PHOTOS.ZOOM_OUT_MESSAGE",e.CANNOT_SAVE_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_MESSAGE",e.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE",e.CANNOT_SAVE_TOOLTIP_TITLE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_TITLE",e.CANNOT_SAVE_TOOLTIP_CTA="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_CTA",e.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE",e.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.PANO_CTA="WORKSHOP.PHOTOS.PANO_CTA",e.SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.SETTINGS_TOOLTIP_MESSAGE",e.ASSETS_SETTING_LABEL="WORKSHOP.PHOTOS.ASSETS_SETTING_LABEL",e.SHOW_GRID_SETTING_LABEL="WORKSHOP.PHOTOS.SHOW_GRID_SETTING_LABEL",e.SNAPSHOT_ERROR_TOAST_MESSAGE="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_MESSAGE",e.SNAPSHOT_ERROR_TOAST_CTA="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_CTA"}(d=e.PHOTOS||(e.PHOTOS={})),function(e){e.TYPE="WORKSHOP.SCANS.TYPE",e.NUM_TYPE="WORKSHOP.SCANS.NUM_TYPE",e.BATCH_SHOW_CTA="WORKSHOP.SCANS.BATCH_SHOW_CTA",e.BATCH_HIDE_CTA="WORKSHOP.SCANS.BATCH_HIDE_CTA",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.LIST_ITEM_TEXT="WORKSHOP.SCANS.LIST_ITEM_TEXT",e.FLOOR_EMPTY_MESSAGE="WORKSHOP.SCANS.FLOOR_EMPTY_MESSAGE",e.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.HLR_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HLR_LIST_ITEM_TOOLTIP_MESSAGE",e.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE",e.OVERLAY_HIDE_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_CTA",e.OVERLAY_SHOW_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_CTA",e.OVERLAY_PANORAMA_INFO="WORKSHOP.SCANS.OVERLAY_PANORAMA_INFO",e.OVERLAY_INFO="WORKSHOP.SCANS.OVERLAY_INFO",e.START_LOCATION_TOOLTIP_TITLE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_TITLE",e.START_LOCATION_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_MESSAGE",e.START_LOCATION_TOOLTIP_CTA="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_CTA",e.REMOVE_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_TITLE",e.REMOVE_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_MESSAGE",e.REMOVE_HLR_MODAL_BATCH_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_BATCH_MESSAGE",e.REMOVE_HLR_MODAL_WARNING="WORKSHOP.SCANS.REMOVE_HLR_MODAL_WARNING",e.REMOVE_SCANS_FROM_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_SCANS_FROM_HLR_MODAL_TITLE",e.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE"}(u=e.SCANS||(e.SCANS={})),function(e){e.NAV_OPTION_PRESENTATION="WORKSHOP.SETTINGS.NAV_OPTION_PRESENTATION",e.NAV_OPTION_TOUR_HLR="WORKSHOP.SETTINGS.NAV_OPTION_TOUR_HLR",e.NAV_OPTION_UNITS="WORKSHOP.SETTINGS.NAV_OPTION_UNITS",e.NAV_OPTION_ADVANCED="WORKSHOP.SETTINGS.NAV_OPTION_ADVANCED",e.SHOW_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.SHOW_LABELS_IN_DOLLHOUSE_OPTION",e.HIDE_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.HIDE_LABELS_IN_DOLLHOUSE_OPTION",e.SHOW_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.SHOW_SAVED_MEASUREMENTS_OPTION",e.HIDE_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.HIDE_SAVED_MEASUREMENTS_OPTION",e.UNITS_HEADER="WORKSHOP.SETTINGS.UNITS_HEADER",e.UNITS_SUBHEADER="WORKSHOP.SETTINGS.UNITS_SUBHEADER",e.UNITS_IMPERIAL_CTA="WORKSHOP.SETTINGS.UNITS_IMPERIAL_CTA",e.UNITS_METRIC_CTA="WORKSHOP.SETTINGS.UNITS_METRIC_CTA",e.TOUR_AND_HLR_HEADER="WORKSHOP.SETTINGS.TOUR_AND_HLR_HEADER",e.TOUR_OPTION_LABEL="WORKSHOP.SETTINGS.TOUR_OPTION_LABEL",e.TOUR_OPTION_MESSAGE="WORKSHOP.SETTINGS.TOUR_OPTION_MESSAGE",e.HLR_OPTION_LABEL="WORKSHOP.SETTINGS.HLR_OPTION_LABEL",e.HLR_OPTION_MESSAGE="WORKSHOP.SETTINGS.HLR_OPTION_MESSAGE",e.ADVANCED_HEADER="WORKSHOP.SETTINGS.ADVANCED_HEADER",e.ADVANCED_DOLLHOUSE_LABEL="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_LABEL",e.ADVANCED_DOLLHOUSE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_MESSAGE",e.ADVANCED_FLOORPLAN_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_LABEL",e.ADVANCED_FLOORPLAN_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_MESSAGE",e.ADVANCED_ROOM_LABELS_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_LABEL",e.ADVANCED_ROOM_LABELS_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MESSAGE",e.ADVANCED_FLOOR_SELECTION_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_LABEL",e.ADVANCED_FLOOR_SELECTION_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_MESSAGE",e.ADVANCED_MEASUREMENT_MODE_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_LABEL",e.ADVANCED_MEASUREMENT_MODE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MESSAGE",e.ADVANCED_ROOM_LABELS_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MENU_LABEL",e.ADVANCED_MEASUREMENT_MODE_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MENU_LABEL",e.PRESENTATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_HEADER",e.PRESENTATION_INFORMATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_HEADER",e.PRESENTATION_INFORMATION_EVERYTHING_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_LABEL",e.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE",e.PRESENTATION_INFORMATION_COMPACT_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_LABEL",e.PRESENTATION_INFORMATION_COMPACT_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_MESSAGE",e.PRESENTATION_INFORMATION_NONE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_NONE_LABEL",e.PRESENTATION_BACKGROUND_HEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_HEADER",e.PRESENTATION_BACKGROUND_SUBHEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_SUBHEADER",e.PRESENTATION_BACKGROUND_BLACK_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_BLACK_LABEL",e.PRESENTATION_BACKGROUND_GREY_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_GREY_LABEL",e.PRESENTATION_BACKGROUND_WHITE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_WHITE_LABEL"}(p=e.SETTINGS||(e.SETTINGS={})),function(e){e.ENABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.ENABLED_TOOLTIP_TITLE",e.DISABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.DISABLED_TOOLTIP_TITLE",e.HIDDEN_SWEEP_MESSAGE="WORKSHOP.START_LOCATION.HIDDEN_SWEEP_MESSAGE",e.UNPLACED_360_MESSAGE="WORKSHOP.START_LOCATION.UNPLACED_360_MESSAGE",e.ENABLED_MESSAGE="WORKSHOP.START_LOCATION.ENABLED_MESSAGE",e.TOOLTIP_CTA="WORKSHOP.START_LOCATION.TOOLTIP_CTA",e.SET_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SET_NEW_LOCATION_CTA",e.SETTING_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SETTING_NEW_LOCATION_CTA",e.THUMBNAIL_PREVIEW_CTA="WORKSHOP.START_LOCATION.THUMBNAIL_PREVIEW_CTA"}(m=e.START_LOCATION||(e.START_LOCATION={})),function(e){e.START_LOCATION_REMOVAL_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_REMOVAL_MESSAGE",e.START_LOCATION_MARKER_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_MARKER_MESSAGE",e.DEFAULT_NAME="WORKSHOP.VIEWS_360.DEFAULT_NAME",e.OVERLAY_MESSAGE="WORKSHOP.VIEWS_360.OVERLAY_MESSAGE",e.OVERLAY_INFO_MISSING_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_MISSING_SWEEP",e.OVERLAY_INFO_CURRENT_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_CURRENT_SWEEP",e.OVERLAY_INFO_SELECTED_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_SELECTED_SWEEP",e.ROTATE_TOOLTIP_TITLE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_TITLE",e.ROTATE_TOOLTIP_MESSAGE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_MESSAGE",e.ROTATE_TOOLTIP_CTA="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_CTA",e.UNPLACED_CARD_MESSAGE="WORKSHOP.VIEWS_360.UNPLACED_CARD_MESSAGE",e.RENAME_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.RENAME_ITEM_OPTION_CTA",e.REMOVE_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.REMOVE_ITEM_OPTION_CTA",e.NO_VIEWS_MESSAGE="WORKSHOP.VIEWS_360.NO_VIEWS_MESSAGE"}(g=e.VIEWS_360||(e.VIEWS_360={})),function(e){e.TOAST_MESSAGE="WORKSHOP.VR.TOAST_MESSAGE",e.TOAST_CTA="WORKSHOP.VR.TOAST_CTA"}(f=e.VR||(e.VR={}))}(n=e.WORKSHOP||(e.WORKSHOP={}))}(s||(s={}));const n=s},79994:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s=i(54122),n=i(39936),o=i(25799),r=i(54078),a=i(21265),l=i(55656);async function c(e,t){const i="./locale/strings-"+e+".json",s=await t.get(i);return JSON.parse(s)}const h=new o.Z("Locale");class d extends s.Y{constructor(){super(...arguments),this.name="locale",this._languageCode=l.a}async init(e,t){const i=(await t.market.waitForData(n.e)).tryGetProperty("lang",(0,a.ht)());l.B.hasOwnProperty(i)&&(this._languageCode=l.B[i]);const s=this._languageCode.substr(0,2);this.polyglot=new r({locale:s,interpolation:{prefix:"%{",suffix:"}"},onMissingKey:e=>(h.warn("Missing phrase key:"+e),d.missingPrefix+e)});const o=await async function(e,t){const i=await c(e,t);if(e===l.a)return i;const s=await c(l.a,t);return Object.assign(Object.assign({},s),i)}(this._languageCode,e.queue);this.polyglot.extend(o)}t(e,t){return this.polyglot.t(e,t)}get languageCode(){return this._languageCode}}d.missingPrefix="FIX-"},36168:(e,t,i)=>{"use strict";i.d(t,{$:()=>r});var s=i(45296),n=i(87694),o=i(28615);class r{constructor(e){this.modelSID=e.model,this.capabilites={links:{enable:e.supportLinks,keepLabels:e.keepLinkLabels}}}parse(e){const t=[];return e?(e.split("[").map((function(e,t){return 0===t?e:"["+e})).forEach((e=>{const i=this.findLink(e);i?-1===i.url.indexOf("javascript:")&&(this.addLinkChunk(t,i),this.addTextChunk(t,e.slice(i.markdown.length))):this.addTextChunk(t,e)})),t):[]}findLink(e){const t=e.match(/\[([^\]]*)\]\((.*)\)/);if(!t)return null;const i=t[2];let s=1,n=0;for(;n<i.length&&("("===i[n]?s++:")"===i[n]&&s--,0!==s);)n++;const o=i.length-n;return{markdown:t[0].substring(0,t[0].length-o),label:t[1],url:this.conditionallyEncode(t[2].substring(0,n))}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}addTextChunk(e,t){0!==t.length&&e.push({type:o.z.text,text:t})}addLinkChunk(e,t){if(!this.capabilites.links.enable)return void(this.capabilites.links.keepLabels&&this.addTextChunk(e,t.label));const i={label:t.label,url:t.url,type:s.U.EXT_LINK};-1===i.url.indexOf("://")&&(i.url="http://"+i.url);const r=-1!==i.url.indexOf("matterport.com/show"),a=-1!==i.url.indexOf(window.location.host+"/show");if(r||a){const e=-1!==i.url.indexOf(this.modelSID),t=n.K.deserialize(i.url);e&&t?(i.type=s.U.NAVIGATION,i.navigationData=t):(i.type=s.U.MODEL,i.url+="&play=1")}e.push({type:o.z.link,link:i})}}},45296:(e,t,i)=>{"use strict";var s;i.d(t,{U:()=>s}),function(e){e[e.NAVIGATION=0]="NAVIGATION",e[e.MODEL=1]="MODEL",e[e.EXT_LINK=2]="EXT_LINK"}(s||(s={})),s.NAVIGATION,s.MODEL,s.EXT_LINK},28615:(e,t,i)=>{"use strict";var s;i.d(t,{z:()=>s}),function(e){e.text="text",e.link="link",e.photo="photo",e.video="video",e.rich="rich",e.none="none",e.error="error"}(s||(s={})),function(e){e.parse=t=>null!==t&&t in e?e[t]:e.none}(s||(s={}))},54733:(e,t,i)=>{"use strict";i.d(t,{V:()=>s,s:()=>l});var s,n=i(20983),o=i(43084),r=i(4292),a=i(28615);!function(e){e.OVERLAY="overlay",e.HOVER="hover",e.OPEN="open"}(s||(s={}));class l{constructor(){this.handlers=[{msgType:r.QY,func:(e,t,i)=>{const s=i.tryGetData(n.n),r=i.tryGetData(o.P5);if(!s||!r)return;const l=s.getTagCount(),c=r.getVisitedTags().length,h=r.getViewedTagCount(),d=s.getTag(t.sid);d&&e.track("tag_opened",{tag_count:l,tag_id:t.sid,tags_visited:c,tag_view_count:h,has_media:d.mediaType!==a.z.none})}},{msgType:r.dJ,func:(e,t,i)=>{const s=i.tryGetData(n.n),r=i.tryGetData(o.P5);if(!s||!r)return;const a=s.getTagCount(),l=r.getVisitedTags().length,c=r.getViewedTagCount(),h=s.getTag(t.sid);if(h){const i={mattertag_sid:t.sid,mattertag_view:t.view,mattertag_media:h.mediaType,mattertags_count:a,mattertags_total_views:c,mattertags_visited:l};e.track("mattertag_view",i)}}}]}}},2692:(e,t,i)=>{"use strict";i.d(t,{c:()=>l,M:()=>c});var s=i(99681),n=i(20983),o=i(2212),r=i(89155),a=i(75195);class l extends s.m{constructor(e){super(),this.id="MATTERTAG_DISC_POSITIONS",this.payload={tags:e}}}const c=async(e,t,i)=>{Promise.all([e.market.waitForData(n.n),e.market.waitForData(r.M_)]).then((([e,i])=>{const s=[],n={},r={},c=new o.Pa4;t.addBinding(l,(async t=>(s.length=0,t.tags.forEach((t=>{const l=e.getTag(t);l&&(r[t]||(r[t]=new o.Pa4),r[t].copy(l.anchorPosition).add(l.stemVector),n[t]||(n[t]=new o.FM8),(0,a.q9)(i,r[t],n[t],c),s.push({sid:t,screen:c.z>1?null:n[t],world:r[t]}))})),s)))}))}},88538:(e,t,i)=>{"use strict";i.d(t,{Fz:()=>n,Gn:()=>o,Ek:()=>r});var s=i(99681);class n extends s.m{constructor(e,t,i){super(),this.id="ADD_MATTERTAG",this.payload=Object.assign(Object.assign(Object.assign({},e),t),i)}}class o extends s.m{constructor(e){super(),this.id="DELETE_MATTERTAG",this.payload={sid:e}}}class r extends s.m{constructor(e,t,i,s){super(),this.payload={sid:e,options:Object.assign(Object.assign(Object.assign({},t),i),s)}}}},20983:(e,t,i)=>{"use strict";i.d(t,{n:()=>o});var s=i(19413),n=i(71229);class o extends s.V{constructor(e){if(super(),this.name="tag",this.mattertags=(0,n.q)(),e)for(const t of e)this.mattertags.set(t.sid,t);this.commit()}clear(){for(const e of this.mattertags)this.removeTag(e.sid)}clone(){return(new o).copy(this)}copy(e){return o.copyTagCollection(this,e),this}static copyTagCollection(e,t){const i=e.mattertags,s=t.mattertags;for(const t of i.keys)s.has(t)||e.removeTag(t);for(const t of s)e.addTag(t)}get collection(){return this.mattertags}addTag(e){this.mattertags.has(e.sid)?this.mattertags.get(e.sid).copy(e):this.mattertags.set(e.sid,e.clone())}removeTag(e){return this.mattertags.delete(e)}getTag(e){return this.mattertags.get(e)}getTagList(){return this.mattertags.keys}getTagCount(){return this.mattertags.length}iterate(e){for(const t of this.mattertags)e(t)}*[Symbol.iterator](){for(const e of this.mattertags)yield e}}},7875:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>oe});var s=i(54122),n=i(2212),o=i(61956),r=i(28615),a=i(90709),l=i(78909),c=i(22748);class h extends l.T{constructor(){super(...arguments),this.sid="",this.created=new Date,this.modified=new Date,this.enabled=!0,this.label="",this.description="",this.parsedDescription=[],this.anchorPosition=new n.Pa4,this.anchorNormal=new n.Pa4(0,1,0),this.stemVector=new n.Pa4(0,0,(0,a._F)(1)),this.stemHeight=(0,a._F)(1),this.stemVisible=!0,this.color=o.I.MATTERTAG_BLUE.clone(),this.mediaType=r.z.none,this.mediaSrc="",this.widgetFrame=null}copy(e){this.anchorNormal.copy(e.anchorNormal),this.anchorPosition.copy(e.anchorPosition),this.color.copy(e.color),this.created.setTime(e.created.getTime()),this.description=e.description,this.enabled=e.enabled,this.floorId=e.floorId,this.roomId=e.roomId,this.label=e.label,this.mediaType=e.mediaType,this.mediaSrc=e.mediaSrc,this.modified.setTime(e.modified.getTime()),this.sid=e.sid,this.stemVector.copy(e.stemVector),this.stemHeight=e.stemHeight,this.stemVisible=e.stemVisible,this.parsedDescription=[];for(const t of e.parsedDescription)this.parsedDescription.push({link:t.link&&{label:t.link.label.slice(),url:t.link.url.slice(),type:t.link.type,navigationData:t.link.navigationData&&{floorVisibility:t.link.navigationData.floorVisibility,mode:t.link.navigationData.mode,sweepIndex:t.link.navigationData.sweepIndex,panoId:t.link.navigationData.panoId,position:t.link.navigationData.position&&t.link.navigationData.position.clone(),quaternion:t.link.navigationData.quaternion.clone(),zoom:t.link.navigationData.zoom}},text:t.text,type:t.type});return this.copyWidgetFrame(e.widgetFrame),this.commit(),this}clone(){return(new h).copy(this)}copyWidgetFrame(e){e?this.widgetFrame?((0,c.B)(this.widgetFrame.size,e.size,"width","height"),this.widgetFrame.frame=e.frame):this.widgetFrame=Object.assign({},e):this.widgetFrame=null}}var d=i(62367),u=i(97631),p=i(17256),m=i(83032),g=i(64614),f=i(83083),v=i(60841),y=i(31113),b=i(25799),w=i(88538),S=i(20983),T=i(36168),E=i(71439);class _{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const s of e){const e=t.serialize(s);e&&i.push(e)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const s of e){const e=t.deserialize(s);e&&i.push(e)}return i}}var x=i(32400),M=i(51770),P=i(60982);const A=new b.Z("mds-mattertag-serializer");class O{constructor(e,t){this.updateSerializer=e,this.mediaSerializer=t}serialize(e){const t=this.mediaSerializer.serialize(e),i=this.updateSerializer.serialize(e),s=null!==t?Object.assign(Object.assign({},t),i):i;return this.validate(s)?s:null}validate(e){if(!e)return!1;const t=["label","description","mediaUrl"].some((t=>t in e)),i=["floorId","enabled","anchorPosition"].filter((t=>!(t in e))),s=0===i.length,n=!!e.anchorPosition&&(0,P.uU)(e.anchorPosition),o=s&&t&&n;return o||A.debug("Invalid MattertagDetails:",{missingFields:i,validPosition:n}),o}}var D=i(41964),I=i(32020),C=i(97620);const R=new b.Z("mds-mattertag-serializer");class L{deserialize(e){if(!e||!this.validate(e))return R.debug("Deserialized invalid Mattertag data from MDS",e),null;const t=e.anchorPosition?C.ep.fromVisionVector(e.anchorPosition):void 0,i=e.stemNormal?C.ep.fromVisionVector(e.stemNormal):void 0,s=new h;if(s.sid=e.id,s.label=e.label||"",s.description=e.description||"",s.enabled=!!e.enabled,e.color&&(s.color=new n.Ilk(e.color)),s.created=(0,I.p)(e.created),s.modified=(0,I.p)(e.modified),e.floor&&e.floor.id&&(s.floorId=e.floor.id),e.room&&e.room.id&&(s.roomId=e.room.id),t&&(s.anchorPosition=t),e.media&&(s.mediaSrc=e.media),e.mediaType&&(s.mediaType=this.getTagDescriptionChunkType(e.mediaType)),void 0!==e.stemLength&&(s.stemHeight=e.stemLength),i){const t=i.clone().setLength(s.stemHeight);s.anchorNormal=i,s.stemVector=t,s.stemVisible=!!e.stemEnabled}else s.stemVector=new n.Pa4(0,0,0),s.stemVisible=!!e.stemEnabled;return s}validate(e){if(!e)return!1;const t=["id","created","modified","enabled"].every((t=>t in e)),i=e.floor&&"number"==typeof e.floor.meshId;return t&&i||R.debug("Invalid MdsMattertag:",{hasRequiredFields:t,validFloor:i,data:e}),t&&i}getTagDescriptionChunkType(e){const t={[D.L.VIDEO]:r.z.video,[D.L.PHOTO]:r.z.photo,[D.L.RICH]:r.z.rich};return e in t?t[e]:r.z.none}}class N{serialize(e){return this.validate(e)?{sid:e.sid}:null}validate(e){const t=null!==e&&!!e.mediaType&&e.mediaType===r.z.none;return null!==e&&!!e.sid&&t}}const k=new b.Z("mds-mattertag-serializer");class F{serialize(e){const t=this.extractMedia(e);return this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["mediaUrl","mediaType"].every((t=>t in e)),i=void 0!==e.mediaType&&["rich","photo","video"].includes(e.mediaType),s=t&&i;return s||k.debug("invalid media",e,{hasRequiredFields:t,hasValidMediaType:i}),s}extractMedia(e){const t={};return e.mediaSrc&&(t.mediaUrl=e.mediaSrc),e.mediaType&&e.mediaType in B&&(t.mediaType=e.mediaType),t.mediaUrl&&t.mediaType?t:null}}const B={[r.z.photo]:[D.L.PHOTO],[r.z.rich]:[D.L.RICH],[r.z.video]:[D.L.VIDEO]};var U=i(69281);const H=new b.Z("mds-mattertag-serializer");class G{serialize(e){if(!e)return null;const t={};return void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.stemVisible&&(t.stemEnabled=e.stemVisible),void 0!==e.label&&(t.label=e.label),void 0!==e.description&&(t.description=e.description),void 0!==e.color&&(0,U.D5)(e.color)&&(t.color=(0,U.Ex)(e.color)),void 0!==e.anchorPosition&&(0,P.uU)(e.anchorPosition)&&(t.anchorPosition=C.ep.toVisionVector(e.anchorPosition)),void 0!==e.anchorNormal&&(0,P.uU)(e.anchorNormal)&&(t.stemNormal=C.ep.toVisionVector(e.anchorNormal)),void 0!==e.stemHeight&&(t.stemLength=e.stemHeight),e.floorId&&(t.floorId=e.floorId),e.roomId&&(t.roomId=e.roomId),t&&this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["floorId","roomId","color","label","description","enabled","stemEnabled","stemLength","stemNormal","anchorPosition"],i=Object.keys(e).length>0,s=Object.keys(e).every((e=>t.includes(e))),n=s&&i;return n||H.debug("Invalid MattertagPatch:",{hasContents:i,hasValidFields:s,data:e}),n}}var V=i(55482);const z=new b.Z("MdsMattertagStore");class j extends x.u{constructor(e){super(e),this.patchSerializer=new G,this.mediaUpdateSerializer=new F,this.mediaRemovalSerializer=new N,this.createSerializer=new O(this.patchSerializer,this.mediaUpdateSerializer);const t=new L;this.deserializer=new _({deserializer:t})}async read(){const{includeDisabled:e=!1}=this.config,t=this.getViewId();return this.query(V.GetMattertags,{modelId:t,includeDisabled:e}).then((e=>{const t=(0,M.qw)(e,"data.model.mattertags");return(this.deserializer.deserialize(t)||[]).reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw z.error("Failure saving tag:",e.sid,e),new Error("Could not save Mattertag");return this.mutate(V.AddMattertag,{modelId:t,mattertagId:e.sid,data:i}).then((t=>{if(z.debug(Object.assign({type:"addMattertag"},t)),t.errors&&t.errors.length>0)throw z.error(Object.assign({},t)),new Error("MattertagStore.create failed");const i=(0,M.qw)(t,"data.addMattertag"),s=(new h).copy(e);return s.sid=i.id,s.commit(),s}))})))}async update(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=e.sid,s=this.mediaUpdateSerializer.serialize(e),n=this.mediaRemovalSerializer.serialize(e),o=this.patchSerializer.serialize(e);if(!o&&!s&&!n)throw Error("MattertagStore.update failed");const r=o?", $patch: MattertagPatch!":"",a=s?", $mediaType: MattertagMediaType!, $mediaUrl:String!":"",l=E.Ps`
        mutation tagUpdate($modelId: ID!, $mattertagId: ID! ${r} ${a}) {
          ${o?"patchMattertag(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId,\n              patch: $patch) {\n                id\n              }":""}
          ${n?"removeMattertagMedia(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId) {\n                id\n              }":""}
          ${s?"updateMattertagMediaUrl(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId,\n              type: $mediaType,\n              url: $mediaUrl) {\n                id\n              }":""}
        }
      `;return this.mutate(l,{modelId:t,mattertagId:i,patch:o,mediaType:s&&s.mediaType,mediaUrl:s&&s.mediaUrl}).then((e=>{if(z.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw z.error(Object.assign({},e)),new Error("MattertagStore.update failed")}))})))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||e&&!e.sid)throw new Error("MattertagStore.delete failed");return this.mutate(V.DeleteMattertag,{modelId:t,mattertagId:e.sid}).then((e=>{if(z.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw z.error(Object.assign({},e)),new Error("MattertagStore.delete failed")}))})))}}var W,Z=i(40032),q=i(46162);!function(e){e.LINK="link",e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(W||(W={}));const K=new b.Z("mattertags"),Y=e=>{var t;if(!e)return null;const i={};for(const s in e){const o=e[s];try{const e=new h;e.sid=o.sid,e.created=(0,I.p)(o.created),e.modified=(0,I.p)(o.modified),e.enabled=o.enabled,e.label=o.label||"",e.description=o.description||"",e.anchorPosition=new n.Pa4(o.position.x,o.position.y,o.position.z),(0,P.mB)(o.normal)?K.debug("Ignored empty Mattertag normal",o.normal):e.anchorNormal=new n.Pa4(o.normal.x,o.normal.y,o.normal.z),(null===(t=o.stem)||void 0===t?void 0:t.direction)?e.stemVector=new n.Pa4(o.stem.direction.x,o.stem.direction.y,o.stem.direction.z):(e.stemVector=e.anchorNormal.clone().setLength((0,a._F)(1)),K.debug(`Ignored missing stem direction for ${o.sid}`)),e.stemHeight=e.stemVector.length(),e.stemVisible=void 0===o.stem.enabled||o.stem.enabled,e.floorId="number"==typeof o.floor?String(o.floor):"",e.color=o.color?new n.Ilk(o.color):new n.Ilk("#03687d"),o.media?(e.mediaType=r.z.parse(o.media.type),e.mediaSrc=o.media.src):(e.mediaType=r.z.none,e.mediaSrc=""),i[s]=e}catch(e){K.error("Failed to parse tag: "+o.sid,e)}}return i},$=e=>{const t=parseInt(e.floorId,10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e.floorId}'`);const i={sid:e.sid,created:(0,I.U)(e.created),modified:(0,I.U)(e.modified),enabled:e.enabled,label:e.label,description:e.description,color:(0,Z.Ex)(e.color),position:(0,Z.m)(e.anchorPosition),normal:(0,Z.m)(e.anchorNormal),floor:t,stem:{direction:(0,Z.m)(e.stemVector),enabled:void 0===e.stemVisible||e.stemVisible}};var s;return s=e.mediaType,Object.values(W).includes(s)&&(i.media={type:e.mediaType,src:e.mediaSrc}),i},Q=(e,t)=>{const i={},s=(0,q.p$)(e);(0,q.TS)(s,t);for(const e of Object.keys(s)){const t=s[e];t&&(i[t.sid]=$(t))}return i},X=(e,t)=>{const i=[],s=(0,q.p$)(e);(0,q.TS)(s,t);for(const e of Object.keys(s)){const t=s[e];t&&i.push($(t))}return i};var J=i(20331),ee=i(80034),te=i(41263),ie=i(15119),se=i(7943);const ne=new b.Z("mattertag-data");class oe extends s.Y{constructor(){super(...arguments),this.name="mattertag-data",this.monitor=null,this.addTag=async e=>{const t=new h;let i=(0,d.O1)(11);for(;this.data.getTag(i);)i=(0,d.O1)(11);return t.sid=i,this._editTag(t,e),this.data.addTag(t),i},this.editTag=async e=>{const t=this.data.getTag(e.sid);t&&this._editTag(t,e.options)},this._editTag=(e,t)=>{void 0!==t.color&&e.color.copy(t.color),void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.stemHeight&&(e.stemHeight=t.stemHeight,e.stemVector.copy(e.anchorNormal).setLength(t.stemHeight)),void 0!==t.stemVisible&&(e.stemVisible=t.stemVisible),void 0!==t.label&&(e.label=t.label.slice()),void 0!==t.description&&(e.description=t.description,e.parsedDescription=this.descParser.parse(e.description)),void 0!==t.floorId&&(e.floorId=t.floorId),void 0!==t.mediaType&&(e.mediaType=t.mediaType),void 0!==t.mediaSrc&&(e.mediaSrc=t.mediaSrc.slice()),void 0!==t.normal&&(e.anchorNormal.copy(t.normal).normalize(),e.stemVector.copy(t.normal).setLength(e.stemHeight)),void 0!==t.position&&e.anchorPosition.copy(t.position),e.modified=new Date,e.commit()},this.removeTag=async e=>{if(void 0!==this.data.getTag(e.sid)&&this.data.removeTag(e.sid))return e.sid}}async init(e,t){this.engine=t,this.descParser=new T.$({model:e.modelId,supportLinks:!0,keepLinkLabels:!0}),this.store=this.configureStorage(e);const i=await this.store.read()||{};this.roomDataModule=await t.getModule(y.default);const s=await t.getModule(u.F);this.data=t.market.tryGetData(S.n)||new S.n,this.initializeTagData(i,t.market,e.parserOptions),this.monitor=this.configureMonitor(e,this.store,this.data),this.bindings.push(t.commandBinder.addBinding(w.Fz,this.addTag),t.commandBinder.addBinding(w.Ek,this.editTag),t.commandBinder.addBinding(w.Gn,this.removeTag),s.onSave((()=>this.save()),{dataType:p.g.MATTERTAGS}),s.onRevert((()=>this.revert()),{dataType:p.g.MATTERTAGS}))}async revert(){if(this.store instanceof m.N)return this.store.revert()}async save(){if(this.monitor&&this.monitor.commitChanges(),this.store instanceof m.N)return;if(!this.store||!this.monitor)return void ne.warn("Mattertags changes will NOT be saved");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===g.KI.removed)).map((e=>({sid:e.index}))),s=t.filter((e=>e.action===g.KI.added)).map((e=>this.data.getTag(e.index))),n=t.filter((e=>e.action===g.KI.updated)).map((e=>{const t=Object.assign({sid:e.index},e.diff);return"mediaSrc"in t&&(t.mediaType=this.data.getTag(e.index).mediaType),t}));return Promise.all([this.store.delete(i),this.store.create(s),this.store.update(n)]).then((()=>{}))}clearDiffRecord(){this.monitor&&this.monitor.clearDiffRecord()}configureStorage(e){const{modelId:t,baseUrl:i,queue:s,storageProvider:n,readonly:o}=e;if(ne.info(`Loading Mattertags from ${n}`),n===p.Xq.MDS)return new j({readonly:o,includeDisabled:!o,baseUrl:i});const r=function(e){const{modelId:t,readonly:i,serialize:s,deserialize:n}=e,o=e.baseUrl||"",r=e.queue||new J.gO;if(!s||!n)throw new Error("Mattertag sync requires serializer and deserializer");const a=`${o}/api/v1/jsonstore/model/mattertags/${t}`;if(i){const e=new ee.gh({queue:r,path:a,deserialize:n});return new te.iY({publishStores:[e]})}const l=new ee.MU({queue:r,path:a,batchUpdate:!0,deserialize:n,serialize:s}),c=`${o}/api/v1/jsonstore/model/workshopSession/${t}`,h=new ie.Z({queue:r,path:c,cachedData:{data:null},deserialize:se.S.sessionCollectionMap(ie.j.Mattertags,n),serialize:X},ie.j.Mattertags);return new te.iY({publishStores:[l],legacyEditStore:h,editStoreKey:te.aw.MATTERTAGS})}({modelId:t,readonly:o,baseUrl:i,serialize:Q,deserialize:Y,queue:s});return new m.N(r,{dataType:p.g.MATTERTAGS,modelId:t,readonly:o,engine:this.engine})}configureMonitor(e,t,i){const{readonly:s}=e;if(!s){const e=new f.c(i.collection,{aggregationType:v.E.Manual,shallow:!0});return t instanceof m.N&&t.addMonitor(e),e}return null}initializeTagData(e,t,i){const s=i?new T.$(i):this.descParser;for(const t in e){const i=e[t];i.parsedDescription=s.parse(e[t].description),this.roomDataModule.inferMeshIdsFromPoint(i,i.anchorPosition),this.data.addTag(i)}t.register(this,S.n,this.data)}}},4292:(e,t,i)=>{"use strict";i.d(t,{QY:()=>n,Ik:()=>o,dJ:()=>r,vE:()=>a});var s=i(93528);class n extends s.v{constructor(e){super(),this.sid=e}}class o extends s.v{constructor(e,t){super(),this.url=e,this.embed=t}}class r extends s.v{constructor(e,t){super(),this.sid=e,this.view=t}}class a extends s.v{constructor(e){super(),this.fullSized=e}}},91172:(e,t,i)=>{"use strict";i.d(t,{re:()=>s,lc:()=>n}),Object.freeze({mattertags:{visibility:{alphaTestLevel:.05},disc:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},pole:{height:.5,width:2,opacity:.5,color:"white"}}});const s="features/mattertags",n="embedlyKey"},17282:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(54122),n=i(39936),o=i(20983),r=i(90926),a=i(17707),l=i(21685),c=i(91172),h=i(43084),d=i(60778),u=i(64366),p=i(78947);class m extends s.Y{constructor(){super(...arguments),this.name="mattertag-mesh",this.visibilityDirty=!0,this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.addNewTagMesh=(e,t)=>{this.settings.tryGetProperty(l.R,!1)||this.pinRenderer.displayPin(e.sid,r.Er.MATTERTAG,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,color:`#${e.color.getHexString()}`}),this.backgroundTexture,this.maskTexture)},this.removeTagMesh=(e,t)=>{this.pinRenderer.removePin(e.sid)},this.updateTagMesh=(e,t)=>{this.addNewTagMesh(e,e.sid)},this.initializeTagVisibility=()=>{if(this.settings.tryGetProperty(l.R,!1))return;const e=this.settings.tryGetProperty(c.re,!0);this.pinRenderer.setPinOpacityByType(r.Er.MATTERTAG,e?1:0),e&&this.mattertagData.iterate((e=>{this.pinRenderer.setPinVisible(e.sid,e.enabled)}))},this.updateTagVisibilty=()=>{this.settings.tryGetProperty(l.R,!1)||(this.settings.tryGetProperty(c.re,!1)?this.fadePinsToState():this.pinRenderer.fadePinOpacityByType(r.Er.MATTERTAG,0))},this.selectedTagChanged=()=>{if(!this.settings.tryGetProperty(l.R,!1)){if(this.mattertagViewData.selectedTag&&!this.mattertagViewData.navigating){const e=this.mattertagData.getTag(this.mattertagViewData.selectedTag);this.pinRenderer.showSelectedMesh(r.Er.MATTERTAG,e.sid)}this.mattertagViewData.selectedTag||this.pinRenderer.hideSelectedMesh()}}}async init(e,t){const[i,s,r,l]=await Promise.all([t.market.waitForData(o.n),t.getModule(a.default),t.market.waitForData(n.e),t.market.waitForData(h.P5)]);this.settings=r,this.mattertagData=i,this.mattertagViewData=l,this.pinRenderer=s.pinRenderer;const m=()=>{this.visibilityDirty=!0};this.bindings.push(this.mattertagData.collection.onElementChanged({onAdded:this.addNewTagMesh,onRemoved:this.removeTagMesh,onUpdated:this.updateTagMesh}),this.mattertagViewData.onToolStateChanged(m),this.settings.onPropertyChanged(c.re,m),this.mattertagData.onChanged(m),this.mattertagViewData.onSelectedTagChanged(this.selectedTagChanged),this.mattertagViewData.onNavigatingTagChanged(this.selectedTagChanged)),this.backgroundTexture=(0,d.p)(u),this.maskTexture=(0,d.p)(p),this.mattertagData.iterate((e=>{this.addNewTagMesh(e,e.sid)})),this.initializeTagVisibility()}dispose(e){this.pinRenderer.removePinsByType(r.Er.MATTERTAG),this.backgroundTexture.dispose(),this.maskTexture.dispose(),super.dispose(e)}onUpdate(e){this.visibilityDirty&&(this.visibilityDirty=!1,this.updateTagVisibilty())}showAnchorMesh(e){this.pinRenderer.showAnchorMesh(r.Er.MATTERTAG,e.sid,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight})),this.unanchoredTagOpacity=.5,this.anchoredTagOpacity=1,this.anchorTagId=e.sid,this.fadePinsToState()}hideAnchorMesh(){this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.anchorTagId=void 0,this.pinRenderer.hideAnchorMesh(),this.fadePinsToState()}resetPinOpacity(){this.fadePinsToState()}changeDiscOpacity(e,t){this.pinRenderer.setPinOpacity(e,t)}setTagVisibility(e){this.pinRenderer.setPinTypeVisible(r.Er.MATTERTAG,e)}setTagVisible(e,t){this.pinRenderer.setPinVisible(e,t)}setOverrideMaterial(e,t,i){this.pinRenderer.setPinRenderOverrides(e,t,i)}fadePinsToState(){this.mattertagData.iterate((e=>{e.enabled&&this.pinRenderer.setPinVisible(e.sid,e.enabled);const t=e.sid===this.anchorTagId?this.anchoredTagOpacity:this.unanchoredTagOpacity;this.pinRenderer.fadePinOpacity(e.sid,e.enabled?t:0)}))}}},25145:(e,t,i)=>{"use strict";i.d(t,{c:()=>n,Y:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="MATTERTAG_NAV_LINK",this.payload={chunk:e}}}class o extends s.m{constructor(e,t,i=!1){super(),this.id="MATTERTAG_NAVIGATE",this.payload={sid:e,transition:t,navigateToDisabled:i}}}},43084:(e,t,i)=>{"use strict";i.d(t,{Pg:()=>s,rI:()=>n,P5:()=>h,ZJ:()=>d});var s,n,o=i(19413),r=i(90134),a=i(5442),l=i(71229),c=i(78909);!function(e){e.UP="Up",e.DOWN="Down",e.LEFT="Left",e.LEFT_UP="LeftUp",e.LEFT_DOWN="LeftDown",e.RIGHT="Right",e.RIGHT_UP="RightUp",e.RIGHT_DOWN="RightDown"}(s||(s={})),function(e){e.CLOSED="closed",e.IDLE="idle",e.DISABLED="disabled",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.EDITING="editing"}(n||(n={}));class h extends o.V{constructor(e){super(),this.mattertags=e,this.name="tag-view",this.visitedTags=new r.d,this.navigatingTag=(0,a.Y)(null),this.toolStateObservable=(0,a.Y)(n.CLOSED),this.openTagObservable=(0,a.Y)(null),this.selectedTagObservable=(0,a.Y)(null),this.uncommittedTagObservable=(0,a.Y)(null),this.progressObservable=new a.f(-1),this.screenPositionObservable=new a.f(null),this.viewedTags=0,this.creatingNewMattertag=!1,this.tagCapabilities={},this.getViewData=e=>{const t=this.mattertags.getTag(e),i=this.derivedData[e];return t&&!i&&this.makeViewData&&(this.derivedData[e]=this.makeViewData(t)),this.derivedData[e]},this.derivedData={},this.activeBillboards=(0,l.q)()}setViewDataFactory(e){this.makeViewData=e}openBillboard(e){this.openTag&&this.openTag!==e&&this.closeBillboard(this.openTag),this.openTag!==e&&this.setOpenTag(e)}hideBillboard(e){this.openTag===e&&this.setOpenTag(null)}closeBillboard(e){this.openTag===e&&this.setOpenTag(null),this.selectedTag===e&&this.setSelectedTag(null)}closeOpenBillboard(){this.openTag&&this.closeBillboard(this.openTag)}setTagCapabilities(e,t){const i=this.tagCapabilities[e]||{};i.opening=t.opening,i.navigating=t.navigating,this.tagCapabilities[e]=i,this.openTag!==e||this.tagCapabilities.opening||this.closeBillboard(e)}getTagCount(){return this.mattertags.collection.length}get navigating(){return this.navigatingTag.value}setNavigatingTag(e){this.navigatingTag.value=e}onNavigatingTagChanged(e){return this.navigatingTag.onChanged(e)}setSelectedTag(e){this.selectedTagObservable.value=e}get selectedTag(){return this.selectedTagObservable.value}onSelectedTagChanged(e){return this.selectedTagObservable.onChanged(e)}setUncommittedTag(e){this.uncommittedTagObservable.value=e}get uncommittedTag(){return this.uncommittedTagObservable.value}onUncommittedChanged(e){return this.uncommittedTagObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){return this.progressObservable.onChanged(e)}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}setToolState(e){switch(e){case n.CREATING:this.creatingNewMattertag=!0;break;case n.IDLE:case n.CLOSED:this.creatingNewMattertag=!1}this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}get openTag(){return this.openTagObservable.value}setOpenTag(e){this.openTagObservable.value=e}onOpenTagChanged(e){return this.openTagObservable.onChanged(e)}isCreatingNewMattertag(){return this.creatingNewMattertag}visitTag(e){this.viewedTags++,-1===this.visitedTags.indexOf(e)&&this.visitedTags.push(e)}getViewedTagCount(){return this.viewedTags}getVisitedTags(){return this.visitedTags.values()}setNavigatingPosition(e){this.navigatingPosition=e}getNavigatingPosition(){return this.navigatingPosition}}class d extends c.T{constructor(e){super(),this.sid=e,this.closing=!1,this.position=null,this.distance=0,this.timeoutId=0}}},31640:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>D});var s=i(2212),n=i(54122),o=i(20983),r=i(2692),a=i(89155),l=i(4292),c=i(47678),h=i(48840),d=i(3471),u=i(47924),p=i(77956),m=i(54733),g=i(29675),f=i(71208),v=i(91172),y=i(21685),b=i(39936),w=i(25145),S=i(55525),T=i(25799),E=i(72942),_=i(43084),x=i(27829),M=i(90926),P=i(17707),A=i(43770);const O=new T.Z("mattertag-viewdata-module");class D extends n.Y{constructor(){super(...arguments),this.name="mattertags-viewdata",this.distance=new s.Pa4,this.cameraPosition=new s.Pa4,this.hoverTimeout=0,this.updateViewData=()=>{this.data.iterate((e=>{this.viewData.derivedData[e.sid]=this.makeViewDataForMattertag(e)})),this.viewData.commit()},this.makeViewDataForMattertag=e=>{const t=this.viewData.activeBillboards.get(e.sid),i=this.viewData.selectedTag===e.sid,s=t?t.position:null,n=t?t.distance:0;return{position:s,selected:i,located:!(!s||!n),closeTheTag:!t||t.closing||!(i||!this.viewData.selectedTag),navigating:!(!this.viewData.navigating||this.viewData.navigating!==e.sid),navigatingPosition:i?this.viewData.getNavigatingPosition():void 0,positioned:!1,distance:n,stemHeight:e.stemHeight,visible:e.enabled,color:`#${e.color.getHexString()}`,onTagDirectionChanged:this.onTagDirectionChanged}},this.onCameraUpdate=e=>{this.viewData.activeBillboards.keys.length>0&&(this.cameraPosition.copy(e.pose.position),this.updateActiveBillboards(this.viewData.activeBillboards.keys),this.viewData.commit())},this.updateBillboardData=(e,t)=>{const i=this.viewData.activeBillboards.get(e);i&&(Object.assign(i,t),i.commit())},this.addActiveBillboard=e=>{this.viewData.activeBillboards.has(e)||this.viewData.activeBillboards.set(e,new _.ZJ(e))},this.removeFromActiveBillboards=e=>{this.viewData.activeBillboards.has(e)&&this.viewData.activeBillboards.delete(e)},this.handleOpenBillboardChanged=()=>{const e=this.viewData.openTag;this.viewData.activeBillboards.atomic((()=>{e&&(this.viewData.activeBillboards.get(e)?(window.clearTimeout(this.viewData.activeBillboards.get(e).timeoutId),this.updateBillboardData(e,{timeoutId:0,closing:!1})):this.addActiveBillboard(e),this.updateActiveBillboards([e]));for(const t of this.viewData.activeBillboards.keys){if(t===e)return;this.updateBillboardData(t,{closing:!0,direction:void 0,timeoutId:window.setTimeout((()=>{this.removeFromActiveBillboards(t)}),1e3)})}}))},this.updateActiveBillboards=async e=>{try{await this.engine.commandBinder.issueCommand(new r.c(e)).then((e=>{for(const t of e)this.updateBillboardData(t.sid,{distance:this.distance.copy(this.cameraPosition).distanceToSquared(t.world),position:t.screen})}))}catch(e){O.error(`Could not get Disc Positions for tags - ${e}`)}},this.onSweepChosen=e=>{this.viewData.setNavigatingPosition(e)},this.onDiscHoverChange=e=>{if(this.settings.tryGetProperty(y.R,!1))return;if(e.pinType!==M.Er.MATTERTAG)return;const t=this.viewData.toolState;if(t!==_.rI.CLOSED&&this.viewData.selectedTag)return;const i=this.data.getTag(e.id);if(i&&i.enabled)if(clearTimeout(this.hoverTimeout),e.hovering)t!==_.rI.EDITING&&(this.hoverTimeout=window.setTimeout((()=>this.discHoverChange(e.id,e.hovering)),125));else{if(e.id===this.viewData.selectedTag)return;this.discHoverChange(e.id,!1)}},this.onDiscClicked=e=>{if(this.settings.tryGetProperty(y.R,!1))return;const t=this.viewData.toolState;e.pinType===M.Er.MATTERTAG&&t===_.rI.CLOSED&&(e.id===this.viewData.selectedTag?this.closeBillboard(e.id):(this.viewData.setSelectedTag(e.id),this.navigateToTag(e.id,u.n.Interpolate)))},this.onSweepExit=e=>{e.toSweep&&e.fromSweep!==e.toSweep&&(this.viewData.isCreatingNewMattertag()||this.viewData.closeOpenBillboard())},this.onAppChange=e=>{this.currentApp=e.application,this.viewData.closeOpenBillboard(),this.viewData.setSelectedTag(null)},this.onViewmodeChange=e=>{null===this.viewData.navigating&&e.fromMode===f.Ey.Panorama&&this.viewData.closeOpenBillboard()},this.onNavigationLinkClicked=async e=>{if(e.chunk.link&&e.chunk.link.navigationData){const t={2:E.BD.DOLLHOUSE,3:E.BD.FLOORPLAN},{sweepIndex:i,quaternion:s,mode:n}=e.chunk.link.navigationData;let{panoId:o,position:r}=e.chunk.link.navigationData;if(!o&&void 0!==i){const e=this.sweepData.getSweepByIndex(i);e&&(o=e.id)}if(o)this.engine.commandBinder.issueCommand(new S.ju({sweep:o,rotation:s,transition:u.n.FadeToBlack}));else{if(!(n in t))throw new Error("Unknown navigation link pose: "+JSON.stringify(e.chunk.link.navigationData));this.engine.commandBinder.issueCommand(new E._i(t[n],u.n.Interpolate,{rotation:s,position:r}))}}},this.onTagDirectionChanged=(e,t)=>{this.updateBillboardData(e,{direction:t})}}async init(e,t){this.engine=t;const[i,s,n,r,l]=await Promise.all([t.market.waitForData(o.n),t.market.waitForData(p.Z),t.market.waitForData(b.e),t.market.waitForData(a.M_),t.getModule(P.default)]);this.data=i,this.sweepData=s,this.settings=n,this.cameraData=r,this.pinRenderer=l.pinRenderer,this.viewData=t.market.tryGetData(_.P5)||new _.P5(this.data),t.market.register(this,_.P5,this.viewData),this.viewData.setViewDataFactory(this.makeViewDataForMattertag),this.updateViewData(),this.settings.onPropertyChanged(v.re,(e=>{0!==e&&this.viewData.closeOpenBillboard()})),this.bindings.push(t.subscribe(A.tP,this.onDiscHoverChange),t.subscribe(A.F7,this.onDiscClicked),t.subscribe(c.Z,this.onSweepExit),t.subscribe(h.Z,this.onViewmodeChange),t.subscribe(d.bS,this.onAppChange),this.cameraData.onChanged(this.onCameraUpdate),this.data.onChanged(this.updateViewData),this.viewData.onOpenTagChanged(this.handleOpenBillboardChanged),this.viewData.activeBillboards.onChanged(this.updateViewData)),this.engine.commandBinder.addBinding(w.c,this.onNavigationLinkClicked),this.engine.commandBinder.addBinding(w.Y,(async e=>this.navigateToTag(e.sid,e.transition,e.navigateToDisabled)))}openBillboard(e){const t=this.viewData.tagCapabilities[e];t&&!t.opening||this.viewData.openBillboard(e)}closeBillboard(e){this.viewData.closeBillboard(e)}async navigateToTag(e,t,i=!1){if(this.settings.tryGetProperty(y.R,!1))return;const s=this.data.getTag(e);if(!s)throw new Error("No tag with that sid was found");if(!s.enabled&&!i)throw new Error("Cannot navigate to a disabled mattertag");const n=this.viewData.tagCapabilities[e];if(n&&!n.navigating)return;this.viewData.setNavigatingTag(e);const o=this.viewData.activeBillboards.get(e),r=o&&o.direction,{anchorPosition:a,stemVector:l,stemHeight:c}=s,h=this.tagDirectionToOrientationAdjust(r),d={anchorPosition:a,stemNormal:l,stemLength:c};return this.engine.commandBinder.issueCommand(new S.OR({pinPosition:d,transition:t,orientationAdjust:h,onSweepChosen:this.onSweepChosen})).then((()=>{this.viewData.setSelectedTag(e),this.onTagVisited(e),this.openBillboard(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)})).catch((e=>{O.debug(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)}))}onTagVisited(e){this.viewData.visitTag(e),this.engine.broadcast(new l.dJ(e,m.V.OPEN)),this.engine.broadcast(new l.QY(e))}discHoverChange(e,t){if(this.settings.tryGetProperty(y.R,!1))return;if(!this.data.getTag(e))return;const i=this.viewData.openTag===e;t&&!i?(this.currentApp===g.Mx.SHOWCASE&&this.engine.broadcast(new l.dJ(e,m.V.HOVER)),this.openBillboard(e),this.pinRenderer.setPinColorVariant(e,M.K_.HIGHLIGHTED)):!t&&i&&(this.closeBillboard(e),this.pinRenderer.setPinColorVariant(e,M.K_.DEFAULT)),this.viewData.commit()}tagDirectionToOrientationAdjust(e,t=new s._fP){let i=0,n=0;if(e){switch(e){case _.Pg.RIGHT:case _.Pg.RIGHT_DOWN:case _.Pg.RIGHT_UP:i=-.25;break;case _.Pg.LEFT:case _.Pg.LEFT_DOWN:case _.Pg.LEFT_UP:i=.25}switch(e){case _.Pg.UP:case _.Pg.LEFT_UP:case _.Pg.RIGHT_UP:n=.25;break;case _.Pg.DOWN:case _.Pg.LEFT_DOWN:case _.Pg.RIGHT_DOWN:i=-.25}}else i=-.25,n=-.25;return t.setFromAxisAngle(x.f.RIGHT,n),t.multiply((new s._fP).setFromAxisAngle(x.f.UP,i)),t}}},11618:(e,t,i)=>{"use strict";i.d(t,{h:()=>r,Z:()=>a});var s=i(11203),n=i(46162),o=i(67125);class r{constructor(e){this.contents=e,this.groupInfo=[],this.groupIndices=[],this.groupInfoMap={},this.groupIndicesMap={}}startGroup(e){const t=0===this.groupCount,i=this.contents.length!==this.groupIndices[this.groupCount-1];if(t||i){let t=e.sid;if(!t)for(t=(0,o.f)();this.groupInfoMap.hasOwnProperty(t);)t=(0,o.f)();const i=Object.assign(Object.assign({},e),{sid:t});this.groupInfo.push(i),this.groupInfoMap[t]=i,this.groupIndices.push(this.contents.length),this.groupIndicesMap[this.contents.length]=!0}return this.groupIndices.length-1}reset(){this.contents.atomic((()=>{for(let e=this.contents.length-1;e>=0;--e)this.removeFromIdx(e);this.groupIndices=[],this.groupInfo=[],this.groupIndicesMap={}}))}isStartIndex(e){return!!this.groupIndicesMap[e]}*groups(){for(let e=0;e<this.groupCount;++e)yield this.getGroup(e)}*[Symbol.iterator](){for(const e of this.contents)yield e}getGroupStartIndex(e){return this.groupIndices[e]}getGroup(e){const t=this.groupIndices[e],i=this.groupIndices[e+1],s=isNaN(i)?this.contents.length-1:i-1;return new a(e,this.contents,t,s,Object.assign({},this.groupInfo[e]))}getGroupById(e){for(let t=0;t<this.groupInfo.length;t++)if(e===this.groupInfo[t].sid)return this.getGroup(t)}indexOfGroup(e){for(let t=0;t<this.groupInfo.length;t++)if(e(this.groupInfo[t]))return t;return-1}updateGroupInfo(e,t){const i=this.groupInfo[e].sid;delete this.groupInfoMap[i];const s=Object.assign({sid:i},t);this.groupInfo.splice(e,1,s),this.groupInfoMap[i]=s}get groupCount(){return this.groupIndices.length}get length(){return this.contents.length}get(e){return this.contents.get(e)}push(e){if(0===this.groupCount)throw Error("Grouper: Error pushing points when we have no groups!");return this.contents.push(e.clone()),this.contents.length}pop(){return this.removeFromIdx(this.contents.length-1)}removeFromIdx(e){if(e<this.contents.length&&e>=0&&this.contents.length>=0){const t=this.contents.get(e);return this.contents.remove(e),this.removeEmptyGroups(),t}}removeEmptyGroups(){this.contents.length<=this.groupIndices[this.groupCount-1]&&this.removeGroup(this.groupCount-1)}groupFromPointIndex(e){if(0>e||e>=this.length)return-1;let t=this.groupCount-1;for(;e<this.groupIndices[t];)--t;return t}removeGroup(e){if(e>this.groupCount||e<0)return;const t=this.getGroup(e);if(0===t.count)return;const i=this.groupIndices[e];this.groupIndices.splice(e,1),this.groupInfo.splice(e,1),delete this.groupInfoMap[t.info.sid],delete this.groupIndicesMap[i];for(let i=e;i<this.groupCount;++i){const e=this.groupIndices[i],s=e-t.count;this.groupIndices[i]=s,delete this.groupIndicesMap[e],this.groupIndicesMap[s]=!0}this.contents.splice(t.startIndex,t.count)}update(e,t){this.contents.update(e,t.clone())}copy(e){return this.contents.atomic((()=>{this.reset();for(const t of e){this.startGroup(t.info);for(const e of t)this.push(e)}})),this}toString(){return`Grouper: { groupCount: ${this.groupCount}, length: ${this.length}, groups: [${[...this.groups()].map((e=>`${e}`))}]}`}}class a{constructor(e,t,i,s,n){this.index=e,this.grouper=t,this.startIndex=i,this.endIndex=s,this.data=n}*[Symbol.iterator](){for(let e=0;e<this.count;++e)yield this.get(e)}get(e){if(!this.has(e))throw RangeError(`Out of range error ${e} / ${this.count-1}`);return this.grouper.get(this.startIndex+e)}has(e){return e>=0&&this.startIndex+e<=this.endIndex}get count(){return this.endIndex-this.startIndex+1}get info(){return this.data}get isClosed(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return this.count>2&&e.distanceTo(t)<=s.NZ}get length(){let e=0,t=null;for(let i=0;i<this.count;i++)t&&(e+=this.get(i).distanceTo(t)),t=this.get(i);return e}hasLength(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return e&&t&&(this.isClosed||e.distanceTo(t)>s.NZ)}clone(){const e=[],t={get:t=>e[t],contents:e};for(let e=0;e<this.count;e++)t.contents.push(this.get(e));return new a(this.index,t,0,t.contents.length-1,Object.assign({},this.data))}describe(e=this.endIndex){return`GroupSegment${this.index}/${this.startIndex}/${e}}`}equals(e){if(this.count!==e.count||this.index!==e.index)return!1;if((0,n.NK)(this.info,e.info))return!1;for(let t=0;t<this.count;++t)if(!this.get(t).equals(e.get(t)))return!1;return!0}}},26983:(e,t,i)=>{"use strict";i.d(t,{X:()=>a});var s=i(19413),n=i(45982),o=i(5442),r=i(57501);class a extends s.V{constructor(){super(...arguments),this.name="measure-mode",this._groups=[],this._groupMap={},this.onDataChangedCallbacks=new Set,this._editingGroupId=null,this._creatingGroupId=null,this.phaseObservable=(0,o.Y)(n.au.CLOSED),this.selectedGroupIndexObservable=new o.f(-1),this.pressProgressObservable=new o.f(-1),this.pointPositionObservable=new o.f(null)}modeActive(){return this.phase!==n.au.CLOSED}*groups(){for(const e of this._groups)yield e}get selectedGroupSid(){const e=this.selectedGroupInfo;return e&&e.info.sid?e.info.sid:null}get selectedGroupInfo(){return-1===this.selectedGroupIndex?null:this.getGroupInfo(this.selectedGroupIndex)}get phase(){return this.phaseObservable.value}get creatingGroupId(){return this._creatingGroupId}set creatingGroupId(e){this._creatingGroupId=e}get editingGroupId(){return this._editingGroupId}set editingGroupId(e){this._editingGroupId=e}setPhase(e){this.phase!==e&&(this.phaseObservable.value=e)}onPhaseChanged(e){return this.phaseObservable.onChanged(e)}notifyDataChanged(){this.onDataChangedCallbacks.forEach((e=>e()))}onDataChanged(e){return(0,r.k1)((()=>this.onDataChangedCallbacks.add(e)),(()=>this.onDataChangedCallbacks.delete(e)),!0)}get groupCount(){return this._groups.length}get selectedGroupIndex(){return this.selectedGroupIndexObservable.value}setSelectedGroupIndex(e){this.selectedGroupIndexObservable.value=e}onSelectedGroupIndexChanged(e){return this.selectedGroupIndexObservable.onChanged(e)}get pointPosition(){return this.pointPositionObservable.value}setPointPosition(e){this.pointPositionObservable.value=e}onPointPositionChanged(e){return this.pointPositionObservable.onChanged(e)}setPressProgress(e){this.pressProgressObservable.value=e}get pressProgress(){return this.pressProgressObservable.value}onPressProgressChanged(e){return this.pressProgressObservable.onChanged(e)}getGroupInfo(e){return e<0||e>=this._groups.length?null:this._groups[e]}getGroupInfoBySid(e){return e?this._groupMap[e]:null}repopulate(e){this.clear();for(const t of e){const e=t.clone();this._groups.push(e),this._groupMap[t.info.sid]=e}(this.editingGroupId||this.creatingGroupId)&&this.notifyDataChanged()}clear(){this._groups=[],this._groupMap={}}}},45982:(e,t,i)=>{"use strict";var s;i.d(t,{au:()=>s,Pj:()=>n,Ph:()=>o,q8:()=>r,WN:()=>a}),function(e){e[e.CLOSED=0]="CLOSED",e[e.IDLE=1]="IDLE",e[e.EDITING=2]="EDITING",e[e.CREATING=3]="CREATING",e[e.POINT_PLACED=4]="POINT_PLACED",e[e.CREATING_NEXT_POINT=5]="CREATING_NEXT_POINT",e[e.CONFIRMING_POINT=6]="CONFIRMING_POINT"}(s||(s={}));const n={mobile:{[s.POINT_PLACED]:!0,[s.EDITING]:!0},desktop:{[s.CREATING]:!0,[s.CREATING_NEXT_POINT]:!0,[s.EDITING]:!0}},o={mobile:{[s.CREATING_NEXT_POINT]:!0,[s.POINT_PLACED]:!0,[s.EDITING]:!0},desktop:{[s.CREATING]:!0,[s.CREATING_NEXT_POINT]:!0,[s.EDITING]:!0}},r={[s.IDLE]:!0,[s.EDITING]:!0},a={[s.IDLE]:!0,[s.EDITING]:!0}},79758:(e,t,i)=>{"use strict";i.d(t,{d:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload=e}}},60579:(e,t,i)=>{"use strict";i.d(t,{Ev:()=>n,Tn:()=>o,JM:()=>r});var s=i(99681);class n extends s.m{}class o extends s.m{constructor(e){super(),this.payload={index:e}}}class r extends s.m{constructor(...e){super(),this.payload={sids:e}}}},54590:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});var s=i(99681);class n extends s.m{constructor(e,t){super(),this.payload={on:e,dimWhileActive:void 0!==t?t:e}}}},77399:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var s=i(99681);class n extends s.m{}},42060:(e,t,i)=>{"use strict";i.d(t,{R:()=>n});var s=i(99681);class n extends s.m{constructor(e,t=""){super(),this.id="RENAME_MEASUREMENT",this.payload={sid:e,text:t}}}},35887:(e,t,i)=>{"use strict";i.d(t,{v:()=>n,t:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload=e}}class o extends s.m{constructor(e){super(),this.payload={sid:e}}}},1437:(e,t,i)=>{"use strict";i.d(t,{B:()=>n});var s=i(99681);class n extends s.m{}},86034:(e,t,i)=>{"use strict";i.d(t,{W:()=>n});var s=i(99681);class n extends s.m{constructor(e,...t){super(),this.id="VISIBILITY_MEASUREMENT",this.payload={sids:t,visible:e}}}},59886:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Group:()=>j.Z,Grouper:()=>j.h,MeasurementLabelRenderer:()=>te,MeasurementLineRenderer:()=>$,MeasurementModeData:()=>z.X,MeasuringPhase:()=>V.au,default:()=>Ot,labelVisible:()=>V.Ph});var s=i(54122),n=i(50101),o=i(73354),r=i(30963),a=i(62513),l=i(60303),c=i(59120),h=i(7065),d=i(76258),u=i(5002),p=i(85197),m=i(30853),g=i(89155),f=i(22729),v=i(12775),y=i(25799),b=i(2212),w=i(290),S=i(70781),T=i(14647),E=i(53628);const _=new y.Z("line-data");class x{constructor(e,t,i,s,n,o,r=(()=>({lineVisibleByFeatureType:!0,labelVisibleByFeatureType:!0}))){this.cameraData=e,this.viewmodeData=t,this.floorsViewData=i,this.isCurrentSweepAligned=s,this.getUnits=n,this.isFeatureEnabled=o,this.visibleFilter=r,this.derivedDataCache={},this.dollhouseLineStyle=S.T.ThreeD,this.setVisibilityFilter=e=>{this.visibleFilter=e},this.defaultVisibilityFilter=()=>{this.visibleFilter=()=>({lineVisibleByFeatureType:!0,labelVisibleByFeatureType:!0})},this.make=(e,t,i)=>{const s=t(),{start_position:n,end_position:o,visible:r,floorId:a,type:l,text:c}=s,h=void 0!==i?i.opacity.value:0,d=r&&this.isFeatureEnabled(),u=d&&this.visibleByFloorAndModes(a,l),p=0===h||h===E.iV.LABEL_HIDDEN_OPACITY&&u;if(i&&p&&(!d||!u))return i;let m=u,g=u;if(u){const t=this.visibleFilter(e);m=m&&t.lineVisibleByFeatureType,g=g&&t.labelVisibleByFeatureType}let f=0;const v=n.distanceTo(o),y=(0,T.up)(v,this.getUnits());if(g||!p){const{width:e,height:t}=(0,T.hJ)(c.length+y.length),i=(0,T.Ko)(n,o,this.cameraData);this.tmpVec.copy(i.startScreenPosition).sub(i.endScreenPosition);let s=Math.abs(this.tmpVec.y)<Math.abs(this.tmpVec.x)?t:e;E.iV.ALIGN_LABELS&&(s=e,f=i.rotation),g=g&&i.pixelDistance>s}let b;const S=m&&g?1:m&&!g?E.iV.LABEL_HIDDEN_OPACITY:0;i?(b=i.opacity,b.endValue===S&&m===i.visible&&g===i.labelVisible||b.modifyAnimation(b.value,S,E.iV.FADE_DURATION)):b=new w.z(0,S,E.iV.FADE_DURATION);const _={sid:e,rotation:f,labelVisible:g,visible:m,length:v,displayLength:y,labelContents:c.length>0?`${y} ${c}`:y,opacity:b};return this.derivedDataCache[e]={getLineData:t,previousDerivedData:_},_},this.update=e=>{if(this.derivedDataCache[e]){const{getLineData:t,previousDerivedData:i}=this.derivedDataCache[e];return this.make(e,t,i)}_.warn(`data not found for ${e}`)},this.get=e=>{if(this.derivedDataCache[e])return this.derivedDataCache[e].previousDerivedData},this.remove=e=>{this.derivedDataCache[e]&&delete this.derivedDataCache[e]},this.clear=()=>{this.derivedDataCache={}},this.visibleByFloorAndModes=(e,t)=>{if(this.floorsViewData.transition.progress.active)return!1;const i=this.viewmodeData.isPano(),s=this.viewmodeData.isFloorplan(),n=this.viewmodeData.isDollhouse(),o=this.floorsViewData.currentFloor,r=!o,a=!(!o||o.id!==e),l=e===this.floorsViewData.topFloorId,c=t===S.T.FloorplanOnly&&s&&(a||l&&r),h=t===this.dollhouseLineStyle&&n&&(a||r);return t===S.T.ThreeD&&i&&this.isCurrentSweepAligned()||h||c},this.tmpVec=new b.FM8}setDollhouseLineStyle(e){this.dollhouseLineStyle=e}}var M,P,A=i(39936),O=i(62431),D=i(14600),I=i(77956),C=i(29675),R=i(54590),L=i(77399),N=i(35887),k=i(1437),F=i(60579),B=i(86034),U=i(42060),H=i(79758),G=i(14819),V=i(45982),z=i(26983),j=i(11618),W=i(56040),Z=i(88493),q=i(57501);!function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.UPDATED=2]="UPDATED",e[e.COUNT=3]="COUNT"}(M||(M={})),function(e){e[e.ADDED=1]="ADDED",e[e.REMOVED=2]="REMOVED",e[e.UPDATED=4]="UPDATED",e[e.ALL=7]="ALL"}(P||(P={}));var K;!function(e){e[e.x=16711680]="x",e[e.y=32768]="y",e[e.z=255]="z",e[e.free=16777215]="free",e[e.xz=16711935]="xz",e[e.laser=16724312]="laser",e[e.yellow=16776960]="yellow",e[e.white=16777215]="white"}(K||(K={}));var Y=i(91055);class ${constructor(e,t,i,s,n,o,r=(()=>-1),a,l=16777215){this.points=e,this.createPointSubscription=t,this.cameraData=i,this.lineModule=s,this.mainLayer=n,this.lineLayer=o,this.selectedGroup=r,this.getLineDetails=a,this.lineColor=l,this.endpointGeometry=new b.BKK(1,1),this.linePool=[],this.groupToLines={},this.pointToLines={},this.activeLines=[],this.cameraQuaternion=new b._fP,this.cameraPosition=new b.Pa4,this.cameraProjection=new W.M,this.getLinesForPoint=e=>{const t=[];if(this.pointToLines[e])for(const i of this.pointToLines[e]){const e=i.getMesh(Z.B.line),{startIndex:s,endIndex:n,group:o}=e.userData;t.push({endIndex:n,startIndex:s,line:i,group:o})}return t},this.updateMaterialColors(this.lineColor),this.dataSubs=[this.createPointSubscription(P.REMOVED,((e,t)=>{this.resetLines()}))]}updateMaterialColors(e){const t=E.V9.lineDefault;this.lineMaterial=this.lineModule.makeLineMaterial(e,!0,{linewidth:t}),this.lineMaterial.stencilRef=1,this.lineMaterial.stencilFail=b.x5V,this.lineMaterial.stencilZFail=b.x5V,this.lineMaterial.stencilZPass=b.x5V,this.lineMaterial.stencilFunc=b.OAl,this.lineMaterial.stencilWrite=!0,this.endpointMaterial=this.lineModule.makeEndpointMaterial(e);const i={dashed:!0,dashSize:.025,gapSize:.05,linewidth:E.V9.dottedLineDefault};this.dottedLineMaterial=this.lineModule.makeLineMaterial(e,!1,i),this.xLineMaterial=this.lineModule.makeLineMaterial(K.x,!1,i),this.yLineMaterial=this.lineModule.makeLineMaterial(K.y,!1,i),this.zLineMaterial=this.lineModule.makeLineMaterial(K.z,!1,i),this.xzLineMaterial=this.lineModule.makeLineMaterial(K.xz,!1,i)}setLineOpacityByGroup(e,t){const i=this.groupToLines[e];if(i)for(const e of i)e.opacity(t)}setLineOpacityByPoint(e,t){const i=this.getLinesForPoint(e);if(i)for(const e of i)e.line.opacity(t)}resetLines(){for(const e of this.lines)e.opacity(0),e.hide();this.groupToLines={},this.pointToLines={},this.lines.length=0}updateAllLines(){if(!(this.points.length<1)){for(let e=0;e<this.points.length;e++)this.updateLine(e);for(const e in this.groupToLines){const t=Number(e),i=this.groupToLines[t];for(const e of i)e.updateSelected(this.selectedGroup()===t)}}}init(){}dispose(){this.deactivate();for(const e of this.linePool)e.dispose();this.endpointGeometry.dispose(),this.dottedLineMaterial.dispose(),this.lineMaterial.dispose(),this.endpointMaterial.dispose(),this.xLineMaterial.dispose(),this.yLineMaterial.dispose(),this.zLineMaterial.dispose()}activate(){for(const e of this.dataSubs)e.renew()}deactivate(){for(const e of this.dataSubs)e.cancel();this.resetLines()}get lines(){return this.activeLines}get dottedMaterial(){return this.dottedLineMaterial}beforeRender(){this.cameraQuaternion.copy(this.cameraData.pose.rotation),this.cameraPosition.copy(this.cameraData.pose.position),this.cameraProjection.copy(this.cameraData.pose.projection)}get xMaterial(){return this.xLineMaterial}get yMaterial(){return this.yLineMaterial}get zMaterial(){return this.zLineMaterial}get xzMaterial(){return this.xzLineMaterial}render(){this.updateAllLines()}updateLine(e){const t=this.points.get(e),i=this.points.get(e+1),s=this.points.groupFromPointIndex(e)===this.points.groupFromPointIndex(e+1);t&&i&&s&&this.setLinePosition(e,t,i)}setLinePosition(e,t,i){let s=this.linePool[e];if(!s){const n=this.points.groupFromPointIndex(e);if(!this.getLineDetails(n,e,e+1).visible)return;const o=E.V9.endpointDefault>.01?this.endpointMaterial.clone():void 0;s=this.lineModule.makeLine(t,i,this.lineMaterial.clone(),o,(()=>!(0,Y.Pp)(this.cameraProjection))),this.setupLine(s,e),s.setRenderLayer(this.mainLayer)}s.visible||this.setupLine(s,e),this.linePool[e]=s,s.updateResolution(this.cameraData.width,this.cameraData.height),s.updatePositions(t,i),s.updateBillboard({rotation:this.cameraQuaternion,position:this.cameraPosition,projection:this.cameraProjection})}setupLine(e,t){const i=this.points.groupFromPointIndex(t);e.children.forEach((e=>{e.userData.startIndex=t,e.userData.endIndex=t+1,e.userData.group=i,e.layers.mask=this.mainLayer.mask})),e.getMesh(Z.B.line).layers.mask=this.lineLayer.mask,this.activeLines.push(e),this.addLineToGroup(i,e),this.addLineToPoint(t,e),this.addLineToPoint(t+1,e),e.show(),e.opacity(0)}addLineToGroup(e,t){this.groupToLines[e]||(this.groupToLines[e]=[]),this.groupToLines[e].push(t)}addLineToPoint(e,t){this.pointToLines[e]||(this.pointToLines[e]=[]),this.pointToLines[e].push(t)}}var Q=i(97620),X=i(75195),J=i(11203),ee=i(27829);class te{constructor(e,t,i,s,n,o,r){this.points=e,this.createPointSubscription=t,this.cameraData=i,this.renderLayer=s,this.renderOrder=n,this.textRenderer=o,this.getLineDetails=r,this.lengthCache=[],this.meshPool=[],this.textContainer=new b.Tme,this.textGeometry=new b.BKK(1,1),this.tmpMidpoint=new b.Pa4,this.tmpCamPos=new b.Pa4,this.cameraRotation=new b._fP,this.cameraProjection=new W.M,this.cameraPosition=new b.Pa4,this.dataSubs=[this.createPointSubscription(P.REMOVED,((e,t)=>{const i=this.meshPool[t];i&&(this.textContainer.remove(i),this.meshPool[t]=null);for(let e=this.points.length-1;e<this.lengthCache.length-1;++e)this.lengthCache[e]=-1}))]}reset(){for(const e of this.meshPool)e&&this.textContainer.remove(e);this.meshPool=[],this.lengthCache=[]}init(){}dispose(){this.textGeometry.dispose()}activate(){for(const e of this.dataSubs)e.renew()}deactivate(){for(const e of this.dataSubs)e.cancel();this.reset()}get container(){return this.textContainer}beforeRender(){const e=this.cameraData.pose;this.cameraRotation.copy(e.rotation),this.cameraPosition.copy(e.position),this.cameraProjection.copy(e.projection);const t=(0,Y.s1)(this.cameraProjection),i=(0,Y.Pp)(this.cameraProjection),s=this.cameraData.height,n=this.cameraData.zoom(),o=this.cameraData.aspect();for(let e=1;e<this.points.length;++e){const r=e-1,a=this.points.groupFromPointIndex(e),l=this.getLineDetails(a,r,e);if(!l||a!==this.points.groupFromPointIndex(r)){this.setMeshVisible(e,!1);continue}const c=this.points.get(r),h=this.points.get(e),d=this.setMeshVisible(e,l.labelVisible);if(!d)continue;d.text!==l.labelContents&&(d.text=l.labelContents);const u=this.cameraPosition.distanceTo(d.position);if(this.updateMeshPose(d,c,h,this.cameraRotation,this.cameraPosition,u,l.rotation,i),i||t)d.scaleFactor=J.Hn.SCALE_DISTANCE*n;else{const e=(0,X.D_)(d.position,this.cameraPosition,this.cameraRotation,this.cameraProjection.asThreeMatrix4()),t=Math.abs(e.x);if(t<1){const e=(0,Y.mY)(this.cameraProjection,this.cameraPosition,d.position,s,J.Hn.SCALE),i=((0,Q.uZ)(o,1,2.5)+n)*J.Hn.SCALE_ASPECT,r=1+J.Hn.SCALE_NDC-t*J.Hn.SCALE_NDC-i;d.scaleFactor=Math.max(Math.min(1/e*r,3),.001)}else d.scaleFactor=.001}}}setTextOpacityByPoint(e,t){const i=this.meshPool[e];i&&(i.opacity=t)}updateMeshPose(e,t,i,s,n,o,r,a){this.tmpMidpoint.copy(t).add(i).multiplyScalar(.5);const l=a?e=>this.tmpCamPos.copy(e).addScaledVector(ee.f.UP,.15):e=>this.tmpCamPos.copy(n).sub(e).setLength(.15*o).add(e);e.setPosition(this.tmpMidpoint,l),e.setOrientation(s,r)}render(){}setMeshVisible(e,t){let i=this.meshPool[e];if(!i&&t){i=this.textRenderer.createLabel(),i.setRenderLayer(this.renderLayer),i.renderOrder=this.renderOrder,i.opacity=0,i.visible=!1;const t=this.points.groupFromPointIndex(e);i.userData.groupIndex=t,this.textContainer.add(i)}if(i){const e=t?.001:E.iV.LABEL_HIDDEN_OPACITY;if(i.visible=i.opacity>e,!i.visible)return null}return this.meshPool[e]=i,i}}var ie=i(2779),se=i(1089),ne=i(60778),oe=i(15782),re=i(3834),ae=i(24135),le=i(16002),ce=i(57721),he=i(3220);class de{constructor(e,t=ie.o.ALL){this.scene=e,this.layer=t,this.supportsMobile=!0,this.style=le.L.GridPlane,this.alignToNormal=!0,this.xzTex=(0,ne.p)(ce),this.zyTex=(0,ne.p)(he),this.bindings=[],this.onOpacityUpdate=e=>{this.container.children.forEach((t=>{t.isMesh&&(t.material.opacity=Math.max(0,e.opacity.value))}))},this.onPositionUpdate=(e,t)=>{this.container.position.copy(e).addScaledVector(t,.005),this.alignToNormal&&(0,Y.J2)(this.container,e,t)},this.scale=e=>{this.container.scale.set(e,e,e)},this.onRaycasterUpdate=e=>{e.hit&&e.hit.face&&this.onPositionUpdate(e.hit.point.clone(),e.hit.face.normal)},this.container=new b.ZAu;const i=new b._12(.4,.4),s={color:16777215,side:b.ehD,transparent:!0,depthTest:!0,depthWrite:!1};this.xzTex.generateMipmaps=!1,this.xzTex.minFilter=b.wem,this.xzMaterial=new b.vBJ(Object.assign(Object.assign({},s),{color:65280,map:this.xzTex})),this.xzMaterial.premultipliedAlpha=!1;const n=new b.Kj0(i,this.xzMaterial);n.rotateOnAxis(ee.f.LEFT,Math.PI/2),this.zyTex.generateMipmaps=!1,this.zyTex.minFilter=b.TyD,this.zyMaterial=new b.vBJ(Object.assign(Object.assign({},s),{map:this.zyTex})),this.zyMaterial.premultipliedAlpha=!1;const o=new b.Kj0(i,this.zyMaterial);this.container.add(n,o),this.container.children.forEach((e=>e.layers.mask=this.layer.mask))}init(){}render(){}dispose(){this.container.children.forEach((e=>{if(e.isMesh){e.geometry.dispose();const t=e.material;t.dispose(),t.map&&t.map.dispose()}}))}async activate(e){const t=await e.market.waitForData(re.Y),i=await e.market.waitForData(ae.P);this.bindings.push(t.onChanged(this.onOpacityUpdate),i.onChanged(this.onRaycasterUpdate)),this.scene.add(this.container)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}setVisible(e){this.container.visible=e}}class ue{constructor(e,t,i,s,n,o,r,a){this.mobile=e,this.getPhase=t,this.pointer=i,this.sceneInfo=s,this.renderToTexture=n,this.getLayer=o,this.getChunks=r,this.editing=!1,this.editingStateChange=!1,this.setOverlay=e=>{for(const t of this.getChunks())t.setColorOverlay(e?oe.Y7:null)},this.setupCursorRenderCamera=()=>{const e=new b.cPb(J.X7.perspective.fov,1,.1,100);e.name="Cursor Peek Camera";const t=ie.o.ALL,i=["measurement-mode","measurement3d"];for(const e of i)t.removeLayers(this.getLayer(e));return e.layers.mask=t.mask,e.updateProjectionMatrix(),{camera:e,update:(t,i,s)=>{e.fov=t,e.near=i,e.far=s,e.updateProjectionMatrix()}}};const l=(0,ne.p)(se),c=new b.FM8,h=e=>{const t=this.rttView.height,i=this.rttView.width,s=this.sceneInfo.cameraData;let n=t/2;const o=-i/2;n=e.y<t/2+n?t+n:-n;const r=e.x+o,a=s.height-e.y-n;return c.set(r,a)};this.cursorMesh=new de(this.sceneInfo.scene,this.getLayer("cursor-mesh")),this.cursorMesh.setVisible(!1);const d=new b.Pa4,u=new b._fP,p=new b.FM8;let m,g,f=a(),v=J.X7.perspective;this.renderIntersection=(e,t,i)=>{m||(g=this.setupCursorRenderCamera(),m=g.camera,g.update(J.X7.perspective.fov,.1,100)),f!==a()&&(v=a()?J.X7.ortho:J.X7.perspective,this.cursorMesh.scale(v.scale),g.update(v.fov,.1,100),f=a());const o=this.editingStateChange?1:J.X7.smoothness;if(t){if(s.playerCamera.getWorldPosition(d),s.playerCamera.getWorldQuaternion(u),a()){const e=s.cameraData.zoom(),i=(0,Q.dS)(e,v.thresholdClose,v.thresholdFar,v.offsetClose,v.offsetFar);m.position.copy(t.point).addScaledVector(ee.f.UP,i),m.quaternion.copy(u)}else{const e=(0,Q.dS)(t.distance,v.thresholdClose,v.thresholdFar,v.offsetClose,v.offsetFar),i=d.sub(t.point).setLength(e).add(t.point);m.position.lerp(i,o),m.lookAt(t.point)}m.updateMatrixWorld(),J.E0&&this.setOverlay(!1),n.render(e,s.scene.scene,m),J.E0&&this.setOverlay(!0),p.lerp(h(i),o),n.renderToScreen(e,p,l)}this.editingStateChange=!1}}init(){}dispose(){}activate(){this.sceneInfo.scene.addChild(l.a.Root,this.cursorMesh.container);const e=this.mobile?J.ox.mobileSize:this.sceneInfo.cameraData.height>J.ox.highResThreshold?J.ox.desktopSizeHighRes:J.ox.desktopSize;this.rttView=this.renderToTexture.createRenderTarget2D(e,e,{format:b.UCm},!1)}deactivate(){this.sceneInfo.scene.removeChild(l.a.Root,this.cursorMesh.container),this.renderToTexture.disposeRenderTarget2D(this.rttView),this.editing=!1}beforeRender(){const e=this.getPhase(),t=this.mobile?!!V.Pj.mobile[e]:!!V.Pj.desktop[e];t!==this.editing&&(this.editingStateChange=!0,this.editing=t,this.cursorMesh.setVisible(this.editing)),this.editing&&(this.hit=this.mobile?this.pointer.lastIntersection:this.pointer.getIntersection(),this.hit&&this.cursorMesh.onPositionUpdate(this.hit.point,this.hit.normal))}render(){if(this.editing&&this.hit){const{screenPosition:e}=(0,X.q9)(this.sceneInfo.cameraData,this.hit.point);this.renderIntersection(this.rttView,this.hit,e)}}}var pe,me=i(82138),ge=i(61718),fe=i(70691);!function(e){e[e.SnapPoint=1]="SnapPoint",e[e.SnapLine=2]="SnapLine",e[e.AxisAny=3]="AxisAny",e[e.AxisX=4]="AxisX",e[e.AxisY=5]="AxisY",e[e.AxisZ=6]="AxisZ",e[e.Mesh=7]="Mesh",e[e.RoomMesh=8]="RoomMesh",e[e.LinePoint=9]="LinePoint",e[e.LineSegment=10]="LineSegment"}(pe||(pe={}));class ve extends fe.FM{constructor(e,t,i,s,n){super(e,t,i,s),this.floorId=i,this.roomId=s,this.featureType=n}}class ye extends fe.FM{constructor(e,t,i,s,n){super(e,t,i,s),this.floorId=i,this.roomId=s,this.featureType=n}}const be={[ee.e.UP]:pe.AxisY,[ee.e.DOWN]:pe.AxisY,[ee.e.FORWARD]:pe.AxisZ,[ee.e.BACK]:pe.AxisZ,[ee.e.LEFT]:pe.AxisX,[ee.e.RIGHT]:pe.AxisX,[ee.e.HORIZONTAL_PLANE]:pe.AxisY,NONE:void 0};var we;!function(e){e[e.UserAxis=1]="UserAxis",e[e.UserPoint=2]="UserPoint",e[e.UserLine=3]="UserLine",e[e.ModelFeature=4]="ModelFeature"}(we||(we={}));const Se={[pe.LinePoint]:we.UserPoint,[pe.LineSegment]:we.UserLine,[pe.AxisAny]:we.UserAxis,[pe.AxisX]:we.UserAxis,[pe.AxisY]:we.UserAxis,[pe.AxisZ]:we.UserAxis,[pe.Mesh]:we.ModelFeature,[pe.RoomMesh]:we.ModelFeature,[pe.SnapLine]:we.ModelFeature,[pe.SnapPoint]:we.ModelFeature};var Te=i(67399);class Ee{constructor(e,t,i){this.constraint=t,this.point=new b.Pa4,this.normal=new b.Pa4,_e(e)?this.updateFromIntersection(e,t):xe(e)&&i&&this.updateFromSnapIntersection(e,t,i),this.source=e}updatePoint(e){return this.point.copy(e),this.source.point.copy(e),this}updateFromIntersection(e,t){return this.source=e,this.updateContents(t,e.point,e.face.normal,e.distance,e.object),this}updateFromSnapIntersection(e,t,i){return this.source=e,this.updateContents(t,e.point,i,e.distance,e.object),this}copy({constraint:e,point:t,normal:i,distance:s,object:n}){this.updateContents(e,t,i,s,n)}clone(){return new Ee(this.source,this.constraint)}updateContents(e,t,i,s,n){this.constraint=e,this.point.copy(t),this.normal.copy(i),this.distance=s,this.object=n,Te.$4.hasRoomId(n)?(this.roomId=n.roomId,this.floorId=n.floorId):Te.$4.hasFloorId(n)&&(this.floorId=n.floorId,this.roomId=null),this.featureType=(e=>{if(e)return"featureType"in e&&void 0!==e.featureType?e.featureType:e instanceof b.Pa4||e instanceof fe.UQ?pe.SnapPoint:e instanceof me.g?pe.RoomMesh:e instanceof ge.S?pe.Mesh:e instanceof b.Zzh||e instanceof fe.FM?pe.SnapLine:void 0})(n)}}const _e=e=>e&&"face"in e&&void 0!==e.face&&Te.$4.hasFloorId(e.object),xe=e=>e&&"isLineOctreeIntersection"in e&&Te.$4.hasFloorId(e.object),Me=(()=>{class e extends b.Tme{constructor(e,t){super(),this.floorId=e,this.roomId=t}}return(t,i,s,n,o)=>({point:t,floorId:n,roomId:o,object:new e(n,o),face:new b.G_f(0,1,2,i),distance:s})})();var Pe=i(90384),Ae=i(21307),Oe=i(24975),De=i(73706),Ie=i(75158),Ce=i(21588),Re=i(40582);const Le=e=>e instanceof Ie.R?e.button===Re.MP.PRIMARY:e.buttons===Re.r3.PRIMARY;var Ne=i(75712);class ke extends b.Kj0{constructor(e,t,i,s,n,o,r,a,l,c,h,d){super(),this.pointGroups=e,this.input=t,this.cameraData=i,this.mobile=s,this.changeCursor=n,this.getPhase=o,this.changePhase=r,this.restorePreviousPhase=a,this.setSelectedLine=l,this.getSelected=c,this.onDragStart=h,this.onDragEnd=d,this.inputSubscriptions=[],this.groupVisible=[],this.raycast=(()=>{const e=new b.Pa4;return(t,i)=>{const{pose:s,width:n}=this.cameraData,o=.005*n,r=s.projection.asThreeMatrix4(),a=s.position;let l,c=0,h=0;for(let i=0;i<this.pointGroups.groupCount;++i){const s=this.pointGroups.getGroup(i);if(void 0!==this.editingGroup&&this.editingGroup!==i||!this.groupVisible[i])h+=s.count;else{for(let d=0;d<s.count-1;++d){const u=s.get(d),p=s.get(d+1);if(u&&p){const s=t.ray.distanceSqToSegment(u,p,void 0,e),d=a.distanceTo(e);let m=(0,Y._U)(d,r,n)*o;if(m*=m,s<m){let n,o=e;u.distanceToSquared(e)<2*m?(n=h,o=u):p.distanceToSquared(e)<2*m&&(n=h+1,o=p),(!l||s<c)&&(l={distance:t.ray.origin.distanceTo(o),point:o,object:this,instanceId:i,index:n},c=s)}}h++}h++}}l&&i.push(l)}})(),this.inputSubscriptions.push(...this.registerCommonInput()),s||this.inputSubscriptions.push(...this.registerHoverInput()),this.deactivate()}activate(){this.input.registerMesh(this,!1),this.inputSubscriptions.forEach((e=>e.renew()))}deactivate(){this.input.unregisterMesh(this),this.inputSubscriptions.forEach((e=>e.cancel()))}dispose(){this.deactivate()}setEditingGroup(e){this.editingGroup=e}setGroupVisible(e,t){this.groupVisible[e]=t}validJoint(e){return!!e&&void 0!==e.index}registerHoverInput(){return[this.input.registerMeshHandler(De.z,Ne.s.isType(ke),((e,t,i)=>{this.getPhase()===V.au.IDLE&&this.changeCursor(i&&void 0!==i.index?h.C.GRAB:h.C.FINGER)})),this.input.registerMeshHandler(De.A,Ne.s.isType(ke),((e,t,i)=>{this.getPhase()===V.au.IDLE&&this.changeCursor(h.C.DEFAULT)}))]}registerCommonInput(){return[this.input.registerMeshHandler(Ie.R,Ne.s.isType(ke),((e,t,i)=>{if(!Le(e))return!1;if(this.getPhase()!==V.au.IDLE)return!1;const s=i&&void 0!==i.instanceId?i.instanceId:-1,n=this.getSelected()===s?-1:s;return this.setSelectedLine(n),!0})),this.input.registerMeshHandler(Ce._t,Ne.s.isType(ke),((e,t,i)=>!(!Le(e)||!V.WN[this.getPhase()]||this.validJoint(i)&&i&&void 0!==i.instanceId&&(this.onDragStart(i.instanceId),this.setSelectedLine(i.instanceId),this.changePhase(V.au.EDITING),this.mobile||this.changeCursor(h.C.GRABBING),0)))),this.input.registerMeshHandler(Ce._R,Ne.s.isType(ke),((e,t,i)=>this.getPhase()===V.au.EDITING&&(this.restorePreviousPhase(),this.onDragEnd(),this.mobile||this.changeCursor(h.C.DEFAULT),!0)))]}}const Fe=new y.Z("snapping");class Be{constructor(e,t,i,s,n){this.raycaster=e,this.getConstraintStyle=t,this.floorsViewData=s,this.viewmodeData=n,this.origin=null,this.planeNormal=new b.Pa4,this.plane=new b.JOQ,this.ray=new b.zHn,this.originChangedListeners=[],this.registeredSnapFeatures={[we.UserAxis]:[],[we.UserLine]:[],[we.UserPoint]:[],[we.ModelFeature]:[]},this.clearOrigin=()=>{this.origin=null,this.originChangedListeners.forEach((e=>e(null)))},this.setOrigin=(e,t=!1)=>{this.origin&&!t||(this.origin=e,this.plane.setFromNormalAndCoplanarPoint(this.origin.normal,this.origin.point),this.originChangedListeners.forEach((e=>e(this.origin))),Fe.debug("Updating origin",this.origin,{forceUpdate:t}))},this.setOriginFromPointer=e=>{if(this.origin)return;const t=this.getMeshIntersection();if(!t)return;const i=new Ee(t,this.getConstraintStyle());e&&i.updatePoint(e),this.setOrigin(i,!0)},this.snapFeatures=e=>this.registeredSnapFeatures[e].reduce(((e,t)=>e.concat(t.features)),[]),this.addSnapFeatures=(e,t,i)=>{const s=Se[t];this.registeredSnapFeatures[s].push({owner:e,features:i}),Fe.debug(`Adding ${i.length} snap feature groups`,pe[t],t)},this.removeSnapFeatures=(e,t)=>{const i=Se[t],s=this.registeredSnapFeatures[i].findIndex((t=>t.owner===e));if(-1!==s){const e=this.registeredSnapFeatures[i].splice(s,1);Fe.debug(`Removing ${e.length} snap feature groups`,pe[t],t)}else Fe.debug(`removeTemporarySnapFeature: ${t} ${pe[t]} not found from`,e,this.registeredSnapFeatures)},this.filters={nop:e=>!0,userPoints:e=>{if(void 0===e.object)return!1;if((t=e.object)&&t instanceof b.Pa4)for(const t of this.snapFeatures(we.UserPoint))if(t.equals(e.object))return!0;var t;return!1},userLines:e=>{if(void 0===e.object)return!1;if((t=e.object)&&"isSnapAxisLine3"in t||"isSnapUserLine3"in t||"isSnapLine3"in t||"start"in t&&"end"in t&&"closestPointToPoint"in t){for(const t of this.snapFeatures(we.UserLine))if(t.equals(e.object))return!0;for(const t of this.snapFeatures(we.UserAxis))if(t.equals(e.object))return!0}var t;return!1},userFeatures:e=>this.filters.userPoints(e)||this.filters.userLines(e)},this.meshSnapRadius=i?J.Oq.mobile:J.Oq.desktop}preload(){this.raycaster.snapping.preloadMeshSnapping()}getMeshIntersection(e){let t,i=null,s=!1;if(e&&e.origin&&e.normal?(s=!0,t=this.raycaster.picking.cast(e.origin,e.normal)):t=this.raycaster.pointer.cast(),i=t[0],this.viewmodeData.isFloorplan()&&i&&!s){i=t.filter((e=>!(e.object instanceof ke)))[0];const e=this.floorsViewData.getHighestVisibleFloor(),s=Te.$4.matchesFloorId(e.id);!(!i||_e(i)&&s(i.object))&&(i=Me(i.point,new b.Pa4(0,1,0),i.distance,e.id,null)),i.point.y=e.boundingBox.max.y,i.face&&i.face.normal.set(0,1,0)}else i=t.filter((e=>(0,Oe.Pv)(e.object)))[0];return _e(i)?i:null}getIntersection(e){const t=this.getMeshIntersection(e);if(!t)return null;this.cachedHit||(this.cachedHit=new Ee(t,this.getConstraintStyle()));const i=this.cachedHit.updateFromIntersection(t,this.getConstraintStyle()),s=this.raycaster.pointer.pointerRay;switch(this.ray.set(s.origin,s.direction),this.planeNormal.copy(i.normal),this.getConstraintStyle()){case Pe.l1.Free:return i;case Pe.l1.Axes:return this.lockToWorldAxes(i);case Pe.l1.PlanarAxes:const e=[...this.snapFeatures(we.UserAxis),...this.snapFeatures(we.UserLine),...this.snapFeatures(we.UserPoint)];return this.softSnapToEdges(i,e,this.filters.userFeatures);case Pe.l1.Edges:const t=[...this.snapFeatures(we.UserLine),...this.snapFeatures(we.UserPoint)];return this.softSnapToEdges(i,t,this.filters.nop);case Pe.l1.EdgesAndPlanarAxes:const s=[...this.snapFeatures(we.UserAxis),...this.snapFeatures(we.UserLine),...this.snapFeatures(we.UserPoint)];return this.softSnapToEdges(i,s,this.filters.nop)}return i}get lastIntersection(){return this.cachedHit}onOriginChanged(e,t=!1){const i={renew:()=>{this.originChangedListeners.push(e)},cancel:()=>{(0,Ae.b)(this.originChangedListeners,e)}};return t&&i.renew(),i}lockToWorldAxes(e){if(this.origin){const t=(0,Pe.r2)(this.origin.point,e.point,Pe.l1.Axes);return this.cachedHit.copy(e),this.cachedHit.point.copy(t.position),this.cachedHit.constraint="NONE"!==t.axisName?Pe.l1.Axes:Pe.l1.Free,this.cachedHit.featureType=be[t.axisName],this.cachedHit}return e}softSnapToEdges(e,t,i){const s=this.origin?this.origin.point:e.point,n=this.origin?this.origin.normal:e.normal;this.raycaster.snapping.add(...t);const o=this.raycaster.snapping.cast(this.ray,this.meshSnapRadius,s,n).filter(i),r=this.raycaster.snapping.pick(this.ray,this.meshSnapRadius,o);return this.raycaster.snapping.remove(...t),r?(this.cachedHit.updateFromSnapIntersection(r,this.getConstraintStyle(),n),this.cachedHit):e}}var Ue=i(39990);class He{constructor(e,t,i,s){this.points=e,this.createPointSubscription=t,this.pointer=i,this.mobileCreateHackJob=s,this.subscriptions=[],this.lineSegments=[],this.updateSnapping=e=>{this.lineSegments.length>0&&(this.pointer.removeSnapFeatures(this,pe.LineSegment),this.lineSegments.length=0);for(let t=0;t<this.points.length;t++)if(t!==e&&t!==e-1&&t!==e+1&&!this.points.isStartIndex(t)){const e=this.points.get(t),i=this.points.get(t-1),s=this.points.getGroup(this.points.groupFromPointIndex(t));this.lineSegments.push(new ye(i,e,s.info.floorId,s.info.roomId,pe.LineSegment))}this.lineSegments.length>0&&this.pointer.addSnapFeatures(this,pe.LineSegment,this.lineSegments)}}init(){}dispose(){}activate(e){let t=-1,i=-1;const s=(0,Ue.D)((()=>this.updateSnapping(this.points.length)),16);this.subscriptions.push(this.createPointSubscription(P.ADDED,s,!0),this.createPointSubscription(P.REMOVED,s,!0),this.createPointSubscription(P.UPDATED,((e,s)=>{s===t||this.mobileCreateHackJob()&&s===i||(this.updateSnapping(s),i=t,t=s)}),!0))}deactivate(){this.subscriptions.forEach((e=>e.cancel())),this.subscriptions.length=0,this.pointer.removeSnapFeatures(this,pe.LinePoint),this.pointer.removeSnapFeatures(this,pe.LineSegment)}beforeRender(){}render(){}}var Ge=i(35056),Ve=i(63986);class ze{constructor(e,t,i,s,n,o,r,a){this.points=e,this.setSelected=t,this.pointer=i,this.changePhase=s,this.getPhase=n,this.isFloorplan=o,this.currentFloorId=r,this.currentRoomId=a,this.id=ze,this.onGroupCreated=e=>null,this.onGroupAddPoint=()=>null,this.onDone=()=>null,this.onEdit=e=>null,this.previousPhase=V.au.IDLE,this.currentLinePoints=0,this.previousPoint=new b.Pa4,this.inputSubscriptions=[],this.log=new y.Z("measurement-creator"),this.createNewLine=e=>{const t=e.roomId||this.currentRoomId()||null,i=e.floorId||this.currentFloorId();if(!i)throw new Ve.H(`Cannot create new line on invalid floor '${i}'`);const s={visible:!0,roomId:t,floorId:i,type:this.isFloorplan()?S.T.FloorplanOnly:S.T.ThreeD,text:"",created:new Date,modified:new Date},n=this.points.startGroup(s);this.currentGroup=n,this.points.push(e.point),this.currentLinePoints=1,this.setSelected(n);const o=this.points.getGroup(n);this.onGroupCreated(o.info.sid),this.pointer.setOrigin(e,!0)},this.addPointToLine=e=>{this.previousPoint.copy(e.point),this.points.push(e.point),++this.currentLinePoints,this.onGroupAddPoint(),this.pointer.setOrigin(e,!0)},this.updateLastPoint=e=>{this.points.update(this.points.length-1,e.point)},this.getIntersection=e=>this.pointer.getIntersection(e),this.setPhase=e=>{const t=this.getPhase();e!==t&&(this.previousPhase=t,this.changePhase(e))},this.restorePreviousPhase=()=>{this.setPhase(this.previousPhase)}}start(){if(this.getPhase()===V.au.IDLE){this.previousPoint.set(1e3,1e3,1e3),this.setPhase(V.au.CREATING),this.setSelected(-1);for(const e of this.inputSubscriptions)e.renew()}}cancelSubs(){for(const e of this.inputSubscriptions)e.cancel()}stop(){this.cancelSubs(),this.currentLinePoints=0,this.setSelected(-1),this.setPhase(V.au.IDLE),this.pointer.clearOrigin(),this.onDone()}}class je extends ze{constructor(e,t,i,s,n,o,r,a,l,c,h,d,u){super(e,t,s,n,l,h,d,u),this.setCreatePointProgress=o,this.updateCreatePointHit=r,this.toggleCameraMovement=a,this.continuous=c,this.onLongPressSuccess=e=>{this.log.debug("onLongPressSuccess while in phase:",V.au[this.getPhase()]),this.getPhase()===V.au.CREATING?(this.createNewLine(e),this.addPointToLine(e)):this.getPhase()===V.au.CREATING_NEXT_POINT&&(this.continuous()?(this.updateLastPoint(e),this.addPointToLine(e)):this.updateLastPoint(e)),this.setPhase(V.au.POINT_PLACED)},this.onLongPressStart=e=>{if(e.buttons===Re.r3.PRIMARY&&(this.getPhase()===V.au.CREATING||this.getPhase()===V.au.CREATING_NEXT_POINT)){const e=this.getIntersection();e&&(this.previousPoint.equals(e.point)||(this.setPhase(V.au.CONFIRMING_POINT),this.toggleCameraMovement(!1),this.setCreatePointProgress(Date.now(),je.longPressCreateThreshold),this.updateCreatePointHit(e),this.previousPhase===V.au.CREATING_NEXT_POINT&&(this.updateLastPoint(e),this.toggleLastPointDraggable(!1)),this.creatingPointTimeout=window.setTimeout((()=>{this.restorePreviousPhase(),this.onLongPressSuccess(e),this.toggleLastPointDraggable(!0)}),je.longPressCreateThreshold)))}},this.onLongPressEnd=()=>{this.getPhase()===V.au.CONFIRMING_POINT&&(this.log.debug("onLongPressEnd, cancelling confirmation"),this.setCreatePointProgress(0,je.longPressCreateThreshold),window.clearTimeout(this.creatingPointTimeout),this.toggleCameraMovement(!0),this.restorePreviousPhase()),this.getPhase()===V.au.CREATING_NEXT_POINT&&this.points.update(this.points.length-1,this.points.get(this.points.length-2)),this.setPlacedtoCreatePhase()},this.onDrag=()=>{const e=this.getIntersection();e&&(this.setPlacedtoCreatePhase(),this.setPhase(V.au.EDITING),this.previousPhase===V.au.CREATING_NEXT_POINT?this.updateLastTwoPoints(e):this.previousPhase===V.au.CREATING&&this.updateLastPoint(e))},this.onDragEnd=()=>{this.getPhase()===V.au.EDITING&&this.restorePreviousPhase(),this.getPhase()!==V.au.CREATING&&this.getPhase()!==V.au.CREATING_NEXT_POINT||(this.toggleLastPointDraggable(!1),this.toggleCameraMovement(!0))},this.toggleLastPointDraggable=e=>{e?(this.dragSub.renew(),this.dragEndSub.renew()):(this.dragSub.cancel(),this.dragEndSub.cancel())},this.updateLastTwoPoints=e=>{this.points.update(this.points.length-1,e.point),this.points.update(this.points.length-2,e.point)},this.dragSub=i(Ce._t,this.onDrag),this.dragEndSub=i(Ce._R,this.onDragEnd),this.inputSubscriptions.push(i(Ge.Vh,this.onLongPressStart),i(Ge.pt,this.onLongPressEnd)),this.dragSub.cancel(),this.dragEndSub.cancel(),this.cancelSubs()}start(){super.start()}stop(){if(this.getPhase()===V.au.CREATING_NEXT_POINT)if(this.continuous())this.points.pop();else{const e=this.points.getGroup(this.currentGroup);this.points.removeFromIdx(e.startIndex)}super.stop()}setPlacedtoCreatePhase(){this.getPhase()===V.au.POINT_PLACED&&(this.continuous()?(this.previousPhase===V.au.CREATING||this.previousPhase===V.au.CREATING_NEXT_POINT)&&this.setPhase(V.au.CREATING_NEXT_POINT):this.previousPhase===V.au.CREATING?this.setPhase(V.au.CREATING_NEXT_POINT):this.previousPhase===V.au.CREATING_NEXT_POINT&&this.setPhase(V.au.CREATING))}}je.longPressCreateThreshold=500;var We=i(36073);class Ze extends ze{constructor(e,t,i,s,n,o,r,a,l,c){super(e,t,s,n,o,r,a,l),this.continuous=c,this.onCreate=e=>{const t=this.previousPoint.distanceTo(e.point)>J.yV;if(t||2!==this.currentLinePoints){if(this.getPhase()===V.au.CREATING)return this.createNewLine(e),this.addPointToLine(e),void this.setPhase(V.au.CREATING_NEXT_POINT);t&&this.getPhase()===V.au.CREATING_NEXT_POINT&&(this.continuous()?(this.updateLastPoint(e),this.addPointToLine(e)):this.finishLine(e))}else{const t={origin:e.point.addScaledVector(e.normal,.05),normal:e.normal},i=this.pointer.getMeshIntersection(t);if(i)if(this.continuous()){this.points.pop();const e=new Ee(i,Pe.l1.Free);this.addPointToLine(e),this.addPointToLine(e),this.setPhase(V.au.CREATING_NEXT_POINT)}else this.finishLine(new Ee(i,Pe.l1.Free))}},this.onMouseMove=()=>{if(this.getPhase()===V.au.CREATING_NEXT_POINT){const e=this.getIntersection();e&&this.updateLastPoint(e)}},this.onMouseClick=e=>{if(e.button!==Re.MP.PRIMARY||this.getPhase()===V.au.IDLE)return;const t=this.getIntersection();t&&this.onCreate(t)},this.inputSubscriptions.push(i(We.mE,this.onMouseMove),i(Ie.R,this.onMouseClick)),this.cancelSubs()}start(){super.start()}stop(){this.getPhase()===V.au.CREATING_NEXT_POINT&&(this.points.pop(),this.currentLinePoints<3&&this.points.pop()),super.stop()}finishLine(e){this.points.pop(),this.addPointToLine(e),this.setPhase(V.au.CREATING),this.onDone()}}class qe{constructor(e,t,i,s,n,o){this.points=e,this.pointer=i,this.getPhase=s,this.onDrag=n,this.onDragEnd=o,this.inputSubscriptions=[],this.onDragBegin=(e,t,i)=>{if(!V.q8[this.getPhase()])return!1;if(!i||void 0===i.index)return!1;const s=this.points.isStartIndex(i.index)?i.index+1:i.index-1,n=this.points.get(s);return this.pointer.clearOrigin(),this.pointer.setOriginFromPointer(n),!0},this.onDragEndEvent=()=>!!V.q8[this.getPhase()]&&(this.onDragEnd(),this.pointer.clearOrigin(),!0),this.onDragEvent=(e,t,i)=>{if(e.buttons!==Re.r3.PRIMARY)return!1;if(!V.q8[this.getPhase()])return!1;if(!i||void 0===i.index||void 0===i.instanceId)return!1;const s=this.pointer.getIntersection();return s&&this.points.update(i.index,s.point),this.onDrag(i.instanceId),!0},this.inputSubscriptions.push(t.registerMeshHandler(Ce.E0,Ne.s.isType(ke),this.onDragBegin),t.registerMeshHandler(Ce._t,Ne.s.isType(ke),this.onDragEvent),t.registerMeshHandler(Ce._R,Ne.s.isType(ke),this.onDragEndEvent)),this.deactivate()}activate(){for(const e of this.inputSubscriptions)e.renew()}deactivate(){for(const e of this.inputSubscriptions)e.cancel()}}class Ke{constructor(e,t,i,s,n,o,r){this.lines=e,this.getLinesForPoint=t,this.editingMaterial=i,this.createPointSubscription=s,this.getPhase=o,this.getSelected=r,this.bindings=[],this.onDragEnd=e=>{for(const e of this.lines)e.restoreLineMaterial()},this.onClick=(e,t,i)=>{if(this.getPhase()!==V.au.IDLE)return!1;for(const e of this.lines)e.restoreLineMaterial();if(!i||void 0===i.index)return!1;if(e.down){const e=i.index;void 0!==e&&this.styleLines(e)}return!1},this.styleLines=e=>{const t=this.getLinesForPoint(e);for(const e of t)e.group===this.getSelected()&&e.line.overrideLineMaterial(this.editingMaterial)},this.bindings.push(n.registerMeshHandler(We.er,Ne.s.isType(ke),this.onClick),n.registerUnfilteredHandler(Ce._R,this.onDragEnd),...this.setupLineStyler(this.createPointSubscription)),this.deactivate()}activate(){for(const e of this.bindings)e.renew()}deactivate(){for(const e of this.bindings)e.cancel()}setupLineStyler(e){return[e(P.ADDED,(()=>{const e=this.lines[this.lines.length-1];e&&e.restoreLineMaterial()}),!0),e(P.UPDATED,((e,t)=>{this.styleLines(t)}),!0)]}}var Ye=i(30041),$e=i(90134),Qe=i(78626),Xe=i(22767),Je=i(35825),et=i(21265),tt=i(20599),it=i(62194);class st{constructor(e,t,i,s,n){this.pointer=e,this.mobile=t,this.getPhase=i,this.scene=s,this.getLayer=n,this.subscriptions=[],this.editing=!1,this.axisLines=[],this.axisAlignmentHelper=new b.Tme,this.updateSnapping=e=>{if(this.axisLines.length>0&&(this.pointer.removeSnapFeatures(this,pe.AxisAny),this.axisLines.length=0),e){this.axisAlignmentHelper.position.copy(e.point);const t=(0,Y.J2)(this.axisAlignmentHelper,e.point,e.normal);this.axisAlignmentHelper.updateMatrixWorld(!0);const i=this.axisAlignmentHelper.matrixWorld,s=100,n=(e,t,i,n,o,r)=>{const a=new ve(e.clone().multiplyScalar(s),t.clone().multiplyScalar(s),n,o,r);return a.applyMatrix4(i),a},o=(new b.yGw).copyPosition(i);this.axisLines.push(n(ee.f.UP,ee.f.DOWN,o,e.floorId,e.roomId,pe.AxisY)),t||this.axisLines.push(n(ee.f.FORWARD,ee.f.BACK,i,e.floorId,e.roomId,pe.AxisY),n(ee.f.UP,ee.f.DOWN,i,e.floorId,e.roomId,pe.AxisX),n(ee.f.LEFT,ee.f.RIGHT,i,e.floorId,e.roomId,pe.AxisZ)),this.axisLines.length>0&&this.pointer.addSnapFeatures(this,pe.AxisAny,this.axisLines)}}}init(){}dispose(){}activate(){this.subscriptions.push(this.pointer.onOriginChanged(this.updateSnapping,!0)),this.axisLineRenderer=new nt(this.scene,this.getLayer("cursor-mesh"))}deactivate(){this.subscriptions.forEach((e=>e.cancel())),this.subscriptions.length=0,this.pointer.removeSnapFeatures(this,pe.AxisAny),this.axisLineRenderer.dispose(),this.axisLineRenderer=null}beforeRender(){const e=this.getPhase(),t=this.mobile?!!V.Pj.mobile[e]:!!V.Pj.desktop[e];t!==this.editing&&(this.editing=t,this.axisLineRenderer.clearLines())}render(){this.editing&&this.axisLineRenderer.render(this.pointer.lastIntersection,this.axisLines)}}class nt{constructor(e,t){this.scene=e,this.layer=t,this.offsetFromMesh=.0075,this.featureColors={[pe.AxisX]:K.x,[pe.AxisZ]:K.z,[pe.AxisY]:K.y},this.axesVisibleInConstraints={[Pe.l1.EdgesAndPlanarAxes]:!0,[Pe.l1.Axes]:!0,[Pe.l1.PlanarAxes]:!0},this.linesActive=[],this.linesFree=[],this.axesVisible=[],this.axisMat=new b.nls({color:4095,linewidth:1,opacity:.75,transparent:!0,depthWrite:!1,depthTest:!0}),this.render=(e,t)=>{if(e&&this.axesVisibleInConstraints[e.constraint]&&t.length>0){if(t.length!==this.axesVisible.length?this.clearLines():this.axesVisible.every(((e,i)=>e.equals(t[i])))||this.clearLines(),this.container.parent!==this.scene.scene){for(const e of t){const t=this.getMesh(e);t.material.color.setHex(this.featureColors[e.featureType]),this.container.add(t),this.linesActive.push(t)}this.axesVisible=t.map((e=>e)),this.scene.addChild(l.a.Root,this.container),this.container.position.copy(e.normal).multiplyScalar(this.offsetFromMesh),this.container.updateMatrixWorld(!0)}}else this.clearLines()},this.clearLines=()=>{if(0!==this.linesActive.length){for(;this.linesActive.length>0;){const e=this.linesActive.pop();e&&(this.container.remove(e),this.linesFree.push(e))}this.scene.removeChild(l.a.Root,this.container)}},this.container=new b.Tme}getMesh(e){let t=this.linesFree.pop();return t?(t.geometry.setFromPoints([e.start,e.end]),t.geometry.verticesNeedUpdate=!0):(t=new ot(e,this.axisMat.clone()),t.layers.mask=this.layer.mask),t}dispose(){for(this.clearLines();this.linesFree.length>0;){const e=this.linesFree.pop();e&&(this.container.remove(e),e.geometry.dispose(),e.material.dispose())}this.linesActive=[],this.linesFree=[],this.container=null}}class ot extends b.x12{constructor(e,t){super(void 0,t),this.material=t,this.geometry=(new b.ZXM).setFromPoints([e.start,e.end])}}var rt,at=i(84496),lt=i(97631),ct=i(17256),ht=i(44333),dt=i(14567),ut=i(32400),pt=i(51770),mt=i(64341);!function(e){e.LINETYPE_2D="linetype_2D",e.LINETYPE_3D="linetype_3D"}(rt||(rt={}));const gt={[S.T.FloorplanOnly]:rt.LINETYPE_2D,[S.T.ThreeD]:rt.LINETYPE_3D},ft={[rt.LINETYPE_2D]:S.T.FloorplanOnly,[rt.LINETYPE_3D]:S.T.ThreeD};class vt{serialize(e){if(!e)return null;const t=[],{text:i,visible:s,type:n,floorId:o,roomId:r}=e.info;for(const i of e){const e={position:Q.ep.toVisionVector(i)};o&&(e.floorId=o),r&&(e.roomId=r),t.push(e)}const a={enabled:s,label:i,version:"3.2",lineType:gt[n]||rt.LINETYPE_3D,points:t};return this.validate(a)?a:null}validate(e){return!(!e||e.points.length<2)}}var yt=i(32020);const bt=new y.Z("mds-measurement-serializer");class wt{constructor(){this.points=(0,$e.C)([]),this.grouper=new j.h(this.points)}deserialize(e){if(!e||!Array.isArray(e))return bt.debug("No contents",e),null;this.grouper.reset();for(const t of e)if(this.validate(t)){const e=t.lineType||rt.LINETYPE_3D,i=ft[e],s=this.getModelContextFromPoint(t.points[0]),n=Object.assign(Object.assign({sid:t.id,text:t.label||"",visible:t.enabled,type:i},s),{created:(0,yt.p)(t.created),modified:(0,yt.p)(t.modified)});this.grouper.startGroup(n),t.points.forEach((e=>this.grouper.push(Q.ep.fromVisionVector(e.position))))}else bt.debug("Deserialized invalid Measurement data from MDS",t);return 0===this.grouper.length?null:this.grouper}validate(e){if(!e||"object"!=typeof e)return!1;const t=["id","points"].every((t=>t in e)),i=e.points&&Array.isArray(e.points)&&e.points.length>0,s=t&&i;return s||bt.debug("Invalid MDS.MeasurementPath:",{hasRequiredFields:t,hasPoints:i,data:e}),s}getModelContextFromPoint(e){return{floorId:e.floor&&e.floor.id?e.floor.id:"",roomId:e.room&&e.room.id?e.room.id:""}}}const St=new y.Z("MdsMeasurementModeStore");class Tt extends ut.u{constructor(){super(...arguments),this.serializer=new vt,this.deserializer=new wt}async read(){const{includeDisabled:e=!1}=this.config,t=this.getViewId();return this.query(mt.GetMeasurements,{modelId:t,includeDisabled:e}).then((e=>{if(St.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw St.error(Object.assign({},e)),new Error("MdsMeasurementModeStore.read failed");return this.deserializer.deserialize((0,pt.qw)(e,"data.model.measurementPaths"))}))}async create(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(!i)throw new Error("Could not create Measurement");return this.mutate(mt.AddMeasurement,{modelId:t,data:i}).then((e=>{if(St.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw St.error(Object.assign({},e)),new Error("MdsMeasurementModeStore.create failed");return(0,pt.qw)(e,"data.addMeasurementPath.id")}))}async update(e){const t=this.getViewId(),i=e.info.sid,s=this.serializer.serialize(e);if(!s)throw new Error("Could not update Measurement");return this.mutate(mt.PatchMeasurement,{modelId:t,pathId:i,data:s}).then((e=>{if(St.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw St.error(Object.assign({},e)),new Error("MdsMeasurementModeStore.update failed")}))}async delete(e){const t=this.getViewId();return this.mutate(mt.DeleteMeasurement,{modelId:t,pathId:e}).then((e=>{if(St.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw St.error(Object.assign({},e)),new Error("MdsMeasurementModeStore.delete failed")}))}}var Et=i(18687),_t=i(64614),xt=i(43711),Mt=i(90601);const Pt=new y.Z("measurement-mode");class At extends s.Y{constructor(){super(...arguments),this.name="measurement-mode",this.longPressStart=Date.now(),this.threshold=800,this.lineSidToPointMap={},this.mobile=!1,this.cameraAndDragBlocked=!1,this.blockNavigation=()=>!1,this.store=null,this.replaceContents=e=>{this.lineDerivedDataFactory.clear(),this.pointGroups.copy(e)},this.onEdit=e=>{const t=this.data.getGroupInfo(e),i=t&&t.info.sid||null;this.data.editingGroupId!==i&&(this.data.editingGroupId=i,this.colliders.setEditingGroup(e))},this.onEditEnd=()=>{if(this.data.editingGroupId){const e=this.pointGroups.getGroupById(this.data.editingGroupId);e&&(this.mutationRecord.updated.add(e.info.sid),this.save(),this.engine.broadcast(new it.av(this.buildAnalyticsMessageFromGroup(e))))}this.data.editingGroupId=null,this.colliders.setEditingGroup(void 0)},this.onCreatorAddNewLine=e=>{Pt.debug("onCreatorAddNewLine",e),this.data.creatingGroupId=e},this.onCreatorAddPoint=()=>{if(this.data.creatingGroupId){Pt.debug("onCreatorAddNewSegment",this.data.creatingGroupId);const e=this.pointGroups.getGroupById(this.data.creatingGroupId);if(e&&e.count>1&&e.length>0){const t=this.buildAnalyticsMessageFromGroup(e);this.engine.broadcast(new it.rf(Object.assign(Object.assign({},t),{startPosition:this.pointGroups.get(e.startIndex),endPosition:this.pointGroups.get(e.endIndex)})))}}},this.onCreatorStop=()=>{if(this.data.creatingGroupId){const e=this.pointGroups.getGroupById(this.data.creatingGroupId);e&&(e.count>1&&e.hasLength()?(this.engine.broadcast(new it.u6(Object.assign({},this.buildAnalyticsMessageFromGroup(e)))),this.mutationRecord.added.add(e.info.sid),this.save()):this.engine.broadcast(new it.ff))}this.data.creatingGroupId=null},this.onToggleMeasurementMode=async(e,t)=>{this.toggleMeasuringMode(e),await this.engine.commandBinder.issueCommand(new G.I(e&&t))},this.onViewmodeChange=()=>{this.getPhase()!==V.au.CLOSED&&this.stopMeasuring()},this.onSweepChange=()=>{const e=this.getPhase();e!==V.au.CREATING&&e!==V.au.CREATING_NEXT_POINT&&this.setSelected(-1)},this.initStorageOnApplicationChange=()=>{this.config.readonly=this.applicationData.application!==C.Mx.WORKSHOP;const e=!this.config.readonly||this.playerOptions.options.measurements_saved;if(this.data.modeActive()&&this.engine.commandBinder.issueCommand(new R.O(!1)),e&&this.store){const e=this.store;this.store=null,e.read().then((t=>{t&&this.replaceContents(t.groups()),this.store=e}))}},this.getPhase=()=>this.data.phase,this.toggleCameraMovement=e=>{e||this.cameraAndDragBlocked?e&&this.cameraAndDragBlocked&&(this.dragInterceptor.cancel(),this.navigation.removeNavigationRule(this.blockNavigation),this.cameraAndDragBlocked=!1):(this.dragInterceptor.renew(),this.navigation.addNavigationRule(this.blockNavigation),this.cameraAndDragBlocked=!0)},this.getConstraint=()=>this.settings.tryGetProperty(D.F.MeasurementSnapping,!1)?this.viewmodeData.isFloorplan()?J.xh.floorplan:this.constraint:J.xh.disabled,this.getSelected=()=>this.data.selectedGroupIndex,this.setSelected=e=>{this.data.selectedGroupIndex!==e&&this.data.setSelectedGroupIndex(e)},this.setSelectedById=async e=>{if(null===e)this.setSelected(-1);else{const t=this.pointGroups.getGroupById(e);t&&this.setSelected(t.index)}},this.deleteSelectedMeasurement=()=>{-1!==this.data.selectedGroupIndex&&(this.deleteMeasurement(this.data.selectedGroupIndex),this.setSelected(-1),this.changePhase(V.au.IDLE),this.mobile||(this.navigation.removeNavigationRule(this.blockNavigation),this.engine.commandBinder.issueCommand(new d.u(h.C.DEFAULT))))},this.deleteMeasurement=(e,t=!1)=>{const i=this.buildAnalyticsMessage(e);i&&this.engine.broadcast(new it.$Z(Object.assign(Object.assign({},i),{count:this.pointGroups.groupCount-1})));const s=this.pointGroups.getGroup(e);s&&(this.pointGroups.removeGroup(e),s.info.sid!==this.data.creatingGroupId&&(this.mutationRecord.removed.add(s.info.sid),t||this.save()))},this.deleteMeasurementBySids=async e=>{const t=e.sids;for(const i of t){const t=this.pointGroups.getGroupById(i);if(!t)throw Pt.error("Measurement delete failed",Object.assign({},e)),Error("Measurement delete failed, not found");this.deleteMeasurement(t.index,!0)}this.save()},this.onToggleContinuous=()=>{this.stopMeasuring()},this.changePhase=e=>{this.getPhase()!==e&&(Pt.debug(`Phase Change: ${V.au[this.getPhase()]} -> ${V.au[e]}`),this.previousPhase=this.getPhase(),this.data.setPhase(e))},this.restorePreviousPhase=()=>{this.changePhase(this.previousPhase)},this.buildAnalyticsMessage=e=>{const t=this.pointGroups.getGroup(e);return t&&t.hasLength()?this.buildAnalyticsMessageFromGroup(t):null},this.buildAnalyticsMessageFromGroup=e=>{const t=this.viewmodeData.isFloorplan()?S.T[S.T.FloorplanOnly]:S.T[S.T.ThreeD];return Object.assign(Object.assign({sid:e.info&&e.info.sid?e.info.sid:e.describe(),totalLength:e?e.length:0,segments:e?e.count:0,temporary:!e.info||e.info.sid===e.describe(),viewmode:this.viewmodeData.currentMode,floorId:e.info.floorId,continuous:this.settings.tryGetProperty(D.F.MeasurementContinuousLines,!1)},this.getAnalyticsForConstraints()),{type:t})},this.getAnalyticsForConstraints=()=>{const e=this.pointer.lastIntersection;if(e){const t=e.featureType,i=e.constraint;return{featureType:void 0!==t?pe[t]:"None",constraint:Pe.l1[i]}}return null},this.toggleMeasuringMode=e=>{Pt.debug("toggleMeasuringMode",e),e!==(this.getPhase()!==V.au.CLOSED)&&(e?(this.engine.toggleRendering(this,!0),this.changePhase(V.au.IDLE),this.editor.activate(),this.lineStyler.activate(),this.colliders.activate(),this.renderer.activate(),this.textRenderer.activate(),this.scene.addChild(l.a.Root,this.textRenderer.container),this.engine.broadcast(new it.$n(!0,this.viewmodeData.currentMode,this.pointGroups.groupCount)),this.pointer.preload()):(this.engine.toggleRendering(this,!1),this.stopMeasuring(),this.changePhase(V.au.CLOSED),this.toggleCameraMovement(!0),this.editor.deactivate(),this.lineStyler.deactivate(),this.colliders.deactivate(),this.renderer.deactivate(),this.textRenderer.deactivate(),this.scene.removeChild(l.a.Root,this.textRenderer.container),this.engine.broadcast(new it.$n(!1,this.viewmodeData.currentMode,this.pointGroups.groupCount))))},this.startMeasuring=()=>{this.mobile||(this.navigation.addNavigationRule(this.blockNavigation),this.engine.commandBinder.issueCommand(new d.u(h.C.XHAIR))),this.creator.start()},this.stopMeasuring=()=>{const e=this.isMeasurementComplete(this.data.selectedGroupIndex);this.isCreating()&&!e&&this.deleteSelectedMeasurement(),this.creator.stop(),this.mobile||(this.navigation.removeNavigationRule(this.blockNavigation),this.engine.commandBinder.issueCommand(new d.u(h.C.DEFAULT)))},this.setupIntersectionVisuals=(e,t,i,s,n,o,r,a,l)=>{t.addVisibilityRule((()=>{const e=this.getPhase();return!(!r&&e===V.au.CREATING||e===V.au.CONFIRMING_POINT||e===V.au.CREATING_NEXT_POINT||e===V.au.EDITING)}));const c={cameraData:n,playerCamera:s.camera,scene:s};return new ue(r,this.getPhase,o,c,e,a,(()=>i.chunks),l.isFloorplan)},this.mutationRecord={[_t.KI.added]:new Set,[_t.KI.updated]:new Set,[_t.KI.removed]:new Set},this.clearMutationRecord=()=>{for(const e of Object.values(this.mutationRecord))e.clear()},this.renameMeasurement=async e=>{const t=this.pointGroups.getGroupById(e.sid);if(!t)throw Pt.error("Measurement rename failed",Object.assign({},e)),Error("Measurement rename failed, not found");const i=void 0!==e.text&&e.text.length<=24;if(!t||!i)throw Pt.error("Measurement text invalid, text must be between 0 and 24 charachters in length.",Object.assign({},e)),new Error("Measurement text invalid");{const i=""===t.info.text&&e.text.length>0,s=!i&&t.info.text!==e.text;this.pointGroups.updateGroupInfo(t.index,Object.assign(Object.assign({},t.info),{text:e.text})),this.mutationRecord.updated.add(t.info.sid),this.save(),i&&this.engine.broadcast(new it.ty(e.sid,e.text)),s&&this.engine.broadcast(new it.mM(e.sid,t.info.text,e.text))}},this.onChangeVisibility=async e=>{for(const t of e.sids){const i=this.pointGroups.getGroupById(t);if(!i)throw Pt.error("Measurement visibility toggle failed",Object.assign(Object.assign({},e),{group:i})),new Error("Measurement visibility toggle failed, not found");{this.pointGroups.updateGroupInfo(i.index,Object.assign(Object.assign({},i.info),{visible:e.visible})),this.mutationRecord.updated.add(i.info.sid);const t=this.buildAnalyticsMessage(i.index);t&&this.engine.broadcast(new it.av(t))}}this.save()}}async init(e,t){this.config=e,this.mobile=(0,et.tq)(),this.engine=t;const[i,s,l,h,m,y,b,w,S,T]=await Promise.all([t.getModule(n.default),t.getModule(o.default),t.getModule(r.default),t.getModule(c.default),t.getModule(a.default),t.market.waitForData(f.c),t.market.waitForData(g.M_),t.market.waitForData(v.O),t.market.waitForData(I.Z),t.market.waitForData(Et.Z)]);this.settings=await t.market.waitForData(A.e),this.playerOptions=await t.market.waitForData(O.af),this.scene=i.getScene(),this.viewmodeData=w,this.floorsViewData=y,this.roomData=T,this.input=l,this.navigation=await t.getModule(at.default);const E=await t.getModule(lt.F);this.lineDerivedDataFactory=new x(b,w,y,(()=>!!S.currentSweep&&S.isSweepAligned(S.currentSweep)),(()=>this.settings.tryGetProperty(D.F.UnitType,O.Mc.USFractional)),(()=>!0));const _=t.claimRenderLayer(this.name);this.data=new z.X,t.market.register(this,z.X,this.data);const M=(0,$e.C)([]);this.pointGroups=new j.h(M);const G=(e,t,i=!1)=>((e,t)=>{const i=t&P.ADDED,s=t&P.REMOVED,n=t&P.UPDATED,o={};let r;return new q.gm((()=>e),(t=>r=e.onElementChanged((e=>(o.onAdded=i?e:void 0,o.onRemoved=s?e:void 0,o.onUpdated=n?e:void 0,o))(t))),(e=>{r&&r.cancel()}))})(M,e).createSubscription(t,i);this.dataSubscription=G(P.ALL,(()=>{this.data.repopulate(this.pointGroups.groups()),this.data.commit()}),!0),this.applicationData=await t.market.waitForData(C.pu),this.config.storageProvider===ct.Xq.MDS&&(this.store=this.configureStorage(),this.initStorageOnApplicationChange()),this.constraint=this.mobile?J.xh.mobile:J.xh.desktop,this.pointer=new Be(m,this.getConstraint,this.mobile,this.floorsViewData,this.viewmodeData);const W=new He(this.pointGroups,G,this.pointer,(()=>{const e=this.settings.tryGetProperty(D.F.MeasurementContinuousLines,!1),t=this.getPhase()===V.au.CREATING||this.getPhase()===V.au.CREATING_NEXT_POINT||this.previousPhase===V.au.CREATING_NEXT_POINT&&this.getPhase()===V.au.EDITING;return e&&this.mobile&&t}));t.addComponent(this,W);const Z=new st(this.pointer,this.mobile,this.getPhase,this.scene,t.getRenderLayer);t.addComponent(this,Z);const K=(e,t)=>l.registerUnfilteredHandler(e,t);if(this.mobile){const e=(e,t)=>{this.longPressStart=e,this.threshold=t},t=e=>{const t=(0,X.q9)(b,e.point);this.data.setPointPosition(t.screenPosition)};this.creator=new je(this.pointGroups,this.setSelected,K,this.pointer,this.changePhase,e,t,this.toggleCameraMovement,this.getPhase,(()=>this.settings.tryGetProperty(D.F.MeasurementContinuousLines,!1)),this.viewmodeData.isFloorplan,this.floorsViewData.getHighestVisibleFloorId,(()=>this.roomData.selected.value))}else this.creator=new Ze(this.pointGroups,this.setSelected,K,this.pointer,this.changePhase,this.getPhase,this.viewmodeData.isFloorplan,this.floorsViewData.getHighestVisibleFloorId,(()=>this.roomData.selected.value),(()=>this.settings.tryGetProperty(D.F.MeasurementContinuousLines,!1)));this.creator.onGroupCreated=this.onCreatorAddNewLine,this.creator.onGroupAddPoint=this.onCreatorAddPoint,this.creator.onEdit=this.onEdit,this.creator.onDone=this.onCreatorStop;const Y=(e,t,i)=>{const s=this.pointGroups.getGroup(e),n=s.describe(i);this.lineSidToPointMap[n]=i;const o=this.lineDerivedDataFactory.get(n);return this.lineDerivedDataFactory.make(n,(()=>({start_position:this.pointGroups.get(t),end_position:this.pointGroups.get(i),visible:s.info.visible,floorId:s.info.floorId,roomId:s.info.roomId,type:s.info.type,text:this.pointGroups.isStartIndex(t)?s.info.text:""})),o)};this.renderer=new $(this.pointGroups,G,b,h,_,t.claimRenderLayer("measure-lines"),this.getSelected,Y),await t.addComponent(this,this.renderer);const Q=new Ye.u({color:"black",background:!0,backgroundColor:"#ffffff"});this.textRenderer=new te(this.pointGroups,G,b,_,tt.z.labels,Q,Y),await t.addComponent(this,this.textRenderer),this.textRenderer.deactivate(),this.editor=new qe(this.pointGroups,l,this.pointer,this.getPhase,this.onEdit,this.onEditEnd),this.colliders=new ke(this.pointGroups,this.input,b,this.mobile,(e=>{this.engine.commandBinder.issueCommand(new d.u(e))}),this.getPhase,this.changePhase,this.restorePreviousPhase,this.setSelected,this.getSelected,this.onEdit,this.onEditEnd),this.lineStyler=new Ke(this.renderer.lines,this.renderer.getLinesForPoint,this.renderer.dottedMaterial,G,this.input,this.getPhase,this.getSelected);const[ee,ie]=await Promise.all([t.getModule(u.default),t.getModule(p.default)]),se=this.setupIntersectionVisuals(s,ee,ie.mesh,this.scene,b,this.pointer,this.mobile,t.getRenderLayer,this.viewmodeData);t.addComponent(this,se),this.dragInterceptor=this.input.registerPriorityHandler(Ce._t,ge.S,(()=>!0)),this.dragInterceptor.cancel(),this.mobile||this.bindings.push(...this.hotkeys()),this.bindings.push(this.applicationData.onPropertyChanged("application",this.initStorageOnApplicationChange),w.makeModeChangeSubscription(this.onViewmodeChange),S.makeSweepChangeSubscription(this.onSweepChange),t.commandBinder.addBinding(R.O,(async e=>this.onToggleMeasurementMode(e.on,e.dimWhileActive))),t.commandBinder.addBinding(L.c,(async()=>this.startMeasuring())),t.commandBinder.addBinding(N.v,(async e=>this.setSelected(e.index))),t.commandBinder.addBinding(k.B,(async()=>this.stopMeasuring())),t.commandBinder.addBinding(F.Ev,(async()=>this.deleteSelectedMeasurement())),t.commandBinder.addBinding(F.Tn,(async e=>this.deleteMeasurement(e.index))),t.commandBinder.addBinding(N.t,(async e=>this.setSelectedById(e.sid))),t.commandBinder.addBinding(B.W,this.onChangeVisibility),t.commandBinder.addBinding(U.R,this.renameMeasurement),t.commandBinder.addBinding(F.JM,this.deleteMeasurementBySids),t.commandBinder.addBinding(H.d,(async e=>this.replaceContents(e.points.groups()))),this.dataSubscription,this.settings.onPropertyChanged(D.F.MeasurementContinuousLines,(()=>this.onToggleContinuous())),E.onSave((()=>this.saveDiff()),{dataType:ct.g.MEASUREMENTS})),t.toggleRendering(this,!1),this.registerDebugSettings()}isCreating(){const e=this.getPhase();return e===V.au.CREATING||e===V.au.CREATING_NEXT_POINT}setConstraintStyle(e){Pt.debug("setConstraintStyle:",Pe.l1[e]),this.constraint=e}isMeasurementComplete(e){if(-1===e||!this.isCreating())return!0;const t=this.getPhase(),i=this.pointGroups.getGroup(e);return this.settings.tryGetProperty(D.F.MeasurementContinuousLines,!1)?i.count>2&&t===V.au.CREATING_NEXT_POINT:i.count>=2&&t===V.au.CREATING}hotkeys(){return[this.input.registerHandler(Qe.e,(e=>{if(e.state===Xe.M.PRESSED)switch(e.key){case Je.R.ESCAPE:this.getPhase()===V.au.CONFIRMING_POINT?(this.creator.stop(),this.creator.start(),this.changePhase(V.au.CREATING)):this.isCreating()?this.stopMeasuring():this.applicationData.application!==C.Mx.WORKSHOP&&this.getPhase()!==V.au.CLOSED&&this.engine.commandBinder.issueCommand(new xt.tT(Mt.w1.MEASUREMENTS,!1));break;case Je.R.BACKSPACE:case Je.R.DELETE:this.getPhase()!==V.au.CLOSED&&this.getPhase()!==V.au.EDITING&&this.deleteSelectedMeasurement();break;case Je.R.RETURN:const e=this.pointGroups.groupCount-1;this.isMeasurementComplete(e)&&this.stopMeasuring()}})),this.input.registerHandler(Qe.e,(e=>{if(e.key===Je.R.SHIFT||e.key===Je.R.ALT){const{altKey:t,shiftKey:i}=e.modifiers,s=i&&t?J.xh.shiftAlt:t?J.xh.alt:i?J.xh.shift:J.xh.desktop;this.setConstraintStyle(s)}}))]}onUpdate(e){if(this.getPhase()===V.au.CLOSED)return;const t=this.data.selectedGroupIndex,i=this.mobile?V.Ph.mobile[this.getPhase()]:V.Ph.desktop[this.getPhase()];for(const s in this.lineSidToPointMap){const n=this.lineDerivedDataFactory.get(s);if(n){n.opacity.tick(e);const o=this.lineSidToPointMap[s],r=this.pointGroups.groupFromPointIndex(o),a=r===t&&n.visible?1:n.opacity.value,l=i&&!n.labelVisible?0:a;this.textRenderer.setTextOpacityByPoint(o,l),this.renderer.setLineOpacityByPoint(o,a),-1!==r&&this.colliders.setGroupVisible(r,a>0)}}if(this.mobile)if(this.getPhase()===V.au.CONFIRMING_POINT){const e=(Date.now()-this.longPressStart)/this.threshold;e<=1&&this.data.setPressProgress(e)}else if(this.getPhase()===V.au.CREATING&&0!==this.data.pressProgress){const e=0;this.data.setPressProgress(e)}}dispose(e){this.stopMeasuring(),this.engine.commandBinder.issueCommand(new R.O(!1)),this.colliders.dispose(),this.textRenderer.dispose(),this.renderer.dispose(),e.disposeRenderLayer(this.name),super.dispose(e)}async save(){return this.engine.commandBinder.issueCommand(new ht.VQ({dataTypes:[ct.g.MEASUREMENTS]}))}async saveDiff(){if(this.data.repopulate(this.pointGroups.groups()),this.data.commit(),this.data.notifyDataChanged(),this.config.readonly||!this.store)return void this.clearMutationRecord();const e=this.mutationRecord,t=[];Pt.debug("MDS mutation ops:",`{\n      added: '${[...e.added.keys()]}',\n      updated: '${[...e.updated.keys()]}',\n      removed: '${[...e.removed.keys()]}',\n    }`);for(const i of e[_t.KI.removed]){if(e[_t.KI.added].has(i))e[_t.KI.added].delete(i);else{const e=this.store.delete(i);t.push(e)}e[_t.KI.updated].delete(i)}for(const i of e[_t.KI.added]){const s=this.pointGroups.getGroupById(i);if(s){const e=this.store.create(s).then((e=>{e&&(Pt.debug(`Updating group id for new path: ${s.info.sid} -> ${e}`),this.pointGroups.updateGroupInfo(s.index,Object.assign(Object.assign({},s.info),{sid:e}))),this.data.repopulate(this.pointGroups.groups()),this.data.commit(),this.data.notifyDataChanged()}));t.push(e)}e[_t.KI.updated].delete(i)}for(const i of e[_t.KI.updated]){const e=this.pointGroups.getGroupById(i),s=this.store.update(e);t.push(s)}return this.clearMutationRecord(),Promise.all(t)}configureStorage(){const{readonly:e,storageProvider:t,baseUrl:i}=this.config;if(t===ct.Xq.MDS){Pt.info(`Loading Measurements from ${t}`);const s=new Tt({readonly:e,includeDisabled:!e,baseUrl:i});return this.engine.market.waitForData(dt.Q).then((e=>{e.setRevertable(ct.g.MEASUREMENTS)})),s}return null}async registerDebugSettings(){const e=await this.engine.getModule(m.default);e.registerMenuEntry({header:"Measurement Debug",setting:"measure/fp_in_dh",initialValue:()=>!1,onChange:t=>(this.lineDerivedDataFactory.setDollhouseLineStyle(t?S.T.FloorplanOnly:S.T.ThreeD),e.updateSetting("measure/fp_in_dh",t))})}}const Ot=At},62194:(e,t,i)=>{"use strict";i.d(t,{rf:()=>n,u6:()=>o,ff:()=>r,ty:()=>a,mM:()=>l,$Z:()=>c,av:()=>h,$n:()=>d});var s=i(93528);class n extends s.v{constructor(e){super(),this.data=e}}class o extends s.v{constructor(e){super(),this.data=e}}class r extends s.v{}class a extends s.v{constructor(e,t){super(),this.sid=e,this.text=t}}class l extends s.v{constructor(e,t,i){super(),this.sid=e,this.oldText=t,this.newText=i}}class c extends s.v{constructor(e){super(),this.data=e}}class h extends s.v{constructor(e){super(),this.data=e}}class d extends s.v{constructor(e,t,i){super(),this.opened=e,this.viewmode=t,this.count=i}}},11203:(e,t,i)=>{"use strict";i.d(t,{yV:()=>n,NZ:()=>o,E0:()=>r,ox:()=>a,X7:()=>l,xh:()=>c,Oq:()=>h,Hn:()=>d});var s=i(90384);const n=.01,o=.001,r=!0,a={highResThreshold:1081,desktopSize:192,desktopSizeHighRes:320,mobileSize:128},l={smoothness:.4,perspective:{fov:40,thresholdClose:1,thresholdFar:8,offsetClose:.25,offsetFar:.5,scale:1},ortho:{fov:5,thresholdClose:5,thresholdFar:20,offsetClose:15,offsetFar:30,scale:4}},c={desktop:s.l1.Edges,floorplan:s.l1.Axes,mobile:s.l1.Edges,alt:s.l1.Free,shift:s.l1.PlanarAxes,shiftAlt:s.l1.EdgesAndPlanarAxes,disabled:s.l1.Free},h={mobile:.15,desktop:.1},d={SCALE:.1,SCALE_NDC:.5,SCALE_ASPECT:.035,SCALE_DISTANCE:.025}},70781:(e,t,i)=>{"use strict";var s;i.d(t,{T:()=>s}),function(e){e[e.FloorplanOnly=0]="FloorplanOnly",e[e.ThreeD=1]="ThreeD"}(s||(s={}))},94052:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>B});var s=i(83032),n=i(54122),o=i(97631),r=i(17256),a=i(2212),l=i(70781),c=i(78909);class h extends c.T{constructor(){super(...arguments),this.type=l.T.FloorplanOnly,this.sid="",this.visible=!1,this.version="3.2",this.created=new Date,this.modified=new Date,this.start_position=new a.Pa4,this.end_position=new a.Pa4,this.text="",this.group=-1,this.groupOrder=-1}copy(e){return this.type=e.type,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.created=e.created,this.modified=e.modified,this.floorId=e.floorId,this.start_position.copy(e.start_position),this.end_position.copy(e.end_position),this.group=e.group,this.groupOrder=e.groupOrder,this.roomId=e.roomId,this.commit(),this}}h.RAYCASTER_GROUP="measurements";var d=i(31113),u=i(25799),p=i(79758),m=i(11618),g=i(90134);const f=new u.Z("measure->group"),v=(e,t)=>{if(t?(t.pointGroups.reset(),t.lookup.idToGroup={},t.lookup.groupToIds={},t.lookup.groupCount=0):t={pointGroups:new m.h((0,g.C)([])),lookup:{idToGroup:{},groupToIds:{},groupCount:0}},e.length>0){e.sort(((e,t)=>100*(e.group+1)+e.groupOrder-(100*(t.group+1)+t.groupOrder)));for(const i of e){const e=0===t.pointGroups.groupCount||i.group>=t.pointGroups.groupCount;y(i,t.pointGroups,e,t.lookup)}u.Z.level>=4&&(f.debug("sorce",e.slice().map((e=>`${e.sid},${e.group},${e.groupOrder}`))),f.debug(t.pointGroups.toString()))}return t},y=(e,t,i,s)=>{if(i){const{floorId:i,roomId:n,text:o,type:r,sid:a,visible:l,created:c,modified:h}=e,d={floorId:i,roomId:n,text:o,type:r,sid:a,visible:l,created:c,modified:h};t.startGroup(d),t.push(e.start_position),s.groupCount++}const n=t.groupCount-1;t.push(e.end_position),s.idToGroup[e.sid]=n,s.groupToIds[n]||(s.groupToIds[n]=[]),s.groupToIds[n].push(e.sid)};var b=i(41263),w=i(80034),S=i(20331),T=i(7943),E=i(15119),_=i(97620),x=i(46162),M=i(32020);const P=new u.Z("measurement-serialization"),A=e=>{if(!e)return null;const t={};try{if(e)for(const i of Object.keys(e)){const s=e[i];if(!s||!s.version||isNaN(Number.parseFloat(s.version))||Number.parseFloat(s.version)<3)continue;const n="type"in s?s.type:l.T.FloorplanOnly,o=new h,r=void 0!==s.floor&&-1!==s.floor?String(s.floor):"",a=s.room?String(s.room):null;t[s.sid]=o.copy({start_position:(0,_.gj)(s.start_position),end_position:(0,_.gj)(s.end_position),type:n,sid:s.sid,text:s.text||"",visible:s.visible,floorId:r,created:(0,M.p)(s.created),modified:(0,M.p)(s.modified),version:o.version,roomId:a,group:void 0!==s.group?s.group:-1,groupOrder:void 0!==s.groupOrder?s.groupOrder:-1})}}catch(e){return P.debug("Error parsing measurement data;",e),null}return t};function O(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new S.gO,o=A,r=(e,t)=>{const i=(0,x.p$)(e);(0,x.TS)(i,t);const s={};for(const e of Object.keys(i)){const t=i[e];s[e]=t}return((e,t)=>{const i={},s=(0,x.p$)(e);(0,x.TS)(s,t);for(const e of Object.keys(s)){const t=s[e];if(!t)continue;i[t.sid]={type:t.type,start_position:(0,_.gj)(t.start_position),end_position:(0,_.gj)(t.end_position),sid:t.sid,text:t.text,visible:t.visible,created:(0,M.U)(t.created),modified:(0,M.U)(t.modified),version:"3.2",group:t.group,groupOrder:t.groupOrder};const n=parseInt(t.floorId,10);isNaN(n)||(i[t.sid].floor=n);const o=parseInt(t.roomId||"",10);isNaN(o)||(i[t.sid].room=o)}return i})(s,{})};const a=`${s}/api/v1/jsonstore/model/measurements/${t}`;if(i){const e=new w.gh({queue:n,path:a,deserialize:o});return new b.iY({publishStores:[e]})}const l=new w.MU({queue:n,path:a,batchUpdate:!0,deserialize:o,serialize:r}),c=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,h=new E.Z({queue:n,path:c,cachedData:{data:null},deserialize:T.S.sessionObjectExtract(E.j.WS3_Measurements,o),serialize:r},E.j.WS3_Measurements);return new b.iY({publishStores:[l],legacyEditStore:h,editStoreKey:b.aw.MEASUREMENTS})}var D=i(71229),I=i(26983),C=i(67125),R=i(83083),L=i(60841),N=i(29675),k=i(62431);const F=new u.Z("MeasurementData");class B extends n.Y{constructor(){super(...arguments),this.name="measurements-data",this.idLookup=new Map,this.tryInferMeshIds=e=>{for(const t in e){const i=e[t];i.type!==l.T.ThreeD&&i.type!==l.T.FloorplanOnly||this.roomDataModule.inferMeshIdsFromPoint(i,i.start_position)}},this.tryInferGroups=e=>{const t=Object.keys(e);if(t.every((t=>void 0!==e[t].group&&-1!==e[t].group)))return;let i=0,s=0,n=0;const o={},r={},a=new Set,l=e=>`${e.x.toFixed(5)},${e.y.toFixed(5)},${e.z.toFixed(5)}`;for(const c of t){const t=e[c],h=l(t.start_position),d=l(t.end_position);a.has(h)?(s=o[h],n=e[r[h]].groupOrder+1):a.has(d)?(s=o[d],n=e[r[d]].groupOrder+1):(s=i++,n=0),a.has(h)||a.add(h),a.has(d)||a.add(d),o[h]=s,o[d]=s,r[h]=t.sid,r[d]=t.sid,t.group=s,t.groupOrder=n,t.commit()}}}async init(e,t){this.engine=t;const{readonly:i}=e,s=[this.tryInferMeshIds,this.tryInferGroups,this.updateIdLookup.bind(this)],[n,a,l,c,h]=await Promise.all([t.getModule(d.default),t.getModule(o.F),t.market.waitForData(k.af),t.market.waitForData(I.X),t.market.waitForData(N.pu)]);this.config=e,this.roomDataModule=n,this.measurementModeData=c,this.applicationData=h;const u=l.options.measurements&&l.options.measurements_saved;if(i&&!u)return;this.store=this.configureStorage(this.config);const p=await this.store.read()||{};if(s.forEach((e=>e(p))),this.measurementMap=(0,D.q)(p),!i){const e=new R.c(this.measurementMap,{aggregationType:L.E.NextFrame},t);this.store.addMonitor(e),this.bindings.push(h.onPropertyChanged("application",(()=>this.onApplicationChanged())),a.onSave((()=>this.save()),{dataType:r.g.MEASUREMENTS}),a.onRevert((()=>this.revert()),{dataType:r.g.MEASUREMENTS}))}this.onApplicationChanged()}configureStorage(e){const{modelId:t,baseUrl:i,queue:n,readonly:o}=e;F.info(`Loading Measurements from ${r.Xq.JSONSTORE}`);const a=O({modelId:t,readonly:o,baseUrl:i,queue:n});return new s.N(a,{dataType:r.g.MEASUREMENTS,modelId:t,readonly:o,engine:this.engine})}onApplicationChanged(){const e=this.measurementMap.values.map((e=>(new h).copy(e)));this.engine.commandBinder.issueCommand(new p.d({points:v(e).pointGroups}))}async save(){this.applicationData.application===N.Mx.WORKSHOP&&this.updateMeasurementsFromGroups()}async revert(){this.store instanceof s.N&&await this.store.revert()}updateMeasurementsFromGroups(){const e=new Set(this.measurementMap.keys),t=new Set;for(const e of this.measurementModeData.groups())for(let i=0;i<e.count;i++){const s=e.get(i),n=e.has(i+1)&&e.get(i+1);if(!n)continue;const o=this.idLookup.get(e.info.sid);let r;r=o&&i in o?o[i]:0===i?e.info.sid:(0,C.f)(),t.add(r);const a=(new h).copy({sid:r,start_position:s,end_position:n,floorId:e.info.floorId,roomId:e.info.roomId,group:e.index,groupOrder:i,text:e.info.text,visible:e.info.visible,version:"3.2",type:e.info.type,created:e.info.created,modified:e.info.modified});this.measurementMap.has(r)?this.measurementMap.get(r).copy(a):(F.debug(`Added Measurement ${r} in group ${e.index} (${i})`),this.measurementMap.set(r,a))}for(const i of e)t.has(i)||(F.debug(`Removed Measurement ${i}`),this.measurementMap.delete(i));this.updateIdLookup(this.measurementMap.values)}updateIdLookup(e){const t=Object.values(e).reduce(((e,t)=>(0===t.groupOrder&&(e[t.group]=t.sid),e)),{}),i=Object.values(e).sort(((e,t)=>e.group-t.group||e.groupOrder-t.groupOrder)),s=new Map;for(const e of i){const i=t[e.group];if(void 0===i){F.warn(`Group ${e.group} started with unexpected index ${e.groupOrder}`);continue}const n=s.get(i)||[];n.push(e.sid),s.set(i,n)}this.idLookup=s}onUpdate(e){}}},75638:(e,t,i)=>{"use strict";i.d(t,{b:()=>s});const s="features/measurements-nudge"},12153:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.urls=e,this.sid=t,this.vrSupported=i}}},55580:(e,t,i)=>{"use strict";i.d(t,{T:()=>n});var s=i(19413);class n extends s.V{constructor(e){super(),this.name="model",this.model=e}}},22423:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>k});var s=i(54122),n=i(30853),o=i(14567),r=i(17256),a=i(63418),l=i(20331),c=i(45805),h=i(25799),d=i(26149),u=i(26986);const p=new h.Z("modelurls");class m{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return e.templates&&e.catalog_file&&(!e.expires||1e3*e.expires>Date.now())}update(e){if(!e.templates)throw new Error("No templates found.");return this.baseUrl=e.templates[0],e.expires?this.expires=1e3*e.expires:this.expires=Date.now()+c.Z.signedUrlDefaultExpireTime,Promise.resolve()}get(e){return this.baseUrl&&this.baseUrl.replace("{{filename}}",e)}}class g{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return!0}update(e){return Promise.resolve()}get(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("Tried getting relative model url with no signed urls configured.");return e}}class f{constructor(e,t){this.api=e,this.endpoint=t,this.urlContainer=null,this.previousRefreshPromise=null,this.containerClasses=[g],t&&(this.containerClasses=[m],this.endpoint=t+"?type=3")}needsRefresh(){const e=this.urlContainer?this.urlContainer.expires:Date.now();return Date.now()+c.Z.signedUrlRefreshBuffer>e}refresh(){if(!this.needsRefresh())return Promise.resolve();if(!this.previousRefreshPromise){p.debug("Refreshing urls...");const e=this;this.previousRefreshPromise=this._refresh().then((function(){p.debug("Refreshed"),e.previousRefreshPromise=null}),(function(t){p.error("Failed url refresh, urls might go stale soon",t),e.previousRefreshPromise=null}))}return this.previousRefreshPromise}async _refresh(e=!0){const t=this.endpoint?await this.api.get(this.endpoint,{responseType:"json",prefetchFrom:e?"files":void 0,auth:(0,d.PW)(this.endpoint),priority:l.ru.HIGHEST}):null;if(this.urlContainer&&this.urlContainer.validate(t))return this.urlContainer.update(t);for(const e of this.containerClasses){const i=new e;if(i.validate(t))return p.info("Using urls version "+i.version),this.urlContainer=i,this.urlContainer.update(t)}if(e)return this._refresh(!1);throw new Error("missing-urls")}async getSignedUrl(e){if(await this.refresh(),!this.urlContainer)throw new Error("Tried to use ModelUrls.get before urlContainer is established.");const t=this.urlContainer.get(e);if(!t)throw new Error(`Could not get signed URL for path ${e}`);return t}async getFile(e,t,i){const s=e.match(/^https?:/)?e:(0,u.bf)(await this.getSignedUrl(e),i);return this.api.get(s,t)}async getImage(e,t,i){const s=e.match(/^https?:/)?e:(0,u.bf)(await this.getSignedUrl(e),i);return this.api.getImage(s,t)}async getImageBitmap(e,t,i,s,n){const o=(0,u.bf)(await this.getSignedUrl(e),n);return this.api.getImageBitmap(o,t,i,s)}}var v,y=i(68519),b=i(55580),w=i(12153),S=i(52227),T=i(32400),E=i(51770);!function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(v||(v={}));var _=i(32020);class x{constructor(){this.lastPublished=null,this.editable=!1}refresh(e){for(const t in this.textures)e.textures[t]&&this.textures[t].refreshFrom(e.textures[t]);this.meshUrls.forEach(((t,i)=>{const s=e.meshUrls[i]&&e.meshUrls[i].url;t.url&&s&&t.url.refreshFrom(s)}))}}const M=new h.Z("mds-snapshot-serializer");class P{deserialize(e){if(!e||!this.validate(e))return M.debug("Deserialized invalid model data from MDS",e),null;const t=e.publication||{},i=t.contact||{},s=e.options,n=e.address||{},o=new x;o.sid=e.id,o.organizationId=e.organization||null,o.editable=void 0!==e.visibility,o.image=e.image?e.image.id:"",o.details={sid:e.id,name:e.name||"",presentedBy:t.presentedBy||"",summary:t.summary||"",formattedAddress:n.address||"",contact:{email:i.email||"",name:i.name||"",phone:i.phoneNumber||"",formattedPhone:i.phoneNumber||""},externalUrl:t.externalUrl||""},o.options={socialSharing:!!s.socialSharingEnabled,isPublic:!!t.published,isVR:!!s.vrEnabled},t.lastPublished&&(o.lastPublished=(0,_.p)(t.lastPublished,null));const r=e.assets.textures.filter((e=>"high"===e.quality))[0],a=e.assets.textures.filter((e=>"low"===e.quality))[0];o.textures={high:new y.n(r,(0,_.p)(r.validUntil,null)),low:new y.n(a,(0,_.p)(a.validUntil,null))};const l=this.getDamFileUrls(e);if(!l)throw new Error(`No .dam file found for model ${e.id}`);return o.meshUrls=l,o}validate(e){return["id","assets","publication"].every((t=>t in e))}getDamFileUrls(e){return((0,E.qw)(e,"assets.meshes")||[]).reduce(((e,t)=>{if(t.status===v.AVAILABLE){const i={url:new y.n(t.url,(0,_.p)(t.validUntil,null)),suffix:t.resolution?`_${t.resolution}`:"",extension:t.format||""};"50k"===t.resolution?e.unshift(i):e.push(i)}return e}),[])}}class A extends T.u{constructor(){super(...arguments),this.serializer=new P}async read(){const e=this.getViewId();return this.query(S.GetModelDetails,{modelId:e}).then((e=>{const t=(0,E.qw)(e,"data.model");return this.serializer.deserialize(t)}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read().finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}}var O=i(83852),D=i(64519),I=i(35135),C=i(80034);class R{deserialize(e){const t=new x;return t.sid=e.sid,t.uuid=e.job.uuid,t.image=e.icon||"",t.organizationId=e.owner.group_sid,e.metainfo&&Array.isArray(e.metainfo.allowed_methods)&&(t.editable=e.metainfo.allowed_methods.includes("POST")),t.details={sid:e.sid,name:e.name,presentedBy:e.presented_by,summary:e.summary,formattedAddress:this.formatAddress(e.address),contact:{email:e.contact_email,name:e.contact_name,phone:e.contact_phone,formattedPhone:e.formatted_contact_phone},externalUrl:e.external_url},t.options={socialSharing:!!e.enable_social_sharing,isPublic:!!e.is_public,isVR:!!e.is_vr},t}formatAddress(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return""}if(!e||!(e.address_1||e.address_2||e.city||e.state||e.zip))return"";const t=[];return e.address_1&&t.push(e.address_1),e.address_2&&t.push(e.address_2),e.city&&(t.length>0&&t.push(", "),t.push(e.city)),e.state&&(t.length>0&&t.push(", "),t.push(e.state)),e.zip&&(t.length>0&&t.push(", "),t.push(e.zip)),t.join("")}}class L extends D.n{constructor(e){super(e),this.deserializer=new R}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;return i=I.t.model?I.t.model:await this.request(C.w$.GET,t),this.deserializer.deserialize(i)}async refresh(){throw new O.n("Model refresh not implemented")}}const N=new h.Z("model-data");class k extends s.Y{constructor(){super(...arguments),this.name="model-data"}async init(e,t){this.engine=t;const{modelId:i,baseUrl:s}=e;this.store=this.getStore(e);const[n,l]=await Promise.all([this.store.read(),t.getModule(a.default)]);if(!n)throw Error("Could not fetch model data");(0,y.s)(n,(async()=>{const e=await this.store.refresh();n.refresh(e)})),this.model=n;const c=new b.T(this.model);t.market.register(this,b.T,c),this.registerSettings(c),t.market.waitForData(o.Q).then((e=>{n.lastPublished&&(e.lastPublished=n.lastPublished.getTime())}));const h=l.getApi(),d=e.storageProvider===r.Xq.JSONSTORE?`${s}/api/player/models/${i}/files`:null;this.signedUrls=new f(h,d),this.signedUrls.meshUrls=this.model.meshUrls,t.broadcast(new w.Z(this.signedUrls,this.model.sid,this.model.vrSupported))}async registerSettings(e){const t=await this.engine.getModule(n.default),i=e.model.options||{};t.registerSetting("ModelData","enable_social_sharing",i.socialSharing),t.registerSetting("ModelData","is_public",i.isPublic),t.registerSetting("ModelData","is_vr",i.isVR)}getSignedUrls(){return this.signedUrls}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:s}=e,n=e.storageProvider||r.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;return N.info(`Loading model details from ${n}`),n===r.Xq.MDS?new A({readonly:o,baseUrl:i}):new L({readonly:!0,modelId:t,baseUrl:i,queue:s})}}},56730:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(99681);class n extends s.m{constructor(e,t,i){super(),this.id="MESH_PREVIEW_POSITION",this.payload={enabled:e,previewCirclePosition:t,size:i}}}},63073:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var s=i(54122),n=i(85197),o=i(56730);class r extends s.Y{constructor(){super(...arguments),this.name="model-mesh-preview",this.defaultSize=.3}async init(e,t){this.engine=t,this.bindings.push(t.commandBinder.addBinding(o.n,this.update.bind(this))),this.modelMeshModule=await t.getModule(n.default)}async update(e){this.modelMeshModule||(this.modelMeshModule=await this.engine.getModule(n.default));const t=e.enabled&&e.previewCirclePosition?e.previewCirclePosition:null,i=e.size?e.size:this.defaultSize;for(const e of this.modelMeshModule.mesh.chunks)e.setMeshPreviewSphere(t,i)}}},72760:(e,t,i)=>{"use strict";i.d(t,{z:()=>p,S:()=>u});var s=i(2212),n=i(97982);class o extends s.FIo{constructor(e,t,i){const s={};for(const e of t)s[e]=!0;super({extensions:{derivatives:!0},fragmentShader:n.Z.modelChunk.fragmentShader,vertexShader:n.Z.modelChunk.vertexShader,uniforms:i,name:e,defines:s}),this.capabilities=t}}var r=i(73902),a=i(63213),l=i(62367);let c,h=1;try{c=(0,a.k7)(0,0)}catch(e){}const d=[{key:r.h.PanoTextureTransition,enabled:function(e){return e.progress.value>0&&e.progress.value<1&&e.pano0Map.value!==e.pano1Map.value},dependsOn:[r.h.PanoTexture]},{key:r.h.PanoTexture,enabled:function(e){return e.panoOpacity.value>0},dependsOn:[]},{key:r.h.ColorOverlay,enabled:function(e){return null!==e.colorOverlay.value},dependsOn:[]},{key:r.h.MeshPreviewSphere,enabled:function(e){return null!==e.meshPreviewCenter.value},dependsOn:[r.h.MeshTexture]},{key:r.h.MeshTexture,enabled:function(e){return e.meshOpacity.value>0&&e.map.value},dependsOn:[]},{key:r.h.Wireframe,enabled:function(e){return!1},dependsOn:[]},{key:r.h.FlatShading,enabled:function(e){return!1},dependsOn:[]},{key:r.h.PanoOverlay,enabled:function(e){return!!e.overlay0Map.value},dependsOn:[r.h.PanoTexture]},{key:r.h.PanoOverlayTransition,enabled:function(e){return!!(e.progress.value>0&&e.progress.value<1&&e.overlay0Map.value&&e.overlay1Map.value&&e.overlay0Map.value!==e.overlay1Map.value)},dependsOn:[r.h.PanoOverlay,r.h.PanoTexture,r.h.PanoTextureTransition]}];var u;!function(e){e[e.Standard=0]="Standard",e[e.Depth=1]="Depth",e[e.Transparent=2]="Transparent",e[e.Wireframe=3]="Wireframe"}(u||(u={}));class p{constructor(e,t,i,o=""){this.meshGroup=e,this.meshSubgroup=t,this.geometry=i,this.textureName=o,this.id=h++,this.renderingMode=u.Standard,this.chunkMaterials={},this.modeMaterials={},this.capabilityOverrides={},this.uniformCache=this.getUniformDefaults(),this.setProjectedPano=(()=>{const e=new s.yGw,t=new s.yGw,i=new s._fP;return(s,n,o,r)=>{let a=1===s?"pano1Map":"pano0Map";this.setMaterialsUniform(a,r||c),n&&(a=1===s?"pano1Position":"pano0Position",this.setMaterialsUniform(a,n)),o&&n&&(a=1===s?"pano1Matrix":"pano0Matrix",e.makeRotationFromQuaternion(i.copy(o).invert()),t.makeScale(-1,1,1),this.setMaterialsUniform(`${a}1`,e),this.setMaterialsUniform(`${a}2`,t))}})(),this.modeMaterials[u.Standard]=this.getChunkMaterial(this.getCapabilities()),this._material=this.modeMaterials[u.Standard];const r=s.rDY.clone(n.Z.depth.uniforms);this.modeMaterials[u.Depth]=new s.FIo({fragmentShader:n.Z.depth.fragmentShader,vertexShader:n.Z.depth.vertexShader,uniforms:r,side:s.Wl3,name:"materialDepth"});const a=s.rDY.clone(n.Z.modelOutside.uniforms);a.opacity.value=.2,this.modeMaterials[u.Transparent]=new s.FIo({fragmentShader:n.Z.modelOutside.fragmentShader,vertexShader:n.Z.modelOutside.vertexShader,uniforms:a,side:s.Wl3,transparent:!0,name:"materialTransparent"});const l=s.rDY.clone(n.Z.modelOutside.uniforms);l.opacity.value=.5,l.colorOverlay.value.set(1,1,1,1),this.modeMaterials[u.Wireframe]=new s.FIo({fragmentShader:n.Z.modelOutside.fragmentShader,vertexShader:n.Z.modelOutside.vertexShader,uniforms:l,side:s.Wl3,transparent:!0,wireframe:!0,name:"materialWireframe"})}getUniformDefaults(){const e={};for(const t in n.Z.modelChunk.uniforms){const i=s.rDY.clone(n.Z.modelChunk.uniforms[t]);for(const t in i)e[t]=i[t]}return e}set material(e){this._material!==e&&this.onMaterialUpdate&&this.onMaterialUpdate(e),this._material=e}get material(){return this._material}setMeshTexture(e){this.setMaterialsUniform("map",e)}setColorOverlay(e){this.setMaterialsUniform("colorOverlay",e)}setMeshTextureOpacity(e){this.setMaterialsUniform("meshOpacity",e),this.setMaterialsUniform("panoOpacity",1-e)}setProgress(e){this.setMaterialsUniform("progress",e)}setOpacity(e){this.setMaterialsUniform("opacity",e)}setTime(e){this.renderingMode===u.Wireframe&&this.setMaterialsUniform("time",e)}setTransparentDiscard(e){this.setMaterialsUniform("transparentDiscardDist",e)}setMeshPreviewSphere(e,t=.3){this.setMaterialsUniform("meshPreviewCenter",e),this.setMaterialsUniform("meshPreviewSize",t)}setWireframe(e){e&&(this.geometry.getIndex()&&this.geometry.copy(this.geometry.toNonIndexed()),(0,a.ko)(this.geometry)),this.overrideCapability(r.h.Wireframe,e)}setFlatShading(e){e&&this.geometry.computeVertexNormals(),this.overrideCapability(r.h.FlatShading,e)}getCapabilities(){const e=new Set;for(const t in this.capabilityOverrides)this.capabilityOverrides[t]&&e.add(t);for(const t of d)if(!e.has(t.key)&&t.enabled(this.uniformCache)){e.add(t.key);for(const i of t.dependsOn)e.add(i)}return e}overrideCapability(e,t){this.capabilityOverrides[e]=t,this.updateMaterialCapabilities()}updateMaterialCapabilities(){const e=this.getCapabilities(),t=this.modeMaterials[u.Standard];if((0,l.TH)(t.capabilities,e))return;const i=this.getChunkMaterial(e);i.side=t.side,i.transparent=t.transparent,i.depthWrite=t.depthWrite,this.modeMaterials[u.Standard]=i,this.renderingMode===u.Standard&&(this.material=i)}getChunkMaterial(e){let t="chunkMaterial_";for(const i of d)t+=e.has(i.key)?"1":"0";return this.chunkMaterials[t]||(this.chunkMaterials[t]=new o(t,e,this.getUniformsForCapabilities(e))),this.chunkMaterials[t]}getUniformsForCapabilities(e){const t={};for(const i of e){const e=n.Z.modelChunk.uniforms[i];for(const i in e)t[i]=this.uniformCache[i]}return t}setMaterialsUniform(e,t){if(!(e in this.uniformCache))throw new Error(`Uniform ${e} does not exist in Chunk`);const i=this.uniformCache[e];i.value!==t&&(t&&(t.isVector3||t.isVector4||t.isMatrix3||t.isMatrix4||t.isColor)?null===i.value?i.value=t.clone():i.value.copy(t):i.value=t,this.updateMaterialCapabilities())}setRenderingMode(e){this.renderingMode=e,this.material=this.modeMaterials[e]}setSide(e){for(const t in this.chunkMaterials)this.chunkMaterials[t].side=e}forEachMaterial(e){for(const t in this.chunkMaterials)e(this.chunkMaterials[t])}setOverlayPano(e,t,i){const n=`overlay${e}`;if(t){const e=(new s.yGw).makeRotationFromQuaternion(t);this.setMaterialsUniform(n+"Matrix",e)}this.setMaterialsUniform(n+"Map",i||c)}}},9163:(e,t,i)=>{"use strict";i.d(t,{T:()=>d});var s=i(2212),n=i(20599),o=i(72760);const r=new s.Pa4(0,0,0),a=new s.Pa4(100,100,100),l=new s.Pa4,c=new s.Pa4,h=new s.ZzF;class d extends s.Kj0{constructor(){super(),this.bounds=new s.ZzF,this.geometry=new s.nvb(1,1,1),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.chunk=new o.z(-1,-1,this.geometry),this.chunk.onMaterialUpdate=e=>{this.material=e,this.material.side=s._Li,this.material.transparent=!0,this.material.depthWrite=!1},this.chunk.onMaterialUpdate(this.chunk.material),this.name="FallbackMesh",this.renderOrder=n.z.boundingSkybox,this.setFromCenterAndSize(r,a)}setBounds(e){if(this.bounds.equals(e))return;this.bounds.copy(e);const t=e.getSize(l);this.position.copy(e.getCenter(c)),this.scale.set(t.x,t.y,t.z),this.updateMatrixWorld(!0)}setFromCenterAndSize(e,t=a){this.setBounds(h.setFromCenterAndSize(e,t))}}},61718:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var s=i(2212);class n extends s.Kj0{constructor(){super(...arguments),this.raycastEnabled=!0}}},82138:(e,t,i)=>{"use strict";i.d(t,{g:()=>h});var s=i(2212),n=i(2779),o=i(46266),r=i(61718),a=i(20599);class l{constructor(e){this.maxEdgeLength=e}modify(e){let t;const i=[],n=[],o=this.maxEdgeLength*this.maxEdgeLength;for(let t=0,i=e.faceVertexUvs.length;t<i;t++)n[t]=[];for(let r=0,a=e.faces.length;r<a;r++){const a=e.faces[r];if(a instanceof s.G_f){const s=a.a,l=a.b,c=a.c,h=e.vertices[s],d=e.vertices[l],u=e.vertices[c],p=h.distanceToSquared(d),m=d.distanceToSquared(u),g=h.distanceToSquared(u);if(p>o||m>o||g>o){let o;const f=e.vertices.length,v=a.clone(),y=a.clone();if(p>=m&&p>=g){if(o=h.clone(),o.lerp(d,.5),v.a=s,v.b=f,v.c=c,y.a=f,y.b=l,y.c=c,3===a.vertexNormals.length){const e=a.vertexNormals[0].clone();e.lerp(a.vertexNormals[1],.5),v.vertexNormals[1].copy(e),y.vertexNormals[0].copy(e)}if(3===a.vertexColors.length){const e=a.vertexColors[0].clone();e.lerp(a.vertexColors[1],.5),v.vertexColors[1].copy(e),y.vertexColors[0].copy(e)}t=0}else if(m>=p&&m>=g){if(o=d.clone(),o.lerp(u,.5),v.a=s,v.b=l,v.c=f,y.a=f,y.b=c,y.c=s,3===a.vertexNormals.length){const e=a.vertexNormals[1].clone();e.lerp(a.vertexNormals[2],.5),v.vertexNormals[2].copy(e),y.vertexNormals[0].copy(e),y.vertexNormals[1].copy(a.vertexNormals[2]),y.vertexNormals[2].copy(a.vertexNormals[0])}if(3===a.vertexColors.length){const e=a.vertexColors[1].clone();e.lerp(a.vertexColors[2],.5),v.vertexColors[2].copy(e),y.vertexColors[0].copy(e),y.vertexColors[1].copy(a.vertexColors[2]),y.vertexColors[2].copy(a.vertexColors[0])}t=1}else{if(o=h.clone(),o.lerp(u,.5),v.a=s,v.b=l,v.c=f,y.a=f,y.b=l,y.c=c,3===a.vertexNormals.length){const e=a.vertexNormals[0].clone();e.lerp(a.vertexNormals[2],.5),v.vertexNormals[2].copy(e),y.vertexNormals[0].copy(e)}if(3===a.vertexColors.length){const e=a.vertexColors[0].clone();e.lerp(a.vertexColors[2],.5),v.vertexColors[2].copy(e),y.vertexColors[0].copy(e)}t=2}i.push(v,y),e.vertices.push(o);for(let i=0,s=e.faceVertexUvs.length;i<s;i++)if(e.faceVertexUvs[i].length){const s=e.faceVertexUvs[i][r],o=s[0],a=s[1],l=s[2];let c,h;if(0===t){const e=o.clone();e.lerp(a,.5),c=[o.clone(),e.clone(),l.clone()],h=[e.clone(),a.clone(),l.clone()]}else if(1===t){const e=a.clone();e.lerp(l,.5),c=[o.clone(),a.clone(),e.clone()],h=[e.clone(),l.clone(),o.clone()]}else{const e=o.clone();e.lerp(l,.5),c=[o.clone(),a.clone(),e.clone()],h=[e.clone(),a.clone(),l.clone()]}n[i].push(c,h)}}else{i.push(a);for(let t=0,i=e.faceVertexUvs.length;t<i;t++)n[t].push(e.faceVertexUvs[t][r])}}}e.faces=i,e.faceVertexUvs=n}}var c=i(15782);class h extends r.S{constructor(e,t,i=n.o.ALL){super(),this._opacity=1,this._chunks=[],this.built=!1,this._fadeDist=0,this.layers.mask=i.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.floorId=String(e),this.roomId=String(t),this.renderOrder=a.z.default}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");const e=(0,o.q)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this._chunks.forEach(((i,s)=>{i.geometry&&i.geometry.index&&(e.addGroup(t,i.geometry.index.count,s),t+=i.geometry.index.count,i.geometry.dispose(),i.geometry=e,i.onMaterialUpdate=e=>{this.material[s]=e})})),this.geometry=e,this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(new s.Pa4),this.center=this.boundingBox.getCenter(new s.Pa4),this.geometry.computeBoundingSphere(),this.built=!0}tessellate(e){const t=new l(e),i=(new s.ZXM).fromBufferGeometry(this.geometry);let n=0;for(;i.faces.length!==n;)n=i.faces.length,t.modify(i);this.geometry=(new s.u9r).fromGeometry(i)}get boundingBox(){return(0,o.A)(this.geometry)}set opacity(e){if(e!==this.opacity){this._opacity=e,this.raycastEnabled=e>c.xx.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<c.xx.FADE_OPAQUE?a.z.ghostFloor:a.z.default;for(const t of this.chunks)t.material.transparent=e<c.xx.FADE_OPAQUE,t.material.depthWrite=e>c.xx.FADE_IN_VALUE+c.xx.FADE_IN_HOVER_BOOST_VALUE,t.setOpacity(e)}}get opacity(){return this._opacity}get transparentFadeDist(){return this._fadeDist}set transparentFadeDist(e){if(e!==this.transparentFadeDist){this._fadeDist=e;for(const t of this.chunks)t.setTransparentDiscard(e)}}get chunks(){return this._chunks}}},79976:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="SET_CHUNK_RENDER_MODE",this.payload={mode:e}}}},93227:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="SET_MESH_OPACITY",this.payload={value:e}}}},14819:(e,t,i)=>{"use strict";i.d(t,{I:()=>n,M:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="TOGGLE_MESH_OVERLAY_COLOR",this.payload={enabled:e}}}class o extends s.m{constructor(e,t,i){super(),this.id="SET_PANO_OVERLAY",this.payload={sweepId:e,texture:t,quaternion:i}}}},27871:(e,t,i)=>{"use strict";i.d(t,{_:()=>r});var s=i(19413),n=i(2212),o=i(290);class r extends s.V{constructor(e,t){super(),this.name="mesh-data",this.bounds=new n.ZzF,this.center=new n.Pa4,this.size=new n.Pa4,this.opacity=new o.z(e),this.bounds.copy(t),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}copy(e){this.opacity.copy(e.opacity),this.bounds.copy(e.bounds),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}}},24975:(e,t,i)=>{"use strict";i.d(t,{T0:()=>o,Pv:()=>r,Nr:()=>a});var s=i(61718);const n=e=>e instanceof s.S,o=e=>n(e),r=e=>n(e)&&e.raycastEnabled&&e.visible,a=e=>{let t=e.visible;return t&&e.traverseAncestors((e=>{t&&(t=e.visible)})),!o(e)&&t||r(e)}},85197:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TextureLOD:()=>se,default:()=>xe});var s=i(54122),n=i(15782),o=i(3614),r=i(2212),a=i(25799),l=i(72760),c=i(63213);const h=new a.Z("dam-loader");class d{constructor(){this.decoder=i(16801).uO}async load(e,t,i){h.time("download");const s=await t.getFile(e,{responseType:"arraybuffer",onProgress:i});return h.timeEnd("download"),this.parse(s)}parse(e){h.time("parse proto");const t=this.decoder.read(new o(e));h.timeEnd("parse proto"),h.time("convert to webgl");const i=this.convertProtobufToSceneObject(t);return h.timeEnd("convert to webgl"),i}convertProtobufToSceneObject(e){if(0===e.chunk.length)return h.warn("No chunks in damfile..."),[];const t=new r.yGw;return t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),e.chunk.map((function(e){const i=new r.u9r;i.setAttribute("position",new r.TlE(new Float32Array(e.vertices.xyz,0,3),3)),e.vertices.uv.length>0&&i.setAttribute("uv",new r.TlE(new Float32Array(e.vertices.uv,0,2),2)),i.setIndex(new r.TlE(new Uint32Array(e.faces.faces,0,1),1)),i.applyMatrix4(t),i.computeBoundingBox();const{group:s,subgroup:n}=(0,c.xc)(e.chunk_name);return new l.z(s,n,i,e.material_name)}))}}var u=i(86515),p=i(2779),m=i(17617);class g extends m.y{constructor(e){super(e),this.name="MeshCreationException"}}var f=i(82138);class v extends r.Tme{constructor(e,t=p.o.ALL){super(),this.renderLayer=t,this.roomMeshes=new u.Z((e=>e.meshSubgroup)),this._chunks=[],this.built=!1,this.name=`FloorMesh:${e}`,this.meshGroup=e,this.floorId=void 0}dispose(){for(const e of this.roomMeshes)e.geometry.dispose(),this.remove(e);this.roomMeshes.clear()}addChunk(e){const t=this.getOrCreateRoomMesh(e.meshSubgroup);this._chunks.push(e),t.addChunk(e)}getOrCreateRoomMesh(e){let t=this.roomMeshes.get(e);return t||(t=new f.g(this.meshGroup,e,this.renderLayer),this.roomMeshes.add(t),this.add(t)),t}build(){if(this.built)throw new Error("build() should only be called once");this.boundingBox=new r.ZzF;for(const e of this.roomMeshes)this.boundingBox.union(e.boundingBox);this.center=this.boundingBox.getCenter(new r.Pa4),this.size=this.boundingBox.getSize(new r.Pa4),this.built=!0}get chunks(){return this._chunks}}const y=new a.Z("mesh");class b extends r.Tme{constructor(e,t,i=p.o.ALL,s){super(),this.renderLayer=i,this.maxEdgeLength=s,this.floorMeshes=new u.Z((e=>e.meshGroup)),this.built=!1,this._chunks=[],this.uuid=e,this.name=`ModelMesh:${e}`,this.signedUrls=t,this.layers.mask=i.mask}dispose(){for(const e of this.floorMeshes)e.dispose(),this.remove(e);this.floorMeshes.clear()}async load(e={}){let t=e.chunks?e.chunks:await class{static async load(e,t,i,s=0){const o=new d;n.ZP.highQualityDam&&0===s&&(s=1);const r=(t.meshUrls?t.meshUrls:[{suffix:"_50k",extension:"dam"},{suffix:"",extension:"dam"}])[s];if(!r)return Promise.reject("No suitable model file found...");const{url:a,suffix:l,extension:c}=r,h=a?await a.get():`${e}${l}.${c}`;return o.load(h,t,i).catch((()=>this.load(e,t,i,++s)))}}.load(this.uuid,this.signedUrls,e.onProgress).catch((e=>{y.error(e);const t=e instanceof Error?e.message:"Failed to load model mesh";throw new g(t)}));if(0===t.length){y.warn("No geometry found for model, loading faux geometry, disabling outside view-mode");const e=new r.BKK(5,5,1,1);e.rotateX(-Math.PI/2),e.computeBoundingBox();const i=new l.z(0,0,e);i.forEachMaterial((e=>e.visible=!1)),t=[i]}t.forEach(((e,t)=>{this.addChunk(e)}));let i=0,s=0;for(const e of this.floorMeshes){for(const t of e.roomMeshes)t.build(),i++,this.maxEdgeLength&&t.tessellate(this.maxEdgeLength);e.build(),s++}return this.build(),y.debug(`FloorMeshes: ${s} RoomMeshes: ${i} Chunks: ${t.length}`),this}addChunk(e){const t=this.getOrCreateFloorMesh(e.meshGroup);this._chunks.push(e),t.addChunk(e)}getOrCreateFloorMesh(e){let t=this.floorMeshes.get(e);return t||(t=new v(e,this.renderLayer),this.floorMeshes.add(t),this.add(t)),t}build(){if(this.built)throw new Error("build() should only be called once");this.boundingBox=new r.ZzF;for(const e of this.floorMeshes)this.boundingBox.union(e.boundingBox);this.size=this.boundingBox.getSize(new r.Pa4),this.center=this.boundingBox.getCenter(new r.Pa4),this.built=!0}get roomMeshes(){const e=new Set;for(const t of this.floorMeshes)for(const i of t.roomMeshes)e.add(i);return e}get chunks(){return this._chunks}}class w{constructor(e,t,i){this.addToRaycasting=e,this.removeFromRaycasting=t,this.mesh=i,this.clear()}dispose(){this.clear()}activate(e){const t={};for(const e of Object.keys(this.groupNames))for(const i of this.groupColliders[e])t[i.id]=!0,this.addToRaycasting(i,!0);for(const e of this.allColliders)t[e.id]||this.addToRaycasting(e,!0)}deactivate(e){for(const e of this.allColliders)this.removeFromRaycasting(e)}init(){for(const e of this.mesh.floorMeshes){let t=this.groupColliders[e.meshGroup];t||(this.groupColliders[e.meshGroup]=t=[]);for(const i of e.roomMeshes)t.push(i),this.allColliders.push(i)}}setSide(e){for(const t of this.allColliders)this.setSideRecursively(t,e)}setSideRecursively(e,t){e instanceof r.Kj0&&e.material&&e.material instanceof r.vBJ&&(e.material.side=t);for(const i of e.children)this.setSideRecursively(i,t)}getReadonlyColliderList(){return this.allColliders}getReadonlyColliderListForGroup(e){return this.groupColliders[e]}getGroupName(e){return this.groupNames[e]}render(){}setVisible(e){if(this._visible!==e){this._visible=e;for(const t of this.allColliders)t.visible=e}}clear(){this.allColliders=[],this.groupColliders={},this.groupNames={}}}var S=i(71208),T=i(12775),E=i(29675),_=i(39936),x=i(30853),M=i(79976),P=i(97982),A=i(73902),O=i(62367),D=i(69281),I=i(14819),C=i(50101),R=i(9163),L=i(1799),N=i(89155);const k=new a.Z("modelrenderer");class F{constructor(e,t,i,s,n,o,a,l){this.scene=e,this.mesh=t,this.modelCollider=i,this.panoRenderer=s,this.meshData=n,this.sweepData=o,this.applicationData=a,this.renderOptions=l,this.chunkRenderingModeOverride=null,this.lastChunkRenderingModeOverride=null,this.fallbackMesh=new R.T,this.overlayTextures=[{sweepId:void 0,texture:void 0,renderTarget:new r.oAp(2048,{format:r.wk1}),quaternion:new r._fP},{sweepId:void 0,texture:void 0,renderTarget:new r.oAp(2048,{format:r.wk1}),quaternion:new r._fP}],this.overlayEnabled=!1,this.bindings=[],this.updateFallbackMesh=(()=>{const e=new r.ZzF;return()=>{if(this.sweepData.currentAlignedSweepObject&&this.viewmodeData.currentMode===S.Ey.Panorama){const t=e.copy(this.meshData.bounds).expandByScalar(.2);this.fallbackMesh.setBounds(t)}else this.cameraData&&this.fallbackMesh.setFromCenterAndSize(this.cameraData.pose.position)}})()}init(){}dispose(){this.mesh.dispose()}async activate(e){[this.viewmodeData,this.settings,this.cameraData,this.settingsModule,this.renderer]=await Promise.all([e.market.waitForData(T.O),e.market.waitForData(_.e),e.market.waitForData(N.M_),e.getModule(x.default),e.getModule(C.default)]),this.scene.add(this.mesh),this.scene.add(this.fallbackMesh),this.fallbackMesh.layers.mask=this.mesh.layers.mask,this.updateRenderState(),this.bindings.push(this.viewmodeData.onChanged(this.updateRenderState.bind(this)),this.sweepData.onChanged(this.updateRenderState.bind(this)),this.settings.onChanged(this.updateRenderState.bind(this)),e.commandBinder.addBinding(M.U,(async e=>{this.chunkRenderingModeOverride=e.mode,this.updateRenderState()})),e.commandBinder.addBinding(I.M,(async e=>{this.overlayEnabled=!0;const t=t=>{const i=t.renderTarget;t.renderTarget.width=e.texture.image.width,t.renderTarget.height=e.texture.image.height,t.sweepId=e.sweepId,t.texture=i.texture,t.quaternion=e.quaternion,this.renderer.cwfRenderer.copyCubemap(e.texture,t.renderTarget)};let i=!1;for(const s of this.overlayTextures)i||s.sweepId!==e.sweepId||(t(s),i=!0);for(const e of this.overlayTextures)i||e.sweepId===this.targetSweepId||e.sweepId===this.currentSweepId||(t(e),i=!0);this.updateRenderState()}))),this.settingsModule.registerButton("Mesh","Toggle visible",(()=>{for(const e of this.mesh.floorMeshes)e.visible=!e.visible})),this.settingsModule.registerButton("Mesh","Toggle depth",(()=>{const t=this.chunkRenderingModeOverride?null:l.S.Depth;e.commandBinder.issueCommand(new M.U(t))})),this.settingsModule.registerButton("Mesh","Toggle transparent",(()=>{const t=this.chunkRenderingModeOverride?null:l.S.Transparent;e.commandBinder.issueCommand(new M.U(t))})),this.settingsModule.registerButton("Mesh","Toggle wireframe",(()=>{const t=this.chunkRenderingModeOverride?null:l.S.Wireframe;e.commandBinder.issueCommand(new M.U(t))}));let t=!1;const i=(e,i)=>{const s=new r.Ltg(1,1,1,0);t=!t,(e=>{for(const t of this.mesh.floorMeshes)for(const n of t.roomMeshes){let t=e?(0,D.G1)(.5):s;for(const o of n.chunks)i&&(t=e?(0,D.G1)(.5):s),o.setColorOverlay(t)}})(e||t)};this.renderOptions.colorizeRooms&&i(!0),this.renderOptions.colorizeChunks&&i(!0,!0),this.settingsModule.registerButton("Mesh","Highlight Rooms",i),this.settingsModule.registerButton("Mesh","Highlight Chunks",(()=>i(!t,!0)));let s=!1;this.settingsModule.registerButton("Mesh","Toggle flat shading",(()=>{s=!s;for(const e of this.mesh.chunks)e.setFlatShading(s)})),this.settingsModule.registerButton("Mesh","Cycle all chunk materials",(()=>{o()}));const o=async()=>{const t=[];for(const e in A.h)isNaN(Number(e))&&t.push(A.h[e]);const i=[];for(const e in l.S)isNaN(Number(e))&&i.push(l.S[e]);k.info(`Available ChunkMaterialCapabilities: ${t}`);const s=[];for(let e=0;e<1<<t.length-1;e++){const i={};for(let s=t.length-1;s>=0;s--)i[t[s]]=Boolean(e&1<<s);s.push(i)}k.info(`There are ${s.length*i.length} options to test`);for(let t=0;t<i.length;t++){await e.commandBinder.issueCommand(new M.U(t));for(const e of s){k.info(`Testing ChunkRenderingMode.${l.S[t]} with capabilities: ${JSON.stringify(e,void 0,2)}`);const i=new r.Ltg(Math.random(),Math.random(),Math.random(),.5);for(const t of Object.keys(e))for(const s of this.mesh.chunks)s.setColorOverlay(i),s.setMeshPreviewSphere(new r.Pa4(0,0,0)),s.overrideCapability(t,e[t]);await(0,O.gw)(100)}await(0,O.gw)(100)}await e.commandBinder.issueCommand(new M.U(null))},a=(e,t,i,s,n)=>{this.settingsModule.registerSetting(e,t,i,!0,x.SettingPersistence.NONE,n),this.settings.onPropertyChanged(t,s)},c=e=>{for(const t of this.mesh.chunks)t.setWireframe(e)};this.renderOptions.wireframe&&c(!0),a("Wireframe",n.Lp,!1,c);const h={[A.h.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in h){const t=P.Z.modelChunk.uniforms[e];for(const i in h[e])for(const s of h[e][i])a(i,s,t[s].value,(e=>{for(const t of this.mesh.chunks)t.setMaterialsUniform(s,e)}),t[s].range)}}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.remove(this.mesh),this.scene.remove(this.fallbackMesh),this.currentSweepId&&this.panoRenderer.freeTexture(this.currentSweepId),this.currentSweepId=null,this.targetSweepId=null}updateSweepRenderTarget(e,t,i,s){const n=this.panoRenderer.useTexture(t);if(n)for(const t of this.allChunks())t.setProjectedPano(e,i,s,n)}*allChunks(){yield*this.mesh.chunks,yield this.fallbackMesh.chunk}updateExistingTexture(e,t,i,s){for(const n of this.allChunks())e===this.currentSweepId&&n.setProjectedPano(0,i,s,t),e===this.targetSweepId&&n.setProjectedPano(1,i,s,t)}render(){}beforeRender(){const e=!this.displayingUnaligned(this.sweepData,this.viewmodeData);this.mesh.visible=e,this.modelCollider.setVisible(e);for(const e of this.mesh.chunks)e.setMeshTextureOpacity(this.meshData.opacity.value),e.setProgress(this.sweepData.transition.progress.value);const t=(0,L.w2)(this.meshData.opacity.value,0,1,1);this.fallbackMesh.chunk.setMeshTextureOpacity(t),this.fallbackMesh.chunk.setProgress(this.sweepData.transition.progress.value),this.updateFallbackMesh()}displayingUnaligned(e,t){return t.closestMode===S.Ey.Panorama&&!!e.currentSweep&&e.isSweepUnaligned(e.currentSweep)}updateChunkMaterialMode(e,t){const i=t||l.S.Standard,s=e?r.ehD:r.Wl3;for(const e of this.mesh.chunks)e.setRenderingMode(i),e.setSide(s)}updateChunkedColliderSide(e){const t=e===S.Ey.Panorama?r.ehD:r.Wl3;this.modelCollider.setSide(t)}updateRenderState(){if(this.mesh.visible=this.settings.tryGetProperty(n.AN,!0),this.viewmodeData.currentMode!==this.lastViewmode||this.lastChunkRenderingModeOverride!==this.chunkRenderingModeOverride){this.lastChunkRenderingModeOverride=this.chunkRenderingModeOverride;const e=this.viewmodeData.currentMode===S.Ey.Panorama;this.updateChunkMaterialMode(e,this.chunkRenderingModeOverride),this.viewmodeData.currentMode&&this.updateChunkedColliderSide(this.viewmodeData.currentMode),this.lastViewmode=this.viewmodeData.currentMode}if(this.viewmodeData.transition.active&&this.viewmodeData.transition.to===S.Ey.Panorama||this.viewmodeData.currentMode===S.Ey.Panorama){const e=this.sweepData.currentSweep,t=this.sweepData.transition,i=t.active&&(this.applicationData.phase===E.nh.PLAYING||this.applicationData.phase===E.nh.STARTING),s=i?t.from:e,n=i?t.to:e,o=this.currentSweepId,r=this.targetSweepId;this.currentSweepId=s||null,this.targetSweepId=n||null,this.handleSweepChange(0,o,this.currentSweepId),this.handleSweepChange(1,r,this.targetSweepId)}if(this.overlayEnabled){const e=this.overlayTextures.find((e=>e.sweepId===this.currentSweepId)),t=this.overlayTextures.find((e=>e.sweepId===this.targetSweepId));for(const i of this.allChunks())i.setOverlayPano(0,e?e.quaternion:void 0,e?e.texture:void 0),i.setOverlayPano(1,t?t.quaternion:void 0,t?t.texture:void 0)}}handleSweepChange(e,t,i){if(t!==i&&(t&&this.panoRenderer.freeTexture(t),i)){const t=this.sweepData.getSweep(i);this.updateSweepRenderTarget(e,i,t.position,t.rotation)}}}class B{constructor(e){this.getChunks=e,this.enabled=null,this.toggleEnabled=e=>{if(e!==this.enabled){for(const t of this.getChunks())t.setColorOverlay(e?n.Y7:null);this.enabled=e}}}}var U,H=i(20331),G=i(40440),V=i(2124);class z{constructor(e){this.textureName=e,this.chunks=[],this.minQuality=G.r5,this.maxQuality=G.r5,this.targetQuality=G.r5,this.loading=!1,this.screenCoverage=0,this.screenCoverageScore=0,this.sightings=new V.P(100)}setTexture(e){this.texture&&this.texture!==e&&this.texture.dispose(),this.texture=e;for(const e of this.chunks)e.setMeshTexture(this.texture)}async getUrl(e){const t=G.tT[e].assetType;if(this.textureData){const e=this.textureName.match(/[_.]([0-9]{3})[_.]/);if(!e)throw new Error(`Could not parse texture index from texture name: ${this.textureName}`);return(await this.textureData[t].get()).urlTemplate.replace("<texture>",e[1])}{const e=this.textureName.match(/^([a-f0-9]+(_10k|_50k)?)/);if(!e)throw new Error(`Unknown format for texture name: ${this.textureName}`);return`${e[0]}_texture_jpg_${t}/${this.textureName}`}}addSighting(e,t,i){this.sightings.push({point:e,distance:t,time:i})}}!function(e){e[e.LOAD_MORE=0]="LOAD_MORE",e[e.STAY=1]="STAY",e[e.UNLOAD=2]="UNLOAD"}(U||(U={}));class j{constructor(e){this.slots=e,this.strategy=U.STAY,this.baseSizeUnit=G.tT[G.r5].textureSize,this.minBudget=this.slots.length,this.maxBudget=this.slots.length*this.getBudgetSize(G.KG),this._budget=this.minBudget}update(e){this.budget=this.maxBudget}getBudgetSize(e){return e?(G.tT[e].textureSize/this.baseSizeUnit)**2:0}calcCurrentUsedBudget(){return this.slots.reduce(((e,t)=>e+this.getBudgetSize(t.quality)),0)}clampBudget(e){return Math.min(this.maxBudget,Math.max(this.minBudget,e))}get budget(){return this._budget}set budget(e){e=this.clampBudget(e),this.budget!==e&&(this._budget=e,this.updateTargetQualitiesFromBudget())}updateTargetQualitiesFromBudget(){let e=0;for(const t of this.slots)t.targetQuality=G.r5,e+=this.getBudgetSize(t.targetQuality);for(const t of G.ib)for(const i of this.slots)if(!(i.maxQuality<t)){if(e-=this.getBudgetSize(i.targetQuality),e+=this.getBudgetSize(t),e>this.budget)return;i.targetQuality=t}}}class W{constructor(e,t){this.slots=e,this.renderToTextureModule=t,this.renderTarget=new r.dd2(1,1),this.sizeMultiplier=1/4,this.pixelBuffer=new Uint8Array(4)}render(e,t,i=!1){this.beforeRender();let{width:s,height:n}=this.renderToTextureModule.getRenderSize();s=Math.max(1,Math.floor(s*this.sizeMultiplier)),n=Math.max(1,Math.floor(n*this.sizeMultiplier)),s===this.renderTarget.width&&n===this.renderTarget.height||this.renderTarget.setSize(s,n),this.renderToTextureModule.render(this.renderTarget,e,t),i&&this.renderToScreen(),this.afterRender()}renderToScreen(){this.renderToTextureModule.renderToScreen(this.renderTarget)}readPixels(){const e=this.renderTarget.width*this.renderTarget.height*4;this.pixelBuffer.length!==e&&(this.pixelBuffer=new Uint8Array(e));const t=this.pixelBuffer;return this.renderToTextureModule.getRenderTargetData(this.renderTarget,t),this.pixelBuffer}beforeRender(){for(const e of this.slots)for(const t of e.chunks)this.beforeRenderChunk(t,e)}afterRender(){for(const e of this.slots)for(const t of e.chunks)this.afterRenderChunk(t,e)}}class Z extends W{beforeRenderChunk(e,t){e.setColorOverlay(G.tT[t.quality].debugColor)}afterRenderChunk(e,t){e.setColorOverlay(null)}}class q extends W{beforeRender(){this.maxValue=this.slots.reduce(((e,t)=>Math.max(e,t.screenCoverageScore)),1e-9),super.beforeRender()}beforeRenderChunk(e,t){const i=t.screenCoverageScore/this.maxValue,s=new r.Ltg(i,i,i,1);e.setColorOverlay(s)}afterRenderChunk(e,t){e.setColorOverlay(null)}}var K=i(91055);const Y=[];let $=0;var Q=i(97620),X=i(26199),J=i(24975);const ee=new a.Z("/index.js");class te{constructor(e,t,i,s,n,o,r,a,l,c,h){this.textureLOD=e,this.urls=t,this.model=i,this.modelMesh=s,this.camera=n,this.cameraData=o,this.renderer=r,this.renderToTextureModule=a,this.raycaster=l,this.scene=c,this.engine=h,this.slots=[],this.chunkIdToSlot={},this.minQuality=G.r5,this.maxQuality=G.KG,this.concurrentLoadingTextures=3,this.concurrentDownloadingTiles=12,this.autoLoadTiles=!1,this.lastSortedAt=0,this.loadingTextures=0,this.downloadingTiles=0,this.textureQualityRenderPass=new Z(this.slots,this.renderToTextureModule),this.textureScoreRenderPass=new q(this.slots,this.renderToTextureModule),this._raycastCounter=0;const d={};for(const e of s.chunks){let t=d[e.textureName];t||(t=new z(e.textureName),this.model.textures&&(t.textureData=this.model.textures),d[e.textureName]=t,this.slots.push(d[e.textureName])),t.chunks.push(e),this.chunkIdToSlot[e.id]=t}this.textureBudgeter=new j(this.slots)}setQuality(e,t){if(e>t)throw new Error("min quality must be smaller or equal to max");this.minQuality=e,this.maxQuality=t;for(const e of this.slots)e.minQuality=this.minQuality,e.maxQuality=Math.min(e.maxQuality,this.maxQuality)}get textureCount(){return this.slots.length}loadAll(e){if(!this.slots[0]||!this.slots[0].textureName)return Promise.resolve([]);const t=this.slots.map((t=>this.loadTexture(t,e,!1)));return Promise.all(t)}async loadTexture(e,t,i=!0){const s=G.tT[t].textureSize;if(e.lastLoadedAt=performance.now(),t===e.quality)return ee.warn(`Texture was already at level ${G.S7[t]}, not reloading`),e.texture;if(t<e.quality){const i=this.renderToTextureModule.resizeTexture(e.texture,s);return e.quality=t,e.setTexture(i),e.texture}const n=new r.xEZ;n.format=r.UCm,this.textureLOD!==se.NONE&&i&&(n.generateMipmaps=!1,n.minFilter=r.wem,n.magFilter=r.wem),this.renderer.initSizedTexture2D(s,n),e.loading=!0,this.loadingTextures++;try{n.sourceFile=await e.getUrl(t),this.textureLOD!==se.NONE&&i?await this.updateTextureTiled(n,t):await this.updateTextureSolid(n,t),e.setTexture(n)}catch(e){ee.warn(`Failed loading texture ${n.sourceFile}`)}finally{this.loadingTextures--,e.quality=t,e.loading=!1}return n}async updateTextureTiled(e,t){const{textureSize:i,tileSize:s,assetSize:n}=G.tT[t],o=n/(i/s),r=async(t,r)=>{const a={};let l;o!==s&&(a.width=`${s}`),o!==n&&(a.crop=`${o},${o},x${t/i},y${r/i}`),this.downloadingTiles+=1;try{l=await this.urls.getImageBitmap(e.sourceFile,s,s,{priority:H.ru.LOW,flipY:!0},a)}finally{this.downloadingTiles-=1}const c=t,h=i-r-l.height;return(await this.engine.commandBinder.issueCommand(new X._("mesh/texture/upload-tiles",(()=>this.renderer.uploadTexture2D(l,e,c,h)),100))).promise},a=[];for(let e=0;e<i;e+=s)for(let t=0;t<i;t+=s)a.push(r(e,t));return Promise.all(a)}async updateTextureSolid(e,t){const{textureSize:i}=G.tT[t],s=await this.urls.getImageBitmap(e.sourceFile,i,i,{priority:H.ru.LOW,flipY:!0},{width:`${i}`});this.renderer.uploadTexture2D(s,e,0,0)}raycastRandomScreenLocation(e,t,i){this._raycastCounter++;const s=(2-2*t)/e,n=-1+t,o=this._raycastCounter%(e*e),a=o%e,l=n+(o-a)/e*s,c=n+a*s+Math.random()*s,h=l+Math.random()*s,d=new r.Pa4(c,h,-1).unproject(this.camera),u=new r.Pa4(c,h,1).unproject(this.camera).clone().sub(d).normalize(),p=this.raycaster.pick(d,u,J.Pv);if(p&&p.object&&p.object instanceof f.g&&p.face){i&&i(p);const e=p.object.getChunk(p.face.materialIndex);this.chunkIdToSlot[e.id].addSighting(p.point.clone(),p.distance,this._raycastCounter)}}analyzeTextureScreenCoverageFromRaycasts(){const e=window.innerWidth,t=(new r.Pa4).copy(this.cameraData.pose.position);for(const i of this.slots){i.screenCoverage=0,i.screenCoverageScore=0,i.maxQuality=this.minQuality;for(const s of i.sightings){if(this._raycastCounter-s.time>1e3)continue;const n=t.distanceTo(s.point);let o=ie((0,K._U)(n,this.camera.projectionMatrix,e));o=Math.min(o,this.maxQuality),i.screenCoverageScore+=o,i.screenCoverage+=1,i.maxQuality=Math.max(o,i.maxQuality)}}this.slots.sort(((e,t)=>t.screenCoverageScore-e.screenCoverageScore)),this.textureBudgeter.updateTargetQualitiesFromBudget()}update(e){if(this.textureBudgeter.update(e),!this.camera||!this.autoLoadTiles)return;const t=performance.now();this.textureLOD===se.RAYCAST&&this.minQuality!==this.maxQuality&&(this.raycastTaskPromise||(this.raycastTaskPromise=this.engine.commandBinder.issueCommand(new X._("mesh/texture/raycast",(()=>{this.raycastRandomScreenLocation(5,.05,n.ZP.debugLOD?((e,t)=>{if(0===Y.length)for(let e=0;e<100;e++){const e=new r.Kj0(new r.Aip(.005),new r.vBJ);Y.push(e)}return e=>{const i=Y[$++%Y.length];i.position.copy(e.point),i.scale.set(e.distance,e.distance,e.distance),i.material.color.setHex(65280),i.parent||t.scene.add(i)}})(0,this.scene):void 0)}),50)).then((async e=>{await e.promise,this.raycastTaskPromise=null}))),!this.analyzeTaskPromise&&t-this.lastSortedAt>200&&(this.analyzeTaskPromise=this.engine.commandBinder.issueCommand(new X._("mesh/texture/analyze-screen-coverage",(()=>{this.analyzeTextureScreenCoverageFromRaycasts(),this.lastSortedAt=performance.now()}),100)).then((async e=>{await e.promise,this.analyzeTaskPromise=null}))));for(let e=this.slots.length-1;e>=0;e--){const i=this.slots[e],s=(0,Q.uZ)(i.targetQuality,i.minQuality,i.maxQuality),n=t-i.lastLoadedAt<1e3;if(!i.loading&&i.quality>s&&!n){this.loadTexture(i,s);break}}for(const e of this.slots){if(this.loadingTextures>=this.concurrentLoadingTextures||this.downloadingTiles>=this.concurrentDownloadingTiles)break;const t=(0,Q.uZ)(e.targetQuality,e.minQuality,e.maxQuality);!e.loading&&e.quality<t&&this.loadTexture(e,e.quality+1)}n.ZP.debugLOD&&(this.textureScoreRenderPass.render(this.modelMesh,this.camera,!0),this.textureQualityRenderPass.render(this.modelMesh,this.camera,!0))}}function ie(e){let t=G.KG;for(;e>G.tT[t].texelSize&&t>G.r5;)t--;return t}var se,ne=i(22423),oe=i(55580),re=i(62513),ae=i(30963),le=i(7922),ce=i(20640),he=i(60463),de=i(48840),ue=i(39869),pe=i(73354),me=i(77956),ge=i(27871),fe=i(93227),ve=i(46101),ye=i(57369),be=i(53339),we=i(27829),Se=i(47678),Te=i(56022),Ee=i(51418),_e=i(27468);!function(e){e[e.NONE=0]="NONE",e[e.RAYCAST=1]="RAYCAST"}(se||(se={}));class xe extends s.Y{constructor(){super(...arguments),this.name="model-mesh",this.renderingMesh=!0,this.colorOverlay=null,this.toggleMeshOverlayColor=e=>{this.colorOverlay||(this.colorOverlay=new B((()=>this.modelMesh.chunks))),this.colorOverlay.toggleEnabled(e)}}async init(e,t){this.market=t.market;const[i,s,n,o,a,l,c,h,d,u]=await Promise.all([t.getModule(C.default),t.getModule(re.default),t.getModule(ne.default),t.market.waitForData(oe.T),t.getModule(ae.default),t.getModule(pe.default),t.market.waitForData(N.M_),t.market.waitForData(T.O),t.market.waitForData(me.Z),t.getModuleByParent(he.Z)]);this.viewmodeData=h;const p=i.getScene(),m=n.getSignedUrls(),g=o.model.uuid;this.renderingMesh=!!e.renderMeshGeometry,this.panoRenderer=u.getRenderer(),this.modelMesh=new b(g,m,t.claimRenderLayer(this.name),e.maxEdgeLength);const f=await this.modelMesh.load({onProgress:e=>{t.broadcast(new ce.Zb(e.loaded,e.total))}}),v=f.boundingBox.clone(),y=new r.ZzF;let _;if(d.iterate((e=>{e.placementType!==ye.hU.UNPLACED&&(y.setFromCenterAndSize(e.position,we.f.UNIT),v.union(y))})),this.meshData=new ge._(0,v),this.market.register(this,ge._,this.meshData),e.renderMeshGeometry){this.modelTextureLoader=new te(e.textureLOD,m,o.model,this.modelMesh,p.camera,c,i.cwfRenderer,l,s.picking,p,t);let n,r=!1,a=h.currentMode;const u=()=>{const t=n===_e.s.VrOrientOnly||n===_e.s.VrWithController||n===_e.s.VrWithTrackedController,i=this.modelTextureLoader.textureCount<=e.textureLODThreshold?Math.max(G.S7.ULTRA,e.maxQuality):G.S7.MEDIUM,s=Math.max(i,a===S.Ey.Panorama&&0===this.meshData.opacity.value?i:e.maxQuality);this.modelTextureLoader.setQuality(i,s);const o=a!==S.Ey.Dollhouse&&a!==S.Ey.Floorplan,l=h.transition.active&&h.transition.to===S.Ey.Panorama;this.modelTextureLoader.autoLoadTiles=!(t||l||r&&o)&&e.textureLOD!==se.NONE};let g=this.meshData.opacity;this.bindings.push(this.meshData.onChanged((e=>{e.opacity!==g&&u(),g=e.opacity})),t.subscribe(de.Z,(e=>{this.startOpacityTransition(),a=e.toMode,r=!0,u()})),t.subscribe(ue.Z,(e=>{r=!1,a=e.toMode,u()})),t.subscribe(be.oR,(()=>{r=!0,u()})),t.subscribe(be.NR,(()=>{r=!1,u()})),t.subscribe(Se.Z,(()=>{r=!0,u()})),t.subscribe(ve.Z,(e=>{d.getSweep(e.toSweep).alignmentType===ye.z9.UNALIGNED&&this.setMeshOpacity(0)})),t.subscribe(Te.Z,(()=>{r=!1,u()})),t.subscribe(Ee.m,(e=>{n=e.mode,u()})),t.subscribe(le.Z,(e=>{this.renderer.updateExistingTexture(e.sweepId,e.renderTarget.texture)})));const f=e.textureLOD!==se.NONE?G.S7.LOW:e.maxQuality;_=this.modelTextureLoader.loadAll(f).then((()=>{u()}))}if(this.modelCollider=new w(a.registerMesh,a.unregisterMesh,f),s.setupOctree(f),t.addComponent(this,this.modelCollider),e.renderMeshGeometry){const i=await t.market.waitForData(E.pu);this.renderer=new F(p.scene,f,this.modelCollider,this.panoRenderer,this.meshData,d,i,e),t.addComponent(this,this.renderer),await _}t.broadcast(new ce.Bc(this.modelMesh)),this.bindings.push(t.commandBinder.addBinding(fe.g,(async e=>this.setMeshOpacity(e.value))),t.commandBinder.addBinding(I.I,(async e=>this.toggleMeshOverlayColor(e.enabled))))}onUpdate(e){this.modelTextureLoader&&this.modelTextureLoader.update(e),this.meshData.opacity.active&&(this.meshData.opacity.updateProgress(this.viewmodeData.transition.progress),this.meshData.commit());const t=performance.now()/1e3;for(const e of this.modelMesh.chunks)e.setTime(t)}get mesh(){return this.modelMesh}get collider(){return this.modelCollider}startOpacityTransition(){const e=this.viewmodeData.transition.to,t=this.meshData.opacity.value,i=e===S.Ey.Panorama?0:1,s=e===S.Ey.Panorama?L.Q9:L.w2;this.meshData.opacity.value!==i&&this.meshData.opacity.modifyAnimation(t,i,1,s)}setMeshOpacity(e){this.meshData.opacity.modifyAnimation(e,e,0),this.meshData.commit()}isRenderingMesh(){return this.renderingMesh}}},73902:(e,t,i)=>{"use strict";var s;i.d(t,{h:()=>s}),function(e){e.PanoTexture="PANO_TEXTURE",e.PanoTextureTransition="PANO_TEXTURE_TRANSITION",e.MeshTexture="MESH_TEXTURE",e.ColorOverlay="COLOR_OVERLAY",e.MeshPreviewSphere="MESH_PREVIEW_SPHERE",e.Wireframe="WIREFRAME",e.FlatShading="FLAT_SHADING",e.PanoOverlay="PANO_OVERLAY",e.PanoOverlayTransition="PANO_OVERLAY_TRANSITION"}(s||(s={}))},67399:(e,t,i)=>{"use strict";i.d(t,{$4:()=>r});var s=i(82138);const n=e=>!!e&&e instanceof s.g,o=e=>"object"==typeof e&&!!e&&"floorId"in e&&!!e.floorId,r={hasFloorId:o,hasRoomId:e=>o(e)&&"roomId"in e&&!!e.roomId,isRoomMesh:n,matchesFloorId:e=>t=>o(t)&&t.floorId===e,isVisibleRoomMesh:e=>n(e)&&e.raycastEnabled&&e.visible}},20640:(e,t,i)=>{"use strict";i.d(t,{Bc:()=>n,Zb:()=>o});var s=i(93528);class n extends s.v{constructor(e){super(),this.modelMesh=e}}class o extends s.v{constructor(e,t){super(),this.loaded=e,this.total=t}}},15782:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>o,AN:()=>r,Lp:()=>a,Y7:()=>l,xx:()=>c});var s=i(2212),n=i(21265);const o=Object.freeze({debugLOD:n.hu("debuglod",!1),highQualityDam:n.hu("highqdam",!1)}),r="features/mesh-rendering",a="wireframeEnabled",l=new s.Ltg(0,0,0,.3),c={FADE_OPAQUE:1,FADE_ABOVE:.06,FADE_BELOW:.1,FADE_CLICKABLE_THRESHOLD:.079,FADE_IN_VALUE:.08,FADE_IN_END_ANGLE:23,FADE_IN_START_ANGLE:22,FADE_IN_HOVER_BOOST_VALUE:.2,DISCARD_FOCAL_MULTI:.125}},97982:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var s=i(48101),n=i(2212),o=i(13441),r=i(81047),a=i(73902);const l={cube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:(0,s.m)(r,i(49423)),fragmentShader:(0,s.m)(o,i(36357))},blurCube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},dir:{type:"v2",value:new n.FM8(0,0)}},vertexShader:(0,s.m)(r,i(56163)),fragmentShader:(0,s.m)(o,i(15145))},modelChunk:{uniforms:{[a.h.MeshTexture]:{map:{type:"t",value:null},meshOpacity:{type:"f",value:0},opacity:{type:"f",value:1},transparentDiscardDist:{type:"f",value:0}},[a.h.PanoTexture]:{pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new n.Pa4},pano0Matrix1:{type:"m4",value:new n.yGw},pano0Matrix2:{type:"m4",value:new n.yGw},panoOpacity:{type:"f",value:1}},[a.h.PanoTextureTransition]:{progress:{type:"f",value:0},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new n.Pa4},pano1Matrix1:{type:"m4",value:new n.yGw},pano1Matrix2:{type:"m4",value:new n.yGw}},[a.h.PanoOverlay]:{overlay0Map:{type:"t",value:null},overlay0Matrix:{type:"m4",value:new n.yGw}},[a.h.PanoOverlayTransition]:{overlay1Map:{type:"t",value:null},overlay1Matrix:{type:"m4",value:new n.yGw}},[a.h.ColorOverlay]:{colorOverlay:{type:"v4",value:null}},[a.h.MeshPreviewSphere]:{meshPreviewCenter:{type:"v3",value:null},meshPreviewSize:{type:"f",value:.3}},[a.h.Wireframe]:{time:{type:"f",value:0},fill:{type:"c",value:new n.Ilk(16711680)},stroke:{type:"c",value:new n.Ilk(16777215)},dualStroke:{type:"b",value:!1},fillEnabled:{type:"b",value:!1},insideAltColor:{type:"b",value:!1},thickness:{type:"f",value:.1},secondThickness:{type:"f",value:.1},dashEnabled:{type:"b",value:!1},dashRepeats:{type:"f",value:10},dashOverlap:{type:"b",value:!1},dashLength:{type:"f",value:.1,range:[0,1]},dashAnimate:{type:"b",value:!1},squeeze:{type:"b",value:!1},squeezeMin:{type:"f",value:.1},squeezeMax:{type:"f",value:1},wireframeOpacity:{type:"f",value:1,range:[0,1]}}},vertexShader:(0,s.m)(r,i(73291)),fragmentShader:(0,s.m)(o,i(43775))},modelOutside:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},colorOverlay:{type:"v4",value:new n.Ltg(0,0,0,0)}},vertexShader:(0,s.m)(r,i(25256)),fragmentShader:(0,s.m)(o,i(65635))},depth:{uniforms:{opacity:{type:"f",value:1},maxDistance:{type:"f",value:20}},vertexShader:(0,s.m)(r,i(25928)),fragmentShader:(0,s.m)(o,i(43411))}}},40440:(e,t,i)=>{"use strict";i.d(t,{S7:()=>s,tT:()=>o,ib:()=>r,r5:()=>a,KG:()=>l,Pm:()=>c});var s,n=i(2212);!function(e){e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.ULTRA=4]="ULTRA"}(s||(s={}));const o={[s.LOW]:{debugColor:new n.Ltg(1,0,0,.5),textureSize:256,tileSize:256,assetType:"low",assetSize:512,texelSize:.096},[s.MEDIUM]:{debugColor:new n.Ltg(1,1,0,.5),textureSize:512,tileSize:512,assetType:"low",assetSize:512,texelSize:.048},[s.HIGH]:{debugColor:new n.Ltg(0,1,0,.5),textureSize:1024,tileSize:512,assetType:"high",assetSize:2048,texelSize:.024},[s.ULTRA]:{debugColor:new n.Ltg(0,1,1,.5),textureSize:2048,tileSize:512,assetType:"high",assetSize:2048,texelSize:.012}},r=[s.LOW,s.MEDIUM,s.HIGH,s.ULTRA],a=r[0],l=r[r.length-1],c=e=>{for(const t in o)if(o[t].textureSize===e)return parseInt(t,10);throw new Error(`Not a valid texture size: ${e}`)}},63213:(e,t,i)=>{"use strict";i.d(t,{xc:()=>n,ko:()=>o,k7:()=>r});var s=i(2212);function n(e){const t=e.match(/group([0-9]+)/),i=e.match(/sub([0-9]+)/);return{group:t?parseInt(t[1],10):0,subgroup:i?parseInt(i[1],10):0}}function o(e,t=!1){if(e.getAttribute("barycentric"))return;const i=(e.getIndex()||e.getAttribute("position")).count/3,n=[];for(let e=0;e<i;e++){const i=t?1:0;e%2==0?n.push(0,0,1,0,1,0,1,0,i):n.push(0,1,0,0,0,1,1,0,i)}const o=new Float32Array(n),r=new s.TlE(o,3);e.setAttribute("barycentric",r)}function r(e=16777215*Math.random(),t=1){const i=function(e,t,i,s=1){const n=document.createElement("canvas");n.width=t,n.height=i;const o=n.getContext("2d");return o.fillStyle=`rgba(${255*e.r|0},${255*e.g|0},${255*e.b|0}, ${255*s|0})`,o.fillRect(0,0,t,i),n}(new s.Ilk(e),1,1,t),n=new s.BtG([i,i,i,i,i,i]);return n.format=s.wk1,n.needsUpdate=!0,n}},76258:(e,t,i)=>{"use strict";i.d(t,{u:()=>n});var s=i(99681);class n extends s.m{constructor(e=null){super(),this.id="SET_MOUSE_CURSOR",this.payload={cursor:e}}}},7065:(e,t,i)=>{"use strict";var s;i.d(t,{C:()=>s}),function(e){e.NONE="none",e.DEFAULT="default",e.MOVE="move",e.MOVE_LF="col-resize",e.MOVE_UD="row-resize",e.XHAIR="crosshair",e.PLUS="cell",e.QUESTION="help",e.NOPE="not-allowed",e.FINGER="pointer",e.TEXT="text",e.TEXT_VERT="vertical-text",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-in",e.GRAB="grab",e.GRABBING="grabbing",e.ARROW_R="e-resize",e.ARROW_L="w-resize",e.ARROW_U="n-resize",e.ARROW_D="s-resize",e.ARROW_UR="ne-resize",e.ARROW_UL="nw-resize",e.ARROW_DR="se-resize",e.ARROW_DL="sw-resize",e.ARROW_LR="ew-resize",e.ARROW_UD="ns-resize",e.ARROW_URDL="nesw-resize",e.ARROW_ULDR="nwse-resize"}(s||(s={}))},35739:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Cursor:()=>n.C,SetMouseCursorCommand:()=>o.u,default:()=>r});var s=i(54122),n=i(7065),o=i(76258);class r extends s.Y{constructor(){super(...arguments),this.name="mouse-cursor",this.activeCursor=null}async init(e,t){this.config=Object.assign({classPrefix:"cursor"},e),this.bindings.push(t.commandBinder.addBinding(o.u,(async e=>this.changeCursor(e.cursor))))}changeCursor(e){const{container:t,classPrefix:i}=this.config;e!==this.activeCursor&&(this.activeCursor&&t.classList.remove(`${i}-${this.activeCursor}`),e&&t.classList.add(`${i}-${e}`),this.activeCursor=e)}}},55525:(e,t,i)=>{"use strict";i.d(t,{ZK:()=>n,Lp:()=>o,Np:()=>r,zs:()=>a,OR:()=>l,ju:()=>c});var s=i(99681);class n extends s.m{constructor(){super(),this.id="LOCK_NAVIGATION"}}class o extends s.m{constructor(){super(),this.id="UNLOCK_NAVIGATION"}}class r extends s.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_BOX"}}class a extends s.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_POINT_INSIDE"}}class l extends s.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_PIN_INSIDE"}}class c extends s.m{constructor(e){super(),this.id="MOVE_TO_SWEEP",this.payload=Object.assign({},e)}}},84496:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ue});var s=i(54122),n=i(39936),o=i(89155),r=i(47924),a=i(73029),l=i(30963),c=i(75711),h=i(55525),d=i(17617);class u extends d.y{constructor(e){super(e),this.name="NavigationException"}}const p="Cannot navigate between panos when not in Panorama mode",m="Not at a valid sweep",g="Cannot move while in a transition",f="Cannot move in that direction";var v=i(75158),y=i(73706),b=i(75712),w=i(12505),S=i(86682),T=i(24975),E=i(66272),_=i(85995),x=i(76258),M=i(7065);class P{constructor(e,t,i,s,n,o,r,a){this.canStartTransition=e,this.commandBinder=t,this.input=i,this.floorsViewData=s,this.navigation=n,this.navigationDollhouse=o,this.sweepData=r,this.cameraModule=a,this.bindings=[],this.lastSelection={floorId:"",time:Date.now(),cancelTransition:!1},this.toggleInput=e=>{this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.onRoomClick=(e,t,i)=>{if(!this.canStartTransition())return;if(!i||!i.point)return;const s=this.floorsViewData.floors.getFloorByMeshGroup(t.meshGroup);if(!s)return;if(this.lastSelection.cancelTransition)return;const n=Date.now(),o=n-this.lastSelection.time<300;this.lastSelection.time=n;const r=1!==this.floorsViewData.totalFloors&&s.id!==this.lastSelection.floorId,a=()=>{this.lastSelection.floorId=s.id,this.lastSelection.cancelTransition=!1};if(!r)return o?(this.lastSelection.cancelTransition=!0,void this.cameraModule.cancelTransition().then((()=>this.navigation.navigateToPanoNearIntersection(i))).then((()=>{this.lastSelection.cancelTransition=!1,this.lastSelection.time=Date.now(),a()}))):void(this.floorsViewData.floorSelectModeActive?a():this.navigationDollhouse.navigateToPoint(i.point).then((()=>{this.lastSelection.cancelTransition||this.setFocusSweep(i),a()})));this.commandBinder.issueCommand(new S.Vw(s.id,!1,void 0,i.point)).then((()=>this.navigation.navigateToPanoNearIntersection(i))).then((()=>{a()}))},this.onBackgroundClick=()=>{this.canStartTransition()&&(this.lastSelection.cancelTransition||(this.lastSelection.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.commandBinder.issueCommand(new S.Vw(null,!1)))).then((()=>{this.lastSelection.cancelTransition=!1}))))},this.onBackgroundHover=()=>{null!==this.floorsViewData.currentFloorId&&this.commandBinder.issueCommand(new x.u(M.C.FINGER))},this.onBackgroundUnhover=()=>{this.commandBinder.issueCommand(new x.u(M.C.DEFAULT))},this.onFloorChange=()=>{null===this.floorsViewData.currentFloorId&&this.commandBinder.issueCommand(new x.u(M.C.DEFAULT))},this.bindings.push(this.input.registerMeshHandler(v.R,b.s.is(T.Pv),this.onRoomClick),this.input.registerMeshHandler(v.R,b.s.isType(w.i),this.onBackgroundClick),this.input.registerMeshHandler(y.z,b.s.isType(w.i),this.onBackgroundHover),this.input.registerMeshHandler(y.A,b.s.isType(w.i),this.onBackgroundUnhover),this.floorsViewData.makeFloorChangeSubscription(this.onFloorChange))}async setFocusSweep(e){if(!this.canStartTransition())return;if(this.lastSelection.cancelTransition)return;const t=(0,E.b)(this.sweepData,!1,e);t.length>0&&t[0].sweep&&await this.commandBinder.issueCommand(new _.aK(t[0].sweep.id))}}var A=i(2212),O=i(27829),D=i(35825),I=i(30604),C=i(78626),R=i(22767),L=i(61718),N=i(40582),k=i(25799);const F=new k.Z("nav-input");class B{constructor(e,t,i){this.navigation=e,this.inputIni=t,this.insideNav=[],this.insideVrNav=[],this.toggleInput=e=>{this.insideNav.forEach((t=>e?t.renew():t.cancel()))},this.toggleVrInput=e=>{this.insideVrNav.forEach((t=>e?t.renew():t.cancel()))},this.registerInsideClickHandlers=e=>[e.registerMeshHandler(v.R,b.s.is(T.Pv),((e,t,i)=>this.tryExecuteAction(((e,t)=>G(e)&&U(t)),((e,t)=>U(t)&&this.navigation.navigateTowardsIntersection(t)),e,i))),e.registerMeshHandler(v.R,b.s.isType(w.i),((e,t,i)=>this.tryExecuteAction(((e,t)=>G(e)&&U(t)),((e,t)=>U(t)&&this.navigation.navigateTowardsIntersection(t)),e,i)))],this.registerVrClickHandlers=e=>[e.registerMeshHandler(v.R,b.s.isInstanceOf(L.S),((e,t,i)=>this.tryExecuteAction(((e,t)=>G(e)&&U(t)),((e,t)=>U(t)&&this.navigation.navigateToPanoNearIntersection(t)),e,i)))],this.registerWheelInput=e=>[e.registerHandler(I.a,(e=>this.tryExecuteAction((e=>!0),(e=>{if(e instanceof I.a){const t=new A.Pa4(0,0,Math.sign(e.delta.y));return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.hotkeys=e=>[e.registerHandler(C.e,(e=>this.tryExecuteAction((e=>H(e)&&e.key in B.hotkeyDirections),(e=>{if(H(e)){const t=B.hotkeyDirections[e.key];return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.tryExecuteAction=(e,t,i,s)=>{let n=!1;try{this.navigation.isNavigationInputAllowed()&&e(i,s)&&(n=t(i,s))}catch(e){if(!(e instanceof u))throw F.warn(e),e;F.debug(e)}return n},this.insideVrNav.push(...this.registerVrClickHandlers(this.inputIni)),this.insideNav.push(...this.registerInsideClickHandlers(this.inputIni),...this.hotkeys(this.inputIni)),i&&this.insideNav.push(...this.registerWheelInput(this.inputIni))}get bindings(){return[...this.insideNav,...this.insideVrNav]}}function U(e){return void 0!==e&&void 0!==e.point}function H(e){return e instanceof C.e&&e.state===R.M.PRESSED}function G(e){return e instanceof v.R&&e.button===N.MP.PRIMARY}B.hotkeyDirections={[D.R.W]:O.f.FORWARD,[D.R.A]:O.f.LEFT,[D.R.S]:O.f.BACK,[D.R.D]:O.f.RIGHT,[D.R.UPARROW]:O.f.FORWARD,[D.R.DOWNARROW]:O.f.BACK};const V=new k.Z("nav-input");class z{constructor(e,t,i){this.navigation=e,this.input=t,this.bindings=[],this.toggleInput=e=>{V.debug("toggling dollhouse input",e),this.bindings.forEach((t=>e?t.renew():t.cancel()))},i||this.bindings.push(...this.registerEnterPanoHandler())}registerEnterPanoHandler(){return[this.input.registerMeshHandler(v.R,b.s.isInstanceOf(L.S),((e,t,i)=>!!this.navigation.isNavigationInputAllowed()&&e.button===N.MP.PRIMARY&&void 0!==i&&this.navigation.navigateToPanoNearIntersection(i)))]}}var j=i(38610),W=i(77956),Z=i(72942),q=i(12775),K=i(71208),Y=i(19334),$=i(89895),Q=i(22729),X=i(62513),J=i(94210),ee=i(71144),te=i(97620),ie=i(91055),se=i(44266);class ne{constructor(e,t,i){this.canStartTransition=e,this.pose=t,this.cameraModule=i,this.navigateToPoint=async e=>{if(!this.canStartTransition())return;const t=this.pose.focalDistance,i=(0,ie.fd)(this.pose.rotation,e,t);await this.cameraModule.cancelTransition(),await this.cameraModule.moveTo({pose:{position:i},transitionType:r.n.Interpolate,focalDistance:t,transitionTime:j.E.TRANSITION_TIME_DH})},this.navigateToBox=e=>{if(!this.canStartTransition())return se.Q.resolve();const{position:t,rotation:i,focalDistance:s}=this.getPoseForBox(e);return this.cameraModule.moveTo({pose:{position:t,rotation:i},transitionType:r.n.Interpolate,focalDistance:s,transitionTime:j.E.TRANSITION_TIME_DH})},this.getPoseForBox=e=>{const t=e.getCenter(new A.Pa4),i=e.getSize(new A.Pa4),s=i.z>i.x;let n=this.pose.rotation;n=s?n.angleTo(oe.LANDSCAPE_LEFT)>n.angleTo(oe.LANDSCAPE_RIGHT)?oe.LANDSCAPE_LEFT:oe.LANDSCAPE_RIGHT:n.angleTo(oe.PORTRAIT_RIGHT)>n.angleTo(oe.PORTRAIT_LEFT)?oe.PORTRAIT_LEFT:oe.PORTRAIT_RIGHT;const o=-85*te.Ue,r=2*Math.atan(1/this.pose.projection.elements[5]),a=(0,ie.YN)(t,n,o,e,1.2*r,this.pose.aspect()),l=t.distanceTo(a.position);return{position:a.position,rotation:a.rotation,focalDistance:l}}}}const oe={LANDSCAPE_LEFT:(new A._fP).setFromAxisAngle(O.f.UP,45*te.Ue),LANDSCAPE_RIGHT:(new A._fP).setFromAxisAngle(O.f.UP,-45*te.Ue),PORTRAIT_LEFT:(new A._fP).setFromAxisAngle(O.f.UP,25*te.Ue),PORTRAIT_RIGHT:(new A._fP).setFromAxisAngle(O.f.UP,-25*te.Ue)};var re=i(17321),ae=i(81733),le=i(75195),ce=i(1707);class he{constructor(e,t,i,s,n){this.engine=e,this.cameraData=t,this.sweepData=i,this.viewmodeModule=s,this.raycaster=n,this.tryNavigateToPoint=async(e,t,i,s)=>{const n=[],o=[];if(n.push(re._T()),n.push(re._k()),t===r.n.Interpolate&&this.viewmodeModule.currentMode===K.Ey.Panorama&&this.sweepData.currentSweep){const t=.5,i=this.sweepData.currentSweep,s=this.sweepData.getSweep(i),r=s.position.clone().sub(e).normalize();n.push(re.pI(e,r,t)),n.push(re.T3(s)),o.push(ae.o7(e,r))}n.push(this.withinLatitudeFilter(e)),n.push(this.notTooCloseFilter(e)),n.push(this.notTooFarFilter(e)),o.push(ae.Dv(e,-2));const a=this.sweepData.sortByScore(n,o),l=new A.Pa4;let c=null,d=!1,u=null;for(const n of a)if(this.sweepCanSeeNote(e,n.sweep)){if(u=n.sweep,t===r.n.Interpolate){l.copy(e).sub(u.position).normalize(),d=!0;const n=this.getSweepToPointRotation(u.position,e,s),o=this.cameraData.pose.projection.asThreeMatrix4(),{width:a,height:p}=this.cameraData,m=(0,le.bD)(e,u.position,n,a,p,o);i&&i(m),c=this.viewmodeModule.currentMode!==K.Ey.Panorama?this.viewmodeModule.switchToMode(K.Ey.Panorama,t,{rotation:n,sweepID:u.id}):this.commandBinder.issueCommand(new h.ju({transition:t||r.n.Interpolate,sweep:u.id,rotation:n}))}break}return!(!d&&t===r.n.Interpolate||(!c&&u&&(c=this.engine.commandBinder.issueCommand(new h.ju({transition:t,transitionTime:500,sweep:u.id,rotation:this.getSweepToPointRotation(u.position,e,s)}))),c&&await c,0))},this.getSweepToPointRotation=(e,t,i)=>{const s=(0,ie.n0)(e,t);return i&&s.multiply(i),(0,te.Z)(s)},this.notTooCloseFilter=e=>t=>Math.abs(t.position.x-e.x)>.1||Math.abs(t.position.z-e.z)>.1,this.notTooFarFilter=e=>e=>!0,this.withinLatitudeFilter=e=>t=>{const i=(new A.Pa4).copy(e).sub(t.position),s=-Math.atan(i.y/Math.sqrt(i.x*i.x+i.z*i.z)),n=A.M8C.degToRad(25);return ce.zf-n<s&&s<ce.uQ+n},this.commandBinder=e.commandBinder}async focusPin(e,t,i,s){const{anchorPosition:n,stemNormal:o,stemLength:r}=e,a=n.clone().add(o.setLength(r));return this.focusPoint(a,t,i,s)}async focusPoint(e,t,i,s){if(this.cameraData.canTransition()&&this.sweepData.canTransition()&&!await this.tryNavigateToPoint(e,t,i,s)){if(t!==r.n.Interpolate)return this.goToNearestSweep(e,t,i,s);try{await this.commandBinder.issueCommand(new Z._i(Z.BD.DOLLHOUSE,r.n.Interpolate))}catch(n){await this.goToNearestSweep(e,t,i,s)}await this.tryNavigateToPoint(e,t,i,s)||await this.goToNearestSweep(e,t,i,s)}}async goToNearestSweep(e,t,i,s){const n=e,o=this.sweepData.getClosestSweep(n,!0);if(!o)throw new Error("Cannot find sweep closest to Mattertag disc");const a=this.getSweepToPointRotation(o.position,n,s),l=this.cameraData.pose.projection.asThreeMatrix4(),{width:c,height:d}=this.cameraData,u=(0,le.bD)(n,o.position,a,c,d,l);i&&i(u),await this.commandBinder.issueCommand(new h.ju({sweep:o.id,rotation:a,transition:t||r.n.Interpolate}))}sweepCanSeeNote(e,t){const i=(new A.Pa4).copy(e).sub(t.position),s=i.length();i.normalize();const n=this.raycaster.picking.pick(t.position,i,T.Pv);return!n||s<=n.distance}}const de=new k.Z("navigation");class ue extends s.Y{constructor(){super(...arguments),this.name="navigation",this.navigationEnabled=!0,this.inputOutside=[],this.navigationRules=[()=>!0],this.addNavigationRule=e=>{-1===this.navigationRules.indexOf(e)&&this.navigationRules.push(e)},this.removeNavigationRule=e=>{const t=this.navigationRules.indexOf(e);-1!==t&&this.navigationRules.splice(t,1)},this.isNavigationInputAllowed=()=>{const e=this.navigationRules.reduce(((e,t)=>e&&t()),!0);return!(!this.navigationEnabled||!e)||(de.debug("Cannot move while navigation is locked",{blockedByRules:!e,blockedByCommand:!this.navigationEnabled}),!1)}}async init(e,t){let s;this.commandBinder=t.commandBinder,this.bindings.push(this.commandBinder.addBinding(h.ZK,(async()=>this.lockNavigation())),this.commandBinder.addBinding(h.Lp,(async()=>this.unlockNavigation())),this.commandBinder.addBinding(h.Np,(async e=>this.navigateToBox(e.box))),this.commandBinder.addBinding(h.zs,(async e=>{const{focusPosition:t,transition:i,orientationAdjust:s,onSweepChosen:n}=e;return this.navigationPoint.focusPoint(t,i,n,s)})),this.commandBinder.addBinding(h.OR,(async e=>{const{pinPosition:t,transition:i,orientationAdjust:s,onSweepChosen:n}=e;return this.navigationPoint.focusPin(t,i,n,s)})),this.commandBinder.addBinding(h.ju,(e=>this.navigateToSweep(e.sweep,e.rotation,e.transition,e.transitionTime,e.transitionSpeedMultiplier)))),[this.settingsData,this.sweepData,this.sweepModule,this.viewmodeData,this.viewmodeModule,this.cameraData,this.cameraModule,this.interactionmodeData,s]=await Promise.all([t.market.waitForData(n.e),t.market.waitForData(W.Z),t.getModule(J.default),t.market.waitForData(q.O),t.getModule(ee.default),t.market.waitForData(o.M_),t.getModule($.default),t.market.waitForData(c.Z),t.getModule(X.default)]),this.navigationPoint=new he(t,this.cameraData,this.sweepData,this.viewmodeModule,s);const r=await t.getModule(l.default),a=await t.market.waitForData(Q.c);this.inputOutside.push(new z(this,r,!!e.focusBasedNav));const d=()=>this.isNavigationInputAllowed()&&this.viewmodeData.canStartTransition()&&!a.transitionActive&&this.sweepData.canTransition(),u=()=>d()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan());this.navigationDollhouse=new ne(u,this.cameraData.pose,this.cameraModule),e.focusBasedNav&&this.inputOutside.push(new P(u,t.commandBinder,r,a,this,this.navigationDollhouse,this.sweepData,this.cameraModule)),this.inputInside=new B(this,r,!!e.enableWheel),this.inputOutside.forEach((e=>this.bindings.push(...e.bindings))),this.bindings.push(...this.inputInside.bindings),this.updateInputBindings(),this.bindings.push(this.viewmodeData.makeModeChangeSubscription((()=>{this.viewmodeData.currentMode!==K.Ey.Transition&&this.updateInputBindings()}))),j.E.debugMenu&&i.e(383).then(i.bind(i,39772)).then((e=>{new e.NavigationVisuals(t)}))}updateInputBindings(){const e=this.interactionmodeData.isVR(),t=this.viewmodeData.isPano();this.inputInside.toggleInput(t&&!e),this.inputInside.toggleVrInput(t&&e),this.inputOutside.forEach((e=>e.toggleInput(!t)))}navigateInLocalDirection(e){const t=this.cameraData.pose.rotation;return this.navigateInDirection(e.clone().applyQuaternion(t))}navigateTowardsIntersection(e){return!!this.navigateInDirection(e.point.clone().sub(this.cameraData.pose.position))}navigateToPanoNearIntersection(e){if(!this.cameraData.canTransition())return!1;const t=(0,E.b)(this.sweepData,this.viewmodeData.isPano(),e),i=t.length>0?t[0].sweep:this.sweepData.getClosestSweep(e.point,!0),s=a.y[this.interactionmodeData.mode];if(this.viewmodeData.isPano()&&i)return this.navigateToSweep(i.id,void 0,s),!0;if(this.viewmodeData.canSwitchViewMode(K.Ey.Panorama)){const e=i?i.id:void 0;return this.commandBinder.issueCommand(new Z._i(Z.BD.INSIDE,s,{sweepID:e})),!0}return!1}navigateInDirection(e){if(!this.viewmodeData.isPano())throw new u(p);if(!this.sweepData.currentSweep)throw new u(m);if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new u(g);const t=a.y[this.interactionmodeData.mode],i=(0,E.T)(this.sweepData,e);if(i.length>0&&i[0].sweep)return this.navigateToSweep(i[0].sweep.id,void 0,t);throw new u(f)}async navigateToBox(e){return this.navigationDollhouse.navigateToBox(e)}lockNavigation(){this.navigationEnabled=!1,de.debug("Navigation input locked")}unlockNavigation(){this.navigationEnabled=!0,de.debug("Navigation input unlocked")}async navigateToSweep(e,t,i,s,n){const o=this.settingsData.tryGetProperty(Y.gj,r.n.Interpolate);let a;void 0===i&&(i=o);const l=this.sweepData.currentSweep;if(i===r.n.Interpolate){const t=!l||this.sweepData.isSweepAligned(l),s=this.sweepData.isSweepAligned(e),n=l!==e,o=!t||!s,a=this.viewmodeData.currentMode===K.Ey.Panorama;n&&o&&a&&(i=r.n.FadeToBlack)}return a=this.viewmodeData.currentMode!==K.Ey.Panorama?this.viewmodeModule.switchToMode(K.Ey.Panorama,i,{sweepID:e,rotation:t}):this.sweepModule.moveToSweep({transitionType:i,sweepId:e,rotation:t,transitionTime:s,transitionSpeedMultiplier:n}),await a,this.sweepData.currentSweep}}},38610:(e,t,i)=>{"use strict";i.d(t,{E:()=>s});const s={longerTransitionMaxDist:10,debugMenu:!!(0,i(21265).hu)("debug","").includes("nav"),TRANSITION_TIME_DH:650}},66272:(e,t,i)=>{"use strict";i.d(t,{T:()=>a,b:()=>l});var s=i(67399),n=i(17321),o=i(81733),r=i(38610);const a=(e,t)=>{if(!e.currentSweepObject)return[];const i=e.currentSweepObject,s=[n.ff(i),n._k(),n.vO(i),n.pI(i.position,t)],r=[o.o7(i.position,t),o.TE(i.position)],a=e.getSweepNeighbours(i);return e.sortByScore(s,r,a)},l=(e,t,i)=>{const a=[n._k(),n._T()],l=[o.Dv(i.point)],c=e.currentSweepObject;t&&c&&a.push(n.ff(c),n.SF(c.position,r.E.longerTransitionMaxDist),n.vO(c)),i.face&&a.push(n.D5(i.point,i.face.normal)),s.$4.hasFloorId(i.object)&&l.push(o.Bv(i.object.floorId));const h=e.sortByScore(a,l);if(0===h.length){const t=e.getClosestSweep(i.point,!0);h.push({sweep:t,score:0})}return h}},64275:(e,t,i)=>{"use strict";i.d(t,{s:()=>o});var s=i(78909),n=i(51090);class o extends s.T{constructor(){super(...arguments),this.id="",this.assetId="",this.assetType=n.h.NOTE,this.text="",this.user="",this.created=new Date,this.modified=new Date,this.edited=!1}copy(e){return this.id=e.id,this.assetId=e.assetId,this.assetType=e.assetType,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.user=e.user,this.text=e.text,this.edited=e.edited,this.commit(),this}clone(){return(new o).copy(this)}}},50354:(e,t,i)=>{"use strict";i.d(t,{p:()=>o,F:()=>r});var s=i(32020),n=i(64275);class o{constructor(){}serialize(e){return e?{id:e.id,assetId:e.assetId,assetType:e.assetType,text:e.text,user:e.user,edited:e.edited,created:(0,s.U)(e.created),modified:(0,s.U)(e.modified)}:null}}class r{deserialize(e){if(!this.validate(e))return null;const t=new n.s;return t.id=e.id,t.assetId=e.assetId,t.assetType=e.assetType,t.text=e.text,t.user=e.user,t.edited=e.edited,t.created=(0,s.p)(e.created),t.modified=(0,s.p)(e.modified),t}validate(e){return!(!e||"object"!=typeof e)&&["id","text","user","assetId","assetType","edited","created","modified"].every((t=>t in e))}}},79283:(e,t,i)=>{"use strict";i.d(t,{l:()=>c});var s=i(19413),n=i(80994),o=i(80034),r=i(71229),a=i(51090),l=i(50354);class c extends s.V{constructor(e){super(),this.config=e,this.name="comments-data",this.comments=(0,r.q)(),this.store=this.getDataStore()}async load(){if(!this.store)throw new Error("Comment storage is not configured");const e=await this.store.read()||{};for(const t in e)this.comments.set(t,e[t]);return this.comments}async save(e){if(!this.store)throw new Error("Comment storage is not configured");const t=e?{[e.id]:e}:this.comments.deepCopy();return this.store.update(t)}getDataStore(){const{baseUrl:e,modelId:t,queue:i}=this.config,s=new n.A({serializer:new l.p,deserializer:new l.F});return new o.MU({queue:i,path:`${e}/api/v1/jsonstore/model/comments/${t}`,batchUpdate:!0,httpMethod:o.w$.PATCH,deserialize:e=>s.deserialize(e),serialize:e=>s.serialize(e)})}iterate(e){for(const t of this.comments)e(t)}addComment(e){this.comments.has(e.id)?this.comments.get(e.id).copy(e):this.comments.set(e.id,e)}updateCommentText(e,t){if(this.comments.has(e)){const i=this.comments.get(e);i.text!==t&&(i.text=t,i.modified=new Date,i.edited=!0,i.commit())}}removeComment(e){this.comments.has(e)&&(this.comments.delete(e),this.commit(),this.store.update({[e]:null}))}removeCommentsForNote(e){const t={};this.iterate((i=>{i.assetType===a.h.NOTE&&i.assetId===e&&(t[i.id]=null,this.comments.delete(i.id))})),Object.keys(t).length&&(this.commit(),this.store.update(t))}getCommentsForNote(e){const t=[];return this.iterate((i=>{i.assetType===a.h.NOTE&&i.assetId===e&&t.push(i)})),t}getCommentsForAllNotes(){const e=[];return this.iterate((t=>{t.assetType===a.h.NOTE&&e.push(t)})),e}getComment(e){return this.comments.get(e)}get collection(){return this.comments}}},13545:(e,t,i)=>{"use strict";i.d(t,{c:()=>o});var s=i(19413),n=i(90134);class o extends s.V{constructor(){super(...arguments),this.name="hashtag-data",this.hashtags=(0,n.C)([])}addHashtag(e){const t=e.trim().toLowerCase();-1===this.hashtags.indexOf(t)&&this.hashtags.push(e)}getHashtags(){return this.hashtags.values()}}},77113:(e,t,i)=>{"use strict";var s;i.d(t,{U:()=>s}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.VIEWING="viewing",e.ANNOTATING="annotating",e.EDITING="editing"}(s||(s={}))},72215:(e,t,i)=>{"use strict";i.d(t,{X:()=>h});var s=i(19413),n=i(5442),o=i(90134),r=i(74674),a=i(51090),l=i(77113),c=i(95892);class h extends s.V{constructor(e,t,i,s,r){super(),this.data=e,this.commentsData=t,this.attachmentsData=i,this.backgroundTexture=s,this.maskTexture=r,this.name="notes-view-data",this.notes=(0,o.C)([]),this.annotationViews=(0,o.C)([]),this.noteCreation=!1,this.openNoteViewObservable=(0,n.Y)(null),this.listIndexObservable=(0,n.Y)(-1),this.notesPhaseObservable=(0,n.Y)(l.U.CLOSED),this.notesFilterObservable=(0,n.Y)(c.$.OPEN),this.updateViewData(null)}getNotesList(){return this.notes}getNoteView(e){const t=this.notes.findIndex((t=>t.id===e));return-1!==t?this.notes.get(t):null}updateViewData(e){const t=[];this.data.iterate((e=>{t.push(this.createNoteView(e))})),this.notes.replace(t),this.updateAnnotationViews(e)}createNoteView(e){const t=Object.assign(Object.assign({},e),{createdTime:e.created.getTime(),numComments:0,attachments:this.attachmentsData.getAttachmentsForAsset(e.id,a.h.NOTE),backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture});return this.commentsData.getCommentsForNote(e.id).forEach((e=>{const i=e.created.getTime();t.numComments++,i>t.createdTime&&(t.createdTime=i)})),t}getAnnotationViewList(){return this.annotationViews}getCurrentNotesList(){const e=this.getCurrentNotesMap();return Object.values(e)}getFilteredNotes(){const e=this.notesFilter===c.$.ALL,t=this.notesFilter===c.$.RESOLVED,i=[];return this.notes.forEach((s=>{(e||s.resolved===t)&&i.push(s)})),i}getSearchMatch(e,t,i){if(!e)return 0;const s=this.getSearchTerm(e);if(!s)return 0;const n=t.toLowerCase().indexOf(s.toLowerCase());return-1!==n?n:e.blockType===r.C.USER&&e.value===i?0:-1}getSearchTerm(e){return e?e.blockType===r.C.USER?e.value||null:e.text:null}updateAnnotationViews(e){const t=this.getFilteredNotes(),i=this.getSearchTerm(e),s={};t.forEach((t=>{s[t.id]={id:t.id,text:t.text,user:t.user,color:t.color,createdTime:t.created.getTime(),assetType:a.h.NOTE,textIndex:this.getSearchMatch(e,t.text,t.user),numAttachments:this.attachmentsData.getAttachmentsForAsset(t.id,a.h.NOTE).length,numComments:0}}));const n={};i&&this.commentsData.iterate((t=>{if(t.assetType!==a.h.NOTE)return;const o=s[t.assetId];if(o){const s=this.getSearchMatch(e,t.text,t.user);if(-1!==s){const e=t.created.getTime();i?n[`${a.h.COMMENT}${t.id}`]={id:t.id,text:t.text,user:t.user,color:o.color,createdTime:e,assetType:a.h.COMMENT,textIndex:s,numAttachments:this.attachmentsData.getAttachmentsForAsset(t.id,a.h.COMMENT).length,numComments:0,assetId:o.id}:!i&&e>o.createdTime&&(o.createdTime=e,o.numComments=(o.numComments||0)+1)}}}));for(const e in s)i&&-1===s[e].textIndex||(n[`${a.h.NOTE}${e}`]=s[e]);const o=Object.values(n).sort(((e,t)=>t.createdTime-e.createdTime));this.annotationViews.replace(o)}getCurrentNotesMap(){const e={};return this.annotationViews.forEach((t=>{t.assetType===a.h.NOTE?e[t.id]=this.getNote(t.id):t.assetId&&t.assetType===a.h.COMMENT&&(e[t.assetId]||(e[t.assetId]=this.getNote(t.assetId)))})),e}getNote(e){const t=this.notes.findIndex((t=>t.id===e));return this.notes.get(t)}get creatingNote(){return this.noteCreation}setCreatingNote(e){this.noteCreation=e}getPendingNote(){return this.noteCreation&&this.openNoteView?this.openNoteView:null}setNotesPhase(e){this.notesPhaseObservable.value=e}get notesPhase(){return this.notesPhaseObservable.value}onNotesPhaseChanged(e){return this.notesPhaseObservable.onChanged(e)}setNotesFilter(e){this.notesFilterObservable.value=e}get notesFilter(){return this.notesFilterObservable.value}onNotesFilterChanged(e){return this.notesFilterObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenNoteView(e){this.openNoteViewObservable.value=e}get openNoteView(){return this.openNoteViewObservable.value}onOpenNoteViewChanged(e){return this.openNoteViewObservable.onChanged(e)}updateOpenNoteView(e){const t=this.openNoteView;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenNoteView(i)}}}},90039:(e,t,i)=>{"use strict";i.d(t,{yK:()=>n,yC:()=>o,dR:()=>r,xy:()=>a,VI:()=>l,FB:()=>c,gc:()=>h,_N:()=>d,kd:()=>u,Wh:()=>p,df:()=>m,oE:()=>g,yp:()=>f,sG:()=>v,ql:()=>y,Df:()=>b,Uw:()=>w,mH:()=>S,pH:()=>T});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={opened:e}}}class o extends s.m{constructor(e){super(),this.payload={id:e}}}class r extends s.m{constructor(e,t,i,s=-1,n=!1){super(),this.payload={id:e,transition:t,attachmentId:i,listIndex:s,editText:n}}}class a extends s.m{constructor(){super()}}class l extends s.m{constructor(){super()}}class c extends s.m{constructor(e){super(),this.payload={text:e}}}class h extends s.m{constructor(){super()}}class d extends s.m{constructor(){super()}}class u extends s.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}class p extends s.m{constructor(e){super(),this.payload={id:e}}}class m extends s.m{constructor(e){super(),this.payload={opened:e}}}class g extends s.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}class f extends s.m{constructor(e,t){super(),this.payload={id:e,resolved:t}}}class v extends s.m{constructor(e){super(),this.payload={id:e}}}class y extends s.m{constructor(e,t){super(),this.payload={id:e,editText:t}}}class b extends s.m{constructor(e,t,i){super(),this.payload={note:e,text:t,replyId:i}}}class w extends s.m{constructor(e,t,i){super(),this.payload={note:e,id:t,text:i}}}class S extends s.m{constructor(e,t){super(),this.payload={note:e,id:t}}}class T extends s.m{constructor(e){super(),this.payload={hashtag:e}}}},95892:(e,t,i)=>{"use strict";var s,n;i.d(t,{$:()=>s,Y:()=>n}),function(e){e.OPEN="open",e.RESOLVED="resolved",e.ALL="all"}(s||(s={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(n||(n={}))},96439:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddCommentCommand:()=>$.Df,AddHashtagCommand:()=>$.pH,CancelNewNoteCommand:()=>$.gc,CancelNoteChangesCommand:()=>$.Wh,CloseNoteCommand:()=>$._N,Comment:()=>B.s,CommentSerializer:()=>re.p,CommentsData:()=>V.l,DeleteCommentCommand:()=>$.mH,DeleteNoteCommand:()=>$.sG,HashtagData:()=>z.c,Note:()=>F,NoteColorVariant:()=>R.Y,NoteDeletedMessage:()=>Q.g,NoteSerializer:()=>K,NotesData:()=>G,NotesFilter:()=>R.$,NotesModeOpenedMessage:()=>Q.E,NotesModeToggleCommand:()=>$.yK,NotesPhase:()=>C.U,NotesViewData:()=>j.X,OpenListAnnotationCommand:()=>$.ql,OpenNoteCommand:()=>$.dR,OpenStartingNoteCommand:()=>$.xy,PreviewNoteCommand:()=>$.yC,ResolveNoteCommand:()=>$.yp,SaveNewNoteCommand:()=>$.FB,SaveNoteAppearanceCommand:()=>$.oE,SaveNoteChangesCommand:()=>$.kd,StartNewNoteCommand:()=>$.VI,ToggleNoteToolEditorCommand:()=>$.df,UpdateCommentCommand:()=>$.Uw,default:()=>ae});var s=i(54122),n=i(60778),o=i(28636),r=i(27314),a=i(62367),l=i(47924),c=i(90601),h=i(43711),d=i(6201),u=i(48769),p=i(51090),m=i(72386),g=i(71583),f=i(91843),v=i(3471),y=i(29675),b=i(77956),w=i(12775),S=i(39936),T=i(75711),E=i(33843),_=i(17707),x=i(90926),M=i(43770),P=i(68611),A=i(43098),O=i(90991),D=i(73305),I=i(36520),C=i(77113),R=i(95892),L=i(2212),N=i(78909),k=i(83455);class F extends N.T{constructor(e){super(),this.id="",this.resolved=!1,this.edited=!1,this.text="",this.user="",this.color=k.Rn,this.anchorPosition=new L.Pa4,this.stemNormal=new L.Pa4,this.stemLength=k.ZP.stem.length,this.stemEnabled=!0,this.created=new Date,this.modified=new Date,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.text=e.text,this.edited=e.edited,this.resolved=e.resolved,this.color=e.color,this.floorId=e.floorId,this.anchorPosition.copy(e.anchorPosition),this.stemNormal.copy(e.stemNormal),this.stemLength=e.stemLength,this.stemEnabled=e.stemEnabled,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.commit(),this}clone(){return(new F).copy(this)}}var B=i(64275),U=i(19413),H=i(71229);class G extends U.V{constructor(e){super(),this.name="notes-data",this.notes=(0,H.q)(e)}iterate(e){for(const t of this.notes)e(t)}addNote(e){this.notes.has(e.id)?this.notes.get(e.id).copy(e):this.notes.set(e.id,e)}updateNote(e,t){if(this.notes.has(e)){const i=this.notes.get(e);let s=!1;void 0!==t.text&&t.text!==i.text&&(i.text=t.text,i.edited=!0,s=!0),void 0!==t.resolved&&t.resolved!==i.resolved&&(i.resolved=t.resolved,s=!0),void 0!==t.color&&t.color!==i.color&&(i.color=t.color,s=!0),void 0!==t.anchorPosition&&t.anchorPosition!==i.anchorPosition&&(i.anchorPosition=t.anchorPosition,s=!0),void 0!==t.stemNormal&&t.stemNormal!==i.stemNormal&&(i.stemNormal=t.stemNormal,s=!0),void 0!==t.stemLength&&t.stemLength!==i.stemLength&&(i.stemLength=t.stemLength,s=!0),void 0!==t.stemEnabled&&t.stemEnabled!==i.stemEnabled&&(i.stemEnabled=t.stemEnabled,s=!0),void 0!==t.floorId&&t.floorId!==i.floorId&&(i.floorId=t.floorId,s=!0),s&&(i.modified=new Date,i.commit())}}removeNote(e){this.notes.has(e)&&(this.notes.delete(e),this.commit())}getNote(e){return this.notes.get(e)}getNoteProperties(e){const t=this.notes.get(e);return t?Object.assign({},t):null}get collection(){return this.notes}}var V=i(79283),z=i(13545),j=i(72215),W=i(32020),Z=i(40032);const q=new(i(25799).Z)("NoteSerializer");class K{constructor(e){this.floorsData=e}serialize(e){if(!e)return null;const t=this.floorsData.hasFloor(e.floorId)&&this.floorsData.getFloor(e.floorId);return t?{id:e.id,resolved:e.resolved,text:e.text,user:e.user,edited:e.edited,color:e.color,stemLength:e.stemLength,stemEnabled:e.stemEnabled,anchorPosition:(0,Z.m)(e.anchorPosition),stemNormal:(0,Z.m)(e.stemNormal),floor:t.index,created:(0,W.U)(e.created),modified:(0,W.U)(e.modified)}:null}}class Y{constructor(e){this.floorsData=e}deserialize(e){const t=this.floorsData.getFloorAtIndex(e.floor);if(!this.validate(e)||!t)return q.debug("Deserialized invalid Note",e),null;const i=new F;return i.id=e.id,i.text=e.text,i.user=e.user,i.edited=e.edited,i.resolved=!!e.resolved,i.color=e.color||k.Rn,i.stemLength=isNaN(e.stemLength)?k.ZP.stem.length:e.stemLength,i.stemEnabled=void 0===e.stemEnabled||e.stemEnabled,i.anchorPosition=new L.Pa4(e.anchorPosition.x,e.anchorPosition.y,e.anchorPosition.z),i.stemNormal=new L.Pa4(e.stemNormal.x,e.stemNormal.y,e.stemNormal.z).normalize(),i.floorId=t.id,i.created=(0,W.p)(e.created),i.modified=(0,W.p)(e.modified),i}validate(e){return!(!e||"object"!=typeof e)&&["id","text","user","edited","resolved","color","floor","stemLength","stemEnabled","anchorPosition","stemNormal","created","modified"].every((t=>t in e))}}var $=i(90039),Q=i(5261),X=i(22729),J=i(46101),ee=i(51418),te=i(55525),ie=i(80994),se=i(80034),ne=i(25936);class oe extends s.Y{constructor(){super(...arguments),this.name="notes",this.activated=!1,this.registered=!1,this.activeBindings=[],this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(k.Mp,!1),t=!this.in360View(),i=!this.interactionmodeData.isVR(),s=t&&i&&e;this.pinRenderer.fadePinOpacityByType(x.Er.NOTE,s?1:0)},this.userOpenedNotesMode=()=>{this.toolsData.setToolAccess(c.X$.TOOL)},this.toggleNotesMode=async e=>{e.opened?this.activateTool():this.deactivateTool()},this.addHashtag=async e=>{this.addHashtags(e.hashtag),this.hashtagData.commit()},this.togglePinAssetEditor=async e=>{e.opened?this.viewData.setNotesPhase(C.U.EDITING):this.viewData.notesPhase===C.U.EDITING&&this.viewData.setNotesPhase(C.U.VIEWING)},this.openStartingNote=async()=>{if(this.startingNote){const e=this.viewData,t=e.getNoteView(this.startingNote);if(!t)return;t.resolved&&(e.setNotesFilter(R.$.ALL),e.updateViewData(this.annotationsViewData.searchBlock),this.noteFilteringChanged()),await this.engine.commandBinder.issueCommand(new h.tT(c.w1.NOTES,!0)),await(0,a.gw)(500),this.openNote(t.id,l.n.FadeToBlack),this.startingNote=null}},this.onAppChange=()=>{this.deactivateTool(),this.updatePerSettings()},this.onCloseNote=async()=>{this.closeNote()},this.pinAddCancelled=e=>{e.pinType===x.Er.NOTE&&this.cancelNoteCreation()},this.onCancelNewNote=async()=>{this.cancelNoteCreation()},this.cancelNoteCreation=()=>{const e=this.viewData;this.noteEditor&&(this.engine.broadcast(new M.w0(x.Er.NOTE)),this.engine.broadcast(new d.Ur),this.cancelAttachmentChanges(),e.setCreatingNote(!1),e.setOpenNoteView(null),e.setNotesPhase(C.U.IDLE))},this.noteWasAdded=(e,t)=>{this.updateNote(e)},this.noteWasRemoved=(e,t)=>{this.pinRenderer.removePin(t)},this.noteWasUpdated=(e,t)=>{this.updateNote(e)},this.notesWereChanged=()=>{this.viewData.updateViewData(this.annotationsViewData.searchBlock)},this.onNoteFilterChanged=()=>{this.viewData.setOpenNoteView(null),this.viewData.updateViewData(this.annotationsViewData.searchBlock),this.noteFilteringChanged()},this.onSearchBlockChanged=()=>{this.closeNote(),this.viewData.updateViewData(this.annotationsViewData.searchBlock),this.noteFilteringChanged()},this.onViewModeOrFloorChanged=()=>{this.updatePerSettings(),this.noteFilteringChanged()},this.onOpenNoteViewChanged=()=>{const e=this.viewData.openNoteView;e&&this.updateNote(e)},this.startNoteCreation=async()=>{if(!this.noteEditor)return;const e=this.viewData,t=this.users.getCurrentUserId();let i=(0,a.O1)(11);for(;this.notesData.getNote(i);)i=(0,a.O1)(11);const s=new F;s.id=i,s.user=t,s.floorId=this.floorsViewData.getHighestVisibleFloor().id;const n=e.createNoteView(s);e.setCreatingNote(!0),e.setNotesPhase(C.U.CREATING),e.setOpenNoteView(n),this.engine.broadcast(new M.nO(n,x.Er.NOTE)),this.engine.commandBinder.issueCommand(new A.B)},this.saveNewNote=async e=>{if(!this.noteEditor)return;const t=this.viewData,i=t.getPendingNote();if(i){const s=new F;s.copy(i),s.text=e.text,s.created=new Date,s.modified=new Date,s.commit(),this.notesData.addNote(s),this.save(s),this.addHashtags(e.text),await this.confirmAttachmentChanges(s.id,p.h.NOTE),t.updateViewData(this.annotationsViewData.searchBlock),t.setCreatingNote(!1),this.closeNote()}else this.log.debug("No pending note")},this.pinMoved=e=>{const t=this.viewData.openNoteView;if(t&&e.pinType===x.Er.NOTE&&e.id===t.id){const t=this.notesData.getNote(e.id);t?(this.notesData.updateNote(e.id,e.pinPos),this.save(t)):this.log.debug("Cannot move a non-existent note")}},this.pinPlaced=e=>{const t=this.viewData.openNoteView;t&&e.pinType===x.Er.NOTE&&e.id===t.id&&(this.viewData.setNotesPhase(C.U.OPENING),this.viewData.setNotesPhase(C.U.ANNOTATING),this.engine.broadcast(new d.ZL(p.h.NOTE)))},this.pinDeselected=e=>{const{openNoteView:t,notesPhase:i}=this.viewData;t&&e.pinType===x.Er.NOTE&&e.id===t.id&&i===C.U.VIEWING&&this.closeNote()},this.openListAnnotation=async e=>{const t=this.viewData.getAnnotationViewList().values(),i=t.findIndex((t=>t.id===e.id));if(-1===i)return void this.log.debug("annotationId not in list");const s=t[i];if(!s)return void this.log.debug("Cannot open non-existent list annotation");const n=s.assetId?s.assetId:s.id,o=this.toolsData.toolPanelLayout===c.wS.SIDE_PANEL?l.n.FadeToBlack:l.n.Instant;this.openNote(n,o,void 0,i,e.editText)},this.previewNote=async e=>{const t=this.viewData.getNoteView(e.id);t&&this.engine.commandBinder.issueCommand(new P._l(t,x.Er.NOTE))},this.onOpenNote=async e=>this.openNote(e.id,e.transition,e.attachmentId,e.listIndex,e.editText),this.deleteNote=async e=>{const t=this.notesData.getNote(e.id);if(t){this.engine.commandBinder.issueCommand(new g.rE),await this.engine.commandBinder.issueCommand(new D.Qm(e.id,p.h.NOTE)),await this.deleteNoteComments(t),this.notesData.removeNote(e.id),await this.store.update({[e.id]:null}),this.engine.broadcast(new Q.g(e.id));const i=this.viewData.openNoteView;i&&i.id===e.id&&this.closeNote()}else this.log.debug("Cannot delete a non-existent note")},this.deleteNoteComments=async e=>{const t=this.commentsData.getCommentsForNote(e.id).map((e=>e.id));await this.engine.commandBinder.issueCommand(new D.HC(t,p.h.COMMENT)),this.commentsData.removeCommentsForNote(e.id)},this.resolveNote=async e=>{const t=this.notesData.getNote(e.id);t?(this.viewData.updateOpenNoteView({resolved:e.resolved}),this.notesData.updateNote(e.id,{resolved:e.resolved}),this.save(t)):this.log.debug("Cannot resolve/unresolve a non-existent note")},this.saveNoteChanges=async e=>{const t=this.notesData,i=this.viewData,s=t.getNote(e.id);if(s)if(s.user===this.users.getCurrentUserId()){const n=e.properties;void 0!==n.text&&(this.addHashtags(n.text),n.resolved=!1),Object.keys(n)&&(i.updateOpenNoteView(n),t.updateNote(e.id,n),this.save(s)),await this.confirmAttachmentChanges(s.id,p.h.NOTE),this.viewData.updateViewData(this.annotationsViewData.searchBlock)}else this.log.debug("Cannot update another user's note text");else this.log.debug("Cannot update a non-existent note");this.viewData.setNotesPhase(C.U.VIEWING)},this.cancelNoteChanges=async e=>{const t=this.viewData.openNoteView;t&&t.id===e.id&&this.resetOpenNoteView(),this.cancelAttachmentChanges(),this.viewData.setNotesPhase(C.U.VIEWING)},this.saveNoteAppearance=async e=>{const t=this.notesData,i=this.viewData,s=t.getNote(e.id);if(s){const n=e.properties;if(Object.keys(n)){i.updateOpenNoteView(n);const o=i.openNoteView;o&&this.engine.broadcast(new M.KR(o,x.Er.NOTE)),t.updateNote(e.id,n),this.save(s)}this.viewData.updateViewData(this.annotationsViewData.searchBlock)}else this.log.debug("Cannot update a non-existent note")},this.addComment=async e=>{const t=this.notesData.getNote(e.note);if(t){const i=this.users.getCurrentUserId(),s=new B.s;let n=(0,a.O1)(11);for(;this.commentsData.getComment(n);)n=(0,a.O1)(11);return s.id=n,s.assetId=e.note,s.assetType=p.h.NOTE,s.text=e.text,s.user=i,s.created=new Date,s.modified=new Date,s.commit(),this.commentsData.addComment(s),this.commentsData.save(s),this.addHashtags(e.text),t.resolved&&(this.notesData.updateNote(e.note,{resolved:!1}),this.save(t)),this.viewData.setNotesPhase(C.U.VIEWING),await this.confirmAttachmentChanges(s.id,p.h.COMMENT,e.replyId),this.viewData.updateViewData(this.annotationsViewData.searchBlock),s}return this.log.debug("Cannot add a comment to a non-existent note"),null},this.updateComment=async e=>{const t=this.notesData.getNote(e.note);if(t){const i=this.commentsData.getComment(e.id);i?i.user===this.users.getCurrentUserId()?(this.commentsData.updateCommentText(e.id,e.text),this.commentsData.save(i),this.addHashtags(e.text),t.resolved&&(this.notesData.updateNote(e.note,{resolved:!1}),this.viewData.updateOpenNoteView({resolved:!1}),this.save(t)),await this.confirmAttachmentChanges(i.id,p.h.COMMENT),this.viewData.setNotesPhase(C.U.VIEWING)):this.log.debug("Cannot update another user's comment"):this.log.debug("Cannot update a non-existent comment")}else this.log.debug("Cannot update a comment in a non-existent note")},this.deleteComment=async e=>{this.notesData.getNote(e.note)?(await this.engine.commandBinder.issueCommand(new D.rh),await this.engine.commandBinder.issueCommand(new D.N0),await this.engine.commandBinder.issueCommand(new D.Qm(e.id,p.h.COMMENT)),this.commentsData.removeComment(e.id),this.commentsData.save()):this.log.debug("Cannot delete a comment in a non-existent note"),this.viewData.updateViewData(this.annotationsViewData.searchBlock)}}async init(e,t){const[i,s,a]=await Promise.all([t.market.waitForData(S.e),t.market.waitForData(T.Z),t.getModule(E.default)]);if(!a.isLoggedIn()||s.isVR()||!i.tryGetProperty(k.IA,!1))return;this.engine=t,this.startingNote=e.startingNote||null,this.workshop=e.workshop,this.interactionmodeData=s,this.users=a,this.settingsData=i;const[l]=await Promise.all([t.getModule(_.default)]);this.pinRenderer=l.pinRenderer;const[c,h,d,p,m,g,f,x]=await Promise.all([t.market.waitForData(y.pu),t.market.waitForData(u.t),t.market.waitForData(b.Z),t.market.waitForData(w.O),t.market.waitForData(I.b),t.market.waitForData(ne.i),t.market.waitForData(X.c),t.market.waitForData(O.A)]);this.appData=c,this.toolsData=h,this.sweepData=d,this.viewmodeData=p,this.attachmentsData=m,this.floorsViewData=f,this.annotationsViewData=x,this.store=this.getStore(e,g);const M=await this.store.read();this.notesData=new G(M||{}),t.market.register(this,G,this.notesData),this.commentsData=new V.l(e),t.market.register(this,V.l,this.commentsData),await this.commentsData.load(),await this.loadNoteAndCommentUsers(),this.hashtagData=new z.c,t.market.register(this,z.c,this.hashtagData),this.maskTexture=(0,n.p)(r),this.backgroundTexture=(0,n.p)(o),this.viewData=new j.X(this.notesData,this.commentsData,this.attachmentsData,this.backgroundTexture,this.maskTexture),this.noteEditor=this.users.isEditor(),this.bindings.push(i.onPropertyChanged(k.Mp,this.updatePerSettings),t.commandBinder.addBinding($.yK,this.toggleNotesMode),t.commandBinder.addBinding($.dR,this.onOpenNote),t.commandBinder.addBinding($.yC,this.previewNote),t.commandBinder.addBinding($.xy,this.openStartingNote),t.subscribe(v.bS,this.onAppChange),p.makeModeChangeSubscription(this.onViewModeOrFloorChanged),f.makeFloorChangeSubscription(this.onViewModeOrFloorChanged),t.subscribe(J.Z,this.updatePerSettings),t.subscribe(ee.m,this.updatePerSettings),t.subscribe(Q.E,this.userOpenedNotesMode)),t.market.register(this,j.X,this.viewData),this.updatePerSettings(),this.displayNotes()}getStore(e,t){const{baseUrl:i,modelId:s,queue:n}=e,o=new ie.A({serializer:new K(t),deserializer:new Y(t)});return new se.MU({queue:n,path:`${i}/api/v1/jsonstore/model/notes/${s}`,batchUpdate:!0,httpMethod:se.w$.PATCH,deserialize:e=>o.deserialize(e),serialize:e=>o.serialize(e)})}async save(e){const t=e?{[e.id]:e}:this.notesData.collection.deepCopy();return this.store.update(t)}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(x.Er.NOTE),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}activateTool(){this.activated||(this.workshop&&(this.appData.application===y.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new g.Mn(!1)),this.engine.commandBinder.issueCommand(new f.KW(!1))),this.noteEditor&&this.engine.commandBinder.issueCommand(new P.EP(!0)),this.viewData.setNotesPhase(C.U.IDLE),this.collectHashtags(),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{creatingNote:e,openNoteView:t}=this.viewData;e?this.cancelNoteCreation():t&&this.closeNote(),this.viewData.setNotesPhase(C.U.CLOSED),this.engine.commandBinder.issueCommand(new P.EP(!1)),this.workshop&&(this.appData.application===y.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new g.Mn(!0)),this.engine.commandBinder.issueCommand(new f.KW(!0))),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}onUpdate(){}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.engine.subscribe(M.b0,this.pinPlaced),this.engine.subscribe(M.bV,this.pinMoved),this.engine.subscribe(M.hu,this.pinAddCancelled),this.engine.subscribe(M.Fe,this.pinDeselected),e.addBinding($.VI,this.startNoteCreation),e.addBinding($.FB,this.saveNewNote),e.addBinding($.gc,this.onCancelNewNote),e.addBinding($._N,this.onCloseNote),e.addBinding($.kd,this.saveNoteChanges),e.addBinding($.Wh,this.cancelNoteChanges),e.addBinding($.ql,this.openListAnnotation),e.addBinding($.sG,this.deleteNote),e.addBinding($.yp,this.resolveNote),e.addBinding($.Df,this.addComment),e.addBinding($.Uw,this.updateComment),e.addBinding($.mH,this.deleteComment),e.addBinding($.pH,this.addHashtag),e.addBinding($.oE,this.saveNoteAppearance),e.addBinding($.df,this.togglePinAssetEditor),this.annotationsViewData.onSearchBlockChanged(this.onSearchBlockChanged),this.viewData.onNotesFilterChanged(this.onNoteFilterChanged),this.viewData.onOpenNoteViewChanged(this.onOpenNoteViewChanged),this.notesData.onChanged(this.notesWereChanged),this.notesData.collection.onElementChanged({onAdded:this.noteWasAdded,onRemoved:this.noteWasRemoved,onUpdated:this.noteWasUpdated})),this.registered=!0}async loadNoteAndCommentUsers(){const e=new Set;return this.notesData.iterate((t=>{e.add(t.user)})),this.commentsData.iterate((t=>{e.add(t.user)})),this.engine.commandBinder.issueCommand(new m.d(e))}collectHashtags(){this.notesData.iterate((e=>{this.addHashtags(e.text)})),this.commentsData.iterate((e=>{this.addHashtags(e.text)})),this.hashtagData.commit()}addHashtags(e){const t=this.hashtagData,i=e.match(/\[\#\S+\]/g);i&&i.forEach((e=>{t.addHashtag(e.substring(2,e.length-1))}))}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}closeNote(){this.cancelAttachmentChanges(),this.viewData.openNoteView&&(this.engine.broadcast(new M.A(this.viewData.openNoteView.id,x.Er.NOTE)),this.engine.broadcast(new d.Ur)),this.viewData.setNotesPhase(C.U.IDLE),this.viewData.setOpenNoteView(null),this.noteFilteringChanged()}noteFilteringChanged(){const{viewData:e}=this,t=e.notesFilter;this.notesData.iterate((i=>{const{id:s,resolved:n}=i,o=e.openNoteView&&e.openNoteView.id===s||t===R.$.ALL||n&&t===R.$.RESOLVED||!n&&t===R.$.OPEN;this.pinRenderer.setPinVisible(s,o)}))}displayNotes(){this.notesData.iterate((e=>this.updateNote(e))),this.noteFilteringChanged()}updateNote(e){this.pinRenderer.displayPin(e.id,x.Er.NOTE,e,this.backgroundTexture,this.maskTexture)}async confirmAttachmentChanges(e,t,i){return Promise.all([this.engine.commandBinder.issueCommand(new D.GW(e,t,i)),this.engine.commandBinder.issueCommand(new D.N0)])}async cancelAttachmentChanges(){return Promise.all([this.engine.commandBinder.issueCommand(new D.rh),this.engine.commandBinder.issueCommand(new D.u)])}async openNote(e,t,i,s=-1,n=!1){const{toolsData:o,commentsData:r,viewData:a,engine:u,log:m,activated:f,noteEditor:v,pinRenderer:y}=this;f?-1!==s&&o.toolAccess===c.X$.TOOL&&o.setToolAccess(c.X$.LIST):(await u.commandBinder.issueCommand(new h.tT(c.w1.NOTES,!0)),o.setToolAccess(c.X$.SCENE));const b=a.getNoteView(e);if(b){const o=a.openNoteView;if(!o||o.id!==e){const e=null!==t?t:l.n.Instant;a.setOpenNoteView(b),u.broadcast(new M.sD(b,x.Er.NOTE,v)),a.setNotesPhase(C.U.OPENING),null!==e&&(y.hideSelectedMesh(),await u.commandBinder.issueCommand(new te.OR({pinPosition:b,transition:e})),y.showSelectedMesh(x.Er.NOTE,b.id)),n?a.setNotesPhase(C.U.ANNOTATING):a.setNotesPhase(C.U.VIEWING),u.broadcast(new d.ZL(p.h.NOTE))}let c=s;if(-1===s&&b&&(c=a.getAnnotationViewList().values().findIndex((e=>e.assetType===p.h.NOTE&&e.id===b.id||e.assetType===p.h.COMMENT&&e.assetId===b.id))),a.setListIndex(c),i&&!n){const t=[e].concat(r.getCommentsForNote(e).map((e=>e.id)));u.commandBinder.issueCommand(new D.VO(i,t))}else u.commandBinder.issueCommand(new g.rE)}else m.debug("Cannot open a non-existent note")}resetOpenNoteView(){const e=this.viewData.openNoteView;if(e){const t=this.notesData.getNoteProperties(e.id);t&&this.viewData.updateOpenNoteView(t)}}}var re=i(50354);const ae=oe},5261:(e,t,i)=>{"use strict";i.d(t,{g:()=>n,E:()=>o});var s=i(93528);class n extends s.v{constructor(e){super(),this.id=e}}class o extends s.v{}},83455:(e,t,i)=>{"use strict";i.d(t,{IA:()=>s,Mp:()=>n,pE:()=>o,TM:()=>r,Ko:()=>a,Rn:()=>l,ZP:()=>c});const s="features/notes-mode",n="features/notes",o="features/notes-nudge",r=500,a=500,l="#5c7fff",c=Object.freeze({noteMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"],stem:{length:.23,width:1,opacity:1,transparent:!1,color:"white",alphaTest:.05},anchor:{size:.1},navigation:{anyDistance:!0,visibleDistance:8,cameraClearance:.1,tiltTolerance:25}})},1707:(e,t,i)=>{"use strict";i.d(t,{SI:()=>n,uQ:()=>o,zf:()=>r,O8:()=>a,WI:()=>l});var s=i(2212);const n=1e3/60,o=s.M8C.degToRad(70),r=-o,a=.05,l=.1/60},55530:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>M,lookAccelerationKey:()=>x});var s=i(54122),n=i(2212),o=i(30963),r=i(27829),a=i(1707),l=i(45805),c=i(97620),h=i(22888),d=i(44266);class u extends h.Z{constructor(e){super(),this.lookVelocity=new n.FM8,this.lookAccel=new n.FM8,this.tempAxis=new n.Pa4,this.tempOrientation=new n._fP,this.currentOrientation=new n._fP,this.tempEuler=new n.USm,this.cameraModule=e,this.transition={active:!1,startTime:0,elapsed:0,duration:0,velocity:new n.FM8,easeOut:!1}}setLookAcceleration(e,t=!1){this.transition.active||(t&&(e.x&&this.lookVelocity.x&&Math.sign(e.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),e.y&&this.lookVelocity.y&&Math.sign(e.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==e.x?e.x:this.lookAccel.x,this.lookAccel.y=void 0!==e.y?e.y:this.lookAccel.y)}startTransition(e,t,i){const s=new d.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=s,this.transition.velocity.copy(t),this.transition.easeOut=i,this.lookAccel.set(0,0),this.lookVelocity.copy(t),this.cameraModule.beginExternalTransition(),s.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e){const t=e/a.SI;if(this.lookVelocity.copy(this.transition.velocity),this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){const t=this.transition.duration-(this.transition.elapsed-e);this.lookVelocity.multiplyScalar(t/e)}else this.lookVelocity.multiplyScalar(t)}updateCameraParameters(){const e=this.cameraModule.getData(!1);this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ");const t=this.tempEuler.x,i=(0,c.uZ)(this.lookVelocity.y,a.zf-t,a.uQ-t);this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.pose.rotation),i),this.currentOrientation.copy(e.pose.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.pose.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),this.cameraModule.updateCameraRotation(this.tempOrientation))}update(e){const t=this.cameraModule.getData(!1),i=e/a.SI;t.pose.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(t.pose.rotation),this.transition.active?(this.updateTransition(e),this.updateCameraParameters(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>l.Z.epsilon||this.lookVelocity.length()>l.Z.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,i),this.updateCameraParameters(),this.lookVelocity.multiplyScalar(Math.pow(1-a.O8,i)))}stop(e=!1){this.stopTransition(),this.lookAccel.set(0,0),e||this.lookVelocity.set(0,0)}startRotateTransition(e,t,i){const s=this.cameraModule.getData(!1);return s.transition&&s.transition.activeInternal&&s.transition.to.rotation&&(s.transition.to.rotation=void 0),this.startTransition(e,t.clone().multiplyScalar(a.SI),i).nativePromise()}startTranslateTransition(e,t,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(e,t,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var p=i(89895),m=i(12775),g=i(75711),f=i(71208),v=i(40582),y=i(35825),b=i(22767),w=i(48840),S=i(21588),T=i(78626),E=i(60959),_=i(39936);const x="Rotation speed";class M extends s.Y{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=a.WI,this.calcRotationAngle=(()=>{const e=new n.yGw,t=new n.Pa4,i=new n.Pa4;return(s,o,r)=>{const a=s.getData(!1);e.copy(a.pose.projection.asThreeMatrix4()),e.invert(),t.set(o.x-r.x,o.y-r.y,-1).applyMatrix4(e),i.set(o.x,o.y,-1).applyMatrix4(e);const l=Math.sqrt(t.x*t.x+t.z*t.z),c=Math.sqrt(i.x*i.x+i.z*i.z),h=Math.atan2(t.y,l),d=Math.atan2(i.y,c)-h;t.y=0,i.y=0,t.normalize(),i.normalize();const u=Math.acos(t.dot(i));let p=0;return isNaN(u)||(p=u,r.x>0&&(p*=-1)),new n.FM8(-p,-d)}})()}async init(e,t){const i=await t.getModule(p.default);this.controls=new u(i),(await t.getModule(E.default)).addControls(f.Ey.Panorama,this.controls),this.market=t.market,this.bindings.push(t.subscribe(w.Z,(e=>{this.controls.stop()}))),t.getModule(o.default).then((e=>{e.registerHandler(S.E0,(e=>{this.validateViewmode()&&this.controls.stop()})),e.registerHandler(S._t,(e=>{this.validateViewmode()&&e.buttons&v.r3.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(i,e.position,e.delta),this.controls.update(a.SI),this.controls.stop())})),e.registerHandler(S._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&!(e.buttons&v.r3.PRIMARY)&&(this.onDrag(i,e.position,e.delta),this.controls.update(a.SI),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),e.registerHandler(T.e,(e=>{this.validateViewmode()&&this.onKey(e.key,e.state)}))}))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onDrag(e,t,i){this.controls.setLookAcceleration(this.calcRotationAngle(e,t,i))}onKey(e,t){let i=null;const s=this.market.tryGetData(_.e);s&&(i=s.tryGetProperty(x,null)),this.lookAccelerationSpeed=i?i*(Math.PI/180)/60:this.lookAccelerationSpeed;const n=t===b.M.DOWN;switch(e){case y.R.LEFTARROW:case y.R.J:this.controls.setLookAcceleration({x:n?this.lookAccelerationSpeed:0},!0);break;case y.R.RIGHTARROW:case y.R.L:this.controls.setLookAcceleration({x:n?-this.lookAccelerationSpeed:0},!0);break;case y.R.K:this.controls.setLookAcceleration({y:n?-this.lookAccelerationSpeed:0},!0);break;case y.R.I:this.controls.setLookAcceleration({y:n?this.lookAccelerationSpeed:0},!0)}}validateViewmode(){const e=this.market.tryGetData(m.O),t=this.market.tryGetData(g.Z);return!e||!t||e.isPano()&&!t.isVR()}}},75931:(e,t,i)=>{"use strict";i.d(t,{j:()=>l});var s=i(20599),n=i(60778),o=i(2212),r=i(30749),a=i(90666);class l extends o.Kj0{constructor(e){super(new o.BKK(a.Z.anchor.size,a.Z.anchor.size),new o.vBJ({depthTest:!1,depthWrite:!1,transparent:!0,map:l.getTexture(),side:o.ehD})),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=s.z.pins}static getTexture(){return l.anchorTexture||(l.anchorTexture=(0,n.p)(r)),l.anchorTexture}}},73749:(e,t,i)=>{"use strict";i.d(t,{$:()=>a});var s=i(45805),n=i(20599),o=i(2212),r=i(90666);class a extends o.Kj0{constructor(e,t,i,s){super(t,i),this.geomScale=new o.Pa4(1,1,1),this.userData.sid=e,this.worldPosition=new o.Pa4,this.cameraPosition=new o.Pa4,this.layers.mask=s.mask,this.renderOrder=n.z.pins,this.scale.set(.01,.01,.01)}dispose(){this.material.dispose(),this.geometry.dispose()}updatePosition(e){this.position.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01))}update(e,t,i){const n=r.Z.pinHeadMesh.scale;this.getWorldPosition(this.worldPosition);const a=e.getWorldPosition(this.cameraPosition).distanceTo(this.worldPosition);this.quaternion.copy(e.quaternion);const l=n.maxSize-(n.maxSize-n.minSize)*o.M8C.smoothstep(a,n.nearBound,n.farBound),c=this.worldPosition.clone().project(e),h=new o.Pa4(i.width/2,i.height/2,1).multiply(c),d=new o.Pa4(l/2,0,0).add(h),u=new o.Pa4(2/i.width,2/i.height,1).multiply(d).clone().unproject(e).clone().distanceTo(this.worldPosition)*(1+n.responsiveness/100*(t-1)),p=o.M8C.clamp(u,s.Z.epsilon,u);this.scale.set(p*this.geomScale.x,p*this.geomScale.y,p*this.geomScale.z)}}},70008:(e,t,i)=>{"use strict";i.d(t,{B:()=>r});var s=i(19413),n=i(5442),o=i(90926);class r extends s.V{constructor(){super(),this.name="pins-view-data",this.creatingPin=!1,this.pinStateObservable=(0,n.Y)(o.tS.IDLE),this.openPinObservable=(0,n.Y)(null),this.editableObservable=(0,n.Y)(!0),this.previewPinObservable=(0,n.Y)(null),this.progressObservable=(0,n.Y)(-1),this.screenPositionObservable=(0,n.Y)(null),this.canPlaceObservable=(0,n.Y)(!0),this.canAddObservable=(0,n.Y)(!0)}get creatingNewPin(){return this.creatingPin}updateOpenPin(e){const t=this.openPin;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenPin(i)}}setOpenPin(e){this.openPinObservable.value=e}get openPin(){return this.openPinObservable.value}onOpenPinChanged(e){return this.openPinObservable.onChanged(e)}setPreviewPin(e){this.previewPinObservable.value=e}get previewPin(){return this.previewPinObservable.value}onPreviewPinChanged(e){return this.previewPinObservable.onChanged(e)}setPinState(e){switch(this.pinState){case o.tS.IDLE:case o.tS.OPEN:case o.tS.PREVIEWING:this.creatingPin=!1;break;case o.tS.CREATING:this.creatingPin=!0}this.pinStateObservable.value=e}get pinState(){return this.pinStateObservable.value}onPinStateChanged(e){return this.pinStateObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){const t=this.progressObservable.onChanged(e);return t.renew(),t}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}get isPinEditable(){return this.editableObservable.value}setEditablePin(e){this.editableObservable.value=e}get canAdd(){return this.canAddObservable.value}setCanAdd(e){this.canAddObservable.value=e}onCanAddChanged(e){return this.canAddObservable.onChanged(e)}get canPlace(){return this.canPlaceObservable.value}setCanPlace(e){this.canPlaceObservable.value=e}onCanPlaceChanged(e){return this.canPlaceObservable.onChanged(e)}}},68611:(e,t,i)=>{"use strict";i.d(t,{EP:()=>o,_l:()=>r,Ar:()=>a,$b:()=>l,fe:()=>c,G3:()=>h,ip:()=>d,I$:()=>u,tT:()=>p});var s=i(99681),n=i(47924);class o extends s.m{constructor(e){super(),this.payload={enabled:e}}}class r extends s.m{constructor(e,t){super(),this.payload={pin:e,pinType:t}}}class a extends s.m{constructor(e,t,i=n.n.Instant){super(),this.payload={id:e,pinType:t,transition:i}}}class l extends s.m{constructor(e,t,i,s,n=-1,o=!1){super(),this.payload={id:e,pinType:t,transition:i,attachmentId:s,listIndex:n,editText:o}}}class c extends s.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,stemLength:i}}}class h extends s.m{constructor(){super()}}class d extends s.m{constructor(){super()}}class u extends s.m{constructor(e,t){super(),this.payload={id:e,pos:t}}}class p extends s.m{constructor(){super()}}},90926:(e,t,i)=>{"use strict";var s,n,o,r;i.d(t,{Er:()=>s,K_:()=>n,tS:()=>o,Od:()=>r}),function(e){e.MATTERTAG="mattertag",e.NOTE="note"}(s||(s={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(n||(n={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.PREVIEWING="previewing",e.SELECTED="selected",e.OPEN="open",e.EDITING="editing"}(o||(o={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(r||(r={}))},17707:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AdjustPinStemLengthCommand:()=>$.fe,BasePinRenderer:()=>Te,CancelNewPinCommand:()=>$.tT,ClickAwayFromPinCommand:()=>$.G3,EnablePinEditingCommand:()=>$.EP,FocusPinAnnotationMessage:()=>Q.nY,MovePinCommand:()=>$.I$,OpenPinCommand:()=>$.$b,PinAddCancelledMessage:()=>Q.hu,PinAnchorMesh:()=>K.j,PinClickedMessage:()=>Q.F7,PinClosedMessage:()=>Q.A,PinColorVariant:()=>Z.K_,PinDeselectMessage:()=>Q.Fe,PinDiscardedMessage:()=>Q.w0,PinEditor:()=>se,PinHeadMesh:()=>q.$,PinHoverChangeMessage:()=>Q.tP,PinMovedMessage:()=>Q.bV,PinOpenedMessage:()=>Q.sD,PinPlacedMessage:()=>Q.b0,PinPreviewDirection:()=>Z.Od,PinSelectedMessage:()=>Q.Q4,PinStartCreatingMessage:()=>Q.nO,PinState:()=>Z.tS,PinType:()=>Z.Er,PinUpdatedMessage:()=>Q.KR,PinsViewData:()=>M.B,PlacePinCommand:()=>$.ip,PreviewPinCommand:()=>$._l,SelectPinCommand:()=>$.Ar,default:()=>Be});var s=i(2212),n=i(54122),o=i(30963),r=i(62513),a=i(50101),l=i(75195),c=i(47924),h=i(21265),d=i(29675),u=i(99169),p=i(22729),m=i(75711),g=i(89155),f=i(77956),v=i(12775),y=i(71208),b=i(46101),w=i(39869),S=i(13402),T=i(3471),E=i(6201),_=i(87493),x=i(90039),M=i(70008),P=i(53999),A=i(26956),O=i(50266),D=i(61718),I=i(7065),C=i(77787),R=i(76258),L=i(12505),N=i(25799),k=i(75712),F=i(24975),B=i(40582),U=i(36073),H=i(21588),G=i(35056),V=i(75158),z=i(78626),j=i(22767),W=i(35825),Z=i(90926),q=i(73749),K=i(75931),Y=i(90666),$=i(68611),Q=i(43770),X=i(25936),J=i(85995),ee=i(55525),te=i(56730),ie=i(90014);class se{constructor(e,t,i,n){this.viewData=e,this.engine=t,this.input=i,this.pinRenderer=n,this.bindings=[],this.externalBehaviorsBlocked=!1,this.touchDevice=(0,h.Jm)(),this.longPressCreateThreshold=500,this.ndcPoint=new s.Pa4,this.movingPin=!1,this.anchored=!1,this.inAnchorClick=!1,this.log=new N.Z("note-editor"),this.stopEventPropagation=()=>!0,this.updateMeshPreviewSphere=async(e,t)=>{this.engine.commandBinder.issueCommand(new te.n(e,t))},this.startPinCreation=()=>{this.creatingHandlers.renew(),this.touchDevice||(this.allowExternalBehaviors(!1),this.engine.commandBinder.issueCommand(new R.u(I.C.XHAIR))),this.engine.commandBinder.issueCommand(new J.ZD)},this.endPinCreation=()=>{this.draggingHandlers.cancel(),this.creatingHandlers.cancel(),this.clearLongPressTimeout(),this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new R.u(I.C.DEFAULT)),this.engine.commandBinder.issueCommand(new J.zd)},this.onOpenPinChanged=()=>{this.updateAnchorMesh()},this.onPinStateUpdated=()=>{const e=this.viewData.pinState;switch(this.updateAnchorMesh(),e){case Z.tS.PLACING:this.draggingHandlers.renew();break;case Z.tS.IDLE:this.allowExternalBehaviors(!0)}},this.updateAnchorMesh=()=>{const{openPin:e,pinState:t}=this.viewData;e?t===Z.tS.SELECTED?this.selectedHandlers.renew():[Z.tS.PLACING,Z.tS.PLACED,Z.tS.EDITING].includes(t)&&(this.pinRenderer.showAnchorMesh(e.pinType,e.id,e),this.anchored=!0,this.selectedHandlers.renew()):(this.selectedHandlers.cancel(),this.anchored&&(this.removePinAnchorMesh(),this.pinRenderer.hideSelectedMesh(),this.updateMeshPreviewSphere(!1)))},this.clearLongPressTimeout=()=>{this.longPressStart=0,-1!==this.longPressTimeout&&window.clearTimeout(this.longPressTimeout),this.longPressTimeout=-1},this.placePin=()=>{const e=this.viewData;e.pinState===Z.tS.PLACING&&(e.setPinState(Z.tS.PLACED),this.engine.commandBinder.issueCommand(new R.u(I.C.DEFAULT)),this.engine.commandBinder.issueCommand(new $.ip),this.engine.broadcast(new Q.nY),this.updateMeshPreviewSphere(!1))},this.onDragEvent=e=>{e.buttons!==B.r3.PRIMARY&&(this.touchDevice||this.viewData.openPin)||this.positionPin(e)},this.onDragEnd=e=>{const{openPin:t,creatingNewPin:i}=this.viewData;i&&t&&!this.touchDevice?this.placePin():t&&!i&&(this.engine.commandBinder.issueCommand(new $.I$(t.id,t)),this.updateMeshPreviewSphere(!1))},this.positionPin=(()=>{const e=new s.Pa4;return async t=>{if(this.touchDevice&&t.buttons!==B.r3.PRIMARY)return!1;const i=this.viewData,s=i.pinState;if(s===Z.tS.CREATING)this.engine.commandBinder.issueCommand(new ie.y(!0));else if(s!==Z.tS.PLACING&&!this.movingPin)return!1;const n=i.openPin;if(!n)return!1;this.saveScreenPosition(t.position.x,t.position.y);const o=this.getModelIntersection();if(o&&o.face){this.engine.commandBinder.issueCommand(new R.u(I.C.XHAIR)),i.setCanPlace(!0);const t=(0,C.c)(this.floorsData,o);return null!==t&&(e.copy(n.stemNormal).setLength(n.stemLength),this.updateMeshPreviewSphere(!0,n.anchorPosition),i.updateOpenPin({anchorPosition:n.anchorPosition.copy(o.point),stemNormal:n.stemNormal.copy(o.face.normal).normalize(),floorId:t}),s===Z.tS.CREATING&&i.setPinState(Z.tS.PLACING),!0)}return this.engine.commandBinder.issueCommand(new R.u(I.C.NOPE)),i.setCanPlace(!1),!1}})(),this.allowExternalBehaviors=async e=>{e||this.externalBehaviorsBlocked?e&&this.externalBehaviorsBlocked&&(this.dragInterceptor.cancel(),this.engine.commandBinder.issueCommand(new ee.Lp),this.externalBehaviorsBlocked=!1):(this.dragInterceptor.renew(),this.engine.commandBinder.issueCommand(new ee.ZK),this.externalBehaviorsBlocked=!0)},this.getModelIntersection=()=>{const e=.5*Y.Z.anchor.size;return this.fatcaster.cast(e,F.Nr,O.a.Filter.CENTER_GROUP(e))},this.onPointerButton=e=>{e.down||this.viewData.pinState!==Z.tS.PLACED||(this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new ie.y(!1)))},this.onAnchorSelect=e=>{const t=this.viewData;t.openPin&&e.button===B.MP.PRIMARY&&t.pinState===Z.tS.EDITING&&(e.down?(this.movingPin=!0,this.allowExternalBehaviors(!1),this.draggingHandlers.renew(),this.engine.commandBinder.issueCommand(new R.u(I.C.GRABBING)),this.engine.commandBinder.issueCommand(new ie.y(!0)),this.inAnchorClick=!0):(this.doneMovingPin(),this.inAnchorClick=!1))},this.doneMovingPin=()=>{this.viewData.openPin&&this.movingPin&&(this.draggingHandlers.cancel(),this.engine.commandBinder.issueCommand(new R.u(null)),this.engine.commandBinder.issueCommand(new ie.y(!1)),this.movingPin=!1,this.allowExternalBehaviors(!0),this.updateMeshPreviewSphere(!1))},this.onClickElsewhere=e=>{const{openPin:t,pinState:i}=this.viewData;if(!(i===Z.tS.CREATING&&t||this.inAnchorClick))return t&&(this.movingPin?this.doneMovingPin():this.engine.commandBinder.issueCommand(new $.G3)),!0},this.onLongPressStart=async e=>{if(e.buttons!==B.r3.PRIMARY)return;const t=this.viewData;t.pinState===Z.tS.CREATING&&(this.longPressStart=Date.now(),t.setPinState(Z.tS.PRESSING),this.allowExternalBehaviors(!1),this.saveScreenPosition(e.position.x,e.position.y),this.longPressTimeout=window.setTimeout((async()=>{t.setPinState(Z.tS.PLACING),await this.positionPin(e)||(t.setPinState(Z.tS.CREATING),t.setCanPlace(!1)),this.longPressTimeout=-1}),this.longPressCreateThreshold))},this.onLongPressEnd=()=>{const e=this.viewData.pinState;e===Z.tS.PRESSING?(this.log.debug("Did not press long enough"),this.endPinCreation()):e===Z.tS.PLACING&&this.placePin()},this.onPointerEvent=e=>{const t=this.viewData.pinState;t!==Z.tS.PLACING&&t!==Z.tS.CREATING||this.positionPin(e)},this.onClickToPlacePin=()=>{this.placePin()},this.onKeyEvent=e=>{if(e.state===j.M.PRESSED)switch(e.key){case W.R.ESCAPE:this.viewData.creatingNewPin&&this.engine.commandBinder.issueCommand(new $.tT)}},Promise.all([t.market.waitForData(g.M_),t.market.waitForData(X.i),t.getModule(A.default)]).then((([e,t,i])=>{this.cameraData=e,this.floorsData=t,this.fatcaster=i,this.registerHandlers()}))}dispose(){this.removePinAnchorMesh(),this.updateMeshPreviewSphere(!1),this.dragInterceptor.cancel(),this.creatingHandlers.cancel(),this.draggingHandlers.cancel(),this.selectedHandlers.cancel(),this.bindings.forEach((e=>{e.cancel()}))}update(){const e=this.viewData;if(this.touchDevice&&e.pinState===Z.tS.PRESSING){const t=Math.min(1,(Date.now()-this.longPressStart)/this.longPressCreateThreshold);e.setProgress(t)}}registerHandlers(){const e=this.input;this.bindings.push(this.viewData.onPinStateChanged(this.onPinStateUpdated),this.viewData.onOpenPinChanged(this.onOpenPinChanged),e.registerPriorityHandler(U.er,q.$,this.stopEventPropagation)),this.dragInterceptor=new P.V(e.registerPriorityHandler(H._t,D.S,(()=>!0)),e.registerPriorityHandler(H._t,L.i,(()=>!0))),this.dragInterceptor.cancel(),this.draggingHandlers=new P.V(e.registerUnfilteredHandler(H._t,this.onDragEvent),e.registerUnfilteredHandler(H._R,this.onDragEnd)),this.draggingHandlers.cancel(),this.touchDevice?(this.creatingHandlers=new P.V(e.registerHandler(U.er,this.onPointerButton),e.registerUnfilteredHandler(G.Vh,this.onLongPressStart),e.registerUnfilteredHandler(G.pt,this.onLongPressEnd)),this.selectedHandlers=new P.V(e.registerMeshHandler(U.er,k.s.isType(K.j),this.onAnchorSelect),e.registerPriorityHandler(V.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(V.R,L.i,this.onClickElsewhere))):(this.creatingHandlers=new P.V(e.registerHandler(z.e,this.onKeyEvent),e.registerHandler(U.er,this.onPointerButton),e.registerUnfilteredHandler(V.R,this.onClickToPlacePin),e.registerHandler(U.mE,this.onPointerEvent)),this.selectedHandlers=new P.V(e.registerMeshHandler(U.er,k.s.isType(K.j),this.onAnchorSelect),e.registerPriorityHandler(V.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(V.R,L.i,this.onClickElsewhere))),this.creatingHandlers.cancel(),this.selectedHandlers.cancel()}removePinAnchorMesh(){this.pinRenderer.hideAnchorMesh(),this.anchored=!1}saveScreenPosition(e,t){this.ndcPoint.set(e,t,0);const i=(0,l.fi)(this.cameraData.width,this.cameraData.height,this.ndcPoint);this.viewData.setScreenPosition(i)}}var ne=i(73706),oe=i(1481),re=i(82138),ae=i(1799),le=i(20599),ce=i(48101),he=i(13441),de=i(81047);const ue={pinHead:{uniforms:{alpha:{type:"f",value:1},color:{type:"c",value:new s.Ilk},bg:{type:"t",value:null},mask:{type:"t",value:null}},vertexShader:(0,ce.m)(de,i(23482)),fragmentShader:(0,ce.m)(he,i(43655))},pinStem:{uniforms:{pinHeadMatrix:{value:new s.yGw},resolution:{value:new s.FM8},alpha:{value:1}},vertexShader:(0,ce.m)(de,i(53496)),fragmentShader:(0,ce.m)(he,i(92712))},pinSelected:{vertexShader:(0,ce.m)(de,i(60264)),fragmentShader:(0,ce.m)(he,i(51953))}};var pe=i(82334),me=i(52857);class ge extends s.FIo{constructor(e,t,i,n){const o=s.rDY.clone(ue.pinHead.uniforms);o.bg.value=t,o.mask.value=i,o.color.value.copy(e),o.alpha.value=n,super({fragmentShader:ue.pinHead.fragmentShader,vertexShader:ue.pinHead.vertexShader,uniforms:o,name:"PinHeadMaterial",transparent:!0})}}class fe extends s.FIo{constructor(){const e=s.rDY.clone(ue.pinStem.uniforms);super({fragmentShader:ue.pinStem.fragmentShader,vertexShader:ue.pinStem.vertexShader,uniforms:e,name:"PinStemMaterial",linewidth:Y.Z.stem.width,opacity:Y.Z.stem.opacity,transparent:Y.Z.stem.transparent,alphaTest:Y.Z.stem.opacity*Y.Z.stem.alphaTest})}}class ve extends s.FIo{constructor(){const e=s.rDY.clone(ue.pinStem.uniforms);super({defines:{INSTANCED:!0},fragmentShader:ue.pinStem.fragmentShader,vertexShader:ue.pinStem.vertexShader,uniforms:e,name:"InstancedPinStemMaterial",linewidth:Y.Z.stem.width,opacity:Y.Z.stem.opacity,transparent:Y.Z.stem.transparent,alphaTest:Y.Z.stem.opacity*Y.Z.stem.alphaTest})}}class ye extends s.FIo{constructor(e,t){const i=s.rDY.clone(ue.pinHead.uniforms);i.bg.value=e,i.mask.value=t,super({defines:{INSTANCED:!0},fragmentShader:ue.pinHead.fragmentShader,vertexShader:ue.pinHead.vertexShader,uniforms:i,name:"InstancedPinHeadMaterial",transparent:!0})}}class be extends s.FIo{constructor(e,t){super({defines:{INSTANCED:t},vertexShader:(0,ce.m)(de,pe),fragmentShader:(0,ce.m)(he,me),uniforms:{alpha:{value:1},tDiffuse:{value:e}},name:"InstancedPinHeadCustomMaterial",transparent:!0})}}class we extends s.FIo{constructor(){super({depthTest:!0,depthWrite:!1,transparent:!0,side:s.ehD,vertexShader:ue.pinSelected.vertexShader,fragmentShader:ue.pinSelected.fragmentShader})}}class Se extends s.Kj0{constructor(e){super(new s.BKK(Y.Z.anchor.size,Y.Z.anchor.size),new we),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=le.z.pinSelectedHalo}}class Te{constructor(e,t,i,n){this.input=e,this.layer=t,this.commandBinder=i,this.raycaster=n,this.container=new s.Tme,this.floorIdToContainer=new Map,this.hexColorToColor=new Map,this.bindings=[],this.anchor=null,this.selected=null,this.haloEasing=(0,ae.tf)(.5,.52,0,1.98),this.pinsWithOverrideTexture=new Set,this.updateAnchorPosition=(()=>{const e=new s.Pa4,t=new s.Pa4,i=new s.Pa4;return s=>{const n=this.anchorMesh;if(!n)return;const o=this.raycaster.picking;e.copy(s.stemNormal).normalize(),t.copy(e).multiplyScalar(s.stemLength).add(s.anchorPosition),i.copy(e).multiplyScalar(-1);const r=o.pick(t,i,(e=>e instanceof re.g));if(r){const e=Math.min(s.stemLength,r.distance);n.position.copy(t).add(i.multiplyScalar(.999*e))}else n.position.copy(t).add(i.multiplyScalar(.999*s.stemLength));n.lookAt(t)}})(),this.onAnchorHover=()=>{this.commandBinder.issueCommand(new R.u(I.C.GRAB)),this.commandBinder.issueCommand(new ie.y(!0))},this.onAnchorUnhover=()=>{this.commandBinder.issueCommand(new R.u(null)),this.commandBinder.issueCommand(new ie.y(!1))}}init(){this.container.name="PinContainer",this.container.layers.mask=this.layer.mask,this.anchorMesh=new K.j(this.layer),this.anchorMesh.name="Anchor Mesh",this.container.add(this.anchorMesh),this.selectedMesh=new Se(this.layer),this.selectedMesh.name="Selected Mesh",this.container.add(this.selectedMesh)}dispose(){this.container.parent&&this.container.parent.remove(this.container);for(const e of[this.anchorMesh,this.selectedMesh])e&&e.parent&&e.parent.remove(e)}activate(e){this.bindings.length>0||this.bindings.push(this.input.registerMeshHandler(ne.z,k.s.isType(K.j),this.onAnchorHover),this.input.registerMeshHandler(ne.A,k.s.isType(K.j),this.onAnchorUnhover))}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0}render(e){if(!this.selected)return;const{animation:t,hideWhenDoneAnimating:i}=this.selected,n=this.selectedMesh;if(n&&n.visible&&t){const e=this.pinHeadTransform(this.selected.id),o=new s.Pa4,r=new s._fP,a=new s.Pa4;e.decompose(o,r,a),a.multiplyScalar(t.getUpdatedValue()),i&&!t.isAnimating?(n.visible=!1,this.selected=null):(n.position.copy(o),n.quaternion.copy(r),n.scale.copy(a))}}displayPin(e,t,i,s,n){this.anchorMesh&&this.anchorMesh.visible&&this.anchor&&this.anchor.pinType===t&&this.anchor.id===e&&this.updateAnchorPosition(i)}removePin(e){this.selected&&this.selected.id===e&&this.clearSelected()}removePinsByType(e){this.removePinsByPredicate((t=>t===e))}removePinsByPredicate(e){}setPinVisible(e,t){}setPinColorVariant(e,t){}setPinColorVariants(e,t){}setPinColorVariantByType(e,t,i){}setPinOpacity(e,t){}setPinOpacityByType(e,t,i){}fadePinOpacity(e,t){}fadePinOpacityByType(e,t,i){}setPinRenderOverrides(e,t,i){t?(this.pinsWithOverrideTexture.add(e),this.selected&&this.selected.id===e&&this.clearSelected()):this.pinsWithOverrideTexture.delete(e)}setFloorsHidden(e){this.floorIdToContainer.forEach(((t,i)=>{t.visible=!e(i)}))}setPinTypeVisible(e,t){this.floorIdToContainer.forEach((i=>{i.userData.typeContainers[e].visible=t}))}showAnchorMesh(e,t,i){this.anchor={pinType:e,id:t},this.anchorMesh&&!this.anchorMesh.visible&&(this.anchorMesh.visible=!0,this.input.registerMesh(this.anchorMesh,!1)),this.updateAnchorPosition(i)}hideAnchorMesh(){this.anchorMesh&&this.anchorMesh.visible&&(this.anchorMesh.visible=!1,this.input.unregisterMesh(this.anchorMesh))}showSelectedMesh(e,t){const i=this.selected&&this.selected.pinType===e&&this.selected.id===t;this.selected&&i||this.pinsWithOverrideTexture.has(t)||(this.selected={pinType:e,id:t,hideWhenDoneAnimating:!1,animation:new oe.Z({startValue:10,endValue:14,duration:300,easingFunction:this.haloEasing})},this.selectedMesh.visible=!0)}hideSelectedMesh(){this.selected&&(this.selected.animation=new oe.Z({startValue:14,endValue:10,duration:300}),this.selected.hideWhenDoneAnimating=!0)}getFloorContainer(e){let t=this.floorIdToContainer.get(e);if(t)return t;t=new s.Tme,t.name="Floor "+e,t.userData.typeContainers={},t.layers.mask=this.layer.mask;for(const e of Object.values(Z.Er)){const i=new s.Tme;i.name=e,i.layers.mask=this.layer.mask,t.add(i),t.userData.typeContainers[e]=i}return this.container.add(t),this.floorIdToContainer.set(e,t),t.userData.floorId=e,t}getColor(e){let t=this.hexColorToColor.get(e);if(t)return t;const i=new s.Ilk(e),n={h:0,s:0,l:0};return i.getHSL(n),t={baseColor:i,hoverColor:(new s.Ilk).setHSL(n.h,n.s,.8*n.l),dimmedColor:(new s.Ilk).setHSL(n.h,.5*n.s,n.l)},this.hexColorToColor.set(e,t),t}getViewportScale(e){return Math.sqrt(Math.min(e.width,e.height)/Y.Z.pinHeadMesh.scale.baseViewportSize)}clearSelected(){this.selectedMesh.visible=!1,this.selected=null}}class Ee extends s.x12{constructor(e,t,i,n,o){const r=new s.u9r,a=new Float32Array(6);a[0]=a[1]=a[2]=0,a[3]=e.x,a[4]=e.y,a[5]=e.z,r.setAttribute("position",new s.TlE(a,3));const l=new fe;super(r,l),this.geometry=r,this.layers.mask=i.mask,this.visible=t,this.vector=e.clone(),this.onBeforeRender=(e,t,i,s,r)=>{const a=r;a.uniforms.pinHeadMatrix.value.copy(n.matrixWorld),a.uniforms.resolution.value.set(o.width,o.height),a.uniformsNeedUpdate=!0},this.pinStemMaterial=l}dispose(){this.geometry.dispose()}updatePosition(e){this.vector.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01));const t=this.geometry.getAttribute("position");t.setXYZ(1,this.vector.x,this.vector.y,this.vector.z),t.needsUpdate=!0}}function _e(e,t){switch(t){case Z.K_.DEFAULT:return e.baseColor;case Z.K_.DIMMED:return e.dimmedColor;case Z.K_.HIGHLIGHTED:return e.hoverColor}}var xe=i(290);class Me extends s.Tme{constructor(e,t,i,n,o,r,a,l){super(),this.pinId=e,this.pinType=t,this.pinColor=n,this.stemVector=new s.Pa4,this.stemEnabled=!0,this.currentColorVariant=Z.K_.DEFAULT,this.baseOpacity=1,Me.pinHeadGeometry||(Me.pinHeadGeometry=new s.BKK(Y.l,Y.l));const c=(new s.Ilk).copy(n.baseColor);this.pinHeadMeshMaterial=new ge(c,a,l,1),this.pinHeadMesh=new q.$(e,Me.pinHeadGeometry,this.pinHeadMeshMaterial,o),this.add(this.pinHeadMesh),this.stemMesh=new Ee(i.stemNormal,i.stemEnabled,o,this.pinHeadMesh,r),this.add(this.stemMesh),this.updateMeshPosition(i),this.opacityAnimation=new xe.z(1)}dispose(){this.remove(this.pinHeadMesh),this.pinHeadMesh.material.dispose(),this.pinHeadMesh.dispose(),this.remove(this.stemMesh),this.stemMesh.dispose()}static disposeAll(){Me.pinHeadGeometry.dispose()}updateFromPin(e,t,i,s){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemVector.copy(e.stemNormal).setLength(e.stemLength),this.stemEnabled=e.stemEnabled,this.stemMesh.updatePosition(e),this.stemMesh.visible=e.stemEnabled,t!==this.pinColor&&(this.pinColor=t,this.setColorVariant(this.currentColorVariant));const n=this.pinHeadMeshMaterial.uniforms;n.bg.value===i&&n.mask.value===s||(n.bg.value=i,n.mask.value=s,this.pinHeadMeshMaterial.uniformsNeedUpdate=!0)}setColorVariant(e){const t=_e(this.pinColor,e);this.pinHeadMeshMaterial.uniforms.color.value.copy(t),this.currentColorVariant=e}setOpacity(e){this.baseOpacity=e,this.updateOpacity()}fadeOpacity(e){this.opacityAnimation.modifyAnimation(this.opacityAnimation.value,e,300)}setVisibility(e,t){this.visible=e,this.pinHeadMesh.visible=e,this.stemMesh.visible=e&&t}setStemEnabled(e){this.stemMesh.visible=this.visible&&e}updateMeshPosition(e){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemMesh.updatePosition(e)}update(e,t,i,s){this.pinHeadMesh.update(t,i,s);const n=this.opacityAnimation.active;this.opacityAnimation.tick(e),n&&this.updateOpacity()}setRenderOverrides(e,t){this.pinHeadMesh.material=e?new be(e,!1):this.pinHeadMeshMaterial,t?this.pinHeadMesh.geomScale.copy(t):this.pinHeadMesh.geomScale.set(1,1,1),this.setOpacity(this.pinHeadMeshMaterial.opacity)}updateOpacity(){const e=this.opacityAnimation.value*this.baseOpacity;if(this.pinHeadMeshMaterial.opacity=e,this.pinHeadMeshMaterial.uniforms.alpha.value=e,this.pinHeadMesh.material!==this.pinHeadMeshMaterial){this.pinHeadMesh.material.opacity=e;const t=this.pinHeadMesh.material;t&&t.uniforms&&t.uniforms.alpha&&(t.uniforms.alpha.value=e)}this.stemMesh.pinStemMaterial.uniforms.alpha.value=e}}class Pe extends Te{constructor(e,t,i,s,n,o){super(e,s,n,o),this.camera=t,this.canvasData=i,this.idToMesh=new Map}dispose(){super.dispose(),this.removePinsByPredicate((()=>!0)),Me.disposeAll()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(V.R,q.$,((t,i)=>{const s=i.parent;return e.broadcast(new Q.F7(s.pinId,s.pinType)),!0}))),(0,h.Jm)()||(this.bindings.push(this.input.registerMeshHandler(ne.z,k.s.isType(q.$),((t,i)=>{const s=i.parent;e.broadcast(new Q.tP(s.pinId,!0,s.pinType)),e.commandBinder.issueCommand(new R.u(I.C.FINGER)),e.commandBinder.issueCommand(new ie.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(ne.A,k.s.isType(q.$),((t,i)=>{const s=i.parent;e.broadcast(new Q.tP(s.pinId,!1,s.pinType)),e.commandBinder.issueCommand(new R.u(null)),e.commandBinder.issueCommand(new ie.y(!1))})))))}render(e){const t=this.getViewportScale(this.canvasData);this.idToMesh.forEach((i=>{i.update(e,this.camera,t,this.canvasData)})),super.render(e)}displayPin(e,t,i,s,n){var o,r;super.displayPin(e,t,i,s,n);const a=this.getColor(i.color);let l=this.idToMesh.get(e);l||(l=new Me(e,t,i,a,this.layer,this.canvasData,s,n),this.idToMesh.set(e,l),this.input.registerMesh(l.pinHeadMesh,!1)),l.updateFromPin(i,a,s,n);const c=i.floorId;l.parent&&(null===(o=l.parent)||void 0===o?void 0:o.userData.floorId)===c||(l.parent&&(null===(r=l.parent)||void 0===r||r.remove(l)),this.getFloorContainer(c).userData.typeContainers[t].add(l))}removePin(e){var t;super.removePin(e);const i=this.idToMesh.get(e);i&&(this.idToMesh.delete(e),null===(t=i.parent)||void 0===t||t.remove(i),this.input.unregisterMesh(i.pinHeadMesh),i.dispose())}removePinsByPredicate(e){this.idToMesh.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToMesh.get(e);i&&(i.visible=t)}setPinColorVariant(e,t){const i=this.idToMesh.get(e);i&&i.setColorVariant(t)}setPinColorVariants(e,t){this.idToMesh.forEach((i=>{i.pinId!==t&&i.setColorVariant(e)}))}setPinColorVariantByType(e,t,i){this.idToMesh.forEach((s=>{s.pinType===e&&s.pinId!==i&&s.setColorVariant(t)}))}setPinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.setOpacity(t)}fadePinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.fadeOpacity(t)}setPinOpacityByType(e,t,i){this.idToMesh.forEach((s=>{s.pinType===e&&s.pinId!==i&&s.setOpacity(t)}))}fadePinOpacityByType(e,t,i){this.idToMesh.forEach((s=>{s.pinType===e&&s.pinId!==i&&s.fadeOpacity(t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const s=this.idToMesh.get(e);s&&s.setRenderOverrides(t,i)}pinHeadTransform(e){const t=this.idToMesh.get(e);return t?t.pinHeadMesh.matrixWorld:new s.yGw}}var Ae=i(45805),Oe=i(27829);const De=new N.Z("InstancedPinHeads");class Ie extends s.SPe{constructor(e,t,i,n){const o=new s.BKK(Y.l,Y.l),r=new Float32Array(e),a=new s.lb7(r,1);o.setAttribute("instanceAlpha",a),super(o,n&&i?new ye(t,i):new be(t,!0),e),this.maxCount=e,this.opacityArray=r,this.opacityAttrib=a,this.setColorAt(0,new s.Ilk),this.renderedPins=[],this.renderOrder=le.z.pins}update(e){let t=0;this.renderedPins.length=0;for(const i of e)i.visible&&(t>=this.maxCount?De.error("Instance count is too small!"):(this.setMatrixAt(t,i.pinHeadMatrix),this.setColorAt(t,i.pinColor),this.opacityArray[t]=i.opacity*i.opacityAnimation.value,t++,this.renderedPins.push(i)));this.count=t,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0,this.instanceColor?this.instanceColor.needsUpdate=!0:De.error("Instance color should be defined")}}const Ce=new ve,Re=new N.Z("InstancedPinHeads");class Le extends s.SPe{constructor(e){const t=new s.u9r,i=new Float32Array(6);i[0]=i[1]=i[2]=0,i[3]=1,i[4]=1,i[5]=1,t.setAttribute("position",new s.TlE(i,3));const n=new Float32Array(3*e),o=new s.lb7(n,3);t.setAttribute("stemVector",o);const r=new Float32Array(e),a=new s.lb7(r,1);t.setAttribute("instanceAlpha",a);const l=[],c=[];for(let i=0;i<4;i++){const n=new Float32Array(4*e),o=new s.lb7(n,4);t.setAttribute(`pinHeadMatrixCol${i}`,o),l.push(n),c.push(o)}super(t,Ce,e),this.maxCount=e,this.stemVectorArray=n,this.stemVectorAttrib=o,this.pinHeadMatrixArray=l,this.pinHeadMatrixAttrib=c,this.opacityArray=r,this.opacityAttrib=a,this.renderOrder=le.z.lines,this.posMatrix=new s.yGw,this.isLine=!0,this.isMesh=!1}update(e,t){let i=0;for(const t of e){if(!t.visible||!t.stemEnabled||t.stemLength<.001)continue;if(i>=this.maxCount){Re.error("Instance count is too small!");continue}this.posMatrix.setPosition(t.anchorPosition),this.setMatrixAt(i,this.posMatrix),this.opacityArray[i]=t.opacity*t.opacityAnimation.value;const e=3*i;t.pinHeadObjPosition.toArray(this.stemVectorArray,e);let s=0;for(let e=0;e<4;e++)for(let n=0;n<4;n++)this.pinHeadMatrixArray[e][n+4*i]=t.pinHeadMatrix.elements[s++];i++}this.count=i,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.stemVectorAttrib.needsUpdate=!0;for(const e of this.pinHeadMatrixAttrib)e.needsUpdate=!0;this.opacityAttrib.needsUpdate=!0,Ce.uniforms.resolution.value.set(t.width,t.height),Ce.uniformsNeedUpdate=!0}}const Ne=new N.Z("InstancedPinRenderer");class ke extends Te{constructor(e,t,i,n,o,r){super(e,n,o,r),this.camera=t,this.canvasData=i,this.pins=new Map,this.idToPin=new Map,this.keyToRenderObjs=new Map,this.updatePinHeadMatrix=(()=>{const e=new s.Pa4,t=new s.Pa4,i=new s.Pa4,n=new s.Pa4,o=new s.Pa4,r=new s.Pa4,a=new s.Pa4;return l=>{const c=Y.Z.pinHeadMesh.scale,h=this.getViewportScale(this.canvasData),d=1+c.responsiveness/100*(h-1);this.camera.getWorldPosition(r);const u=this.camera.quaternion,p=this.canvasData;for(const h of l){a.copy(h.pinHeadObjPosition).add(h.anchorPosition);const l=r.distanceTo(a),m=c.maxSize-(c.maxSize-c.minSize)*s.M8C.smoothstep(l,c.nearBound,c.farBound);t.copy(a).project(this.camera),i.set(p.width/2,p.height/2,1).multiply(t),n.set(m/2,0,0).add(i),o.set(2/p.width,2/p.height,1).multiply(n);const g=o.unproject(this.camera).distanceTo(a)*d,f=s.M8C.clamp(g,Ae.Z.epsilon,g),v=h.geomScale||Oe.f.UNIT;e.set(f*v.x,f*v.y,f*v.z),h.pinHeadMatrix.compose(a,u,e)}}})()}dispose(){super.dispose()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(V.R,Ie,((t,i,s)=>{if(!s||void 0===s.instanceId)return!0;const n=i.renderedPins[s.instanceId];return e.broadcast(new Q.F7(n.id,n.pinType)),!0}))),(0,h.Jm)()||(this.bindings.push(this.input.registerMeshHandler(ne.z,k.s.isType(Ie),((t,i,s)=>{if(!s||void 0===s.instanceId)return;const n=i.renderedPins[s.instanceId];this.lastHoverId=n.id,this.lastHoverType=n.pinType,e.broadcast(new Q.tP(n.id,!0,n.pinType)),e.commandBinder.issueCommand(new R.u(I.C.FINGER)),e.commandBinder.issueCommand(new ie.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(ne.A,k.s.isType(Ie),(()=>{e.broadcast(new Q.tP(this.lastHoverId,!1,this.lastHoverType)),e.commandBinder.issueCommand(new R.u(null)),e.commandBinder.issueCommand(new ie.y(!1))})))))}render(e){for(const t of this.pins.values()){const i=Array.from(t.values());if(0===i.length)continue;const s=this.keyFromPin(i[0]),n=this.keyToRenderObjs.get(s);if(!n){Ne.error("Expecting renderObjs for this key.",this.keyToRenderObjs,this.keyFromPin(i[0]));continue}let{lines:o,pinHeads:r}=n;if(i.forEach((t=>t.opacityAnimation.tick(e))),this.updatePinHeadMatrix(i),o.maxCount<i.length){const e=o.parent;if(!e){Ne.error("Expecting a parent.");continue}e.remove(o),o.dispose(),e.remove(r),this.input.unregisterMesh(r);const{backgroundTexture:t,maskTexture:s,overrideTexture:a}=i[0];r.dispose(),Object.assign(n,this.createInstances(e,n.id,i.length+16,t,s,a)),o=n.lines,r=n.pinHeads}o.update(i,this.canvasData),r.update(i)}super.render(e)}displayPin(e,t,i,n,o){var r;super.displayPin(e,t,i,n,o);let a=this.idToPin.get(e);const l=i.floorId,c=this.getColor(i.color).baseColor,h=`${l}_${t}_${(null===(r=null==a?void 0:a.overrideTexture)||void 0===r?void 0:r.uuid)||n.uuid}`;if(!a){a=Object.assign(Object.assign({id:e},i),{visible:!0,opacity:1,pinType:t,opacityAnimation:new xe.z(1),backgroundTexture:n,maskTexture:o,pinHeadMatrix:new s.yGw,pinHeadObjPosition:new s.Pa4,pinColor:c,colorVariant:Z.K_.DEFAULT,overrideTexture:null,geomScale:null}),this.idToPin.set(e,a);let r=this.pins.get(h);r||(r=new Map,this.pins.set(h,r)),r.set(e,a),this.createRenderObjsForPin(a)}const d=this.keyFromPin(a);Object.assign(a,i,{pinType:t,textureId:n.uuid}),this.changePinHeadGroupIfNeeded(d,h,a),a.pinHeadObjPosition.copy(a.stemNormal).setLength(a.stemLength),a.pinColor=_e(this.getColor(a.color),a.colorVariant)}removePin(e){super.removePin(e);const t=this.idToPin.get(e);if(!t)return;this.idToPin.delete(e);const i=this.keyFromPin(t),s=this.pins.get(i);s&&(s.delete(e),this.cleanupRenderObjIfNeeded(i))}removePinsByPredicate(e){this.idToPin.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToPin.get(e);i?i.visible=t:Ne.error("setPinVisible on a pin that doesn't exist.",e)}setPinColorVariant(e,t){const i=this.idToPin.get(e);i?(i.colorVariant=t,i.pinColor=_e(this.getColor(i.color),t)):Ne.error("setPinColorVariant on a pin that doesn't exist.")}setPinColorVariants(e,t){this.idToPin.forEach(((i,s)=>{s!==t&&this.setPinColorVariant(s,e)}))}setPinColorVariantByType(e,t,i){this.idToPin.forEach(((s,n)=>{s.pinType===e&&n!==i&&this.setPinColorVariant(n,t)}))}setPinOpacity(e,t){const i=this.idToPin.get(e);i?i.opacity=t:Ne.error("setPinOpacity on a pin that doesn't exist.")}fadePinOpacity(e,t){const i=this.idToPin.get(e);i?(t>0&&this.setPinVisible(e,!0),i.opacityAnimation.modifyAnimation(i.opacityAnimation.value,t,300).onComplete((()=>{t<=0&&this.setPinVisible(e,!1)}))):Ne.error("setPinVisible on a pin that doesn't exist.",e)}setPinOpacityByType(e,t,i){this.idToPin.forEach(((s,n)=>{s.pinType===e&&n!==i&&this.setPinOpacity(n,t)}))}fadePinOpacityByType(e,t,i){this.idToPin.forEach(((s,n)=>{s.pinType===e&&n!==i&&this.fadePinOpacity(n,t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const s=this.idToPin.get(e);if(!s)return void Ne.error("setPinRenderOverrides on a pin that doesn't exist.");const n=this.keyFromPin(s);if(!this.keyToRenderObjs.get(n))return void Ne.error("Expecting renderObjs while setting override material");s.overrideTexture=t,s.geomScale=i;const o=this.keyFromPin(s);this.changePinHeadGroupIfNeeded(n,o,s)}pinHeadTransform(e){const t=this.idToPin.get(e);return t?t.pinHeadMatrix:(Ne.error("pinHeadTransform on a pin that doesn't exist."),new s.yGw)}keyFromPin(e){return`${e.floorId}_${e.pinType}_${e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid}`}createRenderObjsForPin(e){const{backgroundTexture:t,maskTexture:i,overrideTexture:s}=e,n=this.keyFromPin(e);if(this.keyToRenderObjs.get(n))return;const o=this.getFloorContainer(e.floorId).userData.typeContainers[e.pinType];o.userData||(o.userData={});const r=e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid;if(!o.userData[r]){const e=this.createInstances(o,r,16,t,i,s);o.userData[r]=e,this.keyToRenderObjs.set(n,e)}}createInstances(e,t,i,s,n,o){const r=new Le(i);r.layers.mask=this.layer.mask,e.add(r);const a=new Ie(i,o||s,o?null:n,!o);return a.layers.mask=this.layer.mask,e.add(a),this.input.registerMesh(a,!1),{lines:r,pinHeads:a,id:t}}changePinHeadGroupIfNeeded(e,t,i){if(e!==t){let s=this.pins.get(t);s||(s=new Map,this.pins.set(t,s)),s.set(i.id,i),this.createRenderObjsForPin(i);const n=this.pins.get(e);n&&(null==n||n.delete(i.id),this.cleanupRenderObjIfNeeded(e))}}cleanupRenderObjIfNeeded(e){const t=this.pins.get(e),i=this.keyToRenderObjs.get(e);if(t&&0===t.size&&i){const t=i.lines.parent;if(this.input.unregisterMesh(i.pinHeads),this.pins.delete(e),this.keyToRenderObjs.delete(e),!t)return void Ne.error("Expecting pinTypeObj!");t.userData[i.id]=void 0,t.remove(i.lines),t.remove(i.pinHeads)}}}class Fe extends n.Y{constructor(){super(...arguments),this.name="pins",this.editActivated=!1,this.editBindings=[],this.touchDevice=(0,h.Jm)(),this.worldPosition=new s.Pa4,this.visibilityChanged=()=>{const e=!this.in360View(),t=!this.interactionmodeData.isVR();this.pinRenderer.container.visible=e&&t;const{floorsViewData:i}=this,s=this.viewmode===y.Ey.Dollhouse||this.viewmode===y.Ey.Floorplan,n=i.floorSelectModeActive||i.transition.progress.active?()=>!0:i.isHidden;this.pinRenderer.setFloorsHidden(s?n:()=>!1)},this.viewmodeChanged=e=>{this.viewmode=e.toMode,this.visibilityChanged()},this.onEnablePinEditing=async e=>{e.enabled?this.enableEditing():this.disableEditing()},this.applicationChanged=e=>{this.pinEditor&&(e.application,d.Mx.WORKSHOP)},this.updateRenderedPin=()=>{const{pinState:e,creatingNewPin:t,openPin:i,previewPin:s}=this.viewData;if(!t||[Z.tS.PLACING,Z.tS.PLACED].includes(e)){this.editActivated&&this.pinEditor.updateAnchorMesh();const e=s||i;if(e){const{id:t,pinType:i,backgroundTexture:s,maskTexture:n}=e;this.pinRenderer.displayPin(t,i,e,s,n),this.pinRenderer.setPinColorVariant(t,Z.K_.HIGHLIGHTED),this.pinRenderer.setPinColorVariants(Z.K_.DEFAULT,t)}else this.pinRenderer.setPinColorVariants(Z.K_.DEFAULT)}},this.onPinUpdated=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});this.viewData.updateOpenPin(t),this.saveScreenPosition(t)},this.onPinSelected=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType}),i=this.viewData;i.setPinState(Z.tS.SELECTED),i.setOpenPin(t),this.saveScreenPosition(t)},this.onPinClosed=e=>{const{pinType:t,id:i}=e,{openPin:s,previewPin:n}=this.viewData,o=i===(null==s?void 0:s.id)?s:i===(null==n?void 0:n.id)?n:null;o&&o.pinType===t&&o.id===i&&(this.resetState(),o.id===(null==s?void 0:s.id)?this.viewData.setOpenPin(null):o.id===(null==n?void 0:n.id)&&this.viewData.setPreviewPin(null))},this.onPinOpened=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(e.editable),t.setPinState(e.editable?Z.tS.EDITING:Z.tS.OPEN),t.setOpenPin(i),this.saveScreenPosition(i)},this.onStartPinCreation=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(!0),t.setPinState(Z.tS.CREATING),t.setOpenPin(i),this.pinEditor.startPinCreation()},this.onPreviewPinAnnotation=async e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.pinState===Z.tS.SELECTED&&t.setOpenPin(null),t.setPinState(Z.tS.PREVIEWING),t.setPreviewPin(i),this.saveScreenPosition(i)},this.onOpenPin=async e=>{(e.pinType!==Z.Er.MATTERTAG||this.tagsEnabled)&&this.openPin(e.id,e.pinType,e.transition,e.attachmentId,e.listIndex,e.editText)},this.onSelectPin=async e=>{(e.pinType!==Z.Er.MATTERTAG||this.tagsEnabled)&&this.selectPin(e.id,e.pinType,e.transition)},this.onPreviewStemLength=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&t&&t.id===e.id?this.viewData.updateOpenPin({stemLength:e.stemLength}):this.log.debug("Cannot preview stem length, not open for edit")},this.saveScreenPosition=(()=>{const e=new s.Pa4;return t=>{const i=this.viewData;e.copy(t.stemNormal).setLength(t.stemLength),this.worldPosition.copy(t.anchorPosition).add(e);const s=(0,l.q9)(this.cameraData,this.worldPosition);i.setScreenPosition(s.screenPosition)}})(),this.onCameraUpdate=()=>{const{creatingNewPin:e,previewPin:t,openPin:i}=this.viewData;!e&&t?this.saveScreenPosition(t):i&&this.saveScreenPosition(i)},this.onAssetOpened=e=>{this.viewData.setPreviewPin(null)},this.onToolToggled=e=>{e.open||this.resetState()},this.handleSweepChange=()=>this.handleSweepAndViewModeChange(),this.handleViewModeChange=()=>this.handleSweepAndViewModeChange(),this.cancelAndReset=()=>{const{creatingNewPin:e,openPin:t}=this.viewData;e&&t&&(this.pinRenderer.removePin(t.id),this.engine.broadcast(new Q.hu(t.id,t.pinType))),this.resetState(),this.viewData.setOpenPin(null)},this.resetState=()=>{const e=this.viewData;e.setEditablePin(!1),e.setCanPlace(!0),e.setScreenPosition(null),e.setPinState(Z.tS.IDLE),e.setCanAdd(!this.in360View()),this.pinRenderer.hideSelectedMesh()},this.cancelPinCreation=async()=>{this.cancelAndReset()},this.onPinClicked=e=>{const{pinType:t,id:i}=e;if(t!==Z.Er.MATTERTAG||this.tagsEnabled)if(t===Z.Er.MATTERTAG)this.selectPin(i,t,c.n.Interpolate);else{const{openPin:e}=this.viewData,s=i===(null==e?void 0:e.id)&&t===(null==e?void 0:e.pinType);e&&this.deselectPin(e),s||this.openPin(i,t,c.n.Interpolate)}},this.onHoverChanged=e=>{const{pinType:t,id:i,hovering:s}=e;if(t===Z.Er.MATTERTAG&&!this.tagsEnabled)return;const{creatingNewPin:n,pinState:o,previewPin:r,openPin:a}=this.viewData;if(!n)if(s){if(a){if(a.id===i&&a.pinType===t)return;o===Z.tS.SELECTED&&(this.viewData.setOpenPin(null),this.pinRenderer.hideSelectedMesh())}t===Z.Er.MATTERTAG?this.engine.commandBinder.issueCommand(new _.X8(i)):t===Z.Er.NOTE&&this.engine.commandBinder.issueCommand(new x.yC(i)),this.pinRenderer.setPinColorVariantByType(t,Z.K_.DEFAULT,null==r?void 0:r.id),this.pinRenderer.setPinColorVariant(i,Z.K_.HIGHLIGHTED)}else{const e=o===Z.tS.PREVIEWING;r&&e&&(this.pinRenderer.setPinColorVariant(r.id,Z.K_.DEFAULT),this.viewData.setPreviewPin(null))}},this.clickOffPin=async()=>{const{openPin:e}=this.viewData;e&&this.deselectPin(e)},this.movePin=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&(t&&t.id===e.id?(this.viewData.updateOpenPin(e.pos),this.engine.broadcast(new Q.bV(t.id,t.pinType,e.pos))):this.log.debug("Cannot move the pin, not open for edit"))},this.placePin=async e=>{const{openPin:t,isPinEditable:i,canPlace:s}=this.viewData;i&&(t&&s?(this.viewData.setPinState(Z.tS.EDITING),this.engine.broadcast(new Q.b0(t.id,t.pinType))):(this.log.debug("Cannot place pin because there is no open pin"),this.cancelAndReset()))}}async init(e,t){this.engine=t,this.tagsEnabled=e.newTagsEnabled;const[i,s,n,l,c]=await Promise.all([t.getModule(o.default),t.getModule(a.default),t.market.waitForData(u.W),t.market.waitForData(d.pu),t.getModule(r.default)]);this.input=i;const h=t.claimRenderLayer(this.name);this.pinRenderer=s.supportsInstancing()?new ke(i,s.getCamera(),n,h,t.commandBinder,c):new Pe(i,s.getCamera(),n,h,t.commandBinder,c),s.getScene().add(this.pinRenderer.container),t.addComponent(this,this.pinRenderer),[this.floorsViewData,this.viewmodeData,this.interactionmodeData,this.sweepData,this.cameraData]=await Promise.all([t.market.waitForData(p.c),t.market.waitForData(v.O),t.market.waitForData(m.Z),t.market.waitForData(f.Z),t.market.waitForData(g.M_)]),this.viewData=new M.B,this.pinEditor=new se(this.viewData,this.engine,this.input,this.pinRenderer),this.floorsViewData.iterate((e=>this.pinRenderer.getFloorContainer(e.id))),this.viewmode=this.viewmodeData.currentMode,this.bindings.push(t.commandBinder.addBinding($.EP,this.onEnablePinEditing),t.commandBinder.addBinding($.$b,this.onOpenPin),t.commandBinder.addBinding($.Ar,this.onSelectPin),t.commandBinder.addBinding($.G3,this.clickOffPin),this.interactionmodeData.onChanged(this.visibilityChanged),this.floorsViewData.onChanged(this.visibilityChanged),this.viewmodeData.makeModeChangeSubscription(this.visibilityChanged),t.subscribe(b.Z,this.visibilityChanged),t.subscribe(S.a,this.viewmodeChanged),t.subscribe(w.Z,this.viewmodeChanged),t.subscribe(Q.F7,this.onPinClicked),t.subscribe(Q.sD,this.onPinOpened),t.subscribe(Q.Q4,this.onPinSelected),t.subscribe(Q.KR,this.onPinUpdated),t.subscribe(Q.A,this.onPinClosed),t.subscribe(E.ZL,this.onAssetOpened),t.subscribe(E.Oj,this.onToolToggled),t.subscribe(T.bS,this.applicationChanged),this.viewData.onPinStateChanged(this.updateRenderedPin),this.viewData.onOpenPinChanged(this.updateRenderedPin),this.viewData.onPreviewPinChanged(this.updateRenderedPin)),this.touchDevice||this.bindings.push(t.commandBinder.addBinding($._l,this.onPreviewPinAnnotation),t.subscribe(Q.tP,this.onHoverChanged),this.cameraData.onChanged(this.onCameraUpdate));let y=l.application;this.bindings.push(l.onPropertyChanged("application",(e=>{e!==y&&(this.visibilityChanged(),y=e)}))),this.visibilityChanged(),t.market.register(this,M.B,this.viewData)}dispose(e){this.disableEditing(),this.viewData.setPinState(Z.tS.IDLE),this.pinEditor.dispose(),this.pinRenderer.dispose(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.editBindings=[],super.dispose(e)}onUpdate(){this.pinEditor.update()}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}enableEditing(){if(!this.editActivated){if(0===this.editBindings.length){const e=this.engine,t=e.commandBinder;this.editBindings.push(e.subscribe(Q.nO,this.onStartPinCreation),e.subscribe(Q.w0,this.cancelAndReset),t.addBinding($.fe,this.onPreviewStemLength),t.addBinding($.ip,this.placePin),t.addBinding($.tT,this.cancelPinCreation),t.addBinding($.I$,this.movePin),this.sweepData.makeSweepChangeSubscription(this.handleSweepChange),e.subscribe(w.Z,this.handleViewModeChange))}else this.editBindings.forEach((e=>{e.renew()}));this.handleSweepAndViewModeChange(),this.editActivated=!0}}disableEditing(){this.editActivated&&(this.cancelAndReset(),this.viewData.setPinState(Z.tS.IDLE),this.editBindings.forEach((e=>{e.cancel()})),this.editActivated=!1)}handleSweepAndViewModeChange(){const e=this.viewData,t=!this.in360View();e.creatingNewPin&&!t?this.cancelAndReset():e.setCanAdd(t)}selectPin(e,t,i){if(t===Z.Er.MATTERTAG){const{openPin:s}=this.viewData;e===(null==s?void 0:s.id)&&t===(null==s?void 0:s.pinType)||this.engine.commandBinder.issueCommand(new _.YC(e,i||void 0))}}openPin(e,t,i,s,n=-1,o=!1){t===Z.Er.NOTE?this.engine.commandBinder.issueCommand(new x.dR(e,i,s,n,o)):t===Z.Er.MATTERTAG&&this.engine.commandBinder.issueCommand(new _.lt(e,i,s,n))}deselectPin(e){this.engine.broadcast(new Q.Fe(e.id,e.pinType))}}const Be=Fe},43770:(e,t,i)=>{"use strict";i.d(t,{tP:()=>n,F7:()=>o,b0:()=>r,bV:()=>a,Fe:()=>l,hu:()=>c,w0:()=>h,nO:()=>d,sD:()=>u,Q4:()=>p,KR:()=>m,A:()=>g,nY:()=>f});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.id=e,this.hovering=t,this.pinType=i}}class o extends s.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class r extends s.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class a extends s.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class l extends s.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class c extends s.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class h extends s.v{constructor(e){super(),this.pinType=e}}class d extends s.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class u extends s.v{constructor(e,t,i){super(),this.pin=e,this.pinType=t,this.editable=i}}class p extends s.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class m extends s.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class g extends s.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class f extends s.v{}},90666:(e,t,i)=>{"use strict";i.d(t,{l:()=>s,Z:()=>n});const s=1,n=Object.freeze({anchor:{size:.1},stem:{length:.23,width:1,opacity:1,transparent:!0,color:"white",alphaTest:.05},pinHeadMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}}})},50004:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var s,n=i(54122),o=i(77956),r=i(13453),a=i(96640),l=i(62367);!function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.Rendering=2]="Rendering",e[e.Rendered=3]="Rendered"}(s||(s={}));class c{constructor(e){this.statusMap={},this.active=[],this.queued=[],this.panoRenderer=e,this.disablePreRendering()}init(){}dispose(){}activate(e){}deactivate(e){this.disablePreRendering()}enablePreRendering(){this.enabled=!0}disablePreRendering(){this.enabled=!1}render(){}beforeRender(){this.enabled&&this.processQueued()}tryPreRender(e){return this.getPreRenderState(e)===s.None&&(this.queued.push(e),this.statusMap[e]=s.Queued,!0)}getPreRenderState(e){const t=this.statusMap[e];return void 0!==t?t:s.None}processQueued(){let e=0;for(const t of Object.keys(this.statusMap))this.statusMap[t]===s.Rendering&&e++;if(0===e&&this.queued.length>0){const e=this.queued.shift();e&&(this.active.push(e),this.statusMap[e]=s.Rendering,this.panoRenderer.activateSweep(e).then((()=>{this.onRendered(e)})))}}cleanup(e=[]){const t=(0,l.ow)(e),i=[];for(const e of this.queued)t[e]?i.push(e):this.statusMap[e]=s.None;this.queued.length=0,this.queued.push.apply(this.queued,i);const n=[];for(const e of this.active)t[e]?n.push(e):this.statusMap[e]=s.None;this.active.length=0,this.active.push.apply(this.active,n)}onRendered(e){this.statusMap[e]=s.Rendered}}var h=i(21265);const d=Object.freeze({prerender:{preRenderTourPanos:h.hu("pre",1)}});var u=i(60463);class p extends n.Y{constructor(){super(...arguments),this.name="prerenderer-module",this.lastPrerendered=null}async init(e,t){if(d.prerender.preRenderTourPanos||e.preRenderTourPanos){this.sweepData=await t.market.waitForData(o.Z);const e=await t.getModuleByParent(u.Z);this.panoRenderer=e.getRenderer(),this.preRenderer=new c(this.panoRenderer),t.addComponent(this,this.preRenderer),this.bindings.push(t.subscribe(r.Z,(e=>{this.preRenderer.enablePreRendering(),this.lastPrerendered=null,e.sweepIds&&e.sweepIds.length>=3&&(this.lastPrerendered=e.sweepIds[2],this.preRenderer.tryPreRender(this.lastPrerendered)),this.cleanup(this.sweepData),this.currentRestrictedSweeps=e.sweepIds}))),this.bindings.push(t.subscribe(a.Z,(e=>{this.preRenderer.disablePreRendering(),this.cleanup(this.sweepData,!0),this.currentRestrictedSweeps=null})))}}getCurrentSweeps(){return this.currentRestrictedSweeps||[]}cleanup(e,t=!1){const i=[];e.transition.active?(e.transition.from&&i.push(e.transition.from),e.transition.to&&i.push(e.transition.to)):e.currentSweep&&i.push(e.currentSweep),this.lastPrerendered&&i.push(this.lastPrerendered),t&&this.panoRenderer.freeAllTextures(i),this.preRenderer.cleanup(i)}}},24135:(e,t,i)=>{"use strict";i.d(t,{P:()=>o,E:()=>r});var s=i(2212),n=i(19413);class o extends n.V{constructor(){super(...arguments),this.name="pointer",this.hit=null,this.hits=[],this.pointerNdcPosition=new s.FM8,this.pointerScreenPosition=new s.FM8,this.pointerOrigin=new s.Pa4,this.pointerDirection=new s.Pa4,this.pointerRay=new s.zHn}}class r{constructor(e,t,i,s){this.point=e,this.normal=t,this.object=i,this.intersection=s,this.face={normal:t}}}},62513:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>q});var s=i(54122),n=i(2212),o=i(97620),r=i(46266);class a extends n.ejS{constructor(e,t){const i=e.max,s=e.min,o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=s.x,o[4]=i.y,o[5]=i.z,o[6]=s.x,o[7]=s.y,o[8]=i.z,o[9]=i.x,o[10]=s.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=s.z,o[15]=s.x,o[16]=i.y,o[17]=s.z,o[18]=s.x,o[19]=s.y,o[20]=s.z,o[21]=i.x,o[22]=s.y,o[23]=s.z;const r=void 0!==t?t:16776960,a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=new n.u9r;l.setIndex(new n.TlE(a,1)),l.setAttribute("position",new n.a$l(o,3)),l.computeBoundingSphere(),super(l,new n.nls({color:r})),this.box=e}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),n.Tme.prototype.updateMatrixWorld.call(this,e))}}const l=new n.yGw;class c{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class h extends c{constructor(e,t,i){super(),this.mesh=e,this.faces=t,this.nearestPointOnGeometry=(()=>{const e=new n.CJI,t=new n.Pa4,i=new n.Pa4,s=new n.Pa4;return o=>{let r=1/0;const a=o.clone(),l=new n.Pa4,c=new n.Pa4(1/0,1/0,1/0);for(const n of this.faces){e.set(t.set(n.ax,n.ay,n.az),i.set(n.bx,n.by,n.bz),s.set(n.cx,n.cy,n.cz)),e.closestPointToPoint(a,l);const o=a.distanceToSquared(l);o<r&&(c.copy(l),r=o)}return c}})(),this.geometry=this.makeGeometryFromFaces(t),this.facesBounds=(0,r.A)(this.geometry),this.facesCenter=this.facesBounds.getCenter(new n.Pa4),this.bounds=this.facesBounds.clone().intersect(i),this.center=this.bounds.getCenter(new n.Pa4)}makeGeometryFromFaces(e){const t=new Float32Array(9*e.length);let i=0;const s={};for(const n of e){let e=s[n.materialIndex];e||(e=s[n.materialIndex]={start:i/3,count:0,materialIndex:n.materialIndex}),e.count+=3,t[i++]=n.ax,t[i++]=n.ay,t[i++]=n.az,t[i++]=n.bx,t[i++]=n.by,t[i++]=n.bz,t[i++]=n.cx,t[i++]=n.cy,t[i++]=n.cz}const o=new n.u9r;o.setAttribute("position",new n.TlE(t,3)),o.computeBoundingBox(),o.boundingBox&&(o.boundingSphere=o.boundingBox.getBoundingSphere(new n.aLr));for(const e in s){const t=s[e];o.addGroup(t.start,t.count,t.materialIndex)}return o}raycast(e,t){const i=this.mesh.geometry,s=this.mesh.matrixWorld,n=this.mesh.matrix;this.mesh.geometry=this.geometry,this.mesh.matrix=l,this.mesh.matrixWorld=l,this.mesh.raycast(e,t),this.mesh.geometry=i,this.mesh.matrix=n,this.mesh.matrixWorld=s}}class d extends c{constructor(e){super(),this.mesh=e,this._bounds=new n.ZzF,this.mesh.geometry.boundingBox||this.mesh.geometry.computeBoundingBox(),this.center=this.bounds.getCenter(new n.Pa4)}get bounds(){return this._bounds.copy((0,r.A)(this.mesh.geometry)).applyMatrix4(this.mesh.matrixWorld)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}}class u{constructor(e,t,i,s,o,r,a,l,c,h){this.materialIndex=e,this.ax=t,this.ay=i,this.az=s,this.bx=o,this.by=r,this.bz=a,this.cx=l,this.cy=c,this.cz=h,this.bounds=new n.ZzF(new n.Pa4(Math.min(t,o,l),Math.min(i,r,c),Math.min(s,a,h)),new n.Pa4(Math.max(t,o,l),Math.max(i,r,c),Math.max(s,a,h)))}}class p extends c{constructor(e,t,i,s){super(),this.level=t,this.leafMinSize=i,this.leafMaxFaces=s,this.childNodes=[],this.children=[],this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new n.Pa4),this.center=e.getCenter(new n.Pa4)}get depth(){return this.level}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{e instanceof n.Kj0&&t.push(e)}));for(const e of t){const t=new d(e);if(e.geometry instanceof n.u9r&&this.bounds.containsBox(t.bounds)){const t=this.geometryToFaces(e.geometry,e.matrixWorld);yield,yield*this.addFaces(e,t)}else this.addMesh(t)}}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const s=this.children[i];(s instanceof d||s instanceof h)&&s.mesh.id===e.id&&(s.parent=null,this.children.splice(i,1),this.emit("removed",this,s),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}*addFaces(e,t){if(t.length>this.leafMaxFaces&&this.size.length()>this.leafMinSize)0===this.childNodes.length&&this.buildChildNodes(),yield*this.splitFaces(e,t);else if(t.length>0){const i=new h(e,t,this.bounds);yield this.addMesh(i)}yield}*splitFaces(e,t){for(const i of this.childNodes){const s=[];for(const e of t)i.bounds.intersectsBox(e.bounds)&&s.push(e);yield*i.addFaces(e,s)}}buildChildNodes(){const e=this.size.multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let s=0;s<2;s++){const o=this.bounds.min.x+e.x*s,r=o+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,h=c+e.z,d=new n.ZzF(new n.Pa4(o,a,c),new n.Pa4(r,l,h)),u=new p(d,this.level+1,this.leafMinSize,this.leafMaxFaces);this.childNodes.push(u),this.add(u)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const s of this.children){if(t&&t.distance<s.raycastDistance)break;if(i(s))if(s instanceof p)t=s.pick(e,t,i);else{const i=[];s.raycast(e,i);for(const e of i)(!t||t.distance>e.distance)&&(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const s of this.children){if(0!==s.distance&&i&&i.distance<s.distance)break;if(t(s))if(s instanceof p)i=s.nearestTo(e,t,i);else if(s instanceof h){const t=s.nearestPointOnGeometry(e),n=t.distanceTo(e);(!i||i.distance>n)&&(i={point:t,object:s.mesh,distance:n})}}return i}geometryToFaces(e,t){let i=e.getAttribute("position");if(i instanceof n.kB5)throw new Error("InterleavedBufferAttribute not supported");t.equals(l)||(i=i.clone(),i.applyMatrix4(t));const s=i.array;let o;if(e.index){const t=e.index.array;o=new Array(t.length/3);let i=0;const n=e.groups.length>0?e.groups:[{start:0,count:t.length,materialIndex:0}];for(const e of n)for(let n=e.start;n<e.start+e.count;n+=3){const r=3*t[n],a=3*t[n+1],l=3*t[n+2];o[i++]=new u(e.materialIndex||0,s[r],s[r+1],s[r+2],s[a],s[a+1],s[a+2],s[l],s[l+1],s[l+2])}}else{o=new Array(s.length/9);let t=0;const i=e.groups.length>0?e.groups:[{start:0,count:s.length/3,materialIndex:0}];for(const e of i)for(let i=3*e.start;i<3*(e.start+e.count);i+=9)o[t++]=new u(e.materialIndex||0,s[i],s[i+1],s[i+2],s[i+3],s[i+4],s[i+5],s[i+6],s[i+7],s[i+8])}return o}getAllBounds(e,t=0,i=1/0,s=!1){for(const n of this.children)this.level>=t&&this.level<=i&&(n instanceof h||!s)&&e.push(n.bounds.clone()),n instanceof p&&n.getAllBounds(e,t,i,s)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class m{constructor(e,t,i){this.meshToNodes={},this._depth=0;const s=(0,o.rj)(e);this.root=new p(s,0,t,i),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),(t instanceof d||t instanceof h)&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof d||t instanceof h){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}get depth(){return this._depth}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const s=[];return this.root.getAllBounds(s,e,t,i),s}pick(e,t){return this.root.pick(e,null,(e=>!t||!(e instanceof d||e instanceof h)||t(e.mesh)))}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new n.Pa4);return this.root.nearestTo(i,(e=>!t||!(e instanceof d||e instanceof h)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,s=!1){const o=this.getAllBounds(t,i,s),l=new n.nls({color:e});if(o.length>0){const e=[];for(const t of o){const i=new a(t);e.push(i.geometry)}const t=(0,r.q)(e);return new n.ejS(t,l)}return new n.ejS(new n.u9r,l)}}class g{constructor(e,t){this.camera=e,this.defaultRaycastFilter=t,this.meshes={},this.octreeEnabledMeshes={},this.raycaster=new n.iMs,this.prevRay=new n.zHn,this._hitCache=[],this.getOctree=()=>this.octree,this.addTarget=(e,t)=>{const i=e,s=i.collider?i.collider:e;this.meshes[e.id]=s,this.octreeEnabledMeshes[e.id]=t,this.octree&&t&&this.octree.addMeshes(e)},this.removeTarget=e=>{this.octree&&this.octreeEnabledMeshes[e.id]&&this.octree.removeMeshes(e),delete this.meshes[e.id]}}init(){this.raycaster=new n.iMs,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this._hitCache.length=0,this.meshes={}}cast(e,t,i){if(e&&t&&(this.prevRay.copy(this.raycaster.ray),this.raycaster.set(e,t)),this.prevRay.equals(this.raycaster.ray))return this._hitCache;if(this.raycaster.layers.mask=this.camera.layers.mask,this._hitCache.length=0,this.octree){const e=this.getRaycastFilter(f.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e);t&&this._hitCache.push(t)}const s=this.getRaycastFilter(f.DynamicMeshes,i);for(const e in this.meshes){const t=this.meshes[e];if(s(t)){const e=this.raycaster.intersectObject(t,!0);this._hitCache=this._hitCache.concat(e)}}return this._hitCache.sort(this.sortIntersectionsByDistance),this.prevRay.copy(this.raycaster.ray),this._hitCache}pick(e,t,i){this.raycaster.set(e,t);const s=this.getRaycastFilter(f.OctreeMeshes,i);return this.octree.pick(this.raycaster,s)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(f.OctreeMeshes,t))}setupOctree(e){this.octree=new m(e.boundingBox,.5,200);for(const e of Object.keys(this.meshes))if(this.octreeEnabledMeshes[e]){const t=this.meshes[e];this.octree.addMeshes(t)}return this.octree}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,s=t=>{const i=this.octreeEnabledMeshes[t.id];switch(e){case f.DynamicMeshes:return!i;case f.OctreeMeshes:return i}};return e=>s(e)&&i(e)}sortIntersectionsByDistance(e,t){return e.distance>t.distance?1:e.distance<t.distance?-1:0}render(){}activate(){}deactivate(){}}var f;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(f||(f={}));var v=i(24135),y=i(70691),b=i(25799);const w=new b.Z("surface-edge-finder"),S=new n.CJI,T=["a","b","c"];class E extends n.G_f{constructor(e,t,i,s){super(e.a,e.b,e.c,e.normal),this.va=t,this.vb=i,this.vc=s,this.area=S.set(this.va.vector,this.vb.vector,this.vc.vector).getArea(),this.midpoint=S.getMidpoint(new n.Pa4),this.vertices=[this.va,this.vb,this.vc],t.faces.push(this),i.faces.push(this),s.faces.push(this)}}class _{constructor(e){this.vector=e,this.faces=[]}}class x{constructor(){this.area=0,this.normal=new n.Pa4,this.midpoint=new n.Pa4,this.faces=[],this.normalSum=new n.Pa4,this.midpointSum=new n.Pa4}add(e){e.surface&&e.surface.remove(e),this.faces.push(e),this.area+=e.area,this.midpointSum.add(e.midpoint),this.normalSum.add(e.normal),this.recalcFromSums(),e.surface=this}remove(e){e.surface&&(this.faces.splice(this.faces.indexOf(e),1),this.area-=e.area,this.midpointSum.sub(e.midpoint),this.normalSum.sub(e.normal),this.recalcFromSums()),e.surface=null}recalcFromSums(){this.normal.copy(this.normalSum).normalize(),this.midpoint.copy(this.midpointSum).divideScalar(this.faces.length)}mergeSurfaces(e){for(const t of e.faces)t.surface=this,this.faces.push(t);this.area+=e.area,this.normalSum.add(e.normalSum),this.midpointSum.add(e.midpointSum),this.recalcFromSums(),e.faces=[],e.area=0,e.normal.set(0,0,0),e.normalSum.set(0,0,0),e.midpointSum.set(0,0,0),e.midpoint.set(0,0,0)}getEdges(){const e={},t={};for(const t of this.faces)for(let i=0;i<3;i++){const s=t[T[i]],n=t[T[(i+1)%3]],o=Math.min(s,n)+","+Math.max(s,n);if(void 0===e[o]){const t={edge1:s,edge2:n,isEdge:!0};e[o]=t}else e[o].isEdge=!1}for(const{edge1:i,edge2:s,isEdge:n}of Object.values(e))n&&(t[i]||(t[i]=[]),t[i].push(s),t[s]||(t[s]=[]),t[s].push(i));return t}getCircularPaths(e){const t=this.getEdges(),i=new Set,s=[],n=Object.keys(t).map((e=>parseInt(e,10)));let o;for(;o=n.pop();){const n=[];for(;o;){let s;n.push(e[o]);let r=0;for(const n of t[o]){const t=Math.min(o,n)+","+Math.max(o,n);if(i.has(t))continue;const a=e[o].vector.distanceToSquared(this.midpoint);(void 0===s||a>r)&&(s=n,r=a)}if(!s)break;{const e=Math.min(o,s)+","+Math.max(o,s);i.add(e),o=s}}n.length>2&&s.push(n)}return s}}class M{constructor(e,t){this.roomId=e,this.floorId=t,this.surfaces=new Set,this.lines=[],this.points=[]}*run(e,t=[1,5,10],i=.2,s=.01,n=20){const r=e.vertices.map((e=>new _(e))),a=[];for(const t of e.faces)a.push(new E(t,r[t.a],r[t.b],r[t.c])),yield;for(let e=0,t=a.length;e<t;e++){const t=a[e];(new x).add(t)}for(const e of t)yield*this.mergeSurfacesByNormal(a,e);for(const e of a)this.surfaces.add(e.surface);let l=0;const c=[];for(const e of this.surfaces){if(e.area<=i)continue;const t=e.getCircularPaths(r);for(const e of t)this.cullPath(e,((e,t)=>{if(e.length()<s||t.length()<s)return l++,!1;const i=e.angleTo(t)*o.MN;return!(i<n||i>180-n)||(l++,!1)})),e.length>2&&c.push(e);yield}w.debug(`Culled ${l} path points`);const h=new Set,d=new Set,u=e=>`${e.x.toFixed(3)},${e.y.toFixed(3)},${e.z.toFixed(3)}`,p=e=>`${u(e.start)}:${u(e.end)}`,m=e=>`${u(e.end)}:${u(e.start)}`;for(const e of c)for(let t=0;t<e.length;t++){const i=e[t].vector,s=e[(t+1)%e.length].vector,n=new y.FM(i,s,this.floorId,this.roomId),o=p(n),r=m(n),a=u(i);d.has(o)||d.has(r)||(d.add(o),d.add(r),this.lines.push(n)),h.has(a)||(h.add(a),this.points.push(new y.UQ(i,this.floorId,this.roomId)))}yield}cullPath(e,t){const i=new n.Pa4,s=new n.Pa4;let o=!0;for(;o;){o=!1;for(let n=0;n<e.length&&e.length>2;n++){const r=e[0===n?e.length-1:n-1].vector,a=e[n].vector,l=e[(n+1)%e.length].vector;i.copy(r).sub(a),s.copy(l).sub(a),t(i,s)||(e.splice(n,1),o=!0,n--)}}}*mergeSurfacesByNormal(e,t,i=5){let s=-1,o=0;for(;0!==s&&o++<i;){w.debug(`Merging surfaces by normal angle threshold: ${t}`);const i=Math.cos(n.M8C.DEG2RAD*t);s=0;let o=0;for(const t of e){o++%1e3==0&&(yield);for(const e of t.vertices)for(const n of e.faces){const e=n.surface;t.surface!==e&&t.surface.normal.dot(e.normal)>=i&&(t.surface.faces.length>e.faces.length?t.surface.mergeSurfaces(e):e.mergeSurfaces(t.surface),s++)}}s&&w.debug(`Merged ${s} surfaces by normal...`)}}}var P=i(30853),A=i(50101),O=i(25396);const D=new b.Z("snapcaster");var I;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WORKING=1]="WORKING",e[e.READY=2]="READY"}(I||(I={}));class C{constructor(e){this.cameraData=e,this.edgeFinders=[],this.raycaster=new n.iMs,this.modelRaycaster=new n.iMs,this.status=I.UNINITIALIZED,this.cast=(e,t,i,s)=>{let o;i&&s&&(o=(new n.JOQ).setFromNormalAndCoplanarPoint(s,i)),this.raycaster.set(e.origin,e.direction);const r=this.snappingOctree.raycast(this.raycaster,t)||[],a=e=>{let t=(1+e.distance)*(1+e.distanceToRay)**2;return(e.object instanceof y.UQ||e.object instanceof n.Pa4)&&(t/=10),o&&o.distanceToPoint(e.point)<-.2&&(t+=10),t};return r.sort(((e,t)=>a(e)-a(t))),r},this.pick=(e,t,i,s,n)=>{i||(i=this.cast(e,t,s,n));let o=null;for(const t of i)if(this.modelRaycaster.ray.origin.copy(e.origin),this.modelRaycaster.ray.direction.copy(t.point).sub(e.origin).normalize(),this.modelRaycaster.far=t.distance-.05,!this.modelOctree.pick(this.modelRaycaster,(e=>e.visible))){o=t;break}return o?{isLineOctreeIntersection:!0,distance:o.distance,distanceToRay:o.distanceToRay,point:o.point,object:o.object}:null},this.add=(...e)=>{for(const t of e)this.snappingOctree.add(t)},this.remove=(...e)=>{for(const t of e)this.snappingOctree.remove(t)}}render(){}init(){}dispose(){}deactivate(e){}async activate(e){this.engine=e;const t=await e.getModule(P.default),i=(await e.getModule(A.default)).getScene().scene;let s,o;t.registerButton("Snapping","Visualize Snapping",(()=>{if(s)return i.remove(s),void(s=null);s=new n.Tme,i.add(s);const e=new n.xo$(.02,5,5),t=new n.vBJ({color:65280});this.snappingOctree.traverse((i=>{if(i instanceof y.FM){const e=(new n.ZXM).setFromPoints([i.start,i.end]),t=.2+.8*Math.random(),o=.2+.8*Math.random(),r=.2+.8*Math.random(),a=new n.x12(e,new n.nls({color:16711680*t+65280*o+255*r}));s.add(a)}else if(i instanceof y.UQ){const o=new n.Kj0(e,t);o.position.copy(i),s.add(o)}}))})),t.registerButton("Snapping","Visualize Snap Surfaces",(()=>{if(o)return i.remove(o),void(o=null);const e=new n.u9r,t=[],s=[];for(const e of this.edgeFinders)for(const i of e.surfaces){const e=i.area>.1,n=Math.random(),o=e?0:.2+.8*n,r=e?.2+.8*n:0,a=0;for(const e of i.faces){const i=e.va.vector,n=e.vb.vector,l=e.vc.vector;t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z),t.push(l.x,l.y,l.z),s.push(o,r,a,o,r,a,o,r,a)}}e.setAttribute("position",new n.a$l(t,3)),e.setAttribute("color",new n.a$l(s,3)),o=new n.Kj0(e,new n.vBJ({vertexColors:!0})),i.add(o)}))}get snappingOctree(){return this.status===I.UNINITIALIZED&&this.preloadMeshSnapping(),this._snappingOctree}setupOctree(e,t){this.modelOctree=t,this.modelMesh=e,this.modelRaycaster.layers.mask=e.layers.mask,this._snappingOctree=new y.ZP(this.modelMesh.boundingBox)}async preloadMeshSnapping(){this.status===I.UNINITIALIZED&&(this.status=I.WORKING,this.populateProcess=await this.engine.commandBinder.issueCommand(new O.S("snapping",this.buildSnappingForModel(),6e4)),await this.populateProcess.promise,this.status=I.READY,this.populateProcess=null)}*buildSnappingForModel(){const e=[];for(const t of this.modelMesh.floorMeshes)for(const i of t.roomMeshes)e.push({room:i,distanceToCamera:1/0});const t=new n.Pa4,i=()=>{e.forEach((e=>e.distanceToCamera=e.room.boundingBox.getCenter(t).distanceTo(this.cameraData.pose.position))),e.sort(((e,t)=>t.distanceToCamera-e.distanceToCamera))};for(;e.length;){i();const t=e.pop().room,s=(new n.ZXM).fromBufferGeometry(t.geometry);yield*this.buildSnappingForGeometry(s,t.roomId,t.floorId),yield}D.info(`Snapping found ${this._snappingOctree.pointCount} points and ${this._snappingOctree.lineCount} lines`)}*buildSnappingForGeometry(e,t,i){e.computeFaceNormals(),yield;const s=new M(t,i);yield*s.run(e),D.debug(`Room done, added ${s.points.length} points and ${s.lines.length} lines`);for(const e of s.points)this._snappingOctree.add(e);for(const e of s.lines)this._snappingOctree.add(e);this.edgeFinders.push(s)}}var R=i(75195);class L{constructor(e,t){this.raycaster=e,this.cameraData=t,this.lastHits=[],this.lastRay=new n.zHn(new n.Pa4(1,1,1),new n.Pa4(0,1,0)),this.currentRay=new n.zHn,this.pointer=new n.FM8(-2,-2),this.origin=new n.Pa4,this.direction=new n.Pa4,this.cast=()=>{const e=this.pointerRay;return this.lastRay.equals(e)||(this.lastHits=this.raycaster.cast(e.origin,e.direction).slice(),this.lastRay.copy(e)),this.lastHits},this.updatePointer=e=>{this.pointer.distanceToSquared(e)>2e-5&&this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,R.Kh)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,R.Kh)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class N{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new n.Ltg,normal:new n.Pa4,rotationMatrix:new n.yGw,ndc3:new n.Pa4}}beforeRender(){if(this.raycaster.pointer.pointerRay.equals(this.data.pointerRay))return;this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,R.fi)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new v.E(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){}activate(){}deactivate(){}}var k=i(89155),F=i(69281);const B=new b.Z("raycaster-debug");class U{constructor(e,t,i){Promise.all([e.getModule(P.default)]).then((([e])=>{const s=[];let n=!1;const o=()=>{s&&s.forEach((e=>{e.geometry.dispose(),e.material.dispose(),i.remove(e)}))},r=(e,n,o)=>{B.info("draw",{from:e,to:n,faces:o});const r=t.getOctree().getDebugBoundsMesh((0,F.rn)().getHex(),e,n,o);r.frustumCulled=!1,r.updateMatrixWorld(!0),i.add(r),s.push(r)};e.registerMenuButton({header:"Raycaster",buttonName:"Add Octree Level Buttons",callback:()=>{if(!n){for(let i=0;i<=t.getOctree().depth;i++)e.registerMenuButton({header:"Octree Levels",buttonName:`Anything on Level: ${i}`,callback:()=>{o(),r(i,i,!1)}});for(let i=0;i<=t.getOctree().depth;i++)e.registerMenuButton({header:"Octree Faces",buttonName:`Faces on Level: ${i}`,callback:()=>{o(),r(i,i,!0)}});n=!0}}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - All",callback:()=>{o();for(let e=0;e<=t.getOctree().depth;e++)r(e,e,!1)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - Faces",callback:()=>{o();for(let e=0;e<=t.getOctree().depth;e++)r(e,e,!0)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Clear Octree Visuals",callback:o})}))}}var H,G=i(31017),V=i(12505),z=i(27829);!function(e){e.normal="normal",e.hitClass="hitClass",e.hitBounds="hitBounds"}(H||(H={}));const j={color:"yellow"};class W{constructor(e,t){this.engine=e,this.cached={v1:new n.Pa4,v2:new n.Pa4,quat:new n._fP},this.showClass=!0,this.showName=!0,this.showNormal=!0,this.showBounds=!1,this.drawRaycastHitNormal=e=>{const t=this.draw.line(H.normal,"red",4);e&&t.updatePositions(e.point,this.cached.v1.copy(e.point).addScaledVector(e.normal,.2)),t.toggle(null!==e)},this.drawRaycastObjectInfo=(e,t,i,s)=>{const n=this.draw.label(H.hitClass,"X",this.cached.v1,1);if(n.visible=!1,e&&t&&(i||s)){const{position:r,rotation:a}=t.pose,{point:l,object:c}=e,h=i?c.__proto__.constructor.name:"",d=s?""!==c.name?c.name:c.id:"";n.text=`${h} - ${d}`,n.setPosition(l,(e=>t.isOrtho()?e.addScaledVector(z.f.UP,10):(0,o.Xe)(r,e,.5,e))),n.scaleBillboard(r,a,t.pose.projection,t.zoom(),t.height,t.aspect(),.05),n.setOrientation(a),n.visible=!0}},this.drawRaycastHitBounds=e=>{const t=this.draw.boxWire(H.hitBounds,j).toggle(!1);if(e&&e.object&&!(e.object instanceof V.i)&&e.object instanceof n.Kj0){const i=(0,r.A)(e.object.geometry),s=i.getCenter(this.cached.v1).applyMatrix4(e.object.matrixWorld),n=i.getSize(this.cached.v2).multiply(e.object.scale).multiplyScalar(.5);t.mesh.quaternion.copy(e.object.quaternion),t.toggle(!0).update(s,n)}},e.getModule(P.default).then((e=>{let i=!1;const s=t.onChanged((()=>this.update(t)));s.cancel();const n=()=>{i?(s.cancel(),this.draw.toggleAll(!1)):s.renew(),i=!i};e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Visualize",callback:()=>n()}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Class",callback:()=>this.showClass=!this.showClass}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Name",callback:()=>this.showName=!this.showName}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Normal",callback:()=>this.showNormal=!this.showNormal}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Bounds",callback:()=>this.showBounds=!this.showBounds})}))}get draw(){return this._draw||(this._draw=new G.M,this._draw.addToScene(this.engine)),this._draw}update(e){const t=this.engine.market.tryGetData(k.M_);this.showNormal&&this.drawRaycastHitNormal(e.hit),this.showBounds&&this.drawRaycastHitBounds(e.hit),this.drawRaycastObjectInfo(e.hit,t,this.showClass,this.showName)}}var Z=i(24975);class q extends s.Y{constructor(){super(...arguments),this.name="raycaster",this.raycasterPointerData=new v.P,this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e}}async init(e,t){t.market.register(this,v.P,this.raycasterPointerData);const[i,s]=await Promise.all([t.getModule(A.default),t.market.waitForData(k.M_)]),n=i.getCamera();this.raycaster=new g(n,Z.Nr),t.addComponent(this,this.raycaster),this.defaultPointer=new L(this.raycaster,s),this.snapcaster=new C(s),t.addComponent(this,this.snapcaster);const o=new N(this,this.raycasterPointerData,s);t.addComponent(this,o),new U(t,this.raycaster,i.getScene()),new W(t,this.raycasterPointerData)}dispose(){}setupOctree(e){const t=this.raycaster.setupOctree(e);this.snapcaster.setupOctree(e,t)}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}}},16696:(e,t,i)=>{"use strict";i.d(t,{oM:()=>n,sH:()=>o,vU:()=>r,sp:()=>a,fZ:()=>l,ep:()=>c});var s=i(99681);class n extends s.m{constructor(){super(...arguments),this.id="RequestRenderTargetCommand"}}class o extends s.m{constructor(e,t){super(),this.payload={renderTarget:e,context:t}}}class r extends s.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class a extends s.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class l extends s.m{constructor(e,t,i=0){super(),this.payload={renderTarget:e,texture:t,heading:i}}}class c extends s.m{constructor(e,t){super(),this.payload={target1:e,target2:t}}}},73354:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var s=i(54122),n=i(50101),o=i(2779),r=i(2212),a=i(13441),l=i(81047),c=i(48101);const h={circle_projection:new r.FIo({uniforms:{textureSampleScale:{value:5},panoTexture:{value:null},borderSize:{value:0},borderColor:{value:new r.Ltg(1,1,1,1)}},depthWrite:!1,depthTest:!0,side:r.ehD,vertexShader:(0,c.m)(l,i(69242)),fragmentShader:(0,c.m)(a,i(89641))}),equirectangular:new r.FIo({uniforms:{cubemap:{value:null},yaw:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:(0,c.m)(l,i(58295)),fragmentShader:(0,c.m)(a,i(16723))}),compose:new r.FIo({uniforms:{mask:{value:null},bg:{value:null}},transparent:!0,vertexShader:(0,c.m)(l,i(20672)),fragmentShader:(0,c.m)(a,i(4035))}),copyOpaque:new r.FIo({uniforms:{texture:{value:null}},vertexShader:(0,c.m)(l,i(49749)),fragmentShader:(0,c.m)(a,i(38251))})};var d=i(83974),u=i(16696);class p{constructor(e,t){this._renderer=e,this._renderTarget=t}get target(){return this._renderTarget}get width(){return this._renderTarget.width}get height(){return this._renderTarget.height}get bpp(){return 4}readRenderTargetData(e){const t=this._renderTarget.width,i=this._renderTarget.height;return e=e||new Uint8Array(t*i*4),this._renderer.readRenderTargetPixels(this._renderTarget,0,0,t,i,e),e}setSize(e,t){this._renderTarget.setSize(e,t)}dispose(){this._renderTarget.dispose()}}const m=new(i(25799).Z)("rtt");class g extends s.Y{constructor(){super(...arguments),this.name="render-to-texture",this.circleProjectionPlane=new d.E(new r.BKK(1,1),h.circle_projection),this.equirectProjectionPlane=new d.E(new r.BKK(1,1),h.equirectangular),this.composePlane=new d.E(new r.BKK(1,1),h.compose),this.copyPlane=new d.E(new r.BKK(1,1),h.copyOpaque),this.cachedSize=new r.FM8,this.cachedViewport=new r.Ltg,this.cachedViewport2=new r.Ltg,this.solidWhiteTexture=new r.IEO(new Uint8Array([255,255,255,255]),1,1),this.debugRenderOffset=0}async init(e,t){const i=await t.getModule(n.default);this.cwfRenderer=i.cwfRenderer,this.renderer=i.cwfRenderer.renderer,this.camera=new r.V1s,this.orthoCamera=new r.iKG(-.5,.5,.5,-.5,0,1),this.camera.layers.mask=o.o.ALL.mask,this.scene=new r.xsS,this.scene.name="rtt",this.scene.autoUpdate=!1,this.bindings.push(t.commandBinder.addBinding(u.oM,(async e=>new p(this.renderer,this.createRenderTarget2D(0))))),this.bindings.push(t.commandBinder.addBinding(u.sH,(async e=>{this.renderContext(e.renderTarget.target,e.context)}))),this.bindings.push(t.commandBinder.addBinding(u.vU,(async e=>{this.render(e.renderTarget.target,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.fZ,(async e=>{this.renderEquirectangular(e.texture,e.renderTarget.target,e.heading)}))),this.bindings.push(t.commandBinder.addBinding(u.sp,(async e=>{this.render(e.renderTarget,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.ep,(async e=>{this.compose(e.target1.target,e.target2.target,e.target2.target)})))}getRenderSize(){const e=this.renderer.getPixelRatio(),t=this.renderer.getSize(this.cachedSize);return t.width*=e,t.height*=e,t}onUpdate(){this.debugRenderOffset=0}createRenderTarget2D(e,t=e,i,s=!0){const n=new r.dd2(e,t,i);return n.texture.generateMipmaps=s,n}clearRenderTarget2D(e){this.renderer.setRenderTarget(e),this.renderer.clear(),this.renderer.setRenderTarget(null)}disposeRenderTarget2D(e){e.texture.dispose(),e.depthTexture&&e.depthTexture.dispose(),e.dispose()}getRenderTargetData(e,t){const i=e.width,s=e.height;return t=t||new Uint8Array(i*s*4),this.renderer.readRenderTargetPixels(e,0,0,i,s,t),t}compose(e,t,i=this.solidWhiteTexture){this.composePlane.material.uniforms.bg.value=this.isRenderTarget(t)?t.texture:t,this.composePlane.material.uniforms.mask.value=this.isRenderTarget(i)?i.texture:i,this.scene.add(this.composePlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.composePlane)}copyTextureOpaque(e,t){this.copyPlane.material.uniforms.texture.value=t&&this.isRenderTarget(t)?t.texture:t,this.scene.add(this.copyPlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.copyPlane)}copyTexture(e,t){return t.format===r.UCm?this.copyTextureOpaque(e,t):this.compose(e,t)}resizeTexture(e,t){const i=new r.dd2(t,t);return i.texture.format=e.format,i.texture.addEventListener("dispose",i.dispose.bind(i)),this.copyTexture(i,e),i.texture}renderToScreen(e,t,i){const s=this.isRenderTarget(e)?e.width:e.image.width,n=this.isRenderTarget(e)?e.height:e.image.height,o=t?t.x:this.debugRenderOffset,r=t?t.y:this.cachedSize.height-n-48;this.renderer.getViewport(this.cachedViewport),this.renderer.setViewport(o,r,s,n),this.compose(null,e,i),this.renderer.setViewport(this.cachedViewport),t||(this.debugRenderOffset+=s+4)}isRenderTarget(e){return e.hasOwnProperty("texture")}renderContext(e,t){e.texture.image=t.canvas,e.texture.needsUpdate=!0}render(e,t,i,s){const n=t.parent;if(n&&this.scene.applyMatrix4(n.matrixWorld),this.scene.add(t),e.isWebGLCubeRenderTarget){const t=new r._am(.01,1e3,e);i.getWorldPosition(t.position),i.getWorldQuaternion(t.quaternion),this.scene.add(t),this.scene.updateMatrixWorld(),t.layers.mask=s?s.mask:i.layers.mask,t.update(this.renderer,this.scene),this.scene.remove(t)}else{i.getWorldPosition(this.camera.position),i.getWorldQuaternion(this.camera.quaternion),this.camera.projectionMatrix.copy(i.projectionMatrix),this.camera.layers.mask=s?s.mask:i.layers.mask;const t=this.renderer.getSize(this.cachedSize),n=t.width/t.height,o=e.width/e.height,r=this.camera.projectionMatrix;n>o?r.elements[0]=r.elements[5]/o:r.elements[5]=r.elements[0]*o,this.overrideRenderTarget(e,(()=>{this.renderer.clear(),this.renderer.render(this.scene,this.camera)}))}return n&&(n.add(t),this.scene.matrixWorld.identity()),this.scene.remove(t),e}setScissors(e,t){if(e){if(!t)throw Error("Rect to restrict rendering to required when enabling scissors.");this.renderer.setScissorTest(!0),this.renderer.setScissor(t.x,t.y,t.width,t.height)}else{const e=this.renderer.getSize(this.cachedSize);this.renderer.setScissor(0,0,e.width,e.height),this.renderer.setScissorTest(!1)}}renderSphericalProjection(e,t,i,s,n){const o=h.circle_projection;o.uniforms.borderColor.value.copy(n||new r.Ltg(1,1,1,1)),o.uniforms.borderSize.value=s||0,o.uniforms.textureSampleScale.value=i||5,o.uniforms.panoTexture.value=e,this.scene.add(this.circleProjectionPlane),this.circleProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.circleProjectionPlane)}renderEquirectangular(e,t,i=0){const s=this.equirectProjectionPlane.material;s.uniforms.cubemap.value=e,s.uniforms.yaw.value=i,this.scene.add(this.equirectProjectionPlane),this.equirectProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.equirectProjectionPlane),s.uniforms.cubemap.value=null,s.uniforms.yaw.value=0}overrideRenderTarget(e,t){const i=this.renderTargetSwap(e);t(),this.renderTargetRestore(i)}renderTargetSwap(e){const t=this.renderer.xr.enabled,i=this.renderer.getRenderTarget(),s=this.renderer.getViewport(this.cachedViewport2);return this.renderer.xr.enabled=!1,this.renderer.setRenderTarget(e),{xr:t,rtt:i,viewport:s}}renderTargetRestore(e){this.renderer.xr.enabled=e.xr,this.renderer.setRenderTarget(e.rtt),this.renderer.setViewport(e.viewport)}renderAndReadAsync(e,t,i){const s=i.buffer;if(!this.renderer.capabilities.isWebGL2)return m.debug("renderAsync call webgl2, falling back to sync render/read"),this.render(e.target,e.mesh,e.camera),Promise.resolve(this.getRenderTargetData(e.target,s));const n=this.renderTargetSwap(e.target),o=this.renderer.getContext(),r=i.webglBuffer||o.createBuffer();if(!r)throw Error("Unable to create pack buffer");return o.bindBuffer(o.PIXEL_PACK_BUFFER,r),o.bufferData(o.PIXEL_PACK_BUFFER,s.byteLength,o.DYNAMIC_READ),e.clear&&this.renderer.clear(),this.renderer.render(e.mesh,e.camera),o.readPixels(t.x,t.y,t.width,t.height,o.RGBA,o.UNSIGNED_BYTE,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),this.renderTargetRestore(n),this.cwfRenderer.fence(o).then((()=>(o.bindBuffer(o.PIXEL_PACK_BUFFER,r),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,s),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),i.webglBuffer||o.deleteBuffer(r),s)))}}},6518:(e,t,i)=>{"use strict";i.d(t,{vP:()=>o,Xk:()=>r,jJ:()=>a,fY:()=>l});var s=i(62367);let n=null;const o=async(e,t)=>{const s=new Uint8Array(e.width*e.height*4);if(e.readRenderTargetData(s),!n){const e=await Promise.all([i.e(764),i.e(985),i.e(718)]).then(i.bind(i,19784));n=e.createJpegEncodeWorker()}const o=s.buffer,r=await n.exec({data:o,width:e.width,height:e.height,options:{exif:t,quality:85,flipY:!0}},[o]);return new Uint8Array(r.data)},r=e=>new Blob([e],{type:"image/jpeg"}),a=e=>"data:image/jpg;base64,"+(0,s.$B)(e),l=(e,t,i,s)=>'http://ns.adobe.com/xap/1.0/\0<?xpacket begin="ï»¿" id="W5M0MpCehiHzreSzNTczkc9d"?><x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:GPano="http://ns.google.com/photos/1.0/panorama/"><GPano:CroppedAreaImageHeightPixels>'+t+"</GPano:CroppedAreaImageHeightPixels><GPano:CroppedAreaImageWidthPixels>"+e+"</GPano:CroppedAreaImageWidthPixels><GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels><GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels><GPano:FullPanoHeightPixels>"+t+"</GPano:FullPanoHeightPixels><GPano:FullPanoWidthPixels>"+e+"</GPano:FullPanoWidthPixels><GPano:ProjectionType>equirectangular</GPano:ProjectionType><GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer><GPano:InitialViewHeadingDegrees>"+i+"</GPano:InitialViewHeadingDegrees><GPano:InitialViewPitchDegrees>"+s+'</GPano:InitialViewPitchDegrees><GPano:CaptureSoftware>Matterport Camera</GPano:CaptureSoftware><GPano:StitchingSoftware>Matterport Cloud</GPano:StitchingSoftware></rdf:Description></rdf:RDF></x:xmpmeta><?xpacket end="w"?>'},86293:(e,t,i)=>{"use strict";i.d(t,{d:()=>s});class s{constructor(e){this.tags=[],e&&Object.assign(this,e)}}},18687:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(19413),n=i(86293),o=i(2212),r=i(5442),a=i(46266);const l=new(i(25799).Z)("room-data");class c extends s.V{constructor(e){if(super(),this.name="rooms",this.selected=new r.f(null),this._rooms={},this.floorToRoomsMap=new Map,this._bbox=new o.ZzF,this.rooms=()=>{const e=this._rooms,t=Object.keys(this._rooms);return function*(){for(const i of t)yield e[i]}()},this.get=e=>this._rooms[e],this.getBySubgroup=e=>Object.values(this._rooms).find((t=>t.meshSubgroup===e)),this.roomIdsFromPoint=e=>{const t=[];for(const i of this.rooms())this._bbox.min.set(i.min.x,i.min.y,i.min.z),this._bbox.max.set(i.max.x,i.max.y,i.max.z),this._bbox.containsPoint(e)&&t.push(i.id);return t},e)for(const t of Object.values(e))this.add(t)}mapMeshesToRooms(e){for(const t of e){let e=this.getBySubgroup(t.meshSubgroup);e||(l.debug(`Created non-existant Room for mesh subgroup ${t.meshSubgroup}`),e=new n.d({id:t.roomId,meshSubgroup:t.meshSubgroup,floorId:t.floorId}),this.add(e));const i=(0,a.A)(t.geometry);e.min={x:i.min.x,y:i.min.y,z:i.min.z},e.max={x:i.max.x,y:i.max.y,z:i.max.z},e.mesh=t,t.roomId=e.id}for(const e in this._rooms)this._rooms[e].mesh||(l.debug(`Removing non-existant Room with mesh subgroup ${this._rooms[e].meshSubgroup}`),this.remove(e))}add(e){this._rooms[e.id]=e;const t=this.floorToRoomsMap.get(e.floorId);t?t.push(e):this.floorToRoomsMap.set(e.floorId,[e])}remove(e){const t=this.get(e);if(!t)return;const i=this.floorToRoomsMap.get(t.floorId);if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}delete this._rooms[e]}copy(e){this._rooms={},this.floorToRoomsMap.clear();for(const t of e.rooms()){const e={id:t.id,floorId:t.floorId,min:t.min,max:t.max,mesh:t.mesh,meshSubgroup:t.meshSubgroup,height:t.height,width:t.width,depth:t.depth,areaFloor:t.areaFloor,tags:[...t.tags]};this.add(e)}return this}get roomCount(){return Object.keys(this._rooms).length}get floorCount(){return this.floorToRoomsMap.size}get collection(){return this._rooms}getByMeshSubgroup(e){return Object.values(this._rooms).find((t=>t.meshSubgroup===e))}roomsByFloor(e){return this.floorToRoomsMap.get(e)||[]}}},31113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>_});var s=i(54122),n=i(85197),o=i(18687),r=i(77956),a=i(12775),l=i(32359),c=i(52050),h=i(32400),d=i(51770),u=i(25799),p=i(86293);const m=new u.Z("mds-floor-deserializer");class g{deserialize(e){if(!e||!this.validate(e))return m.debug("Deserialized invalid room data from MDS",e),null;const t=e.dimensions||{},{height:i,width:s,depth:n,areaFloor:o}=t;return new p.d({id:e.id,meshSubgroup:e.meshId,floorId:e.floor.id,height:i,width:s,depth:n,areaFloor:o,tags:e.tags})}validate(e){const t=["id","meshId"].every((t=>t in e)),i=e.floor&&e.floor.id&&"number"==typeof e.floor.meshId;return t&&!!i}}class f extends h.u{async read(){const e=this.getViewId(),t=new g;return this.query(c.GetRooms,{modelId:e}).then((e=>{const i=(0,d.qw)(e,"data.model.rooms");return i&&Array.isArray(i)?i.reduce(((e,i)=>{const s=t.deserialize(i);return s&&(e[s.id]=s),e}),{}):null}))}}var v=i(25936),y=i(17256),b=i(42915),w=i(67399),S=i(2212),T=i(62513);const E=new u.Z("room-data-module");class _ extends s.Y{constructor(){super(...arguments),this.name="room-data",this.visitedRooms={}}async init(e,t){const[i,s,c,h]=await Promise.all([t.getModule(n.default),t.market.waitForData(a.O),t.market.waitForData(v.i),t.getModule(T.default)]);this.raycaster=h,this.floorData=c,this.configureStorage(e);const d=this.store?await this.store.read():{};this.data=new o.Z(d||{}),this.data.mapMeshesToRooms(i.mesh.roomMeshes),t.market.register(this,o.Z,this.data);const u=this.data.roomCount,p=e=>{const i=s.closestMode;this.visitedRooms[e.id]||(this.visitedRooms[e.id]={visitCount:0}),this.visitedRooms[e.id].visitCount++;const n=this.visitedRooms[e.id].visitCount;t.broadcast(new l.D(e.id,e.meshSubgroup,i,n,u,""))},m=await t.market.waitForData(r.Z),g=m.makeSweepChangeSubscription((e=>{if(e){const t=m.getSweep(e);this.data.selected.value=t.roomId,this.data.commit()}})),f=this.data.selected.onChanged((e=>{if(null!==e){const t=this.data.get(e);t&&p(t)}}));this.bindings.push(g,f)}configureStorage(e){const{storageProvider:t,baseUrl:i}=e;this.store||t!==y.Xq.MDS||(this.store=new f({baseUrl:i,readonly:!0}))}inferMeshIdsFromPoint(e,t){const i=!e.roomId||!this.data.get(e.roomId),s=!e.floorId||!this.floorData.hasFloor(e.floorId);if(i||s){const n=s?w.$4.isRoomMesh:b.qe.every(w.$4.isRoomMesh,w.$4.matchesFloorId(e.floorId)),o=this.raycaster.picking.nearest((new S.Pa4).set(t.x,t.y,t.z),n);o&&w.$4.isRoomMesh(o.object)?(E.debug("data-fixup:",i?{roomId:o.object.roomId,prev:e.roomId}:"",s?{floorId:o.object.floorId,prev:e.floorId}:"",{data:e}),i&&(e.roomId=o.object.roomId),s&&(e.floorId=o.object.floorId)):E.warn("Nearest Room/Floor not found for:",{point:t,data:e,invalidRoomId:i,invalidFloorId:s})}return e}}},32359:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});var s=i(93528);class n extends s.v{constructor(e,t,i,s,n,o){super(),this.roomId=e,this.meshSubgroup=t,this.viewmode=i,this.visitCount=s,this.roomCount=n,this.roomType=o}}},10594:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var s=i(54122),n=i(25799),o=i(17256),r=i(51770);class a{}var l=i(78909);class c extends l.T{equals(e){return this.id===e.id}copy(e){return this.id=e.id,this.name=e.name,this.vendor=e.vendor,this.model=e.model,this.captureMode=e.captureMode,this.depthCameraType=e.depthCameraType,this.cameraTypes=e.cameraTypes.slice(),this.sensorSerialNumbers=e.sensorSerialNumbers.slice(),this.serialNumber=e.serialNumber,this.mountCalibrationVersion=e.mountCalibrationVersion,this.softwareVersion=e.softwareVersion,this}}class h extends l.T{constructor(e){super(),e&&(e.id&&(this.id=e.id),void 0!==e.index&&(this.index=e.index),this.name=e.name||"",this.created=e.created||"",this.alignment=e.alignment||"",this.options=e.options||[],this.camera=e.camera||new c)}equals(e){return this.id===e.id}copy(e){return this.id=e.id,this.index=e.index,this.name=e.name,this.created=e.created,this.alignment=e.alignment,this.options=e.options.slice(),this.camera=(new c).copy(e.camera),this}}const d=new n.Z("mds-scaninfo-serializer");class u{deserialize(e){if(!e||!this.validate(e))return d.debug("Deserialized invalid ScanInfo data from MDS",e),null;const t=e,i=new h;i.id=t.id,i.anchorId=t.anchor&&t.anchor.id||"",i.index=t.index||-1,i.name=t.name||"",i.created=t.created||"",i.alignment=t.alignment||"",i.url=t.url||"",i.timeOfDay=t.timeOfDay||"",i.options=t.options||[];const s=t.camera;return i.camera=new c,i.camera.id=s&&s.id||"",i.camera.name=s&&s.name||"",i.camera.vendor=s&&s.vendor||"",i.camera.model=s&&s.model||"",i.camera.captureMode=s&&s.captureMode||"",i.camera.depthCameraType=s&&s.depthCameraType||"",i.camera.cameraTypes=s&&s.cameraTypes||[],i.camera.sensorSerialNumbers=s&&s.sensorSerialNumbers||[],i.camera.serialNumber=s&&s.serialNumber||"",i.camera.mountCalibrationVersion=s?s.mountCalibrationVersion:void 0,i.camera.softwareVersion=s&&s.softwareVersion||"",i}validate(e){return!!e&&["id"].every((t=>t in e))}}var p=i(32400),m=i(12757);class g extends p.u{constructor(){super(...arguments),this.deserializer=new u}async fetch(){const e=this.getViewId();return this.query(m.GetScans,{modelId:e},{fetchPolicy:"no-cache"}).then((e=>{const t=(0,r.qw)(e,"data.model.assets.scans"),i={},s={};for(const e of t){const t=this.deserializer.deserialize(e);t&&(i[t.id]=t,t.anchorId&&(s[t.anchorId]=t))}const n=new a;return n.scansById=i,n.scansByAnchor=s,n}))}async read(){return this.scans||(this.scans=this.fetch()),this.scans}async refresh(){return this.scans=this.fetch(),this.scans}}var f=i(83852);class v{async create(...e){throw new f.n}async update(...e){throw new f.n}async delete(...e){throw new f.n}async read(){const e=new a;return e.scansById={},e.scansByAnchor={},Promise.resolve(e)}async refresh(){return this.read()}}const y=new n.Z("scaninfo-module");class b extends s.Y{constructor(){super(...arguments),this.name="scaninfo-data",this.getScanInfo=e=>this.store.read().then((t=>t?t.scansByAnchor[e]:void 0)),this.getScanDownloadURL=e=>this.store.refresh().then((t=>{if(t){const i=t.scansByAnchor[e];return i?i.url:void 0}}))}async init(e){this.store=this.getStore(e)}getStore(e){const t=e.storageProvider||o.Xq.JSONSTORE;return y.info(`Loading Scan Info from ${t}`),t===o.Xq.MDS?new g:new v}}},25396:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var s=i(99681);class n extends s.m{constructor(e,t,i,s=1){super(),this.id="SCHEDULE_PROCESS_COMMAND",this.payload={type:e,func:t,maxDelay:i,steps:s}}}},26199:(e,t,i)=>{"use strict";i.d(t,{_:()=>n});var s=i(99681);class n extends s.m{constructor(e,t,i){super(),this.id="SCHEDULE_TASK_COMMAND";const s=function*(){return t()}();this.payload={type:e,func:s,maxDelay:i,steps:1}}}},68345:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s,n=i(54122),o=i(2124);class r{constructor(e){this.name=e,this.taskDurations=new o.P(100)}get typicalStepDuration(){return 1}addTaskDuration(e){this.taskDurations.push(e)}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(s||(s={}));class a{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new r(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==s.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==s.DONE;){const s=performance.now(),n=t+i.type.typicalStepDuration>e,o=s>=i.deadline;if(n&&!o)break e;const r=s;i.run();const a=performance.now()-r;i.type.addTaskDuration(a),t+=a}}}var l=i(26199),c=i(25396);class h{constructor(e,t,i,n){this.type=e,this.func=t,this.deadline=i,this.steps=n,this.status=s.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=s.STARTED;try{e=this.func.next()}catch(e){return this.status=s.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=s.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class d extends n.Y{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new a}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(l._,(async e=>{const t=new h(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(c.S,(async e=>{const t=new h(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},48912:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var s=i(54122),n=i(30853),o=i(99169),r=i(2779),a=i(21265),l=i(6518),c=i(79976),h=i(72760),d=i(93227),u=i(25799),p=i(50101),m=i(2212),g=i(73354);const f=new u.Z("screenshots");class v extends s.Y{constructor(){super(...arguments),this.name="screenshots-module",this.capturer=new y}async init(e,t){this.engine=t,[this.settingsModule,this.canvas,this.renderer,this.renderToTexture]=await Promise.all([t.getModule(n.default),t.market.waitForData(o.W),t.getModule(p.default),t.getModule(g.default)]),this.settingsModule.registerButton("Debug","Take screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take 16k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:9e3,width:16e3},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take FB 3D screenshot",(async()=>{const e=Date.now(),t=this.engine.getRenderLayer("model-mesh"),i=this.engine.getRenderLayer("skybox"),s=t.clone();s.addLayers(i);try{await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,s),await this.engine.commandBinder.issueCommand(new c.U(h.S.Depth)),await this.engine.commandBinder.issueCommand(new d.g(1)),await this.takeAndDownloadScreenshot({height:Math.floor(this.canvas.height/4),width:Math.floor(this.canvas.width/4)},`image_${e}_depth.jpg`,t)}catch(e){throw f.error("Could not take screenshot"),e}finally{await this.engine.commandBinder.issueCommand(new c.U(null)),await this.engine.commandBinder.issueCommand(new d.g(0))}}))}async takeAndDownloadScreenshot(e,t,i){const s=await this.capturer.capture(i,e,this.renderer,this.renderToTexture,this.renderTarget);(0,a.Hx)((0,l.Xk)(s),t)}}class y{constructor(){this.captureCamera=new m.V1s}async capture(e,t,i,s,n){const{camera:o,scene:r}=i.getScene();return o.getWorldPosition(this.captureCamera.position),o.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(o.projectionMatrix),this.captureCamera.layers.mask=e.mask,n.setSize(t.width,t.height),s.render(n.target,r,this.captureCamera),await(0,l.vP)(n)}}},27139:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BoxVolume:()=>I.k,CylinderVolume:()=>C.X,SourceType:()=>N,SphereVolume:()=>R.b,default:()=>L});var s=i(54122),n=i(56040),o=i(27829),r=i(2212);class a{constructor(){this.needsUpdate=!0}notify(){this.needsUpdate=!0}}var l=i(23812);class c{constructor(e){this.observable=new l.$,this.notifier=new class{constructor(e){this.sensorObservable=e}notify(){this.sensorObservable.observable.notify()}}(this),this.dependencySub=e.sub(this.notifier)}dispose(){this.dependencySub.cancel()}observe(e){return this.observable.observe(e)}}class h{constructor(e){this.cameraData=e,this._forward=new r.Pa4,this.frustum=new r.iWj,this.frustumTransform=new n.M,this.frustumProjection=new n.M,this.forwardObserver=new a,this.frustumObserver=new a,this.frustumObservable=new c(new d(e)),this.frustumObservable.observe(this.forwardObserver),this.frustumObservable.observe(this.frustumObserver)}dispose(){this.frustumObservable.dispose()}get fovx(){return this.cameraData.fovX()}get fovy(){return this.cameraData.fovY()}get forward(){return this.forwardObserver.needsUpdate&&(this.forwardObserver.needsUpdate=!1,this._forward.copy(o.f.FORWARD),this._forward.applyQuaternion(this.cameraData.pose.rotation)),this._forward}observe(e){return this.frustumObservable.observe(e)}get origin(){return this.cameraData.pose.position}containsPoint(e){return this.updateVolume(),this.frustum.containsPoint(e)}updateVolume(){if(this.frustumObserver.needsUpdate){this.frustumObserver.needsUpdate=!1;const e=this.cameraData.pose;this.frustumTransform.compose(e.position,e.rotation,o.f.UNIT).getInverse(this.frustumTransform),this.frustumProjection.copy(this.cameraData.pose.projection),this.frustum.setFromProjectionMatrix(this.frustumTransform.multiplyMatrices(this.frustumProjection,this.frustumTransform).asThreeMatrix4())}}}class d{constructor(e){this.cameraData=e}sub(e){return this.cameraData.onChanged((()=>e.notify()))}}var u=i(30963),p=i(62513),m=i(50101),g=i(89155);class f{constructor(){this.sensors=new Set}addSensor(e){this.sensors.add(e)}removeSensor(e){this.sensors.delete(e)}update(){for(const e of this.sensors)e.update()}}class v{constructor(e,t,i){this.frustum=e,this.raycaster=t,this.sensorDisposer=i,this.volumeObserver=new a,this.sources=new Set,this.dirtySources=new Set,this.sourceWatchers=new Map,this.readingsCache=new Map,this.readingObservable=new l.$,this.raycastDirection=new r.Pa4,this.volumeSub=e.observe(this.volumeObserver)}get origin(){return this.frustum.origin}dispose(){this.volumeSub.cancel(),this.sensorDisposer.disposeSensor(this)}addSource(...e){for(const t of e)this.sources.add(t),this.dirtySources.add(t),this.sourceWatchers.set(t,new y(this.dirtySources,t))}get readings(){return this.readingsCache}update(){this.volumeObserver.needsUpdate?(this.volumeObserver.needsUpdate=!1,this.recomputeAllReadings(),this.readingObservable.notify()):this.dirtySources.size>0&&(this.recomputeDirtyReadings(),this.readingObservable.notify())}recomputeAllReadings(){for(const e of this.sources)this.recomputeReading(e);this.dirtySources.clear()}recomputeDirtyReadings(){for(const e of this.dirtySources)this.recomputeReading(e);this.dirtySources.clear()}recomputeReading(e){this.raycastDirection.copy(e.origin).sub(this.frustum.origin).normalize();const t=this.frustum.origin.distanceToSquared(e.origin),i=this.readingsCache.get(e)||{direction:new r.Pa4};i.inRange=function(e,t){return t.volume.containsPoint(e.origin)}(this,e),i.inView=i.inRange&&this.frustum.containsPoint(e.origin)&&!function(e,t){return!!t&&e>t.distance**2}(t,this.raycaster.picking.pick(this.frustum.origin,this.raycastDirection)),i.direction.copy(this.raycastDirection),i.distanceSq=t,this.readingsCache.set(e,i)}onReadingsUpdated(e){return this.readingObservable.observe(e)}}class y{constructor(e,t){this.sub=t.volume.observe({notify(){e.add(t)}})}dispose(){this.sub.cancel()}}var b=i(73706),w=i(75158),S=i(75712),T=i(97620);const E=e=>{const t=new r.Aip(1,20,20),i=new r.Kj0(t,new r.vBJ);i.scale.set(.5,.5,.5);const s=new r.Kj0(t,new r.vBJ({wireframe:!0})),n=new r.Kj0(t,new r.vBJ({transparent:!0,opacity:.1,side:r.ehD,depthWrite:!1}));return n.add(s),e.add(i),e.add(n),{interactionMesh:i,volumeMesh:n,dispose:()=>{e.remove(i),e.remove(n),i.geometry.dispose(),i.material.dispose(),n.geometry.dispose(),n.material.dispose(),s.geometry.dispose(),s.material.dispose()},setColor:e=>{n.material.color.set(e),s.material.color.set(e)}}},_=e=>{const t=new r.nvb(1,1,1),i=new r.Kj0(t,new r.vBJ);i.scale.set(.1,.1,.1);const s=new r.vBJ({transparent:!0,opacity:.1,side:r.ehD,depthWrite:!1}),n=new r.Kj0(t,s),o=new r.ejS(new r.TOt(t),new r.nls);return n.add(o),e.add(i),e.add(n),{interactionMesh:i,volumeMesh:n,dispose:()=>{e.remove(i),e.remove(n),i.geometry.dispose(),i.material.dispose(),n.geometry.dispose(),n.material.dispose(),o.geometry.dispose(),o.material.dispose()},setColor:e=>{n.material.color.set(e),o.material.color.set(e)}}},x=e=>{if(e.type===N.BOX){const t=e,i=Object.assign({},t.volume.size);return i.x=(0,T.uZ)(i.x,.1,4),i.y=(0,T.uZ)(i.y,.1,4),i.z=(0,T.uZ)(i.z,.1,4),i}if(e.type===N.CYLINDER){const t=e,i={x:t.volume.radius,y:t.volume.height,z:t.volume.radius};return i.x=(0,T.uZ)(i.x,.1,4),i.y=(0,T.uZ)(i.y,.1,4),i.z=(0,T.uZ)(i.z,.1,4),i}{const t=e,i=(0,T.uZ)(t.volume.radius,.1,4);return{x:i,y:i,z:i}}},M=(new r._fP).identity();function P(e){return e.type===N.BOX?e.volume.orientation:M}class A{constructor(e,t,i){this.source=e,this.scene=t,this.inputIni=i,this.subs=[],this.stickyHover=!1,this.sourceDirty=!0,this.meshes=((e,t)=>e.type===N.BOX?_(t):e.type===N.CYLINDER?function(e){const t=new r.m_w(.5,.5,1);t.translate(0,.5,0);const i=new r.Kj0(t,new r.vBJ);i.scale.set(.05,.1,.05);const s=new r.vBJ({transparent:!0,opacity:.1,side:r.ehD,depthWrite:!1}),n=new r.Kj0(t,new r.vBJ({wireframe:!0})),o=new r.Kj0(t,s);return o.add(n),e.add(i),e.add(o),{interactionMesh:i,volumeMesh:o,dispose(){e.remove(i),e.remove(o),i.geometry.dispose(),i.material.dispose(),o.geometry.dispose(),o.material.dispose(),n.geometry.dispose(),n.material.dispose()},setColor(e){o.material.color.set(e),n.material.color.set(e)}}}(t):E(t))(e,this.scene.scene),this.meshes.interactionMesh.scale.set(.1,.1,.1),this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.interactionMesh.material.color.set(16724312),this.meshes.volumeMesh.scale.set(0,0,0),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.visible=!1;const s=P(e);this.meshes.volumeMesh.quaternion.copy(s),this.mixer=new r.Xcj(this.meshes.volumeMesh);const n=x(e),o=new r.yC1(".scale",[0,.4],[0,0,0,n.x,n.y,n.z],r.pIN),a=new r.m7l(void 0,.4,[o]);this.onHoverAction=this.mixer.clipAction(a),this.onHoverAction.clampWhenFinished=!0,this.onHoverAction.loop=r.jAl,this.subs.push(this.inputIni.registerMeshHandler(b.z,S.s.isValue(this.meshes.interactionMesh),(()=>{const e=this.onHoverAction.time;this.onHoverAction.reset(),this.meshes.volumeMesh.visible=!0,this.onHoverAction.timeScale=1,this.onHoverAction.time=e,this.onHoverAction.play()}))),this.subs.push(this.inputIni.registerMeshHandler(b.A,S.s.isValue(this.meshes.interactionMesh),(()=>{if(!this.stickyHover){const e=this.onHoverAction.time;this.onHoverAction.reset(),this.onHoverAction.time=e,this.onHoverAction.timeScale=-1,this.onHoverAction.play()}}))),this.subs.push(this.inputIni.registerMeshHandler(w.R,S.s.isValue(this.meshes.interactionMesh),(()=>{this.stickyHover=!this.stickyHover,this.stickyHover?this.meshes.interactionMesh.material.color.set(4473924):this.meshes.interactionMesh.material.color.set(16724312)}))),this.inputIni.registerMesh(this.meshes.interactionMesh,!1),this.subs.push(e.volume.observe(this))}notify(){this.sourceDirty=!0}update(e,t){if(this.sourceDirty){this.sourceDirty=!1,this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.quaternion.copy(P(this.source));const e=x(this.source),t=this.onHoverAction.getClip().tracks[0].values;t[3]=e.x,t[4]=e.y,t[5]=e.z}this.meshes.setColor(t.inRange?65280:16711680),this.mixer.update(e/1e3)}dispose(){this.meshes.dispose(),this.mixer.stopAllAction();for(const e of this.subs)e.cancel()}}class O{constructor(e,t,i){this.sensor=e,this.scene=t,this.inputIni=i,this.subs=[],this.visuals=new Map}init(){this.subs.push(this.sensor.onReadingsUpdated(this))}render(e){for(const[t,i]of this.sensor.readings){let s=this.visuals.get(t);s||(s=new A(t,this.scene,this.inputIni),this.visuals.set(t,s)),s.update(e,i)}}dispose(){}activate(){}deactivate(){for(const e of this.subs)e.cancel();for(const e of this.visuals.values())e.dispose();this.visuals.clear()}notify(){}}class D extends s.Y{constructor(){super(...arguments),this.name="sensor-module",this.sensorUpdater=new f,this.debugSensor=null,this.sensorDisposer=new class{constructor(e){this.sensors=e}disposeSensor(e){this.sensors.removeSensor(e)}}(this)}async init(e,t){var i,s,n,o;[this.cameraData,this.raycaster,this.renderer,this.inputIni]=await Promise.all([await t.market.waitForData(g.M_),await t.getModule(p.default),await t.getModule(m.default),await t.getModule(u.default)]),this.cameraVolume=new h(this.cameraData),this.sensorDebuggerFactory=(i=e=>{t.addComponent(this,e)},s=e=>{t.removeComponent(this,e)},n=this.renderer.getScene(),o=this.inputIni,e=>{const t=new O(e,n,o);return i(t),{dispose:()=>{s(t)}}})}dispose(){this.cameraVolume.dispose()}createSensor(e){const t=new v(e,this.raycaster,this.sensorDisposer);return this.sensorUpdater.addSensor(t),t}createCameraBoundSensor(){return this.createSensor(this.cameraVolume)}setDebugSensor(e){this.debugSensor&&(this.debugSensor.dispose(),this.debugSensor=null),e&&(this.debugSensor=this.sensorDebuggerFactory(e))}onUpdate(){this.sensorUpdater.update()}removeSensor(e){this.sensorUpdater.removeSensor(e)}}var I=i(54564),C=i(49194),R=i(46841);const L=D;var N;!function(e){e.SPHERE="sourcetype.sphere",e.BOX="sourcetype.box",e.CYLINDER="sourcetype.cylinder"}(N||(N={}))},54564:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var s=i(2212),n=i(23812);class o extends n.${constructor(){super(),this.box=new s.ZzF,this.center=new s.Pa4,this.size=new s.Pa4(1/0,1/0,1/0),this.orientation=new s._fP,this.inverseOrientation=new s._fP,this.pointCache=new s.Pa4,this.transformNeedsUpdate=!1,this.box.setFromCenterAndSize(this.center,this.size)}get origin(){return this.center}updateCenter(e){this.center.copy(e),this.box.setFromCenterAndSize(this.center,this.size),this.transformNeedsUpdate=!0}updateDimensions(e){this.size.copy(e),this.box.setFromCenterAndSize(this.center,this.size)}updateOrientation(e){this.orientation.copy(e),this.transformNeedsUpdate=!0}containsPoint(e){return this.transformNeedsUpdate&&(this.transformNeedsUpdate=!1,this.inverseOrientation.copy(this.orientation).invert()),this.pointCache.copy(e).sub(this.center),this.pointCache.applyQuaternion(this.orientation),this.pointCache.add(this.center),this.box.containsPoint(this.pointCache)}}},49194:(e,t,i)=>{"use strict";i.d(t,{X:()=>o});var s=i(2212),n=i(23812);class o extends n.${constructor(){super(...arguments),this._basePoint=new s.Pa4,this._height=1/0,this._radius=1/0,this.pointCache=new s.Pa4}get origin(){return this._basePoint}get basePoint(){return this._basePoint}get height(){return this._height}get radius(){return this._radius}updateBasePoint(e){this.basePoint.set(e.x,e.y,e.z)}updateHeight(e){this._height=e}updateRadius(e){this._radius=e}containsPoint(e){return this.pointCache.set(e.x,this._basePoint.y,e.z),this._basePoint.distanceToSquared(this.pointCache)<=this.radius**2&&this._basePoint.y<=e.y&&e.y<=this._basePoint.y+this.height}}},46841:(e,t,i)=>{"use strict";i.d(t,{b:()=>o});var s=i(2212),n=i(23812);class o extends n.${constructor(){super(...arguments),this.origin=new s.Pa4,this.radius=1/0}updateRadius(e){this.radius=e}updateOrigin(e){this.origin.copy(e)}containsPoint(e){return this.origin.distanceToSquared(e)<=this.radius**2}}},12505:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});var s=i(2212);class n extends s.Kj0{}},79234:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var s=i(54122),n=i(2212),o=i(13441),r=i(81047),a=i(48101);const l={sky:{uniforms:{topColor:{type:"v3",value:new n.Pa4(.094,.102,.11)},bottomColor:{type:"v3",value:new n.Pa4(.2,.216,.235)},radius:{type:"f",value:100}},vertexShader:(0,a.m)(r,i(91411)),fragmentShader:(0,a.m)(o,i(451))}};class c extends n.FIo{constructor(e={}){super(Object.assign({fragmentShader:l.sky.fragmentShader,vertexShader:l.sky.vertexShader,uniforms:n.rDY.clone(l.sky.uniforms),name:"SkyboxMaterial"},e))}}var h=i(2779),d=i(12505),u=i(20599),p=i(64279);class m{constructor(e,t,i,s,n=h.o.ALL){this.scene=e,this.cameraData=t,this.addToRaycasting=i,this.removeFromRaycasting=s,this.renderLayer=n,this.bindings=[]}init(){const{visualMesh:e,colliderMesh:t}=this.setupSkysphere();this.skyVisual=e,this.material=this.skyVisual.material,this.skyCollider=t}dispose(){this.material.uniforms.pano0Map.value.dispose(),this.material.uniforms.pano1Map.value.dispose(),this.material.dispose(),this.skyVisual.geometry.dispose()}activate(e){this.scene.addChild(this.scene.ids.Root,this.skyVisual),this.skyVisual.updateMatrixWorld(!0),this.skyVisual.visible=!0,this.addToRaycasting(this.skyCollider,!1)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.removeChild(this.scene.ids.Root,this.skyVisual),this.scene.removeChild(this.scene.ids.CameraRig,this.skyCollider),this.removeFromRaycasting(this.skyCollider)}updateBackgroundColors(e,t){const i=new n.Ilk(e),s=new n.Ilk(t);this.material.uniforms.topColor.value.set(i.r,i.g,i.b),this.material.uniforms.bottomColor.value.set(s.r,s.g,s.b)}beforeRender(){this.skyVisual.position.copy(this.cameraData.pose.position),this.skyCollider.position.copy(this.cameraData.pose.position)}render(){}setupSkysphere(e){const t=new n.Aip(1e4,5,5);t.computeBoundingBox();const i=p.oR.far-10,s=new n.Aip(i,5,5);s.computeBoundingBox(),e||(e=new c({side:n._Li}));const o=new d.i(s,e);return o.layers.mask=this.renderLayer.mask,o.name="Skysphere",o.renderOrder=u.z.boundingSkybox,o.updateMatrixWorld(!0),e.uniforms.radius.value=i,e.depthWrite=!1,e.depthTest=!1,{visualMesh:o,colliderMesh:new d.i(t,new n.vBJ({opacity:0,depthWrite:!1,side:n._Li}))}}}var g=i(50101),f=i(30963),v=i(39936),y=i(78383),b=i(62431),w=i(89155);class S extends s.Y{constructor(){super(...arguments),this.name="skybox-module"}async init(e,t){const[i,s,n,o]=await Promise.all([t.getModule(g.default),t.market.waitForData(v.e),t.getModule(f.default),t.market.waitForData(w.M_)]),r=t.claimRenderLayer("skybox"),a=i.getScene();this.skybox=new m(a,o,n.registerMesh,n.unregisterMesh,r),t.addComponent(this,this.skybox);const l=s.tryGetProperty(b.gx.BackgroundColor,y.z.default);this.skybox.updateBackgroundColors(y.K[l].bgPrimary,y.K[l].bgSecondary),this.bindings.push(s.onPropertyChanged(b.gx.BackgroundColor,(e=>{this.skybox.updateBackgroundColors(y.K[e].bgPrimary,y.K[e].bgSecondary)})))}}},8639:(e,t,i)=>{"use strict";i.d(t,{E:()=>a,e:()=>l});var s=i(17513),n=i(99681),o=i(87131),r=i(21746);class a extends n.m{constructor(e){super(),this.id="CAPTURE_SNAPSHOT",this.payload={maxSize:e.maxSize||o.SL.ULTRAHIGH,aspect:e.aspect||r.g$,category:e.category||s.i.USER,onProgress:e.onProgress,getOverlay:e.getOverlay,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}class l extends n.m{constructor(e){super(),this.id="EQUIRECTANGULAR_SNAPSHOT",this.payload={onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}},58797:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>B});var s=i(54122),n=i(50101),o=i(77956),r=i(89155),a=i(71208),l=i(12775),c=i(16696),h=i(6518),d=i(84559),u=i(84564),p=i(28281),m=i(2779),g=i(87131),f=i(97620),v=i(8639),y=i(5442),b=i(26247),w=i(27829),S=i(21746),T=i(91055),E=i(19418),_=i(17617);class x extends _.y{constructor(e){super(e),this.name="SnapshotCaptureError"}}class M extends _.y{constructor(e){super(e),this.name="SnapshotUploadError"}}var P=i(17513),A=i(25799),O=i(22729),D=i(57369),I=i(62367),C=i(55525),R=i(92925),L=i(46086),N=i(944);const k=new A.Z("snapshot-editor"),F=p.Xd.uploadIntervalDelay;class B extends s.Y{constructor(){super(...arguments),this.name="snapshots-editor"}async init(e,t){this.engine=t,[this.renderer,this.sweepTilingModule]=await Promise.all([t.getModule(n.default),t.getModule(u.default)]),[this.sweepData,this.viewmodeData,this.cameraData,this.floorsViewData]=await Promise.all([t.market.waitForData(o.Z),t.market.waitForData(l.O),t.market.waitForData(r.M_),t.market.waitForData(O.c),t.market.waitForData(b.P)]),[this.snapshotTarget,this.snapshotOverlayTarget]=await Promise.all([t.commandBinder.issueCommandWhenBound(new c.oM),t.commandBinder.issueCommandWhenBound(new c.oM)]),this.bindings.push(t.commandBinder.addBinding(v.E,(async e=>{const i=e.onProgress||(0,y.Y)(0);i.value=10,t.commandBinder.issueCommand(new C.ZK);const s=await this.queryIdealResolution(e.maxSize,e.aspect);if(this.snapshotTarget.setSize(s.width,s.height),this.snapshotOverlayTarget.setSize(s.width,s.height),await this.fetchHighestAvailable(!1,e.maxSize,(e=>i.value=Math.max(10,e))),await(0,I.gw)(2*F),await this.takeScreenshot(),e.getOverlay){const i=await e.getOverlay(s.width,s.height);i&&(await t.commandBinder.issueCommand(new c.sH(this.snapshotOverlayTarget,i)),await t.commandBinder.issueCommand(new c.ep(this.snapshotTarget,this.snapshotOverlayTarget)))}const n=this.sweepData.getSweep(this.sweepData.currentSweep);this.viewmodeData.currentMode===a.Ey.Panorama&&await this.sweepTilingModule.revertTilingSettings(n.id),t.commandBinder.issueCommand(new C.Lp);let o=e.category;n&&(n.alignmentType===D.z9.UNALIGNED||n.placementType===D.hU.MANUAL)&&o===P.i.USER&&(o=P.i.UNALIGNED);const r=this.uploadAndAddSnapshot(o).then((e=>e&&e.sid)).catch((e=>{throw k.error(e),this.engine.broadcast(new E.q(e)),e}));return e.waitForUpload?r:null})));const i=w.f.FORWARD.clone(),s=w.f.FORWARD.clone();this.bindings.push(t.commandBinder.addBinding(v.e,(async e=>{const n=e.onProgress||(0,y.Y)(0);n.value=10,t.commandBinder.issueCommand(new C.ZK),await(0,I.gw)(50);const o=this.queryIdealEqResolution();this.snapshotTarget.setSize(o.width,o.height);const r=this.sweepData.getSweep(this.sweepData.currentSweep);i.copy(w.f.FORWARD).applyQuaternion(r.rotation).setY(0),s.copy(w.f.FORWARD).applyQuaternion(this.cameraData.pose.rotation).setY(0);const a=(0,T.k2)(i,s)+Math.PI;await this.fetchHighestAvailable(!0,g.SL.ULTRAHIGH,(e=>n.value=Math.max(10,e))),await this.takeEquirectangular(a),await this.sweepTilingModule.revertTilingSettings(r.id),t.commandBinder.issueCommand(new C.Lp);const l=(0,h.fY)(this.snapshotTarget.width,this.snapshotTarget.height,a,0),c=this.uploadAndAddSnapshot(P.i.PANORAMA,l).then((e=>e&&e.sid)).catch((e=>{throw k.error(e),this.engine.broadcast(new E.q(e)),e}));return e.waitForUpload?c:null})))}async uploadAndAddSnapshot(e,t){const i=this.createSnapshot(e);i.state=L.R.CAPTURING,i.imageBlob=(0,h.Xk)(await(0,h.vP)(this.snapshotTarget,t)),i.state=L.R.UPLOADING;try{return await this.engine.commandBinder.issueCommand(new N.nM(i))}catch(e){throw i.state=L.R.ERROR,k.error(e),new M("Failed to upload snapshot")}}createSnapshot(e){const t=this.viewmodeData.isPano();let i=(0,I.DZ)(new Date);if(t){const e=this.sweepData.getSweep(this.sweepData.currentSweep).name;e&&(i=e)}const s=new R.a;return s.name=i,s.category=e,s.is360=t&&!this.sweepData.currentAlignedSweepObject,s.metadata={cameraMode:this.viewmodeData.currentMode,cameraPosition:this.cameraData.pose.position.clone(),cameraQuaternion:this.cameraData.pose.rotation.clone(),orthoZoom:this.viewmodeData.currentMode===a.Ey.Floorplan?this.cameraData.zoom():-1,ssZoom:this.cameraData.zoom(),scanId:t?this.sweepData.currentSweep:void 0,floorId:this.floorsViewData.currentFloorId,floorVisibility:this.floorsViewData.getFloorsVisibility()},s}async queryIdealResolution(e=g.SL.ULTRAHIGH,t){let i=3840,s=i*S.LP;const n=this.renderer.maxTextureSize;if(i>n&&(k.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${n}`),i=n,s=i*S.LP),this.viewmodeData.currentMode===a.Ey.Panorama){const o=await this.sweepTilingModule.availableResolution(this.sweepData.currentSweepObject,e),r=d.Z.getPanoSize(o)*(this.cameraData.fovY()*f.MN)/90;i=Math.min(Math.round(r*t),n),s=Math.round(i/t)}return Promise.resolve({width:i,height:s})}queryIdealEqResolution(){let e=4096,t=.5*e;if(this.viewmodeData.currentMode!==a.Ey.Panorama)throw new x("Equirectangular capture is only supported in Panorama mode");const i=this.renderer.maxTextureSize;return e>i&&k.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${i}`),e=Math.min(i,e),t=.5*e,{width:e,height:t}}fetchHighestAvailable(e,t=g.SL.ULTRAHIGH,i){if(this.viewmodeData.currentMode===a.Ey.Panorama){const s=this.sweepData.currentSweepObject,n=e?u.DownloadQueueStyle.FullPanorama:u.DownloadQueueStyle.CurrentView;return this.sweepTilingModule.requestResolution(s,t,n,!0).then((e=>{const t=this.sweepTilingModule.waitForQueue(n,e);return i&&t.progress((e=>i(e*B.captureProgressFudgeFactor))),t}))}return i&&i(B.captureProgressFudgeFactor),Promise.resolve()}takeScreenshot(){const e=m.o.ALL;e.removeLayers(this.engine.getRenderLayer("grid-underlay")),e.removeLayers(this.engine.getRenderLayer("cursor-mesh")),e.removeLayers(this.engine.getRenderLayer("current-pano-marker"));const t=this.renderer.getScene().scene,i=this.renderer.getScene().camera,s=i.layers.mask;return i.layers.mask=e.mask,this.engine.commandBinder.issueCommand(new c.vU(this.snapshotTarget,t,i)).then((()=>{i.layers.mask=s}))}takeEquirectangular(e){const t=this.sweepData.currentSweep,i=this.sweepTilingModule.getRenderer(),s=i.useTexture(t),n=this.engine.commandBinder.issueCommand(new c.fZ(this.snapshotTarget,s,e));return i.freeTexture(t),n}}B.captureProgressFudgeFactor=90},19418:(e,t,i)=>{"use strict";i.d(t,{q:()=>n});var s=i(93528);class n extends s.v{constructor(e){super()}}},92925:(e,t,i)=>{"use strict";i.d(t,{a:()=>r});var s=i(78909),n=i(71208),o=i(17513);class r extends s.T{constructor(){super(),this.category=o.i.USER}clone(){return(new r).copy(this)}copy(e){return this.sid=e.sid,this.thumbnailUrl=e.thumbnailUrl,this.imageUrl=e.imageUrl,this.name=e.name,this.is360=e.is360,this.category=e.category,this.height=e.height,this.width=e.width,this.created=e.created,this.modified=e.modified,this.visionLabel=e.visionLabel,this.visionName=e.visionName,this.imageBlob=e.imageBlob,this.metadata={cameraMode:e.metadata.cameraMode,cameraPosition:e.metadata.cameraPosition.clone(),cameraQuaternion:e.metadata.cameraQuaternion.clone(),scanId:e.metadata.scanId,orthoZoom:e.metadata.orthoZoom,ssZoom:e.metadata.ssZoom,floorId:e.metadata.floorId,floorVisibility:e.metadata.floorVisibility},this.commit(),this}isInsidePano(){return this.metadata.cameraMode===n.Ey.Panorama&&""!==this.metadata.scanId}refresh(e){this.thumbnailUrl.refreshFrom(e.thumbnailUrl),this.imageUrl.refreshFrom(e.imageUrl)}}},17513:(e,t,i)=>{"use strict";var s;i.d(t,{i:()=>s}),function(e){e.USER="user",e.PANORAMA="panorama",e.UNALIGNED="unaligned",e.AUTO="auto",e.TOUR="tour"}(s||(s={}))},46086:(e,t,i)=>{"use strict";var s;i.d(t,{R:()=>s}),function(e){e.CAPTURING="capturing",e.UPLOADING="uploading",e.ERROR="error",e.DONE="done"}(s||(s={}))},944:(e,t,i)=>{"use strict";i.d(t,{yz:()=>n,Ad:()=>o,nM:()=>r});var s=i(99681);class n extends s.m{constructor(e,t){super(),this.id="RENAME_SNAPSHOT",this.payload={id:e,name:t}}}class o extends s.m{constructor(e){super(),this.id="DELETE_SNAPSHOT",this.payload={id:e}}}class r extends s.m{constructor(e){super(),this.id="UPLOAD_SNAPSHOT",this.payload={snapshot:e}}}},26247:(e,t,i)=>{"use strict";i.d(t,{P:()=>r});var s=i(19413),n=i(62367),o=i(68519);class r extends s.V{constructor(e){super(),this.name="snapshots",this.snapshots={};for(const t in e)this.snapshots[t]=e[t].clone()}get(e){return this.snapshots[e]}get collection(){return this.snapshots}add(e){e.sid=this.validateSid(e.sid),this.snapshots[e.sid]=e,this.updateOnStaleCallbacks(),this.commit()}remove(e){delete this.snapshots[e.sid],this.commit()}validateSid(e){for(;!e||this.snapshots[e];)e=(0,n.O1)(11);return e}clone(){return new r(this.snapshots)}set onStale(e){this.hydrate=e,this.updateOnStaleCallbacks()}updateOnStaleCallbacks(){this.hydrate&&(0,o.s)(this.snapshots,(async()=>{const e=await this.hydrate();for(const t in this.snapshots)e&&e[t]&&this.snapshots[t].refresh(e[t])}))}}},88635:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>V});var s=i(54122),n=i(17256),o=i(71208),r=i(25799),a=i(77956),l=i(26247),c=i(24411),h=i(32400),d=i(51770),u=i(70096),p=i(62749),m=i(60268),g=i(97620),f=i(40032),v=i(17513);const y={[o.Ey.Dollhouse]:p.w.DOLLHOUSE,[o.Ey.Floorplan]:p.w.FLOORPLAN,[o.Ey.Panorama]:p.w.PANORAMA,[o.Ey.Outdoor]:p.w.PANORAMA,[o.Ey.Transition]:p.w.MESH};class b{constructor(){}serialize(e,t){const i=[];for(const[s,n]of e.metadata.floorVisibility.entries())if(1===n){const e=t.floorsData.getFloorAtIndex(s);e&&i.push(e.id)}return{label:e.name,contents:{filename:`${e.name}.jpg`,blob:e.imageBlob},snapshotLocation:{anchorId:e.metadata.scanId,visibleFloorIds:i,position:(0,f.m)(g.ep.toVisionVector(e.metadata.cameraPosition)),rotation:(0,f.J5)(g.ep.toVisionCameraQuaternion(e.metadata.cameraQuaternion)),viewMode:y[e.metadata.cameraMode],zoom:e.metadata.cameraMode===o.Ey.Floorplan?e.metadata.orthoZoom:e.metadata.ssZoom},photoType:e.category===v.i.PANORAMA?m.B.EQUIRECTANGULAR:m.B.PHOTO2D}}}const w=new r.Z("mds-snapshot-store");class S extends h.u{constructor(){super(...arguments),this.deserializer=new u.f,this.serializer=new b}async read(){const e=this.getViewId();return this.query(c.GetSnapshots,{modelId:e}).then((e=>{const t=((0,d.qw)(e,"data.model.assets.photos")||[]).map((e=>this.deserializer.deserialize(e))),i={};for(const e of t)e&&(i[e.sid]=e);return i}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read().finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async create(e,t){var i;const s=h.u.baseViewId,n=e.category===v.i.TOUR,o=n?"UploadHighlightReelSnapshot":"UploadModelSnapshot",r=n?c.UploadHighlightReelSnapshot:c.UploadModelSnapshot,a=this.serializer.serialize(e,t),l=await this.client.upload(r,o,Object.assign(Object.assign({},a),{modelId:s}));if(l.errors&&l.errors.length>0)throw w.error(l.errors),new Error("Snapshot creation failed");return this.deserializer.deserialize(null===(i=l.data)||void 0===i?void 0:i.snapshot)}async update(e){const t=h.u.baseViewId,i=await this.client.mutate(c.PatchPhoto,{modelId:t,photoId:e.sid,label:e.name});if(i.errors&&i.errors.length>0)throw w.error(i.errors),new Error("Failed to update snapshot");const s=(0,d.qw)(i,"data.patchPhoto");return this.deserializer.deserialize(s)}async delete(e){const t=h.u.baseViewId,i=await this.client.mutate(c.DeletePhoto,{modelId:t,photoId:e});if(i.errors&&i.errors.length>0)throw w.error(i.errors),new Error("Failed to delete snapshot");return(0,d.qw)(i,"data.deletePhoto")||!1}}var T=i(944),E=i(96832),_=i(25936),x=i(83852),M=i(61111);const P=new r.Z("MpWebSnapshotSerializer");class A{serialize(e){if(!this.validate(e))return P.info("Cannot serialize invalid snapshot",e),null;const t={camera_mode:(0,o.tU)(e.metadata.cameraMode),camera_position:(0,g.gj)(e.metadata.cameraPosition),camera_quaternion:(0,f.J5)((0,g.EV)(e.metadata.cameraQuaternion)),ortho_zoom:e.metadata.orthoZoom,ss_zoom:e.metadata.ssZoom,scan_id:e.metadata.scanId,is_ortho:e.metadata.cameraMode===o.Ey.Floorplan,floorVisibility:e.metadata.floorVisibility},i=e.category,s=`${e.name}.jpg`;return{src:[e.imageBlob,s],name:e.name,metadata:JSON.stringify(t),category:i}}validate(e){return!!e.imageBlob}}var O,D=i(68519);!function(e){e.AUTO="auto",e.PANORAMA="panorama",e.TOUR="tour",e.UNALIGNED="unaligned",e.USER="user"}(O||(O={}));var I=i(2212),C=i(92925),R=i(46086);const L=new r.Z("MpWebSnapshotDeserializer"),N={[O.AUTO]:v.i.AUTO,[O.PANORAMA]:v.i.PANORAMA,[O.TOUR]:v.i.TOUR,[O.UNALIGNED]:v.i.UNALIGNED,[O.USER]:v.i.USER};class k{deserialize(e){const t=this.validate(e);if(!t)return L.debug("Deserialized invalid snapshot",e),null;const i=(0,o.Lm)(3===t.metadata.camera_mode?0:t.metadata.camera_mode),s=(0,g.gj)(t.metadata.camera_position?t.metadata.camera_position:new I.Pa4);let n=(0,g.EV)(t.metadata.camera_quaternion||new I._fP);i!==o.Ey.Floorplan&&(n=(0,g.Z)(n));let r=null;const a=t.metadata.floorVisibility;if("object"==typeof a)for(let e=0;e<a.length;e++)a[e]&&(r=e.toString());const l=t.metadata.highest_floor;"number"==typeof l&&l>-1&&(r=l.toString());const c={cameraMode:i,cameraPosition:s,cameraQuaternion:n,scanId:t.metadata.scan_id||"",orthoZoom:t.metadata.ortho_zoom,floorId:r,ssZoom:t.metadata.ss_zoom||1,floorVisibility:t.metadata.floorVisibility},h=N[t.category];return(new C.a).copy({sid:t.sid,state:R.R.DONE,metadata:c,thumbnailUrl:new D.n(t.thumbnail_signed_src,null),imageUrl:new D.n(t.signed_src,null),name:t.name,is360:"unaligned"===t.category,category:h,height:t.height,width:t.width,modified:new Date(Date.parse(t.modified)),created:new Date(Date.parse(t.created)),visionLabel:t.vision_generated_label,visionName:t.vision_generated_name})}validate(e){if(!e)return null;let t;try{t=JSON.parse(e.metadata)}catch(t){return L.info("Failed to parse image metadata: ",e.metadata),null}return 0===Object.keys(t).length||"assetType"in t?null:e.category in N?Object.assign(Object.assign({},e),{metadata:t}):(L.debug(`Invalid snapshot category ${e.category}`),null)}}var F=i(64519),B=i(80034),U=i(35135);class H extends F.n{constructor(e){super(e),this.serializer=new A,this.deserializer=new k}async refresh(){throw new x.n("Refresh not implemented for mp_web images")}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;if(i=U.t.model?U.t.model:await this.request(B.w$.GET,t),!i||!Array.isArray(i.images))return null;const s={};for(const e of i.images){const t=this.deserializer.deserialize(e);t&&(s[t.sid]=t)}return s}async create(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const s=this.serializer.serialize(e);if(!s)throw new Error("Failed to upload image");const n=new FormData;for(const[e,t]of Object.entries(s))Array.isArray(t)&&t[0]instanceof Blob?n.append(e,...t):n.append(e,t);const o=`/api/v1/player/models/${t}/images/`,r=await this.request(B.w$.POST,o,{body:n});return this.deserializer.deserialize(r)}async update(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const s={name:e.name},n=`/api/v1/player/models/${t}/images/${e.sid}`,o=await this.request(B.w$.PATCH,n,{body:s});return this.deserializer.deserialize(o)}async delete(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const s=`/api/v1/player/models/${t}/images/${e}`;return await this.request(B.w$.DELETE,s),!0}}const G=new r.Z("snapshots");class V extends s.Y{constructor(){super(...arguments),this.name="snapshots-data"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.getStore(e);const s=await this.store.read()||{};this.sweepData=await t.market.waitForData(a.Z);for(const e in s)this.processSnapshot(s[e]);this.snapshotsData=new l.P(s),this.snapshotsData.onStale=()=>this.store.read(),t.market.register(this,l.P,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(T.nM,(({snapshot:e})=>this.uploadSnapshot(e))),t.commandBinder.addBinding(T.yz,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(T.Ad,(({id:e})=>this.deleteSnapshot(e))))}async uploadSnapshot(e){const t=await this.engine.market.waitForData(_.i),i=await this.store.create(e,{floorsData:t});return i&&(this.processSnapshot(i),this.snapshotsData.add(i),this.engine.broadcast(new E.t(i))),i}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);if(t!==i.name)return i.name=t,i.commit(),this.snapshotsData.commit(),this.store.update(i)}async deleteSnapshot(e){return this.store.delete(e)}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:s}=e,o=e.storageProvider||n.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;return G.info(`Loading Snapshots from ${o}`),o===n.Xq.MDS?new S({readonly:r,baseUrl:i}):new H({modelId:t,readonly:r,queue:s,baseUrl:i})}processSnapshot(e){const t=e.metadata.cameraMode===o.Ey.Panorama,i=!this.sweepData.isSweepAligned(e.metadata.scanId);if(e.is360=t&&i,t){const t=this.sweepData.getSweep(e.metadata.scanId);t&&e.metadata.cameraPosition.copy(t.position)}e.name.match(/^[0-9.]+_[0-9.]+$/)&&(e.name="")}}},96832:(e,t,i)=>{"use strict";i.d(t,{t:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.snapshot=e}}},70096:(e,t,i)=>{"use strict";i.d(t,{f:()=>y});var s,n,o=i(2212);!function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(s||(s={})),function(e){e.USER="user",e.VISION="vision"}(n||(n={}));var r=i(99555),a=i(62749),l=i(60268),c=i(71208),h=i(25799),d=i(97620),u=i(51770),p=i(32020),m=i(92925),g=i(17513),f=i(68519);const v=new h.Z("mds-snapshot-deserializer");class y{deserialize(e){if(!e||!this.validate(e))return v.debug("Deserialized invalid Snapshot data from MDS",e),null;const t=new m.a;t.sid=e.id,t.thumbnailUrl=new f.n(e.thumbnailUrl||"",(0,p.p)(e.validUntil,null)),t.imageUrl=new f.n(e.presentationUrl||"",(0,p.p)(e.validUntil,null)),t.name=e.label||"",t.category=this.getCwfSnapshotCategory(e)||g.i.USER,t.width=e.width||0,t.height=e.height||0,t.created=(0,p.p)(e.created),t.modified=(0,p.p)(e.modified),t.visionLabel=e.classification||"";const i=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");t.is360=!(!i||i===r.b.AUTO);const{snapshotLocation:s}=e;if(s){const e=s.position?d.ep.fromVisionVector(s.position):new o.Pa4,i=s.rotation?d.ep.fromVisionCameraQuaternion(s.rotation):new o._fP,n=this.getCwfViewmode(s.viewMode)||c.Ey.Panorama,r=[];for(const e of s.floorVisibility){for(let t=0;t<e.sequence;t++)r[t]=r[t]||0;r[e.sequence]=1}t.metadata={cameraMode:n,cameraPosition:e,cameraQuaternion:i,scanId:s.anchor&&s.anchor.id||"",orthoZoom:n===c.Ey.Floorplan?s.zoom:-1,ssZoom:s.zoom||1,floorId:s.floorVisibility.length>0?s.floorVisibility[0].id:null,floorVisibility:r}}return t}validate(e){var t;if(!(null===(t=e.snapshotLocation)||void 0===t?void 0:t.position))return!1;const i=["id","snapshotLocation","thumbnailUrl","presentationUrl"].every((t=>t in e)),s=null!==this.getCwfSnapshotCategory(e);return i&&s}getCwfViewmode(e){const t={[a.w.DOLLHOUSE]:c.Ey.Dollhouse,[a.w.PANORAMA]:c.Ey.Panorama,[a.w.FLOORPLAN]:c.Ey.Floorplan,[a.w.MESH]:c.Ey.Panorama};return e in t?t[e]:null}getCwfSnapshotCategory(e){if(e.category===s.TOUR)return g.i.TOUR;if(e.origin===n.VISION)return g.i.AUTO;if(e.type===l.B.EQUIRECTANGULAR)return g.i.PANORAMA;const t=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");return e.type===l.B.PHOTO2D?t===r.b.MANUAL?g.i.UNALIGNED:g.i.USER:null}}},32400:(e,t,i)=>{"use strict";i.d(t,{u:()=>l});var s=i(83852),n=i(11340),o=i(25799),r=i(61111);const a=new o.Z("mds-store");class l{constructor(e={readonly:!0}){this.viewId=null;const{queue:t,baseUrl:i,viewId:s}=e;this.config=e,this.client=new n.o({queue:t,baseUrl:i}),s&&(this.viewId=s)}async create(...e){throw new s.n}async read(){throw new s.n}async update(...e){throw new s.n}async delete(...e){throw new s.n}query(e,t,i){if(!this.getViewId())throw new r.SN;return this.client.query(e,t,i)}mutate(e,t,i){const{readonly:s}=this.config;if(s)throw new r.d7;if(!this.getViewId())throw new r.SN;return this.client.mutate(e,t,i).then((e=>{if(e.errors&&e.errors.length>0)throw a.error(Object.assign({},e)),new r.w0;return e}))}getViewId(){return this.viewId||l.currentViewId||l.baseViewId}static setCurrentViewId(e){l.currentViewId=e}static setBaseViewId(e){l.baseViewId=e}}l.baseViewId=null,l.currentViewId=null},64519:(e,t,i)=>{"use strict";i.d(t,{n:()=>c});var s=i(83852),n=i(25799),o=i(20331),r=i(26149),a=i(80034);const l=new n.Z("MpWebStore");class c{constructor(e){const{queue:t}=e;this.queue=t||new o.gO,this.config=e}getRequestOptions(e){return{responseType:"json",auth:(0,r.PW)(e)}}getCachedResponse(e,t=a.w$.GET){if(t===a.w$.GET&&e in c.cache)return l.info(`Loaded ${e} from cache`),c.cache[e]}setCachedResponse(e,t){c.cache[e]=t}async request(e,t,i={}){const{baseUrl:s}=this.config,n=Object.assign(Object.assign({},this.getRequestOptions(`${s}${t}`)),i),o=this.getCachedResponse(t,e);if(o)return o;const r=await this.queue.request(e,`${s}${t}`,n);return r&&this.setCachedResponse(t,r),r}async read(){throw new s.n}}c.cache={}},35135:(e,t,i)=>{"use strict";i.d(t,{t:()=>s});class s{static get model(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.sid?e:void 0}static get hasPassword(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.has_public_access_password}}},14567:(e,t,i)=>{"use strict";i.d(t,{Q:()=>c});var s=i(19413),n=i(25799),o=i(17256),r=i(61111),a=i(32400);const l=new n.Z("storage-data");class c extends s.V{constructor(e,t={}){super(),this.lastPublished=null,this.hasUnpublishedChanges=!1,this.publishingEnabled=!1,this.saveEnabled=!1,this.revertEnabled=!1,this.transactionState=o.g7.IDLE,this.views=[],this.unpublished=new Set,this.revertable=new Set,this.currentViewId=e,Object.assign(this,t)}setCurrentView(e){if(e===this.currentViewId)return;const t=this.getView(e);if(!t)throw new r.SN("View not found");l.debug(`Active view set to ${e} (${t.viewType})`),this.currentViewId=e,a.u.setCurrentViewId(e),this.togglePublishingFeatures(),this.commit()}getCurrentView(){return this.getView(this.currentViewId)}getCurrentViewId(){return this.currentViewId}setTransactionState(e){if(e!==this.transactionState){if(![this.transactionState,e].includes(o.g7.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${e}`);this.transactionState=e,this.commit()}}setViews(e){this.views=e,this.togglePublishingFeatures(),this.commit()}setUnpublished(...e){for(const t of e)this.unpublished.add(t);this.hasUnpublishedChanges=this.unpublished.size>0,this.commit()}clearUnpublished(...e){if(e.length)for(const t of e)this.unpublished.delete(t);else this.unpublished.clear();this.unpublished.size||(this.hasUnpublishedChanges=!1),this.commit()}getUnpublished(){return[...this.unpublished]}getRevertable(){return[...this.revertable]}setRevertable(...e){for(const t of e)this.revertable.add(t);this.commit()}clearRevertable(...e){if(e.length)for(const t of e)this.revertable.delete(t);else this.revertable.clear();this.commit()}getView(e){return this.views.find((t=>t.id===e))}getViewByType(e){return this.views.find((t=>t.viewType===e))}togglePublishingFeatures(){const e=this.getCurrentView();e&&e.viewType===o.XZ.SESSION?(this.publishingEnabled=!0,this.revertEnabled=!0,this.saveEnabled=!0):(this.publishingEnabled=!1,this.revertEnabled=!1,this.saveEnabled=!0),this.commit()}}},97631:(e,t,i)=>{"use strict";i.d(t,{F:()=>N});var s,n=i(41263),o=i(54122),r=i(57501),a=i(11340),l=i(89155),c=i(87694),h=i(22729),d=i(77956),u=i(12775),p=i(21265),m=i(96041),g=i(25799),f=i(51770),v=i(44333),y=i(14567),b=i(61111),w=i(34170),S=i(17256);!function(e){e.IMAGE="image",e.FLOORS="floors",e.MEASUREMENT_PATHS="measurementPaths",e.MATTERTAGS="mattertags",e.LABELS="labels",e.HIGHLIGHT_REEL="highlightReel",e.SWEEPS="sweeps",e.PLAYER_OPTIONS="playerOptions"}(s||(s={}));class T{constructor(e={}){Object.assign(this,e)}}const E=new g.Z("mds-mergediff-deserializer"),_={[S.g.FLOORS]:s.FLOORS,[S.g.MEASUREMENTS]:s.MEASUREMENT_PATHS,[S.g.MATTERTAGS]:s.MATTERTAGS,[S.g.LABELS]:s.LABELS,[S.g.HIGHLIGHTS]:s.HIGHLIGHT_REEL,[S.g.SWEEPS]:s.SWEEPS,[S.g.SETTINGS]:s.PLAYER_OPTIONS,[S.g.START_LOCATION]:s.IMAGE,[S.g.BLURS]:void 0},x={[s.IMAGE]:S.g.START_LOCATION,[s.FLOORS]:S.g.FLOORS,[s.MEASUREMENT_PATHS]:S.g.MEASUREMENTS,[s.MATTERTAGS]:S.g.MATTERTAGS,[s.LABELS]:S.g.LABELS,[s.HIGHLIGHT_REEL]:S.g.HIGHLIGHTS,[s.SWEEPS]:S.g.SWEEPS,[s.PLAYER_OPTIONS]:S.g.SETTINGS};class M{deserialize(e){if(!(e&&e.src&&e.dest&&e.typesModified))return E.debug("Deserialized invalid merge diff from MDS",e),null;const t=[];for(const i of e.typesModified)i in x&&t.push(x[i]);return new T({srcId:e.src,targetId:e.dest,dataTypes:t})}}class P{constructor(e={}){this.viewType=null,Object.assign(this,e)}}const A=new g.Z("mds-modelview-deserializer");class O{deserialize(e){return e&&e.id&&e.type?new P({id:e.id,viewType:this.getModelViewType(e.type),rawViewType:e.type}):(A.debug("Deserialized invalid ModelView data from MDS",e),null)}getModelViewType(e){const t={"matterport.workshop.session":S.XZ.SESSION,"matterport.model.default":S.XZ.BASE,"trueplan.session":S.XZ.TRUEPLAN};return e in t?t[e]:null}}var D=i(32400),I=i(20517),C=i(30853),R=i(9713);const L=new g.Z("storage");class N extends o.Y{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.revertHandlers=new Set,this.publishHandlers=new Set,this.lock=new m.H}async init(e,t){const{baseUrl:i,queue:s}=e;if(this.config=e,this.engine=t,this.client=new a.o({baseUrl:i,queue:s}),this.data=new y.Q(e.modelId),t.market.register(this,y.Q,this.data),!e.mdsEnabled){this.data.publishingEnabled=!0;const e=n.b3.globalSession;e&&e.lastPublished&&(this.data.lastPublished=e.lastPublished.getTime())}D.u.setBaseViewId(e.modelId),this.bindings.push(t.commandBinder.addBinding(v.R_,(()=>this.publish())),t.commandBinder.addBinding(v.qz,(e=>this.revert(e.dataTypes))),t.commandBinder.addBinding(v.VQ,(e=>this.save(e.dataTypes))),t.commandBinder.addBinding(v.dS,(e=>this.setDefaultViewType(e.viewType)))),this.registerSettings()}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}onPublish(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>this.publishHandlers.add(i)),(()=>this.publishHandlers.delete(i)),!0)}onRevert(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>{this.revertHandlers.add(i),this.updateRevertableTypes()}),(()=>{this.revertHandlers.delete(i),this.updateRevertableTypes()}),!0)}async publish(){const{mdsEnabled:e}=this.config,t=await this.lock.lock(),i=e=>{throw L.error(e),t.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.aT(e)),new b.X4(e.message)},{before:s,on:o,after:r}=this.getCallbacksByPhase(this.publishHandlers);if(o.push((()=>n.b3.publishAll())),e){const e=this.data.getViewByType(S.XZ.SESSION);e&&o.push((()=>this.mergeView(e.id)))}L.debug("Publishing..."),this.data.setTransactionState(S.g7.PUBLISHING),await Promise.all(s.map((e=>e()))).catch(i),await Promise.all(o.map((e=>e()))).catch(i),this.data.lastPublished=Date.now(),this.data.commit(),this.data.clearUnpublished(),await Promise.all(r.map((e=>e()))).catch(i),t.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.zK),L.debug("Publishing completed")}async revert(e=[]){const{mdsEnabled:t}=this.config,i=await this.lock.lock(),s=t=>{throw L.error(t),i.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.Kx(t,e)),new b.mE(t.message)},{before:n,on:o,after:r}=this.getCallbacksByPhase(this.revertHandlers,e);if(t){const t=this.data.getViewByType(S.XZ.SESSION);if(!t)return void s(new b.SN);o.push((()=>this.revertView(t.id,e)))}L.debug(`Reverting ${[...e].join(", ")}...`),this.data.setTransactionState(S.g7.REVERTING),await Promise.all(n.map((e=>e()))).catch(s),await Promise.all(o.map((e=>e()))).catch(s),await Promise.all(r.map((e=>e()))).catch(s),i.unlock(),this.data.setTransactionState(S.g7.IDLE),this.data.clearUnpublished(...e),this.engine.broadcast(new w.F1(e)),L.debug(`Reverting ${[...e].join(", ")} completed`)}async save(e){const{before:t,on:i,after:s}=this.getCallbacksByPhase(this.saveHandlers,e),n=await this.lock.lock(),o=t=>{throw L.error(t),n.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.dz(t,e)),new b.OX(t.message)};L.debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(S.g7.SAVING),await Promise.all(t.map((e=>e()))).catch(o),await Promise.all(i.map((e=>e()))).catch(o),await Promise.all(s.map((e=>e()))).catch(o),this.data.publishingEnabled&&this.data.setUnpublished(...e),n.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.xj(e)),L.debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(S.g),s=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),n={[S.Q.BEFORE]:[],[S.Q.ON]:[],[S.Q.AFTER]:[]};return s.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),n)}async setDefaultViewType(e){await this.loadViews();const t=this.data.getViewByType(e),i=this.data.getCurrentView();if(t&&i&&i.viewType===S.XZ.BASE)return L.debug(`Switching to default view type '${e}'`),this.switchToView(t.id)}async switchToView(e){const t=this.data.getView(e);if(!t||e===this.data.getCurrentViewId())return;this.data.setCurrentView(t.id);const i=await this.getViewDiff(t.id);i&&i.dataTypes&&this.data.setUnpublished(...i.dataTypes)}updateRevertableTypes(){const e=new Set;for(const{dataType:t,phase:i}of this.revertHandlers)t&&i===S.Q.ON&&e.add(t);this.data.setRevertable(...e)}async loadViews(){if(!this.config.mdsEnabled)return;const{modelId:e}=this.config,t=new O,i=await this.client.query(I.GetViews,{modelId:e}),s=(0,f.qw)(i,"data.model.views"),n=[];if(s)for(const e of s){const i=t.deserialize(e);i&&n.push(i)}this.data.setViews(n)}async getViewDiff(e){if(!this.config.mdsEnabled)return null;const t=new M,i=await this.client.query(I.GetMergeDiff,{viewId:e}),s=(0,f.qw)(i,"data.model.mergeDiff");return t.deserialize(s)}async revertView(e,t=[]){const i=t.map((e=>_[e])).filter((e=>!!e)),s=await this.client.query(I.RevertView,{viewId:e,mergeTypes:i});if(s&&s.errors)throw new Error("Failed to revert view")}async mergeView(e){const t=await this.client.query(I.PublishView,{viewId:e});if(t&&t.errors)throw new Error("Failed to merge layers")}async reloadWorkshop(e={}){const{market:t}=this.engine,{useCurrentLocation:i=!1}=e;let s={};if(i){const[e,i,n,o]=await Promise.all([t.waitForData(d.Z),t.waitForData(u.O),t.waitForData(h.c),t.waitForData(l.M_)]);s=c.K.serialize({cameraData:o,viewmodeData:i,floorsViewData:n,sweepData:e})}s.edit="1",s.qs="1",p.Vf(s)}async registerSettings(){const{mdsEnabled:e}=this.config;(await this.engine.getModule(C.default)).registerSetting("Storage",R.$,e,!1)}}},26856:(e,t,i)=>{"use strict";i.d(t,{T:()=>s});class s{constructor(){this.handlers=[]}}},44333:(e,t,i)=>{"use strict";i.d(t,{R_:()=>n,qz:()=>o,VQ:()=>r,dS:()=>a});var s=i(99681);class n extends s.m{constructor(){super(...arguments),this.id="PUBLISH_COMMAND"}}class o extends s.m{constructor(e){super(),this.id="REVERT_COMMAND",this.payload=e}}class r extends s.m{constructor(e){super(),this.id="SAVE_COMMAND",this.payload=e}}class a extends s.m{constructor(e){super(),this.id="SET_DEFAULT_VIEW_TYPE_COMMAND",this.payload=e}}},17256:(e,t,i)=>{"use strict";var s,n,o,r,a;i.d(t,{g7:()=>s,Q:()=>n,g:()=>o,XZ:()=>r,Xq:()=>a}),function(e){e.IDLE="idle",e.REVERTING="reverting",e.PUBLISHING="publishing",e.SAVING="saving"}(s||(s={})),function(e){e.ON="on",e.BEFORE="before",e.AFTER="after"}(n||(n={})),function(e){e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps",e.BLURS="blurs"}(o||(o={})),function(e){e.BASE="base",e.TRUEPLAN="trueplan",e.SESSION="session"}(r||(r={})),function(e){e.MDS="mds",e.JSONSTORE="jsonstore"}(a||(a={}))},61111:(e,t,i)=>{"use strict";i.d(t,{X4:()=>n,mE:()=>o,OX:()=>r,d7:()=>a,SN:()=>l,Zb:()=>c,w0:()=>h});var s=i(17617);class n extends s.y{constructor(e){super(e||"Failed to publish changes"),this.name="Publish"}}class o extends s.y{constructor(e){super(e||"Failed to revert unpublished changes"),this.name="Revert"}}class r extends s.y{constructor(e){super(e||"Failed to save changes"),this.name="Save"}}class a extends s.y{constructor(e){super(e||"Store is currently in read-only mode"),this.name="ReadOnly"}}class l extends s.y{constructor(e){super(e||"Invalid view"),this.name="InvalidView"}}class c extends s.y{constructor(e){super(e||"Could not read from MDS storage"),this.name="MdsRead"}}class h extends s.y{constructor(e){super(e||"Could not write to MDS storage"),this.name="MdsWrite"}}},52721:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PublishCommand:()=>s.R_,RevertCommand:()=>s.qz,SaveCommand:()=>s.VQ,SetDefaultViewTypeCommand:()=>s.dS,DataType:()=>n.g,ModelViewType:()=>n.XZ,StorageProvider:()=>n.Xq,TransactionPhase:()=>n.Q,TransactionState:()=>n.g7,InvalidViewError:()=>o.SN,MdsReadError:()=>o.Zb,MdsWriteError:()=>o.w0,PublishException:()=>o.X4,ReadOnlyException:()=>o.d7,RevertException:()=>o.mE,SaveException:()=>o.OX,DataPublishedMessage:()=>r.zK,DataRevertedMessage:()=>r.F1,DataSavedMessage:()=>r.xj,PublishErrorMessage:()=>r.aT,RevertErrorMessage:()=>r.Kx,SaveErrorMessage:()=>r.dz,StorageAnalytics:()=>a.T,SETTING_MDS_ENABLED:()=>l.$,StorageData:()=>c.Q,MdsStore:()=>h.u,default:()=>d.F});var s=i(44333),n=i(17256),o=i(61111),r=i(34170),a=i(26856),l=i(9713),c=i(14567),h=i(32400),d=i(97631)},34170:(e,t,i)=>{"use strict";i.d(t,{xj:()=>n,zK:()=>o,F1:()=>r,dz:()=>a,Kx:()=>l,aT:()=>c});var s=i(93528);class n extends s.v{constructor(e){super(),this.dataTypes=e}}class o extends s.v{}class r extends s.v{constructor(e){super(),this.dataTypes=e}}class a extends s.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class l extends s.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class c extends s.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}},9713:(e,t,i)=>{"use strict";i.d(t,{$:()=>s});const s="storage/mds_enabled"},80034:(e,t,i)=>{"use strict";i.d(t,{w$:()=>s,gh:()=>a,yh:()=>l,MU:()=>c});var s,n=i(26149),o=i(62367),r=i(1143);!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS"}(s||(s={}));class a extends class{constructor(){this._options={responseType:"json"}}get options(){const e=this._options;return e.auth=(0,n.PW)(this.url),(0,r.iF)(e),e}}{constructor(e){super(),this.config=e,this.url=e.path}async read(){const{deserialize:e}=this.config;let t=null;return this.config.cachedData&&this.config.cachedData.data?t=this.config.cachedData.data:(t=await this.config.queue.get(this.config.path,this.options),this.config.cachedData&&(this.config.cachedData.data=t)),e(t)}clearCache(){this.config.cachedData&&(this.config.cachedData.data=null)}}class l extends a{constructor(e){super(e),this.config=e}async create(e){this.clearCache();const{serialize:t}=this.config,i=t(e),s=Object.assign(Object.assign({},this.options),{body:i});return this.config.queue.put(this.config.path,s)}async update(e,t){this.clearCache();const{serialize:i}=this.config,n=i(e,t),o=Object.assign(Object.assign({},this.options),{body:n});return this.config.queue.request(this.config.httpMethod||s.POST,this.config.path,o)}async delete(e){if(this.clearCache(),!(e instanceof Array))return this.config.queue.delete(this.config.path,this.options);for(const t of e)await this.config.queue.delete(`${this.config.path}/${t.sid}`,this.options)}get acceptsPartial(){return this.config.httpMethod===s.PATCH}}class c extends a{constructor(e){super(e),this.config=e,this.acceptsPartial=!1,this.config.batchUpdate="batchUpdate"in this.config&&this.config.batchUpdate}async create(e){throw Error("Not implemented")}updateBatch(e,t){const{serialize:i}=this.config,n=[],o=[...new Set([...Object.keys(e),...Object.keys(t)])];for(const i of o)e[i]||t[i]||n.push(this.config.queue.delete(`${this.config.path}/${i}`,this.options));const r=i(e,t),a=Object.assign(Object.assign({},this.options),{body:r});return n.push(this.config.queue.request(this.config.httpMethod||s.POST,this.config.path,a)),Promise.all(n)}updateInternal(e,t){const{serialize:i}=this.config,n=[],r=Object.assign({},this.options),a=Object.keys(e),l=Object.keys(t),c=(0,o.XN)(a.concat(l));for(const o in c){const a=c[o],l=e[a]||t[a];if(l){const e={};e[a]=l;const o={},c=t[a];c&&(o[a]=c);const h=i(e,o);r.body=h,n.push(this.config.queue.request(this.config.httpMethod||s.POST,this.config.path,r))}else n.push(this.config.queue.delete(`${this.config.path}/${a}`,this.options))}return Promise.all(n)}async update(e,t){this.clearCache(),await(this.config.batchUpdate?this.updateBatch(e,t||{}):this.updateInternal(e,t||{}))}async delete(e){throw Error("Not implemented")}}},47678:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(46101);class n extends s.Z{}},56022:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(46101);class n extends s.Z{constructor(e,t,i,s){super(e,s),this.alignmentType=t,this.placementType=i}}},46101:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.fromSweep=t,this.toSweep=e,this.timestamp=Date.now()}}},57369:(e,t,i)=>{"use strict";i.d(t,{z9:()=>s,hU:()=>n,ZP:()=>h});var s,n,o=i(2212),r=i(78909),a=i(87131);!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(s||(s={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(n||(n={}));const l={[a.SL.BASE]:"512",[a.SL.STANDARD]:"1k",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"},c={[a.SL.BASE]:"low",[a.SL.STANDARD]:"high",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"};class h extends r.T{constructor(e){super(),this.skyboxes={},e&&(e.id&&(this.id=e.id),void 0!==e.index&&(this.index=e.index),this.name=e.name||"",this.position=e.position||new o.Pa4,this.floorPosition=e.floorPosition||new o.Pa4,void 0!==e.floorId&&(this.floorId=e.floorId),this.roomId=e.roomId||null,this.rotation=e.rotation||new o._fP,this.enabled=e.enabled||!1,this.vrenabled=e.vrenabled||!1,this.neighbours=e.neighbours||[],this.alignmentType=e.alignmentType||s.ALIGNED,this.placementType=e.placementType||n.UNPLACED,void 0!==e.uuid&&(this.uuid=e.uuid))}isAligned(){return this.alignmentType===s.ALIGNED}equals(e){return this.id===e.id&&this.index===e.index&&this.name===e.name&&this.position.equals(e.position)&&this.floorId===e.floorId&&this.roomId===e.roomId&&this.rotation.equals(e.rotation)&&this.enabled===e.enabled&&this.vrenabled===e.vrenabled&&this.alignmentType===e.alignmentType&&this.placementType===e.placementType}copy(e){return this.id=e.id,this.index=e.index,this.name=e.name,this.position=(new o.Pa4).copy(e.position),this.floorPosition=(new o.Pa4).copy(e.floorPosition),this.floorId=e.floorId,this.roomId=e.roomId,this.rotation=(new o._fP).copy(e.rotation),this.enabled=e.enabled,this.vrenabled=e.vrenabled,this.neighbours=e.neighbours.slice(),this.alignmentType=e.alignmentType,this.placementType=e.placementType,this.resolutions=e.resolutions,this.skyboxes=Object.assign({},e.skyboxes),this}refresh(e){this.resolutions=e.resolutions;for(const t in this.skyboxes){const i=t;this.skyboxes[i].refreshFrom(e.skyboxes[i])}}async getTileUrl(e,t,i,s){const n=await this.getSkybox(e);let o;return o=n?n.tileUrlTemplate:`tiles/${this.id}/${l[e]}_face<face>_<x>_<y>.jpg`,o.replace("<face>",`${t}`).replace("<x>",`${i}`).replace("<y>",`${s}`)}async getFaceUrl(e,t){const i=await this.getSkybox(e);let s;return s=i?i.urlTemplate:`pan/${c[e]}/${this.id}_skybox${t}.jpg`,s.replace("<face>",`${t}`)}async getSkybox(e){const t=this.skyboxes[e];return t?t.get():t}}},85995:(e,t,i)=>{"use strict";i.d(t,{NO:()=>n,aK:()=>o,iF:()=>r,kR:()=>a,e9:()=>l,zd:()=>c,ZD:()=>h});var s=i(99681);class n extends s.m{}class o extends s.m{constructor(e){super(),this.sweepId=e,this.payload={sweepId:e}}}class r extends s.m{constructor(e,t,i=500){super(),this.id="SELECT_SWEEP",this.payload={id:e,selected:t,duration:i}}}class a extends s.m{constructor(e,t,i=500){super(),this.id="HOVER_SWEEP",this.payload={id:e,hovered:t,duration:i}}}class l extends s.m{constructor(e){super(),this.id="TOGGLE_NON_PANO_CURRENT_PUCK",this.payload={visible:e}}}class c extends s.m{constructor(){super(...arguments),this.id="ENABLE_SWEEP_SELECTION"}}class h extends s.m{constructor(){super(...arguments),this.id="DISABLE_SWEEP_SELECTION"}}},77956:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var s=i(57369),n=i(19413),o=i(90134),r=i(71229),a=i(290);class l extends n.V{constructor(e){if(super(),this.name="sweeps",this.transitionActive=!1,this.sweepList=new o.d,this.sweepMap={},e){const t=Object.values(e).sort(((e,t)=>e.index-t.index));for(const e of t)this.sweepMap[e.id]=e,this.sweepList.push(e)}this.transition={progress:new a.z(0),active:!1,from:void 0,to:void 0}}refresh(e){for(const t in this.sweepMap)e[t]&&this.sweepMap[t].refresh(e[t])}canTransition(){return!this.transition.active}get currentSweepIndex(){if(this.currentSweep)return this.sweepMap[this.currentSweep].index}get currentSweepObject(){if(this.currentSweep)return this.getSweep(this.currentSweep)}get currentAlignedSweepObject(){if(this.currentSweep&&!this.isSweepUnaligned(this.currentSweep))return this.getSweep(this.currentSweep)}makeSweepChangeSubscription(e){return this.onPropertyChanged("currentSweep",e)}copy(e){let t=!1;if(this.sweepList.length===e.sweepList.length){t=!0;for(let i=0;i<this.sweepList.length;i++){const s=this.sweepList.get(i),n=e.sweepList.get(i);if(s.id!==n.id){t=!1;break}}}t||(this.sweepMap={},this.sweepList.length=0,e.sweepList.forEach((e=>{this.addSweep(e)}))),this.currentSweep=e.currentSweep,this.transition.progress.copy(e.transition.progress),this.transition.active=e.transition.active,this.transition.to=e.transition.to,this.transition.from=e.transition.from,this.transitionActive=e.transitionActive,this.commit()}clone(){const e=new l;return e.copy(this),e}addSweep(e){this.containsSweep(e.id)||(this.sweepList.push(e),this.sweepMap[e.id]=e)}getSweep(e){return this.sweepMap[e]}getSweepByIndex(e){return this.sweepList.find((t=>t.index===e))}getSweepByUuid(e){return this.sweepList.find((t=>t.uuid===e))}containsSweep(e){return e in this.sweepMap}getFirstSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled)return t}throw new Error("First enabled sweep not found")}getStartSweep(e){const t=e&&e.pano&&e.pano.uuid?this.getSweep(e.pano.uuid):null;return t&&t.enabled?t:this.getFirstSweep()}getClosestSweep(e,t){let i=Number.MAX_VALUE,n=null;return this.iterate((o=>{if(o.enabled&&(!t||o.alignmentType===s.z9.ALIGNED)){const t=e.distanceTo(o.position);t<i&&(i=t,n=o)}})),n}getFirstAlignedSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled&&t.alignmentType===s.z9.ALIGNED)return t}return null}activateTransition(e,t){this.transition.active=!0,this.transition.from=t,this.transition.to=e,this.transitionActive=!0}deactivateTransition(){this.transition.active=!1,this.transition.from=void 0,this.transition.to=void 0,this.transitionActive=!1}isSweepUnaligned(e){if(!e)return!1;const t=this.getSweep(e);return t&&!t.isAligned()}isSweepAligned(e){const t=this.getSweep(e);return t&&t.isAligned()}isSweepDisabled(e=this.currentSweep){if(!e)return!1;const t=this.getSweep(e);return t&&!t.enabled}*sweeps(){for(const e of this.sweepList)yield e}iterate(e){this.sweepList.forEach(((t,i)=>{e(t,i)}))}filter(e){return this.sweepList.filter(e)}sortByScore(e,t,i){return(i||this.sweepList).filter((t=>e.every((e=>e(t))))).map((e=>({sweep:e,score:t.reduce(((t,i)=>t+i(e)),0)}))).sort(((e,t)=>t.score-e.score))}getSweepList(){return this.sweepList.values()}getSweepNeighbours(e){const t=[];for(const i of e.neighbours)t.push(this.getSweep(i));return t}getCollection(){return(0,r.q)(this.sweepMap)}getConnectedSweeps(e,t){const i=[e],s=new Set;for(t=t||(e=>!0);i.length;){const e=i.pop(),n=this.getSweep(e);s.add(e);for(const e of n.neighbours)t(this.getSweep(e))&&!s.has(e)&&i.push(e)}return s}equals(e){if(this.sweepMap.length!==e.sweepMap.length||this.currentSweep!==e.currentSweep||this.transition.active!==e.transition.active||this.transition.from!==e.transition.from||this.transition.to!==e.transition.to)return!1;for(const t in this.sweepMap){if(!e.containsSweep(t))return!1;if(!this.sweepMap[t].equals(e.getSweep(t)))return!1}return!0}}},17321:(e,t,i)=>{"use strict";i.d(t,{ff:()=>o,vO:()=>r,T3:()=>a,H7:()=>l,_T:()=>c,WO:()=>h,b1:()=>d,nK:()=>u,pI:()=>p,_k:()=>m,D5:()=>g,SF:()=>f,jN:()=>v});var s=i(57369),n=i(2212);const o=e=>t=>t!==e,r=e=>t=>!!e.neighbours&&-1!==e.neighbours.indexOf(t.id),a=e=>t=>e===t||r(e)(t),l=e=>e.placementType===s.hU.MANUAL,c=()=>e=>e.alignmentType===s.z9.ALIGNED,h=()=>e=>e.alignmentType!==s.z9.ALIGNED,d=e=>t=>e.floorId===t.floorId,u=e=>t=>e===t.floorId,p=(()=>{const e=new n.Pa4;return(t,i,s=.25)=>n=>e.copy(n.position).sub(t).normalize().dot(i)>s})(),m=()=>e=>e.enabled,g=(e,t)=>{const i=new n.Pa4;return t=t.clone(),s=>i.copy(s.position).sub(e).normalize().dot(t)>0},f=(e,t)=>i=>e.distanceTo(i.position)<t,v=(e,t)=>i=>e.distanceToSquared(i.position)<t},94210:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ae});var s=i(54122),n=i(77956),o=i(47924),r=i(89895),a=i(64279),l=i(56022),c=i(47678),h=i(44266),d=i(1799),u=i(60463),p=i(89155),m=i(25799),g=i(83032),f=i(46101),v=i(85995),y=i(80034),b=i(41263),w=i(7943),S=i(15119),T=i(97620),E=i(57369),_=i(46162),x=i(62367),M=i(40032);const P=new m.Z("sweeps");function A(e=!0){function t(t,i,s,n,o){const r=t[i];if(void 0!==r)s[n]=o?o(r):r;else if(e)throw Error(`Required property missing in data: ${i}`)}return function(e){if(!e||Object.keys(e).length<1)return null;const i={};try{const s=[];for(const i of e){const e=new E.ZP;if(t(i,"index",e,"index"),s[e.index])throw Error("Duplicate sweep index found");s[e.index]=e,t(i,"sweep_uuid",s[e.index],"id",(e=>e.replace(/-/g,"")))}for(const n of e){const e=s[n.index];t(n,"neighbors",e,"neighbours",(e=>e.map((e=>s[e]?s[e].id:void 0)).filter((e=>void 0!==e)))),t(n,"alignment_type",e,"alignmentType",(e=>"string"==typeof e&&E.z9.hasOwnProperty(e.toUpperCase())?e:E.z9.UNALIGNED)),t(n,"placement",e,"placementType",(t=>e.alignmentType===E.z9.ALIGNED?E.hU.AUTO:"string"==typeof n.placement&&E.hU.hasOwnProperty(n.placement.toUpperCase())?n.placement:E.hU.UNPLACED)),t(n,"rotation",e,"rotation",(e=>T.ep.fromVisionQuaternion(e))),t(n,"position",e,"position",(e=>T.ep.fromVisionVector(e))),t(n,"floor_position",e,"floorPosition",(e=>T.ep.fromVisionVector(e))),t(n,"sweep_name",e,"name"),t(n,"floor_index",e,"floorId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(n,"room_index",e,"roomId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(n,"tags",e,"enabled",(e=>-1!==e.indexOf("showcase"))),t(n,"tags",e,"vrenabled",(e=>-1!==e.indexOf("vr"))),e.uuid=e.id,i[e.id]=e}}catch(e){P.error("Error reading sweeps list",e)}return 0===Object.keys(i).length?null:i}}const O=(e,t)=>{const i=[];if(!t)throw Error("SweepsV2 must serialize via diffs");function s(e,t,i){return function(s,n,o){if((0,x.nr)(t,s)){let r;null!==t[s]&&"object"==typeof t[s]?(r={},(0,_.TS)(r,e[s]),"rotation"===s&&(r=(0,M.J5)(r))):r=e[s],i[n]=o?o(r):r}}}for(const n in t){const o=e[n],r=t[n],a={},l=s(o,r,a);l("placementType","placement"),r.placementType!==E.hU.UNPLACED&&(l("position","position",(e=>T.ep.toVisionVector(e))),l("rotation","rotation",(e=>(0,M.J5)(T.ep.toVisionQuaternion(e))))),((0,x.nr)(r,"enabled")||(0,x.nr)(r,"vrenabled"))&&(a.tags=[],(void 0!==r.enabled?r.enabled:o.enabled)&&(a.tags.push("showcase"),(void 0!==r.vrenabled?r.vrenabled:o.vrenabled)&&a.tags.push("vr"))),l("name","sweep_name"),l("floorId","floor_index",(e=>{if(!e)return-1;const t=parseInt(e||"",10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e}'`);return t})),Object.keys(a).length>0&&(a.index=o.index,a.sweep_uuid=o.id,i.push(a))}return 0===i.length?null:i};var D=i(20331),I=i(71439),C=i(36690),R=i(32400),L=i(51770);const N=new m.Z("mds-sweep-serializer");class k{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),s=0===Object.keys(e).filter((e=>!t.includes(e))).length,n=void 0===e.tags||Array.isArray(e.tags),o=n&&i&&s;return o||N.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:n,hasSomeChanges:i,hasNoExtraChanges:s,mutableFields:t,data:e}),o}}var F,B=i(99555);!function(e){e.VISION="vision",e.UPLOAD="upload"}(F||(F={}));var U=i(87131),H=i(32020),G=i(68519),V=i(60982);const z=new m.Z("mds-sweep-serializer"),j={[B.b.AUTO]:E.hU.AUTO,[B.b.MANUAL]:E.hU.MANUAL,[B.b.UNPLACED]:E.hU.UNPLACED},W={[F.VISION]:E.z9.ALIGNED,[F.UPLOAD]:E.z9.UNALIGNED};class Z{deserialize(e){var t,i;if(!e||!this.validate(e))return z.debug("Deserialized invalid Sweep data from MDS",e),null;const s=e,n=new E.ZP;n.id=s.id,n.index=s.index,n.enabled=s.tags.includes("showcase"),n.vrenabled=s.tags.includes("vr"),n.neighbours=s.neighbors||[],s.position&&(n.floorPosition=T.ep.fromVisionVector(s.position)),n.floorId=(null===(t=s.floor)||void 0===t?void 0:t.id)||null,n.roomId=(null===(i=s.room)||void 0===i?void 0:i.id)||null;const o=s.pano;n.name=o.label||"",n.alignmentType=W[o.source],n.uuid=o.sweepUuid||"",n.alignmentType===E.z9.ALIGNED?n.placementType=E.hU.AUTO:n.placementType=j[o.placement],o.position&&(n.position=T.ep.fromVisionVector(o.position)),n.resolutions=[];const r=o.skyboxes||[];if(o.resolutions)for(const e of o.resolutions){const t=this.getPanoSizeClass(e),i=r.find((t=>t.resolution===e));t&&i?(n.resolutions.push(t),n.skyboxes[t]=this.makeSkybox(i)):z.debug(`Invalid pano size class ${e}`)}return o.rotation&&(n.rotation=T.ep.fromVisionQuaternion(o.rotation)),n.floorId||(n.alignmentType===E.z9.ALIGNED?z.warn(`Aligned sweep ${n.index} has no floor association`):n.placementType===E.hU.MANUAL&&z.warn(`Manually placed sweep ${n.index} has no floor association`)),n.roomId||n.alignmentType===E.z9.ALIGNED&&z.warn(`Aligned sweep ${n.index} has no room association`),n}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,V.uU)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:s,position:n}=e.pano;t.push((()=>!!i&&i in j)),t.push((()=>!!s&&s in W)),t.push((()=>!!n&&(0,V.uU)(n)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:U.SL.BASE,high:U.SL.STANDARD,"2k":U.SL.HIGH,"4k":U.SL.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){return new G.n({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:e.urlTemplate},(0,H.p)(e.validUntil,null))}}const q=new m.Z("mds-sweep-serializer");class K{serialize(e){const t={};return e.rotation&&(t.rotation=(0,M.J5)(T.ep.toVisionQuaternion(e.rotation))),e.position&&(t.position=(0,M.m)(T.ep.toVisionVector(e.position))),e.placementType&&e.placementType===E.hU.UNPLACED&&(t.resetPlacement=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?t.floorId=e.floorId:t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),s=0===Object.keys(e).filter((e=>!t.includes(e))).length,n=i&&s;return n||q.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:s,mutableFields:t,data:e}),n}}const Y=new m.Z("mds-sweep-store");class $ extends R.u{constructor(){super(...arguments),this.deserializer=new Z,this.panoSerializer=new K,this.anchorSerializer=new k}async read(){const e=this.getViewId(),{readonly:t}=this.config,i=t?C.GetShowcaseSweeps:C.GetSweeps;return this.query(i,{modelId:e},{fetchPolicy:"no-cache"}).then((e=>{const t=(0,L.qw)(e,"data.model.locations"),i={};for(const e of t){const t=this.deserializer.deserialize(e);t&&(i[t.id]=t)}return i}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read().finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async update(e){const t=this.getViewId();return Promise.all(e.map((i=>{const s=this.panoSerializer.serialize(i),n=this.anchorSerializer.serialize(i);if(!s&&!n)throw Y.error("No changes to update:",i,e),new Error("MdsSweepStore.update failed");const o=s?", $pano: PanoramicImageLocationPatch!":"",r=` ${n?", $anchor: AnchorPatch!":""} `,a=I.Ps`
        mutation sweep($modelId: ID!, $sweepId: ID! ${o} ${r}) {
        ${s?"\n          patchPanoLocation(modelId: $modelId, , locationId: $sweepId, patch: $pano) {\n            id\n            placement\n          }":""}
        ${n?"\n          patchAnchor(modelId: $modelId, , anchorId: $sweepId, patch: $anchor) {\n            id\n            tags\n          }":""}
      }`;return this.mutate(a,{modelId:t,sweepId:i.id,pano:s,anchor:n}).then((e=>{if(Y.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw Y.error(Object.assign({},e)),new Error("MdsSweepStore.update failed")}))})))}}var Q=i(83083),X=i(60841),J=i(64614),ee=i(97631),te=i(44333),ie=i(17256),se=i(17617);class ne extends se.y{constructor(e="Failed to transition to sweep"){super(e),this.name="SweepTransition"}}class oe extends se.y{constructor(e="Invalid Sweep"){super(e),this.name="InvalidSweep"}}const re=new m.Z("sweep-module");class ae extends s.Y{constructor(){super(...arguments),this.name="sweep-data",this.internalProgress=!1,this.defaultEasing=d.qb,this.moveToSweep=e=>{const t=new h.Q;return e.prevSweepId=e.prevSweepId||this.sweepData.currentSweep,this.activateSweep(e).then((()=>(this.beginSweepTransition(e),this.defaultSweepCameraMove(t,e)))).then((()=>{this.endSweepTransition(e),t.resolve()})).catch((i=>{re.debug(`Failure moving to sweep ${e.sweepId}`,i),t.reject(i)})),t.promise()},this.activateSweep=async e=>{if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new ne("Tried to start transition while another transition was active");if(!this.sweepData.containsSweep(e.sweepId))throw new oe(`Invalid sweep ${e.sweepId}`);return this.activateSweepUnsafe(e)},this.activateSweepUnsafe=async e=>(this.sweepPanoModule||(this.sweepPanoModule=await this.engine.getModuleByParent(u.Z)),this.sweepPanoModule.getRenderer().activateSweep(e.sweepId)),this.instantSweepTransition=e=>{const t=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0,prevSweepId:t}),this.sweepData.currentSweep=e,this.sweepData.commit(),this.engine.broadcast(new f.Z(e,t)),this.endSweepTransition({sweepId:e,prevSweepId:t})},this.beginSweepTransition=e=>{this.sweepData.activateTransition(e.sweepId,e.prevSweepId||this.sweepData.currentSweep),this.internalProgress=e.internalProgress||!1,this.sweepData.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||this.defaultEasing),this.sweepData.commit(),this.engine.broadcast(new c.Z(e.sweepId,e.prevSweepId))},this.endSweepTransition=e=>{const t=this.sweepData.getSweep(e.sweepId);this.sweepData.deactivateTransition(),this.sweepData.currentSweep=e.sweepId,this.sweepData.transition.progress.stop(1),this.internalProgress=!1,this.sweepData.commit(),this.engine.broadcast(new l.Z(e.sweepId,t.alignmentType,t.placementType,e.prevSweepId))},this.defaultSweepCameraMove=async(e,t)=>{const i={position:this.sweepData.getSweep(t.sweepId).position,rotation:t.rotation},s=(0,a.AN)(this.cameraData.aspect());let n=o.n.Interpolate;void 0!==t.transitionType&&o.n[t.transitionType]&&(n=t.transitionType);const r=this.cameraModule.moveTo({transitionType:n,pose:i,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,projection:s,easing:t.easing,rotationDelay:t.rotationDelay});let l=!1;return r.progress((i=>{this.sweepData.transition.progress.updateProgress(i),e.notify(i),i>=.5&&!l&&(l=!0,this.sweepData.currentSweep=t.sweepId,this.sweepData.commit(),this.engine.broadcast(new f.Z(t.sweepId,t.prevSweepId)))})),r.nativePromise()},this.tryInferFloorIds=e=>{for(const t of Object.values(e))if(t.isAligned()&&null===t.floorId){re.warn(`Aligned sweep ${t.index} has no floor association`);const i=t.neighbours.map((i=>({id:i,floorId:e[i].floorId,distance:e[i].floorPosition.distanceToSquared(t.floorPosition)})));i.sort(((e,t)=>e.distance-t.distance));const s=i.find((e=>e.floorId));s&&(re.debug(`Inferred Sweep ${t.index} floor as ${s.floorId} from neighbors`),t.floorId=s.floorId)}}}async init(e,t){const{readonly:i}=e;this.engine=t,this.market=this.engine.market,this.store=this.getStore(e);const s=await this.store.read()||{};[this.filterSweepData,this.tryInferFloorIds].forEach((e=>e(s))),(0,G.s)(s,(async()=>{if(this.store.refresh){const e=await this.store.refresh();this.sweepData.refresh(e||{})}else re.debug("Can't refresh sweep URLs - operation not supported")})),this.sweepData=new n.Z(s),this.market.register(this,n.Z,this.sweepData);const o=await t.getModule(ee.F);!1===i&&(this.monitor=new Q.c(this.sweepData.getCollection(),{aggregationType:X.E.NextFrame,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new te.VQ({dataTypes:[ie.g.SWEEPS]})))),this.store instanceof g.N&&this.store.addMonitor(this.monitor)),this.cameraModule=await this.engine.getModule(r.default),this.cameraData=await t.market.waitForData(p.M_),this.bindings.push(t.commandBinder.addBinding(v.NO,(async()=>{this.sweepData.currentSweep=void 0,this.sweepData.commit()})),t.commandBinder.addBinding(v.aK,(async e=>{if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t});const i=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0,prevSweepId:i}),this.sweepData.currentSweep=t,this.endSweepTransition({sweepId:t,prevSweepId:i}),this.sweepData.commit()}catch(e){re.error(e)}else this.sweepData.currentSweep=void 0,this.sweepData.commit()})),o.onSave((()=>this.save()),{dataType:ie.g.SWEEPS}),o.onRevert((()=>this.revert()),{dataType:ie.g.SWEEPS}))}getStore(e){const{modelId:t,baseUrl:i,queue:s}=e,n=e.storageProvider||ie.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;if(re.info(`Loading Sweeps from ${n}`),n===ie.Xq.MDS)return new $({readonly:o,baseUrl:i});const r=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new D.gO,o={data:null};let r=`${s}/api/v2/models/${t}/sweeps`;if(i){r=`${r}?tag=showcase`;const e=new y.gh({queue:n,path:r,deserialize:A(!0),cachedData:o});return new b.iY({publishStores:[e]})}const a=new y.yh({queue:n,path:r,cachedData:o,httpMethod:y.w$.PATCH,deserialize:A(!0),serialize:O}),l=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,c=new S.Z({queue:n,path:l,cachedData:{data:null},deserialize:w.S.sessionObjectExtract(S.j.WS3_Sweeps,A(!1)),serialize:O},S.j.WS3_Sweeps);return new b.iY({publishStores:[a],editStore:c,partialData:!0,safeKeys:["name","position","rotation","enabled","vrenabled","placementType"],editStoreKey:b.aw.SWEEPS})}({modelId:t,baseUrl:i,readonly:o,queue:s});return new g.N(r,{modelId:t,readonly:o,dataType:ie.g.SWEEPS,engine:this.engine})}filterSweepData(e){for(const t in e){const i=e[t];i.neighbours=i.neighbours.filter((t=>t in e))}}onUpdate(e){this.internalProgress&&this.sweepData.transition.active&&this.sweepData.transition.progress.tick(e)}async save(){if(!this.store)throw Error("No store configured for saving sweep edits!");if(this.store instanceof g.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===J.KI.updated)).map((e=>{const t=this.sweepData.getSweep(e.index),i=Object.assign({id:e.index},e.diff);return"position"in i&&(i.position=t.position),"rotation"in i&&(i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),i}));return this.store.update(t)}async revert(){if(this.store instanceof g.N)return this.store.revert()}}},81733:(e,t,i)=>{"use strict";i.d(t,{Dv:()=>n,TE:()=>o,o7:()=>r,l0:()=>a,Bv:()=>l});var s=i(2212);const n=(e,t=-1)=>i=>e.distanceToSquared(i.position)*t,o=(e,t=-1)=>i=>e.distanceTo(i.position)*t,r=(e,t,i=10)=>{const n=new s.Pa4;return s=>n.copy(s.position).sub(e).normalize().dot(t)*i},a=(e,t=-1)=>i=>e.distanceToSquared(i.floorPosition)*t,l=(e,t=5,i=-5)=>s=>e===s.floorId?t:i},50966:(e,t,i)=>{"use strict";var s;i.d(t,{Z:()=>n}),function(e){e[e.Center=0]="Center",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.LowerRight=3]="LowerRight",e[e.LowerLeft=4]="LowerLeft"}(s||(s={}));const n=s},84559:(e,t,i)=>{"use strict";i.d(t,{S:()=>c,Z:()=>h});var s=i(87131),n=i(28281),o=i(67569),r=i(13338),a=i(44266);const l=new(i(25799).Z)("panoqualitymanager");var c;!function(e){e[e.Untested=0]="Untested",e[e.Testing=1]="Testing",e[e.Success=2]="Success",e[e.Fail=3]="Fail"}(c||(c={}));class h{constructor(e,t,i,s){this.urls=e,this.maxCubemapSize=t,this.maxNavPanoSize=i,this.maxZoomPanoSize=s,this.overrideWindow=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.windowHeight=window.innerHeight*this.devicePixelRatio,this.highQualityThreshold=n.Xd.windowHeightHighQualityThresholdOverride||n.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new o.a,this.downloadTestResults={},this.updateMaximums()}setWindowSize(e,t){this.windowHeight=t*this.devicePixelRatio,this.updateMaximums()}overrideWindowMaximums(e){this.overrideWindow=e,this.updateMaximums()}updateNavPanoSize(e){this.maxNavPanoSize=e,this.updateMaximums()}getTestResults(e,t){const i=this.downloadTestResults[e];if(i){const e=i[t];if(e)return e}return c.Untested}ultraHighQualityModeEnabled(e){const t=s.Qf[this.getZoomPanoSize()],i=this.downloadTestResults[e];return!(!i||!i[t])&&i[t]===c.Success}updateMaximums(){this.windowHeight<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(h.getPanoSize(s.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(h.getPanoSize(s.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(e){if(e in s.eE)return s.eE[e];throw new Error(`Not a panoSizeClass: ${e}`)}static getPanoSizeClass(e){if(e in s.Qf)return s.Qf[e];throw new Error(`Not a valid pano resolution: ${e}`)}getMaxPossiblePanoSize(){return h.getPanoSize(s.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(e,t){const i=new a.Q;if(!t)return i.reject(0);if(e.resolutions)return e.resolutions.includes(t)?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t));switch(this.getTestResults(e.id,t)){case c.Success:i.resolve(t);break;case c.Fail:return this.availableResolution(e,this.getLowerResolution(t));case c.Untested:this.testDownload(e,t,r.I_).then((s=>{s?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t)).then((e=>i.resolve(e)))}));break;case c.Testing:l.warn("resolution is already testing, do we need to handle this?")}return i}getLowerResolution(e){switch(e){case s.SL.ULTRAHIGH:return s.SL.HIGH;case s.SL.HIGH:return s.SL.STANDARD;case s.SL.STANDARD:return s.SL.BASE}return null}testDownload(e,t,i){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const s=h.getPanoSize(t),n=new a.Q,o=e.id;this.downloadTestResults[o]||(this.downloadTestResults[o]={});const r=this.downloadTestResults[o]&&this.downloadTestResults[o][t];if(r)r===c.Success?n.resolve(!0):r===c.Fail&&n.resolve(!1);else{this.downloadTestResults[o][t]=c.Testing;const r=e=>{this.downloadTestResults[o][t]=c.Success,n.resolve(!0)},a=()=>{this.downloadTestResults[o][t]=c.Fail,n.resolve(!1)};this.getTileUrl(e,s,i,0).then((e=>{this.urls.getImage(e,{maxRetries:0}).then(r,a)}))}return n}getTileUrl(e,t,i,s){const n=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));r.Tp(t,s,n);const o=Math.floor(t/i),a=o*o,l=Math.floor(s/a),c=h.getPanoSizeClass(t);return e.getTileUrl(c,l,n.tileX,n.tileY)}}},7922:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.size=e,this.sweepId=t,this.renderTarget=i}}},20134:(e,t,i)=>{"use strict";i.d(t,{I6:()=>w,at:()=>T});var s,n=i(2212),o=i(84559),r=i(13338),a=i(37024),l=i(97620),c=i(87131),h=i(28281),d=i(67569),u=i(17321),p=i(81733),m=i(5442),g=i(84564),f=i(27829),v=i(21265),y=i(71208),b=i(66272);!function(e){e[e.None=0]="None",e[e.DirectionalFOV=1]="DirectionalFOV"}(s||(s={}));class w{constructor(e,t,i,s){this.cameraRot=new n._fP,this.sweep=e,this.cameraPosition=(new n.Pa4).copy(t),this.cameraDir=(new n.Pa4).copy(i),this.upcomingSweeps=s,this.zoomingActive=!1}}const S=(e,t,i=!1)=>{let s=0;if(e&&t)for(const n of t)i&&-1!==e.indexOf(n)||(e.push(n),s++);return s};class T{constructor(e,t,i,s){this.panoQualityManager=e,this.tilingSettings=t,this.sweepData=i,this.raycaster=s,this.tempQueue=[],this.filterAndPrioritize=(e,t,i)=>{if(!this.priorityCriteria.sweep)return;const s=void 0!==this.priorityCriteria.upcomingSweeps&&null!==this.priorityCriteria.upcomingSweeps,n=this.tempQueue;n.length=0,this.queueTilesForPano(n,i,this.priorityCriteria.sweep,c.AB.BASE);const o=S(e,n,!0);this.currViewQueue[c.SL.BASE].value=o,this.fullPanoQueue[c.SL.BASE].value=o,s?this.queueForRestrictedSweeps(e,i):this.priorityCriteria.viewMode!==y.Ey.Panorama?this.queueForNonPanoViewmode(e,i):this.queueForPanoViewmode(e,t,i),this.tilingSettings.downloadFullPano&&this.queueFullPano(e,i)},this.queueRaycast=(()=>{const e=new n.Pa4;return(t,i)=>{if(this.priorityCriteria.sweep)if(this.priorityCriteria.hoveredSweep)this.queueTilesForPano(t,i,this.priorityCriteria.hoveredSweep,c.AB.BASE);else if(this.raycaster&&this.raycaster.hit){const s=e.copy(this.raycaster.hit.point).sub(this.priorityCriteria.sweep.position),n=this.getSinglePanoInDirection(s),o=this.sweepData.getSweep(n);o&&this.queueTilesForPano(t,i,o,c.AB.BASE)}}})(),this.queueRaycastIntersection=(e,t)=>{if(!this.raycaster||!this.raycaster.hit)return;const i=(0,b.b)(this.sweepData,!1,this.raycaster.hit.intersection),s=i.length>0?i[0].sweep:this.sweepData.getClosestSweep(this.raycaster.hit.point,!0);s&&this.queueTilesForPano(e,t,s,c.AB.BASE)},this.getSweepIdInLocalDirection=(()=>{const e=new n.Pa4;return t=>{const i=this.priorityCriteria.cameraRot,s=e.copy(t).applyQuaternion(i);return this.getSinglePanoInDirection(s)}})(),this.persistentStorage=new d.a,this.maxResolution=e.getNavPanoSize(),this.currViewQueue=x(),this.fullPanoQueue=x(),this.isMobileDevice=(0,v.tq)(),this.priorityCriteria=new w(null,new n.Pa4(0,0,0),new n.Pa4(0,0,-1))}getQualityQueueSize(e,t){return e===g.DownloadQueueStyle.CurrentView?this.currViewQueue[t].value:this.fullPanoQueue[t].value}makeQueueSubscription(e,t,i){return(e===g.DownloadQueueStyle.CurrentView?this.currViewQueue[t]:this.fullPanoQueue[t]).onChanged(i)}updateCriteria(e,t,i,s){this.priorityCriteria.sweep=e,this.priorityCriteria.cameraPosition.copy(t),this.priorityCriteria.cameraDir.copy(i),this.priorityCriteria.cameraRot.copy(s)}setHoveredSweep(e){this.priorityCriteria.hoveredSweep=e}setUpcomingSweeps(e){this.priorityCriteria.upcomingSweeps=e}clearUpcomingSweeps(){this.priorityCriteria.upcomingSweeps=void 0}setDownloadFOV(e){T.DIRECTIONAL_FOV=e}queueForRestrictedSweeps(e,t){if(!this.priorityCriteria.upcomingSweeps)return;let i=0;for(const s of this.priorityCriteria.upcomingSweeps)if(i++,this.queueTilesForPano(e,t,s,c.AB.BASE),i>=3)break;this.queueFOVStandardNarrow(e,t),this.queueFOVHighNarrow(e,t)}queueForPanoViewmode(e,t,i){this.queueRaycast(e,i),this.queueFOVStandardNarrow(e,i),this.queueScoredSweeps(e,t,i),this.queueFOVHighNarrow(e,i),this.isMobileDevice||this.queueWASD(e,t,i)}queueForNonPanoViewmode(e,t){this.queueRaycastIntersection(e,t)}queueFOVTiles(e,t,i,s){if(!this.priorityCriteria.sweep)return 0;const n=c.eE[t];return this.canDownloadSize(this.priorityCriteria.sweep,t)?this.queueTilesInDirectionForPano(e,s,this.priorityCriteria.sweep,n,this.priorityCriteria.cameraDir,i):0}queueScoredSweeps(e,t,i){if(this.priorityCriteria.sweep&&this.maxResolution<=2048){const s=this.persistentStorage.getArray("filterAndPrioritize:scoredSweeps");this.populateScoredSweeps(this.priorityCriteria.sweep,t,s,this.priorityCriteria.cameraDir,6),this.queueTilesForPanos(e,s,i,c.AB.BASE,4)}}queueFOVStandardNarrow(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;i.length=0;const s=this.queueFOVTiles(i,c.SL.STANDARD,T.DIRECTIONAL_FOV,t);T.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),S(e,i),this.currViewQueue[c.SL.STANDARD].value=s,this.fullPanoQueue[c.SL.STANDARD].value=s}queueFOVHighNarrow(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;i.length=0;const s=this.queueFOVTiles(i,c.SL.HIGH,T.DIRECTIONAL_FOV,t),n=this.queueFOVTiles(i,c.SL.ULTRAHIGH,T.DIRECTIONAL_FOV,t);T.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),S(e,i),this.currViewQueue[c.SL.HIGH].value=s,this.currViewQueue[c.SL.ULTRAHIGH].value=n}queueFullPano(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;if(i.length=0,this.maxResolution<=c.AB.HIGH){if(this.canDownloadSize(this.priorityCriteria.sweep,c.SL.HIGH)){const e=this.queueTilesForPano(i,t,this.priorityCriteria.sweep,c.AB.HIGH);this.fullPanoQueue[c.SL.HIGH].value=e}}else if(this.canDownloadSize(this.priorityCriteria.sweep,c.SL.ULTRAHIGH)){const e=this.queueTilesForPano(i,t,this.priorityCriteria.sweep,c.AB.ULTRAHIGH);this.fullPanoQueue[c.SL.ULTRAHIGH].value=e}T.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),S(e,i,!0)}queueWASD(e,t,i){const s=this.persistentStorage.getArray("filterAndPrioritize:neighbors")||[];if(s.length=0,!this.priorityCriteria.sweep)return;const n=[f.f.FORWARD,f.f.RIGHT,f.f.LEFT,f.f.BACK];for(const e of n){const i=this.getSweepIdInLocalDirection(e),n=t.get(i);n&&s.push(n)}this.queueTilesForPanos(e,s,i,c.AB.BASE)}canDownloadSize(e,t){const i=c.eE[t],s=this.panoQualityManager.getNavPanoSize()>=i||this.maxResolution>=i&&this.panoQualityManager.getZoomPanoSize()>=i,n=this.panoQualityManager.getTestResults(e.id,t);return s&&n===o.S.Untested&&this.panoQualityManager.testDownload(e,t,r.I_),n===o.S.Success&&s}populateScoredSweeps(e,t,i,s,o){(i=i||[]).length=0;const r=(new n.Pa4).copy(e.position),a=[u._k(),u.ff(e),u.jN(r,400),u.pI(r,s,.75)],l=[p.Dv(r,h.Xd.navigation.distanceFactor),p.o7(r,s,h.Xd.navigation.directionFactor)],c=this.sweepData.getSweepNeighbours(e),d=this.sweepData.sortByScore(a,l,c);for(let e=0;e<d.length&&e<o;e++){const t=d[e].sweep;i.push(t)}}queueTilesForPanos(e,t,i,s,n){let o=0;for(const r of t)if(o+=this.queueTilesForPano(e,i,r,s)>0?1:0,n&&o>=n)break;return o}queueTilesForPano(e,t,i,n){const o=this.persistentStorage.get("queueTilesForSweep:filterCriteria",(()=>({filter:s.None})));return this.filterAndQueueTileDownloadDescriptors(e,t,i,n,o)}queueTilesInDirectionForPano(e,t,i,o,a,l){const c=this.persistentStorage.get("queueTilesInDirectionForSweep:panoSpaceDir",(()=>new n.Pa4)),h=this.persistentStorage.get("queueTilesInDirectionForSweep:filterCriteria",(()=>({filter:s.DirectionalFOV,direction:new n.Pa4,fov:60})));return c.copy(a),r.ym(i.rotation,c),h.direction.copy(c),h.fov=l,this.filterAndQueueTileDownloadDescriptors(e,t,i,o,h)}filterAndQueueTileDownloadDescriptors(e,t,i,s,n){const o=this.persistentStorage.getArray("filterAndQueueTileDownloadDescriptors:descriptors"),r=t.getTileDownloadDescriptors(i,s);o.length=0,this.filterTileDownloadDescriptors(r,o,n);let a=0;for(const t of o)t&&(e.push(t),a++);return a}filterTileDownloadDescriptors(e,t,i){let n,o;switch(i.filter){case s.DirectionalFOV:for(n=0;n<e.length;n++)o=e[n],o&&r.eO(o.panoSize,o.tileSize,o.face,o.tileX,o.tileY,i.direction,i.fov)&&t.push(o);break;default:for(n=0;n<e.length;n++)o=e[n],t.push(o)}for(n=0;n<t.length;n++)o=t[n],o&&!this.canIncludeDescriptor(o)&&(t[n]=null)}canIncludeDescriptor(e){return e.status!==a.Z.Downloading&&e.status!==a.Z.Downloaded}static sortTiles(e,t,i){E.panoSpaceDir.copy(i),r.ym(t.rotation,E.panoSpaceDir),E.fovThresholdNarrow=l.tf(T.DIRECTIONAL_FOV),e.sort(_)}static insertSortedPanoTile(e,t,i,s){E.panoSpaceDir.copy(s),r.ym(i.rotation,E.panoSpaceDir),E.fovThresholdNarrow=l.tf(T.DIRECTIONAL_FOV);let n=-1;for(let i=0;i<e.length;i++)if(_(t,e[i])<=0){n=i;break}if(-1===n)e[e.length]=t;else{for(let t=e.length;t>n;t--)e[t]=e[t-1];e[n]=t}}getSinglePanoInDirection(e){const t=this.priorityCriteria.sweep;if(!t)return"";const i=[u.ff(t),u._k(),u.pI(t.position,e)],s=[p.o7(t.position,e),p.TE(t.position)],n=t.neighbours.filter((e=>{const t=this.sweepData.getSweep(e);return i.every((e=>e(t)))})).map((e=>{const t=this.sweepData.getSweep(e);return{sweepId:e,score:s.reduce(((e,i)=>e+i(t)),0)}})),o=n.reduce(((e,t)=>e.score>t.score?e:t),n[0]);return o?o.sweepId:""}}T.DIRECTIONAL_FOV=120;const E={panoSpaceDir:new n.Pa4,fovThresholdNarrow:-1},_=(e,t)=>{const i=E.panoSpaceDir,s=E.fovThresholdNarrow,n=Math.max(Math.min(i.dot(e.direction),1),-1),o=Math.max(Math.min(i.dot(t.direction),1),-1);return n>=s&&o<s?-1:n<s&&o>=s||e.panoSize>t.panoSize?1:t.panoSize>e.panoSize?-1:-(n-o)};function x(){return{[c.SL.BASE]:(0,m.Y)(0),[c.SL.STANDARD]:(0,m.Y)(0),[c.SL.HIGH]:(0,m.Y)(0),[c.SL.ULTRAHIGH]:(0,m.Y)(0)}}},13338:(e,t,i)=>{"use strict";i.d(t,{I_:()=>l,Hq:()=>c,P6:()=>h,R5:()=>d,Tp:()=>u,Tu:()=>p,ym:()=>m,oU:()=>g,eO:()=>v});var s=i(64630),n=i(2212),o=i(50966),r=i(41446),a=i(97620);const l=512,c=6,h=(e,t,i,n,r,a,l,c)=>{const h=e/t,d=t/e*2,u=d/2;let p=n/h*2-1+u,m=(r=h-1-r)/h*2-1+u;switch(a=a||o.Z.Center){case o.Z.UpperLeft:p-=u,m+=u,p+=l*d;break;case o.Z.UpperRight:p+=u,m+=u,m-=l*d;break;case o.Z.LowerRight:p+=u,m-=u,p-=l*d;break;case o.Z.LowerLeft:p-=u,m-=u,m+=l*d;break;case o.Z.Center:}switch(i){case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:c.set(-1,m,-p);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:c.set(1,m,p);break;case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:c.set(-p,1,-m);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:c.set(-p,-1,m);break;case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:c.set(-p,m,1);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:c.set(p,m,-1)}c.normalize()},d=(e,t)=>{let i=l;e<l&&(i=e);const s=Math.floor(e/i),n=s*s;return Math.floor(t/n)},u=(e,t,i)=>{let s=l;e<l&&(s=e);const n=d(e,t),o=Math.floor(e/s),r=t-n*(o*o);i.tileX=r%o,i.tileY=Math.floor(r/o),i.face=n,i.faceTileIndex=r},p=function(e){if(e<=l)return c;const t=Math.floor(e/l);return t*t*c},m=function(){const e=new n.yGw,t=new n._fP;return(i,s)=>{t.copy(i),t.invert(),e.makeRotationFromQuaternion(t),s.applyMatrix4(e),s.normalize()}}(),g=function(){const e=new n.Pa4,t=new n.Pa4(0,0,-1),i=new n._fP,s=function(e,t){e.push({face:t.face,faceTileIndex:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY})},o=function(){const e={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(t,i,n)=>{const o=p(t);let r=0;for(let a=0;a<o;a++)u(t,a,e),i&&!i(e)||(r++,n&&s(n,e));return r}}();return(s,r,a,c,h=!1,d,u)=>{c.length=h?0:c.length;const p=r<l?r:l;if(!d&&!u)return o(r,null,c);const g=!!u;d=d||0,u=u||d,u=Math.max(0,Math.min(u,360)),d=Math.max(0,Math.min(d,360)),e.copy(a);const y=s.rotation||new n._fP;return m(y,e),g?(i.setFromUnitVectors(e,t),o(r,(function(e){return f(r,p,e.face,e.tileX,e.tileY,i,d||0,u||0)}),c)):o(r,(function(t){return v(r,p,t.face,t.tileX,t.tileY,e,d||0)}),c)}}(),f=function(){const e=new n.Pa4;return(t,i,s,n,l,c,d,u)=>{const p=Math.tan(.5*u*a.Ue),m=-p,g=Math.tan(.5*d*a.Ue),f=-g,v=(0,r.m)(s);let y=0,b=0,w=0,S=0,T=0;for(let s=o.Z.Center;s<=o.Z.LowerLeft;s++){if(h(t,i,v,n,l,s,0,e),e.applyQuaternion(c),e.z>=-1e-5)continue;const o=-1/e.z,r=e.x*o,a=e.y*o;a>p?y++:a<m&&b++,r>g?w++:r<f&&S++,T++}return b!==T&&y!==T&&w!==T&&S!==T}}(),v=function(){const e=new n.Pa4,t=new n.Pa4(0,1,0),i=new n.Pa4(1,0,0);return(s,n,a,l,c,d,u)=>{const p=(0,r.m)(a);if(i.copy(d).cross(t),h(s,n,p,l,c,o.Z.Center,0,e),y(e,d,u))return!0;const m=u/360,g=Math.floor(1/m);let f=0;for(let t=0;t<g;t++){for(let t=o.Z.UpperLeft;t<=o.Z.LowerLeft;t++)if(h(s,n,p,l,c,t,f,e),y(e,d,u))return!0;f+=m}return!1}}(),y=function(){const e=new n.Pa4,t=new n.Pa4;return(i,s,n,o)=>{if(t.copy(i),o){e.copy(o),e.normalize();const s=e.dot(i);e.x*=s,e.y*=s,e.z*=s,t.sub(e)}const r=n/2*a.Ue,l=Math.cos(r);return t.dot(s)>=l}}()},86450:(e,t,i)=>{"use strict";i.d(t,{D:()=>n,F:()=>o});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="ALLOW_HIGH_RES",this.payload={ignoreWindowSize:e}}}class o extends s.m{constructor(e){super(),this.id="SET_NAV_PANO_SIZE",this.payload={navSize:e}}}},84564:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DownloadQueueStyle:()=>ne,default:()=>oe});var s=i(28281),n=i(80384),o=i(17617);class r extends o.y{constructor(e){super(e),this.name="PanoTilingError"}}var a,l=i(25799),c=i(2212),h=i(99774),d=i(27829);!function(e){e[e.PreOrder=0]="PreOrder",e[e.PostOrder=1]="PostOrder"}(a||(a={}));class u{constructor(e,t){this.tree=e,this.parent=t,this.children=[],this.id=++u._id,this.extra={},this.level=-1}}u._id=0;class p{constructor(e,t){this.levels=t,this.tileSize=e,this.root=null,this.allNodes=[],f(this)}getSizeForLevel(e,t){return Math.pow(2,t)*e}getSubNode(e,t,i){(!t||e<this.tileSize)&&(t=0),(!i||e<this.tileSize)&&(i=0),e<this.tileSize&&(e=this.tileSize);const s=m(this.tileSize,e);return y(this.root,0,s,t,i)}deleteAllNodes(){this.depthFirst(function(e,t,i,s,n){for(let t=0;t<e.children.length;t++){const i=e.children[t];i&&(i.parent=null,i.tree=null),e.children[t]=null}e.children.length=0}.bind(this),null,a.PostOrder);for(let e=0;e<this.allNodes.length;e++){const t=this.allNodes[e];t&&(t.parent=null,t.tree=null),this.allNodes[e]=null}this.allNodes.length=0,this.root=null}breadthFirst(e){const t=!!(e=e||{}).nullLevelEnd,i=e.maxLevel,s=e.minLevel,n=e.callback,o=e.saveVisited,r=[],a=new u(this,null);let l=0;if(this.root)for(r.push(this.root),r.push(a);r.length>0&&!(i&&l>i);){const e=r.shift();if(e)if(e===a)(!s||l>=s)&&(n&&t&&n(),o&&t&&o.push(null)),r.length>0&&r.push(a),l++;else{if(e.children)for(const t of e.children)t&&r.push(t);const t=this.getFaceIndexFromNode(e);(!s||l>=s)&&(n&&n(e,l,t),o&&o.push(e))}}}getFaceIndexFromNode(e){if(!e)return-1;let t=1,i=e,s=0,n=0;for(;;){const e=i.parent;if(!e)break;let o=-1;for(let t=0;t<e.children.length;t++)e.children[t]===i&&(o=t);s=o%2*t+s,n=Math.floor(o/2)*t+n,t*=2,i=e}return n*t+s}depthFirst(e,t,i){g(this.root,0,0,0,e,t,i,this.tileSize)}}const m=function(e,t){let i=0;for(t<e&&(t=e);!((t/=2)<e);)i++;return i},g=function(e,t,i,s,n,o,r,l){if(!e)return;const c=2*s+i;if((r=r||a.PreOrder)===a.PreOrder&&(n&&n(e,t,c,i,s),o&&o.push(e)),!e.children||0===e.children.length)return;const h=2*s,d=2*i;for(let i=0;i<2;i++)for(let s=0;s<2;s++)g(e.children[2*s+i],t+1,d+i,h+s,n,o,r,l);r===a.PostOrder&&(n&&n(e,t,c,i,s),o&&o.push(e))},f=e=>{e.root=v(e,null,0)},v=(e,t,i)=>{if(i>e.levels)return null;const s=new u(e,t);s.level=i,e.allNodes.push(s);for(let t=0;t<4;t++){const n=v(e,s,i+1);n&&(s.children[t]=n)}return s},y=(e,t,i,s,n)=>{if(!e)return null;if(0===i)return e;{if(!e.children||0===e.children.length)return null;const o=Math.pow(2,i)/2,r=s%o,a=n%o,l=2*Math.floor(n/o)+Math.floor(s/o),c=e.children[l];return y(c,t+1,i-1,r,a)}};var b,w=i(13338),S=i(73732),T=i(84559),E=i(41446),_=i(87131),x=i(67569),M=i(20134);!function(e){e[e.Base=0]="Base",e[e.Remaining=1]="Remaining"}(b||(b={}));class P{constructor(){this.forceQueue=[],this.uploadQueues={},this.panoLODDescriptors={}}addToForceQueue(e){this.forceQueue.push(e)}addToPanoQueue(e,t){this.getUploadQueueForPano(e).push(t)}insertSortedIntoPanoQueue(e,t,i){const s=this.getUploadQueueForPano(t.id);M.at.insertSortedPanoTile(s,e,t,i)}sortQueue(e,t){const i=this.getUploadQueueForPano(e.id);M.at.sortTiles(i,e,t)}getUploadQueueForPano(e){let t=this.uploadQueues[e];return t||(t=[],this.uploadQueues[e]=t),t}hasQueuedTiles(){if(this.forceQueue.length>0)return!0;for(const e in this.uploadQueues){const t=this.getUploadQueueForSweep(e);if(t&&t.length>0)return!0}return!1}getUploadQueueForSweep(e){let t=this.uploadQueues[e];return t||(t=[],this.uploadQueues[e]=t),t}getTopUploadQueue(e){let t=null;for(let i=b.Base;i<=b.Remaining;i++)for(const s of e)if(t=this.getUploadQueueForSweep(s.id),t.length>0)switch(i){case b.Base:if(0===t[0].level)return t;break;case b.Remaining:return t}return null}processNextQueueItem(e){const t=e.shift();return t?(t.uploadQueued=!1,t):null}getNextFromUploadQueue(e){if(this.forceQueue.length>0)return this.processNextQueueItem(this.forceQueue);const t=this.getTopUploadQueue(e);return t&&t.length>0?this.processNextQueueItem(t):null}peekNextFromUploadQueue(e){if(this.forceQueue.length>0)return this.forceQueue[0];const t=this.getTopUploadQueue(e);return t&&t.length>0?t[0]:null}clearAllQueuedUploads(){this.clearAllUploadQueues(null,0)}clearAllUploadQueues(e,t=0){if(e)this.clearUploadQueue(this.getUploadQueueForSweep(e),t),this.clearUploadQueue(this.forceQueue,t,e);else{for(const e in this.uploadQueues)this.clearUploadQueue(this.getUploadQueueForSweep(e),t);this.clearUploadQueue(this.forceQueue,t)}}clearUploadQueue(e,t=0,i){let s=0;for(;s<e.length;){const n=e[s];(!i||i&&i===n.sweepId)&&n.level>=t?(n.uploadQueued=!1,e.splice(s,1)):s++}}resetPanoLODDescriptors(e){const t=this.getPanoLODDescriptors(e);for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];i.uploadCount=0,i.uploadAttempts=0}}getPanoLODDescriptor(e,t){const i=this.getPanoLODDescriptors(e);let s=i[t];return s||(s={uploadCount:0,uploadAttempts:0},i[t]=s),s}getPanoLODDescriptors(e){let t=this.panoLODDescriptors[e];return t||(t={},this.panoLODDescriptors[e]=t),t}}var A=i(7922),O=i(62367),D=i(26199),I=i(82209);const C=new l.Z("tiles"),R=s.Xd.uploadIntervalDelay;class L extends S.Z{constructor(e,t,i,s,n,o,r,a){super(e,n.getSweepList()),this.cwfRenderer=t,this.panoQualityManager=i,this.tileDownloader=s,this.sweepData=n,this.cameraData=o,this.tilingSettings=r,this.broadcast=a,this.persistentStorage=new x.a,this.activeSweeps=[],this.sweepLoadHistory=[],this.activeRenderTargetDescriptors={},this.panoLoadPromises={},this.panoLoadResolvers={},this.panoLoadTimers={},this.tileTrees={},this.tileDirectory={},this.zoomSweepRenderingDisabled=!1,this.zoomingActive=!1,this.zoomSweepId=null,this.usingTileOverlay=!1,this.overlayTilesLoaded=!1,this.overlayTileBase=null,this.overlayTilesBasic={},this.overlayTilesEnhanced={},this.tileUploadQueue=new P,this.currentState={direction:new c.Pa4,position:new c.Pa4,rotation:new c._fP},this.renderTargetPool=new h.L(this.rtCompare),this.tileDownloader.setModel(this.sweepListMap),this.tileDownloader.setLoadCallbacks(this.onTileDownLoaded.bind(this))}activate(e){this.engine=e}rtCompare(e,t){return e.object.height===t.size&&e.object.width===t.size}getActivePanos(){const e=[];for(const t of Object.keys(this.activeRenderTargetDescriptors))this.activeRenderTargetDescriptors[t]&&e.push(t);return e}init(){super.init(),this.loadOverlayTiles()}highResRenderTarget(e,t){if(e){if(!t)throw new r("Cannot activate zooming without sweepId!");this.zoomingActive=!0,this.zoomSweepId=t,this.copyTargetToZoom(t)}else this.zoomingActive=!1,this.zoomSweepId=null;if(t){const e=this.getRenderTargetDescriptorForSweep(t);if(!e)throw new r("Zooming at a null render target!");const i=this.zoomingActive?this.zoomRenderTarget:e.object,s=i.width;this.broadcast(new A.Z(s,t,i))}}getCurrentPanoResolution(){const e=this.zoomingActive?this.panoQualityManager.getZoomPanoSize():this.panoQualityManager.getNavPanoSize();return T.Z.getPanoSizeClass(e)}beforeRender(){const e=this.sweepData.currentSweep,t=this.sweepData.transition.to;this.updateState(this.cameraData.pose.position,this.cameraData.pose.rotation,e,t),this.updateUploadQueueProcessing()}activateSweep(e){const t=this.sweepListMap.get(e);if(!t)throw C.error(e,t),new r("Invalid sweepId passed to TiledPanORenderer.activate()");let i=this.panoLoadPromises[e];return i||(this.panoLoadTimers[e]=window.setTimeout((()=>{this.engine.broadcast(new I.Z_(!0))}),s.Xd.loadIndicatorDelay),i=new Promise(((i,s)=>{this.panoLoadResolvers[e]=i,this.updateSweepState(e),this.activatePano(t),this.queueUploadForAllTiles(e,!0),this.tileDownloader.forceQueueTiles(t,T.Z.getPanoSize(_.SL.BASE),this.currentState.direction,!0)})),this.panoLoadPromises[e]=i),super.activateSweep(e),i}useTexture(e){const t=this.getRenderTargetDescriptorForSweep(e);if(!t)throw C.error(e),Error("Texture for sweep not activated before using");const i=t.object.texture;return super.useTexture(e),this.freeUnusedTextures(),this.zoomingActive?this.zoomRenderTarget.texture:i}freeTexture(e,t=!1){super.freeTexture(e,t),0===this.textureUsageCounter[e]&&(this.panoLoadPromises[e]=null,this.deactivatePano(e))}freeAllTextures(e=[]){const t=(0,O.ow)(e),i=this.getActivePanos();for(const e of i)t[e]||this.freeTexture(e,!0)}enableUltraHighQualityMode(e){this.setupZoomRenderTarget(),this.zoomSweepId&&this.broadcast(new A.Z(this.zoomRenderTarget.width,this.zoomSweepId,this.zoomRenderTarget))}resetRenderStatus(e,t,i,s){let n;s&&(n=m(w.I_,s)+1);const o=(e,s,n,o)=>{i&&(s.extra.tile.zoomUploaded=!1),t&&(s.extra.tile.uploaded=!1)};for(let t=0;t<w.Hq;t++)this.getTileTree(e,t).breadthFirst({callback:o.bind(this,t),minLevel:n})}copyBaseRenderStatusToZoomed(e){const t=m(w.I_,this.panoQualityManager.getNavPanoSize()),i=(e,t,i,s)=>{t.extra.tile.zoomUploaded=t.extra.tile.uploaded,t.extra.zoomCovered=t.extra.covered};for(let s=0;s<w.Hq;s++)this.getTileTree(e,s).breadthFirst({callback:i.bind(this,s),maxLevel:t})}renderPanoTiles(e,t,i,s){const n=[];this.zoomRenderTarget&&this.zoomRenderTarget.width===this.panoQualityManager.getZoomPanoSize()||this.zoomSweepRenderingDisabled||this.setupZoomRenderTarget(),t=t||this.currentState.direction||d.f.FORWARD;const o=this.getRenderTargetDescriptorForSweep(e);if(!this.isRenderTargetDescriptorValid(o))throw new r("PanoRenderer.renderPanoTiles() -> Cannot render to a pano that is not activated.");for(let t=0;t<w.Hq;t++){const o=this.getTileTree(e,t);n.length=0,o.breadthFirst({saveVisited:n});for(let e=0;e<n.length;e++){const t=n[e];this.queueUploadForTile(t.extra.tile,!1,s||0===e&&i)}}}clearAllQueuedUploads(){this.tileUploadQueue.clearAllUploadQueues(null,0)}clearAllQueuedUploadsForPano(e){this.tileUploadQueue.clearAllUploadQueues(e,0)}updateState(e,t,i,s){const n=s||i||this.currentState.sweepId,o=n?this.sweepListMap.get(n):null;this.updatePositionState(e),this.updateRotationState(t),n&&this.updateSweepState(n),o&&this.tileDownloader.tilePrioritizer&&this.tileDownloader.tilePrioritizer.updateCriteria(o,e,this.currentState.direction,this.currentState.rotation)}updatePositionState(e){this.currentState.position.copy(e)}updateRotationState(e){if(this.currentState.rotation.copy(e),this.currentState.direction.copy(d.f.FORWARD).applyQuaternion(e),this.tileUploadQueue.hasQueuedTiles())for(const e of this.activeSweeps)this.tileUploadQueue.sortQueue(e,this.currentState.direction)}updateSweepState(e){this.currentState.sweepId=e}activatePano(e){this.tileUploadQueue.clearAllQueuedUploads();const t=this.panoQualityManager.getMaxPossiblePanoSize();for(let i=0;i<w.Hq;i++)this.initTileTree(e.id,i,t);this.linkAllTilesAndNodes(e);let i=this.getRenderTargetDescriptorForSweep(e.id);if(!i){const t=this.panoQualityManager.getNavPanoSize();if(i=this.renderTargetPool.get({size:t}),!i){const e=this.cwfRenderer.initRenderTargetCube(t);i=this.renderTargetPool.add(e),i.extra={},i.extra.size=e.width}i.extra.sweep=e,i.extra.sweepindex=e.index,this.setRenderTargetDescriptorForSweep(e.id,i),this.tileUploadQueue.resetPanoLODDescriptors(e.id),this.resetUploadState(e.id,!0,!0)}return this.updateActiveSweeps(e),i.object}deactivatePano(e){const t=this.getRenderTargetDescriptorForSweep(e);t&&this.isRenderTargetDescriptorValid(t)&&(this.renderTargetPool.free(t.object),this.setRenderTargetDescriptorForSweep(e,null),this.updateActiveSweeps(),this.tileUploadQueue.clearAllUploadQueues(e),this.tileUploadQueue.resetPanoLODDescriptors(e),this.clearCachedTileData())}clearCachedTileData(){for(let e=this.sweepLoadHistory.length-1;e>=0;e--){let t=!1;const i=this.sweepLoadHistory[e];if(i){for(const e of this.activeSweeps)if(i===e.id){t=!0;break}!t&&this.checkTileTreeInitialized(i)&&(this.clearTileState(i,!0,!0),this.deleteTileTrees(i),this.deleteTileDirectoryEntries(i),this.tileDownloader.deleteAllTileDownloadDescriptors(i),this.sweepLoadHistory[e]=null)}}this.updateSweepLoadHistory()}updateActiveSweeps(e){const t=this.persistentStorage.getArray("updateActiveSweeps:tempSweeps");t.length=0;for(const i of this.activeSweeps){const s=this.getRenderTargetDescriptorForSweep(i.id);e&&i.id===e.id||!this.isRenderTargetDescriptorValid(s)||t.push(i)}e&&t.unshift(e),this.activeSweeps.length=0,this.activeSweeps.push(...t)}queueUploadForAllTiles(e,t=!0){this.zoomRenderTarget&&this.zoomRenderTarget.width===this.panoQualityManager.getZoomPanoSize()||this.zoomSweepRenderingDisabled||this.setupZoomRenderTarget();const i=this.getRenderTargetDescriptorForSweep(e);if(!this.isRenderTargetDescriptorValid(i))throw new r("queueUploadForAllTiles() -> Cannot render to a pano that is not activated.");const s=this.persistentStorage.getArray("queueUploadForAllTiles:nodeList");for(let i=0;i<w.Hq;i++){const n=this.getTileTree(e,i);s.length=0,n.breadthFirst({saveVisited:s});for(const e of s)this.queueUploadForTile(e.extra.tile,!1,0===e.level&&t)}}onTileDownLoaded(e){if(!e.sweep)return;const t=m(w.I_,e.panoSize),i=this.getTileDirectoryEntry(e.sweep.id,e.face,t,e.faceTileIndex);this.updateUploadDescriptorFromDownloadDescriptor(i,e),this.updateSweepLoadHistory(i.sweepId);const s=this.getRenderTargetDescriptorForSweep(i.sweepId);if(this.isRenderTargetDescriptorValid(s)){const e=this.getTileTree(i.sweepId,i.face).getSubNode(i.panoSize,i.tileX,i.tileY);e&&(this.linkTileAndNode(i,e),this.queueUploadForTile(i,!0))}}updateUploadDescriptorFromDownloadDescriptor(e,t){e.downloaded=!0,e.image=t.image,e.panoSize=t.panoSize,e.tileX=t.tileX,e.tileY=t.tileY,e.totalTiles=t.totalTiles,e.tileIndex=t.tileIndex,e.faceTileIndex=t.faceTileIndex,e.face=t.face,e.cubeFace=E.m(t.face),t.sweep&&(e.sweepId=t.sweep.id),e.tileSize=t.tileSize,e.direction.copy(t.direction),e.node=null,e.level=m(w.I_,e.panoSize)}updateSweepLoadHistory(e){const t=this.persistentStorage.getArray("updateSweepLoadHistory:tempHistory");t.length=0;for(const i of this.sweepLoadHistory)i&&(!e||e&&e!==i)&&t.push(i);this.sweepLoadHistory.length=0,e&&this.sweepLoadHistory.push(e),this.sweepLoadHistory.push(...t)}onPanoRendered(e,t,i,s){clearTimeout(this.panoLoadTimers[e]),this.engine.broadcast(new I.Z_(!1));const n=this.panoLoadResolvers[e],o=this.activeRenderTargetDescriptors[e];o&&o.object&&n(o.object.texture)}getRenderTargetDescriptorForSweep(e){return this.activeRenderTargetDescriptors[e]}setRenderTargetDescriptorForSweep(e,t){this.activeRenderTargetDescriptors[e]=t}isRenderTargetDescriptorValid(e){return!!e&&!!e.object}isSweepZoomed(e){return this.zoomingActive&&this.zoomSweepId===e}initTileTree(e,t,i){let s=this.tileTrees[e];s||(s=[],this.tileTrees[e]=s);let n=s[t];if(!n){const e=m(w.I_,i);n=new p(w.I_,e),s[t]=n}}getTileTrees(e){const t=this.tileTrees[e];if(!t)throw new r("TiledPanoRenderer.getTileTrees() -> Tree array not yet initialized!");return t}checkTileTreeInitialized(e){return!!this.tileTrees[e]}getTileTree(e,t){const i=this.getTileTrees(e)[t];if(!i)throw new r("TiledPanoRenderer.getTileTree() -> Tree not yet initialized!");return i}deleteTileTrees(e){const t=this.getTileTrees(e);for(let e=0;e<w.Hq;e++){const i=t[e];i&&i.deleteAllNodes()}this.tileTrees[e]=null,delete this.tileTrees[e]}clearTileState(e,t=!1,i=!1){const s=(e,s,n,o)=>{i&&(s.extra.tile.image=null),t&&(s.extra.tile.uploaded=!1,s.extra.tile.downloaded=!1,s.extra.tile.zoomUploaded=!1,s.extra.tile.uploadAttempted=!1)};for(let t=0;t<w.Hq;t++){const i=this.getTileTree(e,t);i&&i.breadthFirst({callback:s.bind(this,t),maxLevel:m(w.I_,this.panoQualityManager.getZoomPanoSize())})}}resetUploadState(e,t,i){const s=(e,s,n,o)=>{s.extra.tile.zoomUploaded=!i&&s.extra.tile.zoomUploaded,s.extra.tile.uploaded=!t&&s.extra.tile.uploaded};for(let t=0;t<w.Hq;t++)this.getTileTree(e,t).breadthFirst({callback:s.bind(this,t),minLevel:0})}anyUploaded(e){if(!e)return!1;if(e.extra.tile&&this.isTileUploaded(e.extra.tile))return!0;if(e.children)for(const t of e.children)if(this.anyUploaded(t))return!0;return!1}linkTileAndNode(e,t){t.extra.tile=e,e.node=t}linkAllTilesAndNodes(e){const t=(t,i,s,n,o)=>{const r=this.getTileDirectoryEntry(e.id,i,n,o);this.linkTileAndNode(r,s)};for(let i=0;i<w.Hq;i++){const s=this.getTileTree(e.id,i);s.breadthFirst({callback:t.bind(this,s,i)})}}getTileDirectoryEntry(e,t,i,s){let n=this.tileDirectory[e];n||(n={},this.tileDirectory[e]=n);const o=16384*t+1024*i+s;let r=n[o];return r||(r={downloaded:!1,uploaded:!1,uploadAttempted:!1,zoomUploaded:!1,uploadQueued:!1,image:null,panoSize:-1,tileX:-1,tileY:-1,totalTiles:-1,tileIndex:s,faceTileIndex:-1,face:t,cubeFace:-1,sweepId:e,tileSize:-1,direction:new c.Pa4,node:null,level:i},n[o]=r),r._tileKey=o,r}deleteTileDirectoryEntries(e){this.tileDirectory[e]=null,delete this.tileDirectory[e]}isTileUploaded(e){return this.isSweepZoomed(e.sweepId)?e.zoomUploaded:e.uploaded}setUploaded(e,t){this.isSweepZoomed(e.sweepId)?e.zoomUploaded=t:e.uploaded=t}queueUploadForTile(e,t,i){const s=!e.downloaded||e.uploadQueued&&!i||this.isTileUploaded(e)||e.panoSize>this.panoQualityManager.getNavPanoSize()&&!this.zoomingActive,n=this.getRenderTargetDescriptorForSweep(e.sweepId);!s&&n&&this.isRenderTargetDescriptorValid(n)&&(i?this.uploadTile(e):(0===m(w.I_,e.panoSize)?this.tileUploadQueue.addToForceQueue(e):t&&this.currentState.direction?this.tileUploadQueue.insertSortedIntoPanoQueue(e,n.extra.sweep,this.currentState.direction):this.tileUploadQueue.addToPanoQueue(e.sweepId,e),e.uploadQueued=!0))}uploadTile(e){const t=this.persistentStorage.get("uploadTile:tempTileTexture",(()=>({}))),i=this.tileUploadQueue.getPanoLODDescriptor(e.sweepId,e.panoSize),n=this.getRenderTargetDescriptorForSweep(e.sweepId);if(!n||!e.image||!this.isRenderTargetDescriptorValid(n))return;let o=n.object,r=n.extra.size;if(this.isSweepZoomed(e.sweepId)&&(o=this.zoomRenderTarget,r=this.panoQualityManager.getZoomPanoSize()),this.isTileUploaded(e)||this.anyUploaded(e.node))this.setUploaded(e,!1);else{const n=e.tileX*e.tileSize,a=e.tileY*e.tileSize,l=e.tileSize/e.panoSize*r,h=n/e.panoSize*r,d=a/e.panoSize*r;let u=t[e.tileSize];if(t[e.tileSize]||(u=new c.xEZ,u.generateMipmaps=!1,u.minFilter=c.wem,u.flipY=!1,this.cwfRenderer.initSizedTexture2D(e.tileSize,u),t[e.tileSize]=u),this.cwfRenderer.uploadTexture2D(e.image,u,0,0),this.cwfRenderer.renderToCubeMap(u,o,e.tileSize,e.tileSize,0,0,e.tileSize,e.tileSize,h,d,l,l,e.cubeFace),s.Xd.overlayStyle>0){const t=1===s.Xd.overlayStyle?this.overlayTilesBasic:this.overlayTilesEnhanced;this.cwfRenderer.renderToCubeMap(t[e.panoSize],o,e.tileSize,e.tileSize,0,0,e.tileSize,e.tileSize,h,d,l,l,e.cubeFace,c.bdR,!0,.5)}i.uploadCount++,this.setUploaded(e,!0)}e.uploadAttempted||i.uploadAttempts++,e.uploadAttempted=!0,i.uploadAttempts===e.totalTiles&&this.onPanoRendered(e.sweepId,e.panoSize,e.totalTiles)}updateUploadQueueProcessing(){if(!this.currentUploadPromise&&(this.overlayTilesLoaded||!this.usingTileOverlay)){const e=new D._("pano/tiling/upload",(()=>{this.processUploadQueue(this.tilingSettings.highResUploadsPerFrame,this.tilingSettings.uploadsPerFrame)}),R);this.currentUploadPromise=this.engine.commandBinder.issueCommand(e).then((async e=>{await e.promise,this.currentUploadPromise=null}))}}processUploadQueue(e=1,t){let i=0,s=0,n=null;for(;n=this.tileUploadQueue.getNextFromUploadQueue(this.activeSweeps);){const o=this.getRenderTargetDescriptorForSweep(n.sweepId);if(!(n.panoSize>this.panoQualityManager.getNavPanoSize()&&!this.zoomingActive||!this.isRenderTargetDescriptorValid(o))&&(this.uploadTile(n),i+=0!==n.level?1:0,s+=0===n.level?1:0,s>=t||i>=e))break}}loadOverlayTiles(){if(0!==s.Xd.overlayStyle){let e=0;const t=[],n=(i,s,n)=>{let o=new c.xEZ;o.generateMipmaps=!1,o.minFilter=c.wem,o.flipY=!1,s?o=i[s]=this.cwfRenderer.initSizedTexture2D(w.I_,o):(this.overlayTileBase=this.cwfRenderer.initSizedTexture2D(w.I_,o),o=this.overlayTileBase),this.cwfRenderer.uploadTexture2D(n,o,0,0),e++,e>=t.length&&(this.overlayTilesLoaded=!0)};switch(s.Xd.overlayStyle){case 1:t.push([i(67929),this.overlayTilesBasic,256]),t.push([i(67929),this.overlayTilesBasic,512]),t.push([i(27273),this.overlayTilesBasic,1024]),t.push([i(15278),this.overlayTilesBasic,2048]),t.push([i(92787),this.overlayTilesBasic,4096]);break;case 2:t.push([i(33967),this.overlayTilesEnhanced,256]),t.push([i(33967),this.overlayTilesEnhanced,512]),t.push([i(53896),this.overlayTilesEnhanced,1024]),t.push([i(38343),this.overlayTilesEnhanced,2048]),t.push([i(73965),this.overlayTilesEnhanced,4096])}t.forEach((e=>{const t=document.createElement("img");t.crossOrigin="anonymous",t.src=e[0],t.onload=()=>{n.call(this,e[1],e[2],t)}})),this.usingTileOverlay=!0}else this.usingTileOverlay=!1}copyTargetToZoom(e){if(!this.zoomingActive)return;const t=this.getRenderTargetDescriptorForSweep(e);if(!t)throw new r("Error in copying a null render target to a zoomed target");const i=t.object;this.cwfRenderer.copyCubemap(i.texture,this.zoomRenderTarget),this.copyBaseRenderStatusToZoomed(e)}setupZoomRenderTarget(){if(this.panoQualityManager.getZoomPanoSize()>=this.panoQualityManager.getNavPanoSize()){if(this.zoomRenderTarget&&this.zoomRenderTarget.width===this.panoQualityManager.getZoomPanoSize())return;const e=this.zoomRenderTarget;this.zoomRenderTarget=this.cwfRenderer.initRenderTargetCube(this.panoQualityManager.getZoomPanoSize()),e&&(this.cwfRenderer.copyCubemap(e.texture,this.zoomRenderTarget),e.texture.dispose(),e.texture.version=0,this.cwfRenderer.deallocateCubeTexture(e.texture),e.texture=null),this.zoomSweepRenderingDisabled=!1}else this.zoomSweepRenderingDisabled=!0}}var N=i(50966),k=i(37024),F=i(20331),B=i(15253);const U=new l.Z("tile-downloader");class H{constructor(e,t,i,s){this.urls=e,this.panoQualityManager=t,this.tilePrioritizer=i,this.settings=s,this.persistentStorage=new x.a,this.downloadDescriptors={},this.priorityQueue=[],this.forceQueue=[],this.activeDownloads=[],this.lastPrioritizedTime=Date.now(),this.processPriorityQueue=!0}init(){}render(){this.update()}update(){this.processQueue(this.forceQueue,!1),this.processPriorityQueue&&(!this.processQueuePromise&&this.sweepListMap&&this.activeDownloads.length<this.settings.concurrentDownloads&&Date.now()-this.lastPrioritizedTime>200&&(this.processQueuePromise=this.engine.commandBinder.issueCommand(new D._("pano/tiling/queue-download",(()=>{this.queuePrioritizedTiles(this.sweepListMap),this.lastPrioritizedTime=Date.now()}),100)).then((async e=>{await e.promise,this.processQueuePromise=null}))),this.processQueue(this.priorityQueue,!1))}dispose(){}activate(e){this.engine=e}deactivate(e){}setModel(e){this.setSweeps(e)}setRestrictedSweeps(e){if(this.sweepListMap&&this.tilePrioritizer){const t=[];for(const i of e)t.push(this.sweepListMap.get(i));this.tilePrioritizer.setUpcomingSweeps(t),this.clearFromAllQueuesBySweep(e)}}clearRestrictedSweeps(){this.tilePrioritizer&&this.tilePrioritizer.clearUpcomingSweeps()}setLoadCallbacks(e,t){this.onTileDownloaded=e,this.onPanoDownloaded=t}setSweeps(e){this.sweepListMap=e}getNonDownloadedTiles(e,t,i){i.length=0;const s=this.getTileDownloadDescriptors(e,t);for(const e of s)!e||e.status!==k.Z.None&&e.status!==k.Z.Queued||i.push(e)}forceQueueTiles(e,t,i,s,n,o){const r=this.persistentStorage.getArray("forceQueueTiles:remaining"),a=this.persistentStorage.getArray("forceQueueTiles:matching"),l=this.persistentStorage.getArray("forceQueueTiles:toDownload");if(this.getNonDownloadedTiles(e,t,r),l.length=0,r.length>0){M.at.sortTiles(r,e,i),a.length=0,w.oU(e,t,i,a,!0);for(const e of r)for(const t of a)e.face===t.face&&e.faceTileIndex===t.faceTileIndex&&l.push(e);this.forceQueue.push.apply(this.forceQueue,l),this.setStatusForAllDescriptors(this.forceQueue,k.Z.ForceQueued),this.clearFromQueue(this.priorityQueue,k.Z.ForceQueued,!1),s&&this.processQueue(this.forceQueue,!0)}}clearForceQueue(){this.clearQueue(this.forceQueue)}queuePrioritizedTiles(e){this.tilePrioritizer&&(this.clearQueue(this.priorityQueue),this.tilePrioritizer.filterAndPrioritize(this.priorityQueue,e,this),this.invalidateDuplicateEntries(this.priorityQueue),this.clearFromQueue(this.priorityQueue,k.Z.None,!0),this.setStatusForAllDescriptors(this.priorityQueue,k.Z.Queued),this.lastPrioritizedTime=Date.now())}clearQueue(e){this.setStatusForAllDescriptors(e,k.Z.None),e.length=0}clearFromQueue(e,t,i){for(let s=0;s<e.length;s++){const n=e[s];n&&(t===n.status&&!i||t!==n.status&&i)&&(e[s]=null)}}clearFromAllQueuesBySweep(e){this.clearFromQueueBySweep(this.forceQueue,e),this.clearFromQueueBySweep(this.priorityQueue,e)}clearFromQueueBySweep(e,t){const i=(0,O.ow)(t);for(let t=0;t<e.length;t++){const s=e[t];s&&s.sweep&&(i[s.sweep.id]||(e[t]=null))}}setStatusForAllDescriptors(e,t){for(const i of e)i&&(i.status=t)}invalidateDuplicateEntries(e){for(const t of e)t&&(t.queuedCount=0);for(let t=0;t<e.length;t++){const i=e[t];i&&(i.queuedCount++,i.queuedCount>1&&(e[t]=null))}}getTileDownloadDescriptors(e,t){const i=this.getAllTileDownloadDescriptors(e.id);let s=i[t];return s||(s=this.buildDownloadDescriptorArray(t),i[t]=s,this.initTileDownloadDescriptors(s,e,t)),s}getAllTileDownloadDescriptors(e){let t=this.downloadDescriptors[e];return t||(t={},this.downloadDescriptors[e]=t),t}deleteAllTileDownloadDescriptors(e){this.downloadDescriptors[e]=null,delete this.downloadDescriptors[e]}processQueue(e,t){if(this.cleanupActiveDownloads(),this.activeDownloads.length<this.settings.concurrentDownloads||t){const i=t?e.length:this.settings.concurrentDownloads-this.activeDownloads.length;let s=0;for(let t=0;s<i&&e.length>0;t++){const t=e.shift();t&&(this.startDownload(t),s++)}}}async startDownload(e){if(!this.urls)throw new Error("Can't call startDownload without signed urls");if(e.sweep){const t=e.status===k.Z.ForceQueued?F.ru.HIGHEST:F.ru.MEDIUM;e.status=k.Z.Downloading,this.checkRestrictedSweep(e.sweep.id)||U.warn("Downloading a tile that is not in restricted list"),this.activeDownloads.push(e);const i=await this.panoQualityManager.getTileUrl(e.sweep,e.panoSize,e.tileSize,e.tileIndex);this.urls.getImageBitmap(i,e.tileSize,e.tileSize,{maxRetries:4,priority:t}).then(this.downloadComplete.bind(this,e),this.downloadFailed.bind(this,e))}}checkRestrictedSweep(e){if(this.tilePrioritizer){const t=this.tilePrioritizer.priorityCriteria.upcomingSweeps;if(t){let i=!1;for(const s of t)s&&s.id===e&&(i=!0);return i}return!0}return!0}downloadFailed(e,t){e.status=k.Z.DownloadFailed}downloadComplete(e,t){if(e.sweep&&(e.status=k.Z.Downloaded,e.image=t,this.onTileDownloaded&&this.onTileDownloaded(e),this.engine.broadcast(new B.o),this.isPanoDownloaded(e.sweep,e.panoSize))){const t={sweep:e.sweep,tileSize:e.tileSize,panoSize:e.panoSize};this.onPanoDownloaded&&this.onPanoDownloaded(t)}}cleanupActiveDownloads(){const e=this.persistentStorage.getArray("cleanupActiveDownloads:temp");e.length=0;for(const t of this.activeDownloads)t.status!==k.Z.Downloaded&&t.status!==k.Z.DownloadFailed&&e.push(t);this.activeDownloads.length=0,this.activeDownloads.push.apply(this.activeDownloads,e)}isPanoDownloaded(e,t){const i=this.getTileDownloadDescriptors(e,t);if(!i||i.length<=0)return!1;for(const e of i)if(e&&e.status!==k.Z.Downloaded)return!1;return!0}buildDownloadDescriptorArray(e){const t=w.Tu(e),i=[];for(let e=0;e<t;e++){const e=this.buildDownloadDescriptor();i.push(e)}return i}buildDownloadDescriptor(){return{sweep:null,panoSize:-1,tileSize:-1,tileIndex:-1,totalTiles:-1,faceTileIndex:-1,status:k.Z.None,url:null,image:null,direction:new c.Pa4,face:-1,cubeFace:-1,tileX:-1,tileY:-1,queuedCount:-1}}initTileDownloadDescriptors(e,t,i){for(let s=0;s<e.length;s++){const n=e[s];n&&this.initTileDownloadDescriptor(n,t,i,s)}}initTileDownloadDescriptor(e,t,i,s){const n=i>=w.I_?w.I_:i;e.face=w.R5(i,s),e.cubeFace=E.m(e.face),e.sweep=t,e.panoSize=i,e.tileSize=n,e.tileIndex=s,e.totalTiles=w.Tu(i),e.status=k.Z.None,e.image=null,w.Tp(e.panoSize,e.tileIndex,e),w.P6(e.panoSize,e.tileSize,e.cubeFace,e.tileX,e.tileY,N.Z.Center,0,e.direction)}}var G=i(13453),V=i(96640),z=i(22423),j=i(77956),W=i(50101),Z=i(60463),q=i(89155),K=i(44266),Y=i(39936),$=i(86450),Q=i(24135),X=i(21265),J=i(81660),ee=i(97620),te=i(23042),ie=i(13402);const se=new l.Z("sweep-pano-tiling");var ne;!function(e){e[e.CurrentView=0]="CurrentView",e[e.FullPanorama=1]="FullPanorama"}(ne||(ne={}));class oe extends Z.Z{constructor(){super(...arguments),this.name="sweep-pano-tiling",this.preloadQuality=null,this.preloadResolution=null,this.handlePlayerResize=(e,t)=>{const i=this.currentResolution();this.panoRenderer.panoQualityManager.setWindowSize(e.width,e.height),i!==this.currentResolution()&&t&&this.resetPano(t)}}async init(e,t){const o=await t.getModule(z.default),r=await t.getModule(W.default),a=await t.market.waitForData(j.Z);this.cameraData=await t.market.waitForData(q.M_);const l=await t.market.waitForData(Q.P);this.settingsData=await t.market.waitForData(Y.e);const c=r.cwfRenderer,h=r.maxCubemapSize,d=o.getSignedUrls();this.settings=new s.k4,this.qualityManager=new T.Z(d,h,e.navPanoSize,e.zoomPanoSize),this.tilePrioritizer=new M.at(this.qualityManager,this.settings,a,l),this.tileDownloader=new H(d,this.qualityManager,this.tilePrioritizer,this.settings),this.panoRenderer=new L(d,c,this.qualityManager,this.tileDownloader,a,this.cameraData,this.settings,(e=>t.broadcast(e))),t.addComponent(this,this.tileDownloader),t.addComponent(this,this.panoRenderer),this.bindings.push(t.subscribe(te.Z,(e=>{this.setTilingFOV()})),t.subscribe(n.a,(e=>{this.handlePlayerResize(e,a.currentSweep),this.setTilingFOV()})),t.subscribe(G.Z,(e=>{this.tileDownloader.setRestrictedSweeps(e.sweepIds)})),t.subscribe(V.Z,(e=>{this.tileDownloader.clearRestrictedSweeps()})),t.subscribe(J.Z,(e=>{const t=a.getSweep(e.sweepId);this.setHoverPreloadSweep(e.hovered?t:void 0)})),t.subscribe(ie.a,(e=>{this.tilePrioritizer.priorityCriteria.viewMode=e.toMode})),a.onPropertyChanged("transitionActive",(()=>{if(a.transition.to){const e=a.getSweep(a.transition.to);this.handlePreloadQualityChange(e)}})),this.settingsData.onPropertyChanged(s.YS,(()=>{this.preloadQuality=this.settingsData.tryGetProperty(s.YS,null),this.qualityManager.overrideWindowMaximums(null!==this.preloadQuality),a.currentSweepObject&&this.handlePreloadQualityChange(a.currentSweepObject)})),t.commandBinder.addBinding($.D,(async e=>{this.qualityManager.overrideWindowMaximums(e.ignoreWindowSize)})),t.commandBinder.addBinding($.F,(async e=>{this.qualityManager.updateNavPanoSize(e.navSize)}))),this.setTilingFOV(),(0,X.hu)("debug","").includes("panopreload")&&i.e(383).then(i.bind(i,40517)).then((e=>{new e.PanoPreloadVisualizer(t,this.qualityManager,this.settings,this.tileDownloader,this.tilePrioritizer)}))}setTilingFOV(){const e=this.cameraData.fovX(),t=this.cameraData.fovY(),i=Math.max(e,t)*ee.MN;this.tilePrioritizer.setDownloadFOV(i)}getRenderer(){return this.panoRenderer}setHoverPreloadSweep(e){this.tilePrioritizer&&this.tilePrioritizer.setHoveredSweep(e)}async handlePreloadQualityChange(e){if(null!==this.preloadQuality){const t=await this.availableResolution(e,this.preloadQuality);this.preloadResolution=T.Z.getPanoSize(t)}else this.preloadResolution=null;this.enableHighRes(!1)}enableHighRes(e=!0,t){const i=null!==this.preloadResolution?this.preloadResolution:e?this.qualityManager.getZoomPanoSize():this.qualityManager.getNavPanoSize();this.tilePrioritizer.maxResolution!==i&&se.debug(`Setting max resolution: ${i}`),this.tilePrioritizer.maxResolution=i,this.panoRenderer.highResRenderTarget(e,t)}async enableZooming(e,t){if(e){const e=T.Z.getPanoSizeClass(this.qualityManager.getZoomPanoSize());return await this.requestResolution(t,e)>=e}return this.enableHighRes(!1,t.id),this.resetPano(t.id),Promise.resolve(!1)}async requestResolution(e,t,i=ne.CurrentView,n=!1){this.settings.highResUploadsPerFrame=n?s.Xd.maxHighResUploadsPerFrame:s.Xd.highResUploadsPerFrame,this.settings.concurrentDownloads=n?s.Xd.maxConcurrentDownloads:s.Xd.concurrentDownloads,this.settings.downloadFullPano=i===ne.FullPanorama;const o=await this.availableResolution(e,t);return o>_.SL.HIGH&&(this.qualityManager.overrideWindowMaximums(!0),this.panoRenderer.enableUltraHighQualityMode(e.id)),(this.currentResolution()<o||T.Z.getPanoSize(o)>this.qualityManager.getNavPanoSize())&&(this.enableHighRes(!0,e.id),this.resetPano(e.id)),o}waitForQueue(e,t,i=1e3){const s=new K.Q,n=()=>{a.cancel(),s.notify(1),s.resolve()};let o=this.tilePrioritizer.getQualityQueueSize(e,t),r=window.setTimeout((()=>{se.debug(`Download queue ${e} timed out from inactivity after ${i}ms`),n()}),i);const a=this.tilePrioritizer.makeQueueSubscription(e,t,(e=>{if(r&&(window.clearTimeout(r),r=0,o=e),e>0){const t=(o-e)/Math.max(o,1);s.notify(t)}else n()}));return s}revertTilingSettings(e){this.enableHighRes(!1,e),this.resetPano(e),this.settings.reset()}availableResolution(e,t){return this.qualityManager.availableResolution(e,t)}currentResolution(){return this.panoRenderer.getCurrentPanoResolution()}resetPano(e){this.panoRenderer.resetRenderStatus(e,!1,!0,this.panoRenderer.panoQualityManager.getNavPanoSize()),this.panoRenderer.clearAllQueuedUploadsForPano(e),this.panoRenderer.renderPanoTiles(e,null,!1,!1)}}},15253:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});var s=i(93528);class n extends s.v{constructor(){super()}}},28281:(e,t,i)=>{"use strict";i.d(t,{YS:()=>n,Xd:()=>o,k4:()=>r});var s=i(21265);const n="settings/tiling/preload_quality",o=Object.freeze({overlayStyle:s.hu("tileoverlay",0),uploadIntervalDelay:s.hu("tileupdelay",50),highResUploadsPerFrame:s.hu("maxnbtpf",2),maxHighResUploadsPerFrame:100,loadIndicatorDelay:300,uploadsPerFrame:s.hu("maxbtpf",6),maxUploadsPerFrame:100,windowHeightHighQualityThreshold:800,windowHeightHighQualityThresholdOverride:s.hu("threshold2k",void 0),concurrentDownloads:s.hu("tileconc",3),maxConcurrentDownloads:12,navigation:{directionFactor:10,distanceFactor:-1}});class r{constructor(){this.reset()}reset(){this.downloadFullPano=!1,this.concurrentDownloads=o.concurrentDownloads,this.uploadsPerFrame=o.uploadsPerFrame,this.highResUploadsPerFrame=o.highResUploadsPerFrame}}},73732:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(57369),n=i(86515);const o=class{constructor(e,t){this.textureUsageCounter={},this.model=e,this.sweepList=t;const i=new n.Z((e=>e.id));for(let e of this.sweepList)e.isObservableProxy&&(e=(new s.ZP).copy(e)),i.add(e);this.sweepListMap=i}init(){}dispose(){}activate(e){}deactivate(e){}beforeRender(){}render(){}activateSweep(e){return this.initTextureUsage(e),Promise.resolve(null)}useTexture(e){return this.incrementTextureUsage(e),null}freeTexture(e,t=!1){t?this.setTextureUsage(e,0):this.decrementTextureUsage(e)}initTextureUsage(e){this.textureUsageCounter[e]||(this.textureUsageCounter[e]=0)}setTextureUsage(e,t){this.textureUsageCounter[e]=t}freeUnusedTextures(){for(const e of Object.keys(this.textureUsageCounter))0===this.textureUsageCounter[e]&&this.freeTexture(e)}incrementTextureUsage(e){this.textureUsageCounter[e]++}decrementTextureUsage(e){this.textureUsageCounter[e]>0&&this.textureUsageCounter[e]--}}},60463:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(54122);class n extends s.Y{constructor(){super(...arguments),this.name="sweep-pano-base"}getRenderer(){return this.panoRenderer}}},12371:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(5587),n=i(73732);class o extends n.Z{constructor(e,t){super(e,t),this.sweepLoader=new s.Z(e)}activateSweep(e){super.activateSweep(e);const t=this.sweepListMap.get(e);return this.sweepLoader.load(t).then((e=>e))}useTexture(e){const t=this.sweepLoader.useTexture(e);return t&&super.useTexture(e),t}freeTexture(e,t=!1){super.freeTexture(e,t),0===this.textureUsageCounter[e]&&this.sweepLoader.unload(e)}freeAllTextures(e){this.sweepLoader.unloadAll(e)}}var r=i(22423),a=i(77956),l=i(60463);class c extends l.Z{constructor(){super(...arguments),this.name="sweep-pano"}async init(e,t){const i=(await t.getModule(r.default)).getSignedUrls(),s=(await t.market.waitForData(a.Z)).getSweepList();this.panoRenderer=new o(i,s),t.addComponent(this,this.panoRenderer)}getRenderer(){return this.panoRenderer}}},67868:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var s=i(2212),n=i(27829);const o={sharpTurnDotThreshold:.65,directionWeightFactorStd:.75,directionWeightFactorSharp:.2,positionalWeightFactorStd:.4,positionalWeightFactorSharp:.2,finalWalkingNodeDirectionWeight:5,lookAheadNodes:3};class r{constructor(e=o){this.settings=e}getOrientationsForPath(e,t){const i=[];for(let o=0;o<e.length;o++){const r=new s.Pa4;this.getLookVectorsForPathNode(e,o,t,r);const a=(new s.yGw).lookAt(e[o],r,n.f.UP);i[o]=(new s._fP).setFromRotationMatrix(a)}return i.push(t),i}getLookVectorsForPathNode(e,t,i,n){const o=new s.Pa4,r=new s.Pa4,a=new s.Pa4,l=new s.Pa4,c=e.length;if(t>=c)return!1;let h=1,d=1;const u=new s.Pa4;let p;for(let s=t;s<t+this.settings.lookAheadNodes&&s<c;s++){if(p=e[s],this.getOrientationForPathNode(e,s,i,a),s===t&&o.copy(a),s>t){const e=o.dot(a)<this.settings.sharpTurnDotThreshold;h*=e?this.settings.directionWeightFactorSharp:this.settings.directionWeightFactorStd,d*=e?this.settings.positionalWeightFactorSharp:this.settings.positionalWeightFactorStd}s===c-1&&(h=this.settings.finalWalkingNodeDirectionWeight,d=1),u.copy(a),a.multiplyScalar(h),r.add(a),l.lerp(p,d)}return r.normalize(),n.copy(l),n.add(r),!0}getOrientationForPathNode(e,t,i,s){if(t>=e.length)return!1;if(t===e.length-1)s.copy(n.f.FORWARD).applyQuaternion(i);else{const i=e[t],n=e[t+1];s.copy(n).sub(i)}return s.normalize(),!0}}},96640:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(){super()}}},13453:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.sweepIds=e}}},20949:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var s,n=i(2212),o=i(54122),r=i(77956);class a{constructor(e){this.comparator=e,this.nodes=[]}push(e){return this.nodes.push(e),this.siftdown(0,this.nodes.length-1)}pop(){let e,t;return this.nodes.length&&(e=this.nodes.pop(),e)?(this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this.siftup(0)):t=e,t):null}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){if(this.nodes.length){const t=this.nodes[0];return this.nodes[0]=e,this.siftup(0),t}return null}_pushpop(e,t,i){let s;const n=i||this.defaultCompare;return e.length&&n(e[0],t)<0&&(s=[e[0],t],t=s[0],e[0]=s[1],this._siftup(e,0,n)),t}pushpop(e){return this._pushpop(this.nodes,e,this.comparator)}_heapify(e,t){let i,s,n,o,r,a;const l=Math.floor(e.length/2),c=function(){for(a=[],n=0,r=l;0<=r?n<r:n>r;0<=r?n++:n--)a.push(n);return a}.apply(this).reverse(),h=[];for(s=0,o=c.length;s<o;s++)i=c[s],h.push(this._siftup(e,i,t));return h}heapify(){let e,t,i,s,n,o;const r=Math.floor(this.nodes.length/2),a=function(){for(o=[],i=0,n=r;0<=n?i<n:i>n;0<=n?i++:i--)o.push(i);return o}.apply(this).reverse(),l=[];for(t=0,s=a.length;t<s;t++)e=a[t],l.push(this.siftup(e));return l}updateItem(e){const t=this.nodes.indexOf(e);return-1===t?null:(this.siftdown(0,t),this.siftup(t))}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){const e=new a(this.comparator);return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}insert(e){return this.push(e)}top(){return this.peek()}front(){return this.peek()}has(e){return this.contains(e)}copy(){return this.clone()}nlargest(e){let t,i,s;const n=this.nodes.slice(0,e);if(!n.length)return n;this._heapify(n,this.comparator);const o=this.nodes.slice(e);for(i=0,s=o.length;i<s;i++)t=o[i],this._pushpop(n,t,this.comparator);return n.sort(this.comparator).reverse()}defaultCompare(e,t){return e<t?-1:e>t?1:0}_siftdown(e,t,i,s){let n,o;const r=s||this.defaultCompare,a=e[i];for(;i>t&&(o=i-1>>1,n=e[o],r(a,n)<0);)e[i]=n,i=o;return e[i]=a}siftdown(e,t){return this._siftdown(this.nodes,e,t,this.comparator)}_siftup(e,t,i){let s,n;const o=i||this.defaultCompare,r=e.length,a=t,l=e[t];for(s=2*t+1;s<r;)n=s+1,n<r&&!(o(e[s],e[n])<0)&&(s=n),e[t]=e[s],s=2*(t=s)+1;return e[t]=l,this._siftdown(e,a,t,o)}siftup(e){return this._siftup(this.nodes,e,this.comparator)}}function l(e,t){for(const i of t)if(i===e)return!0;return!1}function c(e){if(void 0!==e.parent){const t=c(e.parent);return t.push(e.data),t}return[e.data]}function h(e){return e.toString()}function d(e,t){if(e.f&&t.f)return e.f-t.f;throw new Error('heapComparator() -> Property "f" is undefined.')}!function(e){e[e.Success=0]="Success",e[e.NoPath=1]="NoPath",e[e.Timeout=2]="Timeout"}(s||(s={}));const u=Object.freeze({sweeps:{maxNeighborDistance:50}});var p=i(13453),m=i(96640);class g extends o.Y{constructor(){super(...arguments),this.name="sweep-path"}async init(e,t){this.engine=t,this.sweepData=await t.market.waitForData(r.Z),this.validNeighbors={},this.maxNeighborDistance=e.maxNeighborDistance||u.sweeps.maxNeighborDistance,this.buildDistanceMap()}setRestrictedSweeps(e,t=0){if(this.restrictedSweeps=[],e){for(let i=t;i<e.length;i++)this.restrictedSweeps.push(e[i].id);this.engine.broadcast(new p.Z(this.restrictedSweeps))}else this.restrictedSweeps=void 0,this.engine.broadcast(new m.Z)}findShortestPath(e,t,i,n,o,r,u=5e3){const p=this.sweepData.getSweep(e),m=this.sweepData.getSweep(t),g=(e=>{void 0===e.timeout&&(e.timeout=1/0);const t=e.hash||h,i={data:e.start,g:0,h:e.heuristic(e.start)};let n=i;i.f=i.h;const o=[],r=new a(d),u={};r.push(i),u[t(i.data)]=i;const p=Date.now();for(;r.size();){if(Date.now()-p>e.timeout)return{status:s.Timeout,cost:n.g,path:c(n)};const i=r.pop();if(delete u[t(i.data)],i&&e.isEnd(i.data))return{status:s.Success,cost:i.g,path:c(i)};l(m=t(i.data),g=o)||g.push(m);const a=e.neighbor(i.data);for(const s of a){if(l(t(s),o))continue;const a=i.g+e.distance(i.data,s);let c=u[t(s)],h=!1;if(void 0===c)c={data:s,g:0,h:0,f:0},u[t(s)]=c;else{if(c.g<a)continue;h=!0}c.parent=i||void 0,c.g=a,c.h=e.heuristic(s),c.f=a+c.h,c.h<n.h&&(n=c),h?r.heapify():r.push(c)}}var m,g;return{status:s.NoPath,cost:n.g,path:c(n)}})({start:p,isEnd:e=>e===m,neighbor:e=>this.getValidNeighbors(e.id,r),distance:(e,t)=>this.getDistance(e.id,t.id),heuristic:(e,t)=>1,hash:e=>e.id,timeout:u});return g.status===s.Success&&g.path.length<o?(this.addSweepsNearPath(g.path,i),this.filterCloseSweepsFromPath(g.path,n)):null}addSweepsNearPath(e,t){const i=new n.Pa4,s=new n.Pa4,o=new n.Pa4,r=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=[],h=new n.Pa4,d=(e,t,i)=>(o.copy(t).sub(e),o.dot(i)),u=(e,t)=>d(h,e.position,i)-d(h,t.position,i);let p=0;for(;p<e.length-1;){const n=e[p].id,d=e[p+1].id,m=this.sweepData.getSweep(n),g=this.sweepData.getSweep(d);h.copy(m.position),c.length=0,i.copy(g.position).sub(h).normalize();const f=this.findConnectedSweeps(m,this.maxNeighborDistance),v=this.findConnectedSweeps(g,this.maxNeighborDistance),y=f.concat(v);for(const e of y){const n=o.copy(e.position).sub(h).dot(i);n>0&&(a.copy(i),a.multiplyScalar(n),r.copy(o),r.sub(a),r.length()<t&&(s.copy(i).negate(),l.copy(e.position).sub(g.position),l.dot(s)>0&&c.push(e)))}if(c.length>0){c.sort(u);for(let t=e.length+c.length-1;t>=p+c.length;t--)e[t]=e[t-c.length];for(let t=0;t<c.length;t++)e[t+p+1]=c[t]}p+=c.length+1}}findConnectedSweeps(e,t,i=2){const s=[];return this._findConnectedSweeps(e,e,t,s,{},i,0),s}_findConnectedSweeps(e,t,i,s,n,o,r){const a=this.getValidNeighbors(e.id);for(const e of a)n[e.id]||e.position.distanceTo(t.position)<i&&(s.push(e),n[e.id]=!0,r<o&&this._findConnectedSweeps(e,t,i,s,n,o,r+1))}getValidNeighbors(e,t){let i=this.validNeighbors[e];if(!i){i=[],this.validNeighbors[e]=i;const s=this.sweepData.getSweep(e),n=s.neighbours;for(const o of n){const n=this.sweepData.getSweep(o),r=this.getDistance(e,o);if(!n.enabled)continue;if(r>this.maxNeighborDistance)continue;let a=!0;if(t){const e=n.position.clone().sub(s.position).normalize();a=0===t(s.position,e,r).length}a&&i.push(n)}}return i}filterCloseSweepsFromPath(e,t){const i=[];let s=null,n=!1;for(const o of e)n=s&&o.position.distanceTo(s.position)<t||!1,s&&n||(i.push(o),s=o);return i.length<2?e:(n&&e.length>1&&(i[i.length-1]=e[e.length-1]),i)}getCurveForPath(e){let t=0;const i=[0];for(let s=1;s<e.length;s++)t+=e[s-1].distanceTo(e[s]),i.push(t);const s=[0];for(let n=1;n<e.length;n++)s.push(i[n]/t);const o=new n.YT8(e,!1);return{curve:new n.YT8(o.getSpacedPoints(2*t).concat(e[e.length-1])),totalLength:t,sourceDistances:i,normalSourceDistances:s}}buildDistanceMap(){const e={},t=new n.Pa4(0,0,0);this.sweepData.iterate((i=>{const s={},n=i.neighbours;for(const e of n){const n=this.sweepData.getSweep(e);t.copy(i.position).sub(n.position);let o,r=Math.max(0,Math.abs(t.y)-.2),a=Math.sqrt(t.x*t.x+t.z*t.z);r>0?(r=Math.pow(4*r,2),a=Math.pow(a,2),o=Math.sqrt(r*r+a*a)):o=t.length(),s[n.id]=o}e[i.id]=s})),this.distanceMap=e}getDistance(e,t){return this.distanceMap[e][t]}}},54922:(e,t,i)=>{"use strict";i.d(t,{m1:()=>g,Vp:()=>v});var s=i(2212),n=i(97508),o=i.n(n),r=i(68458),a=i.n(r);class l extends s.FIo{constructor(e,t){const i=s.rDY.clone(l.uniforms);i.tMask.value=e,i.tPinHole.value=t,super({vertexShader:o(),fragmentShader:a(),uniforms:i,name:"PinMaterial",transparent:!0})}}l.uniforms={tMask:{type:"t",value:null},tPinHole:{type:"t",value:null},pinColor:{type:"c",value:new s.Ilk},opacity:{type:"f",value:1}};var c=i(60778),h=i(97620),d=i(20599),u=i(61956),p=i(83974),m=i(48072);class g extends s.Kj0{}let f;class v extends p.E{constructor(e,t,i,s){const n=new l(f||(f=(0,c.p)(m),f),t);super(v.geometry,n),this.layers.mask=s.mask,this.name="PinMesh",this.cameraData=i,this._collider=new g(v.colliderGeometry,v.colliderMaterial),this._collider.material.visible=!1,this.add(this._collider),this.opacityProgress=0,this.shouldHide=!0,this.uniforms=n.uniforms,this.unhover(),this.selected=0,this.visible=!1,this.position.copy(e),this.renderOrder=d.z.pins360}updatePosition(e){this.position.copy(e)}get collider(){return this._collider}render(e){this.quaternion.copy(this.cameraData.pose.rotation),null===this.uniforms.tPinHole.value?this.opacityProgress=0:!this.shouldHide&&this.opacityProgress<1?this.opacityProgress+=e/v.FADE_DURATION:this.shouldHide&&this.opacityProgress>0&&(this.opacityProgress-=e/v.FADE_DURATION),this.opacityProgress=(0,h.uZ)(this.opacityProgress,0,1),this.uniforms.opacity.value=this.opacityProgress,this.visible=0!==this.opacityProgress}activate(){this.shouldHide=!1}deactivate(){this.shouldHide=!0}dispose(){this.collider.geometry.dispose(),this.collider.material.dispose()}setPinHover(e,t=!0,i=!0){const s=Math.min(Math.max(e,0),1);this.selected!==s&&(i&&this.uniforms.pinColor.value.copy(u.I.WHITE).lerp(u.I.MP_BRAND,s),t&&s>0&&s<=1&&(this.material.depthTest=!1),0===s&&(this.material.depthTest=!0),this.selected=s)}unhover(){this.uniforms.pinColor.value.copy(u.I.WHITE)}}v.FADE_DURATION=500,v.geometry=new s.BKK(1.5,1.5),v.colliderGeometry=new s.Aip(1.5*.65),v.colliderMaterial=new s.vBJ({transparent:!0,opacity:.5,depthWrite:!1,color:16724312})},179:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="PIN_UNSELECT",this.payload={id:e}}}},29821:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var s=i(54122),n=i(2212),o=i(54922),r=i(6667),a=i(91542),l=i(57369),c=i(87131),h=i(17321),d=i(73706),u=i(25799),p=i(85995),m=i(75712);const g=new u.Z("pin-mesh");class f{constructor(e,t,i,s,o,a){this.sweepViewData=e,this.scene=t,this.sweepTextureLoader=i,this.input=s,this.layer=a,this.container=new n.Tme,this.bindings=[],this.visibilityFilter=()=>!0,this.updatePlacementType=(e,t)=>{this.dataToMeshMap[e.id]||e.placementType!==l.hU.MANUAL?this.dataToMeshMap[e.id]&&e.placementType!==l.hU.MANUAL&&(this.removePinMesh(e),this.engine.broadcast(new r.h(e.id,t,!1))):(this.createPinMesh(e,this.cameraData),this.engine.broadcast(new r.h(e.id,t,!0)))},this.onSweepPlacedMessage=e=>{this.highlightPin(e.sweepId,!0)},this.hoverSweep=(e,t)=>{this.issueCommand(new p.kR(e,t,0));const i=this.sweepViewData.selectedSweep===e;this.highlightPin(e,t||i)},this.meshes=[],this.meshToDataMap={},this.dataToMeshMap={},this.cameraData=o,e.iterate((t=>{t.alignmentType!==l.z9.ALIGNED&&(t.placementType===l.hU.MANUAL&&this.createPinMesh(t,o),this.bindings.push(t.onChanged((()=>{const i=e.getIndexByAlignment(!1,t.id);this.updatePlacementType(t,i),h.H7(t)&&this.updatePinMeshPosition(t.id,t.position)}))))}))}updatePinMeshPosition(e,t){this.mapSweepToMesh(e).updatePosition(t)}mapSweepToMesh(e){return this.dataToMeshMap[e]}mapColliderToSweep(e){const t=e.hasOwnProperty("collider")?e:e.parent;if(t){const e=this.meshToDataMap[t.id];if(e)return e.sweep}return null}filter(e){this.visibilityFilter=e;for(const e of this.meshes)this.filterMesh(e)}init(){}dispose(){for(const e in this.meshToDataMap){const t=this.meshToDataMap[e];this.removePinMesh(t.sweep)}}render(e){for(const t of this.meshes)t.render(e)}activate(e){this.engine=e,this.issueCommand=e.commandBinder.issueCommand.bind(e.commandBinder),this.bindings.push(this.input.registerMeshHandler(d.z,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!0)))),this.bindings.push(this.input.registerMeshHandler(d.A,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!1)))),this.bindings.push(e.subscribe(a.om,this.onSweepPlacedMessage)),this.scene.add(this.container)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}getMeshes(){return this.meshToDataMap}highlightPin(e,t){this.dataToMeshMap[e]&&this.dataToMeshMap[e].setPinHover(t?1:0,!1)}lockSelection(e,t){return t&&(this.engine.broadcast(new r.c(e.id,!0)),this.hoverSweep(e.id,!0)),!0}createPinMesh(e,t){const i=new o.Vp(e.position,null,t,this.layer);this.meshes.push(i),this.dataToMeshMap[e.id]=i,this.meshToDataMap[i.id]={id:i.id,sweep:e},this.container.add(i),this.filterMesh(i),this.sweepTextureLoader.loadFace(e,c.SL.BASE,1,{flipY:!0}).then((e=>{i.material.uniforms.tPinHole.value=e})).catch((t=>{g.error(`${e.id} failed to load texture: ${t}`)}))}removePinMesh(e){const t=this.dataToMeshMap[e.id],i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.id],t.dispose()}filterMesh(e){const t=this.meshToDataMap[e.id];if(t){const i=t.sweep;this.visibilityFilter(i)?this.activateMesh(e):this.deactivateMesh(e)}}onHoverEvent(e,t){const i=this.mapColliderToSweep(e);i&&this.hoverSweep(i.id,t)}activateMesh(e){this.input.registerMesh(e.collider,!1),e.activate()}deactivateMesh(e){this.input.unregisterMesh(e.collider);const t=this.meshToDataMap[e.id];t&&(this.hoverSweep(t.sweep.id,!1),e.deactivate())}}f.MENU_CLEAR_DEBOUNCE=100;var v=i(50101),y=i(30963),b=i(5587),w=i(179),S=i(53944),T=i(22423),E=i(89155),_=i(12775),x=i(39936),M=i(71208),P=i(22729),A=i(69275),O=i(2048),D=i(41479),I=i(42885);class C extends s.Y{constructor(){super(...arguments),this.name="sweep-pin-mesh",this.onChange=()=>{const e=this.sweepViewData,t=e.selectedSweep,i=e.toolState===O._.ROTATING||e.toolState===O._.ROTATED;this.pinRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(I.s,!0))return!1;if(i&&t===e.id)return!1;if(this.viewmodeData.transition.active&&this.viewmodeData.transition.to===M.Ey.Panorama)return!1;const s=this.floorsViewData.isCurrentOrAllFloors(e.floorId),n=this.viewmodeData.closestMode===M.Ey.Dollhouse||this.viewmodeData.closestMode===M.Ey.Floorplan;return s&&n}))},this.onSelectedPinChange=()=>{const e=this.sweepViewData.selectedSweep;e&&(this.engine.commandBinder.issueCommand(new p.iF(e,!0,0)),this.pinRenderer.highlightPin(e,!0))}}async init(e,t){[this.model,this.webglRenderer,this.input,this.sweepViewData,this.cameraData,this.settingsData,this.viewmodeData,this.floorsViewData]=await Promise.all([t.getModule(T.default),t.getModule(v.default),t.getModule(y.default),t.market.waitForData(A.D),t.market.waitForData(E.M_),t.market.waitForData(x.e),t.market.waitForData(_.O),t.market.waitForData(P.c)]);const i=t.claimRenderLayer(this.name),s=this.webglRenderer.getScene().scene;this.engine=t;const n=new b.Z(this.model.getSignedUrls());this.pinRenderer=new f(this.sweepViewData,s,n,this.input,this.cameraData,i),t.addComponent(this,this.pinRenderer),this.bindings.push(this.settingsData.onPropertyChanged(I.s,this.onChange),this.viewmodeData.onChanged(this.onChange),this.sweepViewData.onSelectedSweepChanged(this.onSelectedPinChange),t.subscribe(D.P,this.onChange),t.subscribe(S.WY,this.onChange),t.subscribe(S._G,this.onChange),t.commandBinder.addBinding(w.O,(async e=>{this.pinRenderer.highlightPin(e.id,!1)}))),this.onChange()}mapColliderToSweep(e){return this.pinRenderer.mapColliderToSweep(e)}selectPinMesh(e,t){return this.pinRenderer.lockSelection(e,t)}highlightPinMesh(e,t){this.pinRenderer.highlightPin(e,t)}mapSweepToMesh(e){return this.pinRenderer.mapSweepToMesh(e)}updatePosition(e,t){this.pinRenderer.updatePinMeshPosition(e,t)}}},6667:(e,t,i)=>{"use strict";i.d(t,{c:()=>n,h:()=>o});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.sweepId=e,this.selected=t}}class o extends s.v{constructor(e,t,i){super(),this.sweepId=e,this.pinIndex=t,this.placed=i}}},42885:(e,t,i)=>{"use strict";i.d(t,{s:()=>s});const s="features/360_views"},16031:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var s=i(54122),n=i(29821),o=i(54922),r=i(76258),a=i(7065),l=i(71208),c=i(47924),h=i(71144),d=i(12775),u=i(2212),p=i(30963),m=i(75158),g=i(73706),f=i(75712);class v extends s.Y{constructor(){super(...arguments),this.name="sweep-pin-navigation"}async init(e,t){const[i,s,v,y]=await Promise.all([t.getModule(n.default),t.getModule(h.default),t.market.waitForData(d.O),t.getModule(p.default)]),b=new u._fP;this.bindings.push(y.registerMeshHandler(m.R,f.s.isType(o.m1),((e,t,n)=>{const o=i.mapColliderToSweep(t);return!(!o||v.transition.active||(b.set(0,0,0,1).multiply(o.rotation),r=o.id,a=b,v.currentMode&&v.currentMode!==l.Ey.Panorama&&s.switchToMode(l.Ey.Panorama,c.n.FadeToBlack,{sweepID:r,rotation:a}),0));var r,a})),y.registerMeshHandler(g.z,f.s.isType(o.m1),((e,s)=>{i.mapColliderToSweep(s)&&t.commandBinder.issueCommand(new r.u(a.C.FINGER))})),y.registerMeshHandler(g.A,f.s.isType(o.m1),((e,s)=>{i.mapColliderToSweep(s)&&t.commandBinder.issueCommand(new r.u(null))})))}}},67906:(e,t,i)=>{"use strict";i.d(t,{p:()=>p,Y:()=>c});var s=i(2212),n=i(7206),o=i.n(n),r=i(34382),a=i.n(r);class l extends s.FIo{constructor(e,t){const i=s.rDY.clone(l.uniforms);i.tNoHover.value=e,i.tHover.value=t,i.tPortal.value=null,super({vertexShader:o(),fragmentShader:a(),uniforms:i,name:"PortalMaterial",transparent:!0})}}l.uniforms={tNoHover:{type:"t",value:null},tHover:{type:"t",value:null},tPortal:{type:"t",vlaue:null},progress:{type:"f",value:1},opacity:{type:"f",value:1}};var c,h=i(38429),d=i(97620),u=i(20599);!function(e){e[e.HIDE=0]="HIDE",e[e.SHOW=1]="SHOW",e[e.ONTOP=2]="ONTOP"}(c||(c={}));class p extends s.Kj0{constructor(e,t){const i=new l(h.P.get().toInteriorTexture,h.P.get().toInteriorHoverTexture);super(p.geometry,i),this.layers.mask=t.mask,this.uniforms=i.uniforms,this.renderOrder=u.z.portals,this.setState(c.HIDE),this.update(e)}update(e){const t=e.lookDirection.clone().add(e.position);this.position.copy(e.position),this.lookAt(t),this.hoverProgress=0,this.hovered=!1,e.toExterior?(this.uniforms.tNoHover.value=h.P.get().toExteriorTexture,this.uniforms.tHover.value=h.P.get().toExteriorHoverTexture):(this.uniforms.tNoHover.value=h.P.get().toInteriorTexture,this.uniforms.tHover.value=h.P.get().toInteriorHoverTexture)}resetMesh(e=0,t=!1,i=!1){this.uniforms.opacity.value=e,this.material.depthTest=t,this.material.depthWrite=i}setHover(e){this.hovered=e}setState(e){switch(e){case c.HIDE:this.resetMesh(0,!0,!0);break;case c.SHOW:this.resetMesh(1,!0,!0);break;case c.ONTOP:this.resetMesh(1)}}render(e){this.hovered&&this.hoverProgress<1?this.hoverProgress+=e/300:!this.hovered&&this.hoverProgress>0&&(this.hoverProgress-=e/300),this.hoverProgress=(0,d.uZ)(this.hoverProgress,0,1),this.uniforms.progress.value=this.hoverProgress}updatePortalTexture(e){this.uniforms.tPortal.value=e}}p.geometry=new s._12(.3,.3)},75252:(e,t,i)=>{"use strict";i.d(t,{K$:()=>h,Sk:()=>d});var s=i(93528),n=i(67906),o=i(2212),r=i(99774),a=i(73706),l=i(75158),c=i(75712);class h extends s.v{constructor(e){super(),this.toSweep=e.toSweep,this.toExterior=e.toExterior,this.fromInterior=e.fromInterior,this.meshPosition=e.position}}class d{constructor(e,t,i,s){this.container=new o.Tme,this.bindings=[],this.visibilityFilter=e=>n.Y.HIDE,this.scene=e,this.input=t,this.layer=s,this.viewportLoader=i,this.meshes=[],this.activeMeshes={},this.meshToDataMap={},this.dataToMeshMap={},this.activeTexturePromises={},this.meshPool=new r.L}addPortal(e){let t;const i=this.meshPool.get();i?(t=i.object,t.update(e)):t=this.meshPool.add(new n.p(e,this.layer)).object,this.meshes.push(t),this.container.add(t),this.meshToDataMap[t.id]=e,this.dataToMeshMap[e.index]=t,this.activateMesh(t,this.visibilityFilter(e))}removePortal(e){const t=this.dataToMeshMap[e.index];if(t){this.meshPool.free(t);const i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.index]}}init(){}activate(e){this.broadcast=e.broadcast.bind(e),this.bindings.push(this.input.registerMeshHandler(a.z,c.s.isType(n.p),((e,t)=>{this.onPuckSelect(t)}))),this.bindings.push(this.input.registerMeshHandler(a.A,c.s.isType(n.p),((e,t)=>{this.onPuckDeselect(t)}))),this.bindings.push(this.input.registerMeshHandler(l.R,c.s.isType(n.p),((e,t)=>{this.onPuckClick(t)}))),this.scene.add(this.container)}dispose(){for(const e of Object.keys(this.meshToDataMap)){const t=this.meshToDataMap[e],i=this.dataToMeshMap[t.index];this.removePortal(t),i.material.dispose(),i.geometry.dispose()}}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}render(e){for(const t of this.meshes)t.render(e)}filter(e){this.visibilityFilter=e;for(const t of this.meshes){const i=e(this.meshToDataMap[t.id]);i===n.Y.HIDE?this.deactivateMesh(t):this.activateMesh(t,i)}}mapSweepToMesh(e){for(const t in this.meshToDataMap){const i=this.meshToDataMap[t];if(i.toSweep.id===e&&i.toExterior&&i.fromInterior)return this.dataToMeshMap[i.index]}return null}activateMesh(e,t=0){this.activeMeshes[e.id]||(this.input.registerMesh(e,!1),this.activeMeshes[e.id]=!0),e.setState(t)}deactivateMesh(e){this.input.unregisterMesh(e),this.activeMeshes[e.id]=!1,this.onPuckDeselect(e),e.setState(n.Y.HIDE)}onPuckClick(e){this.broadcast(new h(this.meshToDataMap[e.id]))}onPuckSelect(e){const t=this.meshToDataMap[e.id].toSweep,i=this.viewportLoader.getPortalTexture(t,t.rotation,e.position);this.activeTexturePromises[e.id]=i,i.then((t=>{this.activeTexturePromises.hasOwnProperty(e.id)&&i===this.activeTexturePromises[e.id]&&(e.updatePortalTexture(t),e.setHover(!0))}))}onPuckDeselect(e){e.setHover(!1),this.viewportLoader.releasePortalTexture(this.meshToDataMap[e.id].toSweep.id),delete this.activeTexturePromises[e.id]}}},38429:(e,t,i)=>{"use strict";i.d(t,{P:()=>c});var s=i(60778),n=i(68444),o=i(85089),r=i(45545),a=i(64293);let l;const c={get:()=>l||(l={toExteriorTexture:(0,s.p)(n),toExteriorHoverTexture:(0,s.p)(o),toInteriorTexture:(0,s.p)(r),toInteriorHoverTexture:(0,s.p)(a)},l)}},17476:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>O});var s=i(54122),n=i(87131),o=i(2212),r=i(41693),a=i.n(r),l=i(1858),c=i.n(l);class h extends o.FIo{constructor(){const e=o.rDY.clone(h.uniforms);super({vertexShader:a(),fragmentShader:c(),uniforms:e,name:"PortalViewportMaterial",side:o._Li})}updateTexture(e){this.uniforms.tMap.value=e}}h.uniforms={tMap:{type:"t",value:null}};class d{constructor(e,t,i,s){this.tempLookDirection=new o.Pa4,this.worldCamera=s,this.camera=new o.V1s,this.renderSize=i,this.sweepTextureLoader=e,this.textureRenderer=t,this.renderTargets={},this.renderCube=new o.Kj0(new o.DvJ(4,4,4),new h)}async getPortalTexture(e,t,i){const s=this.renderTargets[e.id]||this.textureRenderer.createRenderTarget2D(this.renderSize,this.renderSize),o=await this.sweepTextureLoader.load(e,n.SL.BASE);return this.renderCube.material.updateTexture(o),this.renderCube.quaternion.copy(t),this.camera.projectionMatrix.copy(this.worldCamera.projectionMatrix),this.worldCamera.getWorldPosition(this.tempLookDirection),this.camera.lookAt(this.tempLookDirection.sub(i).negate()),this.textureRenderer.render(s,this.renderCube,this.camera),s.texture}releasePortalTexture(e){const t=this.renderTargets[e];t&&this.textureRenderer.disposeRenderTarget2D(t)}}var u=i(75252),p=i(21265);const m=(0,p.hu)("geond",15),g=(0,p.hu)("geowo",.1);var f=i(22423),v=i(62513),y=i(24975),b=i(30963),w=i(73354),S=i(50101),T=i(67940),E=i(77956),_=i(57369),x=i(5587),M=i(17321),P=i(81733);const A=new(i(25799).Z)("sweep-portal-mesh");class O extends s.Y{constructor(){super(...arguments),this.name="sweep-portal-mesh",this.portalCount=0}async init(e,t){const[i,s,n,o,r,a]=await Promise.all([t.getModule(f.default),t.getModule(v.default),t.getModule(b.default),t.getModule(w.default),t.getModule(S.default),t.market.waitForData(E.Z),t.getModule(T.default)]),l=t.claimRenderLayer(this.name);this.portalData={};const c=r.getScene().camera,h=new x.Z(i.getSignedUrls());this.raycaster=s;const p=new d(h,o,256,c),m=r.getScene().scene;this.portalRenderer=new u.Sk(m,n,p,l);const g=_.hU.MANUAL,y=a.filter((e=>M.H7(e)));a.iterate((e=>{this.portalData[e.id]||(this.portalData[e.id]=[]),M.H7(e)&&this.addPortals(e,this.portalRenderer,a,y);let t=e.placementType;this.bindings.push(e.onPropertyChanged("placementType",(i=>{t!==g&&i===g&&this.addPortals(e,this.portalRenderer,a,y),t===g&&i!==g&&this.removePortals(e.id,this.portalRenderer),t=i}))),this.bindings.push(e.onChanged((()=>{M.H7(e)&&(this.removePortals(e.id,this.portalRenderer),this.addPortals(e,this.portalRenderer,a,y))})))})),t.addComponent(this,this.portalRenderer)}filter(e){this.portalRenderer.filter(e)}getPortalToExterior(e){return this.portalRenderer.mapSweepToMesh(e)}removePortals(e,t){for(const i of this.portalData[e])t.removePortal(i);this.portalData[e]=[]}addPortals(e,t,i,s){const n=this.nearestAlignedSweep(e,i);if(n){const i=this.entryLinks(e,n),o=this.neighborLinks(e,s);this.portalData[e.id]=i.concat(o);for(const i of this.portalData[e.id])t.addPortal(i)}else A.debug(`Couldn't find the nearest sweep for a 360 on floor ${e.floorId}; not adding portals`)}nearestAlignedSweep(e,t){const i=[M.ff(e),M._k(),M._T(),M.b1(e)],s=[P.TE(e.position)],n=t.sortByScore(i,s)[0];return n?n.sweep:null}modelIntersection(e,t){const i=(new o.Pa4).copy(e.position).sub(t.position).setY(0).normalize();return{intersect:this.raycaster.picking.pick(t.position,i,y.T0),rayDirection:i}}entryLinks(e,t){const i=[],s=this.modelIntersection(e,t);let n=new o.Pa4,r=new o.Pa4;return s.intersect&&s.intersect.face?(n=s.intersect.face.normal.clone().setY(0).normalize(),r=s.intersect.point.clone().addScaledVector(n,g).setY(t.position.y)):(n=s.rayDirection.clone().negate(),r=t.position.clone().addScaledVector(s.rayDirection,2)),i.push({index:this.portalCount++,toSweep:e,fromSweep:t,position:r,lookDirection:n,toExterior:!0,fromInterior:!0}),i.push({index:this.portalCount++,toSweep:t,fromSweep:e,position:e.position.clone().addScaledVector(n,2).setY(e.position.y),lookDirection:n.clone().negate(),toExterior:!1,fromInterior:!1}),i}neighborLinks(e,t){const i=[];for(const s of t)if(s.floorId===e.floorId&&e.position.distanceTo(s.position)<m){const t=s.position.clone().sub(e.position).setY(0).normalize(),n=e.position.clone().addScaledVector(t,2);t.negate(),i.push({index:this.portalCount++,toSweep:s,fromSweep:e,position:n,lookDirection:t,toExterior:!0,fromInterior:!1})}return i}}},10816:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var s=i(21265),n=i(90709);const o=(0,s.hu)("geodist",(0,n._F)((0,s.hu)("geodistft",20)));var r=i(54122),a=i(17476),l=i(57369),c=i(71208),h=i(47924),d=i(89155),u=i(77956),p=i(71144),m=i(12775),g=i(75252),f=i(67906),v=i(55525),y=i(39936),b=i(42885);class w extends r.Y{constructor(){super(...arguments),this.name="sweep-portal-navigation",this.onChange=()=>{this.portalRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(b.s,!0))return f.Y.HIDE;if(this.viewmodeData.closestMode!==c.Ey.Panorama)return f.Y.HIDE;const t=this.sweepData.getSweep(this.sweepData.currentSweep||"");if(t)if(t.alignmentType===l.z9.ALIGNED){if(e.fromInterior&&e.toExterior&&e.position.distanceTo(t.position)<o)return f.Y.SHOW}else if(t.placementType===l.hU.MANUAL&&e.fromSweep.id===t.id)return f.Y.ONTOP;return f.Y.HIDE}))}}async init(e,t){[this.portalRenderer,this.cameraData,this.viewmodeModule,this.viewmodeData,this.sweepData,this.settingsData]=await Promise.all([t.getModule(a.default),t.market.waitForData(d.M_),t.getModule(p.default),t.market.waitForData(m.O),t.market.waitForData(u.Z),t.market.waitForData(y.e)]);const i=(e,i)=>{this.viewmodeData.currentMode&&this.cameraData.canTransition()&&(this.viewmodeData.currentMode!==c.Ey.Panorama?this.viewmodeModule.switchToMode(c.Ey.Panorama,h.n.FadeToBlack,{sweepID:e,rotation:i}):t.commandBinder.issueCommand(new v.ju({sweep:e,rotation:i,transition:h.n.FadeToBlack})))};this.settingsData.onPropertyChanged(b.s,this.onChange),this.bindings.push(t.subscribe(g.K$,(e=>{i(e.toSweep.id)})),this.viewmodeData.onChanged(this.onChange),this.sweepData.onChanged(this.onChange)),this.onChange()}}},79979:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e,t,i){super(),this.sweepId=e,this.sweepIndex=t,this.totalSweeps=i}}},81660:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.sweepId=e,this.hovered=t}}},74958:(e,t,i)=>{"use strict";i.d(t,{YY:()=>m,C$:()=>g});var s=i(2212),n=i(85995),o=i(73706),r=i(75158),a=i(79979),l=i(2779),c=i(20599),h=i(57369),d=i(98809),u=i(81660);class p extends s.Kj0{}class m extends s.Kj0{}class g{constructor(e,t,i,n,o,r,a,c=new s.Ilk(16724312),h=new s.Ilk(16724312),d=.8,u=.8,p=300,m=.4,g=l.o.ALL){this.scene=e,this.input=t,this.settingsData=i,this.sweepViewData=n,this.puckImagery=o,this.onFloor=r,this.checkRenderModes=a,this.idleColor=c,this.selectionColor=h,this.idleOpacity=d,this.editingOpacity=u,this.selectionDuration=p,this.puckSize=m,this.layer=g,this.sweepToMesh={},this.colliderToSweep={},this.editingEnabled=!1,this.dummyMat=new s.vBJ,this.puckOffset=new s.Pa4(0,.05,0),this.bindings=[],this.wasDrawing=!1,this.renderPuckHighlight=(e,t)=>{if(!this.sweepViewData.isSweepAligned(e))return;const i=this.sweepToMesh[e].material.color;t?i.copy(this.selectionColor):i.copy(this.idleColor)},this.updateLookAt=e=>{this.sweepViewData.iterate((t=>{const i=this.sweepToMesh[t.id];i&&i.visible&&i.lookAt(e)}))}}init(){if(this.puckGeometry=new s.BKK(this.puckSize,this.puckSize),this.onFloor){const e=new s.yGw;e.makeRotationFromEuler(new s.USm(-Math.PI/2,0,0,"XYZ")),this.puckGeometry.applyMatrix4(e)}this.sphereColliderGeometry=new s.Aip(.5*this.puckSize,10,10),this.matParamsEnabled={color:this.idleColor.getHex(),opacity:this.idleOpacity,transparent:!0,depthWrite:!1,map:this.puckImagery.enabled},this.sweepViewData.iterate(this.createPuck.bind(this))}get displayDisabled(){return void 0!==this.puckImagery.disabled}onSweepStateAnimationChanged(e,t,i){const s=i.value,n=e.enabled?this.puckImagery.enabled:this.puckImagery.disabled,o=e.enabled?this.puckImagery.enabledHover:this.puckImagery.disabledHover,r=s>0&&this.editingEnabled,a=e.id===this.sweepViewData.selectedSweep,l=this.editingEnabled&&a?this.selectionColor:this.idleColor,c=this.editingEnabled?this.editingOpacity:this.idleOpacity;t.setValues({map:r?o:n}),t.color.copy(l),t.opacity=c*(1-s)+1*s}createMaterial(e){const t=new s.vBJ(this.matParamsEnabled);return this.puckImagery.disabled&&!e.enabled&&t.setValues({map:this.puckImagery.disabled}),this.bindings.push(e.onPropertyChanged("enabled",(()=>{t.setValues({map:e.enabled?this.puckImagery.enabled:this.puckImagery.disabled})}))),t}createMesh(e,t){const i=new p(this.puckGeometry,t);this.onFloor?i.position.copy(e.floorPosition).add(this.puckOffset):(i.position.copy(e.position),i.rotation.setFromQuaternion(e.rotation)),i.name=e.id,i.updateMatrixWorld(!1),i.renderOrder=c.z.panoMarker;const s=this.sweepViewData.getState(e.id);return i.visible=s.visible,this.bindings.push(s.onPropertyChanged("visible",(e=>{i.visible=e}))),this.bindings.push(s.onPropertyChanged("animation",(i=>this.onSweepStateAnimationChanged(e,t,i)))),i.layers.mask=this.layer.mask,i}createCollider(e,t){let i;return i=this.onFloor?new m(this.puckGeometry,this.dummyMat):new m(this.sphereColliderGeometry,this.dummyMat),i.userData.sid=e.id,i.position.copy(t.position),i.rotation.copy(t.rotation),i.name=e.id,i.updateMatrixWorld(!1),i}createPuck(e){if(e.alignmentType!==h.z9.ALIGNED)return;const t=this.createMaterial(e),i=this.createMesh(e,t),s=this.createCollider(e,i);i.collider=s,this.sweepToMesh[e.id]=i,this.colliderToSweep[s.id]=e.id}toggleEditingEnabled(e){this.editingEnabled=e;for(const t in this.sweepToMesh)this.sweepToMesh[t].material.opacity=e?this.editingOpacity:this.idleOpacity}getSweepId(e){return this.colliderToSweep[e]}updatePuckImagery(e){let t;this.displayDisabled||void 0===e.disabled?this.displayDisabled&&void 0===e.disabled&&(t=!1):t=!0,this.puckImagery=e,this.sweepViewData.iterate((e=>{if(e.alignmentType!==h.z9.ALIGNED)return;const i=this.sweepToMesh[e.id],s=this.sweepViewData.getState(e.id);i.visible=s.visible;let n=this.puckImagery.enabled;if(!e.enabled&&this.puckImagery.disabled&&(n=this.puckImagery.disabled),this.sweepToMesh[e.id].material.setValues({map:n}),void 0!==t){if(e.enabled)return;t?this.addSweepToScene(e.id):this.removeSweepFromScene(e.id)}}))}updateCheckRenderModes(e){this.checkRenderModes=e}removeSweepFromScene(e){const t=this.sweepToMesh[e];this.scene.remove(t),this.input.unregisterMesh(t.collider)}addSweepToScene(e){if(!this.sweepViewData.getSweep(e).enabled&&!this.displayDisabled)return;const t=this.sweepToMesh[e];this.scene.add(t),this.input.registerMesh(t.collider,!0)}render(){const e=this.checkRenderModes(),t=this.settingsData.tryGetProperty(d.U,!0);if(e&&t){if(!this.wasDrawing){for(const e in this.sweepToMesh)this.addSweepToScene(e);this.wasDrawing=!0}}else if(this.wasDrawing){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);this.wasDrawing=!1}}dispose(){for(const e in this.sweepToMesh){const t=this.sweepToMesh[e];t.material.dispose(),t.geometry.dispose()}}activate(e){this.wasDrawing=!1;const t=new f(this.sweepViewData);this.bindings.push(this.input.registerMeshHandler(o.z,t,((t,i)=>{e.commandBinder.issueCommand(new n.kR(this.getSweepId(i.id),!0,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!0))}))),this.bindings.push(this.input.registerMeshHandler(o.A,t,((t,i)=>{e.commandBinder.issueCommand(new n.kR(this.getSweepId(i.id),!1,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!1))}))),this.bindings.push(this.input.registerMeshHandler(r.R,t,((t,i)=>{const s=this.sweepViewData.getSweep(this.colliderToSweep[i.id]).index,n=this.sweepViewData.getAlignedSweeps(!0).length;e.broadcast(new a.Z(this.colliderToSweep[i.id],s,n))})))}deactivate(e){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);for(const e of this.bindings)e.cancel();this.bindings.length=0}}class f{constructor(e){this.sweepViewData=e}compare(e){return e instanceof m&&this.sweepViewData.getSweepVisibility(this.sweepViewData.getSweep(e.userData.sid))}}},83981:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var s=i(60778),n=i(29480);const o=(0,s.p)(n)},80909:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="TOGGLE_PUCK_EDITING",this.payload={enabled:e}}}},82611:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>P});var s=i(54122),n=i(2212),o=i(75712),r=i(12505),a=i(61718),l=i(74958),c=i(79979),h=i(80909),d=i(39869),u=i(40582),p=i(36073),m=i(75158),g=i(50101),f=i(30963),v=i(39936),y=i(89155),b=i(69275),w=i(12775),S=i(71208),T=i(83981),E=i(55525),_=i(75711),x=i(73029);const M={enabled:T.k,enabledHover:T.k};class P extends s.Y{constructor(){super(...arguments),this.name="sweep-pucks",this.IDLE_OPACITY=.3,this.EDITING_OPACITY=.9,this.IDLE_COLOR=new n.Ilk("white"),this.SELECTION_COLOR=new n.Ilk(16724312),this.defaultCheckRenderModes=()=>!0,this.unselectingSweep=null,this.editingEnabled=!1,this.selectionBindings=[],this.unselectionBindings=[],this.selectionHandled=!0,this.unselectionHandled=!0,this.handlePuckClickedMessage=e=>{if(!e)throw new Error("SweepPucks -> on PuckClickedMessage: Tried to move to invalid sweep id.");this.canSelectPuck()||this.sweepViewData.data.canTransition()&&this.cameraData.canTransition()&&this.engine.commandBinder.issueCommand(new E.ju({transition:x.y[this.interactionmodeData.mode],sweep:e}))},this.handleSweepSelectionChange=()=>{this.updateHighlightOnSelectedPuck(!1),this.selectedSweep=this.sweepViewData.selectedSweep,this.updateHighlightOnSelectedPuck(!0),this.updateHandlers()},this.updateViewmode=()=>{this.viewmode=this.viewmodeData.currentMode,this.updateHighlightOnSelectedPuck(this.editingEnabled),this.updateHandlers()},this.updateHandlers=()=>{this.selectionHandled=this.toggleHandlers(this.canSelectPuck(),this.selectionBindings,this.selectionHandled),this.unselectionHandled=this.toggleHandlers(this.canUnselectPuck(),this.unselectionBindings,this.unselectionHandled)},this.unselectPuck=()=>{this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(null)},this.onUnselectPuck=e=>{const t=this.sweepViewData.selectedSweep;return t&&(e.down?this.unselectingSweep=t:this.unselectingSweep&&this.unselectPuck()),!0},this.onPointerOnPuck=(e,t)=>{if(e.button!==u.MP.PRIMARY)return;const i=this.renderer.getSweepId(t.id);i&&(e.down?i===this.selectedSweep?this.unselectingSweep=i:(this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(i)):(i===this.unselectingSweep&&this.unselectPuck(),this.unselectingSweep=null))}}async init(e,t){this.engine=t,void 0!==e.checkRenderModes&&(this.defaultCheckRenderModes=e.checkRenderModes);const i=(await t.getModule(g.default)).getScene(),s=await t.getModule(f.default),[n,d,u,S,T]=await Promise.all([t.market.waitForData(v.e),t.market.waitForData(y.M_),t.market.waitForData(b.D),t.market.waitForData(w.O),t.market.waitForData(_.Z)]);this.viewmodeData=S,this.viewmode=S.currentMode,this.sweepViewData=u,this.cameraData=d,this.interactionmodeData=T,this.renderer=new l.C$(i.scene,s,n,u,M,!0,this.defaultCheckRenderModes,this.IDLE_COLOR,this.SELECTION_COLOR,this.IDLE_OPACITY,this.EDITING_OPACITY,void 0,void 0,t.claimRenderLayer(this.name)),t.addComponent(this,this.renderer),this.bindings.push(t.commandBinder.addBinding(h.s,(async e=>this.togglePuckEditing(e.enabled))),t.subscribe(c.Z,(e=>this.handlePuckClickedMessage(e.sweepId)))),this.selectionBindings.push(s.registerMeshHandler(p.er,o.s.isType(l.YY),this.onPointerOnPuck),s.registerHandler(p.mE,(()=>{this.unselectingSweep=null}))),this.selectionHandled=this.toggleHandlers(!1,this.selectionBindings,this.selectionHandled),this.selectionSub=this.sweepViewData.onSelectedSweepChanged(this.handleSweepSelectionChange),this.selectionSub.cancel(),this.unselectionBindings.push(s.registerPriorityHandler(m.R,a.S,(()=>!0)),s.registerPriorityHandler(p.er,a.S,this.onUnselectPuck),s.registerPriorityHandler(p.er,r.i,this.onUnselectPuck)),this.unselectionHandled=this.toggleHandlers(!1,this.unselectionBindings,this.unselectionHandled)}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.togglePuckEditing(!1),super.dispose(e)}updatePuckImagery(e={}){const t=Object.assign(Object.assign({},M),e);t.disabled&&!t.disabledHover&&(t.disabledHover=t.disabled),this.renderer.updatePuckImagery(t)}updateCheckRenderModes(e){this.renderer.updateCheckRenderModes(e||this.defaultCheckRenderModes)}updateHighlightOnSelectedPuck(e){const t=this.selectedSweep;if(t){if(!this.sweepViewData.isSweepAligned(t))return;const i=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;this.renderer.renderPuckHighlight(t,this.editingEnabled&&i&&e)}}togglePuckEditing(e){this.editingEnabled=e,this.selectedSweep=this.sweepViewData.selectedSweep,this.updateViewmode(),this.renderer.toggleEditingEnabled(e),e?(this.engine.subscribe(d.Z,this.updateViewmode),this.selectionSub.renew()):(this.engine.unsubscribe(d.Z,this.updateViewmode),this.selectionSub.cancel())}canUnselectPuck(){const e=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;return this.editingEnabled&&!!this.selectedSweep&&e}canSelectPuck(){const e=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;return this.editingEnabled&&e}toggleHandlers(e,t,i){if(e!==i)for(const i of t)e?i.renew():i.cancel();return e}}},98809:(e,t,i)=>{"use strict";i.d(t,{U:()=>s});const s="features/sweep_pucks"},69275:(e,t,i)=>{"use strict";i.d(t,{D:()=>u});var s=i(19413),n=i(5442),o=i(57369),r=i(17321),a=i(71229),l=i(78909),c=i(290);class h extends l.T{constructor(){super(...arguments),this.visible=!0,this.animation=new c.z(0)}}var d=i(2048);class u extends s.V{constructor(e){super(),this.data=e,this.name="sweeps-view",this.states=new a.v,this.toolStateObservable=(0,n.Y)(d._.CLOSED),this.defaultSweepVisibilityRule=e=>e.enabled,this.sweepVisibilityRule=this.defaultSweepVisibilityRule,this.selectCurrentSweep=()=>{this.setSelectedSweep(this.data.currentSweep||null)},this.derivedData={},this.selectedSweepObservable=new n.f(null);const t=[d._.MOVING,d._.PLACING,d._.PRESSING,d._.ROTATING];e.makeSweepChangeSubscription((()=>{t.includes(this.toolState)||this.selectCurrentSweep()})),e.iterate((e=>{const t=new h;this.states.set(e.id,t),t.commit()})),this.updateViewData()}updateViewData(){this.data.iterate(((e,t)=>{this.derivedData[e.id]=this.makeViewDataForSweep(e,t)})),this.commit()}updateSweepVisibilityRule(e){this.sweepVisibilityRule=e||this.defaultSweepVisibilityRule}getSweepVisibility(e){return this.sweepVisibilityRule(e)}get selectedSweep(){return this.selectedSweepObservable.value}setSelectedSweep(e){this.selectedSweepObservable.value=e}onSelectedSweepChanged(e){return this.selectedSweepObservable.onChanged(e)}setToolState(e){e===d._.PLACING&&this.selectedSweep&&this.setSelectedSweep(null),this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e,t=!1){const i=this.toolStateObservable.onChanged(e);return t&&i.renew(),i}getSweep(e){return this.data.getSweep(e)}makeViewDataForSweep(e,t){const i=this.derivedData[e.id];return i?(i.floorId=e.floorId,i.position=e.position,i.alignmentType=e.alignmentType,i.placed=e.placementType===o.hU.MANUAL,i.enabled=e.enabled,i.name=e.name,i):{id:e.id,floorId:e.floorId,position:e.position,index:e.index,alignmentType:e.alignmentType,dataIndex:t,placed:e.placementType===o.hU.MANUAL,enabled:e.enabled,name:e.name}}getViewData(e){const t=this.data.getSweep(e),i=this.derivedData[e];return t&&!i&&(this.derivedData[e]=this.makeViewDataForSweep(t,t.index)),this.derivedData[e]}isSweepAligned(e){return this.data.isSweepAligned(e)}iterate(e){this.data.iterate(e)}getState(e){return this.states.get(e)}isVisible(e){return this.states.get(e).visible}setVisible(e,t){const i=this.getState(e);i.visible!==t&&(i.visible=t,i.commit())}updateAnimations(e){for(const t of this.states)t.animation.tick(e)}modifySelectAnimation(e,t,i){const s=this.getState(e).animation,n=1===s.endValue;t!==n&&(n?s.modifyAnimation(s.value,0,i):s.modifyAnimation(0,1,i))}getIndexByAlignment(e,t){return this.getAlignedSweeps(e).findIndex((e=>e.id===t))}getAlignedSweeps(e){const t=Object.values(this.derivedData);return e?t.filter((0,r._T)()):t.filter((0,r.WO)())}}},2048:(e,t,i)=>{"use strict";var s;i.d(t,{_:()=>s}),function(e){e.CLOSED="closed",e.IDLE="idle",e.PRESSING="pressing",e.PLACING="placing",e.MOVING="moving",e.ROTATING="rotating",e.ROTATED="rotated"}(s||(s={}))},73986:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var s=i(54122),n=i(77956),o=i(69275),r=i(85995),a=i(12775),l=i(41479),c=i(22729),h=i(3471),d=i(53339);class u extends s.Y{constructor(){super(...arguments),this.name="sweep-viewdata",this.selectionEnabled=!0,this.nonPanoCurrentPuckVisible=!1,this.sweepMap={},this.sweepIdList=[],this.enableSweepSelection=async e=>{this.selectionEnabled=!0},this.disableSweepSelection=async e=>{this.selectionEnabled=!1},this.toggleCurrentPuck=async e=>{this.nonPanoCurrentPuckVisible=e.visible,this.updateVisibility(this.viewData.data.currentSweep)},this.onSweepSelectCommand=async e=>{this.selectionEnabled&&this.viewData.modifySelectAnimation(e.id,e.selected,e.duration)},this.onSweepHoverCommand=async e=>{this.viewData.modifySelectAnimation(e.id,e.hovered,e.duration)},this.updateVisibility=async e=>{if(this.viewmodeData.isPano()){if(e){const t=this.viewData.getSweep(e).neighbours;this.viewData.iterate((e=>{const i=this.viewData.getSweepVisibility(e)&&-1!==t.indexOf(e.id);this.viewData.setVisible(e.id,i)})),this.viewData.setVisible(e,!1)}}else this.viewData.iterate((e=>{this.viewData.setVisible(e.id,this.floorsViewData.isCurrentOrAllFloors(e.floorId))})),e&&this.viewData.setVisible(e,this.nonPanoCurrentPuckVisible)}}async init(e,t){this.data=await t.market.waitForData(n.Z),this.viewData=t.market.tryGetData(o.D)||new o.D(this.data),t.market.register(this,o.D,this.viewData),this.bindings.push(t.commandBinder.addBinding(r.iF,this.onSweepSelectCommand),t.commandBinder.addBinding(r.kR,this.onSweepHoverCommand),t.commandBinder.addBinding(r.zd,this.enableSweepSelection),t.commandBinder.addBinding(r.ZD,this.disableSweepSelection),t.commandBinder.addBinding(r.e9,this.toggleCurrentPuck),this.data.onChanged((()=>this.viewData.updateViewData())),t.msgBus.subscribe(d.sY,(()=>this.viewData.updateViewData()))),this.viewmodeData=await t.market.waitForData(a.O),this.floorsViewData=await t.market.waitForData(c.c),this.bindings.push(this.data.onPropertyChanged("currentSweep",this.updateVisibility),t.subscribe(l.P,(()=>this.updateVisibility(this.viewData.data.currentSweep))),t.subscribe(h.bS,(()=>this.updateVisibility(this.viewData.data.currentSweep))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateVisibility(this.viewData.data.currentSweep)))),this.updateVisibility(this.viewData.data.currentSweep)}onUpdate(e){this.viewData.updateAnimations(e)}}},85282:(e,t,i)=>{"use strict";i.d(t,{n:()=>l});var s=i(19413),n=i(5442),o=i(90134),r=i(51090),a=i(6999);class l extends s.V{constructor(e,t,i,s){super(),this.data=e,this.attachmentsData=t,this.backgroundTexture=i,this.maskTexture=s,this.name="tags-view-data",this.tagCreation=!1,this.tagSelectedOnly=!1,this.allTagViews=(0,o.C)([]),this.enabledTagViews=(0,o.C)([]),this.openTagViewObservable=(0,n.Y)(null),this.tagToolStateObservable=(0,n.Y)(a.p.CLOSED),this.listIndexObservable=(0,n.Y)(-1),this.updateViewData()}getData(){return this.data}getEnabledTagViews(){return this.enabledTagViews}getAllTagViews(){return this.allTagViews}getTagCount(){return this.data.collection.length}getTagView(e){const t=this.allTagViews.findIndex((t=>t.id===e));return-1!==t?this.allTagViews.get(t):null}getCurrentTagViewByIndex(e){return-1!==e?this.enabledTagViews.get(e):null}updateViewData(){const e=[];this.data.iterate((t=>{const i=this.createTagView(t);e.push(i)})),this.allTagViews.replace(e),this.updateEnabledTagViews()}getFilteredTags(){const e=[];return this.allTagViews.forEach((t=>{t.enabled&&e.push(t)})),e}updateEnabledTagViews(){const e=this.getFilteredTags().sort(((e,t)=>t.created.getTime()-e.created.getTime()));this.enabledTagViews.replace(e)}createTagView(e){return{id:e.sid,created:e.created,modified:e.modified,label:e.label,description:e.description,enabled:e.enabled,color:`#${e.color.getHexString()}`,anchorPosition:e.anchorPosition,floorId:e.floorId,stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,widgetFrame:e.widgetFrame,attachments:this.attachmentsData.getAttachmentsForAsset(e.sid,r.h.MATTERTAG),backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture}}get creatingTag(){return this.tagCreation}setCreatingTag(e){this.tagCreation=e}get selectedPreview(){return this.tagSelectedOnly}setTagsToolState(e){this.tagToolStateObservable.value=e}get tagsToolState(){return this.tagToolStateObservable.value}onTagsToolStateChanged(e){return this.tagToolStateObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenTagView(e,t=!1){e===this.openTagViewObservable.value&&this.tagSelectedOnly!==t?(this.tagSelectedOnly=t,this.openTagViewObservable.setDirty()):(this.tagSelectedOnly=t,this.openTagViewObservable.value=e)}get openTagView(){return this.openTagViewObservable.value}onOpenTagViewChanged(e){return this.openTagViewObservable.onChanged(e)}updateOpenTagView(e){const t=this.openTagView;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenTagView(i)}}}},87493:(e,t,i)=>{"use strict";i.d(t,{bF:()=>o,lt:()=>r,YC:()=>a,X8:()=>l,xb:()=>c,P3:()=>h,mt:()=>d,wZ:()=>u});var s=i(99681),n=i(47924);class o extends s.m{constructor(e){super(),this.payload={opened:e}}}class r extends s.m{constructor(e,t,i,s=-1){super(),this.payload={id:e,listIndex:s,transition:t,attachmentId:i}}}class a extends s.m{constructor(e,t=n.n.Instant){super(),this.payload={id:e,transition:t}}}class l extends s.m{constructor(e){super(),this.payload={id:e}}}class c extends s.m{constructor(){super()}}class h extends s.m{constructor(e,t){super(),this.payload={id:e,visible:t}}}class d extends s.m{constructor(e){super(),this.payload={opened:e}}}class u extends s.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}},6999:(e,t,i)=>{"use strict";var s;i.d(t,{p:()=>s}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.VIEWING="viewing",e.ANNOTATING="annotating",e.EDITING="editing"}(s||(s={}))},95552:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseTagCommand:()=>E.xb,OpenTagCommand:()=>E.lt,PreviewTagCommand:()=>E.X8,SaveTagAppearanceCommand:()=>E.wZ,SelectTagCommand:()=>E.YC,TagDeletedMessage:()=>I,TagsToggleCommand:()=>E.bF,TagsToolState:()=>S.p,TagsViewData:()=>T.n,ToggleTagToolEditorCommand:()=>E.mt,ToggleTagVisibilityCommand:()=>E.P3,default:()=>C});var s=i(54122),n=i(60778),o=i(80517),r=i(89411),a=i(47924),l=i(51090),c=i(28615),h=i(55525),d=i(17707),u=i(90926),p=i(68611),m=i(43770),g=i(43711),f=i(90601),v=i(6201),y=i(71583),b=i(91172),w=i(20983),S=i(6999),T=i(85282),E=i(87493),_=i(36520),x=i(73305),M=i(77956),P=i(39936),A=i(12775);class O extends s.Y{constructor(){super(...arguments),this.name="tags-module",this.activated=!1,this.registered=!1,this.activeBindings=[],this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(b.re,!1),t=!this.in360View();this.pinRenderer.setPinTypeVisible(u.Er.MATTERTAG,t&&e)},this.togglePinAssetEditor=async e=>{e.opened?this.viewData.setTagsToolState(S.p.EDITING):this.viewData.tagsToolState===S.p.EDITING&&this.viewData.setTagsToolState(S.p.VIEWING)},this.onCloseTag=async()=>{this.closeTag()},this.tagsWereChanged=()=>{this.viewData.updateViewData()},this.onOpenTagViewChanged=()=>{const e=this.viewData.openTagView;e&&this.updateTag(e)},this.onDeselectTag=e=>{e.pinType===u.Er.MATTERTAG&&this.closeTag()},this.onPreviewTag=async e=>{const t=this.viewData.getTagView(e.id);t&&this.engine.commandBinder.issueCommand(new p._l(t,u.Er.MATTERTAG))},this.onSelectTag=async e=>{const{viewData:t,engine:i,log:s,pinRenderer:n}=this,{id:o,transition:r}=e,a=t.getTagView(o);if(a){await i.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!1)),n.hideSelectedMesh(),await i.commandBinder.issueCommand(new h.OR({pinPosition:a,transition:r})),n.showSelectedMesh(u.Er.MATTERTAG,a.id),i.broadcast(new m.Q4(a,u.Er.MATTERTAG));const e=t.getEnabledTagViews().values().findIndex((e=>e.id===a.id));t.setListIndex(e),t.setOpenTagView(a,!0)}else s.debug("Cannot select a non-existent tag")},this.onOpenTag=async e=>this.openTag(e.id,e.transition,e.attachmentId,e.listIndex),this.saveTagAppearance=async e=>{const t=this.tagsData,i=this.viewData;if(t.getTag(e.id)){const t=e.properties;if(Object.keys(t)){i.updateOpenTagView(t);const e=i.openTagView;e&&this.engine.broadcast(new m.KR(e,u.Er.MATTERTAG))}}else this.log.debug("Cannot update a non-existent tag")},this.tagsToolToggled=async e=>{e.opened?this.activateTool():this.deactivateTool()}}async init(e,t){const[i,s,a,l,c,h]=await Promise.all([t.getModule(d.default),t.market.waitForData(_.b),t.market.waitForData(w.n),t.market.waitForData(M.Z),t.market.waitForData(P.e),t.market.waitForData(A.O)]);this.pinRenderer=i.pinRenderer,this.attachmentsData=s,this.tagsData=a,this.sweepData=l,this.settingsData=c,this.viewmodeData=h,this.engine=t,this.maskTexture=(0,n.p)(r),this.backgroundTexture=(0,n.p)(o),this.viewData=new T.n(this.tagsData,this.attachmentsData,this.backgroundTexture,this.maskTexture),this.bindings.push(c.onPropertyChanged(b.re,this.updatePerSettings),t.commandBinder.addBinding(E.bF,this.tagsToolToggled),t.commandBinder.addBinding(E.lt,this.onOpenTag),t.commandBinder.addBinding(E.xb,this.onCloseTag),t.commandBinder.addBinding(E.YC,this.onSelectTag),t.commandBinder.addBinding(E.X8,this.onPreviewTag),t.subscribe(m.Fe,this.onDeselectTag),this.tagsData.onChanged(this.tagsWereChanged)),this.createMediaEmbedTempAttachments(),t.market.register(this,T.n,this.viewData),this.updatePerSettings(),this.displayTags()}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(u.Er.MATTERTAG),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}activateTool(){this.activated||(this.viewData.setTagsToolState(S.p.CLOSED),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{openTagView:e}=this.viewData;e&&this.closeTag(!0),this.viewData.setTagsToolState(S.p.CLOSED),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}onUpdate(){}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.viewData.onOpenTagViewChanged(this.onOpenTagViewChanged),e.addBinding(E.wZ,this.saveTagAppearance),e.addBinding(E.mt,this.togglePinAssetEditor)),this.registered=!0}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}async createMediaEmbedTempAttachments(){const e=[];this.tagsData.iterate((t=>{e.push(this.makeViewingAttachment(t))})),Promise.all(e).then((()=>this.viewData.updateViewData()))}async makeViewingAttachment(e){if(e.mediaSrc&&e.mediaType!==c.z.none&&e.mediaType!==c.z.error){const t=e.mediaType;this.engine.commandBinder.issueCommand(new x.iF(e.sid,t,e.mediaSrc))}}closeTag(e=!1){const t=this.viewData,i=t.openTagView;i&&(this.engine.broadcast(new m.A(i.id,u.Er.MATTERTAG)),this.engine.broadcast(new v.Ur)),t.setTagsToolState(S.p.IDLE),t.setOpenTagView(null),e||this.engine.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!1))}displayTags(){this.viewData.getEnabledTagViews().forEach((e=>{this.updateTag(e)}))}updateTag(e){this.pinRenderer.displayPin(e.id,u.Er.MATTERTAG,e,this.backgroundTexture,this.maskTexture)}async openTag(e,t,i,s=-1){const{viewData:n,engine:o,log:r,pinRenderer:c}=this;await o.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!0));const d=n.getTagView(e);if(d){const r=n.openTagView,p=d.id===(null==r?void 0:r.id)&&n.selectedPreview;if(!r||r.id!==e||p){if(o.broadcast(new m.sD(d,u.Er.MATTERTAG,!1)),n.setOpenTagView(d,!1),!p){const e=null!==t?t:a.n.Instant;null!==e&&(c.hideSelectedMesh(),await o.commandBinder.issueCommand(new h.OR({pinPosition:d,transition:e})),c.showSelectedMesh(u.Er.MATTERTAG,d.id))}o.broadcast(new v.ZL(l.h.MATTERTAG))}let g=s;-1===g&&(g=n.getEnabledTagViews().values().findIndex((t=>t.id===e))),n.setListIndex(g),i?await o.commandBinder.issueCommand(new x.ms(e,l.h.MATTERTAG,i)):o.commandBinder.issueCommand(new y.rE)}else r.debug("Cannot open a non-existent tag")}}var D=i(93528);class I extends D.v{constructor(e){super(),this.id=e}}const C=O},21685:(e,t,i)=>{"use strict";i.d(t,{R:()=>s});const s="features/tag-annotations";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]})},27691:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});var s=i(78909);class n extends s.T{constructor(e){super(),e&&Object.assign(this,e)}}},48769:(e,t,i)=>{"use strict";i.d(t,{t:()=>a});var s=i(19413),n=i(5442),o=i(71229),r=i(90601);class a extends s.V{constructor(){super(),this.name="tools-data",this.tools=(0,o.q)(),this.toolsLoadedObservable=(0,n.Y)(!1),this.openAssetObservable=(0,n.Y)(null),this.activeToolOpen=!1,this.activeToolNameObservable=(0,n.Y)(null),this.openModalObservable=(0,n.Y)(null),this.toolAccessObservable=(0,n.Y)(r.X$.SCENE),this.panelLayoutObservable=(0,n.Y)(r.wS.NONE),this.panelCollapsedObservable=(0,n.Y)(!1)}addTools(e){e.forEach((e=>{this.addTool(e)})),this.toolsLoadedObservable.value=!0}iterate(e){for(const t of this.tools)e(t)}get toolsMap(){return this.tools}getTool(e){return this.tools.get(e)}addTool(e){this.tools.set(e.id,e)}removeTool(e){this.tools.delete(e)}removeAllTools(){this.tools=(0,o.q)(),this.toolsLoadedObservable.value=!1}get openAsset(){return this.openAssetObservable.value}setOpenAsset(e){this.openAssetObservable.value=e}onOpenAssetChanged(e){return this.openAssetObservable.onChanged(e)}getActiveTool(){return this.activeToolName?this.getTool(this.activeToolName):null}get activeToolName(){return this.activeToolNameObservable.value}get toolOpen(){return this.activeToolOpen}setActiveTool(e,t=!1){e===this.activeToolNameObservable.value&&this.activeToolOpen!==t?(this.activeToolOpen=t,this.activeToolNameObservable.setDirty()):(this.activeToolOpen=t,this.activeToolNameObservable.value=e)}onToolChanged(e){return this.activeToolNameObservable.onChanged(e)}get openModal(){return this.openModalObservable.value}setOpenModal(e){this.openModalObservable.value=e}onOpenModalChanged(e){return this.openModalObservable.onChanged(e)}onToolsLoadedChanged(e){return this.toolsLoadedObservable.onChanged(e)}get toolsLoaded(){return this.toolsLoadedObservable.value}get toolAccess(){return this.toolAccessObservable.value}setToolAccess(e){this.toolAccessObservable.value=e}onToolAssetAccessChanged(e){return this.toolAccessObservable.onChanged(e)}setToolPanelLayout(e){this.panelLayoutObservable.value=e}get toolPanelLayout(){return this.panelLayoutObservable.value}onToolPanelLayoutChanged(e){return this.panelLayoutObservable.onChanged(e)}onPanelCollapsedChanged(e){return this.panelCollapsedObservable.onChanged(e)}setPanelCollapsed(e){this.panelCollapsedObservable.value=e}get panelCollapsed(){return this.panelCollapsedObservable.value}}},43711:(e,t,i)=>{"use strict";i.d(t,{EI:()=>n,$M:()=>o,zK:()=>r,$K:()=>a,Cc:()=>l,tT:()=>c,Ln:()=>h,Ye:()=>d,MV:()=>u});var s=i(99681);class n extends s.m{}n.id="OPEN_DRAWER";class o extends s.m{}o.id="CLOSE_DRAWER";class r extends s.m{constructor(e){super(),this.payload={collapsed:e}}}r.id="TOOL_PANEL_TOGGLE_COLLAPSE";class a extends s.m{}a.id="OPEN_HIGHLIGHT_REEL";class l extends s.m{constructor(){super(...arguments),this.id="OPEN_HLR_SETTINGS"}}class c extends s.m{constructor(e,t,i){super(),this.payload={tool:e,active:t,open:void 0===i?t:i}}}c.id="TOGGLE_TOOL";class h extends s.m{constructor(e){super(),this.payload={heightPercentAdjustment:e}}}h.id="TOOL_PANEL_ADJUST_CANVAS";class d extends s.m{}d.id="CLOSE_REMOVE_TOOLS";class u extends s.m{constructor(e){super(),this.payload={tools:e}}}u.id="REGISTER_TOOLS"},90601:(e,t,i)=>{"use strict";var s,n,o;i.d(t,{w1:()=>s,wS:()=>n,X$:()=>o}),function(e){e.START_LOCATION="START_LOCATION",e.SCANS_3D="SCANS_3D",e.VIEW_360="VIEW_360",e.PHOTOS="PHOTOS",e.LABELS="LABELS",e.MEASUREMENTS="MEASUREMENTS",e.MATTERTAGS="MATTERTAGS",e.HLR="HLR",e.VR_PATH="VR_PATH",e.SETTINGS_PANEL="SETTINGS_PANEL",e.NOTES="NOTES",e.TAGS="TAGS",e.BLUR="BLUR"}(s||(s={})),function(e){e.NONE="none",e.SIDE_PANEL="side-panel",e.BOTTOM_PANEL="bottom-panel"}(n||(n={})),function(e){e.SCENE="scene",e.TOOL="tool",e.LIST="list"}(o||(o={}))},65213:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseAndRemoveToolsCommand:()=>h.Ye,CloseDrawerCommand:()=>h.$M,OpenDrawerCommand:()=>h.EI,OpenHighlightReelCommand:()=>h.$K,OpenHlrSettingsCommand:()=>h.Cc,PanelCanvasAdjustmentCommand:()=>h.Ln,PanelToggleCollapseCommand:()=>h.zK,RegisterToolsCommand:()=>h.MV,ToggleToolCommand:()=>h.tT,Tool:()=>w.U,ToolAccess:()=>l.X$,ToolAssetClosedMessage:()=>d.Ur,ToolAssetOpenedMessage:()=>d.ZL,ToolPanelLayout:()=>l.wS,ToolToggledMessage:()=>d.Oj,Tools:()=>l.w1,ToolsData:()=>c.t,default:()=>S});var s=i(54122),n=i(13931),o=i(10791),r=i(25799),a=i(29675),l=i(90601),c=i(48769),h=i(43711),d=i(6201),u=i(71583),p=i(82209),m=i(12856),g=i(29677),f=i(88069),v=i(24779),y=i(39936);class b extends s.Y{constructor(){super(...arguments),this.name="tools-module",this.log=new r.Z(this.name),this.heightPercentAdjustment=0,this.activeToolDurationMap={},this.classNameTimeout=0,this.closeAndRemoveTools=async()=>{await this.closeActiveTool(!0),this.toolsData.removeAllTools()},this.onPanelLayoutChanged=()=>{const{toolPanelLayout:e,openModal:t,openAsset:i}=this.toolsData,s=this.mainDiv.classList;switch(window.clearTimeout(this.classNameTimeout),e===l.wS.BOTTOM_PANEL&&!t&&i?this.heightPercentAdjustment=50:this.heightPercentAdjustment=0,this.adjustCanvasForPanel(),e){case l.wS.SIDE_PANEL:s.add("side-panel-layout"),s.remove("bottom-panel-layout");break;case l.wS.BOTTOM_PANEL:if(t!==m.P.ATTACHMENT){s.add("bottom-panel-layout"),s.remove("side-panel-layout");break}case l.wS.NONE:s.contains("side-panel-layout")?this.classNameTimeout=window.setTimeout((()=>{s.remove("side-panel-layout","bottom-panel-layout")}),600):s.remove("side-panel-layout","bottom-panel-layout")}},this.onAssetOpened=e=>{this.toolsData.openAsset||this.toolsData.toolPanelLayout!==l.wS.BOTTOM_PANEL||(this.heightPercentAdjustment=50,this.adjustCanvasForPanel()),this.toolsData.setOpenAsset(e.assetType)},this.onAssetClosed=()=>{this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL&&(this.heightPercentAdjustment=0,this.adjustCanvasForPanel()),this.toolsData.setOpenAsset(null)},this.onToggleModal=async e=>{this.toggleModal(e.modal,e.open)},this.closeModal=async()=>{this.toolsData.openModal&&this.toggleModal(this.toolsData.openModal,!1)},this.onToggleTool=async e=>{const{tool:t,active:i,open:s}=e,n=this.toolsData,{activeToolName:o,openModal:r,toolPanelLayout:a,toolOpen:c}=n;if(!i&&t!==o)return;s&&i?this.mainDiv.classList.add("tool-open"):s||(this.mainDiv.classList.remove("tool-open"),a===l.wS.SIDE_PANEL&&this.closePanel());const h=n.getActiveTool(),u=n.getTool(t);if(i&&t===o)return void(c&&!s?n.setActiveTool(t,!1):s&&u&&u.panel&&a===l.wS.NONE&&this.openPanel());r&&this.toggleModal(r,!1);let p=null;h&&(p=h.analytic,await this.closeActiveTool(!i));let m=p;if(i)if(u){u.panel&&s&&this.openPanel(),m=u.analytic;const{manager:e}=u;await e.activate(s),n.setActiveTool(t,s)}else this.log.error(`Tool not loaded: ${t}`);this.trackToolTime(p,m),this.engine.broadcast(new d.Oj(i,s))},this.handleResize=()=>{const e=this.toolsData.toolPanelLayout;e!==l.wS.SIDE_PANEL&&e!==l.wS.BOTTOM_PANEL||this.updateToolPanelLayout()},this.updateToolPanelLayout=()=>{const e=this.toolsData.toolPanelLayout,t=(0,g.OR)();(t&&e!==l.wS.SIDE_PANEL||!t&&e!==l.wS.BOTTOM_PANEL)&&this.toolsData.setToolPanelLayout(t?l.wS.SIDE_PANEL:l.wS.BOTTOM_PANEL)},this.handlePanelCollapse=async e=>{this.toolsData.setPanelCollapsed(e.collapsed),this.toolsData.toolPanelLayout===l.wS.SIDE_PANEL&&this.adjustCanvasForPanel()},this.handleCanvasAdjustment=async e=>{this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL?this.heightPercentAdjustment=e.heightPercentAdjustment:this.heightPercentAdjustment=0,this.adjustCanvasForPanel()},this.resizeCanvas=async e=>{this.engine.commandBinder.issueCommand(new v.M(e))}}async init(e,t){this.engine=t,this.mainDiv=e.mainDiv,await t.getModule(o.default),this.analytics=await t.getModule(n.default),[this.settingsData,this.appData]=await Promise.all([t.market.waitForData(y.e),t.market.waitForData(a.pu)]),this.toolsData=new c.t,t.market.register(this,c.t,this.toolsData),this.toolsData.setToolPanelLayout(l.wS.NONE),this.bindings.push(t.commandBinder.addBinding(h.tT,this.onToggleTool),t.commandBinder.addBinding(u.Bz,this.onToggleModal),t.commandBinder.addBinding(u.rE,this.closeModal),t.subscribe(d.ZL,this.onAssetOpened),t.subscribe(d.Ur,this.onAssetClosed),this.toolsData.onToolPanelLayoutChanged(this.onPanelLayoutChanged),t.commandBinder.addBinding(h.zK,this.handlePanelCollapse),t.commandBinder.addBinding(h.Ln,this.handleCanvasAdjustment),t.commandBinder.addBinding(h.Ye,this.closeAndRemoveTools),t.commandBinder.addBinding(h.MV,(async({tools:e})=>this.registerTools(...e))))}dispose(e){e.market.unregister(this,c.t),this.closeActiveTool(!0)}registerTools(...e){e.forEach((e=>{e.featureFlag&&this.bindings.push(this.settingsData.onPropertyChanged(e.featureFlag,(()=>this.updateEnabledTools())))})),this.toolsData.addTools(e)}async closeActiveTool(e){const t=this.toolsData,i=t.getActiveTool();if(i){const{manager:s}=i;await s.deactivate(),t.toolOpen&&i.panel&&this.closePanel(),this.closeModal(),e&&t.setActiveTool(null)}}closePanel(){window.removeEventListener("resize",this.handleResize),this.toolsData.setToolPanelLayout(l.wS.NONE),this.resizeCanvas((0,f.hf)(0,0,0))}openPanel(){window.addEventListener("resize",this.handleResize),this.updateToolPanelLayout()}toggleModal(e,t){const i=this.toolsData.openModal;if(t&&i===e||!t&&e!==i)return;const s=e.toLowerCase(),n=this.appData.application===a.Mx.WORKSHOP?"workshop_gui":"showcase_gui";this.analytics.track(n,{gui_action:`open_${s}`,opened:t}),e&&this.analytics.track("modal_shown",{modal:e}),this.toolsData.setOpenModal(t?e:null),t?this.mainDiv.classList.add("modal-open"):this.mainDiv.classList.remove("modal-open"),this.engine.broadcast(new p.nV(e,t)),e===m.P.ATTACHMENT&&this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL&&(t?(this.heightPercentAdjustment=0,this.adjustCanvasForPanel()):window.setTimeout((()=>{this.heightPercentAdjustment=50,this.adjustCanvasForPanel()}),200))}trackToolTime(e,t){if(t&&e!==t&&(this.activeToolDurationMap[t]=Date.now()),e){this.activeToolDurationMap[e]=Date.now()-this.activeToolDurationMap[e];const t={tool:`${e}_session_time`,duration:this.activeToolDurationMap[e]};this.analytics.track("tool_session_time",t)}}adjustCanvasForPanel(){const{toolPanelLayout:e,panelCollapsed:t}=this.toolsData;if(e!==l.wS.SIDE_PANEL||t)if(e===l.wS.BOTTOM_PANEL){const e=Math.floor(window.innerHeight*this.heightPercentAdjustment/100);window.setTimeout((()=>{this.resizeCanvas((0,f.hf)(0,-e,g.O8))}),250)}else this.resizeCanvas((0,f.hf)(0,0,0));else this.resizeCanvas((0,f.hf)(-g.LH,0,g.O8))}updateEnabledTools(){const e=this.toolsData.toolsMap;e.atomic((()=>{for(const t of e)if(t.featureFlag){const e=this.settingsData.tryGetProperty(t.featureFlag,!1);t.enabled!==e&&(t.enabled=e,t.commit())}}))}}var w=i(27691);const S=b},6201:(e,t,i)=>{"use strict";i.d(t,{Oj:()=>n,ZL:()=>o,Ur:()=>r});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.active=e,this.open=t}}class o extends s.v{constructor(e){super(),this.assetType=e}}class r extends s.v{}},19417:(e,t,i)=>{"use strict";i.d(t,{TH:()=>n,vy:()=>o,rU:()=>r,HW:()=>a});var s=i(99681);class n extends s.m{constructor(e,t,i){super(),this.id="TOUR_START",this.payload={index:e,loop:t,steps:i}}}class o extends s.m{constructor(){super(...arguments),this.id="TOUR_STOP"}}class r extends s.m{constructor(e,t=!1){super(),this.id="TOUR_STEP",this.payload={index:e,instant:t}}}class a extends s.m{constructor(e,t=!1){super(),this.id="TOUR_RELATIVE",this.payload={forward:e,instant:t}}}},23549:(e,t,i)=>{"use strict";i.d(t,{z:()=>n,Y:()=>o});var s=i(17617);class n extends s.y{constructor(e="Invalid tour transition"){super(e),this.name="TourTransition"}}class o extends s.y{constructor(e="Cannot start tour"){super(e),this.name="TourStart"}}},65619:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FAST_FORWARD_FACTOR:()=>ne,default:()=>oe});var s=i(28247),n=i(27545),o=i(54122),r=i(71208),a=i(98728),l=i(12775),c=i(47924),h=i(30963),d=i(53339),u=i(36073),p=i(30604),m=i(78626),g=i(22767),f=i(29675),v=i(3471),y=i(39936),b=i(89155),w=i(2212),S=i(97620),T=i(19334),E=i(62431),_=i(21265),x=i(17694),M=i(44228),P=i(62367);class A{constructor(e){this.settingsData=e,this.type=M.Aq.Delay,this.toIndex=-1,this.currentTransitionPromise=null,this.cancelDelay=()=>null}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(this.cancelDelay(),this.currentTransitionPromise=null)}start(){if(this.active)throw Error("Transition already active");const e=(0,P.Ig)(ee.getDelayDuration(this.settingsData));return this.cancelDelay=()=>{e.cancel()},this.currentTransitionPromise=e.promise.then((()=>this.stop())),this}}class O{constructor(e,t,i){this.settingsData=e,this.zoom=t,this.stopZooming=i,this.type=M.Aq.Zoom,this.toIndex=-1,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(){if(this.active)throw Error("Transition already active");const e=ee.getZoomDuration(this.settingsData);return this.currentTransitionPromise=this.zoom(e,-5e-4).then((()=>{this.currentTransitionPromise=null})),this.onStopRequested=async()=>{await this.stopZooming()},this}}var D=i(27829),I=i(45805);class C{constructor(e,t,i){this.settingsData=e,this.rotate=t,this.stopRotating=i,this.type=M.Aq.Burns,this.toIndex=-1,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.getPanDirection=(e,t)=>{let i=M.kw.Right;if(e&&e.metadata.scanId&&e.metadata.cameraQuaternion&&e.metadata.cameraPosition&&t&&t.metadata.scanId&&t.metadata.cameraPosition&&t.metadata.cameraQuaternion){const s=D.f.FORWARD.clone().applyQuaternion(e.metadata.cameraQuaternion),n=t.metadata.cameraPosition,o=e.metadata.cameraPosition;let r=n.clone().sub(o).normalize();r.lengthSq()<I.Z.epsilon&&(r=D.f.FORWARD.clone().applyQuaternion(t.metadata.cameraQuaternion)),s.cross(r).y>0&&(i=M.kw.Left)}return i}}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");if(!e)throw Error("Tour pan requires two snapshots");if(!e.snapshot||!e.nextSnapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:t}=this.build(e.snapshot,e.nextSnapshot,e.panOverrides);return this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}build(e,t,i){const{panDirection:s,panAngle:n}=i,o=ee.getPanValues(this.settingsData,!1,s,n);let r=o.direction;return void 0!==r&&r!==M.kw.Auto||(r=this.getPanDirection(e,t)),this.onStopRequested=async()=>{await this.stopRotating()},{deferred:this.rotate(o.ms,new w.FM8(r*o.radiansPerMs,0))}}}var R=i(1799),L=i(44266);const N=.001,k=(e,t,i,s)=>{const n=Math.min(e.distanceTo(t),5),o=n*(1/s)*1e3;let r=o;const a=i/o;a>N&&(r+=r*((a-N)/N));const l=Math.abs(e.clone().setX(0).setZ(0).distanceTo(t.clone().setX(0).setZ(0))/Math.max(n,1));return l>.1&&(r*=.9+.75*l),r};class F{constructor(e,t,i,s,n,o){this.settingsData=e,this.cameraPose=t,this.moveToSweep=i,this.updateTransitionSpeed=s,this.setRestrictedSweeps=n,this.generators=o,this.toIndex=-1,this.currentGenerator=null,this.currentTransitionPromise=null,this.type=M.Aq.Move}get active(){return null!==this.currentTransitionPromise||null!==this.currentGenerator}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null),this.currentGenerator&&(this.generators.stopGenerator(this.currentGenerator),this.currentGenerator=null)}start(e){if(this.active)throw Error("Transition already active");const{generator:t,deferred:i}=this.build(e.path,e.orientations);return this.generators.startGenerator(t),this.currentGenerator=t,this.currentTransitionPromise=i.nativePromise(),this}build(e,t){const i=new L.Q,n=this;let o=!1;return this.onStopRequested=async()=>{o=!0,await this.updateTransitionSpeed(ne)},{generator:function*(){let r=1;for(;r<e.length&&!o;){const i=r-1,o=e[r],a=o.position,l=e[i],h=t[r],d=(0,S.zW)(n.cameraPose.rotation,h),u=ee.getTransitionSpeed(n.settingsData),p=k(l.position,a,d,u),m={transitionType:c.n.Interpolate,sweepId:o.id,rotation:h,transitionTime:p,easing:R.vG};n.setRestrictedSweeps(e,i);const g=n.moveToSweep(m);yield new s.M8(g.nativePromise()),r++}n.setRestrictedSweeps(null),i.resolve(),n.currentTransitionPromise=null,n.stop()},deferred:i}}}var B=i(22729);const U=new(i(25799).Z)("tours");class H{constructor(e,t,i,n,o,r,a,l,h){this.settingsData=e,this.cameraPose=t,this.cameraTransition=i,this.sweepTransition=n,this.sweepControl=o,this.cameraControl=r,this.generators=a,this.setRestrictedSweeps=l,this.getCurve=h,this.type=M.Aq.Path,this.toIndex=-1,this.currentTransitionGenerator=null,this.currentTransitionPromise=null,this.canceling=!1,this.buildTransition=(e,t)=>{if(e.length<=2)throw U.debug(`invalid path: ${e}`),new Error("smooth path requires more than 2 stops");const i=this,n=new L.Q;i.setRestrictedSweeps(e);const o=e.map((e=>e.position)),r=i.getCurve(o),a=R.vG,l=R.Fs,h=R.to,d=ee.getTransitionSpeed(i.settingsData),u=((e,t,i)=>{let s=0;for(let n=0;n<e.length-1;n++){const o=(0,S.zW)(t[n],t[n+1]);s+=k(e[n].position,e[n+1].position,o,i)}return s})(e,t,d);return U.debug(`path duration: ${u.toFixed(0)}ms, at speed: ${d}m/s`),i.cameraControl.beginExternalTransition(),{generator:function*(){n.notify(0);const o=new w.Pa4,p=new w._fP;let m=0,g=0,f=0,v=1,y=e[v].id;yield new s.M8(i.sweepControl.activateSweepUnsafe({sweepId:y})),i.sweepControl.beginSweepTransition({sweepId:y,transitionTime:u,internalProgress:!1}),e.length>2&&i.sweepControl.activateSweepUnsafe({sweepId:e[2].id});let b=i.cameraPose.rotation.clone();for(;m<u&&!i.canceling;){const c=m/u;f>0&&(b=t[f].clone());const d=t[v],w=r.normalSourceDistances[f],T=r.normalSourceDistances[v],E=e[v];if(g=(0,S.et)(c,w,T,0,1),g<=1){const e=h(g,0,1,1);i.sweepTransition.progress.modifyAnimation(e,1,0);const t=l(g,0,1,1);p.copy(b).slerp(d,t)}c<1&&o.copy(r.curve.getPointAt(a(c,0,1,1))),i.cameraControl.updateCameraPosition(o),i.cameraControl.updateCameraRotation(p),c>=T&&(i.sweepControl.endSweepTransition({sweepId:E.id}),f++,v++,y=e[f+1].id,yield new s.M8(i.sweepControl.activateSweepUnsafe({sweepId:y})),i.sweepControl.beginSweepTransition({sweepId:y,transitionTime:u,internalProgress:!1}),e.length>f+2&&i.sweepControl.activateSweepUnsafe({sweepId:e[f+2].id})),n.notify(c),m=Date.now()-i.cameraTransition.startTime,yield new s.Jj}if(i.cameraControl.endExternalTransition(),i.canceling){i.canceling=!1;const t=e[v].position,n=k(i.cameraPose.position,t,0,d),o=i.cameraControl.moveTo({transitionTime:n/ne,transitionType:c.n.Interpolate,pose:{position:t}});o.progress((e=>{const t=(0,S.et)(e,0,1,g,1);i.sweepTransition.progress.modifyAnimation(t,1,0)})),yield new s.M8(o.nativePromise())}i.sweepControl.endSweepTransition({sweepId:y}),i.setRestrictedSweeps(null),n.notify(1),n.resolve()},deferred:n}}}get active(){return null!==this.currentTransitionPromise||null!==this.currentTransitionGenerator}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.canceling=!0,this.currentTransitionPromise&&(await this.promise,this.currentTransitionPromise=null),this.currentTransitionGenerator&&(this.generators.stopGenerator(this.currentTransitionGenerator),this.currentTransitionGenerator=null)}start(e){if(U.debug(`starting smooth transition with ${e.path.length-1} stops`),this.active)throw Error("Transition already active");this.canceling=!1;const{generator:t,deferred:i}=this.buildTransition(e.path,e.orientations);return this.generators.startGenerator(t),this.currentTransitionGenerator=t,this.currentTransitionPromise=i.nativePromise().then((()=>{this.currentTransitionPromise=null,this.currentTransitionGenerator=null})),this}}var G=i(94210),V=i(77956),z=i(89895),j=i(20949),W=i(60959);class Z{constructor(e,t,i,s,n,o,r,a){this.settingsData=e,this.cameraPose=t,this.viewmodeData=i,this.cameraControl=s,this.sweepControl=n,this.switchToMode=o,this.setRestrictedSweeps=r,this.generators=a,this.toIndex=-1,this.type=M.Aq.Move,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");if(!e.snapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:t}=this.build(e.snapshot,e.currentSweep,e.transitionType);return this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}build(e,t,i){let s=Promise.resolve();const n=e.metadata.cameraMode,o=e.metadata.cameraQuaternion,r=e.metadata.scanId,a=this.cameraPose.rotation,l=(0,S.zW)(a,o),c=e.metadata.cameraPosition,h=!e.is360,d={position:c,rotation:o,sweepID:r,zoom:e.metadata.orthoZoom};if(n!==this.viewmodeData.currentMode){const e=ee.getOtherModeTransitionTime(this.settingsData,l,i);s=this.switchToMode(n,i,d,e)}else if(r&&this.viewmodeData.isPano())if(t&&r===t){const e=ee.getSamePanoTransitionTime(this.settingsData,l);s=this.standardTransitionSameSweepRotationPromise(d,l,e)}else{const e=ee.getTransitionTime(this.settingsData);s=this.standardTransitionSweepMovePromise(d,r,h,e)}else s=this.cameraControl.moveTo({transitionType:i,pose:d,transitionTime:ee.getOtherModeTransitionTime(this.settingsData,l,i)}).nativePromise();return{deferred:s}}standardTransitionSameSweepRotationPromise(e,t,i){if(!e.rotation)throw Error("Rotation transition requires a rotation");return t<.01?Promise.resolve():(this.setRestrictedSweeps(null),this.cameraControl.moveTo({transitionType:c.n.Interpolate,pose:{rotation:e.rotation},transitionTime:i}).nativePromise())}standardTransitionSweepMovePromise(e,t,i,n){if(!e.position)throw Error("Push transition requires a position");const o=e.position.clone().sub(this.cameraPose.position).normalize(),r=this.cameraPose.position.clone().add(o.multiplyScalar(.15)),a=new L.Q;this.setRestrictedSweeps(null);const l=this;return this.generators.startGenerator((function*(){yield new s.M8(l.sweepControl.activateSweepUnsafe({sweepId:t}));const o=new w.Pa4,h=l.cameraPose.position.clone(),d=Date.now();let u,p=0,m=!1,g=!1;for(;p<n;){const a=(0,R.FG)(p,0,p/n,n);i&&l.cameraControl.updateCameraPosition(o.copy(h).lerp(r,a)),a>=.3&&!g&&(u=l.cameraControl.moveTo({transitionType:c.n.FadeToBlack,pose:e,transitionTime:n,blackoutTime:.5*n}).progress((e=>{e>=.5&&!m&&(l.sweepControl.instantSweepTransition(t),m=!0)})),g=!0),yield new s.Jj,p=Date.now()-d}u&&(yield new s.M8(u.nativePromise())),a.resolve()})),a.nativePromise()}}class q{constructor(e,t,i,s){this.moveToSweep=e,this.viewmodeData=t,this.cameraControl=i,this.switchToMode=s,this.toIndex=-1,this.type=M.Aq.Move,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");if(!e.snapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:t}=this.build(e.snapshot,e.currentSweep);return this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}build(e,t){let i=Promise.resolve();const s=e.metadata.cameraMode,n=e.metadata.cameraQuaternion,o=e.metadata.scanId,r={position:e.metadata.cameraPosition,rotation:n,sweepID:o,zoom:e.metadata.orthoZoom},a=s!==this.viewmodeData.currentMode,l=!!o&&this.viewmodeData.isPano();if(a)i=this.switchToMode(s,c.n.Instant,r);else if(l){const e={transitionType:c.n.Instant,sweepId:o,rotation:n};i=this.moveToSweep(e).nativePromise()}else i=this.cameraControl.moveTo({transitionType:c.n.Instant,pose:r}).nativePromise();return{deferred:i}}}var K=i(71144),Y=i(86682);class ${constructor(e,t){this.issueCommand=e,this.currentFloorId=t,this.type=M.Aq.FloorChange,this.toIndex=-1,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");let t=Promise.resolve();const i=e.targetSnapshot.metadata.floorId,s=i!==this.currentFloorId(),n=e.targetSnapshot.metadata.cameraMode;return n!==r.Ey.Panorama&&n!==r.Ey.Outdoor&&s&&(t=this.issueCommand(new Y.Vw(i,!0))),this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}}class Q{constructor(e,t,i){this.settingsData=e,this.rotate=t,this.stopRotating=i,this.type=M.Aq.Burns,this.toIndex=-1,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");if(!e.snapshot||!e.nextSnapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:t}=this.build(e.snapshot,e.nextSnapshot,e.panOverrides);return this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}build(e,t,i){const{panDirection:s,panAngle:n}=i,o=ee.getPanValues(this.settingsData,!0,s,n);let r=-1*o.radiansPerMs;const a=o.direction;if(void 0!==a&&a!==M.kw.Auto)r*=a;else if(e&&e.metadata.cameraQuaternion&&t&&t.metadata.cameraQuaternion){const i=D.f.FORWARD.clone().applyQuaternion(e.metadata.cameraQuaternion),s=D.f.FORWARD.clone().applyQuaternion(t.metadata.cameraQuaternion),n=Math.sign(i.cross(s).y);r=0!==n?r*n:r}return this.onStopRequested=async()=>{await this.stopRotating()},{deferred:this.rotate(o.ms,new w.FM8(r,0))}}}class X{constructor(e,t,i,s,n){this.settingsData=e,this.cameraPose=t,this.rotate=i,this.stopRotating=s,this.getCurve=n,this.type=M.Aq.Burns,this.toIndex=-1,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve()}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null)}start(e){if(this.active)throw Error("Transition already active");const{deferred:t}=this.build(e.path,e.snapshot,e.nextSnapshot,e.panOverrides);return this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null})),this}build(e,t,i,s){this.onStopRequested=async()=>{await this.stopRotating()};const{panDirection:n,panAngle:o}=s,a=ee.getPanValues(this.settingsData,!1,n,o),l=a.direction;let c=a.radiansPerMs;if(void 0!==l&&l!==M.kw.Auto)c*=l;else if(e){const t=this.cameraPose.position.clone().setY(0),i=e.map((e=>e.position)),s=this.getCurve(i).curve.getPointAt(.1).setY(0).clone().sub(t).normalize(),n=D.f.FORWARD.clone().applyQuaternion(this.cameraPose.rotation),o=Math.sign(n.cross(s).y);c=0!==o?c*o:c}else if(i&&t&&(t.metadata.cameraMode!==r.Ey.Panorama&&(c=-c),t.metadata.scanId===i.metadata.scanId)){const e=D.f.FORWARD.clone().applyQuaternion(this.cameraPose.rotation),t=D.f.FORWARD.clone().applyQuaternion(i.metadata.cameraQuaternion),s=Math.sign(e.cross(t).y);c=0!==s?c*s:c}return{deferred:this.rotate(a.ms,new w.FM8(c,0))}}}var J=i(67868);class ee{constructor(e,t,i,s,o){this.engine=e,this.tourData=t,this.cameraData=i,this.settingsData=s,this.viewmodeData=o,this.init=async()=>{this.sweepModule=await this.engine.getModule(G.default),this.sweepData=await this.engine.market.waitForData(V.Z),this.cameraModule=await this.engine.getModule(z.default),this.pathModule=await this.engine.getModule(j.default),this.floorsViewData=await this.engine.market.waitForData(B.c),this.commonControlsModule=await this.engine.getModule(W.default),this.viewmodeModule=await this.engine.getModule(K.default),this.smoothWalkingTransition=new H(this.settingsData,this.cameraData.pose,this.cameraData.transition,this.sweepData.transition,this.sweepModule,this.cameraModule,this.engine,this.pathModule.setRestrictedSweeps.bind(this.pathModule),this.pathModule.getCurveForPath.bind(this.pathModule)),this.directWalkingTransition=new F(this.settingsData,this.cameraData.pose,this.sweepModule.moveToSweep.bind(this.sweepModule),this.cameraModule.updateTransitionSpeed.bind(this.cameraModule),this.pathModule.setRestrictedSweeps.bind(this.pathModule),this.engine),this.instantTransition=new q(this.sweepModule.moveToSweep.bind(this.sweepModule),this.viewmodeData,this.cameraModule,this.viewmodeModule.switchToMode.bind(this.viewmodeModule)),this.panTransition=new C(this.settingsData,this.commonControlsModule.startRotateTransition.bind(this.commonControlsModule),this.commonControlsModule.stop.bind(this.commonControlsModule)),this.panLegacyTransition=new X(this.settingsData,this.cameraData.pose,this.commonControlsModule.startRotateTransition.bind(this.commonControlsModule),this.commonControlsModule.stop.bind(this.commonControlsModule),this.pathModule.getCurveForPath.bind(this.pathModule)),this.panDollhouseTransition=new Q(this.settingsData,this.commonControlsModule.startRotateTransition.bind(this.commonControlsModule),this.commonControlsModule.stop.bind(this.commonControlsModule)),this.defaultTransition=new Z(this.settingsData,this.cameraData.pose,this.viewmodeData,this.cameraModule,this.sweepModule,this.viewmodeModule.switchToMode.bind(this.viewmodeModule),this.pathModule.setRestrictedSweeps.bind(this.pathModule),this.engine),this.zoomTransition=new O(this.settingsData,this.commonControlsModule.startZoomTransition.bind(this.commonControlsModule),this.commonControlsModule.stop.bind(this.commonControlsModule)),this.floorChangeTransition=new $(this.engine.commandBinder.issueCommand.bind(this.engine.commandBinder),(()=>this.floorsViewData.currentFloorId)),this.delayTransition=new A(this.settingsData),this.nopTransition={active:!1,type:M.Aq.Nop,promise:Promise.resolve(),stop:()=>Promise.resolve(),toIndex:-1},this.pathOrientHelper=new J.A},this.getValidWalkingPath=e=>{const t=e.metadata.scanId,i=this.sweepData.currentSweep,s=this.tourData.getTourCurrentSnapshotIndex();let o=null;if(s>=0){const e=this.tourData.getTourSnapshotSid(s);o=this.tourData.getSnapshot(e)}if(this.viewmodeData.currentMode!==r.Ey.Panorama||!i||!t||t===i||e.is360||!o||o.is360)return null;const a=this.pathModule.findShortestPath(i,t,n.Xd.walkingTourIncludeExtraPanosDistance,n.Xd.walkingStageMinimumDistance,n.Xd.maxWalkingSweepsBetweenSnapshots)||[];return 0===a.length?null:a}}static getPanDegrees(e,t){let i;return i=n.Xd.panAtSnapshot?-1!==(0,_.hu)("sspa",-1)?n.Xd.snapshotPanAngle:void 0!==t?t:e.tryGetProperty(E.gx.PanAngle,n.BA):0,Math.max(i,0)}static getPanRadiansPerMs(e,t,i){if(-1!==(0,_.hu)("st",-1))return n.Xd.snapshotPanZoomDuration>0?i/n.Xd.snapshotPanZoomDuration:0;const s=t?e.tryGetProperty(E.gx.DollhousePanSpeed,n.su):e.tryGetProperty(E.gx.PanSpeed,n.pn);return(0,x.DA)(s)}getFloorTransition(e){const t=this.tourData.getTourSnapshotSid(e),i=this.tourData.getSnapshot(t);return i?this.floorChangeTransition.start({targetSnapshot:i}):this.nopTransition}getMainTransition(e,t){const i=this.tourData.getTourSnapshotSid(e),s=this.tourData.getSnapshot(i);if(!s)return this.nopTransition;let n=null;if(t===c.n.Interpolate){const e=s.metadata.cameraQuaternion,t=this.getValidWalkingPath(s);if(t){const i=t.map((e=>e.position)),s=this.pathOrientHelper.getOrientationsForPath(i,(0,S.Z)(e));n=t.length>2?this.smoothWalkingTransition.start({path:t,orientations:s}):this.directWalkingTransition.start({path:t,orientations:s})}}else if(t===c.n.Instant){const e=this.sweepData.currentSweep;n=this.instantTransition.start({snapshot:s,currentSweep:e})}if(!n){const e=this.sweepData.currentSweep;n=this.defaultTransition.start({snapshot:s,currentSweep:e,transitionType:t})}return n}getBurnsTransition(e,t){const i=this.tourData.getTourSnapshotSid(e),s=(e+1)%this.tourData.getSnapshotCount(),n=this.tourData.getTourSnapshotSid(s),o=this.tourData.getHighlightDescription(i),r={};o.reelEntry&&o.reelEntry.overrides&&(r.panDirection=o.reelEntry.overrides.panDirection,r.panAngle=o.reelEntry.overrides.panAngle);const a=this.tourData.getSnapshot(n);let l=this.nopTransition;switch(t){case M.BZ.Pan:if(a){const e=this.getValidWalkingPath(a);l=this.panLegacyTransition.start({path:e,snapshot:o.snapshot,nextSnapshot:a,panOverrides:r})}l===this.nopTransition&&(l=this.panTransition.start({snapshot:o.snapshot,nextSnapshot:a,panOverrides:r}));break;case M.BZ.PanDollhouse:l=this.panDollhouseTransition.start({snapshot:o.snapshot,nextSnapshot:a,panOverrides:r});break;case M.BZ.Zoom:l=this.zoomTransition.start();break;case M.BZ.Delay:l=this.delayTransition.start();break;case M.BZ.None:l=this.nopTransition;break;default:throw Error("unhandled TourBurnsStyle")}return l}}ee.useDelayTransition=(e,t,i)=>!n.Xd.panAtSnapshot||t!==M.BZ.Zoom&&0===ee.getPanDegrees(e,i),ee.getPanDirection=(e,t)=>void 0!==t?t:e.tryGetProperty(E.gx.PanDirection,T.y6),ee.getDelayDuration=e=>-1!==(0,_.hu)("st",-1)||0===(0,_.hu)("kb",-1)?n.Xd.snapshotPanZoomDuration:n.mS,ee.getZoomDuration=e=>-1!==(0,_.hu)("st",-1)?n.Xd.snapshotPanZoomDuration:e.tryGetProperty(E.gx.ZoomDuration,n._c),ee.getPanValues=(e,t,i,s)=>{const o=ee.getPanDirection(e,i),r=ee.getPanDegrees(e,s),a=w.M8C.degToRad(r),l=ee.getPanRadiansPerMs(e,t,a);let c=l>0?a/l:0;return t&&void 0===s&&(c=n.Xd.snapshotPanZoomDuration),{degrees:r,radiansPerMs:l,ms:c,direction:o}},ee.getTransitionSpeed=e=>{if(-1!==(0,_.hu)("wts",-1))return e.tryGetProperty(n.EU,n.Im);const t=e.tryGetProperty(E.gx.TransitionSpeed,n.Mk);return(0,x.mf)(t/1e3)},ee.getTransitionTime=e=>{const t=e.tryGetProperty(E.gx.TransitionTime,n.mL);return Math.min(Math.max(n.eu,t),n.NY)},ee.getOtherModeTransitionTime=(e,t,i)=>{if(i===c.n.FadeToBlack)return ee.getTransitionTime(e)+n.HJ;let s=n.Cp,o=n.f7;if(-1===(0,_.hu)("wts",-1)){const t=1e3*ee.getTransitionSpeed(e);s=Math.sqrt(2*(t-n.Pv))+45,t!==n.Mk&&(o=n._D)}const r=1e3*t/(w.M8C.DEG2RAD*s);return Math.max(r,o)},ee.getSamePanoTransitionTime=(e,t)=>{const i=e.tryGetProperty(E.gx.PanSpeed,n.pn);if(i===n.pn)return Math.max(1e3*t/(w.M8C.DEG2RAD*n.O2),n.gS);{const e=(0,S.dS)(i,n.z$,n.b_,n.rM,n.z8),s=(0,x.DA)(e);return s>0?t/s:0}};var te=i(28281),ie=i(19417),se=i(23549);const ne=5;class oe extends o.Y{constructor(){super(...arguments),this.name="tours-controls",this.getBurnsStyleForSnapshot=(e,t,i)=>{const s=e.getTourSnapshotSid(t),n=e.getHighlightDescription(s),o=e.getSnapshotCount();if(!n||!n.snapshot)return M.BZ.None;const a=n.snapshot.metadata.cameraMode,l=t===o-1,c=n.reelEntry&&n.reelEntry.overrides&&n.reelEntry.overrides.panDirection,h=a===r.Ey.Dollhouse?M.BZ.PanDollhouse:a===r.Ey.Floorplan?M.BZ.Zoom:M.BZ.Pan;return ee.useDelayTransition(this.settingsData,h,i)?M.BZ.Delay:l&&void 0!==c?h:l?M.BZ.None:h},this.canChangeTourLocation=()=>{const e=this.data.getTourState(),t=this.data.isTourTransitionActive(),i=this.cameraData.canTransition();return e===a.Vs.Inactive&&!t&&!(this.viewmodeData.transition&&this.viewmodeData.transition.active)&&i}}async init(e,t){this.engine=t,this.cameraData=await t.market.waitForData(b.M_),this.viewmodeData=await t.market.waitForData(l.O),this.settingsData=await t.market.waitForData(y.e),this.data=await t.market.waitForData(a.k3),t.getModule(h.default).then((e=>{e.registerHandler(u.er,(()=>{this.handleTourInputInterrupt()})),e.registerHandler(p.a,(()=>{this.handleTourInputInterrupt()})),e.registerHandler(m.e,(e=>{e.state===g.M.DOWN&&this.handleTourInputInterrupt()}))})),this.transitionFactory=new ee(t,this.data,this.cameraData,this.settingsData,this.viewmodeData),await this.transitionFactory.init(),this.setupAutoPlay(t),this.bindings.push(t.commandBinder.addBinding(ie.TH,(async e=>this.startTour(e.index,e.steps,e.loop)))),this.bindings.push(t.commandBinder.addBinding(ie.vy,(async()=>this.stopTour()))),this.bindings.push(t.commandBinder.addBinding(ie.rU,(async e=>this.tourGoTo(e.index,e.instant?c.n.Instant:void 0)))),this.bindings.push(t.commandBinder.addBinding(ie.HW,(async e=>e.forward?this.tourGoNext(e.instant):this.tourGoPrevious(e.instant)))),this.bindings.push(t.subscribe(d.Vx,(()=>{this.data.setTourTransitionToIndex(-1)})),t.subscribe(d.NR,(()=>{this.data.setTourTransitionToIndex(-1)})))}handleTourInputInterrupt(){this.data.getTourState()!==a.Vs.Inactive&&this.stopTour()}canTourProceed(e,t,i){const s=this.data.getSnapshotCount();if(0===s||0===i||this.data.getTourState()!==a.Vs.Inactive)return!1;if(void 0!==t){if(t<-1)return!1;if(!0!==e&&t>s-1)return!1}return!0}shouldTourContinue(e,t,i,s){return void 0!==s?i<s:t<e-1}startTour(e,t,i){if(!this.canChangeTourLocation())throw new se.Y("Cannot start tour at this time, another transition is active");const n=void 0!==i?i:this.data.isLooping();if(!this.canTourProceed(n,e,t))return;const o=this.data.getSnapshotCount(),r=this.data.getTourCurrentSnapshotIndex();let l,c=0;l=void 0!==e?e-1:r>=o-1?-1:r;const h=this.settingsData.tryGetProperty(te.YS,null);this.settingsData.setProperty(te.YS,null);const u=this;this.tourGenerator=function*(){for(;u.shouldTourContinue(o,l,c,t);){const e=l+1,t=u.composeTourTransition(e);yield new s.M8(t),l=e,l===o-1&&n&&(l=-1),c++}u.stopTour(),u.settingsData.setProperty(te.YS,h)},this.engine.startGenerator(this.tourGenerator),this.data.setTourState(a.Vs.Active),this.data.tourEnded=!1,this.data.tourPlaying=!0,this.engine.broadcast(new d.oR)}async composeTourTransition(e,t,i){const s=this.data.getTourSnapshotSid(e),n=this.data.getHighlightDescription(s);if(!n.snapshot)throw Error(`Highlight not found for reel index ${e}`);let o=this.settingsData.tryGetProperty(T.gj,c.n.Interpolate);const l=n.snapshot.metadata.cameraMode,h=l===r.Ey.Dollhouse||l===r.Ey.Floorplan,u=!this.viewmodeData.isPano()&&l===r.Ey.Panorama,p=this.viewmodeData.isPano()&&h,m=!this.viewmodeData.isPano()&&h,g=this.viewmodeData.isPano()&&l===r.Ey.Panorama;let f=null;(u||p||m)&&(o=c.n.Interpolate),g&&0===e&&(o=c.n.FadeToBlack),n.reelEntry&&n.reelEntry.overrides&&(void 0!==n.reelEntry.overrides.transitionType&&(o=n.reelEntry.overrides.transitionType),void 0!==n.reelEntry.overrides.panAngle&&(f=n.reelEntry.overrides.panAngle)),void 0!==i&&(o=i),this.data.setTourTransitionToIndex(e),this.engine.broadcast(new d.dW);const v=this.transitionFactory.getFloorTransition(e);if(this.data.useTransition(v),await v.promise,this.data.getTourState()===a.Vs.StopScheduled)return;const y=this.transitionFactory.getMainTransition(e,o);if(this.data.useTransition(y),await y.promise,this.data.setTourCurrentSnapshotByIndex(e),this.engine.broadcast(new d.Vx(e)),this.data.getTourState()===a.Vs.StopScheduled)return;const b=t||this.getBurnsStyleForSnapshot(this.data,e,null!==f?f:void 0),w=this.transitionFactory.getBurnsTransition(e,b);this.data.useTransition(w),await w.promise}async stopTour(){this.data.getTourState()===a.Vs.Active&&(this.data.setTourState(a.Vs.StopScheduled),this.data.tourPlaying=!1,await this.data.stopTourTransition(),this.tourGenerator&&this.engine.stopGenerator(this.tourGenerator),this.engine.broadcast(new d.NR),this.data.getTourCurrentSnapshotIndex()!==this.data.getSnapshotCount()-1||this.data.isLooping()||(this.data.tourEnded=!0,this.engine.broadcast(new d.Mt)),this.data.setTourState(a.Vs.Inactive))}async tourGoNext(e){let t=this.data.getTourCurrentSnapshotIndex()+1;t>=this.data.getSnapshotCount()&&(t=0);const i=e?c.n.Instant:void 0;return this.tourGoTo(t,i)}async tourGoPrevious(e){let t=this.data.getTourCurrentSnapshotIndex();t<0&&(t=0);let i=t-1;i<0&&(i=this.data.getSnapshotCount()-1);const s=e?c.n.Instant:void 0;return this.tourGoTo(i,s)}async tourGoTo(e,t=c.n.FadeToBlack){if(!this.canChangeTourLocation())throw new se.z("Cannot change tour location at this time, another transition is active");if(this.viewmodeData.transition&&this.viewmodeData.transition.active)throw new se.z("Cannot go to tour location during viewmode transition");if(this.data.getTourState()!==a.Vs.Inactive)throw new se.z("Cannot jump to tour location while tour is active");try{this.data.setTourState(a.Vs.Active),await this.composeTourTransition(e,M.BZ.None,t)}catch(e){this.log.error(e)}finally{this.data.setTourState(a.Vs.Inactive)}}setupAutoPlay(e){const t=1e3*n.Xd.autoStartDelay,i=()=>{let e=!0;const i=this.cameraData.pose.onChanged((()=>{e=!1,i.cancel()}));setTimeout((()=>{e&&this.startTour(),i.cancel()}),t)};if(t>=0){const t=e.market.tryGetData(f.pu);if(t&&t.phase===f.nh.PLAYING)i();else{const t=s=>{s.phase===f.nh.PLAYING&&(i(),e.unsubscribe(v.LZ,t))};e.subscribe(v.LZ,t)}}}}},44228:(e,t,i)=>{"use strict";var s,n,o;i.d(t,{BZ:()=>s,kw:()=>n,Aq:()=>o}),function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(s||(s={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(n||(n={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(o||(o={}))},53339:(e,t,i)=>{"use strict";i.d(t,{oR:()=>n,Vx:()=>o,NR:()=>r,Mt:()=>a,sY:()=>l,dW:()=>c});var s=i(93528);class n extends s.v{}class o extends s.v{constructor(e){super(),this.index=e}}class r extends s.v{}class a extends s.v{}class l extends s.v{}class c extends s.v{}},27545:(e,t,i)=>{"use strict";i.d(t,{WQ:()=>o,EU:()=>r,OJ:()=>a,BY:()=>l,Im:()=>c,LO:()=>h,N5:()=>d,Qo:()=>u,Pv:()=>p,Mk:()=>m,mL:()=>g,eu:()=>f,NY:()=>v,gS:()=>y,O2:()=>b,rM:()=>w,z8:()=>S,f7:()=>T,Cp:()=>E,_D:()=>_,HJ:()=>x,BA:()=>M,pn:()=>P,z$:()=>A,b_:()=>O,mS:()=>D,su:()=>I,_c:()=>C,Xd:()=>R});var s=i(21265),n=i(71144);const o="TourSpeed &wts",r="ToursMetersPerSecond",a=.4,l=10,c=1.25,h=.8,d=6,u=3,p=1e3*h,m=1e3*c,g=600,f=400,v=1200,y=1200,b=35,w=15,S=120,T=1200,E=75,_=400,x=n.DEFAULT_TRANSITION_TIME-g,M=35,P=M/3500*1e3,A=2,O=52,D=0,I=.2*P,C=3500,R=Object.freeze({panAtSnapshot:s.hu("kb",1),snapshotPanZoomDuration:s.hu("st",3500),snapshotPanAngle:s.hu("sspa",M),walkingTourIncludeExtraPanosDistance:.4,walkingStageMinimumDistance:.8,maxWalkingSweepsBetweenSnapshots:40,autoStartDelay:s.hu("ts",-1)})},17694:(e,t,i)=>{"use strict";i.d(t,{HG:()=>r,JG:()=>a,mf:()=>l,DA:()=>c});var s=i(2212),n=i(97620),o=i(27545);const r=e=>{let t=o.Im;if(!isNaN(e)){const i=Math.min(Math.max(o.OJ,e),o.BY);t=(0,n.et)(i,o.OJ,o.BY,o.LO,o.Qo)}return t},a=e=>(0,n.et)(e,o.LO,o.N5,o.OJ,o.BY),l=e=>Math.min(Math.max(o.LO,e),o.N5),c=e=>s.M8C.degToRad(e)/1e3},58345:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});var s=i(99681);class n extends s.m{constructor(){super(...arguments),this.id="DELETE_UNUSED_TOUR_SNAPSHOTS"}}},98728:(e,t,i)=>{"use strict";i.d(t,{Vs:()=>s,k3:()=>a});var s,n,o=i(19413),r=i(44228);!function(e){e[e.Inactive=0]="Inactive",e[e.Active=1]="Active",e[e.StopScheduled=2]="StopScheduled"}(s||(s={})),function(e){e[e.Beginning=0]="Beginning",e[e.Current=1]="Current",e[e.End=2]="End"}(n||(n={}));class a extends o.V{constructor(e={},t,i,n,o){super(),this.snapshots=e,this.activeReel=t,this.allowedModes=i,this.modelSweeps=n,this.looping=o,this.name="tour",this.enabledTourStops=[],this.tourPlaying=!1,this.tourEnded=!1,this.updateEnabledStops=e=>{if(this.enabledTourStops=[],this.activeReel&&this.activeReel.reel)for(const t of this.activeReel.reel)if(t&&t.sid in this.snapshots){const i=this.snapshots[t.sid],s=i.metadata.cameraMode,n=i.metadata.scanId,o=-1!==e.indexOf(s),r=this.modelSweeps.findIndex((e=>e.id===n)),a=void 0!==n&&-1!==r&&this.modelSweeps[r].enabled,l=!n;o&&(l||a)&&this.enabledTourStops.push(t.sid)}},this.updateEnabledStops(i),this.tourState=s.Inactive,this.tourCurrentSnapshot=-1,this.transition={active:!1,type:r.Aq.Move,promise:Promise.resolve(),stop:()=>Promise.resolve(),toIndex:-1},this.looping=o,this.commit()}addSnapshotToTour(e,t=n.Current){this.snapshots[e.sid]=e,this.allowedModes.includes(e.metadata.cameraMode)&&this.enabledTourStops.push(e.sid);const i=this.tourCurrentSnapshotSid;switch(this.tourCurrentSnapshotSid=e.sid,t){case n.Beginning:this.tourCurrentSnapshot=0,this.activeReel.reel.insert(0,{sid:e.sid});break;case n.End:this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});break;case n.Current:if(void 0===i)this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});else{let t=this.activeReel.reel.findIndex((e=>!!e&&e.sid===i))+1;(t<=0||t>this.activeReel.reel.length)&&(t=this.activeReel.reel.length-1),this.tourCurrentSnapshot=this.tourCurrentSnapshot+1,this.activeReel.reel.insert(t,{sid:e.sid})}break;default:throw new Error(`Tours.addSnapshotToTour not implemented: ${t}`)}this.commit()}clearHighlightOverrides(e,t,i){if(!t&&!i)return;const s={};t&&(s.transitionType=void 0),i&&(s.panDirection=void 0,s.panAngle=void 0),this.applyHighlightOverrides(e,s)}clearAllHighlightOverrides(){this.getReel().reel.forEach((e=>{e&&this.clearHighlightOverrides(e.sid,!0,!0)}))}resetAllTransitionTypeOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&t.overrides.transitionType&&(delete t.overrides.transitionType,this.activeReel.reel.update(i,t),e=!0)})),e&&this.activeReel.setDirty()}}resetAllPanSettingOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&(void 0===t.overrides.panAngle&&void 0===t.overrides.panDirection||(delete t.overrides.panAngle,delete t.overrides.panDirection,e=!0,this.activeReel.reel.update(i,t)))})),e&&this.activeReel.setDirty()}}applyHighlightOverrides(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e));this.setHighlightOverrides(i,t)}setHighlightOverrides(e,t){const i=this.activeReel.reel.get(e);if(!i)throw Error(`Highlight not found for ${e}`);const s={sid:i.sid};i.overrides?(s.overrides=Object.assign({},i.overrides),t.hasOwnProperty("panDirection")&&(s.overrides.panDirection=t.panDirection),t.hasOwnProperty("transitionType")&&(s.overrides.transitionType=t.transitionType),t.hasOwnProperty("panAngle")&&(s.overrides.panAngle=t.panAngle)):s.overrides={transitionType:t.transitionType,panDirection:t.panDirection,panAngle:t.panAngle},this.activeReel.reel.update(e,s)}moveTourStop(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),s=this.activeReel.reel.findIndex((e=>!!e&&e.sid===t));this.activeReel.reel.move(i,s)}clear(){this.resetEmptyReel(),this.enabledTourStops.length=0,this.activeReel.reel.length=0,this.commit()}removeTourStop(e){const t=this.enabledTourStops.indexOf(e),i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),s=this.getTourIndexBySid(e);if(-1!==t&&this.enabledTourStops.splice(t,1),this.enabledTourStops.length>0){const e=s<=this.tourCurrentSnapshot?this.tourCurrentSnapshot-1:this.tourCurrentSnapshot;this.setTourCurrentSnapshotByIndex(Math.max(e,0))}else this.resetEmptyReel();this.activeReel.reel.remove(i)}getReel(){return this.activeReel}clone(){const e=new a({},this.activeReel,this.allowedModes,this.modelSweeps,this.looping);for(const t of Object.keys(this.snapshots)){const i=this.snapshots[t];e.snapshots[t]=i.clone()}return e}copy(e){for(const t in e.snapshots)this.snapshots[t]=e.snapshots[t];this.activeReel=e.activeReel,this.allowedModes=e.allowedModes,this.tourState=e.tourState,this.tourPlaying=e.tourPlaying,this.tourEnded=e.tourEnded,this.tourCurrentSnapshot=e.tourCurrentSnapshot,this.tourCurrentSnapshotSid=e.tourCurrentSnapshotSid,this.modelSweeps=e.modelSweeps,this.looping=e.looping,this.updateEnabledStops(this.allowedModes)}isLooping(){return this.looping}isTourActive(){return this.tourState!==s.Inactive}getCurrentTourState(){return{currentStep:this.getTourCurrentSnapshotIndex(),tourPlaying:this.tourPlaying,totalSteps:this.getSnapshotCount(),tourEnded:this.tourEnded,activeStep:this.transition&&-1!==this.transition.toIndex?this.transition.toIndex:this.getTourCurrentSnapshotIndex(),highlights:this.getReelHighlights(),transition:this.transition}}isTourTransitionActive(){return this.transition.active}getTourTransitionType(){return this.transition.type}useTransition(e){this.transition=e}setTourTransitionToIndex(e){this.transition.toIndex=e}async stopTourTransition(){await this.transition.stop()}iterateSnapshots(e){let t=0;this.activeReel.reel.forEach((i=>{if(i&&this.isEnabled(i.sid)){const s=this.snapshots[i.sid];e(s,t++)}}))}isSnapshotInTour(e){return-1!==this.activeReel.reel.findIndex((t=>!!t&&t.sid===e))}getEnabledSnapshots(){const e=[];return this.iterateSnapshots(((t,i)=>{e.push(t)})),e}updateSnapshots(e){this.snapshots=e}async getPhotosForTour(){const e=[];for(const t in this.snapshots){const i=this.snapshots[t];"tour"!==i.category&&"panorama"!==i.category&&e.push({name:i.name,sid:i.sid,thumbnailUrl:await i.thumbnailUrl.get(),inReel:-1!==this.activeReel.reel.findIndex((e=>!!e&&e.sid===t))})}return e}getSnapshot(e){return this.snapshots[e]}getHighlightDescription(e){const t=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),i=this.activeReel.reel.get(t);return{snapshot:this.getSnapshot(e),reelEntry:i}}getReelHighlights(){const e=[];return this.activeReel.reel.forEach((t=>{if(t&&this.isEnabled(t.sid)){const i=this.snapshots[t.sid];e.push({sid:i.sid,snapshot:i,panDirection:t.overrides&&t.overrides.panDirection,panAngle:t.overrides&&t.overrides.panAngle,transitionType:t.overrides&&t.overrides.transitionType})}})),e}getSnapshotCount(){return this.enabledTourStops.length}getTourState(){return this.tourState}setTourState(e){this.tourState=e}getTourCurrentSnapshotIndex(){return this.tourCurrentSnapshot}getTourCurrentSnapshotSid(){return this.tourCurrentSnapshotSid}getTourSnapshotSid(e){let t=0;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)){if(t===e)return i.sid;t++}throw new Error("getTourSnapshotSid() -> Invalid snapshot index.")}getTourSnapshotsWithSweepId(e){const t=[];for(const i of this.activeReel.reel)i&&i.sid in this.snapshots&&this.snapshots[i.sid].metadata.scanId===e&&t.push(i.sid);return t}setTourCurrentSnapshotByIndex(e){if(e<0||e>this.getSnapshotCount())throw new Error("setTourCurrentSnapshotByIndex() -> Invalid tour index.");let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,t===e)){this.tourCurrentSnapshot=e,this.tourCurrentSnapshotSid=i.sid;break}-1===t&&this.resetEmptyReel(),this.setTourTransitionToIndex(-1),this.commit()}getTourIndexBySid(e){let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,i.sid===e))return t;return-1}isEnabled(e){return-1!==this.enabledTourStops.indexOf(e)}resetEmptyReel(){this.tourCurrentSnapshot=-1,this.tourCurrentSnapshotSid=void 0,this.setTourTransitionToIndex(-1),this.commit()}}},62110:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>X});var s,n=i(62431),o=i(54122),r=i(39936),a=i(71208),l=i(77956),c=i(944),h=i(17513),d=i(26247),u=i(25799),p=i(32400),m=i(51770),g=i(74054),f=i(90134),v=i(78909);class y extends v.T{constructor(){super(),this.reel=(0,f.C)([]),this.modified=new Date(0),this.commit()}}!function(e){e.INSTANT="instant",e.FACE_TO_BLACK="fade_to_black",e.INTERPOLATE="interpolate"}(s||(s={}));var b=i(19673),w=i(47924),S=i(44228);const T=new u.Z("mds-reel-element-serializer"),E={[s.FACE_TO_BLACK]:w.n.FadeToBlack,[s.INSTANT]:w.n.Instant,[s.INTERPOLATE]:w.n.Interpolate},_={[b.Y.LEFT]:S.kw.Left,[b.Y.RIGHT]:S.kw.Right,[b.Y.AUTO]:S.kw.Auto};class x{deserialize(e){if(!e||!this.validate(e))return T.debug("Deserialized invalid highlight reel entry from MDS",e),null;const t=e.overrides||{},i={},s=void 0!==t.transitionType?E[t.transitionType]:void 0,n=void 0!==t.panDirection?_[t.panDirection]:void 0,o=t.panAngle;return void 0!==s&&(i.transitionType=s),void 0!==n&&(i.panDirection=n),void 0!==o&&(i.panAngle=o),{sid:e.asset.id,overrides:i}}validate(e){if(!e)return!1;const{asset:t}=e;return void 0!==t&&void 0!==t.id}}const M=new u.Z("mds-highlight-reel-serializer");class P{constructor(){this.reelEntrySerializer=new x}deserialize(e){if(!e||!this.validate(e))return M.debug("Deserialized invalid active reel data from MDS",e),null;const t=new y;if(t.sid=e.id,e.reel)for(const i of e.reel){const e=this.reelEntrySerializer.deserialize(i);e&&t.reel.push(e)}return t}validate(e){return["id"].every((t=>t in e))}}const A={[w.n.FadeToBlack]:s.FACE_TO_BLACK,[w.n.Instant]:s.INSTANT,[w.n.Interpolate]:s.INTERPOLATE},O={[S.kw.Left]:b.Y.LEFT,[S.kw.Right]:b.Y.RIGHT,[S.kw.Auto]:b.Y.AUTO};class D{serialize(e){const t={id:e.sid};return e.overrides&&(t.overrides={},void 0!==e.overrides.transitionType&&(t.overrides.transitionType=A[e.overrides.transitionType]),void 0!==e.overrides.panDirection&&(t.overrides.panDirection=O[e.overrides.panDirection]),void 0!==e.overrides.panAngle&&(t.overrides.panAngle=e.overrides.panAngle)),t}}const I=new u.Z("mds-highligh-reel-store");class C extends p.u{constructor(){super(...arguments),this.deserializer=new P,this.serializer=new D}async read(){const e=this.getViewId();return this.query(g.GetHighlightReel,{modelId:e}).then((e=>{const t=(0,m.qw)(e,"data.model.activeHighlightReel");return this.deserializer.deserialize(t)}))}async update(e){const t=this.getViewId(),i=e.map((e=>this.serializer.serialize(e)));return this.mutate(g.PutActiveReel,{modelId:t,elements:i}).then((e=>{I.debug(e)}))}}var R=i(98728),L=i(80034),N=i(41263),k=i(7943),F=i(15119),B=i(20331),U=i(32020),H=i(46162);const G=new u.Z("reel-serializers"),V=e=>{if(!e)return null;const t=new y;return e.active_reel&&e.active_reel.modified&&(t.modified=(0,U.p)(e.active_reel.modified)),e.active_reel&&e.active_reel.reel&&e.active_reel.reel instanceof Array?(G.info("Reel has "+e.active_reel.reel.length+" items"),t.reel.replace(e.active_reel.reel)):G.info("No reel found"),t.commit(),t},z=(e,t)=>{let i=e.modified;t&&t.modified&&(i=t.modified);const s=(0,H.p$)(e&&e.reel?e.reel:[]),n=t&&t.reel?t.reel:new f.d;(0,H.TS)(s,(0,H.p$)(n));const o=[];for(const e in s){const t=s[e];if(t){let e,i={};t.overrides&&(void 0!==t.overrides.panDirection&&(i=Object.assign(Object.assign({},i),{panDirection:t.overrides.panDirection})),void 0!==t.overrides.panAngle&&(i=Object.assign(Object.assign({},i),{panAngle:t.overrides.panAngle})),void 0!==t.overrides.transitionType&&(i=Object.assign(Object.assign({},i),{transitionType:t.overrides.transitionType}))),e=Object.keys(i).length>0?{sid:t.sid,overrides:i}:{sid:t.sid},o.push(e)}}return{active_reel:{reel:o,modified:(0,U.U)(i)}}};var j=i(83032),W=i(74403),Z=i(60841),q=i(97631),K=i(44333),Y=i(17256),$=i(58345);const Q=new u.Z("tour-data");class X extends o.Y{constructor(){super(...arguments),this.name="tours-data",this.defaultModes=[a.Ey.Panorama,a.Ey.Outdoor],this.deleteUnusedTourSnapshots=async()=>{for(const e in this.snapshotsData.collection){const t=this.snapshotsData.collection[e];t.category!==h.i.TOUR||this.tourData.isSnapshotInTour(t.sid)||await this.engine.commandBinder.issueCommand(new c.Ad(t.sid)).catch((e=>{Q.debug(e),Q.error(`Failed to delete unused tour snapshot ${t.sid}`)}))}},this.onUpdateSnapshots=()=>{this.tourData.updateSnapshots(this.snapshotsData.collection)}}async init(e,t){const{readonly:i}=e;this.engine=t;const s=await t.market.waitForData(r.e),n=this.getFilterModes(s,this.defaultModes);this.store=this.getStore(e);const o=await this.store.read()||new y;if(this.sweepData=await t.market.waitForData(l.Z),this.snapshotsData=await t.market.waitForData(d.P),this.storage=await t.getModule(q.F),this.tourData=new R.k3(this.snapshotsData.collection,o,n,this.sweepData.getSweepList(),e.looping),t.market.register(this,R.k3,this.tourData),!1===i){const e=this.tourData.getReel(),i=new W.u(e,{aggregationType:Z.E.NextFrame},t);i.onChanged((()=>this.engine.commandBinder.issueCommand(new K.VQ({dataTypes:[Y.g.HIGHLIGHTS]})))),this.store instanceof j.N&&this.store.addMonitor(i)}this.bindings.push(t.commandBinder.addBinding($.X,this.deleteUnusedTourSnapshots),this.snapshotsData.onChanged(this.onUpdateSnapshots),this.storage.onSave((()=>this.save()),{dataType:Y.g.HIGHLIGHTS}),this.storage.onRevert((()=>this.revert()),{dataType:Y.g.HIGHLIGHTS}));const a=Object.keys(o.reel).length,c=this.tourData.getSnapshotCount();a!==c&&Q.info(a-c+" items in snapshots, but not in reel")}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:s}=e,n=e.storageProvider||Y.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;if(Q.info(`Loading Highlight Reel from ${n}`),n===Y.Xq.MDS)return new C({readonly:o,baseUrl:i});const r=function(e){const{modelId:t,readonly:i}=e,s=e.baseUrl||"",n=e.queue||new B.gO,o={data:null},r=`${s}/api/v1/jsonstore/model/highlights/${t}`;if(i){const e=new L.gh({queue:n,path:r,deserialize:V,cachedData:o});return new N.nM({publishStores:[e]})}const a=new L.yh({queue:n,path:r,cachedData:o,deserialize:V,serialize:z}),l=`${s}/api/v1/jsonstore/model/workshopSession/${t}`,c=new F.Z({queue:n,path:l,cachedData:{data:null},deserialize:k.S.sessionObjectExtract(F.j.Highlights,V),serialize:z},F.j.Highlights);return new N.nM({publishStores:[a],editStore:c,editStoreKey:N.aw.HIGHLIGHTS})}({modelId:t,baseUrl:i,readonly:o,queue:s});return new j.N(r,{dataType:Y.g.HIGHLIGHTS,modelId:t,readonly:o,engine:this.engine})}async save(){if(this.store instanceof j.N)return;const e=this.tourData.getReel();await this.store.update(e.reel)}async revert(){if(this.store instanceof j.N)return this.store.revert()}getFilterModes(e,t){const i=e.tryGetProperty("dh",1)>0,s=e.tryGetProperty(n.gx.Dollhouse,!0);i&&s&&t.push(a.Ey.Dollhouse);const o=e.tryGetProperty("fp",1)>0,r=e.tryGetProperty(n.gx.FloorPlan,!0);return o&&r&&t.push(a.Ey.Floorplan),t}}},72386:(e,t,i)=>{"use strict";i.d(t,{d:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload={members:e}}}},33843:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UserData:()=>l,UserInfo:()=>r,default:()=>u});var s=i(54122),n=i(19413),o=i(71229);class r{constructor(e){this.id="",this.name="",this.initials="",this.color="",this.known=!1,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.name=e.name,this.initials=e.initials,this.color=e.color,this.known=e.known,this}}var a=i(80807);class l extends n.V{constructor(e){super(),this.config=e,this.name="users-data",this.users=(0,o.q)()}getFullName(e,t){return e&&t?`${e} ${t}`:e||t}getInitials(e){const t=e?e.split(" ").map((e=>e[0])).join(""):"?";return t.length<3?t:`${t[0]}${t[t.length-1]}`}load(e){const t=e.id?this.getFullName(e.firstName,e.lastName):"",i=this.getInitials(t),s={id:e.id,name:t||"No Name",initials:i,color:(0,a._)(e.id),known:!0};this.addUser((new r).copy(s))}get collection(){return this.users}iterate(e){for(const t of this.users)e(t)}clone(){return new l(this.config).copy(this)}copy(e){return l.copyUserCollection(this,e),this}static copyUserCollection(e,t){const i=t.users;for(const t of i)e.addUser(t)}addUser(e){this.users.has(e.id)?this.users.get(e.id).copy(e):this.users.set(e.id,e)}getUserInfo(e){return this.users.has(e)?this.users.get(e):null}collectUsersInfo(e,t){const i=[];return e.forEach((e=>{this.users.has(e)||i.push(this.loadOrganizationMember(e,t))})),Promise.all(i)}async loadOrganizationMember(e,t){if(!e||!t)return;const i=`${this.config.baseUrl}/api/v2/organizations/${t}/members/${e}`;return this.config.queue.get(i,{responseType:"json"}).then((t=>{this.load({id:e,firstName:t.first_name,lastName:t.last_name,email:t.email})})).catch((t=>{this.addUser((new r).copy((0,a.Q)(e)))}))}}var c=i(72386),h=i(55580);class d extends s.Y{constructor(){super(...arguments),this.name="users-module",this.editor=!1,this.loadUsers=async e=>{this.organizationId&&await this.userData.collectUsersInfo(e.members,this.organizationId)}}async init(e,t){const i=await t.market.waitForData(h.T);this.organizationId=i.model.organizationId,this.userData=new l(e);const s=e.api.user;let n;s.loggedIn&&s.id&&(this.userData.load({id:s.id,firstName:s.firstName,lastName:s.lastName,email:s.email}),n=this.userData.getUserInfo(s.id),this.editor=i.model.editable),this.currentUser=n||(0,a.Q)(""),t.market.register(this,l,this.userData),t.commandBinder.addBinding(c.d,this.loadUsers)}getUsers(){const e=[];return this.userData.iterate((t=>{t.known&&e.push(t)})),e}getCurrentUserInfo(){return this.currentUser}isLoggedIn(){return!!this.currentUser.id}isEditor(){return this.editor}getCurrentUserId(){return this.currentUser.id}getUserInfo(e){return this.userData.getUserInfo(e)}}const u=d},80807:(e,t,i)=>{"use strict";i.d(t,{_:()=>o,Q:()=>r});var s=i(67125);const n=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];function o(e){const t=n.length;return n[(0,s.W)(e||"",t)]}function r(e){return{id:e,name:"Unknown User",initials:"?",color:o(e),known:!1}}},8473:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var s=i(25799),n=i(54122),o=i(19417),r=i(30853),a=i(53339),l=i(50101),c=i(21265),h=i(24779);class d{constructor(){this._dateNow=Date.now,this._performanceNow=performance.now,this.nowOverride=0}slowTime(e){this.fps=e,this.nowOverride=Date.now(),Date.now=()=>this.nowOverride,performance.now=()=>this.nowOverride}tick(){this.nowOverride+=1e3/this.fps}resetTime(){Date.now=this._dateNow,performance.now=this._performanceNow}}var u=i(88069),p=i(28247);const m=new s.Z("video-recorder");var g;!function(e){e[e.STOPPED=0]="STOPPED",e[e.RECORDING=1]="RECORDING"}(g||(g={}));class f extends n.Y{constructor(){super(...arguments),this.name="video-recorder-module",this.state=g.STOPPED,this.frostMage=new d}async init(e,t){this.settingsModule=await t.getModule(r.default),this.webglRenderer=await t.getModule(l.default),this.engine=t,this.settingsModule.registerButton("Tour Recorder (Chrome Only)","Download 1080p @ 60",(()=>{this.state===g.STOPPED&&this.record(1920,1080,60)})),this.settingsModule.registerButton("Tour Recorder (Chrome Only)","Download 720p @ 30",(()=>{this.state===g.STOPPED&&this.record(1280,720,30)})),this.settingsModule.registerButton("Tour Recorder (Chrome Only)","Download instagram",(()=>{this.state===g.STOPPED&&this.record(1080,1080,30)})),this.settingsModule.registerButton("Tour Recorder (Chrome Only)","Download instagram story",(()=>{this.state===g.STOPPED&&this.record(1080,1920,30)})),this.settingsModule.registerButton("Tour Recorder (Chrome Only)","Stop & download current",(()=>{this.state===g.RECORDING&&this.stop()}))}async record(e,t,s){if(this.state!==g.STOPPED)return void m.warn("Can't start recording... we're already recording!");m.info("Starting recording of tour. Now is a good time to get a coffee :)"),this.state=g.RECORDING;const n=await Promise.all([i.e(764),i.e(985),i.e(718)]).then(i.bind(i,64875));this.encoder=new n.WebMWriter({quality:.95,frameRate:s}),this.frostMage.slowTime(s),await this.engine.commandBinder.issueCommand(new h.M({resizeDimensions:[{property:h.P.width,setDimension:e,duration:0},{property:h.P.height,setDimension:t,duration:0}]})),await this.engine.commandBinder.issueCommand(new o.TH);const r=this.engine.subscribe(a.NR,(()=>{r.cancel(),this.state===g.RECORDING&&this.stop()})),l=this,c=l.webglRenderer.cwfRenderer.renderer.getContext().canvas;this.engine.startGenerator((function*(){for(;l.state===g.RECORDING;)l.encoder.addFrame(c),yield new p.Jj,l.frostMage.tick(),yield new p.Jj}))}async stop(){if(this.state!==g.RECORDING)return void m.warn("Can't stop recording, we weren't recording at all");this.frostMage.resetTime(),this.state=g.STOPPED,await this.engine.commandBinder.issueCommand(new h.M((0,u.lb)(0))),m.info("Encoding tour to video...");const e=await this.encoder.complete();m.info("Tour encoded! Prompting user to download."),(0,c.Hx)(e,"tour.webm")}}},72942:(e,t,i)=>{"use strict";i.d(t,{BD:()=>s,g:()=>a,KP:()=>l,ty:()=>c,_i:()=>h});var s,n=i(99681),o=i(71208),r=i(47924);!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(s||(s={}));const a=s.INSIDE,l=(s.INSIDE,o.Ey.Panorama,s.DOLLHOUSE,o.Ey.Dollhouse,s.FLOORPLAN,o.Ey.Floorplan,s.TRANSITIONING,o.Ey.Transition,s.OUTSIDE,o.Ey.Outdoor,{[o.Ey.Panorama]:s.INSIDE,[o.Ey.Dollhouse]:s.DOLLHOUSE,[o.Ey.Floorplan]:s.FLOORPLAN,[o.Ey.Transition]:s.TRANSITIONING,[o.Ey.Outdoor]:s.OUTSIDE}),c=e=>{const t=l[e];return void 0!==t?t:s.OUTSIDE};class h extends n.m{constructor(e,t=r.n.Interpolate,i={}){super(),this.payload={mode:e,transitionType:t,pose:i}}}h.id="CHANGE_VIEWMODE"},43339:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var s=i(62431),n=i(54122),o=i(72942),r=i(71144),a=i(39936),l=i(71208),c=i(47924),h=i(85197),d=i(27829),u=i(2212),p=i(91055),m=i(77956),g=i(89155),f=i(55525),v=i(29675),y=i(3471),b=i(12775),w=i(37018),S=i(22729);class T extends n.Y{constructor(){super(...arguments),this.name="viewmode-change"}async init(e,t){this.engine=t,this.viewmodesModule=await t.getModule(r.default),this.settings=await t.market.waitForData(a.e),this.engine.market.waitForData(v.pu).then((e=>this.setEnabledModes(e.application))),this.bindings.push(t.subscribe(y.bS,(e=>this.setEnabledModes(e.application))),t.commandBinder.addBinding(o._i,this.onChangeViewmodeCommand.bind(this)))}async setEnabledModes(e){if(e===v.Mx.SHOWCASE){if(this.dhDisabled=()=>this.settings.checkUrlParam("dh",0,1)||!this.settings.tryGetProperty(s.gx.Dollhouse,!1),this.fpDisabled=()=>this.settings.checkUrlParam("fp",0,1)||!this.settings.tryGetProperty(s.gx.FloorPlan,!1),!this.previousApp)return;const e=(await this.engine.market.waitForData(b.O)).currentMode;if(e===l.Ey.Dollhouse&&this.dhDisabled()||e===l.Ey.Floorplan&&this.fpDisabled()){const e=(await this.engine.market.waitForData(w.O)).pose;if(e&&e.mode===l.Ey.Panorama)this.goToInsideMode(c.n.Interpolate,{position:e.camera.position});else{const e=(await this.engine.market.waitForData(g.M_)).pose,t=(await this.engine.market.waitForData(m.Z)).getClosestSweep(e.position,!0),i=t?{position:t.position}:void 0;this.goToInsideMode(c.n.Interpolate,i)}}}else e===v.Mx.WORKSHOP&&(this.dhDisabled=()=>!1,this.fpDisabled=()=>!1);this.previousApp=e}async onChangeViewmodeCommand(e){switch(e.mode){case o.BD.INSIDE:return this.goToInsideMode(e.transitionType,e.pose);case o.BD.DOLLHOUSE:return this.goToDollhouse(e.transitionType,e.pose);case o.BD.FLOORPLAN:return this.goToFloorplan(e.transitionType,e.pose)}return Promise.reject(`viewmode-change => Could not move to ${e.mode}`)}async goToInsideMode(e=c.n.Interpolate,t={}){const i=this.engine.market.tryGetData(m.Z);if(!i)return Promise.reject("Cannot go to inside mode");let s=t.sweepID||i.currentSweep;return s||(s=await this.getLookAtSweep(i)),i.isSweepUnaligned(s)&&(s=(i.getFirstAlignedSweep()||i.getFirstSweep()).id),this.viewmodesModule.currentMode===l.Ey.Panorama&&i.isSweepUnaligned(i.currentSweep)?this.engine.commandBinder.issueCommand(new f.ju({sweep:s,rotation:t.rotation,transition:c.n.FadeToBlack})):this.viewmodesModule.switchToMode(l.Ey.Panorama,e,{sweepID:s,rotation:t.rotation},r.DEFAULT_TRANSITION_TIME)}async getLookAtSweep(e){const t=this.engine.market.tryGetData(g.M_);if(!t)return e.getFirstSweep().id;const i=this.getCurrentFloorHeight(),s=new u.JOQ(d.f.DOWN,i),n=(0,p.Fe)(t.pose.position,t.pose.rotation,s);if(!n)return e.getFirstSweep().id;let o=e.getClosestSweep(n,!0);return o||(o=e.getFirstSweep()),o.id}getCurrentFloorHeight(){if(!this.floorsViewData)try{this.floorsViewData=this.engine.market.tryGetData(S.c)}catch(e){return this.getModelMinHeight()}if(!this.floorsViewData)throw Error("Could not get floors viewdata");return this.floorsViewData.getFloorMin()}getModelMinHeight(){if(!this.modelMeshModule)try{this.modelMeshModule=this.engine.getModuleSync(h.default)}catch(e){return 0}return this.modelMeshModule.mesh.boundingBox.min.y}async goToDollhouse(e=c.n.Interpolate,t={}){return this.dhDisabled()?Promise.reject("Cannot go to dollhouse mode"):this.viewmodesModule.switchToMode(l.Ey.Dollhouse,e,t)}async goToFloorplan(e=c.n.Interpolate,t={}){return this.fpDisabled()?Promise.reject("Cannot go to floorplan mode"):this.viewmodesModule.switchToMode(l.Ey.Floorplan,e,t)}}},48840:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(13402);class n extends s.a{}},39869:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(13402);class n extends s.a{}},13402:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var s=i(93528);class n extends s.v{constructor(e,t){super(),this.fromMode=t,this.toMode=e,this.timestamp=Date.now()}}},71208:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>s,tU:()=>a,Lm:()=>r});var s,n=i(17617);class o extends n.y{constructor(e,t){super(e),this.mode=t}}!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Transition=-1]="Transition"}(s||(s={}));const r=e=>{switch(e){case"0":case 0:return s.Panorama;case"1":case 1:return s.Floorplan;case"2":case 2:return s.Dollhouse;case"3":case 3:return s.Transition}throw new o("No known conversion for Workshop int to viewmode for int: "+e,e)};function a(e){switch(e){case s.Panorama:return 0;case s.Floorplan:return 1;case s.Dollhouse:return 2;case s.Transition:return 3}throw new o("No known conversion for Viewmode to Workshop int",e)}},19039:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});var s=i(17617);class n extends s.y{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}},12775:(e,t,i)=>{"use strict";i.d(t,{O:()=>r});var s=i(19413),n=i(71208),o=i(5442);class r extends s.V{constructor(){super(),this.name="viewmode",this.currentModeObservable=(0,o.Y)(null),this.transition={active:!1,progress:0,from:null,to:null,startTime:0,transitionTime:0},this.isFloorplan=this.isFloorplan.bind(this),this.isPano=this.isPano.bind(this),this.isDollhouse=this.isDollhouse.bind(this)}get currentMode(){return this.currentModeObservable.value}set currentMode(e){e!==this.currentModeObservable.value&&(this.currentModeObservable.value=e)}get closestMode(){return this.currentMode===n.Ey.Transition?this.transition.progress<.5?this.transition.from:this.transition.to:this.currentMode}makeModeChangeSubscription(e){return this.currentModeObservable.onChanged(e)}copyTransition(e){this.transition.active=e.active,this.transition.progress=e.progress,this.transition.from=e.from,this.transition.to=e.to,this.transition.startTime=e.startTime,this.transition.transitionTime=e.transitionTime}activateTransition(e,t,i){this.transition.active=!0,this.transition.progress=0,this.transition.startTime=Date.now(),this.transition.transitionTime=i,this.transition.to=t,this.transition.from=e}deactivateTransition(){this.transition.active=!1}clone(){const e=new r;return e.copy(this),e}copy(e){this.currentMode=e.currentMode,this.copyTransition(e.transition)}isPano(){return this.currentMode===n.Ey.Panorama}isFloorplan(){return this.currentMode===n.Ey.Floorplan}isDollhouse(){return this.currentMode===n.Ey.Dollhouse}canStartTransition(){const e=this.transition.active,t=this.currentMode===n.Ey.Transition;return!e&&!t}transitionActive(){return!this.canStartTransition()}isAlreadyInMode(e){const t=this.transition.from===this.transition.to,i=this.currentMode===e;return this.transition.active&&t||i}canSwitchViewMode(e){return this.canStartTransition()&&!this.isAlreadyInMode(e)}}},71144:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_TRANSITION_TIME:()=>A,default:()=>C});var s=i(71208),n=i(47924),o=i(2212),r=i(27829),a=i(64279),l=i(54122),c=i(85197),h=i(12775),d=i(89895),u=i(89155),p=i(94210),m=i(77956),g=i(39869),f=i(48840),v=i(13402),y=i(19039),b=i(91055),w=i(99169),S=i(56040),T=i(1799);const E={rotationDuration:1,rotationDelay:0,matrixDelay:0,matrixDuration:.5},_={[s.Ey.Dollhouse]:{matrixDelay:.5,matrixDuration:1},[s.Ey.Panorama]:{rotationDuration:.5}};var x=i(25799),M=i(27871);const P=new x.Z("viewmodes-data"),A=1e3,O=Math.PI/2+Number.EPSILON,D=Math.PI-Number.EPSILON,I={[s.Ey.Panorama]:A,[s.Ey.Dollhouse]:A,[s.Ey.Floorplan]:A};class C extends l.Y{constructor(){super(...arguments),this.viewmodeData=new h.O,this.name="viewmode",this.minDollhouseDistance=15,this.maxDollhouseDistance=50,this.getFlyinStartPose=(e,t)=>{const i=t||this.cameraData.pose.position,s=e.position.y-i.y,n=(0,b.Ll)(e.position,i,this.meshData.center),o=r.f.FORWARD.clone().applyQuaternion(n);return{position:(0,b.D7)(e.position,i,Math.sign(o.y)*Math.PI/4,!0).setY(1.5*s)}},this.getFlyinEndPose=e=>{const t=e.position||this.sweepData.getSweep(e.sweepID).position,i=e.rotation||new o._fP,s=Math.PI/180*a.oR.fov;return(0,b.YN)(t,i,-Math.PI/6,this.meshData.bounds,s,this.canvas.aspectRatio)}}async init(e,t){this.engine=t,this.market=t.market,null!==e.startingMode&&(this.viewmodeData.currentMode=e.startingMode),this.market.register(this,h.O,this.viewmodeData),t.market.waitForData(M._).then((e=>{this.meshData=e,this.setDollhouseBounds()}));const[i,s,n,o,r]=await Promise.all([t.getModule(d.default),t.getModule(p.default),t.market.waitForData(m.Z),t.market.waitForData(w.W),t.market.waitForData(u.M_)]);this.cameraModule=i,this.sweepModule=s,this.sweepData=n,this.canvas=o,this.cameraData=r}get currentMode(){return this.viewmodeData.currentMode}async switchToMode(e,t=n.n.FadeToBlack,i,o){if(P.info(`switchToMode mode:${e} type:${t}`),this.meshData||e!==s.Ey.Floorplan&&e!==s.Ey.Dollhouse||await this.engine.getModule(c.default),t===n.n.Instant&&(o=0),o=void 0!==o?o:I[e],!this.viewmodeData.canStartTransition()||!this.cameraData.canTransition())throw new y.D;const r=this.isAlreadyInMode(this.viewmodeData,e),a=i&&!C.willPoseChange(this.cameraData,i);if(r&&a)return Promise.resolve();this.sweepData.currentSweep&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&e!==s.Ey.Panorama&&(t=n.n.FadeToBlack);const l=null!==this.viewmodeData.currentMode?this.viewmodeData.currentMode:void 0;this.viewmodeData.activateTransition(this.viewmodeData.currentMode,e,o),this.viewmodeData.currentMode=s.Ey.Transition,this.viewmodeData.commit(),this.engine.broadcast(new f.Z(e,l));const h=this.moveCameraToViewmode(e,l,t,o,i);let d=!1;return h.progress((t=>{this.viewmodeData.transition.progress=t,this.viewmodeData.commit(),t>=.5&&!d&&(d=!0,this.engine.broadcast(new v.a(e,l)))})),h.then((()=>{this.viewmodeData.transition.progress=1,this.viewmodeData.currentMode=e,this.viewmodeData.deactivateTransition(),this.viewmodeData.commit(),this.engine.broadcast(new g.Z(e,l))})),h.nativePromise()}isAlreadyInMode(e,t){const i=e.transition.from===e.transition.to,s=e.currentMode===t;return e.transition.active&&i||s}static willPoseChange(e,t){return void 0!==t.position&&!e.pose.position.equals(t.position)||void 0!==t.rotation&&!e.pose.rotation.equals(t.rotation)||void 0!==t.zoom&&e.zoom()!==t.zoom}moveCameraToViewmode(e,t,i,n,o){switch(e){case s.Ey.Panorama:return this.moveCameraToPanorama(i,n,o);case s.Ey.Dollhouse:return this.moveCameraToDollhouse(t,i,n,o);case s.Ey.Floorplan:return this.moveCameraToFloorplan(t,i,n,o);default:throw Error(`moveCameraToViewmode(): Invalid view-mode to go to: ${e}`)}}moveCameraToPanorama(e,t,i){if(this.sweepData.canTransition()||this.cameraData.canTransition()){let a;if(i&&i.sweepID)a=i.sweepID;else{const e=this.sweepData.getFirstSweep();a=this.sweepData.currentSweep,!a&&e&&(a=e.id)}if(!a)throw new Error("moveCameraToPanorama(): Invalid target sweep!");this.sweepData.isSweepUnaligned(a)&&(e=n.n.FadeToBlack);let l=i&&i.rotation?i.rotation:void 0;if(!l){const e=(this.viewmodeData.transition.from===s.Ey.Floorplan?r.f.UP:r.f.FORWARD).clone().applyQuaternion(this.cameraData.pose.rotation).setY(0).normalize();l=(new o._fP).setFromUnitVectors(r.f.FORWARD,e)}return this.sweepModule.moveToSweep({transitionType:e,sweepId:a,rotation:l,transitionTime:t,rotationDelay:.5})}throw new Error("Could not move to panorama mode because another transition was active")}moveCameraToDollhouse(e,t,i,n){const l=this.meshData.bounds,c={};let h;if(n&&(n.position||n.rotation)){if(n.position&&n.rotation){c.position=n.position,c.rotation=n.rotation;const e=new o.JOQ(r.f.UP.clone(),this.meshData.center.y);let t=(0,b.Fe)(c.position,c.rotation,e);t||(t=new o.Pa4,t.copy(this.meshData.center)),l.containsPoint(t)&&(h=c.position.distanceTo(t))}else if(n.position)c.position=n.position,c.rotation=(0,b.n0)(n.position,this.meshData.center);else{c.rotation=n.rotation;const e=l.min.distanceTo(l.max);c.position=(0,b.fd)(c.rotation,this.meshData.center,e)}h||(h=this.meshData.center.clone().distanceTo(c.position))}else{let e,t;const i=this.sweepData.isSweepUnaligned(this.sweepData.currentSweep),n=i||this.viewmodeData.transition.from===s.Ey.Floorplan?this.meshData.center:this.cameraData.pose.position;if(i)t=new o.Pa4(0,0,0),e=new o.Pa4(15,10,15);else if(this.viewmodeData.transition.from!==s.Ey.Floorplan){const i=1.5,s=(0,b.YN)(this.cameraData.pose.position,this.cameraData.pose.rotation,-Math.PI/6,this.meshData.bounds,this.cameraData.fovY()*i,this.cameraData.pose.aspect()),a=((e,t)=>{const i=e.clone().add(new o.Pa4(0,6,0)),s=r.f.FORWARD.clone().applyQuaternion(t);return s.y>=.01&&(s.y=.01),{position:i.clone().add(s.clone().multiplyScalar(-10)),direction:s}})(n,this.cameraData.pose.rotation);[e,t]=[s.position,a.direction]}else{const i=((e,t)=>{const i=e.clone(),s=r.f.DOWN.clone().applyQuaternion(t).multiplyScalar(6),n=i.clone().add(s).setY(6),o=r.f.UP.clone().applyQuaternion(t);return o.setY(-.5).normalize(),{position:n,direction:o}})(n,this.cameraData.pose.rotation);[e,t]=[i.position,i.direction]}const a=n.clone().add(t).setY(this.meshData.center.y);c.position=(0,b.r0)(e,a,this.minDollhouseDistance,this.maxDollhouseDistance),c.position=(0,b.m$)(c.position,a,O,D),c.rotation=(0,b.n0)(c.position,a),h=a.distanceTo(c.position)}return this.cameraModule.moveTo({transitionType:t,pose:c,transitionTime:i,projection:(0,a.AN)(this.cameraData.aspect()),focalDistance:h,rotationDuration:.5})}setDollhouseBounds(){const e=this.meshData.bounds,t=e.min.distanceTo(e.max);this.minDollhouseDistance=Math.min(t/2,this.minDollhouseDistance),this.maxDollhouseDistance=Math.max(t,this.maxDollhouseDistance)}moveCameraToFloorplan(e,t,i,s){const n={},l=this.meshData.center,c=this.meshData.size,h=Math.max(c.x,c.z),d=Math.min(c.x,c.z),u=this.canvas.aspectRatio,p=Math.max(h,d/u),m=Math.max(d,h/u),g=u<1?p:m,f=this.canvas.height/(1.2*g),v=s&&s.zoom?this.canvas.height/(2*s.zoom):f,y=(0,a.aH)(this.canvas.width,this.canvas.height,v),b=(0,a.aH)(this.canvas.width,this.canvas.height,f);if(this.cameraModule.setBaseProjection(b),s&&s.position)n.position=s.position;else{const e=r.f.UP.clone().multiplyScalar(h);n.position=l.clone().add(e)}if(s&&s.rotation)n.rotation=s.rotation;else{const e=(new S.M).setPosition(n.position);if(e.lookAt(n.position,l,r.f.FORWARD),n.rotation=(new o._fP).setFromRotationMatrix(e.asThreeMatrix4()),u<1!=c.x/c.z<1){const e=(new o._fP).setFromUnitVectors(r.f.UP,r.f.LEFT);n.rotation.multiply(e)}}let w=Object.assign(Object.assign({},E),{easing:T.hl,transitionType:t,pose:n,transitionTime:i,projection:y});return e&&e in _&&(w=Object.assign(Object.assign({},_[e]),w)),this.cameraModule.moveTo(w)}}},44693:(e,t,i)=>{"use strict";function s(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}function n(e){return/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer)}i.d(t,{t:()=>s,W:()=>n})},60303:(e,t,i)=>{"use strict";i.d(t,{a:()=>s,Z:()=>l});var s,n=i(2212),o=i(64279),r=i(2779);class a extends n.Tme{constructor(e){super(),this.anchor=this,this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new n.cPb(o.oR.fov,e,o.oR.near,o.oR.far),this.add(this.camera),this.camera.layers.mask=r.o.ALL.mask,this.name="CameraRig"}dispose(){this.remove(this.camera)}}!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(s||(s={}));class l{constructor(e,t,i,o){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.useEffectComposer=o,this.ids=s,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new n.FM8;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(e),this.composer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})()}add(...e){for(const t of e)this.addChild(s.Root,t)}remove(...e){for(const t of e)this.removeChild(s.Root,t)}addChild(e,t){switch(e){case s.Root:this.scene.add(t);break;case s.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case s.Root:this.scene.remove(t);break;case s.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.cameraRig=new a(this.cameraData.aspect()),this.useEffectComposer&&Promise.all([i.e(525).then(i.bind(i,90446)),i.e(525).then(i.bind(i,86426))]).then((([e,t])=>{this.composer=new e.EffectComposer(this.threeRenderer),this.composer.addPass(new t.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback)}deactivate(e){this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback)}beforeRender(){this.updateCameraRig(),this.updateComposer()}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){this.rendering&&(this.composer?this.composer.render(e):(this.threeRenderer.clear(),this.threeRenderer.render(this.scene,this.cameraRig.camera)))}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.canvasSizeChanged=!0}}},24550:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.payload=Object.assign({},e)}}},93220:(e,t,i)=>{"use strict";i.d(t,{vx:()=>n,Rg:()=>o,Gw:()=>r});var s=i(17617);class n extends s.y{constructor(e){super(e)}}class o extends s.y{constructor(e){super(e)}}class r extends s.y{constructor(e){super(e)}}},50101:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>L,default:()=>N});var s=i(54122),n=i(99169),o=i(60303),r=i(2212),a=i(13441),l=i(81047),c=i(48101);const h={basicTextured:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(82334)),fragmentShader:(0,c.m)(a,i(52857))},screenSpaceColored:{uniforms:{color:{type:"v3",value:new r.Pa4(0,0,0)},opacity:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(41334)),fragmentShader:(0,c.m)(a,i(46846))}};var d=i(93220),u=i(44693),p=i(64630);const m=(e,t)=>{switch(e){case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}},g=(e,t)=>{const i=t.extensions,s=t.getContext();let n;switch(e){case r.rpg:return s.REPEAT;case r.uWy:return s.CLAMP_TO_EDGE;case r.OoA:return s.MIRRORED_REPEAT;case r.TyD:return s.NEAREST;case r.HTd:return s.NEAREST_MIPMAP_NEAREST;case r.vZf:return s.NEAREST_MIPMAP_LINEAR;case r.wem:return s.LINEAR;case r.lRj:return s.LINEAR_MIPMAP_NEAREST;case r.FDw:return s.LINEAR_MIPMAP_LINEAR;case r.ywz:return s.UNSIGNED_BYTE;case r.k0A:return s.UNSIGNED_SHORT_4_4_4_4;case r.irR:return s.UNSIGNED_SHORT_5_5_5_1;case r.XNv:return s.UNSIGNED_SHORT_5_6_5;case r.T95:return s.BYTE;case r.iAb:return s.SHORT;case r.LsT:return s.UNSIGNED_SHORT;case r.Kz5:return s.INT;case r.JQ4:return s.UNSIGNED_INT;case r.VzW:return s.FLOAT}switch(e){case r.OTo:return s.ALPHA;case r.UCm:return s.RGB;case r.wk1:return s.RGBA;case r.Y8D:return s.LUMINANCE;case r.cRx:return s.LUMINANCE_ALPHA;case r.bGH:return s.FUNC_ADD;case r.Wbm:return s.FUNC_SUBTRACT;case r.rOj:return s.FUNC_REVERSE_SUBTRACT;case r.c8b:return s.ZERO;case r.ghN:return s.ONE;case r.KhW:return s.SRC_COLOR;case r.iWC:return s.ONE_MINUS_SRC_COLOR;case r.k74:return s.SRC_ALPHA;case r.LgZ:return s.ONE_MINUS_SRC_ALPHA;case r.fSK:return s.DST_ALPHA;case r.Hy8:return s.ONE_MINUS_DST_ALPHA;case r.Vdb:return s.DST_COLOR;case r.Wpd:return s.ONE_MINUS_DST_COLOR;case r.RlZ:return s.SRC_ALPHA_SATURATE}if(e===r.cLu){if(t.capabilities.isWebGL2)return s.HALF_FLOAT;if(n=i.get("OES_texture_half_float"),null!==n)return n.HALF_FLOAT_OES}if(n=i.get("WEBGL_compressed_texture_s3tc"),null!==n){if(e===r.wuA)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===r.BFQ)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===r.v3W)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===r.ILR)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n=i.get("WEBGL_compressed_texture_pvrtc"),null!==n){if(e===r._AM)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===r.vCx)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===r.eaV)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===r.CaW)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n=i.get("WEBGL_compressed_texture_etc1"),null!==n&&e===r.fto)return n.COMPRESSED_RGB_ETC1_WEBGL;if(n=i.get("EXT_blend_minmax"),null!==n){if(e===r.r_)return n.MIN_EXT;if(e===r.Sm8)return n.MAX_EXT}if(e===r.wJv){if(t.capabilities.isWebGL2)return s.UNSIGNED_INT_24_8;if(n=i.get("WEBGL_depth_texture"),null!==n)return n.UNSIGNED_INT_24_8_WEBGL}return 0},f={copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(51799)),fragmentShader:(0,c.m)(a,i(92566))}};var v=i(97982);const y={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};class b{constructor(e){this.threeRenderer=e,this.cachedSize=new r.FM8,this.renderToCubeMap=(()=>{let e,t,i,s,n,o=!1;const a=.5;return(l,c,d,u,p,m,g,f,v,y,b,w,S,T,E,_)=>{o||(t=new r.iKG(-.5,a,a,-.5,-200,200),t.position.z=150,e=new r.xsS,e.name="rttCube",e.add(t),i=new r.FIo({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:h.basicTextured.vertexShader,fragmentShader:h.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:r.ehD}),s=new r.BKK(1,1),n=new r.Kj0(s,i),n.position.z=0,e.add(n),o=!0);const x=s.getAttribute("uv");x.setUsage(r.dj0),x.needsUpdate=!0;const M=x.array,P=p/d,A=m/u,O=g/d,D=f/u;M[0]=P,M[1]=A+D,M[2]=P+O,M[3]=A+D,M[4]=P,M[5]=A,M[6]=P+O,M[7]=A;const I=s.getAttribute("position");I.setUsage(r.dj0),I.needsUpdate=!0;const C=I.array,R=v/c.width-a,L=y/c.height-a,N=b/c.width,k=w/c.height;C[0]=R,C[1]=L+k,C[3]=R+N,C[4]=L+k,C[6]=R,C[7]=L,C[9]=R+N,C[10]=L,i.uniforms.tDiffuse.value=l,i.blending=T||r.jFi,i.transparent=!!E,null==_&&(_=1),i.uniforms.alpha.value=_,i.needsUpdate=!0,c.viewport.set(0,0,c.width,c.height);const F=this.threeRenderer.getRenderTarget(),B=this.threeRenderer.autoClear,U=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(c,S),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(F),this.threeRenderer.autoClear=B,this.threeRenderer.xr.enabled=U}})(),this.copyCubemap=(()=>{let e,t,i,s,n,o=!1;const a=new r.USm,l=this;return(c,h,d,u,p)=>{if(!o){const a=2,l=a/2;t=new r.iKG(-l,l,l,-l,0,200),t.position.set(0,0,0),e=new r.xsS,e.name="copyCube",e.add(t),i=new r.FIo({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:f.copyCubeMap.vertexShader,fragmentShader:f.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:r.ehD}),s=new r.DvJ(a,a,a),n=new r.Kj0(s,i),e.add(n),o=!0}const g=l.threeRenderer.getRenderTarget(),v=l.threeRenderer.autoClear,y=l.threeRenderer.xr.enabled;l.threeRenderer.xr.enabled=!1,l.threeRenderer.autoClear=!1;for(let s=0;s<6;s++)m(s,a),n.rotation.copy(a),n.matrixWorldNeedsUpdate=!0,n.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=c,i.blending=d||r.jFi,i.transparent=!!u,null==p&&(p=1),i.uniforms.alpha.value=p,i.needsUpdate=!0,h.viewport.set(0,0,h.width,h.height),l.threeRenderer.setRenderTarget(h,s),l.threeRenderer.render(e,t);l.threeRenderer.setRenderTarget(g),l.threeRenderer.autoClear=v,l.threeRenderer.xr.enabled=y}})(),this.blurCubemap=(()=>{const e=e=>{const t=new r.oAp(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new r._am(.1,1e3,t)}};class t extends r.Kj0{}const i={512:e(512)},s=new r.xsS,n=new t(new r.DvJ(1,1,1));s.add(n);const o={};return(t,a,l=3,c=.005)=>{const h=a.renderTarget;i[h.width]||(i[h.width]=e(h.width)),n.material=function(e){if(!o[e]){const t=new r.FIo({uniforms:r.rDY.clone(v.Z.blurCube.uniforms),vertexShader:v.Z.blurCube.vertexShader,fragmentShader:v.Z.blurCube.fragmentShader,side:r._Li});t.defines={};const i=y[`${e}`];for(const[e,s]of i.entries())t.defines[`KERNEL_${e+1}`]=0===s||1===s?s.toFixed(1):s;o[e]=t}return o[e]}(l);const d=i[h.width];n.material.uniforms.map.value=t,n.material.uniforms.dir.value.set(c,0),d.cubeCamera.update(this.renderer,s),n.material.uniforms.map.value=d.renderTarget.texture,n.material.uniforms.dir.value.set(0,c),a.update(this.renderer,s)}})();try{const e=this.threeRenderer.getContext();this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=(0,u.t)(e)}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}}get renderer(){return this.threeRenderer}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){const i=this.threeRenderer.getContext(),s=this.threeRenderer.state;(t=t||new r.xEZ).addEventListener("dispose",(()=>i.deleteTexture(a.__webglTexture)));const n=g(t.format,this.threeRenderer),o=g(t.type,this.threeRenderer),a=this.threeRenderer.properties.get(t),l=i.createTexture();s.bindTexture(i.TEXTURE_2D,l),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.texImage2D(i.TEXTURE_2D,0,n,e,e,0,n,o,null);const c=g(t.wrapS,this.threeRenderer),h=g(t.wrapT,this.threeRenderer);return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer)),t.generateMipmaps&&i.generateMipmap(i.TEXTURE_2D),s.bindTexture(i.TEXTURE_2D,null),a.__webglTexture=l,t}initSizedCubeMap(e,t){const i=this.threeRenderer.getContext(),s=this.threeRenderer.state,n=new r.BtG([null,null,null,null,null,null]);n.flipY=!1,n.generateMipmaps=t;const o=g(n.format,this.threeRenderer),a=g(n.type,this.threeRenderer),l=this.threeRenderer.properties.get(n),c=i.createTexture();s.bindTexture(i.TEXTURE_CUBE_MAP,c),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n.flipY);for(let t=0;t<6;t++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o,e,e,0,o,a,null);return t?(n.magFilter=r.wem,n.minFilter=r.FDw,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.generateMipmap(i.TEXTURE_CUBE_MAP)):(n.magFilter=r.wem,n.minFilter=r.wem,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR)),s.bindTexture(i.TEXTURE_CUBE_MAP,null),l.__image__webglTextureCube=c,n}initRenderTargetCube(e){const t=new r.oAp(e,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}deallocateCubeTexture(e){const t=this.threeRenderer.getContext(),i=this.threeRenderer.properties.get(e);t.deleteTexture(i.__image__webglTextureCube)}uploadTexture2D(e,t,i,s){const n=this.threeRenderer.getContext(),o=this.threeRenderer.state,r=n.getParameter(n.TEXTURE_BINDING_2D),a=this.threeRenderer.properties.get(t);o.bindTexture(n.TEXTURE_2D,a.__webglTexture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,g(t.wrapS,this.threeRenderer)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,g(t.wrapT,this.threeRenderer)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer));const l=g(t.format,this.threeRenderer),c=g(t.type,this.threeRenderer);n.texSubImage2D(n.TEXTURE_2D,0,i,s,l,c,e),t.generateMipmaps&&n.generateMipmap(n.TEXTURE_2D),o.bindTexture(n.TEXTURE_2D,r)}fence(e){return new Promise((function(t,i){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===s)return i();e.flush();const n=()=>{switch(e.getSyncParameter(s,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(n,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(s),void t();default:return void setTimeout(n,0)}};setTimeout(n,0)}))}}var w=i(89155),S=i(80384),T=i(70785),E=i(44106),_=i(25799),x=i(20599);class M extends r.Kj0{constructor(e){super(new r.BKK(2,2,1,1),new r.FIo({uniforms:r.rDY.clone(h.screenSpaceColored.uniforms),vertexShader:h.screenSpaceColored.vertexShader,fragmentShader:h.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=new r.Ilk(e),this.renderOrder=x.z.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class P{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new M(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var A=i(75195),O=i(39936);class D{constructor(){this.stacks=new Map,this.texInfo=new Map}hookCalls(e){let t=1;const i=e.createTexture.bind(e);e.createTexture=()=>{const e=i();e.mpTexId=t++;const s=(new Error).stack;if(s){const t=this.stacks.get(s)||new Set;t.add(e.mpTexId),this.stacks.set(s,t)}return e};const s=e.deleteTexture.bind(e);e.deleteTexture=e=>{if(null!==e){const t=e.mpTexId;this.stacks.forEach((e=>e.delete(t))),this.texInfo.delete(t)}s(e)};const n=e.bindTexture.bind(e);let o;e.bindTexture=(...e)=>{const t=e[1];o=null!==t?t.mpTexId:null,n(...e)};const r=e.texImage2D.bind(e);e.texImage2D=(...e)=>{if(r(...e),o){const t=4;if(e.length>=7)this.texInfo.set(o,{width:e[3],height:e[4],size:e[8]?e[8].length:e[3]*e[4]*t});else{const i=e[5];i instanceof ImageData&&this.texInfo.set(o,{width:i.width,height:i.height,size:i.data.length}),(i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof HTMLCanvasElement||i instanceof ImageBitmap)&&this.texInfo.set(o,{width:i.width,height:i.height,size:i.width*i.height*t})}}}}dumpTextureInfo(){console.log(this.texInfo);const e=Array.from(this.texInfo.values()).reduce(((e,t)=>e+t.size),0)/1024;console.log(`Currently active textures: ${this.texInfo.size}, total allocated: ${e}k`);let t=0;this.stacks.forEach(((e,i)=>{const s=Array.from(e.values()),n=s.map((e=>this.texInfo.get(e))).reduce(((e,t)=>t?e+t.size:e),0)/1024;console.groupCollapsed(`Call site ${t}: ${s.length}, allocated: ${n}k`),console.log(i),s.forEach((e=>{const t=this.texInfo.get(e);t&&console.log(`width: ${t.width}, height: ${t.height}, size: ${t.size/1024}k`)})),console.groupEnd(),t++}))}}var I=i(30853),C=i(24550);const R=new _.Z("webgl-renderer"),L=3686400;class N extends s.Y{constructor(){super(...arguments),this.name="webgl-renderer",this.contextLostError=null,this.setContextLostError=e=>{this.contextLostError=e},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=L?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new d.vx("WebGL not supported");let i;this.canvas=e.canvas,this.engine=t;try{i=e.useWebGL2?new r.CP7({canvas:this.canvas,antialias:e.antialias,alpha:!0}):new r.b5g({canvas:this.canvas,antialias:e.antialias,alpha:!0}),i.autoClear=!1,i.xr.enabled=!0}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}this._cwfRenderer=new b(i),[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(w.M_),t.market.waitForData(O.e)]);const s=new r.xsS;s.name="main",this.scene=new o.Z(s,i,this.cameraData,e.useEffectComposer),t.addComponent(this,this.scene),t.addComponent(this,new P(this.scene,this.cameraData));const a=await t.market.waitForData(n.W);this.setSize(a.width,a.height),this.bindings.push(t.subscribe(S.a,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(C.b,(async e=>(0,A.q9)(this.cameraData,e.worldPosition).screenPosition))),e.trackTextureUsage&&(e.useWebGL2?R.error("Texture tracking for WebGL2 is not supported at the moment."):(this.textureTracker=new D,this.textureTracker.hookCalls(i.getContext()),(await t.getModule(I.default)).registerButton("Texture Usage","Dump to console",(()=>{this.textureTracker.dumpTextureInfo()})))),this.canvas.addEventListener("webglcontextlost",this.setContextLostError)}dispose(e){super.dispose(e),this.canvas.removeEventListener("webglcontextlost",this.setContextLostError)}onUpdate(e){if(this.contextLostError)throw new d.Rg(`WebGL context lost: ${this.contextLostError.statusMessage||"no status given"}`)}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get textureManager(){return this._cwfRenderer}get threeRenderer(){return this.cwfRenderer.renderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(T.A.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new E.V(this.cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this.cwfRenderer.getPixelRatio()&&(R.debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new E.V(i))),this.threeRenderer.xr.isPresenting&&R.error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setPixelRatio(i),this.threeRenderer.setSize(e,t,!1),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return!t.checkUrlParam("noInstancing",1,0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let s=!1;try{s=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:s,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}}},44106:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});var s=i(93528);class n extends s.v{constructor(e){super(),this.pixelRatio=e}}},35539:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});var s=i(99681);class n extends s.m{constructor(e){super(),this.id="XR_PRESENT",this.payload=Object.assign({},e)}}},79467:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>me});var s=i(25799),n=i(54122),o=i(53999),r=i(97620),a=i(2212),l=i(27829),c=i(32818),h=i(89895),d=i(89155),u=i(62513),p=i(24135),m=i(39936),g=i(50101),f=i(75195);const v=new a.Pa4(0,-100,0),y=new a.FM8(-2,-2),b=new a.Pa4(-1,-1,-1),w=new a.Pa4(1,1,1);class S{constructor(e){this.raycaster=e,this.lastHits=[],this.lastRay=new a.zHn(v,new a.Pa4(0,-1,0)),this.currentRay=new a.zHn,this.origin=v,this.direction=new a.Pa4,this.pointerNdc=y,this.cameraCache={position:new a.Pa4,quaternion:new a._fP,camera:void 0},this.cast=()=>{const e=this.currentRay;return this.lastRay.equals(e)||(this.lastHits=this.raycaster.cast(e.origin,e.direction).slice(),this.lastRay.copy(e)),this.lastHits},this.update3D=(e,t,i)=>{e instanceof a.Pa4&&this.origin.copy(e),t instanceof a.Pa4&&this.direction.copy(t),this.cameraCache.camera=i,this.currentRay.set(this.origin,this.direction)},this.updateNDCPosition=()=>{const e=this.lastHits[0];if(this.cameraCache.camera&&e&&e.point){const t=this.cameraCache.camera;this.cameraCache.position.setFromMatrixPosition(t.matrixWorld),this.cameraCache.quaternion.setFromRotationMatrix(t.matrixWorld);const i=(0,f.D_)(e.point,this.cameraCache.position,this.cameraCache.quaternion,t.projectionMatrix);i.clamp(b,w),this.pointerNdc.set(i.x,i.y)}},this.updatePointer=()=>{}}get pointerRay(){return this.currentRay}get ndcPosition(){return this.updateNDCPosition(),this.pointerNdc}}var T=i(93528);class E extends T.v{}class _ extends E{constructor(e){super(),this.trackedCamera=e}}class x extends E{}class M extends E{}var P,A=i(35539),O=i(59309),D=i(2779);!function(e){e[e.Mono=0]="Mono",e[e.Stereo=1]="Stereo",e[e.SixDof=2]="SixDof",e[e.__length=3]="__length"}(P||(P={}));const I={controllers:Object.freeze([0,1]),rotationDegrees:25};var C;!function(e){e[e.touchpadX=0]="touchpadX",e[e.touchpadY=1]="touchpadY",e[e.thumbstickX=2]="thumbstickX",e[e.thumbstickY=3]="thumbstickY"}(C||(C={}));const R={x:0,y:0,z:0,w:1};class L extends O.Y{constructor(e,t,i,s,n){super(),this.engine=e,this.renderer=t,this.webglScene=i,this.cameraData=s,this.cameraModule=n,this.trackingStyle=P.Mono,this.session=null,this.rotations={initialYawOffset:new a._fP,yawOffset:new a._fP,invYawOffset:new a._fP,trackingOffset:new a._fP},this.setTrackingStyle=e=>{e<P.__length&&(this.trackingStyle=e,this.resetInitialRotation())},this.offsetRotation=e=>{this.rotations.invYawOffset.multiply(e),this.rotations.yawOffset.copy(this.rotations.invYawOffset).invert()},this.onPresentStart=e=>{e.cameras[0].layers.mask=D.o.ALL.mask,e.cameras[1].layers.mask=D.o.ALL.mask,e.cameras[0].far=e.far,e.cameras[1].far=e.far,e.layers.mask=D.o.ALL.mask,this.resetInitialRotation(),this.broadcast(new x)},this.resetInitialRotation=()=>{const e=this.cameraData.pose.rotation.clone();(0,r.Rq)(e,this.rotations.initialYawOffset),this.rotations.yawOffset.copy(this.rotations.initialYawOffset),this.rotations.invYawOffset.copy(this.rotations.initialYawOffset).invert()},this.onPresentEnd=()=>{this.broadcast(new M)},this.applyTrackingOverrides=(e,t,i)=>{if(e.xr.isPresenting&&i instanceof a.HkE){e.clear();const t=i.cameras[0],s=i.cameras[1];if(this.frame=this.engine.getXrFrame(),this.session||(this.session=e.xr.getSession(),this.onPresentStart(i)),this.frame&&this.session){this.rotations.trackingOffset.copy(this.rotations.yawOffset).multiply(i.quaternion),this.cameraModule.updateCameraRotation(this.rotations.trackingOffset);const e=this.webglScene.camera.parent;if(e){const t=this.getReferenceSpace(this.frame,e);this.updateCameras(i,this.frame,t,e),this.updateControllers(this.session,this.frame,t,e)}switch(this.trackingStyle){case P.Mono:s.matrixWorld.copy(t.matrixWorld),s.matrixWorldInverse.copy(s.matrixWorld),s.matrixWorldInverse.invert()}this.broadcast(new _(t))}}else this.session&&(this.session=null,this.onPresentEnd())},this.getReferenceSpace=(e,t)=>{const i=this.renderer.xr.getReferenceSpace(),s=e.getViewerPose(i).views[0].transform.position,n=this.trackingStyle===P.SixDof?R:s,o=new XRRigidTransform({x:n.x-t.position.x,y:n.y-t.position.y,z:n.z-t.position.z}),r=i.getOffsetReferenceSpace(o),a=this.rotations.invYawOffset,l=this.cameraData.pose.position,c=new XRRigidTransform({x:l.x,y:l.y,z:l.z,w:1},{x:a.x,y:a.y,z:a.z,w:a.w});return r.getOffsetReferenceSpace(c)},this.updateCameras=(e,t,i,s)=>{const n=t.getViewerPose(i);if(n){const t=n.views;for(let i=0;i<t.length;i++){const n=t[i],o=e.cameras[i];o.matrix.fromArray(n.transform.matrix),o.projectionMatrix.fromArray(n.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix),o.projectionMatrixInverse.invert(),o.matrixWorld.multiplyMatrices(s.matrixWorld,o.matrix),o.matrixWorldInverse.copy(o.matrixWorld),o.matrixWorldInverse.invert(),o.matrix.decompose(o.position,o.quaternion,o.scale),0===i&&(e.matrix.copy(o.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorld.copy(o.matrixWorld),e.matrixWorldInverse.copy(o.matrixWorldInverse),e.projectionMatrix.copy(o.projectionMatrix),e.projectionMatrixInverse.copy(o.projectionMatrixInverse))}}},this.updateControllers=(e,t,i,s)=>{for(let n=0;n<2;n++){const o=this.renderer.xr.getController(n),r=this.renderer.xr.getControllerGrip(n),a=e.inputSources[n];let l=null,c=null;a&&(o&&(l=t.getPose(a.targetRaySpace,i),l&&(o.matrix.fromArray(l.transform.matrix),o.matrixWorld.multiplyMatrices(s.matrixWorld,o.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale)),o.visible=!!l),r&&a.gripSpace&&(c=t.getPose(a.gripSpace,i),c&&(r.matrix.fromArray(c.transform.matrix),r.matrixWorld.multiplyMatrices(s.matrixWorld,r.matrix),r.children.forEach((e=>{e.updateMatrixWorld()})),r.matrix.decompose(r.position,r.quaternion,r.scale)))),r&&(r.visible=!!c)}},this.webglScene.scene.onBeforeRender=this.applyTrackingOverrides}}var N=i(5442),k=i(83974),F=i(59120),B=i(74725),U=i(66272),H=i(85995),G=i(74958),V=i(77956),z=i(75711),j=i(12775),W=i(3834),Z=i(60778),q=i(33757);class K{constructor(){this.active=!1,this.target=new N.f(null),this.previousSweep=null,this.activate=()=>{this.active||(this.updateLoopSub.renew(),this.selectionChangeSub.renew(),this.ray.toggle(!0),this.targetDecoration.toggle(!0),this.active=!0)},this.deactivate=()=>{this.active&&(this.target.value=null,this.selectionChangeSub.cancel(),this.updateLoopSub.cancel(),this.ray.toggle(!1),this.targetDecoration.toggle(!1),this.active=!1)},this.getTargetSweep=(e,t,i)=>{let s=null;if(t.object instanceof G.YY)return s=e.getSweep(t.object.userData.sid),s;const n=(0,U.b)(e,!0,t.intersection);return s=n.length>0?n[0].sweep:null,s}}get container(){return this._container}async init(e){this.engine=e,this._container=new a.ZAu,this._container.name="XRNavigationVisuals",this.ray=new Y(this.container),this.targetDecoration=new $(this.container);const t=await this.engine.market.waitForData(p.P);return this.updateLoopSub=t.onChanged((()=>this.update(t))),this.updateLoopSub.cancel(),this.selectionChangeSub=this.target.onChanged((e=>{null!==this.previousSweep&&this.engine.commandBinder.issueCommand(new H.kR(this.previousSweep.id,!1,200)),null!==e&&(this.engine.commandBinder.issueCommand(new H.kR(e.id,!0,200)),this.targetDecoration.updateTargetPosition(e.floorPosition)),this.previousSweep=e})),this.selectionChangeSub.cancel(),this}update(e){const t=this.engine.market.tryGetData(V.Z),i=this.engine.market.tryGetData(d.M_),s=this.engine.market.tryGetData(j.O),n=this.engine.market.tryGetData(W.Y),o=this.engine.market.tryGetData(z.Z);if(!(t&&i&&s&&o&&n))return;if(!o.isVR())return;if(!s.isPano())return;const{hit:r,pointerDirection:a,pointerOrigin:l}=e;if(!r)return;const c=this.getTargetSweep(t,r,a);this.target.value=c,this.ray.update(l,r.point,n.opacity.value),this.targetDecoration.update(i.pose.rotation,n.opacity.value)}}class Y{constructor(e){this.container=e,this.styles={ray:{color:"white",transparent:!0,opacity:.3,linewidth:2,depthWrite:!1},hit:{color:"white",transparent:!0,opacity:.3},hitScale:.02},this.update=(e,t,i)=>{this.ray.updatePositions(e,t).opacity(Math.min(i,this.styles.ray.opacity)),this.hitMarker.position.copy(t),this.hitMarker.material.opacity=Math.min(i,this.styles.hit.opacity)},this.toggle=e=>{e?(this.container.add(...this.ray.children),this.container.add(this.hitMarker)):(this.container.remove(...this.ray.children),this.container.remove(this.hitMarker))};const{ray:t,hit:i}=this.styles,s=F.default.makeLineMaterial(t.color,!1,t);this.ray=new B.c(new a.Pa4,new a.Pa4,s,{}),this.ray.updateResolution(window.innerWidth,window.innerHeight),this.hitMarker=new k.E(new a.Aip(this.styles.hitScale),new a.vBJ(i)),this.hitMarker.name="hit"}}class ${constructor(e){this.container=e,this.styles={scale:.46,animationSpeed:1,plane:{color:"white",transparent:!0,opacity:.6,depthWrite:!1,depthTest:!1,map:(0,Z.p)(q)}},this.position=new a.Pa4,this.quaternion=new a._fP,this.updateTargetPosition=e=>{this.position.copy((0,r.Xv)(e,l.f.UP,.05))},this.update=(e,t)=>{const i=(0,r.Rq)(e,this.quaternion);this.target.quaternion.copy(i),this.target.position.lerp(this.position,this.styles.animationSpeed),this.target.material.opacity=Math.min(t,this.styles.plane.opacity)},this.toggle=e=>{e?this.container.add(this.target):this.container.remove(this.target)};const t=new a.BKK(1),i=new a.yGw;i.makeRotationFromEuler(new a.USm(-Math.PI/2,0,0,"XYZ")),t.applyMatrix4(i),this.target=new k.E(t,new a.vBJ(this.styles.plane)),this.target.name="Destination",this.target.scale.set(this.styles.scale,this.styles.scale,this.styles.scale)}}class Q{constructor(e){this.controllers=e,this._lastInputWas=0}focus(e){e!==this._lastInputWas&&(I.controllers.forEach((t=>{this.controllers.controller(t).grip.visible=t!==e})),this._lastInputWas=e)}}var X=i(57501);class J{constructor(e){this.renderer=e,this._defaultController=0,this.controllerGroups=[],this.bindings=[],this.cancel=()=>{this.bindings.forEach((e=>e.cancel())),this.bindings.length=0},this.container=new a.ZAu,this.container.name="XRControllerMesh",I.controllers.forEach((e=>{const t=this.createControllerGroup(e);this.controllerGroups.push(t),this.container.add(t.grip,t.pointer)})),this.connectControllerModel(),this.container.matrixAutoUpdate=!1}controller(e=this._defaultController){return this.controllerGroups[e]}setDefault(e){this._defaultController=e}async connectControllerModel(){const e=new((await i.e(376).then(i.bind(i,58956))).XRControllerModelFactory);I.controllers.forEach((t=>{const i=this.controller(t).grip;i.add(e.createControllerModel(i))}))}createControllerGroup(e){const t=this.renderer.xr.getController(e);t.name=`Controller Ray ${e}`;const i=this.renderer.xr.getControllerGrip(e);i.name=`Controller Grip ${e}`,i.visible=!1;const s={index:e,pointer:t,grip:i,connected:!1,hand:"none"},n=e=>{s.hand=e.data.handedness,s.connected=!0},o=()=>{s.hand="none",s.connected=!1};return this.bindings.push((0,X.k1)((()=>t.addEventListener("connected",n)),(()=>t.removeEventListener("connected",n))),(0,X.k1)((()=>t.addEventListener("disconnected",o)),(()=>t.removeEventListener("disconnected",o)))),s}}const ee=new s.Z("xr-input-forwarding");class te{constructor(e){this.options=e,this.dispatchPointerDown=e=>{this.forwardEvent("pointerdown",this.mockPointerEventInit(e))},this.dispatchPointerUp=e=>{this.forwardEvent("pointerup",this.mockPointerEventInit(e))},this.target=e.forwardToElement}dispatchPointerMove(e){this.forwardEvent("pointermove",this.mockPointerEventInit(e))}mockPointerEventInit(e){let t=0,i=0;if(this.options.getPointerScreenPosition){const e=this.options.getPointerScreenPosition();t=e.x,i=e.y}return{pointerType:"gamepad",pointerId:e,clientX:t,clientY:i}}forwardEvent(e,t){let i;try{i=window.PointerEvent?new PointerEvent(e,t):new MouseEvent(e,t),i&&this.target.dispatchEvent(i)}catch(e){ee.error(e)}}}class ie extends a.pBf{constructor(e,t){super(),this.renderer=e,this.options={forwardNativeXrEvents:!0,dispatchToControllerGroup:!1,axisMoveTriggerThreshold:.5},this.previousGamepad=new Map,this.forwardedEvents=["selectstart","select","selectend","squeeze","squeezestart","squeezeend"],this.active=!1,this.renew=()=>{!this.active&&this.options.forwardNativeXrEvents&&(this.addSessionListeners(),this.active=!0)},this.cancel=()=>{this.active&&this.options.forwardNativeXrEvents&&(this.removeSessionListeners(),this.active=!1)},this.updateFromGamepads=()=>{if(!this.active)return;const e=this.renderer.xr.getSession();if(e)for(const t of I.controllers){const i=e.inputSources[t];if(!i||!i.gamepad)continue;const s=this.renderer.xr.getController(t),n=this.previousGamepad.get(i),o={buttons:i.gamepad.buttons.map((e=>e.value)),axes:i.gamepad.axes.slice()},r={controllerIndex:t,inputSource:i,axes:o.axes};n&&(o.buttons.forEach(((e,t)=>{e!==n.buttons[t]&&(1===e?this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"buttondown",value:e,index:t})):0===e&&this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"buttonup",value:e,index:t})))})),o.axes.forEach(((e,t)=>{const i=n.axes[t];if(e!==i){this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"axesmove",value:e,index:t})),0===i&&this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"axesmovestart",value:e,index:t}));const n=this.options.axisMoveTriggerThreshold;Math.abs(i)<n&&Math.abs(e)>n&&this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"axestriggered",value:e,index:t})),0===e&&this.sendGamepadEvent(s,Object.assign(Object.assign({},r),{type:"axesmoveend",value:e,index:t}))}}))),this.previousGamepad.set(i,o)}},this.onGamepadEvent=(e,t)=>(0,X.k1)((()=>super.addEventListener(e,t)),(()=>super.removeEventListener(e,t))),this.onSessionEvent=(e,t)=>(0,X.k1)((()=>super.addEventListener(e,t)),(()=>super.removeEventListener(e,t))),this.sendGamepadEvent=(e,t)=>{this.dispatchEvent(t),this.options.dispatchToControllerGroup&&e.dispatchEvent(t)},this.sendSessionEvent=(e,t)=>{this.dispatchEvent({type:e,controllerIndex:t})},this.addSessionListeners=()=>{I.controllers.forEach((e=>{const t=this.renderer.xr.getController(e);for(const i of this.forwardedEvents)t.addEventListener(i,(t=>this.sendSessionEvent(t.type,e)))}))},this.removeSessionListeners=()=>{I.controllers.forEach((e=>{const t=this.renderer.xr.getController(e);for(const i of this.forwardedEvents)t.removeEventListener(i,(t=>this.sendSessionEvent(t.type,e)))}))},t&&(this.options=Object.assign(Object.assign({},this.options),t)),this.renew()}}var se=i(38593),ne=i(18317),oe=i(86450),re=i(87131),ae=i(28281),le=i(21265),ce=i(72942);const he=new s.Z("xr"),de=(new a._fP).setFromAxisAngle(l.f.UP,a.M8C.DEG2RAD*I.rotationDegrees),ue=(new a._fP).setFromAxisAngle(l.f.UP,a.M8C.DEG2RAD*-I.rotationDegrees);class pe extends n.Y{constructor(){super(...arguments),this.name="webxr",this.framebufferScaledTo=1,this.framebufferScale=0,this.ray={forward:new a.Pa4,origin:new a.Pa4},this.onXrPresentBegin=()=>{const e=this.renderer.xr.getSession();he.info(`Session framebuffer: ${e.renderState.baseLayer}`),this.engine.commandBinder.issueCommand(new oe.D(!0)),this.engine.commandBinder.issueCommand(new oe.F(re.AB.HIGH)),this.viewmodeData.isPano()||this.engine.commandBinder.issueCommand(new ce._i(ce.BD.INSIDE)),this.xrPointer=new S(this.raycaster.picking),this.raycaster.setOverridePointer(this.xrPointer),this.xrNavVisuals.activate()},this.onXrPresentEnd=()=>{const e=null!==this.settings.tryGetProperty(ae.YS,null);this.engine.commandBinder.issueCommand(new oe.D(e)),this.engine.commandBinder.issueCommand(new oe.F(this.config.navPanoSize)),this.xrNavVisuals.deactivate(),this.raycaster.setOverridePointer(null),this.cameraModule.updateCameraRotation((0,r.Rq)(this.cameraData.pose.rotation,new a._fP)),this.webglScene.setCameraDirty()},this.onXrTrackingApplied=e=>{const t=this.controllerMesh.controller();if(t.connected){const i=this.ray.forward.copy(l.f.FORWARD).applyQuaternion(t.pointer.quaternion),s=this.ray.origin.setFromMatrixPosition(t.pointer.matrixWorld);this.xrPointer.update3D(s,i,e.trackedCamera),this.xrPointerInput.dispatchPointerMove(t.index)}this.xrGamepadInput.updateFromGamepads()},this.requestSession=async(e,t)=>{if(await(0,se.pl)()!==se.bk.webxr)return null;if(this.renderer.xr.isPresenting)return this.renderer.xr.getSession();if(ne.Z.apiExists()){const i=await navigator.xr.requestSession(e,{optionalFeatures:t}),s=XRWebGLLayer.getNativeFramebufferScaleFactor(i);return this.framebufferScaledTo=this.framebufferScale*(s-1)+1,he.info("Scaling framebuffer by:",this.framebufferScaledTo,"native size:",s," * factor:",this.framebufferScale),0!==this.framebufferScale&&this.renderer.xr.setFramebufferScaleFactor(this.framebufferScaledTo),this.renderer.xr.setSession(i),i}return null}}async init(e,t){this.config=e,this.engine=t;const i=await t.getModule(g.default);if(this.renderer=i.threeRenderer,this.webglScene=i.getScene(),this.settings=await t.market.waitForData(m.e),this.bindings.push(t.commandBinder.addBinding(A.j,(e=>this.requestSession(e.type,e.features)))),await(0,se.pl)()!==se.bk.webxr)return;[this.canvasModule,this.cameraModule,this.raycaster]=await Promise.all([t.getModule(c.default),t.getModule(h.default),t.getModule(u.default)]),[this.cameraData,this.raycasterData,this.viewmodeData]=await Promise.all([t.market.waitForData(d.M_),t.market.waitForData(p.P),t.market.waitForData(j.O)]),this.renderer.xr.setReferenceSpaceType("local"),this.framebufferScale=this.config.framebufferScaling||function(e){const t=(0,le.tq)();return!t||t&&function(e){return/Adreno \(TM\) (540|[6-9]\d\d)/.test(e.renderer)}(e)?1:0}(i.gpuInfo);const s=new L(t,this.renderer,this.webglScene,this.cameraData,this.cameraModule);s.setTrackingStyle(e.tracking),this.bindings.push(s.subscribe(x,this.onXrPresentBegin),s.subscribe(M,this.onXrPresentEnd),s.subscribe(_,this.onXrTrackingApplied)),this.controllerMesh=new J(this.renderer),this.webglScene.add(this.controllerMesh.container);const n=new Q(this.controllerMesh),r=e.enableEventPositions?()=>this.raycasterData.pointerScreenPosition:void 0;this.xrPointerInput=new te({forwardToElement:this.canvasModule.element,getPointerScreenPosition:r}),this.xrGamepadInput=new ie(this.renderer);const a=new o.V(this.xrGamepadInput.onGamepadEvent("axestriggered",(e=>{e.index!==C.thumbstickX&&e.index!==C.touchpadX||(he.debug(`${e.inputSource.handedness} ${C[e.index]} axis.value over threshold, do the rotate!`),Math.sign(e.value)>0?s.offsetRotation(de):s.offsetRotation(ue)),n.focus(e.controllerIndex),this.controllerMesh.setDefault(e.controllerIndex)})),this.xrGamepadInput.onSessionEvent("selectstart",(e=>{this.xrPointerInput.dispatchPointerDown(e.controllerIndex),n.focus(e.controllerIndex),this.controllerMesh.setDefault(e.controllerIndex)})),this.xrGamepadInput.onSessionEvent("selectend",(e=>{this.xrPointerInput.dispatchPointerUp(e.controllerIndex),n.focus(e.controllerIndex),this.controllerMesh.setDefault(e.controllerIndex)})),this.xrGamepadInput.onSessionEvent("squeezestart",(e=>{n.focus(e.controllerIndex),this.controllerMesh.setDefault(e.controllerIndex)})));this.bindings.push(a,this.xrGamepadInput),this.xrNavVisuals=new K,this.xrNavVisuals.init(t),this.webglScene.add(this.xrNavVisuals.container)}}const me=pe},38593:(e,t,i)=>{"use strict";i.d(t,{hX:()=>a,pl:()=>l,bk:()=>s});var s,n=i(21265),o=i(18317),r=i(25903);!function(e){e.webvr="webvr",e.webxr="webxr",e.unsupported="unsupported"}(s||(s={}));const a=e=>{const t=e.tryGetProperty("is_vr",!1),i=e.tryGetProperty("mls",0),s=e.tryGetProperty("vr",1);return t&&!(!s||2===s&&!(0,n.Dt)())&&0===i},l=async()=>{const e=await o.Z.isSessionSupported("immersive-vr");return o.Z.likelySupportsControllers()&&e?s.webxr:await r.H()?s.webvr:s.unsupported}},18317:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(25799),n=i(21265);const o=new s.Z("vr-platform-select"),r=()=>{const e="xr"in navigator&&"isSessionSupported"in navigator.xr&&"requestSession"in navigator.xr;return window.isSecureContext&&e},a={isSessionSupported:async(e="immersive-vr")=>{let t=!1;if(r())try{t=await navigator.xr.isSessionSupported(e)}catch(e){o.info("WebXR disabled",e)}return o.debug(`WebXR session type: ${e} supported: ${t}`),t},likelySupportsControllers:()=>window.isSecureContext&&((0,n.Ot)()||!(0,n.tq)()),apiExists:r}},48101:(e,t,i)=>{"use strict";function s(...e){return e.join("\n")}i.d(t,{m:()=>s})},58286:(e,t,i)=>{"use strict";i.d(t,{$:()=>U,N:()=>N});var s=i(2212);window.THREE=Object.assign(Object.assign({},window.THREE),{BufferGeometry:s.u9r,Sphere:s.aLr,Box3:s.ZzF,Texture:s.xEZ,Color:s.Ilk,BufferAttribute:s.TlE});var n,o=i(11385),r=i(27829),a=i(97620),l=i(75195),c=i(21265),h=i(25799);!function(e){e[e.NONE=0]="NONE",e[e.NUMERIC=1]="NUMERIC",e[e.ASCII=2]="ASCII"}(n||(n={}));const d={pages:[],chars:[],info:{face:"Loading",size:0,bold:0,italic:0,charset:[],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[0,0],os2version:1},common:{lineHeight:0,base:0,scaleW:1,scaleH:1,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:[]};var u=i(60778),p=i(94085),m=i(78909);class g extends m.T{constructor(e){super(),this.packer=e,this.fontData=d,this.textures=[]}update(e,t){this.fontData=t,this.textures.forEach((e=>e.dispose())),this.textures.length=0,this.textures.push(...e),this.commit()}addCharsIfNeeded(e){this.packer.addChars(e)}}const f=new h.Z("FontManager");class v{constructor(){this.name="roboto-700-42-static",this._atlas=new g(this),this.mWidth=0}async loadFont(){const[e,t]=await Promise.all([(0,u.p)(p),i.e(386).then(i.t.bind(i,60386,19))]),s=t.default;return this.estimateWidth(s),this._atlas.update([e],s),Promise.resolve({fontPath:this.name,font:this.name,packer:this})}addChars(e){f.debug(this.name,"does not support dynamic char adding")}measureText(e){if(this.mWidth)return e.length*this.mWidth}atlas(){return this._atlas}estimateWidth(e){const t=e.chars.find((e=>e.id==="m".charCodeAt(0)));t&&(this.mWidth=t.width)}}const y=(()=>{let e=null;return function(){return e||(e=Promise.all([i.e(764),i.e(422),i.e(143)]).then(i.bind(i,44422)).then((e=>e.load))),e}})();class b{constructor(e=0,t=0,i=0,s=0,n=!1,o){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=t,this._x=i,this._y=s,this._data={},this._rot=n,this._allowRotation=o}static Collide(e,t){return e.collide(t)}static Contain(e,t){return e.contain(t)}area(){return this.width*this.height}collide(e){return e.x<this.x+this.width&&e.x+e.width>this.x&&e.y<this.y+this.height&&e.y+e.height>this.y}contain(e){return e.x>=this.x&&e.y>=this.y&&e.x+e.width<=this.x+this.width&&e.y+e.height<=this.y+this.height}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._dirty++)}get height(){return this._height}set height(e){e!==this._height&&(this._height=e,this._dirty++)}get x(){return this._x}set x(e){e!==this._x&&(this._x=e,this._dirty++)}get y(){return this._y}set y(e){e!==this._y&&(this._y=e,this._dirty++)}get rot(){return this._rot}set rot(e){if(!1!==this._allowRotation&&this._rot!==e){const t=this.width;this.width=this.height,this.height=t,this._rot=e,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(e){this._allowRotation!==e&&(this._allowRotation=e,this._dirty++)}get data(){return this._data}set data(e){null!==e&&e!==this._data&&(this._data=e,"object"==typeof e&&e.hasOwnProperty("allowRotation")&&(this._allowRotation=e.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(e=!0){this._dirty=e?this._dirty+1:0}}class w{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some((e=>e.dirty))}setDirty(e=!0){if(this._dirty=e?this._dirty+1:0,!e)for(let e of this.rects)e.setDirty&&e.setDirty(!1)}}class S extends w{constructor(e=E,t=E,i=0,s={}){super(),this.maxWidth=e,this.maxHeight=t,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:_.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),s),this.width=this.options.smart?0:e,this.height=this.options.smart?0:t,this.border=this.options.border?this.options.border:0,this.freeRects.push(new b(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new b(this.width,this.height)}add(...e){let t,i;if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsBin.add(): Wrong parameters");i=e[0];let t=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==t)return}else{if(t=e.length>2?e[2]:null,this.options.tag&&this.options.exclusiveTag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}i=new b(e[0],e[1]),i.data=t,i.setDirty(!1)}const s=this.place(i);return s&&this.rects.push(s),s}repack(){let e=[];this.reset(),this.rects.sort(((e,t)=>{const i=Math.max(t.width,t.height)-Math.max(e.width,e.height);return 0===i&&e.hash&&t.hash?e.hash>t.hash?-1:1:i}));for(let t of this.rects)this.place(t)||e.push(t);for(let t of e)this.rects.splice(this.rects.indexOf(t),1);return e.length>0?e:void 0}reset(e=!1,t=!1){e&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],t&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new b(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new b(this.width,this.height),this._dirty=0}clone(){let e=new S(this.maxWidth,this.maxHeight,this.padding,this.options);for(let t of this.rects)e.add(t);return e}place(e){let t,i,s=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===s){if(i=e.hasOwnProperty("_allowRotation")&&void 0!==e.allowRotation?e.allowRotation:this.options.allowRotation,t=this.findNode(e.width+this.padding,e.height+this.padding,i),t){this.updateBinSize(t);let i=this.freeRects.length,s=0;for(;s<i;)this.splitNode(this.freeRects[s],t)&&(this.freeRects.splice(s,1),i--,s--),s++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,e.x=t.x,e.y=t.y,void 0===e.rot&&(e.rot=!1),e.rot=t.rot?!e.rot:e.rot,this._dirty++,e}if(this.verticalExpand){if(this.updateBinSize(new b(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new b(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(e)}else if(this.updateBinSize(new b(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new b(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(e)}}findNode(e,t,i){let s,n,o,r=Number.MAX_VALUE;for(let a in this.freeRects)n=this.freeRects[a],n.width>=e&&n.height>=t&&(s=this.options.logic===_.MAX_AREA?n.width*n.height-e*t:Math.min(n.width-e,n.height-t),s<r&&(o=new b(e,t,n.x,n.y),r=s)),i&&n.width>=t&&n.height>=e&&(s=this.options.logic===_.MAX_AREA?n.width*n.height-t*e:Math.min(n.height-e,n.width-t),s<r&&(o=new b(t,e,n.x,n.y,!0),r=s));return o}splitNode(e,t){if(!e.collide(t))return!1;if(t.x<e.x+e.width&&t.x+t.width>e.x){if(t.y>e.y&&t.y<e.y+e.height){let i=new b(e.width,t.y-e.y,e.x,e.y);this.freeRects.push(i)}if(t.y+t.height<e.y+e.height){let i=new b(e.width,e.y+e.height-(t.y+t.height),e.x,t.y+t.height);this.freeRects.push(i)}}if(t.y<e.y+e.height&&t.y+t.height>e.y){if(t.x>e.x&&t.x<e.x+e.width){let i=new b(t.x-e.x,e.height,e.x,e.y);this.freeRects.push(i)}if(t.x+t.width<e.x+e.width){let i=new b(e.x+e.width-(t.x+t.width),e.height,t.x+t.width,e.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let e=0,t=0,i=this.freeRects.length;for(;e<i;){t=e+1;let s=this.freeRects[e];for(;t<i;){let n=this.freeRects[t];if(n.contain(s)){this.freeRects.splice(e,1),e--,i--;break}s.contain(n)&&(this.freeRects.splice(t,1),t--,i--),t++}e++}}updateBinSize(e){if(!this.options.smart)return!1;if(this.stage.contain(e))return!1;let t=Math.max(this.width,e.x+e.width-this.padding+this.border),i=Math.max(this.height,e.y+e.height-this.padding+this.border);if(this.options.allowRotation){const s=Math.max(this.width,e.x+e.height-this.padding+this.border),n=Math.max(this.height,e.y+e.width-this.padding+this.border);s*n<t*i&&(t=s,i=n)}return this.options.pot&&(t=Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(t=i=Math.max(t,i)),!(t>this.maxWidth+this.padding||i>this.maxHeight+this.padding||(this.expandFreeRects(t+this.padding,i+this.padding),this.width=this.stage.width=t,this.height=this.stage.height=i,0))}expandFreeRects(e,t){this.freeRects.forEach(((i,s)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,e)&&(i.width=e-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,t)&&(i.height=t-i.y-this.border)}),this),this.freeRects.push(new b(e-this.width-this.padding,t-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new b(e-2*this.border,t-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((e=>!(e.width<=0||e.height<=0||e.x<this.border||e.y<this.border))),this.pruneFreeList()}}class T extends w{constructor(...e){if(super(),this.rects=[],1===e.length){if("object"!=typeof e[0])throw new Error("OversizedElementBin: Wrong parameters");const t=e[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=e[0],this.height=e[1],this.data=e.length>2?e[2]:null;const t=new b(this.width,this.height);t.oversized=!0,t.data=this.data,this.rects.push(t)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(e=!1){}repack(){}clone(){return new T(this.rects[0])}}const E=4096;var _;!function(e){e[e.MAX_AREA=0]="MAX_AREA",e[e.MAX_EDGE=1]="MAX_EDGE"}(_||(_={}));class x{constructor(e=E,t=E,i=0,s={}){this.width=e,this.height=t,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:_.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),s)}add(...e){if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=e[0];if(t.width>this.width||t.height>this.height)this.bins.push(new T(t));else if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new S(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(e.tag=i),e.add(t),this.bins.push(e)}return t}{const t=new b(e[0],e[1]);if(e.length>2&&(t.data=e[2]),t.width>this.width||t.height>this.height)this.bins.push(new T(t));else if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new S(this.width,this.height,this.padding,this.options);this.options.tag&&t.data.tag&&(e.tag=t.data.tag),e.add(t),this.bins.push(e)}return t}}addArray(e){if(!this.options.tag||this.options.exclusiveTag)this.sort(e,this.options.logic).forEach((e=>this.add(e)));else{if(0===e.length)return;let t;e.sort(((e,t)=>{const i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0,s=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;return void 0===s?-1:void 0===i?1:s>i?-1:1}));let i=0;if(!this.bins.slice(this._currentBinIndex).find((s=>{let n=s.clone();for(let o=i;o<e.length;o++){const r=e[o],a=r.data&&r.data.tag?r.data.tag:r.tag?r.tag:void 0;if(0===o&&(t=a),a!==t)return t=a,this.sort(e.slice(i,o),this.options.logic).forEach((e=>s.add(e))),i=o,this.addArray(e.slice(o)),!0;if(void 0===a)return this.sort(e.slice(o),this.options.logic).forEach((e=>this.add(e))),i=e.length,!0;if(void 0===n.add(r))return!1}return this.sort(e.slice(i),this.options.logic).forEach((e=>s.add(e))),!0}))){const t=e[i],s=new S(this.width,this.height,this.padding,this.options),n=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&this.options.exclusiveTag&&n&&(s.tag=n),this.bins.push(s),this.addArray(e.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(e=!0){if(e){let e=[];for(let t of this.bins)if(t.dirty){let i=t.repack();i&&e.push(...i)}return void this.addArray(e)}if(!this.dirty)return;const t=this.rects;this.reset(),this.addArray(t)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(e){e.forEach(((e,t)=>{if(e.maxWidth>this.width||e.maxHeight>this.height)this.bins.push(new T(e.width,e.height,{}));else{let i=new S(this.width,this.height,this.padding,e.options);i.freeRects.splice(0),e.freeRects.forEach(((e,t)=>{i.freeRects.push(new b(e.width,e.height,e.x,e.y))})),i.width=e.width,i.height=e.height,e.tag&&(i.tag=e.tag),this.bins[t]=i}}),this)}save(){let e=[];return this.bins.forEach((t=>{let i={width:t.width,height:t.height,maxWidth:t.maxWidth,maxHeight:t.maxHeight,freeRects:[],rects:[],options:t.options};t.tag&&(i=Object.assign(Object.assign({},i),{tag:t.tag})),t.freeRects.forEach((e=>{i.freeRects.push({x:e.x,y:e.y,width:e.width,height:e.height})})),e.push(i)})),e}sort(e,t=_.MAX_EDGE){return e.slice().sort(((e,i)=>{const s=t===_.MAX_EDGE?Math.max(i.width,i.height)-Math.max(e.width,e.height):i.width*i.height-e.width*e.height;return 0===s&&e.hash&&i.hash?e.hash>i.hash?-1:1:s}))}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some((e=>e.dirty))}get rects(){let e=[];for(let t of this.bins)e.push(...t.rects);return e}}const M=function(){const e=document.createElement("a");return document.body.appendChild(e),e.style.display="none",(t,i)=>{const s=t.toDataURL();e.href=s,e.download=i,e.click()}}(),P=(e,t)=>{const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.click()},A=new h.Z("font-packer"),O={save:"1"===(0,c.hu)("exportfont","0"),saveDefaultFont:"1"===(0,c.hu)("exportdefault","0"),verboseChars:!0,verboseFont:!0,perf:{log:!1,marks:{rebuild:"rebuild",kern:"kerning",metrics:"metrics",pack:"pack",texture:"texture",bmfont:"load-bmfont"}}};class D{constructor(e,t){this.needsRebuild=!1,this._atlas=new g(this),this._loading=!1,this._loaded=!1,this._addedChars=[],this.charSet=new Set,this.kerningsMap={},this.measureMap={},this.metricsMap={},this.scale=1,this.throttledRebuild=((e,t)=>{let i,s=Date.now()-t;return(...n)=>{const o=Date.now()-s,r=()=>{e.apply(null,n),s=Date.now()};if(i&&clearTimeout(i),o>=t)r();else{const e=t-o;i=window.setTimeout(r,e)}}})((()=>{setTimeout((()=>this.rebuild()),0)}),1500),this.options=e,t&&(this.font=t);try{this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height;const e=this.canvas&&this.canvas.getContext("2d");if(!e)throw Error("Unable to create canvas context for font-packer");this.ctx=e,this.ctx.fillStyle="white",this.ctx.textBaseline="alphabetic",this.ctx.textAlign="center"}catch(e){A.error("Failed to create canvas rendering context",e)}this.packer=new x(this.options.width-this.options.texturePadding,this.options.height-this.options.texturePadding,2*this.options.texturePadding),this.options.defaultCharset&&function(e=!1){const t=new Set(Array.from("m0123456789_-+'\"` \t")),i=[];e&&i.push([32,127]);for(const e of i)for(let i=e[0];i<e[1];i++)t.add(String.fromCharCode(i));return t}(this.options.defaultCharset===n.ASCII||O.saveDefaultFont).forEach((e=>this.charSet.add(e)))}get loaded(){return!this._loading&&this._loaded}async loadFont(){let e;if(O.perf.log&&performance.mark(O.perf.marks.bmfont),!this.font){this._loading=!0,e=new FontFace(`${this.options.fontFamily}`,`url("${this.options.fontPath}") format("woff")`,{family:`${this.options.fontFamily}`,style:`${this.options.fontStyle}`,weight:`${this.options.fontWeight}`}),e.load();const t=e.loaded,i=(await y())(this.options.fontPath),[s]=await Promise.all([i,t]);this.font=s}O.perf.log&&performance.measure(O.perf.marks.bmfont,O.perf.marks.bmfont),this.scale=this.options.fontSize/this.font.unitsPerEm;const t=`${this.options.fontWeight} ${this.options.fontSize}px ${this.options.fontFamily}`;return this.ctx.font=t,O.verboseFont&&A.debug({contextFontFace:t,bmfont:this.font,charset:this.charSet}),this._loading=!1,this.fontFilename=`${this.options.fontFamily.toLowerCase()}-${this.options.fontWeight}-${this.options.fontSize}`+(this.options.outline?"-outline-"+this.options.outlineWidth:""),this.needsRebuild=!0,this.throttledRebuild(),{fontPath:this.options.fontPath,font:this.font,packer:this}}addChars(e){const t=this.charSet.size;return Array.from(e).forEach((e=>{this.charSet.has(e)||this._addedChars.push(e),this.charSet.add(e)})),t!==this.charSet.size&&(this.needsRebuild=!0,this.throttledRebuild()),this.needsRebuild}atlas(){return this._atlas}rebuild(){if(this.loaded&&this._addedChars.length<1)return void(this.needsRebuild=!1);O.verboseChars&&(A.debug(`Added ${this._addedChars.length} glyphs: \n${this._addedChars}`),this._addedChars.length=0),performance.mark(O.perf.marks.rebuild),O.perf.log&&performance.mark(O.perf.marks.metrics);const e=this.getAllGlyphMetrics();O.perf.log&&performance.measure(O.perf.marks.metrics,O.perf.marks.metrics),O.perf.log&&performance.mark(O.perf.marks.pack);const t=this.pack(e);O.perf.log&&performance.measure(O.perf.marks.pack,O.perf.marks.pack),O.perf.log&&performance.mark(O.perf.marks.texture);const{chars:i,textures:s}=this.assembleTexture(t);O.perf.log&&performance.measure(O.perf.marks.texture,O.perf.marks.texture),O.perf.log&&performance.mark(O.perf.marks.kern);const n=this.getKerningPairs();O.perf.log&&performance.measure(O.perf.marks.kern,O.perf.marks.kern);const o=this.assembleFont(i,n,s);performance.measure(O.perf.marks.rebuild,O.perf.marks.rebuild),this._loaded=!0,this._atlas.update(s,o);const r=`Rebuilt atlas for ${this.charSet.size} chars with ${o.kernings.length} kerning pairs`;O.perf.log?(A.debug(r,performance.getEntriesByName(O.perf.marks.rebuild,"measure")[0],performance.getEntriesByType("measure").map((e=>({name:e.name,duration:e.duration}))),this.options),Object.values(O.perf.marks).forEach((e=>{performance.clearMarks(e),performance.clearMeasures(e)}))):(A.debug(r,performance.getEntriesByName(O.perf.marks.rebuild,"measure")[0]),performance.clearMarks(O.perf.marks.rebuild),performance.clearMeasures(O.perf.marks.rebuild))}pack(e){return this.packer.bins.length=0,this.packer.addArray(e),this.packer.bins.reverse()}assembleTexture(e){const t=[],i=e.map(((e,i)=>(this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.options.transparent&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.rects.forEach((e=>{const s=e.data.charData,n=e.x+s.width/2-this.options.texturePadding/2,o=e.y+s.height+s.ymin-this.options.texturePadding;this.options.outline&&this.options.outlineWidth>0?function(e,t,i,s,n){const o=e.strokeStyle,r=e.fillStyle;e.strokeStyle="black",e.lineWidth=n,e.strokeText(t,i,s),e.fillStyle="white",e.fillText(t,i,s),e.strokeStyle=o,e.fillStyle=r}(this.ctx,e.data.charData.char,n,o,this.options.outlineWidth):this.ctx.fillText(e.data.charData.char,n,o),s.x=e.x,s.y=e.y,s.page=i,t.push(e.data.charData)})),O.save&&M(this.ctx.canvas,`${this.fontFilename}_${i}.png`),this.makeCanvasTexture(i,!1))));return{chars:t,textures:i}}getKerningPairs(){const e=[],t=[...this.charSet.values()].map((e=>this.font.charToGlyphIndex(e))).filter((e=>e>0));for(const i of t)for(const s of t){const t=`${i},${s}`;let n=this.kerningsMap[t];n||(n={first:i,second:s,amount:this.font.getKerningValue(i,s)*this.scale},this.kerningsMap[t]=n),n&&0!==n.amount&&e.push(n)}return e}assembleFont(e,t,i){const s=this.font.tables.os2,n=this.font.tables.name.fullName,o=n[Object.getOwnPropertyNames(n)[0]],r={pages:i.map(((e,t)=>`${this.fontFilename}_${t}.png`)),chars:e,info:{face:o,size:this.options.fontSize,bold:0,italic:0,charset:[...this.charSet.values()],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[this.options.texturePadding,this.options.texturePadding],os2version:s.version},common:{lineHeight:(s.sTypoAscender-s.sTypoDescender+s.sTypoLineGap)*this.scale,base:this.font.ascender*this.scale,scaleW:this.options.width,scaleH:this.options.height,pages:this.packer.bins.length,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:t};return O.verboseFont&&A.debug({bmFontOutput:r,kerningPairCount:t.length}),O.save&&(P(JSON.stringify(r),`${this.fontFilename}.json`),P(JSON.stringify(this.options,void 0,2),`${this.fontFilename}-pack-options.json`)),r}getMetrics(e){const t=this.font.charToGlyph(e);let i=this.measureMap[e];i||(i=t.getMetrics(),this.measureMap[e]=i);const{width:s,height:n}=this.measureChar(e),o=2*this.options.texturePadding,r=n+o,a=-i.yMax*this.scale-this.options.texturePadding,l=t.advanceWidth*this.scale,c=l>=s,h=c?l:s;return{char:e,width:s+o,height:r,ymin:i.yMin*this.scale-(c?0:n+a+this.options.texturePadding),bottom:a,xadvance:h,supported:c}}measureText(e){if(!this.loaded)return;let t=0;for(const i of Array.from(e)){const{width:e}=this.measureChar(i);t+=e}return t}measureChar(e){let t=this.metricsMap[e];t||(t=this.ctx.measureText(e),this.metricsMap[e]=t);const i=t.actualBoundingBoxLeft+t.actualBoundingBoxRight;return{width:t.width||i,height:t.actualBoundingBoxAscent+t.actualBoundingBoxDescent}}getAllGlyphMetrics(){const e=[],t=this.font.ascender*this.scale;for(const i of this.charSet.values()){const s=this.getMetrics(i),n={data:{charData:{char:i,id:i.charCodeAt(0),width:s.width,height:s.height,xoffset:0,yoffset:s.bottom+t,xadvance:s.xadvance,chnl:15,ymin:s.ymin}},width:s.width,height:s.height};e.push(n)}return e}makeCanvasTexture(e,t){if(t){const e=new Uint8Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data),t=new s.IEO(e,this.canvas.width,this.canvas.height,s.wk1);return t.flipY=!0,t}const i=new s.xEZ(this.ctx.canvas);return i.name=`${this.ctx.font}_${e}`,i.format=s.wk1,i.needsUpdate=!0,i}}const I=new h.Z("FontManager"),C={fontPath:"fonts/roboto-700.woff",fontWeight:700,fontFamily:"Roboto",fontStyle:"normal",fontSize:42,width:2048,height:2048,texturePadding:6,transparent:!0,defaultCharset:n.NUMERIC,outline:!1,outlineWidth:4},R="1"===(0,c.hu)("staticfont","0");class L{constructor(){this.defaultFontOptions=C,this.packerMap=new Map,this.optionsMap=new Map,this.parsedFontMap=new Map}static get instance(){return L._instance||(L._instance=new L),L._instance}getFontId(e=this.defaultFontOptions){const t=Object.assign(Object.assign({},this.defaultFontOptions),e),i=JSON.stringify(t);return this.optionsMap.set(i,t),i}getFont(e){let t=this.packerMap.get(e);if(t||!R&&!(0,c.w1)()||(t=new v,t.loadFont(),this.packerMap.set(e,t)),!t){const i=this.optionsMap.get(e)||JSON.parse(e),s=this.parsedFontMap.get(i.fontPath);t=new D(i,s),this.packerMap.set(e,t),t.loadFont().then((t=>{I.debug("font loaded",e,t.fontPath),this.parsedFontMap.set(t.fontPath,t.font)}))}return t.atlas()}measureText(e,t){const i=this.packerMap.get(e);if(i)return i.measureText(t)}}var N,k=i(91055),F=i(53628);class B extends s.Kj0{}!function(e){e.WORLD="world",e.NDC="ndc"}(N||(N={}));class U extends s.Tme{constructor(e,t=L.instance,n=N.WORLD){super(),this.config=e,this.fontManager=t,this.scaleType=n,this.update=()=>{const e=this.resolvedConfig;this.textGeometry.update(e),this.textGeometry.computeBoundingBox();const t=this.textGeometry.layout.lineHeight-this.textGeometry.layout.baseline;this.labelTextMesh.position.x=-.5*this.textGeometry.layout.width+t,this.labelTextMesh.position.y=-.5*this.textGeometry.layout.height+t,this.labelTextMesh.position.z=.25,this.unscaledWidth=this.textGeometry.layout.width+this.config.backgroundBorderWidth,this.unscaledHeight=this.textGeometry.layout.height+this.config.backgroundBorderHeight,(this.labelBackgroundMesh||this.config.backgroundAsCollider)&&this.labelBackgroundMesh.scale.set(this.unscaledWidth,this.unscaledHeight,.01),this.aspect=this.unscaledWidth/Math.max(this.unscaledHeight,.001),this.fontHeightToMeters=1/e.font.info.size,this.updateScale()};const a=void 0!==this.config.opacity?this.config.opacity:1;if(this.config.background||this.config.backgroundAsCollider){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new s.DvJ(1,1,.01),i=new s.vBJ({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:s.x5V,stencilZFail:s.x5V,stencilZPass:s.ce8,stencilFunc:s.cum,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.25,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const l={outline:this.config.outline,outlineWidth:this.config.outlineWidth},c={uniforms:{map:{type:"t",value:(h=Object.assign(Object.assign({},l),{color:e.color,opacity:a})).map},color:{type:"c",value:new s.Ilk(h.color)},opacity:{type:"f",value:h.opacity}},vertexShader:i(35850),fragmentShader:i(51712)};var h;const d=new s.FIo({uniforms:c.uniforms,fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,side:s.ehD,transparent:!0,depthTest:!1,depthWrite:!1,opacity:a});d.name="Label Text",this.fontId=this.fontManager.getFontId(l);const u=this.fontManager.getFont(this.fontId);d.uniforms.map.value=u.textures[0],u.onChanged((()=>{d.uniforms.map.value=u.textures[0],this.update()}));const p=this.resolvedConfig,m=p.font;this.textGeometry=o(p),this.labelTextMesh=new B(this.textGeometry,d),this.labelTextMesh.name="Label Text",this.labelTextMesh.renderOrder=10;const g=(new s._fP).setFromAxisAngle(r.f.FORWARD,s.M8C.degToRad(180)),f=(new s._fP).setFromAxisAngle(r.f.UP,s.M8C.degToRad(180));this.labelTextMesh.quaternion.multiply(g).multiply(f),this.add(this.labelTextMesh),this.name="Label Container",this.fontHeightToMeters=1/m.info.size,this.scaleFactor=e.scale||this.fontHeightToMeters,this.update()}get resolvedConfig(){let e;if(void 0!==this.config.wordWrapWidth){const t=this.fontManager.measureText(this.fontId,this.config.text);void 0!==t&&t>this.config.wordWrapWidth&&(e=this.config.wordWrapWidth)}const t=this.fontManager.getFont(this.fontId);return Object.assign(Object.assign({},this.config),{font:t.fontData,texture:t.textures[0],width:e})}updateScale(){this.height=this.textGeometry.layout.height*this.config.scale,this.width=this.textGeometry.layout.width*this.config.scale;const e=this.config.scale*this.fontHeightToMeters;this.scale.set(e,e,e)}get text(){return this.config.text}set text(e){e!==this.name&&(this.config.text=e,this.name=e,this.fontManager.getFont(this.fontId).addCharsIfNeeded(e),this.update())}get mesh(){return this.labelTextMesh}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.scaleFactor!==e&&(this.config.scale=e,this.updateScale())}get opacity(){return this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>F.iV.DEPTH_WRITE_THRESHOD,i.depthTest=t}const i=this.labelTextMesh.material;i.uniforms.opacity.value=e,i.depthTest=t,this.visible=e>0}}setColorHex(e){const t=this.labelTextMesh.material.uniforms.color;t.value.getHex()!==e&&t.value.setHex(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*a.Ue)}scaleBillboard(e,t,i,s,n,o,r=H.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.4*r*s;else{const c=(0,l.D_)(this.position,e,t,i.asThreeMatrix4()),h=Math.abs(c.x);if(h<1){const t=(0,k.mY)(i,e,this.position,n,r),l=((0,a.uZ)(o,1,2.5)+s)*H.SCALE_ASPECT,c=1+H.SCALE_NDC-h*H.SCALE_NDC-l,d=Math.max(Math.min(1/t*c,3),.001);this.scaleType===N.NDC?this.scaleFactor=d:this.scaleFactor=Math.min(d,r*H.SCALE_WORLD)}else this.scaleFactor=.001}}}const H={SCALE_DEFAULT:.1,SCALE_WORLD:5,SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15}},30041:(e,t,i)=>{"use strict";i.d(t,{u:()=>o});var s=i(58286),n=i(2212);class o{constructor(e){this.currentTextConfig=o.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(o.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new s.$(Object.assign(Object.assign({},this.currentTextConfig),e))}static makeConfig(e){return Object.assign(Object.assign({},this.defaultTextConfig),e)}}o.defaultTextConfig={text:"",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:50,backgroundBorderHeight:30,background:!0,backgroundAsCollider:!0,backgroundColliderType:n.Kj0,scale:1,outline:!1,outlineWidth:4}},2124:(e,t,i)=>{"use strict";i.d(t,{P:()=>s});class s{constructor(e){this.size=e,this.index=0,this.buffer=[]}push(e){this.index>=this.size&&(this.index=0),this.buffer[this.index]=e,this.index++}peek(){return this.buffer[this.index<=this.buffer.length?this.index-1:0]||null}getList(){return this.buffer}*[Symbol.iterator](){yield*this.buffer}clear(){this.buffer=[],this.index=0}}},75712:(e,t,i)=>{"use strict";i.d(t,{s:()=>s});class s{constructor(e){this.matcher=e}static isValue(e){return new s(new n(e))}static isType(e){return new s(new o(e))}static isInstanceOf(e){return new s(new r(e))}static is(e){return new s(new a(e))}static isAny(){return new s(new l)}compare(e){return this.matcher.matches(e)}}class n{constructor(e){this.value=e}matches(e){return this.value===e}}class o{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class r{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class a{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class l{constructor(){}matches(){return!0}}},90384:(e,t,i)=>{"use strict";i.d(t,{l1:()=>s,r2:()=>l});var s,n=i(2212),o=i(27829);!function(e){e[e.Axes=1]="Axes",e[e.PlanarAxes=2]="PlanarAxes",e[e.EdgesAndPlanarAxes=3]="EdgesAndPlanarAxes",e[e.Edges=4]="Edges",e[e.Free=5]="Free",e[e.Locked=6]="Locked"}(s||(s={}));const r={[o.e.UP]:{dir:Object.freeze(o.f.UP.clone())},[o.e.DOWN]:{dir:Object.freeze(o.f.DOWN.clone())},[o.e.BACK]:{dir:Object.freeze(o.f.BACK.clone())},[o.e.LEFT]:{dir:Object.freeze(o.f.LEFT.clone())},[o.e.RIGHT]:{dir:Object.freeze(o.f.RIGHT.clone())},[o.e.FORWARD]:{dir:Object.freeze(o.f.FORWARD.clone())}},a={[o.e.HORIZONTAL_PLANE]:{dir:Object.freeze(o.f.HORIZONTAL_PLANE.clone())}},l=(()=>{let e=0;const t=new n.Pa4,i=new n.Pa4,l=new n.Pa4,c=new n.Pa4,h=999,d=Object.freeze(o.f.ZERO.clone()),u=Object.keys(r).map((e=>Object.assign(Object.assign({},r[e]),{name:e,angleTo:h}))),p=Object.keys(a).map((e=>Object.assign(Object.assign({},a[e]),{name:e,angleTo:h}))),m=e=>(e+3)%2;let g=u[0];return(r,a,f=s.Axes)=>{if(f===s.Free)return{position:a.clone(),constrainedAxis:d,axisName:o.e.NONE};if(u.forEach((e=>e.angleTo=h)),p.forEach((e=>e.angleTo=h)),l.copy(a).sub(r),e=l.length(),e<.05)return{position:a.clone(),constrainedAxis:d,axisName:o.e.NONE};c.copy(l).normalize();const v=.05*Math.min(e,1);if(f!==s.Locked){for(const e of u){const t=n.M8C.radToDeg(c.angleTo(e.dir));t<g.angleTo&&(g=e),e.angleTo=t}if(g.angleTo>20){const e=Math.abs(l.y);e*e<v&&(g=p[0])}}return t.set(r.x*m(g.dir.x),r.y*m(g.dir.y),r.z*m(g.dir.z)),i.set(a.x*Math.abs(g.dir.x),a.y*Math.abs(g.dir.y),a.z*Math.abs(g.dir.z)).add(t),f===s.Locked||i.distanceToSquared(a)<v?{position:i.clone(),constrainedAxis:g.dir,axisName:g.name}:{position:a.clone(),constrainedAxis:d,axisName:o.e.NONE}}})()},68519:(e,t,i)=>{"use strict";i.d(t,{s:()=>l,n:()=>c});var s=i(62367),n=i(25799),o=i(51770),r=i(44266);const a=new n.Z("expiring-resource");function l(e,t){(0,o.yW)(e,(e=>{e instanceof c&&(e.onStale=t)}))}class c{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil,this.refreshPromise&&(this.refreshPromise.resolve(),this.refreshPromise=void 0)}waitForRefresh(e=1e4){this.refreshPromise||(this.refreshPromise=new r.Q);const t=(0,s.gw)(e).then((()=>{throw new Error("Waiting for resource url refresh timed out")}));return Promise.race([this.refreshPromise.nativePromise(),t])}async get(){if(this.validUntil&&this.onStale){const e=Date.now();e+6e4+1e4>this.validUntil.getTime()&&this.onStale(),e+6e4+1e3>this.validUntil.getTime()&&(a.warn("Stale resource, waiting for refresh"),await this.waitForRefresh(),a.info("Refreshed resource"))}return this.value}}},70691:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>o,FM:()=>r,UQ:()=>a});var s=i(2212);class n{constructor(e,t){this.raycast=(()=>{const e=new s.Pa4,t=new s.ZzF;return(i,s,o)=>{const l=t.copy(this.bounds).expandByScalar(s);if(i.ray.intersectsBox(l))for(const t of this.children)if(t instanceof n)t.raycast(i,s,o);else if(t instanceof r){const n=e,r=i.ray.distanceSqToSegment(t.start,t.end,void 0,e),a=Math.sqrt(r);a<s&&o.push({distance:i.ray.origin.distanceTo(n),object:t,distanceToRay:a,point:n.clone(),isLineOctreeIntersection:!0})}else if(t instanceof a){const e=i.ray.distanceToPoint(t);e<s&&o.push({distance:i.ray.origin.distanceTo(t),object:t,distanceToRay:e,point:t.clone(),isLineOctreeIntersection:!0})}}})(),this.level=t,this.bounds=e.clone(),this.childNodes=[],this.children=[]}add(e){let t=!1;const i=e instanceof s.Zzh?[e.start,e.end]:[e];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const s of this.childNodes)i.every((e=>s.bounds.containsPoint(e)))&&(t=!0,s.add(e))}t||this.children.push(e)}remove(e){const t=e instanceof s.Zzh?[e.start,e.end]:[e];for(let i=0;i<this.children.length;i++){const s=this.children[i];if(s instanceof n){if(t.every((e=>s.bounds.containsPoint(e)))&&s.remove(e))return!0}else if(s===e)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const e=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let o=0;o<2;o++){const r=this.bounds.min.x+e.x*o,a=r+e.x,l=this.bounds.min.y+e.y*t,c=l+e.y,h=this.bounds.min.z+e.z*i,d=h+e.z,u=new s.ZzF(new s.Pa4(r,l,h),new s.Pa4(a,c,d)),p=new n(u,this.level+1);this.childNodes.push(p),this.children.push(p)}}spherecast(e,t){if(e.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof n)i.spherecast(e,t);else if(i instanceof r){const n=i.closestPointToPoint(e.center,!0,new s.Pa4);n.distanceTo(e.center)<e.radius&&t.push(new a(n,i.floorId,i.roomId))}else i instanceof s.Pa4&&i.distanceTo(e.center)<e.radius&&t.push(i)}traverse(e){for(const t of this.children)t instanceof n?t.traverse(e):e(t)}}class o{constructor(e){this.pointCount=0,this.lineCount=0,this.root=new n(e,0)}add(e){e instanceof s.Zzh?this.lineCount++:e instanceof s.Pa4&&this.pointCount++,this.root.add(e)}remove(e){e instanceof r?this.lineCount--:e instanceof a&&this.pointCount--,this.root.remove(e)}traverse(e){this.root.traverse(e)}raycast(e,t){const i=[];return this.root.raycast(e,t,i),i}}class r extends s.Zzh{constructor(e,t,i,s){super(e,t),this.start=e,this.end=t,this.floorId=i,this.roomId=s,this.isSnapLine3=!0}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new r(this.start,this.end,this.floorId,this.roomId)}}class a extends s.Pa4{constructor(e,t,i){super(),this.point=e,this.floorId=t,this.roomId=i,this.isSnapVector3=!0,super.copy(e)}copy(e){return this.point.copy(e.point),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new a(this.point,this.floorId,this.roomId)}}},96041:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});class s{constructor(){this.activePromise=Promise.resolve(new n)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new n)))})),t=this.activePromise;return this.activePromise=e,t}}class n{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},91055:(e,t,i)=>{"use strict";i.d(t,{Pp:()=>r,s1:()=>a,r0:()=>l,m$:()=>c,D7:()=>h,Ll:()=>d,n0:()=>u,fd:()=>p,Fe:()=>m,YN:()=>g,k2:()=>f,mY:()=>v,_U:()=>y,S3:()=>b,J2:()=>w});var s=i(2212),n=i(56040),o=i(27829);i(76807),i(45805);const r=e=>!!e&&1===e.elements[15],a=e=>!!e&&e.elements[15]>0&&e.elements[15]<1,l=(new s.Tme,new s.Pa4,(()=>{const e=new s.Pa4;return(t,i,s,n)=>(e.copy(t).sub(i),e.clampLength(s,n),i.clone().add(e))})()),c=(()=>{const e=new s.Pa4;return(t,i,s,n)=>{e.copy(i).sub(t);const o=Math.atan2(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)),e.y),r=Math.min(Math.max(s,o),n);return Math.abs(o-r)>Number.EPSILON?h(t,i,o-r,!1):t}})(),h=(()=>{const e=new s.Pa4,t=new s.Pa4;return(i,s,n,r)=>(e.copy(s).sub(i),r?t.copy(o.f.UP):t.copy(e).applyAxisAngle(o.f.UP,-1*Math.PI/2).setY(0).normalize(),e.applyAxisAngle(t,n),s.clone().sub(e))})(),d=(()=>{const e=new s.Pa4,t=new s.Pa4;return(i,n,o)=>(e.copy(i).sub(n).normalize(),t.copy(i).sub(o).normalize(),(new s._fP).setFromUnitVectors(e,t))})(),u=(()=>{const e=new n.M;return(t,i)=>(e.setPosition(t),e.lookAt(t,i,o.f.UP),(new s._fP).setFromRotationMatrix(e.asThreeMatrix4()))})(),p=(()=>{const e=new s.Pa4;return(t,i,s)=>(e.copy(o.f.FORWARD).applyQuaternion(t).normalize(),e.clone().multiplyScalar(-1*s).add(i))})(),m=(()=>{const e=new s.zHn,t=new s.Pa4,i=new s.Pa4;return(s,n,r)=>(i.set(0,0,0),t.copy(o.f.FORWARD).applyQuaternion(n),e.set(s,t),e.intersectPlane(r,i))})(),g=(()=>{const e=new s.Pa4,t=new s.Pa4,i=new s.Pa4,n=new s.Pa4,r=[new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4],a=new s.Pa4,l=new s.Pa4,c=new s.Pa4,h=new s.Pa4,d=new s.JOQ,p=new s.Pa4,m=new s.zHn,g=new s.Pa4,f=new s.Pa4;return(s,v,y,b,w,S)=>{e.copy(o.f.FORWARD).applyQuaternion(v).setY(0),t.copy(e).setY(y).normalize(),n.copy(t).applyAxisAngle(o.f.UP,-Math.PI/2).setY(0).normalize(),i.copy(n).cross(t).normalize();let T=0;const E=b.max,_=b.min,x=[E,_];for(let e=0;e<2;e++){const t=x[e].x;for(let e=0;e<2;e++){const i=x[e].y;for(let e=0;e<2;e++){const s=x[e].z;r[T].set(t,i,s),T++}}}a.copy(_),c.copy(s).setY(_.y);let M=l.copy(a).sub(c).dot(t);r.forEach((e=>{if(e.y===E.y)return;const i=l.copy(e).sub(c).dot(t);i<M&&(a.copy(e),M=i)}));const P=Math.sign(a.dot(n));h.copy(a).setX(a.x===E.x?_.x:E.x),Math.sign(h.dot(n))!==P?d.set(p.set(0,0,-1*Math.sign(a.z)),Math.abs(a.z)):(h.copy(a).setZ(a.z===E.z?_.z:E.z),d.set(p.set(-1*Math.sign(a.x),0,0),Math.abs(a.x))),m.set(s,g.copy(t).multiplyScalar(-1)),m.intersectPlane(d,f);const A=Math.min(Math.abs(f&&f.dot(t)),M);let O=0,D=0;r.forEach((function(e){l.copy(e).sub(s);const t=Math.abs(l.dot(n)),o=Math.abs(l.dot(i));t>O&&(O=t),o>D&&(D=o)}));const I=O/Math.tan(w*S/2),C=D/Math.tan(w/2),R=Math.max(I,C)+Math.abs(A),L=s.clone().add(t.clone().multiplyScalar(1.1*-R));return{position:L,rotation:u(L,s)}}})(),f=(new s.yGw,new s.yGw,new s.Ltg,(()=>{const e=new s.Pa4;return(t,i,s=o.f.UP)=>{const n=t.angleTo(i);return Math.sign(e.crossVectors(t,i).dot(s))*n}})()),v=(new n.M,new s.Pa4,(e,t,i,s,n=1.5)=>{const o=1/e.elements[5];if(r(e))return n*s/(2*o);const a=t.distanceTo(i),l=Math.atan(o);return s*(n/(2*Math.tan(l)*a))}),y=function(){const e=new s.Pa4,t=new s.yGw;return(i,s,n)=>{const o=e.set(0,0,-i).applyMatrix4(s).z;return t.copy(s),t.invert(),e.set(2/n,0,o).applyMatrix4(t),e.x}}(),b=e=>1/e.elements[5],w=(()=>{const e=new s.Pa4;return(t,i,s)=>{const n=s.angleTo(o.f.UP),r=Math.abs(n-Math.PI);return n<.2||r<.2?(t.quaternion.setFromUnitVectors(o.f.FORWARD,s),!0):(t.lookAt(e.copy(i).add(s)),!1)}})();new s.Pa4,new s.Pa4(1e4,1e4,1e4),new s.Zzh,new s.Zzh,new s.Zzh,new s.Zzh,new s.Pa4,new s.Pa4,new s.Pa4,new s.Pa4},60982:(e,t,i)=>{"use strict";i.d(t,{iN:()=>s,mB:()=>n,uU:()=>o}),i(2212);const s=(e,t)=>e.x===t.x&&e.y===t.y&&e.z===t.z,n=e=>!e||!Object.values(e).filter((e=>0!==e)).length,o=e=>(e=>"object"==typeof e&&"x"in e&&"y"in e)(e)&&"z"in e},76807:(e,t,i)=>{"use strict";i.d(t,{r6:()=>s,a9:()=>n,wo:()=>o,R2:()=>r});const s=(e,t,i=1e-5)=>Math.abs(e-t)<=i,n=(e,t,i=1e-5)=>s(e.x,t.x,i)&&s(e.y,t.y,i),o=(e,t,i=1e-5)=>n(e,t,i)&&s(e.z,t.z,i),r=(e,t,i=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,n)=>!s(e,t[n],i)))},97620:(e,t,i)=>{"use strict";i.d(t,{Ue:()=>l,MN:()=>c,ep:()=>h,gj:()=>d,EV:()=>u,tf:()=>p,Pq:()=>m,uZ:()=>g,dK:()=>f,zW:()=>v,cb:()=>y,rj:()=>b,jB:()=>w,et:()=>S,dS:()=>T,Z:()=>_,Rq:()=>x,Xe:()=>M,Xv:()=>P});var s=i(2212),n=i(56040),o=i(27829);const r=new s.iWj,a=new n.M,l=(new s.aLr,Math.PI/180),c=180/Math.PI;var h;!function(e){e.fromVisionVector=function(e){return new s.Pa4(e.x,e.z,-e.y)},e.toVisionVector=function(e){return new s.Pa4(e.x,-e.z,e.y)},e.fromVisionQuaternion=function(e){return new s._fP(e.x,e.z,-e.y,e.w).multiply((new s._fP).setFromAxisAngle(new s.Pa4(0,1,0),s.M8C.degToRad(90)))},e.fromVisionCameraQuaternion=function(e){return new s._fP(-e.x,-e.z,e.y,-e.w).multiply((new s._fP).setFromAxisAngle(new s.Pa4(1,0,0),s.M8C.degToRad(90)))},e.toVisionQuaternion=function(e){const t=new s._fP(e.x,e.y,e.z,e.w).multiply((new s._fP).setFromAxisAngle(new s.Pa4(0,1,0),s.M8C.degToRad(-90)));return t.set(t.x,-t.z,t.y,t.w),t},e.toVisionCameraQuaternion=function(e){return new s._fP(e.x,-e.z,e.y,e.w).multiply(new s._fP(-.70710678118,0,0,.70710678118))}}(h||(h={}));const d=function(e){return new s.Pa4(-e.x,e.y,e.z)},u=function(e){return new s._fP(e.z,e.w,e.x,e.y)},p=function(e){return Math.cos(s.M8C.degToRad(e/2))};function m(e,t,i){return t<=e&&e<=i}const g=function(e,t,i){return Math.max(t,Math.min(e,i))},f=function(e){e.r=g(e.r,0,1),e.g=g(e.g,0,1),e.b=g(e.b,0,1)},v=function(e,t){const i=new s.Pa4(0,0,-1);return i.clone().applyQuaternion(e).angleTo(i.clone().applyQuaternion(t))},y=(e,t,i,s)=>(a.identity().makeRotationFromQuaternion(t).setPosition(e),a.getInverse(a),a.premultiply(i),r.setFromProjectionMatrix(a.asThreeMatrix4()),r.intersectsBox(s)),b=e=>{const t=e.getSize(new s.Pa4),i=Math.max(t.x,t.y,t.z);return(new s.ZzF).setFromCenterAndSize(e.getCenter(new s.Pa4),new s.Pa4(i,i,i))},w=(e,t)=>{if(t.length<8)throw new Error("getPointsFromBox3: Result array to small!");t[0].copy(e.min),t[1].copy(e.min),t[1].x=e.max.x,t[2].copy(e.min),t[2].y=e.max.y,t[3].copy(e.min),t[3].z=e.max.z,t[4].copy(e.max),t[5].copy(e.max),t[5].x=e.min.x,t[6].copy(e.max),t[6].y=e.min.y,t[7].copy(e.max),t[7].z=e.min.z},S=(e,t,i,s,n)=>(e-t)/(i-t)*(n-s)+s,T=(e,t,i,s,n)=>{const o=S(e,t,i,s,n);return g(o,s,n)};function E(e){return 0===e.x&&0===e.y&&0===e.z}const _=(()=>{const e=new s.Pa4,t=new s.yGw;return i=>E(i)?i.clone():(e.copy(o.f.FORWARD).applyQuaternion(i),t.lookAt(o.f.ZERO,e,o.f.UP),(new s._fP).setFromRotationMatrix(t))})(),x=(()=>{const e=new s.Pa4,t=new s.yGw;return(i,s)=>E(i)?s.copy(i):(e.copy(o.f.FORWARD).applyQuaternion(i).setY(0).normalize(),t.lookAt(o.f.ZERO,e,o.f.UP),s.setFromRotationMatrix(t))})(),M=(()=>{const e=new s.Pa4,t=new s.zHn;return(i,n,o,r)=>(r=r||new s.Pa4,t.origin.copy(i),t.lookAt(n),r.copy(t.at(o,e)))})(),P=(()=>{const e=new s.Pa4,t=new s.zHn;return(i,n,o,r)=>(r=r||new s.Pa4,t.set(i,n),r.copy(t.at(o,e)))})()},99774:(e,t,i)=>{"use strict";i.d(t,{L:()=>s});class s{constructor(e){this.comparer=e||this.defaultComparer,this.poolArray=[]}add(e){const t=this.createObjectDescriptor(e);return t.object=e,t.inUse=!0,this.addObjectDescriptorToPool(t),t}get(e){for(const t of this.poolArray)if(!t.inUse&&this.comparer(t,e))return t.inUse=!0,t;return null}free(e){for(const t of this.poolArray)if(t.object===e)return t.inUse=!1,!0;return!1}all(){return this.poolArray}remove(e){const t=this.poolArray.findIndex((t=>t.object===e));return-1!==t&&(this.poolArray.splice(t,1),!0)}defaultComparer(e,t){return!0}createObjectDescriptor(e){return{object:e,inUse:!1}}addObjectDescriptorToPool(e){this.poolArray.push(e)}}},44266:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s});class s{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new n(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new s;return e.resolve(),e.promise()}static reject(e){const t=new s;return t.reject(e),t.promise()}static all(e){const t=[];for(const i of e)i.nativePromise?t.push(i.nativePromise()):t.push(i);const i=new s;return Promise.all(t).then((e=>i.resolve(e)),(e=>i.reject(e))),i.promise()}}class n{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}},86515:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const s=e=>""+e;class n{constructor(e=s){this.mappingFunction=e,this.list=[],this.map={}}add(e){const t=this.mappingFunction(e);return!this.map[t]&&(this.list.push(e),this.map[t]=e,!0)}set(e){const t=this.mappingFunction(e);return this.map[t]?(this.map[t]=e,!0):(this.add(e),!0)}count(){return this.list.length}*[Symbol.iterator](){for(const e of this.list)yield e}getByIndex(e){return this.list[e]}get(e){return this.map[e]}copyToList(e){return e.push.apply(e,this.list),e}clear(){this.list=[],this.map={}}mapElements(e){return this.list.map(e)}}},67569:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});class s{constructor(e){this._value=e}value(){return this._value}set(e){this._value=e}}class n{constructor(){this.storage={}}get(e,t){let i=this.storage[e];return i||(i=t(),this.storage[e]=i),i}getNumber(e){return this.get(e,(()=>new s(0)))}getString(e){return this.get(e,(()=>new s("")))}getArray(e){return this.get(e,(()=>[]))}getNumberMap(e){return this.get(e,(()=>({})))}getStringMap(e){return this.get(e,(()=>({})))}}},40032:(e,t,i)=>{"use strict";i.d(t,{m:()=>n,J5:()=>o,Ex:()=>r});var s=i(62367);function n(e){return{x:e.x,y:e.y,z:e.z}}function o(e){return{x:e.x||e._x,y:e.y||e._y,z:e.z||e._z,w:e.w||e._w}}function r(e){return`#${(0,s.Q_)(255*e.r,2,"0",16)}${(0,s.Q_)(255*e.g,2,"0",16)}${(0,s.Q_)(255*e.b,2,"0",16)}`}},83974:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});var s=i(2212);class n extends s.Kj0{constructor(e,t){super(e,t)}}},290:(e,t,i)=>{"use strict";i.d(t,{z:()=>r});var s=i(1799),n=i(78909);const o=new(i(25799).Z)("animation");class r extends n.T{constructor(e,t,i,n=s.vG,o=0){super(),this._easing=s.vG,void 0===t&&(t=e),void 0===i&&(this._active=!1,i=0,this._elapsed=0,this._duration=0),this.modifyAnimation(e,t,i,n,0,o)}get active(){return this._active}get duration(){return this._duration}get endValue(){return this._endValue}get easing(){return this._easing}get elapsed(){return this._elapsed}tick(e){if(!this._active)return this.endValue;if(this._delay>0)return this._delay-=e,this.startValue;const t=(this._elapsed+e)/Math.max(this._duration,1e-5);return this.updateProgress(t),this.value}updateProgress(e){if(isNaN(e))return void o.error(`Invalid progress value: ${e}`);const t=Math.max(0,Math.min(e,1)),i=this.active,s=this.value;if(t>=1)return this.activate(!1),this.value=this.endValue,this._elapsed=this.duration,this.commit(),void(this._onComplete&&this._onComplete());this.activate(!0),this.value=this._easing(t,this.startValue,this._endValue-this.startValue,1),this._elapsed=t*this.duration,s===this.value&&i===this.active||this.commit()}updateAbsolute(e){const t=e/Math.max(this._duration,1e-5);this.updateProgress(t)}modifyAnimation(e,t,i,n=s.vG,o=0,r=0){return this._easing=n,this._endValue=t,this._duration=i,this.activate(this._duration>=0&&e!==t),this._elapsed=o,this._delay=r,this.startValue=e,this.value=e,this.commit(),this}onComplete(e){return this._onComplete=e,this}activate(e){this._active=e}copy(e){this._endValue=e.endValue,this._duration=e.duration,this._active=e.active,this._easing=e.easing,this._elapsed=e.elapsed,this.startValue=e.startValue,this.value=e.value,this.commit()}clone(){const e=new r(0);return e.copy(this),e}stop(e){this._active=!1,this._elapsed=this._duration,this.value=e,this._endValue=e,this.commit()}equals(e){return this._active===e._active&&this.duration===e.duration&&this.easing===e.easing&&this.elapsed===e.elapsed&&this.endValue===e.endValue&&this.startValue===e.startValue&&this.value===e.value}}},21307:(e,t,i)=>{"use strict";i.d(t,{b:()=>s});const s=(e,t)=>{if(0!==e.length)for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}},21746:(e,t,i)=>{"use strict";i.d(t,{g$:()=>s,LP:()=>n,yB:()=>o});const s=16/9,n=1/s,o=function(e,t){return Math.min(Math.max(t/e,n),1)*e}},21265:(e,t,i)=>{"use strict";i.d(t,{dy:()=>n,tq:()=>o,_1:()=>r,s:()=>a,V5:()=>l,Kr:()=>c,w1:()=>h,Dt:()=>d,Ot:()=>u,Jm:()=>p,J1:()=>m,yL:()=>g,hu:()=>f,$K:()=>v,fp:()=>y,m8:()=>b,AO:()=>w,UD:()=>S,Vf:()=>T,Hx:()=>E,mI:()=>_,rm:()=>x,O6:()=>M,Zx:()=>P,Qg:()=>A,PI:()=>O,ht:()=>D});const s=new(i(25799).Z)("util-browser"),n=()=>{const e=window.innerWidth/window.innerHeight;return isFinite(e)?e:1},o=function(){const e=navigator.userAgent||navigator.vendor,t=new RegExp("(android|bbd+|meego).+mobile|android|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|\n    hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|\n    palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|\n    wap|windows ce|xda|xiino","i"),i=new RegExp("1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|\n    amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|\n    br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|\n    devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|\n    g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|\n    a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|\n    jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|\n    m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|\n    zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|\n    nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|\n    po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|\n    sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|\n    sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|\n    tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|\n    vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|\n    zeto|zte-","i");return(t.test(e)||i.test(e.substr(0,4))||r())&&!u()},r=()=>{const e=window.navigator.userAgent;return/iPad/.test(e)||l()&&navigator.maxTouchPoints>1},a=()=>{const e=window.navigator.userAgent;return/iPod|iPhone|iPad/.test(e)},l=()=>{const e=window.navigator.platform;return/MAC/.test(e.toUpperCase())},c=()=>{const e=window.navigator.platform;return/WIN/.test(e.toUpperCase())},h=()=>{const e=window.navigator.userAgent;return/Trident\//.test(e)},d=()=>-1!==window.navigator.userAgent.indexOf("Android"),u=()=>-1!==window.navigator.userAgent.indexOf("OculusBrowser"),p=()=>"ontouchstart"in window,m=()=>"share"in navigator&&(o()||r()),g=()=>window.parent!==window,f=function(e,t){const i=new RegExp("[#&?]"+e+"=([^#&?]*)").exec(window.location.href);if(!i)return t;const s=i[1];return"boolean"==typeof t?"true"===s||"1"===s:"number"==typeof t?parseFloat(s):decodeURIComponent(s)},v=function(e,t){const i=new RegExp(e+"=([^;]+)|$").exec(document.cookie);if(!i)return t;const s=i[1];return"boolean"==typeof t?"true"===s||"1"===s:"number"==typeof t?parseFloat(s):s},y=function(e,t){if(!("localStorage"in window))return t;let i;try{i=window.localStorage.getItem(e)}catch(e){return s.debug(e),t}return null===i?t:"boolean"==typeof t?"true"===i:"number"==typeof t?parseFloat(i):i},b=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){s.error(e)}},w=e=>{const t=/[#&?]([^=]+)=([^#&?]+)/g;e=e||window.location.href;const i={};let s;for(;null!==(s=t.exec(e));)i[s[1]]=decodeURIComponent(s[2]);return i},S=()=>window.location.search.substr(1).split("&"),T=e=>{const t=Object.keys(e).map((t=>t+"="+e[t])).join("&"),i=`${window.location.origin}${window.location.pathname}?${t}`;window.location.replace(i)},E=function(){const e=window.URL||window.webkitURL,t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",(i,s)=>{const n=e.createObjectURL(i);t.href=n,t.download=s,t.click(),e.revokeObjectURL(n)}}(),_=()=>n()>1,x=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},M=function(){return!o()&&!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)},P=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},A=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()};function O(e){try{return document.featurePolicy.allowsFeature(e)}catch(t){return s.warn(t),s.warn(`Feature Policy check failed, defaulting ${e} to false.`),!1}}const D=()=>(e=>{const t={language:"en",region:void 0,script:void 0,ext:void 0},i=new RegExp([/^([a-z]{2,3})/,/(?:[_-]([ut]{1}[_-][a-z\-\_]+))?/,/(?:[_-]([a-z]{4}))?/,/(?:[_-]([a-z]{2}))?$/].map((e=>e.source)).join(""),"i").exec(e);if(i){const[,e,s,n,o]=i;Object.assign(t,{language:e,ext:s,script:n,region:o})}return t})(navigator.language).language},69281:(e,t,i)=>{"use strict";i.d(t,{G1:()=>r,rn:()=>a,D5:()=>l,Ex:()=>c});var s=i(2212),n=i(62367);const o=()=>Math.random(),r=(e=.25)=>new s.Ltg(o(),o(),o(),e),a=()=>new s.Ilk(o(),o(),o()),l=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function c(e){return`#${(0,n.Q_)(255*e.r,2,"0",16)}${(0,n.Q_)(255*e.g,2,"0",16)}${(0,n.Q_)(255*e.b,2,"0",16)}`}},22748:(e,t,i)=>{"use strict";function s(e,t,...i){for(const s of i)e[s]=t[s]}i.d(t,{B:()=>s})},32020:(e,t,i)=>{"use strict";i.d(t,{U:()=>n,p:()=>o});const s=new Object,n=e=>{if(e){const t=e.valueOf();if(!isNaN(t))return e.toISOString()}return(new Date).toISOString()},o=(e,t=s)=>{if(e){const t=new Date(e);if(!isNaN(t.valueOf()))return t}return t===s?new Date:t}},39990:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});const s=(e,t=250)=>{let i;return(...s)=>{clearTimeout(i),i=window.setTimeout((()=>e.apply(null,s)),t)}}},90709:(e,t,i)=>{"use strict";i.d(t,{_F:()=>n,zy:()=>o,XJ:()=>r});const s=.3048,n=e=>e*s,o=e=>e/s,r=e=>{const t=e/s;let i=Math.floor(t),n=12*t%12;return 12===Math.round(n)?(i+=1,n=0):n=Math.round(n),{feet:i,inches:n}}},1799:(e,t,i)=>{"use strict";i.d(t,{vG:()=>o,FG:()=>r,hl:()=>a,to:()=>l,Q9:()=>c,w2:()=>h,qb:()=>d,Fs:()=>u,e3:()=>p,tf:()=>m});var s=i(69436),n=i.n(s);const o=function(e,t,i,s){return i*e/s+t},r=function(e,t,i,s){return i*(e/=s)*e+t},a=function(e,t,i,s){return-i*(e/=s)*(e-2)+t},l=function(e,t,i,s){return(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},c=function(e,t,i,s){return i*(e/=s)*e*e+t},h=function(e,t,i,s){return e/=s,i*(--e*e*e+1)+t},d=function(e,t,i,s){return(e/=s/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},u=function(e,t,i,s){return-i/2*(Math.cos(Math.PI*e/s)-1)+t},p=(e,t,i,s,n)=>{let o=t;if(n>0){const t=(1-Math.max(n,0))*Math.abs(s);o=i<=t?0:e(i-t,0,1,t)}return o};function m(e,t,i,s){const o=new(n())(e,t,i,s);return(e,t,i,s)=>{const n=e/s;return t+i*o.solve(n)}}},14408:(e,t,i)=>{"use strict";i.d(t,{J:()=>s});const s=(e,t)=>{const i=Object.keys(e);for(const s of i)if(e[s]===t)return!0;return!1}},3159:(e,t,i)=>{"use strict";i.d(t,{bX:()=>s,z6:()=>n});const s=e=>void 0!==e.pointerId,n=e=>void 0!==e.changedTouches},42915:(e,t,i)=>{"use strict";i.d(t,{qe:()=>s});const s={negate:e=>function(t){return!e.call(e,t)},every:(...e)=>function(t){return e.every((e=>e(t)))},some:(...e)=>function(t){return e.some((e=>e(t)))}}},46266:(e,t,i)=>{"use strict";i.d(t,{q:()=>o,A:()=>l});var s=i(2212),n=i(27829);function o(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,i=0,n=0,o=0;const a=new s.ZzF;for(const s of e)s.index&&(t+=s.index.count,i+=s.getAttribute("position").count,s.getAttribute("uv")&&(n+=s.getAttribute("uv").count),s.boundingBox&&(a.union(s.boundingBox),o++));const c=new s.u9r;o!==e.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(l(c)),c.boundingSphere=a.getBoundingSphere(new s.aLr);const h=r(new Float32Array(3*i),"position",e);c.setAttribute("position",new s.TlE(h,3));const d=function(e,t){let i=0,s=0;for(const n of t){const t=n.index;for(let n=0;n<t.array.length;n++)e[i+n]=t.array[n]+s;i+=t.array.length,s+=n.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new s.TlE(d,1)),n){const t=r(new Float32Array(2*n),"uv",e);c.setAttribute("uv",new s.TlE(t,2))}return c}function r(e,t,i){let s=0;for(const n of i){const i=n.getAttribute(t);e.set(i.array,s),s+=i.array.length}return e}const a=new s.ZzF(n.f.ZERO,n.f.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||a}},62367:(e,t,i)=>{"use strict";i.d(t,{DM:()=>o,gw:()=>r,Ig:()=>a,XN:()=>l,VS:()=>c,Yv:()=>h,TH:()=>d,Jq:()=>u,Pe:()=>p,DZ:()=>m,Q_:()=>g,O1:()=>f,$B:()=>v,ow:()=>y,nr:()=>b,lY:()=>w}),i(2212);var s=i(31260);const n=[];for(let e=0;e<256;e++)n[e]=(e<16?"0":"")+e.toString(16);function o(){let e;const t=window.crypto||window.msCrypto;return e=t?t.getRandomValues(new Uint8Array(16)):new Uint8Array(16).map((()=>255*Math.random())),e[6]=15&e[6]|64,e[8]=63&e[8]|128,n[e[0]]+n[e[1]]+n[e[2]]+n[e[3]]+"-"+n[e[4]]+n[e[5]]+"-"+n[e[6]]+n[e[7]]+"-"+n[e[8]]+n[e[9]]+"-"+n[e[10]]+n[e[11]]+n[e[12]]+n[e[13]]+n[e[14]]+n[e[15]]}const r=function(e){return new Promise(((t,i)=>{setTimeout(t,e)}))},a=e=>{let t,i=-1;return{promise:new Promise(((s,n)=>{t=s,i=window.setTimeout(s,e)})).then((()=>{i=-1})),cancel:()=>{-1!==i&&(window.clearTimeout(i),t())}}},l=function(e){const t={};for(const i of e)t[i]=i;return t},c=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const s of e)t.add(s),i++;return t.divideScalar(i),t},h=function(e){return!e.replace(/\n/g,"").trim().length},d=function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},u=function(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0},p=function(e,t,i=!0){if(0===e.length)return null;i&&e.sort((function(e,t){return e-t}));const s=t/100;return e[Math.floor(e.length*s)]},m=function(e){return[g(e.getMonth()+1),".",g(e.getDate()),".",e.getFullYear(),"_",g(e.getHours()),".",g(e.getMinutes()),".",g(e.getSeconds())].join("")},g=function(e,t=2,i="0",s=10){const n=e.toString(s),o=t-n.length+1;return o>0?new Array(o).join(i)+n:n},f=function(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},v=e=>{const t=[];for(let i=0;i<e.length;i+=8192)t.push(String.fromCharCode.apply(null,e.subarray(i,i+8192)));return btoa(t.join(""))},y=(e=[])=>{const t={};for(const i of e)t[i]=!0;return t};function b(e,t){return e.hasOwnProperty(t)}const w=(e,t,i)=>{if(!(Math.abs(e)<4294967295&&t<32&&i<32))throw new s.Z("argument out of range");const n=1&(e>>>t^e>>>i);return(e^=n<<t|n<<i)>>>0}},35175:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});const s=new(i(25799).Z)("passive-support"),n=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>{e=!0}});return window.addEventListener("testPassive",(()=>{}),t),window.removeEventListener("testPassive",(()=>{}),t),e}catch(e){return s.warn(`Passive Option for addEventListener is not supported, Safari zoom may not perform as expected: ${e}`),!1}})()},25799:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});const s=window.navigationStart||Date.now();var n;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(n||(n={}));class o{constructor(e){this.timers={},this.handlers={[n.DEBUG]:console.debug,[n.INFO]:console.info,[n.WARN]:console.warn,[n.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){return o.level>=e&&console?(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix()):()=>{}}get debug(){return this.message(n.DEBUG)}get debugWarn(){return this.message(o.level>=n.DEBUG?n.WARN:n.DEBUG)}get info(){return this.message(n.INFO)}get warn(){return this.message(n.WARN)}get error(){return this.message(n.ERROR)}time(e){o.level>=n.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(o.level>=n.DEBUG){const t=this.timers[e];if(!t)return;const i=(Date.now()-t)/1e3;this.debug(e,i+"s")}}getPrefix(){const e=(Date.now()-s)/1e3+"s";return`${this.prefix} ${e}`}}o.level=n.INFO},31017:(e,t,i)=>{"use strict";i.d(t,{M:()=>E});var s=i(27829),n=i(2212);class o{constructor(e,t,i){return this.thisType=e,this.container=t,this.mesh=i(),this.mesh.name=`${e.name}`,this.material=this.mesh.material,this.geometry=this.mesh.geometry,this}opacity(e){return this.material.opacity=e,this}}function r(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))}class a{constructor(){this.animationInit=!1}initAnimationMixin(e,t){this.animState={scale:t?t.clone():new n.Pa4(1,1,1),position:e?e.clone():new n.Pa4,target:{scale:t?t.clone():new n.Pa4(1,1,1),position:e?e.clone():new n.Pa4},temp:{pos:new n.Pa4,scale:new n.Pa4,makeScale:new n.Pa4}},this.animationInit=!0}update(e,t){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable update, because I said so.`);this.mesh.position.copy(e);const i=this.vector3From(t);return i.equals(this.mesh.scale)||this.mesh.scale.copy(i),this.animState.scale.copy(this.mesh.scale),this.animState.position.copy(this.mesh.position),this.mesh.updateMatrixWorld(!0),this}animate(e,t,i){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable animations, because I said so.`);const s=this.vector3From(i);this.animState.target.scale.copy(s),this.animState.target.position.copy(t);const n=this.animState.temp.pos.copy(this.mesh.position).lerp(t,e),o=this.animState.temp.scale.copy(this.mesh.scale).lerp(s,e);return this.update(n,o),this}vector3From(e){if(e instanceof n.Pa4)return this.animState.temp.makeScale.copy(e).clamp(c,h);if("number"==typeof e)return this.animState.temp.makeScale.set(e,e,e).clamp(c,h);throw Error("Unexpected scale input")}}const l=.01,c=new n.Pa4(l,l,l),h=new n.Pa4(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);class d{toggle(e){return e?this.container.add(this.mesh):this.container.remove(this.mesh),this.isVisible=e,this}}class u extends o{constructor(e,t){super(u,e,(()=>new n.Kj0(new n.DvJ(1,1,1),new n.vBJ(t)))),this.container=e,this.style="Box",this.mesh.frustumCulled=!1,this.geometry.computeBoundingBox(),this.initAnimationMixin()}}r(u,[a,d]);class p extends o{constructor(e,t){super(p,e,(()=>{const e=new n.GQ((new n.ZzF).setFromCenterAndSize(new n.Pa4,new n.Pa4(1,1,1)));return new n.ejS(e.geometry,e.material)})),this.container=e,this.style="BoxWireframeMesh",t&&this.material.setValues(t),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(p,[d,a]);class m extends o{constructor(e,t){super(m,e,(()=>new n.Rki(t))),this.container=e,this.style="CameraHelper",this.updateCamera(t)}updateCamera(e){return this.mesh.camera.copy(this.camWithSaneFarDistance(e)),this.mesh.update(),this}camWithSaneFarDistance(e){const t=e.clone();return t.far=5,t}}r(m,[d]);class g extends o{constructor(e,t){super(g,e,(()=>new n.Kj0(new n._12(1),new n.vBJ(t)))),this.container=e,this.style="PlaneMesh",this.radius=1;const i=new n.yGw;i.makeRotationFromEuler(new n.USm(-Math.PI/2,0,0,"XYZ")),this.geometry.applyMatrix4(i),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(g,[d,a]);class f extends o{constructor(e,t){super(f,e,(()=>new n.Kj0(new n.xo$(1),new n.vBJ(t)))),this.container=e,this.style="SphereMesh",this.radius=1,this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(f,[d,a]);var v=i(61956);class y extends o{constructor(e,t){return super(y,e,(()=>new n.x12(new n.u9r,new n.nls(Object.assign({color:v.I.MP_BRAND,opacity:1,transparent:!0},t))))),this.container=e,this.positionsBuffer=new n.TlE(new Float32Array(150),3),this.point=new n.Pa4,this.points={start:new n.Pa4,control:new n.Pa4,end:new n.Pa4},this.updatePoints=(e,t,i)=>{this.points.start.copy(this.curve.v0.copy(e)),this.points.control.copy(this.curve.v1.copy(t)),this.points.end.copy(this.curve.v2.copy(i));for(let e=0;e<50;e++){const t=e/49;this.curve.getPoint(t,this.point),this.positionsBuffer.setXYZ(e,this.point.x,this.point.y,this.point.z)}return this.positionsBuffer.needsUpdate=!0,this},this.animatePoints=(e,t,i,s)=>{const{start:n,control:o,end:r}=this.points;return n.equals(o)&&n.equals(r)?(this.updatePoints(t,i,s),this):(n.lerp(t,e),o.lerp(i,e),r.lerp(s,e),this.updatePoints(n,o,r),this)},this.mesh.frustumCulled=!1,this.curve=new n.mXe(new n.Pa4,new n.Pa4,new n.Pa4),this.geometry.setAttribute("position",this.positionsBuffer),this.geometry.computeBoundingBox(),this}}r(y,[d]);var b=i(30041),w=i(50101),S=i(59120),T=i(74725);class E{constructor(e){this.cache={},this.helperCache={},this.toggle=e=>(this.options.scene&&(e?this.options.scene.add(this.options.container):this.options.scene.remove(this.options.container)),this),this.box=(e,t)=>(this.cache[M.box][e]||(this.cache[M.box][e]=new u(this.options.container,t).toggle(!0)),this.cache[M.box][e]),this.boxWire=(e,t)=>(this.cache[M.boxWire][e]||(this.cache[M.boxWire][e]=new p(this.options.container,t).toggle(!0)),this.cache[M.boxWire][e]),this.cam=(e,t)=>(this.cache[M.cameraHelper][e]||(this.cache[M.cameraHelper][e]=new m(this.options.container,t).toggle(!0)),this.cache[M.cameraHelper][e]),this.label=(e,t,i,s=.25)=>{if(!this.labelCreator){const{color:e,backgroundColor:t,backgroundOpacity:i,background:s}=this.options;this.labelCreator=new b.u({color:e,background:s,backgroundColor:t,backgroundOpacity:i})}if(!this.cache[M.label][e]){const n=this.labelCreator.createLabel();this.cache[M.label][e]=n,n.position.copy(i),n.text=t,n.scaleFactor=s,this.options.container.add(n)}return this.cache[M.label][e]},this.line=(e,t=this.options.lineColor,i=this.options.linewidth)=>{if(!this.cache[M.line][e]){const o=S.default.makeLineMaterial("string"==typeof t?new n.Ilk(t).getHex():t.getHex(),!1,{linewidth:i}),r={onShow:()=>this.options.container.add(...a.children),onHide:()=>this.options.container.remove(...a.children)},a=new T.c(s.f.ZERO.clone(),s.f.ZERO.clone(),o,r);a.updateResolution(window.innerWidth,window.innerHeight).opacity(1).toggle(!0),this.cache[M.line][e]=a}return this.cache[M.line][e]},this.plane=(e,t)=>(this.cache[M.plane][e]||(this.cache[M.plane][e]=new g(this.options.container,t).toggle(!0)),this.cache[M.plane][e]),this.sphere=(e,t)=>(this.cache[M.sphere][e]||(this.cache[M.sphere][e]=new f(this.options.container,t).toggle(!0)),this.cache[M.sphere][e]),this.spline=(e,t)=>(this.cache[M.spline][e]||(this.cache[M.spline][e]=new y(this.options.container,t).toggle(!0)),this.cache[M.spline][e]),this.randomColor=e=>{if(void 0!==e){if(!this.helperCache[P.color][e]){const t=new n.Ilk(_(),_(),_());this.helperCache[P.color][e]=t}return this.helperCache[P.color][e]}return new n.Ilk(_(),_(),_())},this.randomVector3=e=>{if(void 0!==e){if(!this.helperCache[P.vector3][e]){const t=new n.Pa4(2*(.5-_()),2*(.5-_()),2*(.5-_()));this.helperCache[P.vector3][e]=t}return this.helperCache[P.vector3][e]}return new n.Pa4(2*(.5-_()),2*(.5-_()),2*(.5-_()))},this.toggleAll=e=>{for(const t of Object.values(M)){const i=Object.values(this.cache[t]);for(const t of i)"toggle"in t&&t.toggle(e)}return this},this.options=Object.assign(Object.assign({},x),e);for(const e of Object.values(M))this.cache[e]={};for(const e of Object.values(P))this.helperCache[e]={};this.options.scene&&this.toggle(!0)}async addToScene(e){return this.options.scene=(await e.getModule(w.default)).getScene(),this.toggle(!0),this}}const _=()=>Math.random(),x={lineColor:"white",linewidth:2,color:"white",background:!0,backgroundColor:"white",backgroundOpacity:.5,container:new n.ZAu};var M,P;!function(e){e.box="box",e.boxWire="boxWire",e.label="label",e.line="line",e.plane="plane",e.sphere="sphere",e.spline="spline",e.cameraHelper="cameraHelper"}(M||(M={})),function(e){e.color="color",e.vector3="vector3"}(P||(P={}))},51770:(e,t,i)=>{"use strict";function s(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function n(e){const t={};for(const i in e)t[e[i]]=i;return t}function o(e,t){if(null!==e&&"object"==typeof e)for(const i in e)t(e[i],i,e),o(e[i],t)}i.d(t,{qw:()=>s,Sc:()=>n,yW:()=>o})},67125:(e,t,i)=>{"use strict";function s(e=11){let t="";const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function n(e,t){return function(e,t){return(e%t+t)%t}(function(e){let t,i=0;for(let s=0;s<e.length;s++)t=e.charCodeAt(s),i=(i<<5)-i+t,i|=0;return i}(e),t)}i.d(t,{f:()=>s,W:()=>n})},10396:(e,t,i)=>{"use strict";i.d(t,{g_:()=>s,i5:()=>n,iv:()=>c,T8:()=>u,kp:()=>g});var s,n,o=i(57501);!function(e){e[e.RESIZE=1]="RESIZE",e[e.ORIENTATION_CHANGED=2]="ORIENTATION_CHANGED"}(s||(s={})),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.LANDSCAPE=2]="LANDSCAPE"}(n||(n={}));let r=[],a=[];const l=window.visualViewport,c=()=>({w:l?l.width:window.innerWidth,h:l?l.height:window.innerHeight}),h=c(),d=new o.ne((()=>h),(e=>r.push(e)),(e=>{r=r.filter((t=>t!==e))})),u=()=>({orientation:window.innerWidth>window.innerHeight?n.LANDSCAPE:n.PORTRAIT});let p=u();const m=new o.ne((()=>p),(e=>a.push(e)),(e=>{a=a.filter((t=>t!==e))}));function g(e,t){switch(e){case s.RESIZE:return d.createSubscription(t);case s.ORIENTATION_CHANGED:return m.createSubscription(t)}}const f=(()=>{let e,t;return()=>{const i=c(),s=()=>{window.clearInterval(e),window.clearTimeout(t)};s();const n=()=>{h.w===i.w&&h.h===i.h||(h.w=i.w,h.h=i.h,(()=>{if(r.length>0&&r.forEach((e=>e(h))),a.length>0){const e=u();e!==p&&(p=e,a.forEach((t=>t(e))))}})())};e=window.setInterval(n,100),t=window.setTimeout(s,1e3),n()}})();l?l.addEventListener("resize",f):window.addEventListener("resize",f)},60778:(e,t,i)=>{"use strict";i.d(t,{p:()=>o});var s=i(2212);const n=new(i(25799).Z)("texture"),o=(e,t,i)=>{const o=new s.dpR;return o.crossOrigin="anonymous",o.load(e,t,void 0,(t=>{n.error(`Failed to load ${e}`),i&&i(t)}))}},26986:(e,t,i)=>{"use strict";i.d(t,{sU:()=>o,uz:()=>r,bf:()=>a,JE:()=>c});var s=i(8575),n=i(21265);const o=function(e="",t){let i,n,o;if(e.match(/^https?/)){const t=(0,s.Qc)(e);i=t.protocol+"//"+t.host,n=e,o=e.match(/[^/]*$/)[0]}else{if(t.match(/^https?/)){const e=(0,s.Qc)(t);i=e.protocol+"//"+e.host}else i=window.location.protocol+"//"+t;n=i+"/api/player/models/"+e,o=e}return{sid:o,urlBase:i,urlModel:n,urlFiles:n+(n.match(/\/$/)?"files":"/files"),urlThumb:n+(n.match(/\/$/)?"thumb":"/thumb")}},r=function(){return(0,n.hu)("model")||(0,n.hu)("m")},a=function(e,t={}){for(const i in t){const s=t[i];e+=(-1===e.indexOf("?")?"?":"&")+`${i}=${s}`}return e},l=[/^[a-z0-9\-]+.matterport.com$/,/^localhost$/],c=e=>{let t;try{t=new URL(e)}catch(e){return null}const i=t.hostname;for(const e of l)if(i.match(e))return t.origin;return null}},25903:(e,t,i)=>{"use strict";i.d(t,{H:()=>r});var s=i(25799),n=i(21265);const o=new s.Z("vr-platform-select"),r=async()=>{try{if(await a(),!("getVRDisplays"in navigator))return null;const e=await navigator.getVRDisplays();if(e.length>0&&e[0].capabilities.canPresent)return e[0]}catch(e){o.warn("Getting VR display failed"),o.warn(e)}return null},a=(()=>{const e=(0,n.Dt)()&&!("getVRDisplays"in navigator)&&!(0,n.Ot)();let t=!1;return async()=>{if(e&&!t){const s=new((await i.e(376).then(i.t.bind(i,4260,23))).default);o.info(`Falling back to WebVR support, native:: ${s.hasNative}`,{webvrPolyfillNeeded:e,polyfill:s}),t=!0}}})()},38677:(e,t,i)=>{"use strict";i.d(t,{XG:()=>c,Pf:()=>p});var s,n,o,r,a=i(5277);class l{constructor(e){this.messageReceiver=e}notify(e){this.messageReceiver.onMessageReceived(e)}}class c{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const i=this.values[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}get keys(){return Object.keys(this.values)}}class h{constructor(e,t){this.sourceId=e,this.listenerBridge=t,this.observers=new c}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new l(e);this.listenerBridge.listen(t)}dispose(){this.listenerBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e,t,i){i.send(Object.assign(Object.assign({},e),{fromId:this.sourceId,toId:t,timestamp:Date.now()}))}onMessageReceived(e){const t=e.type,i=this.observers.getValuesAtKey(t);if(i)for(const t of i)t.notify(e.payload,e.timestamp)}}class d{constructor(e){this.sourceWindow=e,this.messageObserver=null,this.onMessage=e=>{this.messageObserver&&this.messageObserver.notify(e.data)}}listen(e){this.messageObserver||(this.messageObserver=e,this.sourceWindow.addEventListener("message",this.onMessage))}stopListening(){this.sourceWindow.removeEventListener("message",this.onMessage),this.messageObserver=null}}class u{constructor(e,t="*"){this.targetWindow=e,this.targetOrigin=t}send(e){this.targetWindow.postMessage(e,this.targetOrigin)}}class p{constructor(e,t,i){this.sourceId=e,this.targetId=t,this.messageBridge=i,this.observers=new c}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new l(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,i=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:i,timestamp:Date.now()}))}onMessageReceived(e){if(!this.filterMessageId(e))return;const t=e.type,i=this.observers.getValuesAtKey(t);if(i)for(const t of i)t.notify(e.payload,e.timestamp)}filterMessageId(e){const t=e.toId,i=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:t===this.sourceId&&i===this.targetId}}class m{constructor(e,t,i="*"){this.listener=new d(e),this.sender=new u(t,i)}listen(e){this.listener.listen(e)}stopListening(){this.listener.stopListening()}send(e){this.sender.send(e)}}class g{constructor(e,t,i,s,n="*"){this.sourceId=e,this.sourceWindow=t,this.targetId=i,this.targetWindow=s,this.targetOrigin=n}createMessenger(){const e=new m(this.sourceWindow,this.targetWindow,this.targetOrigin);return new p(this.sourceId,this.targetId,e)}}!function(e){e.CONNECT="postmessage.connect"}(s||(s={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(n||(n={}));class f{constructor(e){this.type=s.CONNECT,this.payload={applicationKey:e}}}class v{constructor(e){this.receiver=e,this.messageType=n.HANDSHAKE}notify(e){this.receiver.handshake()}}class y{constructor(e){this.receiver=e,this.messageType=n.ACCEPT}notify(e){const{scriptUrl:t,warning:i,targetId:s,targetOrigin:n}=e,o=e.interface;this.receiver.accept(t,o,s,n,i)}}class b{constructor(e){this.receiver=e,this.messageType=n.REJECT}notify(e){this.receiver.reject(e.reason)}}!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.HANDSHAKE=2]="HANDSHAKE",e[e.CONNECTED=3]="CONNECTED",e[e.REJECTED=4]="REJECTED"}(o||(o={}));class w{constructor(e,t){this.messenger=e,this.target=t,this.connectionState=o.IDLE,this.connectionPoll=void 0;const i=new class{constructor(e){this.connector=e}handshake(){this.connector.handshake()}accept(e,t,i,s,n){this.connector.accept(e,t,i,s,n)}reject(e){this.connector.reject(e)}}(this);this.handshakeObserver=new v(i),this.acceptObserver=new y(i),this.rejectObserver=new b(i),this.connectionPromise=new Promise(((e,t)=>{this.resolveConnection=e,this.rejectConnection=t}))}connect(e){return this.connectionState===o.IDLE&&(this.connectionState=o.CONNECTING,this.messenger.addObserver(this.handshakeObserver),this.messenger.addObserver(this.acceptObserver),this.messenger.addObserver(this.rejectObserver),this.connectionPoll=window.setInterval((()=>{this.messenger.send(new f(e),-1,this.target)}),500)),this.connectionPromise}cancelConnecting(){this.connectionState<o.CONNECTED&&(this.stopConnectPolling(),this.rejectConnection("User manually cancelled connection"))}handshake(){this.connectionState<o.HANDSHAKE&&(this.connectionState=o.HANDSHAKE,this.stopConnectPolling(),this.messenger.removeObserver(this.handshakeObserver))}accept(e,t,i,s,n){this.connectionState<o.CONNECTED&&(this.connectionState=o.CONNECTED,this.messenger.removeObserver(this.handshakeObserver),this.messenger.removeObserver(this.acceptObserver),this.messenger.removeObserver(this.rejectObserver),this.stopConnectPolling(),this.resolveConnection({targetId:i,targetOrigin:s,scriptUrl:e,serializedInterface:t,warning:n}))}reject(e){this.connectionState<o.CONNECTED&&(this.connectionState=o.REJECTED,this.messenger.removeObserver(this.handshakeObserver),this.messenger.removeObserver(this.acceptObserver),this.messenger.removeObserver(this.rejectObserver),this.stopConnectPolling(),this.rejectConnection(e))}stopConnectPolling(){clearInterval(this.connectionPoll),this.connectionPoll=void 0}}!function(e){e.connect=async function(e,i){if("string"!=typeof i)return Promise.reject("invalid key");const s=(n=e)instanceof Window?n:n.contentWindow?n.contentWindow:null;var n;if(!s)return Promise.reject("invalid window");const o=Math.floor(1e6*Math.random()),r=new d(window),l=new u(s),c=new h(o,r);c.init();const p=new w(c,l);let m;try{m=await p.connect(i)}catch(e){throw Error(`${i}@${window.location.href} - ${e}`)}finally{p.cancelConnecting(),c.dispose()}return f=await async function(e){if(!e)throw new Error("Unabled to load the sdk");const i=t[e];if(i)return i;const s=new Promise(((t,i)=>{try{a(e,(function(){const e=window["sdk-client"];delete window["sdk-client"],e&&e.SdkBuilder&&"function"==typeof e.SdkBuilder&&t(e.SdkBuilder)}))}catch(t){i(`Could not load the sdk from ${e}`)}}));return t[e]=s,s}(m.scriptUrl),v=new g(o,window,m.targetId,s,m.targetOrigin),y=m.serializedInterface,new f(v).build(y);var f,v,y};const t={}}(r||(r={}))},73550:(e,t,i)=>{"use strict";var s;i.d(t,{I:()=>s}),i(38677),function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(s||(s={}))},70655:(e,t,i)=>{"use strict";i.d(t,{ZT:()=>n,pi:()=>o,_T:()=>r,mG:()=>a,Jh:()=>l,pr:()=>c});var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function n(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var o=function(){return(o=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function r(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}function a(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{l(s.next(e))}catch(e){o(e)}}function a(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((s=s.apply(e,t||[])).next())}))}function l(e,t){var i,s,n,o,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=2&o[0]?s.return:o[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,o[1])).done)return n;switch(s=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((n=(n=r.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(6===o[0]&&r.label<n[1]){r.label=n[1],n=o;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(o);break}n[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],s=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var s=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],r=0,a=o.length;r<a;r++,n++)s[n]=o[r];return s}},42238:function(e,t,i){var s;!function(n,o){"use strict";var r="function",a="object",l="model",c="name",h="type",d="vendor",u="version",p="architecture",m="console",g="mobile",f="tablet",v="smarttv",y="wearable",b={extend:function(e,t){var i={};for(var s in e)t[s]&&t[s].length%2==0?i[s]=t[s].concat(e[s]):i[s]=e[s];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},w={rgx:function(e,t){for(var i,s,n,l,c,h,d=0;d<t.length&&!c;){var u=t[d],p=t[d+1];for(i=s=0;i<u.length&&!c;)if(c=u[i++].exec(e))for(n=0;n<p.length;n++)h=c[++s],typeof(l=p[n])===a&&l.length>0?2==l.length?typeof l[1]==r?this[l[0]]=l[1].call(this,h):this[l[0]]=l[1]:3==l.length?typeof l[1]!==r||l[1].exec&&l[1].test?this[l[0]]=h?h.replace(l[1],l[2]):o:this[l[0]]=h?l[1].call(this,h,l[2]):o:4==l.length&&(this[l[0]]=h?l[3].call(this,h.replace(l[1],l[2])):o):this[l]=h||o;d+=2}},str:function(e,t){for(var i in t)if(typeof t[i]===a&&t[i].length>0){for(var s=0;s<t[i].length;s++)if(b.has(t[i][s],e))return"?"===i?o:i}else if(b.has(t[i],e))return"?"===i?o:i;return e}},S={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6}).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[c,u],[/(opios)[\/\s]+([\w\.]+)/i],[[c,"Opera Mini"],u],[/\s(opr)\/([\w\.]+)/i],[[c,"Opera"],u],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[c,u],[/(konqueror)\/([\w\.]+)/i],[[c,"Konqueror"],u],[/(trident).+rv[:\s]([\w\.]{1,9}).+like\sgecko/i],[[c,"IE"],u],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[c,"Edge"],u],[/(yabrowser)\/([\w\.]+)/i],[[c,"Yandex"],u],[/(Avast)\/([\w\.]+)/i],[[c,"Avast Secure Browser"],u],[/(AVG)\/([\w\.]+)/i],[[c,"AVG Secure Browser"],u],[/(puffin)\/([\w\.]+)/i],[[c,"Puffin"],u],[/(focus)\/([\w\.]+)/i],[[c,"Firefox Focus"],u],[/(opt)\/([\w\.]+)/i],[[c,"Opera Touch"],u],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[c,"UCBrowser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(windowswechat qbcore)\/([\w\.]+)/i],[[c,"WeChat(Win) Desktop"],u],[/(micromessenger)\/([\w\.]+)/i],[[c,"WeChat"],u],[/(brave)\/([\w\.]+)/i],[[c,"Brave"],u],[/(whale)\/([\w\.]+)/i],[[c,"Whale"],u],[/(qqbrowserlite)\/([\w\.]+)/i],[c,u],[/(QQ)\/([\d\.]+)/i],[c,u],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[c,u],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[c,u],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[c,u],[/(MetaSr)[\/\s]?([\w\.]+)/i],[c],[/(LBBROWSER)/i],[c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[u,[c,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[c,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[c,u],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[u,[c,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[c,/(.+)/,"$1 WebView"],u],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[c,/(.+(?:g|us))(.+)/,"$1 $2"],u],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[u,[c,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[c,"Sailfish Browser"],u],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[c,u],[/(dolfin)\/([\w\.]+)/i],[[c,"Dolphin"],u],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[c,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[c,"Chrome"],u],[/(coast)\/([\w\.]+)/i],[[c,"Opera Coast"],u],[/fxios\/([\w\.-]+)/i],[u,[c,"Firefox"]],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[u,c],[/webkit.+?(gsa)\/([\w\.]+)\s.*(mobile\s?safari|safari)(\/[\w\.]+)/i],[[c,"GSA"],u],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[c,[u,w.str,S.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape)\/([\w\.-]+)/i],[[c,"Netscape"],u],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[c,u]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,b.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[p,/ower/,"",b.lowerize]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[p,b.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[l,d,[h,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[d,"Apple"],[h,f]],[/(apple\s{0,1}tv)/i],[[l,"Apple TV"],[d,"Apple"],[h,v]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[d,l,[h,f]],[/(kf[A-z]+)(\sbuild\/|\)).+silk\//i],[l,[d,"Amazon"],[h,f]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[l,w.str,S.device.amazon.model],[d,"Amazon"],[h,g]],[/android.+aft([bms])\sbuild/i],[l,[d,"Amazon"],[h,v]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,d,[h,g]],[/\((ip[honed|\s\w*]+);/i],[l,[d,"Apple"],[h,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[d,l,[h,g]],[/\(bb10;\s(\w+)/i],[l,[d,"BlackBerry"],[h,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[l,[d,"Asus"],[h,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[d,"Sony"],[l,"Xperia Tablet"],[h,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[d,"Sony"],[h,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[d,l,[h,m]],[/android.+;\s(shield)\sbuild/i],[l,[d,"Nvidia"],[h,m]],[/(playstation\s[34portablevi]+)/i],[l,[d,"Sony"],[h,m]],[/(sprint\s(\w+))/i],[[d,w.str,S.device.sprint.vendor],[l,w.str,S.device.sprint.model],[h,g]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[d,[l,/_/g," "],[h,g]],[/(nexus\s9)/i],[l,[d,"HTC"],[h,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/android.+\s(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?)/i],[l,[d,"Huawei"],[h,g]],[/android.+(bah2?-a?[lw]\d{2})/i],[l,[d,"Huawei"],[h,f]],[/(microsoft);\s(lumia[\s\w]+)/i],[d,l,[h,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[d,"Microsoft"],[h,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[d,"Microsoft"],[h,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[l,[d,"Motorola"],[h,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[d,"Motorola"],[h,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[d,b.trim],[l,b.trim],[h,v]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[d,"Samsung"],[h,v]],[/\(dtv[\);].+(aquos)/i],[l,[d,"Sharp"],[h,v]],[/android.+((sch-i[89]0\d|shw-m380s|SM-P605|SM-P610|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[d,"Samsung"],l,[h,f]],[/smart-tv.+(samsung)/i],[d,[h,v],l],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[d,"Samsung"],l,[h,g]],[/sie-(\w*)/i],[l,[d,"Siemens"],[h,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[d,"Nokia"],l,[h,g]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[l,[d,"Acer"],[h,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[l,[d,"LG"],[h,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[d,"LG"],l,[h,f]],[/linux;\snetcast.+smarttv/i,/lg\snetcast\.tv-201\d/i],[[d,"LG"],l,[h,v]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[l,[d,"LG"],[h,g]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[d,l,[h,f]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[d,"Lenovo"],[h,f]],[/(lenovo)[_\s-]?([\w-]+)/i],[d,l,[h,g]],[/linux;.+((jolla));/i],[d,l,[h,g]],[/((pebble))app\/[\d\.]+\s/i],[d,l,[h,y]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[d,l,[h,g]],[/crkey/i],[[l,"Chromecast"],[d,"Google"],[h,v]],[/android.+;\s(glass)\s\d/i],[l,[d,"Google"],[h,y]],[/android.+;\s(pixel c)[\s)]/i],[l,[d,"Google"],[h,f]],[/android.+;\s(pixel( [2-9]a?)?( xl)?)[\s)]/i],[l,[d,"Google"],[h,g]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/android.+(redmi[\s\-_]?(?:note|k)?(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i,/android.+(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[l,/_/g," "],[d,"Xiaomi"],[h,g]],[/android.+(mi[\s\-_]?(?:pad)(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i],[[l,/_/g," "],[d,"Xiaomi"],[h,f]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[l,[d,"Meizu"],[h,g]],[/(mz)-([\w-]{2,})/i],[[d,"Meizu"],l,[h,g]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[l,[d,"OnePlus"],[h,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[l,[d,"RCA"],[h,f]],[/android.+[;\/\s](Venue[\d\s]{2,7})\s+build/i],[l,[d,"Dell"],[h,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[l,[d,"Verizon"],[h,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[d,"Barnes & Noble"],l,[h,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[l,[d,"NuVision"],[h,f]],[/android.+;\s(k88)\sbuild/i],[l,[d,"ZTE"],[h,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[l,[d,"Swiss"],[h,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[l,[d,"Swiss"],[h,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[l,[d,"Zeki"],[h,f]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[d,"Dragon Touch"],l,[h,f]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[l,[d,"Insignia"],[h,f]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[l,[d,"NextBook"],[h,f]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[d,"Voice"],l,[h,g]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[d,"LvTel"],l,[h,g]],[/android.+;\s(PH-1)\s/i],[l,[d,"Essential"],[h,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[l,[d,"Envizen"],[h,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[d,l,[h,f]],[/android.+[;\/]\s*(Trio[\s\w\-\.]+)\s+build/i],[l,[d,"MachSpeed"],[h,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[d,l,[h,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[l,[d,"Rotor"],[h,f]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[d,l,[h,f]],[/android .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[l,[h,g]],[/android .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[l,[h,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[h,b.lowerize],d,l],[/[\s\/\(](smart-?tv)[;\)]/i],[[h,v]],[/(android[\w\.\s\-]{0,9});.+build/i],[l,[d,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9}).+(gecko)/i],[u,c]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[c,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[u,w.str,S.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[u,w.str,S.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[c,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[c,"Symbian"],u],[/\((series40);/i],[c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],u],[/crkey\/([\d\.]+)/i],[u,[c,"Chromecast"]],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[c,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],u],[/(sunos)\s?([\w\.\d]*)/i],[[c,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[c,u],[/(haiku)\s(\w+)/i],[c,u],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[c,"Mac OS"],[u,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[c,u]]},E=function(e,t){if("object"==typeof e&&(t=e,e=o),!(this instanceof E))return new E(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),s=t?b.extend(T,t):T;return this.getBrowser=function(){var e={name:o,version:o};return w.rgx.call(e,i,s.browser),e.major=b.major(e.version),e},this.getCPU=function(){var e={architecture:o};return w.rgx.call(e,i,s.cpu),e},this.getDevice=function(){var e={vendor:o,model:o,type:o};return w.rgx.call(e,i,s.device),e},this.getEngine=function(){var e={name:o,version:o};return w.rgx.call(e,i,s.engine),e},this.getOS=function(){var e={name:o,version:o};return w.rgx.call(e,i,s.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};E.VERSION="0.7.23",E.BROWSER={NAME:c,MAJOR:"major",VERSION:u},E.CPU={ARCHITECTURE:p},E.DEVICE={MODEL:l,VENDOR:d,TYPE:h,CONSOLE:m,MOBILE:g,SMARTTV:v,TABLET:f,WEARABLE:y,EMBEDDED:"embedded"},E.ENGINE={NAME:c,VERSION:u},E.OS={NAME:c,VERSION:u},void 0!==t?(e.exports&&(t=e.exports=E),t.UAParser=E):(s=function(){return E}.call(t,i,t,e))===o||(e.exports=s);var _=n&&(n.jQuery||n.Zepto);if(_&&!_.ua){var x=new E;_.ua=x.getResult(),_.ua.get=function(){return x.getUA()},_.ua.set=function(e){x.setUA(e);var t=x.getResult();for(var i in t)_.ua[i]=t[i]}}}("object"==typeof window?window:this)},69436:e=>{function t(e,t,i,s){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=i,this.p2y=s}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var i,s,n,o,r;for(void 0===t&&(t=1e-6),n=e,r=0;r<8;r++){if(o=this.sampleCurveX(n)-e,Math.abs(o)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=o/a}if((n=e)<(i=0))return i;if(n>(s=1))return s;for(;i<s;){if(o=this.sampleCurveX(n),Math.abs(o-e)<t)return n;e>o?i=n:s=n,n=.5*(s-i)+i}return n},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},52511:function(e,t,i){var s;e=i.nmd(e),function(n){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i.g&&i.g;o.global!==o&&o.window!==o&&o.self;var r,a=2147483647,l=36,c=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(u[e])}function f(e,t){for(var i=e.length,s=[];i--;)s[i]=t(e[i]);return s}function v(e,t){var i=e.split("@"),s="";return i.length>1&&(s=i[0]+"@",e=i[1]),s+f((e=e.replace(d,".")).split("."),t).join(".")}function y(e){for(var t,i,s=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?s.push(((1023&t)<<10)+(1023&i)+65536):(s.push(t),n--):s.push(t);return s}function b(e){return f(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+m(e)})).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,i){var s=0;for(e=i?p(e/700):e>>1,e+=p(e/t);e>455;s+=l)e=p(e/35);return p(s+36*e/(e+38))}function T(e){var t,i,s,n,o,r,c,h,d,u,m,f=[],v=e.length,y=0,w=128,T=72;for((i=e.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)e.charCodeAt(s)>=128&&g("not-basic"),f.push(e.charCodeAt(s));for(n=i>0?i+1:0;n<v;){for(o=y,r=1,c=l;n>=v&&g("invalid-input"),((h=(m=e.charCodeAt(n++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:l)>=l||h>p((a-y)/r))&&g("overflow"),y+=h*r,!(h<(d=c<=T?1:c>=T+26?26:c-T));c+=l)r>p(a/(u=l-d))&&g("overflow"),r*=u;T=S(y-o,t=f.length+1,0==o),p(y/t)>a-w&&g("overflow"),w+=p(y/t),y%=t,f.splice(y++,0,w)}return b(f)}function E(e){var t,i,s,n,o,r,c,h,d,u,f,v,b,T,E,_=[];for(v=(e=y(e)).length,t=128,i=0,o=72,r=0;r<v;++r)(f=e[r])<128&&_.push(m(f));for(s=n=_.length,n&&_.push("-");s<v;){for(c=a,r=0;r<v;++r)(f=e[r])>=t&&f<c&&(c=f);for(c-t>p((a-i)/(b=s+1))&&g("overflow"),i+=(c-t)*b,t=c,r=0;r<v;++r)if((f=e[r])<t&&++i>a&&g("overflow"),f==t){for(h=i,d=l;!(h<(u=d<=o?1:d>=o+26?26:d-o));d+=l)E=h-u,T=l-u,_.push(m(w(u+E%T,0))),h=p(E/T);_.push(m(w(h,0))),o=S(i,b,s==n),i=0,++s}++i,++t}return _.join("")}r={version:"1.3.2",ucs2:{decode:y,encode:b},decode:T,encode:E,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+E(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?T(e.slice(4).toLowerCase()):e}))}},void 0===(s=function(){return r}.call(t,i,t,e))||(e.exports=s)}()},8575:(e,t,i)=>{"use strict";var s=i(52511),n=i(62502);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.Qc=b;var r=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),d=["%","/","?",";","#"].concat(h),u=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(17673);function b(e,t,i){if(e&&n.isObject(e)&&e instanceof o)return e;var s=new o;return s.parse(e,t,i),s}o.prototype.parse=function(e,t,i){if(!n.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!i&&1===e.split("#").length){var w=l.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=r.exec(b);if(S){var T=(S=S[0]).toLowerCase();this.protocol=T,b=b.substr(S.length)}if(i||S||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===b.substr(0,2);!E||S&&f[S]||(b=b.substr(2),this.slashes=!0)}if(!f[S]&&(E||S&&!v[S])){for(var _,x,M=-1,P=0;P<u.length;P++)-1!==(A=b.indexOf(u[P]))&&(-1===M||A<M)&&(M=A);for(-1!==(x=-1===M?b.lastIndexOf("@"):b.lastIndexOf("@",M))&&(_=b.slice(0,x),b=b.slice(x+1),this.auth=decodeURIComponent(_)),M=-1,P=0;P<d.length;P++){var A;-1!==(A=b.indexOf(d[P]))&&(-1===M||A<M)&&(M=A)}-1===M&&(M=b.length),this.host=b.slice(0,M),b=b.slice(M),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var D=this.hostname.split(/\./),I=(P=0,D.length);P<I;P++){var C=D[P];if(C&&!C.match(p)){for(var R="",L=0,N=C.length;L<N;L++)C.charCodeAt(L)>127?R+="x":R+=C[L];if(!R.match(p)){var k=D.slice(0,P),F=D.slice(P+1),B=C.match(m);B&&(k.push(B[1]),F.unshift(B[2])),F.length&&(b="/"+F.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),O||(this.hostname=s.toASCII(this.hostname));var U=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+U,this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[T])for(P=0,I=h.length;P<I;P++){var G=h[P];if(-1!==b.indexOf(G)){var V=encodeURIComponent(G);V===G&&(V=escape(G)),b=b.split(G).join(V)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var j=b.indexOf("?");if(-1!==j?(this.search=b.substr(j),this.query=b.substr(j+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,j)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var W=this.search||"";this.path=U+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",s=this.hash||"",o=!1,r="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(r=y.stringify(this.query));var a=this.search||r&&"?"+r||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==o?(o="//"+(o||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):o||(o=""),s&&"#"!==s.charAt(0)&&(s="#"+s),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+s},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(n.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var i=new o,s=Object.keys(this),r=0;r<s.length;r++){var a=s[r];i[a]=this[a]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var h=l[c];"protocol"!==h&&(i[h]=e[h])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!v[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var p=d[u];i[p]=e[p]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||f[e.protocol])i.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),i.pathname=m.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var g=i.pathname||"",y=i.search||"";i.path=g+y}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var b=i.pathname&&"/"===i.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=w||b||i.host&&e.pathname,T=S,E=i.pathname&&i.pathname.split("/")||[],_=(m=e.pathname&&e.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(_&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),S=S&&(""===m[0]||""===E[0])),w)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,E=m;else if(m.length)E||(E=[]),E.pop(),E=E.concat(m),i.search=e.search,i.query=e.query;else if(!n.isNullOrUndefined(e.search))return _&&(i.hostname=i.host=E.shift(),(O=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=O.shift(),i.host=i.hostname=O.shift())),i.search=e.search,i.query=e.query,n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var x=E.slice(-1)[0],M=(i.host||e.host||E.length>1)&&("."===x||".."===x)||""===x,P=0,A=E.length;A>=0;A--)"."===(x=E[A])?E.splice(A,1):".."===x?(E.splice(A,1),P++):P&&(E.splice(A,1),P--);if(!S&&!T)for(;P--;P)E.unshift("..");!S||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),M&&"/"!==E.join("/").substr(-1)&&E.push("");var O,D=""===E[0]||E[0]&&"/"===E[0].charAt(0);return _&&(i.hostname=i.host=D?"":E.length?E.shift():"",(O=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=O.shift(),i.host=i.hostname=O.shift())),(S=S||i.host&&E.length)&&!D&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},62502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},42473:e=>{"use strict";e.exports=function(){}},7281:e=>{e.exports="uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},29966:e=>{e.exports="uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},9391:e=>{e.exports="#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},15145:e=>{e.exports="uniform samplerCube map;uniform vec2 dir;varying vec3 vWorldPosition;vec3 sphereToUnit(float x,float y){return vec3(sin(x)*cos(y),cos(x),sin(x)*sin(y));}vec2 unitToSphere(vec3 unit){return vec2(atan(sqrt(pow(unit.x,2.)+pow(unit.z,2.)),unit.y),atan(unit.z,unit.x));}void main(){vec2 coord=unitToSphere(vWorldPosition);vec4 sum=textureCube(map,sphereToUnit(coord.x-12.*dir.x,coord.y-12.*dir.y))*KERNEL_1;sum+=textureCube(map,sphereToUnit(coord.x-11.*dir.x,coord.y-11.*dir.y))*KERNEL_2;sum+=textureCube(map,sphereToUnit(coord.x-10.*dir.x,coord.y-10.*dir.y))*KERNEL_3;sum+=textureCube(map,sphereToUnit(coord.x-9.*dir.x,coord.y-9.*dir.y))*KERNEL_4;sum+=textureCube(map,sphereToUnit(coord.x-8.*dir.x,coord.y-8.*dir.y))*KERNEL_5;sum+=textureCube(map,sphereToUnit(coord.x-7.*dir.x,coord.y-7.*dir.y))*KERNEL_6;sum+=textureCube(map,sphereToUnit(coord.x-6.*dir.x,coord.y-6.*dir.y))*KERNEL_7;sum+=textureCube(map,sphereToUnit(coord.x-5.*dir.x,coord.y-5.*dir.y))*KERNEL_8;sum+=textureCube(map,sphereToUnit(coord.x-4.*dir.x,coord.y-4.*dir.y))*KERNEL_9;sum+=textureCube(map,sphereToUnit(coord.x-3.*dir.x,coord.y-3.*dir.y))*KERNEL_10;sum+=textureCube(map,sphereToUnit(coord.x-2.*dir.x,coord.y-2.*dir.y))*KERNEL_11;sum+=textureCube(map,sphereToUnit(coord.x-1.*dir.x,coord.y-1.*dir.y))*KERNEL_12;sum+=textureCube(map,sphereToUnit(coord.x,coord.y))*KERNEL_13;sum+=textureCube(map,sphereToUnit(coord.x+1.*dir.x,coord.y+1.*dir.y))*KERNEL_14;sum+=textureCube(map,sphereToUnit(coord.x+2.*dir.x,coord.y+2.*dir.y))*KERNEL_15;sum+=textureCube(map,sphereToUnit(coord.x+3.*dir.x,coord.y+3.*dir.y))*KERNEL_16;sum+=textureCube(map,sphereToUnit(coord.x+4.*dir.x,coord.y+4.*dir.y))*KERNEL_17;sum+=textureCube(map,sphereToUnit(coord.x+5.*dir.x,coord.y+5.*dir.y))*KERNEL_18;sum+=textureCube(map,sphereToUnit(coord.x+6.*dir.x,coord.y+6.*dir.y))*KERNEL_19;sum+=textureCube(map,sphereToUnit(coord.x+7.*dir.x,coord.y+7.*dir.y))*KERNEL_20;sum+=textureCube(map,sphereToUnit(coord.x+8.*dir.x,coord.y+8.*dir.y))*KERNEL_21;sum+=textureCube(map,sphereToUnit(coord.x+9.*dir.x,coord.y+9.*dir.y))*KERNEL_22;sum+=textureCube(map,sphereToUnit(coord.x+10.*dir.x,coord.y+10.*dir.y))*KERNEL_23;sum+=textureCube(map,sphereToUnit(coord.x+11.*dir.x,coord.y+11.*dir.y))*KERNEL_24;sum+=textureCube(map,sphereToUnit(coord.x+12.*dir.x,coord.y+12.*dir.y))*KERNEL_25;gl_FragColor=sum;}"},56163:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},36357:e=>{e.exports="uniform samplerCube map;uniform float opacity;varying vec3 vWorldPosition;void main(){vec4 color=textureCube(map,vec3(-vWorldPosition.x,vWorldPosition.yz));gl_FragColor=vec4(color.rgb,opacity);}"},49423:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},43411:e=>{e.exports="uniform vec3 color;uniform float opacity;uniform float maxDistance;varying vec3 vWorldPosition;void main(){float distanceToCamera=distance(cameraPosition,vWorldPosition);float distanceBucketed=1.-clamp(distanceToCamera/maxDistance,0.,1.);if(opacity<1.){discard;}gl_FragColor=vec4(distanceBucketed,distanceBucketed,distanceBucketed,1.);}"},25928:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},65635:e=>{e.exports="uniform sampler2D map;uniform float opacity;uniform vec4 colorOverlay;varying vec2 vUv;vec4 white=vec4(0.8,0.8,0.8,1.);vec4 black=vec4(0.,0.,0.,1.);void main(){vec4 colorFromTexture=texture2D(map,vUv);float whiteness=1.-smoothstep(0.1,0.2,opacity);colorFromTexture=mix(colorFromTexture,vec4(colorOverlay.rgb,1.),colorOverlay.a);colorFromTexture=mix(colorFromTexture,white,whiteness);gl_FragColor=vec4(colorFromTexture.rgb,opacity);}"},25256:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},43775:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform samplerCube pano0Map;varying vec3 pano0SweepDirection;uniform float panoOpacity;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform float progress;uniform vec3 pano1Position;uniform samplerCube pano1Map;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nuniform samplerCube overlay0Map;varying vec3 overlay0WorldPos;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nuniform samplerCube overlay1Map;varying vec3 overlay1WorldPos;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nuniform vec3 meshPreviewCenter;uniform float meshPreviewSize;\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;uniform sampler2D map;uniform float meshOpacity;uniform float opacity;uniform float transparentDiscardDist;varying vec3 worldPos;\n#endif\n#ifdef COLOR_OVERLAY\nuniform vec4 colorOverlay;\n#endif\n#ifdef WIREFRAME\nvarying vec3 vBarycentric;uniform float time;uniform float thickness;uniform float secondThickness;uniform float dashRepeats;uniform float dashLength;uniform bool dashOverlap;uniform bool dashEnabled;uniform bool dashAnimate;uniform bool fillEnabled;uniform bool insideAltColor;uniform bool dualStroke;uniform bool squeeze;uniform float squeezeMin;uniform float squeezeMax;uniform float wireframeOpacity;uniform vec3 stroke;uniform vec3 fill;float aastep(float threshold,float dist){float afwidth=fwidth(dist)*0.5;return smoothstep(threshold-afwidth,threshold+afwidth,dist);}float computeScreenSpaceWireframe(vec3 barycentric,float lineWidth){vec3 dist=fwidth(barycentric);vec3 smoothed=smoothstep(dist*((lineWidth*0.5)-0.5),dist*((lineWidth*0.5)+0.5),barycentric);return 1.-min(min(smoothed.x,smoothed.y),smoothed.z);}vec4 getStyledWireframe(vec3 barycentric){float PI=3.14159265359;float d=min(min(barycentric.x,barycentric.y),barycentric.z);float positionAlong=max(barycentric.x,barycentric.y);if(barycentric.y<barycentric.x&&barycentric.y<barycentric.z){positionAlong=1.-positionAlong;}float computedThickness=thickness;if(squeeze){computedThickness*=mix(squeezeMin,squeezeMax,(1.-sin(positionAlong*PI)));}if(dashEnabled){float offset=1./dashRepeats*dashLength/2.;if(!dashOverlap){offset+=1./dashRepeats/2.;}if(dashAnimate){offset+=time*0.22;}float pattern=fract((positionAlong+offset)*dashRepeats);computedThickness*=1.-aastep(dashLength,pattern);}float edge=computeScreenSpaceWireframe(barycentric,computedThickness);vec4 outColor=vec4(0.,0.,0.,0.);if(!fillEnabled){outColor=vec4(stroke,edge);if(insideAltColor&&!gl_FrontFacing){outColor.rgb=fill;}}else{outColor.a=1.;if(dualStroke){float inner=1.-aastep(secondThickness,d);vec3 wireColor=mix(fill,stroke,abs(inner-edge));outColor.rgb=wireColor;}else{outColor.rgb=mix(fill,stroke,edge);}}outColor.a*=wireframeOpacity;return outColor;}\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){\n#ifdef PANO_TEXTURE_TRANSITION\nvec4 colorFromPano0=textureCube(pano0Map,pano0SweepDirection.xyz);vec4 colorFromPano1=textureCube(pano1Map,pano1SweepDirection.xyz);\n#ifdef PANO_OVERLAY_TRANSITION\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);vec4 colorFromOverlay1=textureCube(overlay1Map,overlay1WorldPos.xyz);colorFromPano0.rgb=mix(colorFromPano0.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);colorFromPano1.rgb=mix(colorFromPano1.rgb,colorFromOverlay1.rgb,colorFromOverlay1.a);\n#endif\nvec4 color=mix(colorFromPano0,colorFromPano1,progress);color.a=panoOpacity;\n#elif defined(PANO_TEXTURE)\nvec4 color=textureCube(pano0Map,pano0SweepDirection.xyz);\n#ifdef PANO_OVERLAY\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);color.rgb=mix(color.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);\n#endif\ncolor.a=panoOpacity;\n#else\nvec4 color=vec4(0.,0.,0.,0.);\n#endif\n#ifdef MESH_TEXTURE\nvec4 colorFromTexture=texture2D(map,vUv);float depth=distance(cameraPosition,worldPos.xyz);if(opacity<1.&&depth<transparentDiscardDist){discard;}\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nfloat previewDistance=distance(worldPos.xyz,meshPreviewCenter.xyz);float inSphere=step(previewDistance,meshPreviewSize);colorFromTexture+=colorFromTexture*(0.2*inSphere);color=mix(color,colorFromTexture,max(meshOpacity,inSphere));\n#elif defined(MESH_TEXTURE)\ncolor=mix(color,colorFromTexture,meshOpacity);\n#endif\n#ifdef FLAT_SHADING\nfloat ao=0.9-abs(vNormal.y)*0.1-abs(vNormal.x)*0.05+abs(vNormal.z)*0.05;color.rgb=vec3(ao,ao*1.025,ao*1.05);\n#endif\n#ifdef COLOR_OVERLAY\ncolor=mix(color,vec4(colorOverlay.rgb,1.),colorOverlay.a);\n#endif\n#ifdef WIREFRAME\nvec4 colorFromWireframe=getStyledWireframe(vBarycentric);color=mix(color,vec4(colorFromWireframe.rgb,1.),colorFromWireframe.a);\n#endif\n#ifdef MESH_TEXTURE\ncolor.a=opacity;\n#endif\ngl_FragColor=color;}"},73291:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform mat4 pano0Matrix1;uniform mat4 pano0Matrix2;varying vec3 pano0SweepDirection;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform vec3 pano1Position;uniform mat4 pano1Matrix1;uniform mat4 pano1Matrix2;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nvarying vec3 overlay0WorldPos;uniform mat4 overlay0Matrix;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nvarying vec3 overlay1WorldPos;uniform mat4 overlay1Matrix;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;varying vec3 worldPos;\n#endif\n#ifdef WIREFRAME\nattribute vec3 barycentric;varying vec3 vBarycentric;\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){vec4 worldPosition=modelMatrix*vec4(position,1.);\n#ifdef MESH_TEXTURE\nvUv=uv;worldPos=worldPosition.xyz;\n#endif\n#ifdef WIREFRAME\nvBarycentric=barycentric;\n#endif\n#ifdef FLAT_SHADING\nvNormal=normal;\n#endif\n#ifdef PANO_TEXTURE\nvec3 positionLocalToPanoCenter0=worldPosition.xyz-pano0Position;pano0SweepDirection=(pano0Matrix2*pano0Matrix1*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#ifdef PANO_OVERLAY\noverlay0WorldPos=(overlay0Matrix*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#endif\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nvec3 positionLocalToPanoCenter1=worldPosition.xyz-pano1Position;pano1SweepDirection=(pano1Matrix2*pano1Matrix1*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#ifdef PANO_OVERLAY_TRANSITION\noverlay1WorldPos=(overlay1Matrix*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#endif\n#endif\nvec4 projectedPosition=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},43655:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;varying vec3 color;\n#else\nuniform float alpha;uniform vec3 color;\n#endif\nuniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);if(bgColor.a*alpha<0.1){discard;}vec4 maskColor=texture2D(mask,vUv);vec3 mappedColor=mix(color,maskColor.rgb,maskColor.a);gl_FragColor=vec4(mappedColor,bgColor.a*alpha);}"},23482:e=>{e.exports="varying vec2 vUv;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;attribute vec3 instanceColor;varying float alpha;varying vec3 color;\n#endif\nvoid main(){vUv=uv;\n#ifdef INSTANCED\nalpha=instanceAlpha;color=instanceColor;gl_Position=projectionMatrix*modelViewMatrix*instanceMatrix*vec4(position,1.);\n#else\ngl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n#endif\n}"},51953:e=>{e.exports="varying vec2 vUv;void main(){float dist=length(vUv);float alpha=(1.-smoothstep(0.95,1.,dist))*0.3;gl_FragColor=vec4(1.,1.,1.,alpha);}"},60264:e=>{e.exports="varying vec2 vUv;void main(){vUv=(uv*2.)-1.;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position.z*=1.00001;}"},92712:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){gl_FragColor=vec4(1.,1.,1.,alpha);}"},53496:e=>{e.exports="uniform vec2 resolution;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute vec3 stemVector;attribute vec4 pinHeadMatrixCol0;attribute vec4 pinHeadMatrixCol1;attribute vec4 pinHeadMatrixCol2;attribute vec4 pinHeadMatrixCol3;attribute float instanceAlpha;varying float alpha;\n#else\nuniform mat4 pinHeadMatrix;\n#endif\n#define PI 3.1415926538\nvoid main(){\n#ifdef INSTANCED\nvec3 pos=position*stemVector;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix*instanceMatrix;mat4 pinHeadMatrix=mat4(pinHeadMatrixCol0,pinHeadMatrixCol1,pinHeadMatrixCol2,pinHeadMatrixCol3);alpha=instanceAlpha;\n#else\nvec3 pos=position;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix;\n#endif\nvec3 fromOrigin=(vec3(0.,0.,0.)-pos);if(length(fromOrigin)<1e-6){gl_Position=modelViewProjMatrix*vec4(pos,1.);}else{mat4 noteViewProj=projectionMatrix*viewMatrix*pinHeadMatrix;vec4 noteNDC=noteViewProj*vec4(0.,0.,0.,1.);noteNDC.xyz/=abs(noteNDC.w);vec4 discEdgeNDC=noteViewProj*vec4(0.5,0.,0.,1.);discEdgeNDC.xyz/=abs(discEdgeNDC.w);float noteSizeNDC=length(discEdgeNDC.xy-noteNDC.xy);vec4 anchorNDC=modelViewProjMatrix*vec4(0.,0.,0.,1.);anchorNDC.xyz/=abs(anchorNDC.w);vec4 vectorNDC=modelViewProjMatrix*vec4(pos,1.);vectorNDC.xyz/=abs(vectorNDC.w);vectorNDC-=anchorNDC;float lineLengthNDC=length(vectorNDC.xy);float vertDot=abs(dot(normalize(vectorNDC.xy),vec2(0,1)));float angle=acos(vertDot)/(PI/2.);float aspect=mix(resolution.x/resolution.y,1.,angle);vec2 vector2d=normalize(vectorNDC.xy)*max(lineLengthNDC-noteSizeNDC*aspect,0.);vectorNDC.xy=vector2d.xy;vectorNDC+=anchorNDC;gl_Position=vec4(vectorNDC.xyz,1.);}}"},89641:e=>{e.exports="uniform float borderSize;uniform float textureSampleScale;uniform samplerCube panoTexture;uniform vec4 borderColor;varying vec2 vUv;const vec4 transparent=vec4(0.,0.,0.,0.);const float PI=3.14159265359;const float HALF_PI=PI/2.;void main(){float fadeDist=0.1;float r=1.;vec2 uv=(vUv*2.)-vec2(1.,1.);float d=length(uv);float p=d*PI-HALF_PI;float y=sin(p);float h=cos(p)*textureSampleScale;vec3 sampleVec=vec3(uv.x*h,y,uv.y*h);vec4 panoColor=textureCube(panoTexture,sampleVec);panoColor.a=clamp(((1.-d)/d)/fadeDist,0.,1.);vec4 outColor=mix(panoColor,transparent,step(1.,d));float isBorder=max(sign(borderSize),0.)*step(1.-borderSize,d)*step(d,1.);gl_FragColor=mix(outColor,borderColor,isBorder);}"},69242:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;vec4 projectedPosition=projectionMatrix*viewMatrix*modelMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},4035:e=>{e.exports="uniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 existingColor=texture2D(bg,vUv);vec4 maskColor=texture2D(mask,vUv);gl_FragColor=vec4(existingColor.rgb*maskColor.rgb,maskColor.a);}"},20672:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},38251:e=>{e.exports="uniform sampler2D texture;varying vec2 vUv;void main(){vec4 color=texture2D(texture,vUv);gl_FragColor=vec4(color.rgb,1.);}"},49749:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},16723:e=>{e.exports="#define M_PI 3.14159265359\nuniform samplerCube cubemap;uniform float yaw;varying vec2 vUv;void main(){vec2 uv=vUv;float theta=uv.x*2.*M_PI+yaw;float phi=uv.y*M_PI;vec3 longitude=vec3(sin(theta),1.,-cos(theta));vec3 latitude=vec3(sin(phi),-cos(phi),sin(phi));vec3 dir=longitude*latitude;normalize(dir);gl_FragColor=vec4(textureCube(cubemap,dir).rgb,1.);}"},58295:e=>{e.exports="varying vec2 vUv;void main(){vUv=vec2(1.-uv.x,uv.y);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},451:e=>{e.exports="uniform vec3 topColor;uniform vec3 bottomColor;uniform float radius;varying vec4 worldPosition;\n#define SRGB_TO_LINEAR(c) pow((c), vec3(2.2))\n#define LINEAR_TO_SRGB(c) pow((c), vec3(1.0 / 2.2))\n#define USE_DITHER\nfloat gradientNoise(in vec2 uv){const vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(uv,magic.xy)));}void main(){float normalizedHeight=(worldPosition.y+radius)/(radius*2.);float ratio=smoothstep(0.,0.5,normalizedHeight);vec3 colorFromGradient=mix(SRGB_TO_LINEAR(bottomColor),SRGB_TO_LINEAR(topColor),ratio);vec3 color=LINEAR_TO_SRGB(colorFromGradient);\n#if defined (USE_DITHER)\ncolor+=(1./255.)*gradientNoise(gl_FragCoord.xy)-(0.5/255.);\n#endif\ngl_FragColor=vec4(color,1.);}"},91411:e=>{e.exports="varying vec4 worldPosition;void main(){worldPosition=modelMatrix*vec4(position,1.);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},68458:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform sampler2D tMask;uniform sampler2D tPinHole;uniform vec3 pinColor;uniform float opacity;\n#define COLOR_TOLERANCE 0.9\nvoid main(){vec4 maskColor=texture2D(tMask,vUv);vec4 pinHoleColor=vec4(texture2D(tPinHole,vec2(vUv.x,vUv.y-0.11)).xyz,1.);float maskHasRed=step(COLOR_TOLERANCE,maskColor.r);float maskHasntBlue=step(maskColor.b,1.-COLOR_TOLERANCE);vec4 mixedPinColor=mix(vec4(pinColor,1.),pinHoleColor,maskHasRed*maskHasntBlue);mixedPinColor.a=min(mixedPinColor.a,maskColor.a)*opacity;gl_FragColor=mixedPinColor;}"},97508:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},1858:e=>{e.exports="precision highp float;precision highp int;uniform samplerCube tMap;varying vec3 vUvw;void main(){vec4 color=textureCube(tMap,vec3(-vUvw.x,vUvw.yz));gl_FragColor=vec4(color.rgb,1.);}"},41693:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;varying vec3 vUvw;void main(){vUvw=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},34382:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform float progress;uniform float opacity;uniform sampler2D tNoHover;uniform sampler2D tHover;uniform sampler2D tPortal;void main(){vec4 noHoverColor=texture2D(tNoHover,vUv);vec4 hoverColor=texture2D(tHover,vUv);vec4 portalColor=texture2D(tPortal,vUv);float xToCtr=2.*vUv.x-1.;float yToCtr=2.*vUv.y-1.;float withinRadius=step(xToCtr*xToCtr+yToCtr*yToCtr,0.9);vec4 mixedPortalColor=mix(hoverColor,portalColor,withinRadius);mixedPortalColor=mix(mixedPortalColor,hoverColor,hoverColor.a);mixedPortalColor=mix(noHoverColor,mixedPortalColor,progress);mixedPortalColor.a=min(mixedPortalColor.a,opacity);gl_FragColor=mixedPortalColor;}"},7206:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},92566:e=>{e.exports="varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},51799:e=>{e.exports="varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},52857:e=>{e.exports="varying vec2 vUv;uniform sampler2D tDiffuse;\n#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){vec4 texColor=texture2D(tDiffuse,vUv);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},82334:e=>{e.exports="#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;varying float alpha;\n#endif\nvarying vec2 vUv;void main(){vUv=uv;\n#ifdef INSTANCED\nmat4 mvp=projectionMatrix*modelViewMatrix*instanceMatrix;alpha=instanceAlpha;\n#else\nmat4 mvp=projectionMatrix*modelViewMatrix;\n#endif\ngl_Position=mvp*vec4(position,1.);}"},13441:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;"},81047:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;"},46846:e=>{e.exports="uniform vec3 color;uniform float opacity;void main(){gl_FragColor=vec4(color,opacity);}"},41334:e=>{e.exports="void main(){gl_Position=vec4(position,1.);}"},51712:e=>{e.exports="precision highp float;precision highp int;uniform sampler2D map;uniform vec3 color;uniform float opacity;varying vec2 vUv;void main(){vec4 sample=texture2D(map,vUv).rgba;gl_FragColor=vec4(sample.rgb*color.rgb,clamp(sample.a*opacity,0.,1.));}"},35850:e=>{e.exports="precision highp float;precision highp int;attribute vec2 uv;attribute vec4 position;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*position;}"},12739:e=>{var t=/\n/,i="\n",s=/\s/;function n(e,t,i,s){var n=e.indexOf(t,i);return-1===n||n>s?s:n}function o(e){return s.test(e)}function r(e,t,i,s){return{start:t,end:t+Math.min(s,i-t)}}e.exports=function(t,i){return e.exports.lines(t,i).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,s){if(0===(s=s||{}).width&&"nowrap"!==s.mode)return[];e=e||"";var a="number"==typeof s.width?s.width:Number.MAX_VALUE,l=Math.max(0,s.start||0),c="number"==typeof s.end?s.end:e.length,h=s.mode,d=s.measure||r;return"pre"===h?function(e,i,s,n,o){for(var r=[],a=s,l=s;l<n&&l<i.length;l++){var c=i.charAt(l),h=t.test(c);if(h||l===n-1){var d=e(i,a,h?l:l+1,o);r.push(d),a=l+1}}return r}(d,e,l,c,a):function(e,t,s,r,a,l){var c=[],h=a;for("nowrap"===l&&(h=Number.MAX_VALUE);s<r&&s<t.length;){for(var d=n(t,i,s,r);s<d&&o(t.charAt(s));)s++;var u=e(t,s,d,h),p=s+(u.end-u.start),m=p+i.length;if(p<d){for(;p>s&&!o(t.charAt(p));)p--;if(p===s)m>s+i.length&&m--,p=m;else for(m=p;p>s&&o(t.charAt(p-i.length));)p--}if(p>=s){var g=e(t,s,p,h);c.push(g)}s=m}return c}(d,e,l,c,a,h)}},47529:e=>{e.exports=function(){for(var e={},i=0;i<arguments.length;i++){var s=arguments[i];for(var n in s)t.call(s,n)&&(e[n]=s[n])}return e};var t=Object.prototype.hasOwnProperty},49329:(e,t,i)=>{e.exports=i(60516).Observable},60516:(e,t)=>{"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function n(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}t.Observable=void 0;var o=function(){return"function"==typeof Symbol},r=function(e){return o()&&Boolean(Symbol[e])},a=function(e){return r(e)?Symbol[e]:"@@"+e};o()&&!r("observable")&&(Symbol.observable=Symbol("observable"));var l=a("iterator"),c=a("observable"),h=a("species");function d(e,t){var i=e[t];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function u(e){var t=e.constructor;return void 0!==t&&null===(t=t[h])&&(t=void 0),void 0!==t?t:T}function p(e){return e instanceof T}function m(e){m.log?m.log(e):setTimeout((function(){throw e}))}function g(e){Promise.resolve().then((function(){try{e()}catch(e){m(e)}}))}function f(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var i=d(t,"unsubscribe");i&&i.call(t)}}catch(e){m(e)}}function v(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function y(e,t,i){e._state="running";var s=e._observer;try{var n=d(s,t);switch(t){case"next":n&&n.call(s,i);break;case"error":if(v(e),!n)throw i;n.call(s,i);break;case"complete":v(e),n&&n.call(s)}}catch(e){m(e)}"closed"===e._state?f(e):"running"===e._state&&(e._state="ready")}function b(e,t,i){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:i}],void g((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var i=0;i<t.length&&(y(e,t[i].type,t[i].value),"closed"!==e._state);++i);}}(e)}))):void y(e,t,i);e._queue.push({type:t,value:i})}}var w=function(){function e(t,s){i(this,e),this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var n=new S(this);try{this._cleanup=s.call(void 0,n)}catch(e){n.error(e)}"initializing"===this._state&&(this._state="ready")}return n(e,[{key:"unsubscribe",value:function(){"closed"!==this._state&&(v(this),f(this))}},{key:"closed",get:function(){return"closed"===this._state}}]),e}(),S=function(){function e(t){i(this,e),this._subscription=t}return n(e,[{key:"next",value:function(e){b(this._subscription,"next",e)}},{key:"error",value:function(e){b(this._subscription,"error",e)}},{key:"complete",value:function(){b(this._subscription,"complete")}},{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),T=function(){function e(t){if(i(this,e),!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}return n(e,[{key:"subscribe",value:function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new w(e,this._subscriber)}},{key:"forEach",value:function(e){var t=this;return new Promise((function(i,s){if("function"==typeof e)var n=t.subscribe({next:function(t){try{e(t,o)}catch(e){s(e),n.unsubscribe()}},error:s,complete:i});else s(new TypeError(e+" is not a function"));function o(){n.unsubscribe(),i()}}))}},{key:"map",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"filter",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"reduce",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this),s=arguments.length>1,n=!1,o=arguments[1],r=o;return new i((function(i){return t.subscribe({next:function(t){var o=!n;if(n=!0,!o||s)try{r=e(r,t)}catch(e){return i.error(e)}else r=t},error:function(e){i.error(e)},complete:function(){if(!n&&!s)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(r),i.complete()}})}))}},{key:"concat",value:function(){for(var e=this,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];var n=u(this);return new n((function(t){var s,o=0;return function e(r){s=r.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){o===i.length?(s=void 0,t.complete()):e(n.from(i[o++]))}})}(e),function(){s&&(s.unsubscribe(),s=void 0)}}))}},{key:"flatMap",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this);return new i((function(s){var n=[],o=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return s.error(e)}var o=i.from(t).subscribe({next:function(e){s.next(e)},error:function(e){s.error(e)},complete:function(){var e=n.indexOf(o);e>=0&&n.splice(e,1),r()}});n.push(o)},error:function(e){s.error(e)},complete:function(){r()}});function r(){o.closed&&0===n.length&&s.complete()}return function(){n.forEach((function(e){return e.unsubscribe()})),o.unsubscribe()}}))}},{key:c,value:function(){return this}}],[{key:"from",value:function(t){var i="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var s=d(t,c);if(s){var n=s.call(t);if(Object(n)!==n)throw new TypeError(n+" is not an object");return p(n)&&n.constructor===i?n:new i((function(e){return n.subscribe(e)}))}if(r("iterator")&&(s=d(t,l)))return new i((function(e){g((function(){if(!e.closed){var i=!0,n=!1,o=void 0;try{for(var r,a=s.call(t)[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var l=r.value;if(e.next(l),e.closed)return}}catch(e){n=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}e.complete()}}))}));if(Array.isArray(t))return new i((function(e){g((function(){if(!e.closed){for(var i=0;i<t.length;++i)if(e.next(t[i]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")}},{key:"of",value:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];var n="function"==typeof this?this:e;return new n((function(e){g((function(){if(!e.closed){for(var t=0;t<i.length;++t)if(e.next(i[t]),e.closed)return;e.complete()}}))}))}},{key:h,get:function(){return this}}]),e}();t.Observable=T,o()&&Object.defineProperty(T,Symbol("extensions"),{value:{symbol:c,hostReportError:m},configurable:!0})},20331:(e,t)=>{"use strict";var i,s;t.gO=t.eE=t.ru=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(i=t.ru||(t.ru={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(s=t.eE||(t.eE={}));var n=function(){function e(e){var t=void 0===e?{}:e,i=t.retries,s=void 0===i?3:i,n=t.concurrency,o=void 0===n?6:n;this.totalBytesDownloaded=0,this.queue=[],this.retries=s,this.concurrency=o}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,i){var s=new o(e,t,i);return this.enqueue(s),s.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=s.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,i=0;for(i=0;i<this.queue.length&&!(this.queue[i].priority<e.priority);i++);this.queue.splice(i,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===s.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===s.SENDING&&t.priority!==i.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=s.SENDING,e.send().then((function(i){e.status=s.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(i)})).catch((function(i){var n=null!==e.maxRetries?e.maxRetries:t.retries,o=e.sendAttempts<n;if("object"==typeof i){var r=i.status_code||0;o=o&&t.shouldRetryStatusCode(r)}o?(e.status=s.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(i)):(e.status=s.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(i))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.gO=n;var o=function(){function e(e,t,n){var o=this;void 0===n&&(n={}),this.sendAttempts=0,this.status=s.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=n.auth||null,this.withCredentials=n.withCredentials||!1,this.priority=n.priority||i.MEDIUM,this.responseType=n.responseType||null,this.body=n.body||null,this.headers=n.headers||{},this.maxRetries=n.maxRetries||null,this.onProgress=n.onProgress,this.promise=new Promise((function(e,t){o.onDone=e,o.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,i){var s;if("undefined"!=typeof XMLHttpRequest)(s=new XMLHttpRequest).withCredentials=i;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");s=new XDomainRequest}return s.open(e,t,!0),s}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var i in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(i,this.headers[i]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(i,s){t.onreadystatechange=function(n){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){i(e)}));0!==t.status&&s({status_code:t.status})}},t.onerror=function(e){s(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(i,s){try{var n=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof n)i(JSON.parse(e.responseText));else if("image"===t.responseType){var o=URL.createObjectURL(n);(n=new Image).src=o,n.crossOrigin="Anonymous",n.onload=function(){URL.revokeObjectURL(o),i(n)}}else i(n)}catch(e){s({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}()}},o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={id:e,loaded:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}r.m=n,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var n=Object.create(null);r.r(n);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>i[e]));return o.default=()=>i,r.d(n,o),n},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"js/"+e+".js",r.miniCssF=e=>"css/"+({66:"control-kit",143:"font",223:"whatwg-fetch",233:"core-js",268:"sdkBindings",376:"vr",383:"helpers",458:"showcase",525:"sdk-bundle",718:"encoders"}[e]||e)+".css",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},s="mp_webgl:",r.l=(e,t,n,o)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==s+n){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",s+n),a.src=e),i[e]=[t];var u=(t,s)=>{a.onerror=a.onload=null,clearTimeout(p);var n=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(s))),t)return t(s)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=458,r.p="",(()=>{var e={458:0};r.f.j=(t,i)=>{var s=r.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise(((i,n)=>{s=e[t]=[i,n]}));i.push(s[2]=n);var o=r.p+r.u(t),a=new Error;r.l(o,(i=>{if(r.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",a.name="ChunkLoadError",a.type=n,a.request=o,s[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{for(var s,n,[o,a,l]=i,c=0,h=[];c<o.length;c++)n=o[c],r.o(e,n)&&e[n]&&h.push(e[n][0]),e[n]=0;for(s in a)r.o(a,s)&&(r.m[s]=a[s]);for(l&&l(r),t&&t(i);h.length;)h.shift()()},i=self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";r(32545),r(3058),r(72864),r(8848);var e=r(25799);const t=new e.Z("polyfills"),i=[];window.fetch||(t.debug("Loading polyfill for fetch()"),i.push(r.e(223).then(r.bind(r,57147))));const s=i,n=new e.Z("polyfills"),o=[];Array.from||(n.debug("Loading polyfill for Array.from()"),o.push(r.e(233).then(r.t.bind(r,70404,23)))),Array.prototype.fill||(n.debug("Loading polyfill for Array.prototype.fill()"),o.push(r.e(233).then(r.t.bind(r,50676,23)))),Array.prototype.find||(n.debug("Loading polyfill for Array.prototype.find()"),o.push(r.e(233).then(r.t.bind(r,73200,23)))),Array.prototype.findIndex||(n.debug("Loading polyfill for Array.prototype.findIndex()"),o.push(r.e(233).then(r.t.bind(r,48719,23)))),Array.prototype.includes||(n.debug("Loading polyfill for Array.prototype.includes()"),o.push(r.e(233).then(r.t.bind(r,96575,23))));const a=o,l=new e.Z("polyfills"),c=[];Object.assign||(l.debug("Loading polyfill for Object.assign()"),c.push(r.e(233).then(r.t.bind(r,4977,23)))),Object.values||(l.debug("Loading polyfill for Object.values()"),c.push(r.e(233).then(r.t.bind(r,36583,23)))),Object.keys||(l.debug("Loading polyfill for Object.keys()"),c.push(r.e(233).then(r.t.bind(r,9482,23))));const h=[...c,...a,...s];var d=r(41307);class u{constructor(e){this.fetchedModules=[],this.engine=e,this.messageBus=e.msgBus,this.market=new p(e.market),this.commandBinder=e.commandBinder,this.getModuleByParent=e.getModuleByParent.bind(e),this.getModuleSync=e.getModuleSync.bind(e),this.addComponent=e.addComponent.bind(e),this.getComponentByType=e.getComponentByType.bind(e),this.getComponents=e.getComponents.bind(e),this.removeComponent=e.removeComponent.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.broadcast=e.broadcast.bind(e),this.claimRenderLayer=e.claimRenderLayer.bind(e),this.getRenderLayer=e.getRenderLayer.bind(e),this.disposeRenderLayer=e.disposeRenderLayer.bind(e),this.startGenerator=e.startGenerator.bind(e),this.stopGenerator=e.stopGenerator.bind(e),this.after=e.after.bind(e),this.deactivate=e.deactivate.bind(e),this.toggleRendering=e.toggleRendering.bind(e),this.getXrFrame=e.getXrFrame.bind(e)}getModule(e){const t=Date.now();return this.engine.getModule(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:e.name,isModule:!0,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return[...this.fetchedModules,...this.market.getLoadedDependencies()]}get msgBus(){return this.messageBus}}class p{constructor(e){this.fetchedData=[],this.market=e,this.register=e.register.bind(e),this.unregister=e.unregister.bind(e),this.tryGetData=e.tryGetData.bind(e),this.getModuleNameFromData=e.getModuleNameFromData.bind(e)}waitForData(e){const t=Date.now();return this.market.waitForData(e).then((e=>{const i=Date.now();return this.fetchedData.push({moduleName:this.getModuleNameFromData((0,d.oL)(e)),isModule:!1,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return this.fetchedData}}var m=r(44266);const g=new e.Z("module-loader");var f;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(f||(f={}));class v{constructor(){this.registeredModules={},this.typeLookup=new d.cj(!0)}registerModule(e,t){const i=this.typeLookup.addIndexByType(e),s={type:e,es6ModulePromise:t,ctorPromise:new m.Q,initPromise:new m.Q,state:f.Registered};this.registeredModules[i]=s}getTypeID(e){const t=this.typeLookup.getIndexByType(e);if(-1===t)throw Error("Trying to access unregistered Module");return t}getTypeFromTypeID(e){return this.typeLookup.getTypeByIndex(e)}moduleRegistered(e){return-1!==this.typeLookup.getIndexByType(e)}moduleLoaded(e){if(!this.moduleRegistered(e))return!1;const t=this.typeLookup.getIndexByType(e),i=this.registeredModules[t].state;return![f.Registered,f.Unloaded].includes(i)}getModule(e){const t=this.typeLookup.getIndexByType(e);if(-1===t)throw Error(`Trying to get ${(0,d.HS)(e)} before it was registered!`);if(this.registeredModules[t].state===f.Unloaded)throw Error(`${(0,d.HS)(e)} module unloaded`);return this.registeredModules[t].initPromise.nativePromise()}getModuleByParent(e){const t=this.typeLookup.getIndicesByType(e);if(0===t.length)throw Error(`No registered modules derive from ${(0,d.HS)(e)}.`);const i=[];for(const e of t)i.push(this.registeredModules[e].initPromise.nativePromise());return Promise.race(i)}getModuleSync(e){const t=this.typeLookup.getIndexByType(e);if(-1===t)throw new Error(`Trying to get ${(0,d.HS)(e)} before it was registered!`);const i=this.registeredModules[t];if(i.state!==f.Initialized)throw Error(`${(0,d.HS)(e)} module not loaded!`);return i.module}loadModule(e,t,i={}){const s=this.typeLookup.getIndexByType(t);if(-1===s)throw Error("Attempting to load an unregistered module");const n=this.registeredModules[s];if(n.state===f.Initialized)return n;if(n.state!==f.Registered&&n.state!==f.Unloaded)throw Error(`${(0,d.HS)(t)} already loading`);return n.state=f.Loading,n.es6ModulePromise().then((s=>{if(!s.default)throw new Error(`${(0,d.HS)(t)} has no default export during module loading`);const o=new s.default;n.ctorPromise.resolve(o).then((()=>{const t=Date.now();let s=!1;setTimeout((()=>{s||g.debug(`${o.name} init took over 2 seconds`)}),2e3),o.init(i,e).then((()=>{g.debug(`${o.name} init took ${(Date.now()-t)/1e3} secs.`),s=!0,n.state=f.Initialized,n.module=o,n.initPromise.resolve(o)})).catch((e=>{n.initPromise.reject(e)}))}))})).catch((e=>{g.error(`Failed to load es6Module for ${(0,d.HS)(t)}: ${e}`),n.initPromise.reject(e)})),n}whenQueueEmpties(){const e=[];for(const t in this.registeredModules){const i=this.registeredModules[t];i.state===f.Loading&&e.push(i.initPromise)}return m.Q.all(e).nativePromise()}unloadModule(e){const t=this.typeLookup.getIndexByType(e);if(-1===t)throw Error("Attempting to unload unregistered module");const i=this.registeredModules[t];if(i.state===f.Unloaded||i.state===f.Registered)throw Error("Attempting to unload not-loaded module");i.state=f.Unloaded,i.ctorPromise=new m.Q,i.initPromise=new m.Q,i.module=void 0}}const y="Data not present.",b=new e.Z("market");class w{constructor(){this.typeLookup=new d.cj,this.store=[],this.moduleRegistry=[],this.firstUpdatePromises=[]}register(e,t,i){const s=this.typeLookup.getIndexByType(t,!0);if(this.moduleRegistry[s])throw Error("Data can only be registered to one Module");this.moduleRegistry[s]=e,this.store[s]=i,i.commit(),this.firstUpdatePromises[s]&&(this.firstUpdatePromises[s].resolve(this.store[s]),delete this.firstUpdatePromises[s])}unregister(e,t){const i=this.typeLookup.getIndexByType(t,!0);if(!this.moduleRegistry[i])throw Error("No Data was registered to the Module");delete this.moduleRegistry[i],delete this.store[i]}getData(e){const t=this.typeLookup.getIndexByType(e);if(t in this.store)return this.store[t];throw Error(y)}waitForData(t){const i=this.typeLookup.getIndexByType(t,!0);return i in this.store?Promise.resolve(this.store[i]):(this.firstUpdatePromises[i]||(this.firstUpdatePromises[i]=new m.Q,setTimeout((()=>{e.Z.level>=3&&!(i in this.store)&&b.debug(`still waiting for ${t.name}-data after 5 seconds`)}),5e3)),this.firstUpdatePromises[i].nativePromise())}tryGetData(e){try{return this.getData(e)}catch(e){if(e.message!==y)throw b.error("tryGetData",e.message),e}return null}debugData(){const e={};for(const t in this.moduleRegistry){const i=this.moduleRegistry[t];i&&(e[i.name]||(e[i.name]=[]),e[i.name].push(this.store[t]))}return Object.freeze(e)}getModuleNameFromData(e){const t=this.typeLookup.getIndexByType(e);if(-1!==t){const e=this.moduleRegistry[t];if(e)return e.name}throw Error(y)}}var S=r(59309);const T=new e.Z("command-binder");class E{constructor(){this.typeLookup=new d.cj,this.bindings=[],this.queuedCommands={},this.hookedCommands={},this.resetHooks=()=>{this.hookedCommands={}},this.issueCommand=this.issueCommand.bind(this),this.issueCommandWhenBound=this.issueCommandWhenBound.bind(this)}addBinding(e,t){const i=this.typeLookup.getIndexByType(e,!0);if(this.bindings[i])throw Error("Command already bound to a callback");return this.bindings[i]=t,this.callQueuedCommands(i),{renew:()=>{this.bindings[i]!==t&&this.addBinding(e,t)},cancel:()=>this.removeBinding(e,t),active:this.bindings[i]===t}}removeBinding(e,t){const i=this.typeLookup.getIndexByType(e);-1!==i?this.bindings[i]===t?delete this.bindings[i]:T.debug("Trying to unbind unbound callback"):T.debug("Trying to unbind unbound command")}issueCommand(e,t=!0){const i=this.typeLookup.getIndexByInstance(e),s=this.bindings[i];return s?this.issueCommandHelper(e,i,s,t):Promise.reject("Command not bound: "+e.id)}issueCommandHelper(e,t,i,s=!0){return this.hookedCommands[t]&&!this.hookedCommands[t].resolving?this.issueHookCommand(e,t):i(e.payload)}issueCommandWhenBound(e){const t=new m.Q;return this.issueCommand(e).then((e=>t.resolve(e))).catch((i=>{const s=this.typeLookup.getIndexByInstance(e,!0);this.queuedCommands[s]||(this.queuedCommands[s]=[]),this.queuedCommands[s].push({command:e,deferred:t})})),t.nativePromise()}callQueuedCommands(e){const t=[];this.queuedCommands[e]&&(this.queuedCommands[e].forEach((e=>{t.push(this.issueCommand(e.command).then((t=>e.deferred.resolve(t))))})),Promise.all(t).then((()=>{delete this.queuedCommands[e]})))}hookCommand(e,t,i){const s=this.typeLookup.getIndexByType(e,!0);if(this.hookedCommands[s]){if(t&&null!==this.hookedCommands[s].preCommandCallback)throw Error(`Command ${e.name} has already been pre hooked`);if(!t&&null!==this.hookedCommands[s].postCommandCallback)throw Error(`Command ${e.name} has already been post hooked`)}else this.hookedCommands[s]={preCommandCallback:null,postCommandCallback:null,resolving:!1};t?this.hookedCommands[s].preCommandCallback=i:this.hookedCommands[s].postCommandCallback=i}async issueHookCommand(e,t){const i=this.hookedCommands[t],s=this.bindings[t],n=e.payload,o=i.preCommandCallback,r=i.postCommandCallback;try{o&&await o(n),i.resolving=!0;const a=await this.issueCommandHelper(e,t,s,!0);return i.resolving=!1,r&&await r(n),a}catch(e){throw Error(`Could not completely issueHookCommand - ${e}`)}}}var _=r(70785),x=r(28247),M=r(2779),P=r(40031),A=r(29675);class O{constructor(){this.phaseTimes=[],this.modules={},this.addAppPhase(A.nh.UNINITIALIZED),window.profilingData={phaseTimes:this.phaseTimes,modules:this.modules}}addAppPhase(e){this.phaseTimes[e]=Date.now()}addModuleLoadTime(e,t,i,s){const n=s.map((e=>e.moduleName)).join(","),o=s.reduce(((e,t)=>e+t.finishAwait-t.startAwait),0)/(i-t)*100;this.modules[e]=[e,e,null,t,i,null,o,n]}}var D=r(3471);const I=new e.Z("engine");let C=_.A.End;class R{constructor(e=!1){this.moduleLookup=[],this.componentLookup={},this.deactivatedHack=!1,this.currentApplication=null,this.moduleProfiler=new O,this.commandBinder=new E,this.market=new w,this.messageBus=new S.Y,this.engineGenerators=new x.ZP,this.layers=new M.o,this.moduleLoader=new v,this.afterPhasePromises=[],this.afterPhaseListenerCount=[],this.resetPromises(),this.subscribe(D.LZ,(e=>this.moduleProfiler.addAppPhase(e.phase)))}async loadApplication(e,t,i){if(e===this.currentApplication)throw Error("Application already loaded");const s=(this.currentApplication?this.currentApplication.getManifest():[]).map((e=>e.type)),n=e.getManifest(),o=n.map((e=>e.type)),r=this.currentApplication;this.currentApplication=null;const a=s.filter((e=>-1===o.indexOf(e))).map((e=>this.unloadModule(e)));r&&a.push(r.unload(this));const l=n.filter((e=>-1===s.indexOf(e.type)));for(const e of l)this.moduleLoader.moduleRegistered(e.type)||this.registerModule(e);if(a.length)try{await Promise.all(a)}catch(e){I.error(e),t&&t(e)}try{this.currentApplication=e,await e.load(this,{coldStart:null===r,autoPlay:i})}catch(e){I.error(e),t&&t(e)}}registerModule(e){if(this.currentApplication)throw Error("Cannot register modules while application is running");this.moduleLoader.registerModule(e.type,e.promise)}loadModule(e){const t=e;this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(t.type,t.config||{}));const i=new u(this),s=Date.now(),n=this.moduleLoader.loadModule(i,t.type,t.config);return n.ctorPromise.then((e=>this.moduleLookup[this.moduleLoader.getTypeID(t.type)]={module:e,initialized:!1})),n.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,s,Date.now(),i.getLoadedDependencies()),this.moduleLookup[this.moduleLoader.getTypeID(t.type)].initialized=!0})),n.initPromise.nativePromise()}setLoadInjection(e){if(void 0!==this.moduleLoadInjectionHook)throw Error("Hook already registered");this.moduleLoadInjectionHook=e}async unloadModule(e){if(!this.moduleLoader.moduleLoaded(e))return void I.debug(`${(0,d.HS)(e)} module already unloaded`);I.debug(`Unloading ${(0,d.HS)(e)} module`);const t=await this.getModule(e),i=this.getModuleIndex(t);this.componentLookup[i]&&(await Promise.all(this.componentLookup[i].map((async e=>{await this.removeComponent(t,e.component),e.component.dispose()}))),this.componentLookup[i]=[]),this.moduleLoader.unloadModule(e),t.dispose(this)}waitForLoadingModules(){return this.moduleLoader.whenQueueEmpties()}async getModule(e){return this.moduleLoader.getModule(e)}async getModuleByParent(e){return this.moduleLoader.getModuleByParent(e)}getModuleSync(e){return this.moduleLoader.getModuleSync(e)}getComponentByType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t].module,s=this.getModuleIndex(i),n=this.componentLookup[s]||[];for(const t of n)if(t.component instanceof e)return t.component}return null}async addComponent(e,t){const i=this.getModuleIndex(e);let s=this.componentLookup[i];s||(this.componentLookup[i]=s=[]);let n=-1;for(let e=0;e<s.length;e++)if(s[e].component===t){n=e;break}if(-1===n&&(n=s.push({component:t,active:!1})-1,t.init()),s[n].active)throw Error("Tried to add already active component: "+typeof t);await t.activate(this),s[n].active=!0}async removeComponent(e,t){const i=this.getModuleIndex(e),s=this.componentLookup[i];if(s){let e=null;for(const i of s)if(i.component===t){e=i;break}e&&e.active&&(await t.deactivate(this),e.active=!1)}}tick(){if(this.deactivatedHack)return;if(C!==_.A.End)throw Error("Engine.tick called outside of waiting. Did the engine get called recursively?!");C=_.A.Begin,this.resolveAfterPhase(_.A.Begin);const e=performance.now(),t=this.lastTick?e-this.lastTick:16;this.lastTick=e,C=_.A.Logic;try{for(const e of this.moduleLookup)e&&e.initialized&&e.module.onUpdate(t)}catch(e){throw I.error(e),e}this.resolveAfterPhase(_.A.Logic),this.engineGenerators.processGenerators(x.p3.Phase,_.A.Logic);try{this.renderComponents(t)}catch(e){throw I.error(e),e}try{C=_.A.Render,this.resolveAfterPhase(_.A.Render),this.engineGenerators.processGenerators(x.p3.Phase,_.A.Render),C=_.A.End,this.resolveAfterPhase(_.A.End),this.engineGenerators.processGenerators(x.p3.None),this.engineGenerators.processGenerators(x.p3.Promise),this.engineGenerators.processGenerators(x.p3.Duration)}catch(e){throw I.error(e),e}}subscribe(e,t,i=S.Q.PERMANENT){return this.messageBus.subscribe(e,t,i)}unsubscribe(e,t){this.messageBus.unsubscribe(e,t)}broadcast(e){this.messageBus.broadcast(e)}claimRenderLayer(e){return this.layers.claimLayer(e)}getRenderLayer(e){return this.layers.getLayer(e)}disposeRenderLayer(e){this.layers.disposeLayer(e)}startGenerator(e){this.engineGenerators.startGenerator(e)}stopGenerator(e){this.engineGenerators.stopGenerator(e)}after(e){return this.afterPhaseListenerCount[e]++,this.afterPhasePromises[e].nativePromise()}getModuleIndex(e){for(let t=0;t<this.moduleLookup.length;t++)if(this.moduleLookup[t]&&this.moduleLookup[t].module===e)return t;return-1}*getComponents(){for(const e in this.moduleLookup){const t=this.componentLookup[e];if(t)for(const e of t)yield e}}toggleRendering(e,t){const i=this.getModuleIndex(e),s=this.componentLookup[i];if(s)for(const e of s)e.active=t}renderComponents(e){for(const t in this.moduleLookup){const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.beforeRender&&t.component.beforeRender(e)}for(const t in this.moduleLookup){if(!t)continue;const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.render(e)}}resetPromises(){this.resetAfterPhasePromises()}resetAfterPhasePromises(){this.resetAfterPhasePromise(_.A.Logic),this.resetAfterPhasePromise(_.A.Render),this.resetAfterPhasePromise(_.A.Begin),this.resetAfterPhasePromise(_.A.End)}resetAfterPhasePromise(e){this.afterPhasePromises[e]=new m.Q,this.afterPhaseListenerCount[e]=0}resolveAfterPhase(e){this.afterPhaseListenerCount[e]>0&&(this.afterPhasePromises[e].resolve(),this.resetAfterPhasePromise(e))}deactivate(){this.getModuleSync(P.default).clearInterface();for(const e of this.moduleLookup)if(e&&e.initialized){const t=this.getModuleType(e.module);t&&this.unloadModule(t)}this.deactivatedHack=!0}setXrFrame(e){this.xrFrame=e}getXrFrame(){return this.xrFrame}getModuleType(e){for(let t=0;t<this.moduleLookup.length;t++){const i=this.moduleLookup[t];if(i&&i.module===e)return this.moduleLoader.getTypeFromTypeID(t)}return null}get msgBus(){return this.messageBus}}var L=r(16925),N=r(21636),k=r(32818),F=r(21265),B=r(22423),U=r(55580),H=r(33843),G=r(37018),V=r(66997),z=r(88635),j=r(58797),W=r(63239),Z=r(84496),q=r(63418),K=r(20331),Y=r(30963),$=r(89895),Q=r(94210),X=r(73986),J=r(10594),ee=r(20949),te=r(50101),ie=r(10791),se=r(49415),ne=r(64506),oe=r(44100),re=r(40562),ae=r(14600),le=r(30853),ce=r(98728),he=r(65619),de=r(62110),ue=r(84564),pe=r(12371),me=r(85197),ge=r(79234),fe=r(71144),ve=r(62513),ye=r(67940),be=r(60243),we=r(31113),Se=r(75752),Te=r(60484),Ee=r(77518),_e=r(82611),xe=r(55530),Me=r(23113),Pe=r(43344),Ae=r(7875),Oe=r(31640),De=r(17282),Ie=r(66872),Ce=r(90072),Re=r(94052),Le=r(59120),Ne=r(60959),ke=r(61597),Fe=r(27139);const Be=r(81944).default;var Ue=r(15263),He=r(79994),Ge=r(55656),Ve=r(76682),ze=r(26986),je=r(5002),We=r(71208),Ze=r(65976),qe=r(50004),Ke=r(28134),Ye=r(29122),$e=r(10816),Qe=r(17476),Xe=r(16031),Je=r(29821),et=r(26451),tt=r(73354),it=r(43339),st=r(63073),nt=r(72075),ot=r(12775),rt=r(65213),at=r(96439),lt=r(32052),ct=r(95552),ht=r(17707),dt=r(26956),ut=r(43232),pt=r(59886),mt=r(23444),gt=r(79467),ft=r(62431),vt=r(35739),yt=r(93220);const bt=new e.Z("AB");class wt{constructor(e){this.values={};for(const t in e){const i=e[t];if(i&&i.ab)try{this.values[t]=St(i.ab)}catch(e){bt.warn(`Skipping key ${t}, could not pick: ${e}`)}}}get(e){return this.values[e]}serialize(){return Object.keys(this.values).map((e=>`${e}:${this.values[e]}`))}}function St(e){if(0===e.length)throw Error("A/B cannot choose from an empty choice array");let t=0;for(const i of e){if(void 0===i.value||void 0===i.weight||i.weight<0)throw Error(`Malformed AB choice: ${i}`);t+=i.weight}const i=Math.random()*t;let s=0;for(const t of e)if(s+=t.weight,i<=s)return t.value}var Tt=r(15782),Et=r(91172),_t=r(57155),xt=r(21685),Mt=r(83455),Pt=r(75638),At=r(42885),Ot=r(98809),Dt=r(27545),It=r(47173),Ct=r(17694),Rt=r(40440),Lt=r(44693),Nt=r(87131);const kt=new e.Z("showcase-settings/quality");var Ft=r(48912),Bt=r(28281),Ut=r(19417),Ht=r(55525),Gt=r(62367),Vt=r(8473),zt=r(13931),jt=r(18739),Wt=r(76598),Zt=r(68345);class qt{constructor(e,t,i){this.engine=e,this.onErrorCallback=i,this.ticking=!1,this.start=()=>{this.ticking=!0},this.stop=()=>{this.ticking=!1},this.tick=(e,t)=>{if(this.ticking)try{this.engine.setXrFrame(t),this.engine.tick()}catch(e){this.stop(),this.onErrorCallback(e)}},t.setAnimationLoop(this.tick)}}var Kt=r(97631),Yt=r(17256),$t=r(44333),Qt=r(57501);class Xt{constructor(e,t){this.proxy=e,this.target=t}beginExternalTransition(){this.proxy.activeSession(this)&&this.target.beginExternalTransition()}endExternalTransition(){this.proxy.activeSession(this)&&this.target.endExternalTransition()}updateCameraPosition(e){this.proxy.activeSession(this)&&this.target.updateCameraPosition(e)}updateCameraRotation(e){this.proxy.activeSession(this)&&this.target.updateCameraRotation(e)}updateCameraFocus(e){this.proxy.activeSession(this)&&this.target.updateCameraFocus(e)}moveTo(e){return this.proxy.activeSession(this)?this.target.moveTo(e):m.Q.resolve()}}class Jt{constructor(e,t){this.controller=e,this.data=t,this.proxies=[]}get pose(){return this.data}activeSession(e){return 0!==this.proxies.length&&this.proxies[this.proxies.length-1].controller===e}newSession(e){let t=null;if(-1!==this.proxies.findIndex((t=>t.requester===e)))throw new Error("Cannot create two sessions with the same requester");return(0,Qt.k1)((()=>{if(!t){if(this.proxies.length>0){const e=this.proxies[this.proxies.length-1];e.requester.onAccessRevoked(e.controller)}t=new Xt(this,this.controller),this.proxies.push({controller:t,requester:e}),e.onAccessGranted(t)}}),(()=>{if(t){const e=this.proxies.findIndex((e=>e.controller===t));if(-1!==e){const t=this.proxies[e],i=e===this.proxies.length-1;if(i&&t.requester.onAccessRevoked(t.controller),this.proxies.splice(e,1),this.proxies.length>0&&i){const e=this.proxies[this.proxies.length-1];e.requester.onAccessGranted(e.controller)}}}}))}}var ei=r(89155),ti=r(1143);const ii=new e.Z("showcase"),si=window.MP_PREFETCHED_MODELDATA;class ni{constructor(e,t,i={},s=!1){this.sdkBindings=e,this.inWorkshop=t,this.settingOverrides=i,this.editModeStart=s,this.urlValues=F.AO(),this.storeQueue=new K.gO({retries:0}),this.errorPromise=new m.Q,this.quickstart="1"===this.urlValues.qs||void 0!==this.urlValues.note,this.stopTourHook=async e=>{const t=e.market.tryGetData(ce.k3);t&&t.tourPlaying&&(await e.commandBinder.issueCommand(new Ut.vy),await(0,Gt.gw)(10))};const{container:n}=this.settingOverrides;(0,ti.Ad)(this.urlValues),this.apiHost=((e,t)=>{const i=e.apiHost||t.apiHost;if(i){const e=(0,ze.JE)(i);if(e)return e}return window.location.origin})(this.urlValues,this.settingOverrides),this.container=n||document.body,this.modelUrls=(0,ze.sU)(this.urlValues.m||this.urlValues.model,this.apiHost),this.modelUrl=`${this.modelUrls.urlBase}/api/v1/player/models/${this.modelUrls.sid}`,this.modelId=this.modelUrls.sid}getManifest(){const e=[{type:L.default,promise:()=>Promise.resolve().then(r.bind(r,16925))},{type:le.default,promise:()=>Promise.resolve().then(r.bind(r,30853))},{type:zt.default,promise:()=>Promise.resolve().then(r.bind(r,13931))},{type:P.default,promise:()=>Promise.resolve().then(r.bind(r,40031))},{type:se.default,promise:()=>Promise.resolve().then(r.bind(r,49415))},{type:Ze.default,promise:()=>Promise.resolve().then(r.bind(r,65976))},{type:q.default,promise:()=>Promise.resolve().then(r.bind(r,63418))},{type:B.default,promise:()=>Promise.resolve().then(r.bind(r,22423))},{type:ve.default,promise:()=>Promise.resolve().then(r.bind(r,62513))},{type:V.default,promise:()=>Promise.resolve().then(r.bind(r,66997))},{type:z.default,promise:()=>Promise.resolve().then(r.bind(r,88635))},{type:He.default,promise:()=>Promise.resolve().then(r.bind(r,79994))},{type:Q.default,promise:()=>Promise.resolve().then(r.bind(r,94210))},{type:ie.default,promise:()=>Promise.resolve().then(r.bind(r,10791))},{type:te.default,promise:()=>Promise.resolve().then(r.bind(r,50101))},{type:N.default,promise:()=>Promise.resolve().then(r.bind(r,21636))},{type:k.default,promise:()=>Promise.resolve().then(r.bind(r,32818))},{type:Y.default,promise:()=>Promise.resolve().then(r.bind(r,30963))},{type:Ke.default,promise:()=>Promise.resolve().then(r.bind(r,28134))},{type:$.default,promise:()=>Promise.resolve().then(r.bind(r,89895))},{type:Zt.default,promise:()=>Promise.resolve().then(r.bind(r,68345))},{type:Kt.F,promise:()=>Promise.resolve().then(r.bind(r,52721))},{type:Fe.default,promise:()=>Promise.resolve().then(r.bind(r,27139))},{type:H.default,promise:()=>Promise.resolve().then(r.bind(r,33843))},{type:X.default,promise:()=>Promise.resolve().then(r.bind(r,73986))},{type:ue.default,promise:()=>Promise.resolve().then(r.bind(r,84564))},{type:pe.default,promise:()=>Promise.resolve().then(r.bind(r,12371))},{type:ge.default,promise:()=>Promise.resolve().then(r.bind(r,79234))},{type:me.default,promise:()=>Promise.resolve().then(r.bind(r,85197))},{type:fe.default,promise:()=>Promise.resolve().then(r.bind(r,71144))},{type:it.default,promise:()=>Promise.resolve().then(r.bind(r,43339))},{type:ye.default,promise:()=>Promise.resolve().then(r.bind(r,67940))},{type:tt.default,promise:()=>Promise.resolve().then(r.bind(r,73354))},{type:ke.default,promise:()=>Promise.resolve().then(r.bind(r,61597))},{type:rt.default,promise:()=>Promise.resolve().then(r.bind(r,65213))},{type:Be,promise:()=>Promise.resolve().then(r.bind(r,81944))},{type:Ne.default,promise:()=>Promise.resolve().then(r.bind(r,60959))},{type:xe.default,promise:()=>Promise.resolve().then(r.bind(r,55530))},{type:vt.default,promise:()=>Promise.resolve().then(r.bind(r,35739))},{type:be.default,promise:()=>Promise.resolve().then(r.bind(r,60243))},{type:we.default,promise:()=>Promise.resolve().then(r.bind(r,31113))},{type:Se.default,promise:()=>Promise.resolve().then(r.bind(r,75752))},{type:Me.default,promise:()=>Promise.resolve().then(r.bind(r,23113))},{type:Pe.default,promise:()=>Promise.resolve().then(r.bind(r,43344))},{type:Ve.default,promise:()=>Promise.resolve().then(r.bind(r,76682))},{type:et.default,promise:()=>Promise.resolve().then(r.bind(r,26451))},{type:oe.default,promise:()=>Promise.resolve().then(r.bind(r,44100))},{type:re.default,promise:()=>Promise.resolve().then(r.bind(r,40562))},{type:Z.default,promise:()=>Promise.resolve().then(r.bind(r,84496))},{type:ut.default,promise:()=>Promise.resolve().then(r.bind(r,43232))},{type:_e.default,promise:()=>Promise.resolve().then(r.bind(r,82611))},{type:Te.default,promise:()=>Promise.resolve().then(r.bind(r,60484))},{type:Ee.default,promise:()=>Promise.resolve().then(r.bind(r,77518))},{type:je.default,promise:()=>Promise.resolve().then(r.bind(r,5002))},{type:Ie.default,promise:()=>Promise.resolve().then(r.bind(r,66872))},{type:Ce.default,promise:()=>Promise.resolve().then(r.bind(r,90072))},{type:Re.default,promise:()=>Promise.resolve().then(r.bind(r,94052))},{type:Ae.default,promise:()=>Promise.resolve().then(r.bind(r,7875))},{type:Ue.default,promise:()=>Promise.resolve().then(r.bind(r,15263))},{type:ht.default,promise:()=>Promise.resolve().then(r.bind(r,17707))},{type:Oe.default,promise:()=>Promise.resolve().then(r.bind(r,31640))},{type:De.default,promise:()=>Promise.resolve().then(r.bind(r,17282))},{type:ee.default,promise:()=>Promise.resolve().then(r.bind(r,20949))},{type:de.default,promise:()=>Promise.resolve().then(r.bind(r,62110))},{type:he.default,promise:()=>Promise.resolve().then(r.bind(r,65619))},{type:qe.default,promise:()=>Promise.resolve().then(r.bind(r,50004))},{type:mt.default,promise:()=>Promise.resolve().then(r.bind(r,23444))},{type:gt.default,promise:()=>Promise.resolve().then(r.bind(r,79467))},{type:Ye.default,promise:()=>Promise.resolve().then(r.bind(r,29122))},{type:j.default,promise:()=>Promise.resolve().then(r.bind(r,58797))},{type:st.default,promise:()=>Promise.resolve().then(r.bind(r,63073))},{type:nt.default,promise:()=>Promise.resolve().then(r.bind(r,72075))},{type:Le.default,promise:()=>Promise.resolve().then(r.bind(r,59120))},{type:Ft.default,promise:()=>Promise.resolve().then(r.bind(r,48912))},{type:pt.default,promise:()=>Promise.resolve().then(r.bind(r,59886))},{type:dt.default,promise:()=>Promise.resolve().then(r.bind(r,26956))},{type:W.default,promise:()=>Promise.resolve().then(r.bind(r,63239))},{type:lt.default,promise:()=>Promise.resolve().then(r.bind(r,32052))},{type:at.default,promise:()=>Promise.resolve().then(r.bind(r,96439))},{type:ct.default,promise:()=>Promise.resolve().then(r.bind(r,95552))},{type:Vt.default,promise:()=>Promise.resolve().then(r.bind(r,8473))},{type:J.default,promise:()=>Promise.resolve().then(r.bind(r,10594))},{type:$e.default,promise:()=>Promise.resolve().then(r.bind(r,10816))},{type:Qe.default,promise:()=>Promise.resolve().then(r.bind(r,17476))},{type:Xe.default,promise:()=>Promise.resolve().then(r.bind(r,16031))},{type:Je.default,promise:()=>Promise.resolve().then(r.bind(r,29821))}],t=(0,jt.LG)();return t&&e.push(t),e}getAppPhases(e){return{[A.nh.UNINITIALIZED]:[],[A.nh.WAITING]:[(async()=>{await e.getModule(Ze.default)})()],[A.nh.LOADING]:[(async()=>(await e.getModule(Ze.default)).waitForPlaying)()],[A.nh.STARTING]:[(async()=>(await e.getModule(oe.default)).waitForFirstRender)()],[A.nh.PLAYING]:[(async()=>(await e.getModule(oe.default)).waitForFlyin)()],[A.nh.ERROR]:[this.errorPromise.nativePromise()]}}getStorageProvider(){let e=!(!this.apiConfig||!this.apiConfig.mds);return"mds"in this.urlValues&&(e="1"===this.urlValues.mds),e?Yt.Xq.MDS:Yt.Xq.JSONSTORE}setError(e){this.errorPromise.reject(e),this.engineTick.stop()}async load(t,i){if(this.engine=t,this.engine.loadModule({type:L.default,config:{tasks:this.getAppPhases(t)}}),this.engine.loadModule({type:le.default,config:{useGUI:!0}}),this.engine.loadModule({type:zt.default}),t.getModule(L.default).then((e=>{e.updateActiveApp(A.Mx.SHOWCASE),i.coldStart||t.broadcast(new D.pB(A.Mx.SHOWCASE))})),t.market.waitForData(A.pu).then((e=>{e.onChanged((async()=>{if(e.phase===A.nh.ERROR){const i=e.error,s=await t.getModule(Ke.default);throw i instanceof yt.vx?s.showError(Ke.ErrorType.UNSUPPORTED):i instanceof yt.Gw?s.showError(Ke.ErrorType.WEBGL):s.showError(Ke.ErrorType.GENERIC),i}}))})),!i.coldStart)return void this.loadUI(!1);ii.info("Showcase app version: 3.1.41.12-0-g5ddcd5eba"),this.canvas=document.createElement("canvas"),this.canvas.className="webgl-canvas";const s=document.querySelector("#app-container"),n=document.querySelector("#canvas-container"),o=document.querySelector("main")||document.body,r=parseInt(this.urlValues.log,10);this.urlValues.hasOwnProperty("log")&&!isNaN(r)&&(e.Z.level=r),this.quickstart&&ii.info("Quickstart engaged. Hold on to your knickers. "+performance.now()),this.engine.loadModule({type:q.default,config:{queue:this.storeQueue,prefetchedData:si,baseUrl:this.modelUrls.urlBase,preloadConfig:"showcase"}}),this.engine.loadModule({type:te.default,config:{canvas:this.canvas,useWebGL2:"1"===this.urlValues.gl2,antialias:"1"===this.urlValues.aa,useEffectComposer:!(!this.settingOverrides||!this.settingOverrides.hasOwnProperty("useEffectComposer")||!this.settingOverrides.useEffectComposer),trackTextureUsage:"1"===this.urlValues.trackTextureUsage}}),this.engine.loadModule({type:$.default}),this.engine.loadModule({type:N.default,config:{container:s}}),this.engine.loadModule({type:k.default,config:{canvas:this.canvas,container:n}}),this.engine.loadModule({type:Zt.default}),this.engine.loadModule({type:Fe.default});const[a,l,c,h]=await Promise.all([t.getModule(q.default),t.getModule(te.default),t.getModule(le.default),t.getModule($.default)]);this.engineTick=new qt(this.engine,l.threeRenderer,(e=>{this.engine.getModule(Ke.default).then((t=>{this.setError(e),t.showError(Ke.ErrorType.GENERIC)}))}));const d=a.getApi(),u=d.user.getFlags("showcase/"),p=(0,Ct.HG)(parseFloat(this.urlValues.wts)),{labels:m,mt:g,roomnav:f}=this.urlValues,v=d.user.loggedIn,y=!(!(b=this.modelId)||11!==b.length);var b;const w=y&&v&&u.has(Mt.IA),S=y&&v&&("1"===this.urlValues.newtags||u.has(xt.R)&&"0"!==this.urlValues.newtags),T=u.has(Pt.b),E=navigator.language===Ge.a?ft.Mc.USFractional:ft.Mc.Metric,_={Features:{[Ot.U]:!0,[Tt.AN]:!0,[At.s]:!0,[_t.N]:"0"!==m,[Et.re]:"0"!==g,[It.w]:"0"!==this.urlValues.f,[It.Q]:void 0===f&&u.has(It.Q)||void 0!==f&&"0"!==f,[Dt.EU]:p,[Pt.b]:T,[Mt.IA]:w,[Mt.Mp]:w,[Mt.pE]:w&&u.has(Mt.pE),[xt.R]:S},"User Preferences":{[ae.F.UnitType]:E,[ae.F.MeasurementSnapping]:!0,[ae.F.MeasurementContinuousLines]:!0,[ae.F.MeasurementUserNudgeSeen]:!1,[ae.F.NotesModeNudgeSeen]:!1}};for(const e in _)for(const t in _[e]){if(void 0===_[e][t])continue;const i="User Preferences"===e?le.SettingPersistence.LOCAL_STORAGE:le.SettingPersistence.NONE;c.registerSetting(e,t,_[e][t],!0,i)}const x={[Bt.YS]:null,sid:this.modelId,quickstart:this.quickstart,lang:this.urlValues.lang,perf:this.urlValues.perf,perfInterval:this.urlValues.perfInterval};for(const e in x)c.updateSetting(e,x[e]);if(this.settingOverrides)for(const e in this.settingOverrides)c.updateSetting(e,this.settingOverrides[e]);this.apiConfig=await d.getConfigs("showcase");const M=new wt(this.apiConfig);this.loadInitialAppModules(M,l.gpuInfo,_),c.hasProperty(Et.lc)||c.updateSetting(Et.lc,this.apiConfig.embedly_key),await this.loadModel(this.modelId,i,d).catch((e=>{this.setError(e)})),this.setupSdk(t,d),t.commandBinder.hookCommand(Ht.ju,!0,(()=>this.stopTourHook(t))),t.commandBinder.hookCommand(Ut.rU,!0,(()=>this.stopTourHook(t)));try{await t.waitForLoadingModules()}catch(e){this.setError(e),t.tick()}const[P,O]=await Promise.all([t.market.waitForData(U.T),t.market.waitForData(G.O)]);document.title=P.model.details.name;const I=O.pose;!this.quickstart||I&&I.mode===We.Ey.Panorama||(ii.warn("Disabling quickstart. No panorama start position."),this.quickstart=!1,c.updateSetting("quickstart",!1));const{maxMeshQuality:C,navPanoSize:R,zoomPanoSize:B,textureLODThreshold:V}=((e,t)=>{let i,s,n,o;(0,F.tq)()||(0,F.w1)()?(0,F.tq)()&&(0,Lt.W)(t)?(i=Rt.S7.ULTRA,s=Nt.eE[Nt.SL.STANDARD],n=Nt.eE[Nt.SL.HIGH],o=10):(i=Rt.S7.MEDIUM,s=Nt.eE[Nt.SL.STANDARD],n=Nt.eE[Nt.SL.HIGH],o=6):(i=Rt.S7.ULTRA,s=Nt.eE[Nt.SL.HIGH],n=Nt.eE[Nt.SL.ULTRAHIGH],o=20);try{i=e.maxmeshq?(0,Rt.Pm)(parseInt(e.maxmeshq,10)):i}catch(t){kt.warn(`Not a valid texture size: ${e.maxmeshq}`)}return s=e.maxtileq?parseInt(e.maxtileq,10):s,n=e.maxztileq?parseInt(e.maxztileq,10):n,o=e.lodtexth?parseInt(e.lodtexth,10):o,{maxMeshQuality:i,navPanoSize:s,zoomPanoSize:n,textureLODThreshold:o}})(this.urlValues,l.gpuInfo);ii.info({maxMeshQuality:C,navPanoSize:R,zoomPanoSize:B,textureLODThreshold:V,gpuInfo:l.gpuInfo}),"0"!==this.urlValues.tiles?await this.engine.loadModule({type:ue.default,config:{navPanoSize:R,zoomPanoSize:B}}):await this.engine.loadModule({type:pe.default}),await this.engine.loadModule({type:ge.default}),this.quickstart&&(this.loadPanoControls(this.editModeStart),this.engineTick.start()),await(await t.getModule(Ze.default)).waitForPlaying;const z=((e,t)=>new Jt(e,t))(h,(await t.market.waitForData(ei.M_)).pose);this.engine.loadModule({type:vt.default,config:{container:this.container}}),this.engine.loadModule({type:me.default,config:{renderMeshGeometry:!0,maxQuality:C,textureLOD:"2"===this.urlValues.texlod?me.TextureLOD.RAYCAST:"0"===this.urlValues.texlod?me.TextureLOD.NONE:M.get("raycast_lod")?me.TextureLOD.RAYCAST:me.TextureLOD.NONE,textureLODThreshold:void 0!==this.urlValues.texlodthreshold?parseInt(this.urlValues.texlodthreshold,10):V,maxEdgeLength:this.urlValues.tessellate?parseFloat(this.urlValues.tessellate):void 0,colorizeRooms:"1"===this.urlValues.colorizeRooms,colorizeChunks:"1"===this.urlValues.colorizeChunks,wireframe:"1"===this.urlValues.wireframe}}),this.engine.loadModule({type:it.default}),this.engine.loadModule({type:fe.default,config:{startingMode:this.quickstart?We.Ey.Panorama:null}}),this.engine.loadModule({type:we.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:X.default}),this.engine.loadModule({type:ye.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:be.default,config:{allowFloorChanges:_.Features[It.w],focusBasedNav:_.Features[It.Q]}}),this.engine.loadModule({type:tt.default}),this.engine.loadModule({type:H.default,config:{baseUrl:this.modelUrls.urlBase,api:d,queue:this.storeQueue}}),this.engine.loadModule({type:ke.default,config:{workshopApp:this.inWorkshop,container:this.container,mainDiv:o}}),this.engine.loadModule({type:rt.default,config:{mainDiv:o}}),this.engine.loadModule({type:Be}),this.engine.loadModule({type:Se.default}),this.engine.loadModule({type:Me.default,config:{cameraPoseProxy:z}}),this.engine.loadModule({type:Pe.default}),this.engine.loadModule({type:Ve.default,config:{enabled:"1"!==this.urlValues.nozoom,tiles:"0"!==this.urlValues.tiles}}),this.engine.loadModule({type:oe.default}),this.engine.loadModule({type:Z.default,config:{enableWheel:"1"===this.urlValues.nozoom,focusBasedNav:_.Features[It.Q]}}),this.engine.loadModule({type:ut.default}),this.engine.loadModule({type:re.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:et.default}),this.quickstart||this.engineTick.start(),this.quickstart||this.loadPanoControls(this.editModeStart),await this.engine.waitForLoadingModules(),(0,jt.DO)(t,z),"0"!==this.urlValues.portal&&(this.engine.loadModule({type:Qe.default}),this.engine.loadModule({type:$e.default})),"0"!==this.urlValues.pin&&(this.engine.loadModule({type:Je.default}),this.engine.loadModule({type:Xe.default})),this.engine.loadModule({type:_e.default,config:{checkRenderModes:()=>{const e=t.market.tryGetData(ce.k3);if(e&&e.isTourActive())return!1;const i=t.market.tryGetData(ot.O);return!!i&&i.isPano()}}}),this.engine.loadModule({type:Ie.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),_.Features[It.Q]&&this.engine.loadModule({type:Ue.default}),this.engine.loadModule({type:ht.default,config:{notesModeEnabled:w,newTagsEnabled:S}}),this.engine.loadModule({type:Ce.default}),this.engine.loadModule({type:dt.default,config:{debug:"1"===this.urlValues.fcdbg}}),this.getStorageProvider()===Yt.Xq.JSONSTORE&&this.engine.loadModule({type:Re.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:Le.default}),this.engine.loadModule({type:Ae.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,parserOptions:{model:this.modelId,supportLinks:!this.urlValues.mls||"0"===this.urlValues.mls,keepLinkLabels:!0}}}),this.engine.loadModule({type:Oe.default}),this.engine.loadModule({type:De.default}),this.engine.loadModule({type:ee.default}),this.engine.loadModule({type:de.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,looping:"1"===this.urlValues.lp}}),this.engine.loadModule({type:he.default}),this.engine.loadModule({type:qe.default}),this.engine.loadModule({type:Te.default}),this.engine.loadModule({type:Ee.default}),this.engine.loadModule({type:je.default}),this.engine.loadModule({type:mt.default}),this.engine.loadModule({type:J.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:Ye.default}),this.engine.loadModule({type:st.default}),this.engine.loadModule({type:nt.default}),this.engine.loadModule({type:Ft.default}),this.engine.loadModule({type:Vt.default}),this.engine.loadModule({type:pt.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:j.default,config:{queue:this.storeQueue}}),(w||S)&&(this.engine.loadModule({type:W.default,config:{queue:this.storeQueue,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,modelUrl:this.modelUrl}}),w&&this.engine.loadModule({type:at.default,config:{workshop:this.inWorkshop,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,queue:this.storeQueue,startingNote:this.urlValues.note}}),S&&this.engine.loadModule({type:ct.default}),this.engine.loadModule({type:lt.default})),this.engine.loadModule({type:gt.default,config:{enableEventPositions:!1,framebufferScaling:Math.min(this.urlValues.xrframebuffer?parseFloat(this.urlValues.xrframebuffer):0,1),tracking:0,navPanoSize:R}})}async unload(e){try{const t=e.getModuleSync(he.default);await t.stopTour()}catch(e){ii.debug("showcase unload called before tour controls registered, ignoring stopTour",e)}await this.showcaseGui.unloadUi(),this.guiModule.unloadUi(),e.commandBinder.resetHooks()}async loadModel(e,t,i){ii.info(`Loading model ${e}`),await i.modelExists(e).catch((async e=>{if(!(e instanceof Wt.GT))throw e;await this.login()})),this.inWorkshop&&this.getStorageProvider()===Yt.Xq.MDS&&(await this.engine.getModule(Kt.F),await this.engine.commandBinder.issueCommand(new $t.dS({viewType:Yt.XZ.SESSION}))),this.loadInitialDataModules(e,t)}loadInitialAppModules(e,t,i){this.engine.loadModule({type:ve.default}),this.engine.loadModule({type:Y.default,config:{disableWheel:"0"===this.urlValues.wh,pointerPreventDefault:!this.settingOverrides||!this.settingOverrides.hasOwnProperty("pointerPreventDefault")||!!this.settingOverrides.pointerPreventDefault}}),this.engine.loadModule({type:He.default,config:{queue:this.storeQueue}}),this.engine.loadModule({type:ie.default,config:{queue:this.storeQueue,appName:this.settingOverrides&&this.settingOverrides.appName||"showcase",provider:this.urlValues.analytics,additionalValues:{ab_tests:e.serialize(),gpu:t}}}),this.engine.loadModule({type:Ke.default}),this.engine.loadModule({type:Kt.F,config:{modelId:this.modelId,mdsEnabled:this.getStorageProvider()===Yt.Xq.MDS,baseUrl:this.apiHost,queue:this.storeQueue}})}loadInitialDataModules(e,t){const i=!("1"!==this.urlValues.play&&!t.autoPlay),s=F.Ot()&&!F.PI("xr-spatial-tracking"),n=!F.yL()||i&&!s,o=!(F.tq()||s),r=void 0!==this.urlValues.note,a=r,l=r||"0"===this.urlValues.title||"2"===this.urlValues.title,c=r||"1"===this.urlValues.mls||"2"===this.urlValues.mls||"0"===this.urlValues.brand;this.engine.loadModule({type:Ze.default,config:{inWorkshop:this.inWorkshop,modelId:this.modelId,baseUrl:this.modelUrls.urlBase,quickstart:this.quickstart,autoplay:n,allowPlayInIframe:o,startNewTab:"1"===this.urlValues.nt,hideTitle:l,hideBranding:c,hidePoweredBy:a}}),this.engine.loadModule({type:z.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:V.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:B.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:Q.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}})}loadPanoControls(e){this.loadUI(e),this.engine.loadModule({type:Ne.default}),this.engine.loadModule({type:xe.default})}async setupSdk(e,t){const i=await async function(){let e="./sdk-client.js";{const i=await t.getAppKey("showcase","sdk_version")||"";i.startsWith("https")?e=i:/^\d+\.\d+\.\d+\.\d+-\d+\-g\w{9}$/.test(i)?e=`https://static.matterport.com/showcase/${i}/sdk-client.js`:ii.warn("The sdk client version was configured incorrectly. Falling back to the last built version.")}return e}().catch((e=>(ii.error(e),"./sdk-client.js")));this.engine.loadModule({type:P.default,config:{validationUrl:this.apiHost+"/api/v1/user/",clientScriptUrl:i,queue:this.storeQueue}}),(0,P.setupSdk)(e,this.sdkBindings)}loadUI(e){Promise.all([this.engine.getModule(ke.default),this.engine.getModule(Be)]).then((([t,i])=>{this.guiModule=t,this.showcaseGui=i,e||t.loadUi(i.loadUi)}))}login(){return new Promise((async e=>{this.engine.loadModule({type:se.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,container:this.container}});const t=await this.engine.getModule(se.default);this.engine.subscribe(ne.L,(()=>{t.hidePasswordScreen(),e()})),t.showPasswordScreen()}))}}const oi=async(e,t)=>{(await r.e(268).then(r.bind(r,11879))).bindSdkInterface(e,e.commandBinder,t)};var ri,ai=r(5277);!function(e){e.connect=async function(e,i){if("string"!=typeof i)throw Error("invalid key");const s=`${window.location.protocol}//${window.location.host}`,n=await e.getModule(P.default),o=await n.connect(i,s);return new(await async function(e){if(e){const i=t[e];if(i)return i;const s=new Promise(((t,i)=>{try{ai(e,(function(){const e=window["sdk-client"];delete window["sdk-client"],e&&e.SdkBuilder&&"function"==typeof e.SdkBuilder&&t(e.SdkBuilder)}))}catch(t){i(`Could not load the sdk from ${e}`)}}));return t[e]=s,s}throw new Error("Unabled to load the sdk")}(o.scriptUrl))(o.messengerFactory).build(o.serializedInterface)};const t={}}(ri||(ri={}));const li=new e.Z("bootstrap");function ci(e){const t=new R,i=new ni([oi],!1,e);t.loadApplication(i,i.setError.bind(i)),F.Jm()||document.body.classList.add("no-touch"),function(e){window.MP_SDK={connect:async(t,i)=>ri.connect(e,i)}}(t)}window.addEventListener("app-start",(e=>{const t=e.detail&&e.detail.config?e.detail.config:{};let i=!1;(async()=>Promise.all(h))().then((()=>{i=!0,ci(t)})).catch((e=>{li.error(e),i||ci(t)}))}),!0)})()})();